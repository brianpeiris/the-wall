(()=>{var rO=Object.create;var Wm=Object.defineProperty;var sO=Object.getOwnPropertyDescriptor;var oO=Object.getOwnPropertyNames;var aO=Object.getPrototypeOf,lO=Object.prototype.hasOwnProperty;var BT=o=>Wm(o,"__esModule",{value:!0});var Ox=o=>{if(typeof require!="undefined")return require(o);throw new Error('Dynamic require of "'+o+'" is not supported')};var Xd=(o,e)=>()=>(e||o((e={exports:{}}).exports,e),e.exports),NT=(o,e)=>{BT(o);for(var t in e)Wm(o,t,{get:e[t],enumerable:!0})},cO=(o,e,t)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of oO(e))!lO.call(o,n)&&n!=="default"&&Wm(o,n,{get:()=>e[n],enumerable:!(t=sO(e,n))||t.enumerable});return o},qo=o=>cO(BT(Wm(o!=null?rO(aO(o)):{},"default",o&&o.__esModule&&"default"in o?{get:()=>o.default,enumerable:!0}:{value:o,enumerable:!0})),o);var q3=Xd(X0=>{"use strict";Object.defineProperty(X0,"__esModule",{value:!0});X0.VERSION=void 0;X0.VERSION="0.0.5"});var hc=Xd(Hh=>{"use strict";var j3=Hh&&Hh.__spreadArray||function(o,e){for(var t=0,n=e.length,i=o.length;t<n;t++,i++)o[i]=e[t];return o};Object.defineProperty(Hh,"__esModule",{value:!0});Hh.Events=void 0;var VX=q3(),WX=function(){function o(e,t,n){n===void 0&&(n=!1),this.fn=e,this.context=t,this.once=n}return o}(),Y3=function(o,e,t,n,i){if(typeof t!="function")throw new TypeError("The listener must be a function");var r=new WX(t,n||o,i);return o._events.has(e)?o._events.get(e).fn?o._events.set(e,[o._events.get(e),r]):o._events.get(e).push(r):(o._events.set(e,r),o._eventsCount++),o},q0=function(o,e){--o._eventsCount==0?o._events=new Map:o._events.delete(e)},XX=function(){function o(){this._events=new Map,this._eventsCount=0}return Object.defineProperty(o,"VERSION",{get:function(){return VX.VERSION},enumerable:!1,configurable:!0}),o.prototype.eventNames=function(){return Array.from(this._events.keys())},o.prototype.listeners=function(e){var t=this._events.get(e);if(!t)return[];if(t.fn)return[t.fn];for(var n=0,i=t.length,r=new Array(i);n<i;n++)r[n]=t[n].fn;return r},o.prototype.listenerCount=function(e){var t=this._events.get(e);return t?t.fn?1:t.length:0},o.prototype.emit=function(e){for(var t,n,i=[],r=1;r<arguments.length;r++)i[r-1]=arguments[r];if(!this._events.has(e))return!1;var s=this._events.get(e),a;if(s.fn)return s.once&&this.removeListener(e,s.fn,void 0,!0),(t=s.fn).call.apply(t,j3([s.context],i)),!0;var l=s.length;for(a=0;a<l;a++)s[a].once&&this.removeListener(e,s[a].fn,void 0,!0),(n=s[a].fn).call.apply(n,j3([s[a].context],i));return!0},o.prototype.on=function(e,t,n){return Y3(this,e,t,n,!1)},o.prototype.once=function(e,t,n){return Y3(this,e,t,n,!0)},o.prototype.removeListener=function(e,t,n,i){if(!this._events.has(e))return this;if(!t)return q0(this,e),this;var r=this._events.get(e);if(r.fn)r.fn===t&&(!i||r.once)&&(!n||r.context===n)&&q0(this,e);else{for(var s=0,a=[],l=r.length;s<l;s++)(r[s].fn!==t||i&&!r[s].once||n&&r[s].context!==n)&&a.push(r[s]);a.length?this._events.set(e,a.length===1?a[0]:a):q0(this,e)}return this},o.prototype.removeAllListeners=function(e){return e?this._events.delete(e)&&q0(this,e):(this._events=new Map,this._eventsCount=0),this},Object.defineProperty(o.prototype,"off",{get:function(){return this.removeListener},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"addListener",{get:function(){return this.on},enumerable:!1,configurable:!0}),o}();Hh.Events=XX});var xI=Xd((zp,d1)=>{(function(e,t){typeof zp=="object"&&typeof d1=="object"?d1.exports=t():typeof define=="function"&&define.amd?define("Matter",[],t):typeof zp=="object"?zp.Matter=t():e.Matter=t()})(zp,function(){return function(o){var e={};function t(n){if(e[n])return e[n].exports;var i=e[n]={i:n,l:!1,exports:{}};return o[n].call(i.exports,i,i.exports,t),i.l=!0,i.exports}return t.m=o,t.c=e,t.d=function(n,i,r){t.o(n,i)||Object.defineProperty(n,i,{enumerable:!0,get:r})},t.r=function(n){typeof Symbol!="undefined"&&Symbol.toStringTag&&Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(n,"__esModule",{value:!0})},t.t=function(n,i){if(i&1&&(n=t(n)),i&8||i&4&&typeof n=="object"&&n&&n.__esModule)return n;var r=Object.create(null);if(t.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:n}),i&2&&typeof n!="string")for(var s in n)t.d(r,s,function(a){return n[a]}.bind(null,s));return r},t.n=function(n){var i=n&&n.__esModule?function(){return n.default}:function(){return n};return t.d(i,"a",i),i},t.o=function(n,i){return Object.prototype.hasOwnProperty.call(n,i)},t.p="",t(t.s=22)}([function(o,e){var t={};o.exports=t,function(){t._nextId=0,t._seed=0,t._nowStartTime=+new Date,t._warnedOnce={},t._decomp=null,t.extend=function(i,r){var s,a,l;typeof r=="boolean"?(s=2,l=r):(s=1,l=!0);for(var c=s;c<arguments.length;c++){var u=arguments[c];if(u)for(var d in u)l&&u[d]&&u[d].constructor===Object&&(!i[d]||i[d].constructor===Object)?(i[d]=i[d]||{},t.extend(i[d],l,u[d])):i[d]=u[d]}return i},t.clone=function(i,r){return t.extend({},r,i)},t.keys=function(i){if(Object.keys)return Object.keys(i);var r=[];for(var s in i)r.push(s);return r},t.values=function(i){var r=[];if(Object.keys){for(var s=Object.keys(i),a=0;a<s.length;a++)r.push(i[s[a]]);return r}for(var l in i)r.push(i[l]);return r},t.get=function(i,r,s,a){r=r.split(".").slice(s,a);for(var l=0;l<r.length;l+=1)i=i[r[l]];return i},t.set=function(i,r,s,a,l){var c=r.split(".").slice(a,l);return t.get(i,r,0,-1)[c[c.length-1]]=s,s},t.shuffle=function(i){for(var r=i.length-1;r>0;r--){var s=Math.floor(t.random()*(r+1)),a=i[r];i[r]=i[s],i[s]=a}return i},t.choose=function(i){return i[Math.floor(t.random()*i.length)]},t.isElement=function(i){return typeof HTMLElement!="undefined"?i instanceof HTMLElement:!!(i&&i.nodeType&&i.nodeName)},t.isArray=function(i){return Object.prototype.toString.call(i)==="[object Array]"},t.isFunction=function(i){return typeof i=="function"},t.isPlainObject=function(i){return typeof i=="object"&&i.constructor===Object},t.isString=function(i){return toString.call(i)==="[object String]"},t.clamp=function(i,r,s){return i<r?r:i>s?s:i},t.sign=function(i){return i<0?-1:1},t.now=function(){if(typeof window!="undefined"&&window.performance){if(window.performance.now)return window.performance.now();if(window.performance.webkitNow)return window.performance.webkitNow()}return Date.now?Date.now():new Date-t._nowStartTime},t.random=function(i,r){return i=typeof i!="undefined"?i:0,r=typeof r!="undefined"?r:1,i+n()*(r-i)};var n=function(){return t._seed=(t._seed*9301+49297)%233280,t._seed/233280};t.colorToNumber=function(i){return i=i.replace("#",""),i.length==3&&(i=i.charAt(0)+i.charAt(0)+i.charAt(1)+i.charAt(1)+i.charAt(2)+i.charAt(2)),parseInt(i,16)},t.logLevel=1,t.log=function(){console&&t.logLevel>0&&t.logLevel<=3&&console.log.apply(console,["matter-js:"].concat(Array.prototype.slice.call(arguments)))},t.info=function(){console&&t.logLevel>0&&t.logLevel<=2&&console.info.apply(console,["matter-js:"].concat(Array.prototype.slice.call(arguments)))},t.warn=function(){console&&t.logLevel>0&&t.logLevel<=3&&console.warn.apply(console,["matter-js:"].concat(Array.prototype.slice.call(arguments)))},t.warnOnce=function(){var i=Array.prototype.slice.call(arguments).join(" ");t._warnedOnce[i]||(t.warn(i),t._warnedOnce[i]=!0)},t.deprecated=function(i,r,s){i[r]=t.chain(function(){t.warnOnce("\u{1F505} deprecated \u{1F505}",s)},i[r])},t.nextId=function(){return t._nextId++},t.indexOf=function(i,r){if(i.indexOf)return i.indexOf(r);for(var s=0;s<i.length;s++)if(i[s]===r)return s;return-1},t.map=function(i,r){if(i.map)return i.map(r);for(var s=[],a=0;a<i.length;a+=1)s.push(r(i[a]));return s},t.topologicalSort=function(i){var r=[],s=[],a=[];for(var l in i)!s[l]&&!a[l]&&t._topologicalSort(l,s,a,i,r);return r},t._topologicalSort=function(i,r,s,a,l){var c=a[i]||[];s[i]=!0;for(var u=0;u<c.length;u+=1){var d=c[u];s[d]||r[d]||t._topologicalSort(d,r,s,a,l)}s[i]=!1,r[i]=!0,l.push(i)},t.chain=function(){for(var i=[],r=0;r<arguments.length;r+=1){var s=arguments[r];s._chained?i.push.apply(i,s._chained):i.push(s)}var a=function(){for(var l,c=new Array(arguments.length),u=0,d=arguments.length;u<d;u++)c[u]=arguments[u];for(u=0;u<i.length;u+=1){var h=i[u].apply(l,c);typeof h!="undefined"&&(l=h)}return l};return a._chained=i,a},t.chainPathBefore=function(i,r,s){return t.set(i,r,t.chain(s,t.get(i,r)))},t.chainPathAfter=function(i,r,s){return t.set(i,r,t.chain(t.get(i,r),s))},t.setDecomp=function(i){t._decomp=i},t.getDecomp=function(){var i=t._decomp;try{!i&&typeof window!="undefined"&&(i=window.decomp),!i&&typeof global!="undefined"&&(i=global.decomp)}catch(r){i=null}return i}}()},function(o,e){var t={};o.exports=t,function(){t.create=function(n){var i={min:{x:0,y:0},max:{x:0,y:0}};return n&&t.update(i,n),i},t.update=function(n,i,r){n.min.x=1/0,n.max.x=-1/0,n.min.y=1/0,n.max.y=-1/0;for(var s=0;s<i.length;s++){var a=i[s];a.x>n.max.x&&(n.max.x=a.x),a.x<n.min.x&&(n.min.x=a.x),a.y>n.max.y&&(n.max.y=a.y),a.y<n.min.y&&(n.min.y=a.y)}r&&(r.x>0?n.max.x+=r.x:n.min.x+=r.x,r.y>0?n.max.y+=r.y:n.min.y+=r.y)},t.contains=function(n,i){return i.x>=n.min.x&&i.x<=n.max.x&&i.y>=n.min.y&&i.y<=n.max.y},t.overlaps=function(n,i){return n.min.x<=i.max.x&&n.max.x>=i.min.x&&n.max.y>=i.min.y&&n.min.y<=i.max.y},t.translate=function(n,i){n.min.x+=i.x,n.max.x+=i.x,n.min.y+=i.y,n.max.y+=i.y},t.shift=function(n,i){var r=n.max.x-n.min.x,s=n.max.y-n.min.y;n.min.x=i.x,n.max.x=i.x+r,n.min.y=i.y,n.max.y=i.y+s}}()},function(o,e){var t={};o.exports=t,function(){t.create=function(n,i){return{x:n||0,y:i||0}},t.clone=function(n){return{x:n.x,y:n.y}},t.magnitude=function(n){return Math.sqrt(n.x*n.x+n.y*n.y)},t.magnitudeSquared=function(n){return n.x*n.x+n.y*n.y},t.rotate=function(n,i,r){var s=Math.cos(i),a=Math.sin(i);r||(r={});var l=n.x*s-n.y*a;return r.y=n.x*a+n.y*s,r.x=l,r},t.rotateAbout=function(n,i,r,s){var a=Math.cos(i),l=Math.sin(i);s||(s={});var c=r.x+((n.x-r.x)*a-(n.y-r.y)*l);return s.y=r.y+((n.x-r.x)*l+(n.y-r.y)*a),s.x=c,s},t.normalise=function(n){var i=t.magnitude(n);return i===0?{x:0,y:0}:{x:n.x/i,y:n.y/i}},t.dot=function(n,i){return n.x*i.x+n.y*i.y},t.cross=function(n,i){return n.x*i.y-n.y*i.x},t.cross3=function(n,i,r){return(i.x-n.x)*(r.y-n.y)-(i.y-n.y)*(r.x-n.x)},t.add=function(n,i,r){return r||(r={}),r.x=n.x+i.x,r.y=n.y+i.y,r},t.sub=function(n,i,r){return r||(r={}),r.x=n.x-i.x,r.y=n.y-i.y,r},t.mult=function(n,i){return{x:n.x*i,y:n.y*i}},t.div=function(n,i){return{x:n.x/i,y:n.y/i}},t.perp=function(n,i){return i=i===!0?-1:1,{x:i*-n.y,y:i*n.x}},t.neg=function(n){return{x:-n.x,y:-n.y}},t.angle=function(n,i){return Math.atan2(i.y-n.y,i.x-n.x)},t._temp=[t.create(),t.create(),t.create(),t.create(),t.create(),t.create()]}()},function(o,e,t){var n={};o.exports=n;var i=t(2),r=t(0);(function(){n.create=function(s,a){for(var l=[],c=0;c<s.length;c++){var u=s[c],d={x:u.x,y:u.y,index:c,body:a,isInternal:!1};l.push(d)}return l},n.fromPath=function(s,a){var l=/L?\s*([-\d.e]+)[\s,]*([-\d.e]+)*/ig,c=[];return s.replace(l,function(u,d,h){c.push({x:parseFloat(d),y:parseFloat(h)})}),n.create(c,a)},n.centre=function(s){for(var a=n.area(s,!0),l={x:0,y:0},c,u,d,h=0;h<s.length;h++)d=(h+1)%s.length,c=i.cross(s[h],s[d]),u=i.mult(i.add(s[h],s[d]),c),l=i.add(l,u);return i.div(l,6*a)},n.mean=function(s){for(var a={x:0,y:0},l=0;l<s.length;l++)a.x+=s[l].x,a.y+=s[l].y;return i.div(a,s.length)},n.area=function(s,a){for(var l=0,c=s.length-1,u=0;u<s.length;u++)l+=(s[c].x-s[u].x)*(s[c].y+s[u].y),c=u;return a?l/2:Math.abs(l)/2},n.inertia=function(s,a){for(var l=0,c=0,u=s,d,h,f=0;f<u.length;f++)h=(f+1)%u.length,d=Math.abs(i.cross(u[h],u[f])),l+=d*(i.dot(u[h],u[h])+i.dot(u[h],u[f])+i.dot(u[f],u[f])),c+=d;return a/6*(l/c)},n.translate=function(s,a,l){var c;if(l)for(c=0;c<s.length;c++)s[c].x+=a.x*l,s[c].y+=a.y*l;else for(c=0;c<s.length;c++)s[c].x+=a.x,s[c].y+=a.y;return s},n.rotate=function(s,a,l){if(a!==0){for(var c=Math.cos(a),u=Math.sin(a),d=0;d<s.length;d++){var h=s[d],f=h.x-l.x,p=h.y-l.y;h.x=l.x+(f*c-p*u),h.y=l.y+(f*u+p*c)}return s}},n.contains=function(s,a){for(var l=0;l<s.length;l++){var c=s[l],u=s[(l+1)%s.length];if((a.x-c.x)*(u.y-c.y)+(a.y-c.y)*(c.x-u.x)>0)return!1}return!0},n.scale=function(s,a,l,c){if(a===1&&l===1)return s;c=c||n.centre(s);for(var u,d,h=0;h<s.length;h++)u=s[h],d=i.sub(u,c),s[h].x=c.x+d.x*a,s[h].y=c.y+d.y*l;return s},n.chamfer=function(s,a,l,c,u){typeof a=="number"?a=[a]:a=a||[8],l=typeof l!="undefined"?l:-1,c=c||2,u=u||14;for(var d=[],h=0;h<s.length;h++){var f=s[h-1>=0?h-1:s.length-1],p=s[h],g=s[(h+1)%s.length],v=a[h<a.length?h:a.length-1];if(v===0){d.push(p);continue}var y=i.normalise({x:p.y-f.y,y:f.x-p.x}),m=i.normalise({x:g.y-p.y,y:p.x-g.x}),x=Math.sqrt(2*Math.pow(v,2)),_=i.mult(r.clone(y),v),w=i.normalise(i.mult(i.add(y,m),.5)),b=i.sub(p,i.mult(w,x)),M=l;l===-1&&(M=Math.pow(v,.32)*1.75),M=r.clamp(M,c,u),M%2==1&&(M+=1);for(var S=Math.acos(i.dot(y,m)),E=S/M,A=0;A<M;A++)d.push(i.add(i.rotate(_,E*A),b))}return d},n.clockwiseSort=function(s){var a=n.mean(s);return s.sort(function(l,c){return i.angle(a,l)-i.angle(a,c)}),s},n.isConvex=function(s){var a=0,l=s.length,c,u,d,h;if(l<3)return null;for(c=0;c<l;c++)if(u=(c+1)%l,d=(c+2)%l,h=(s[u].x-s[c].x)*(s[d].y-s[u].y),h-=(s[u].y-s[c].y)*(s[d].x-s[u].x),h<0?a|=1:h>0&&(a|=2),a===3)return!1;return a!==0?!0:null},n.hull=function(s){var a=[],l=[],c,u;for(s=s.slice(0),s.sort(function(d,h){var f=d.x-h.x;return f!==0?f:d.y-h.y}),u=0;u<s.length;u+=1){for(c=s[u];l.length>=2&&i.cross3(l[l.length-2],l[l.length-1],c)<=0;)l.pop();l.push(c)}for(u=s.length-1;u>=0;u-=1){for(c=s[u];a.length>=2&&i.cross3(a[a.length-2],a[a.length-1],c)<=0;)a.pop();a.push(c)}return a.pop(),l.pop(),a.concat(l)}})()},function(o,e,t){var n={};o.exports=n;var i=t(0);(function(){n.on=function(r,s,a){for(var l=s.split(" "),c,u=0;u<l.length;u++)c=l[u],r.events=r.events||{},r.events[c]=r.events[c]||[],r.events[c].push(a);return a},n.off=function(r,s,a){if(!s){r.events={};return}typeof s=="function"&&(a=s,s=i.keys(r.events).join(" "));for(var l=s.split(" "),c=0;c<l.length;c++){var u=r.events[l[c]],d=[];if(a&&u)for(var h=0;h<u.length;h++)u[h]!==a&&d.push(u[h]);r.events[l[c]]=d}},n.trigger=function(r,s,a){var l,c,u,d,h=r.events;if(h&&i.keys(h).length>0){a||(a={}),l=s.split(" ");for(var f=0;f<l.length;f++)if(c=l[f],u=h[c],u){d=i.clone(a,!1),d.name=c,d.source=r;for(var p=0;p<u.length;p++)u[p].apply(r,[d])}}}})()},function(o,e,t){var n={};o.exports=n;var i=t(4),r=t(0),s=t(1),a=t(6);(function(){n.create=function(l){return r.extend({id:r.nextId(),type:"composite",parent:null,isModified:!1,bodies:[],constraints:[],composites:[],label:"Composite",plugin:{}},l)},n.setModified=function(l,c,u,d){if(l.isModified=c,u&&l.parent&&n.setModified(l.parent,c,u,d),d)for(var h=0;h<l.composites.length;h++){var f=l.composites[h];n.setModified(f,c,u,d)}},n.add=function(l,c){var u=[].concat(c);i.trigger(l,"beforeAdd",{object:c});for(var d=0;d<u.length;d++){var h=u[d];switch(h.type){case"body":if(h.parent!==h){r.warn("Composite.add: skipped adding a compound body part (you must add its parent instead)");break}n.addBody(l,h);break;case"constraint":n.addConstraint(l,h);break;case"composite":n.addComposite(l,h);break;case"mouseConstraint":n.addConstraint(l,h.constraint);break}}return i.trigger(l,"afterAdd",{object:c}),l},n.remove=function(l,c,u){var d=[].concat(c);i.trigger(l,"beforeRemove",{object:c});for(var h=0;h<d.length;h++){var f=d[h];switch(f.type){case"body":n.removeBody(l,f,u);break;case"constraint":n.removeConstraint(l,f,u);break;case"composite":n.removeComposite(l,f,u);break;case"mouseConstraint":n.removeConstraint(l,f.constraint);break}}return i.trigger(l,"afterRemove",{object:c}),l},n.addComposite=function(l,c){return l.composites.push(c),c.parent=l,n.setModified(l,!0,!0,!1),l},n.removeComposite=function(l,c,u){var d=r.indexOf(l.composites,c);if(d!==-1&&(n.removeCompositeAt(l,d),n.setModified(l,!0,!0,!1)),u)for(var h=0;h<l.composites.length;h++)n.removeComposite(l.composites[h],c,!0);return l},n.removeCompositeAt=function(l,c){return l.composites.splice(c,1),n.setModified(l,!0,!0,!1),l},n.addBody=function(l,c){return l.bodies.push(c),n.setModified(l,!0,!0,!1),l},n.removeBody=function(l,c,u){var d=r.indexOf(l.bodies,c);if(d!==-1&&(n.removeBodyAt(l,d),n.setModified(l,!0,!0,!1)),u)for(var h=0;h<l.composites.length;h++)n.removeBody(l.composites[h],c,!0);return l},n.removeBodyAt=function(l,c){return l.bodies.splice(c,1),n.setModified(l,!0,!0,!1),l},n.addConstraint=function(l,c){return l.constraints.push(c),n.setModified(l,!0,!0,!1),l},n.removeConstraint=function(l,c,u){var d=r.indexOf(l.constraints,c);if(d!==-1&&n.removeConstraintAt(l,d),u)for(var h=0;h<l.composites.length;h++)n.removeConstraint(l.composites[h],c,!0);return l},n.removeConstraintAt=function(l,c){return l.constraints.splice(c,1),n.setModified(l,!0,!0,!1),l},n.clear=function(l,c,u){if(u)for(var d=0;d<l.composites.length;d++)n.clear(l.composites[d],c,!0);return c?l.bodies=l.bodies.filter(function(h){return h.isStatic}):l.bodies.length=0,l.constraints.length=0,l.composites.length=0,n.setModified(l,!0,!0,!1),l},n.allBodies=function(l){for(var c=[].concat(l.bodies),u=0;u<l.composites.length;u++)c=c.concat(n.allBodies(l.composites[u]));return c},n.allConstraints=function(l){for(var c=[].concat(l.constraints),u=0;u<l.composites.length;u++)c=c.concat(n.allConstraints(l.composites[u]));return c},n.allComposites=function(l){for(var c=[].concat(l.composites),u=0;u<l.composites.length;u++)c=c.concat(n.allComposites(l.composites[u]));return c},n.get=function(l,c,u){var d,h;switch(u){case"body":d=n.allBodies(l);break;case"constraint":d=n.allConstraints(l);break;case"composite":d=n.allComposites(l).concat(l);break}return d?(h=d.filter(function(f){return f.id.toString()===c.toString()}),h.length===0?null:h[0]):null},n.move=function(l,c,u){return n.remove(l,c),n.add(u,c),l},n.rebase=function(l){for(var c=n.allBodies(l).concat(n.allConstraints(l)).concat(n.allComposites(l)),u=0;u<c.length;u++)c[u].id=r.nextId();return n.setModified(l,!0,!0,!1),l},n.translate=function(l,c,u){for(var d=u?n.allBodies(l):l.bodies,h=0;h<d.length;h++)a.translate(d[h],c);return n.setModified(l,!0,!0,!1),l},n.rotate=function(l,c,u,d){for(var h=Math.cos(c),f=Math.sin(c),p=d?n.allBodies(l):l.bodies,g=0;g<p.length;g++){var v=p[g],y=v.position.x-u.x,m=v.position.y-u.y;a.setPosition(v,{x:u.x+(y*h-m*f),y:u.y+(y*f+m*h)}),a.rotate(v,c)}return n.setModified(l,!0,!0,!1),l},n.scale=function(l,c,u,d,h){for(var f=h?n.allBodies(l):l.bodies,p=0;p<f.length;p++){var g=f[p],v=g.position.x-d.x,y=g.position.y-d.y;a.setPosition(g,{x:d.x+v*c,y:d.y+y*u}),a.scale(g,c,u)}return n.setModified(l,!0,!0,!1),l},n.bounds=function(l){for(var c=n.allBodies(l),u=[],d=0;d<c.length;d+=1){var h=c[d];u.push(h.bounds.min,h.bounds.max)}return s.create(u)}})()},function(o,e,t){var n={};o.exports=n;var i=t(3),r=t(2),s=t(7),a=t(16),l=t(0),c=t(1),u=t(10);(function(){n._inertiaScale=4,n._nextCollidingGroupId=1,n._nextNonCollidingGroupId=-1,n._nextCategory=1,n.create=function(h){var f={id:l.nextId(),type:"body",label:"Body",parts:[],plugin:{},angle:0,vertices:i.fromPath("L 0 0 L 40 0 L 40 40 L 0 40"),position:{x:0,y:0},force:{x:0,y:0},torque:0,positionImpulse:{x:0,y:0},constraintImpulse:{x:0,y:0,angle:0},totalContacts:0,speed:0,angularSpeed:0,velocity:{x:0,y:0},angularVelocity:0,isSensor:!1,isStatic:!1,isSleeping:!1,motion:0,sleepThreshold:60,density:.001,restitution:0,friction:.1,frictionStatic:.5,frictionAir:.01,collisionFilter:{category:1,mask:4294967295,group:0},slop:.05,timeScale:1,render:{visible:!0,opacity:1,strokeStyle:null,fillStyle:null,lineWidth:null,sprite:{xScale:1,yScale:1,xOffset:0,yOffset:0}},events:null,bounds:null,chamfer:null,circleRadius:0,positionPrev:null,anglePrev:0,parent:null,axes:null,area:0,mass:0,inertia:0,_original:null},p=l.extend(f,h);return d(p,h),p},n.nextGroup=function(h){return h?n._nextNonCollidingGroupId--:n._nextCollidingGroupId++},n.nextCategory=function(){return n._nextCategory=n._nextCategory<<1,n._nextCategory};var d=function(h,f){f=f||{},n.set(h,{bounds:h.bounds||c.create(h.vertices),positionPrev:h.positionPrev||r.clone(h.position),anglePrev:h.anglePrev||h.angle,vertices:h.vertices,parts:h.parts||[h],isStatic:h.isStatic,isSleeping:h.isSleeping,parent:h.parent||h}),i.rotate(h.vertices,h.angle,h.position),u.rotate(h.axes,h.angle),c.update(h.bounds,h.vertices,h.velocity),n.set(h,{axes:f.axes||h.axes,area:f.area||h.area,mass:f.mass||h.mass,inertia:f.inertia||h.inertia});var p=h.isStatic?"#14151f":l.choose(["#f19648","#f5d259","#f55a3c","#063e7b","#ececd1"]),g=h.isStatic?"#555":"#ccc",v=h.isStatic&&h.render.fillStyle===null?1:0;h.render.fillStyle=h.render.fillStyle||p,h.render.strokeStyle=h.render.strokeStyle||g,h.render.lineWidth=h.render.lineWidth||v,h.render.sprite.xOffset+=-(h.bounds.min.x-h.position.x)/(h.bounds.max.x-h.bounds.min.x),h.render.sprite.yOffset+=-(h.bounds.min.y-h.position.y)/(h.bounds.max.y-h.bounds.min.y)};n.set=function(h,f,p){var g;typeof f=="string"&&(g=f,f={},f[g]=p);for(g in f)if(!!Object.prototype.hasOwnProperty.call(f,g))switch(p=f[g],g){case"isStatic":n.setStatic(h,p);break;case"isSleeping":s.set(h,p);break;case"mass":n.setMass(h,p);break;case"density":n.setDensity(h,p);break;case"inertia":n.setInertia(h,p);break;case"vertices":n.setVertices(h,p);break;case"position":n.setPosition(h,p);break;case"angle":n.setAngle(h,p);break;case"velocity":n.setVelocity(h,p);break;case"angularVelocity":n.setAngularVelocity(h,p);break;case"parts":n.setParts(h,p);break;case"centre":n.setCentre(h,p);break;default:h[g]=p}},n.setStatic=function(h,f){for(var p=0;p<h.parts.length;p++){var g=h.parts[p];g.isStatic=f,f?(g._original={restitution:g.restitution,friction:g.friction,mass:g.mass,inertia:g.inertia,density:g.density,inverseMass:g.inverseMass,inverseInertia:g.inverseInertia},g.restitution=0,g.friction=1,g.mass=g.inertia=g.density=1/0,g.inverseMass=g.inverseInertia=0,g.positionPrev.x=g.position.x,g.positionPrev.y=g.position.y,g.anglePrev=g.angle,g.angularVelocity=0,g.speed=0,g.angularSpeed=0,g.motion=0):g._original&&(g.restitution=g._original.restitution,g.friction=g._original.friction,g.mass=g._original.mass,g.inertia=g._original.inertia,g.density=g._original.density,g.inverseMass=g._original.inverseMass,g.inverseInertia=g._original.inverseInertia,g._original=null)}},n.setMass=function(h,f){var p=h.inertia/(h.mass/6);h.inertia=p*(f/6),h.inverseInertia=1/h.inertia,h.mass=f,h.inverseMass=1/h.mass,h.density=h.mass/h.area},n.setDensity=function(h,f){n.setMass(h,f*h.area),h.density=f},n.setInertia=function(h,f){h.inertia=f,h.inverseInertia=1/h.inertia},n.setVertices=function(h,f){f[0].body===h?h.vertices=f:h.vertices=i.create(f,h),h.axes=u.fromVertices(h.vertices),h.area=i.area(h.vertices),n.setMass(h,h.density*h.area);var p=i.centre(h.vertices);i.translate(h.vertices,p,-1),n.setInertia(h,n._inertiaScale*i.inertia(h.vertices,h.mass)),i.translate(h.vertices,h.position),c.update(h.bounds,h.vertices,h.velocity)},n.setParts=function(h,f,p){var g;for(f=f.slice(0),h.parts.length=0,h.parts.push(h),h.parent=h,g=0;g<f.length;g++){var v=f[g];v!==h&&(v.parent=h,h.parts.push(v))}if(h.parts.length!==1){if(p=typeof p!="undefined"?p:!0,p){var y=[];for(g=0;g<f.length;g++)y=y.concat(f[g].vertices);i.clockwiseSort(y);var m=i.hull(y),x=i.centre(m);n.setVertices(h,m),i.translate(h.vertices,x)}var _=n._totalProperties(h);h.area=_.area,h.parent=h,h.position.x=_.centre.x,h.position.y=_.centre.y,h.positionPrev.x=_.centre.x,h.positionPrev.y=_.centre.y,n.setMass(h,_.mass),n.setInertia(h,_.inertia),n.setPosition(h,_.centre)}},n.setCentre=function(h,f,p){p?(h.positionPrev.x+=f.x,h.positionPrev.y+=f.y,h.position.x+=f.x,h.position.y+=f.y):(h.positionPrev.x=f.x-(h.position.x-h.positionPrev.x),h.positionPrev.y=f.y-(h.position.y-h.positionPrev.y),h.position.x=f.x,h.position.y=f.y)},n.setPosition=function(h,f){var p=r.sub(f,h.position);h.positionPrev.x+=p.x,h.positionPrev.y+=p.y;for(var g=0;g<h.parts.length;g++){var v=h.parts[g];v.position.x+=p.x,v.position.y+=p.y,i.translate(v.vertices,p),c.update(v.bounds,v.vertices,h.velocity)}},n.setAngle=function(h,f){var p=f-h.angle;h.anglePrev+=p;for(var g=0;g<h.parts.length;g++){var v=h.parts[g];v.angle+=p,i.rotate(v.vertices,p,h.position),u.rotate(v.axes,p),c.update(v.bounds,v.vertices,h.velocity),g>0&&r.rotateAbout(v.position,p,h.position,v.position)}},n.setVelocity=function(h,f){h.positionPrev.x=h.position.x-f.x,h.positionPrev.y=h.position.y-f.y,h.velocity.x=f.x,h.velocity.y=f.y,h.speed=r.magnitude(h.velocity)},n.setAngularVelocity=function(h,f){h.anglePrev=h.angle-f,h.angularVelocity=f,h.angularSpeed=Math.abs(h.angularVelocity)},n.translate=function(h,f){n.setPosition(h,r.add(h.position,f))},n.rotate=function(h,f,p){if(!p)n.setAngle(h,h.angle+f);else{var g=Math.cos(f),v=Math.sin(f),y=h.position.x-p.x,m=h.position.y-p.y;n.setPosition(h,{x:p.x+(y*g-m*v),y:p.y+(y*v+m*g)}),n.setAngle(h,h.angle+f)}},n.scale=function(h,f,p,g){var v=0,y=0;g=g||h.position;for(var m=0;m<h.parts.length;m++){var x=h.parts[m];i.scale(x.vertices,f,p,g),x.axes=u.fromVertices(x.vertices),x.area=i.area(x.vertices),n.setMass(x,h.density*x.area),i.translate(x.vertices,{x:-x.position.x,y:-x.position.y}),n.setInertia(x,n._inertiaScale*i.inertia(x.vertices,x.mass)),i.translate(x.vertices,{x:x.position.x,y:x.position.y}),m>0&&(v+=x.area,y+=x.inertia),x.position.x=g.x+(x.position.x-g.x)*f,x.position.y=g.y+(x.position.y-g.y)*p,c.update(x.bounds,x.vertices,h.velocity)}h.parts.length>1&&(h.area=v,h.isStatic||(n.setMass(h,h.density*v),n.setInertia(h,y))),h.circleRadius&&(f===p?h.circleRadius*=f:h.circleRadius=null)},n.update=function(h,f,p,g){var v=Math.pow(f*p*h.timeScale,2),y=1-h.frictionAir*p*h.timeScale,m=h.position.x-h.positionPrev.x,x=h.position.y-h.positionPrev.y;h.velocity.x=m*y*g+h.force.x/h.mass*v,h.velocity.y=x*y*g+h.force.y/h.mass*v,h.positionPrev.x=h.position.x,h.positionPrev.y=h.position.y,h.position.x+=h.velocity.x,h.position.y+=h.velocity.y,h.angularVelocity=(h.angle-h.anglePrev)*y*g+h.torque/h.inertia*v,h.anglePrev=h.angle,h.angle+=h.angularVelocity,h.speed=r.magnitude(h.velocity),h.angularSpeed=Math.abs(h.angularVelocity);for(var _=0;_<h.parts.length;_++){var w=h.parts[_];i.translate(w.vertices,h.velocity),_>0&&(w.position.x+=h.velocity.x,w.position.y+=h.velocity.y),h.angularVelocity!==0&&(i.rotate(w.vertices,h.angularVelocity,h.position),u.rotate(w.axes,h.angularVelocity),_>0&&r.rotateAbout(w.position,h.angularVelocity,h.position,w.position)),c.update(w.bounds,w.vertices,h.velocity)}},n.applyForce=function(h,f,p){h.force.x+=p.x,h.force.y+=p.y;var g={x:f.x-h.position.x,y:f.y-h.position.y};h.torque+=g.x*p.y-g.y*p.x},n._totalProperties=function(h){for(var f={mass:0,area:0,inertia:0,centre:{x:0,y:0}},p=h.parts.length===1?0:1;p<h.parts.length;p++){var g=h.parts[p],v=g.mass!==1/0?g.mass:1;f.mass+=v,f.area+=g.area,f.inertia+=g.inertia,f.centre=r.add(f.centre,r.mult(g.position,v))}return f.centre=r.div(f.centre,f.mass),f}})()},function(o,e,t){var n={};o.exports=n;var i=t(4);(function(){n._motionWakeThreshold=.18,n._motionSleepThreshold=.08,n._minBias=.9,n.update=function(r,s){for(var a=s*s*s,l=0;l<r.length;l++){var c=r[l],u=c.speed*c.speed+c.angularSpeed*c.angularSpeed;if(c.force.x!==0||c.force.y!==0){n.set(c,!1);continue}var d=Math.min(c.motion,u),h=Math.max(c.motion,u);c.motion=n._minBias*d+(1-n._minBias)*h,c.sleepThreshold>0&&c.motion<n._motionSleepThreshold*a?(c.sleepCounter+=1,c.sleepCounter>=c.sleepThreshold&&n.set(c,!0)):c.sleepCounter>0&&(c.sleepCounter-=1)}},n.afterCollisions=function(r,s){for(var a=s*s*s,l=0;l<r.length;l++){var c=r[l];if(!!c.isActive){var u=c.collision,d=u.bodyA.parent,h=u.bodyB.parent;if(!(d.isSleeping&&h.isSleeping||d.isStatic||h.isStatic)&&(d.isSleeping||h.isSleeping)){var f=d.isSleeping&&!d.isStatic?d:h,p=f===d?h:d;!f.isStatic&&p.motion>n._motionWakeThreshold*a&&n.set(f,!1)}}}},n.set=function(r,s){var a=r.isSleeping;s?(r.isSleeping=!0,r.sleepCounter=r.sleepThreshold,r.positionImpulse.x=0,r.positionImpulse.y=0,r.positionPrev.x=r.position.x,r.positionPrev.y=r.position.y,r.anglePrev=r.angle,r.speed=0,r.angularSpeed=0,r.motion=0,a||i.trigger(r,"sleepStart")):(r.isSleeping=!1,r.sleepCounter=0,a&&i.trigger(r,"sleepEnd"))}})()},function(o,e,t){var n={};o.exports=n;var i=t(3),r=t(2),s=t(7),a=t(1),l=t(10),c=t(0);(function(){n._warming=.4,n._torqueDampen=1,n._minLength=1e-6,n.create=function(u){var d=u;d.bodyA&&!d.pointA&&(d.pointA={x:0,y:0}),d.bodyB&&!d.pointB&&(d.pointB={x:0,y:0});var h=d.bodyA?r.add(d.bodyA.position,d.pointA):d.pointA,f=d.bodyB?r.add(d.bodyB.position,d.pointB):d.pointB,p=r.magnitude(r.sub(h,f));d.length=typeof d.length!="undefined"?d.length:p,d.id=d.id||c.nextId(),d.label=d.label||"Constraint",d.type="constraint",d.stiffness=d.stiffness||(d.length>0?1:.7),d.damping=d.damping||0,d.angularStiffness=d.angularStiffness||0,d.angleA=d.bodyA?d.bodyA.angle:d.angleA,d.angleB=d.bodyB?d.bodyB.angle:d.angleB,d.plugin={};var g={visible:!0,lineWidth:2,strokeStyle:"#ffffff",type:"line",anchors:!0};return d.length===0&&d.stiffness>.1?(g.type="pin",g.anchors=!1):d.stiffness<.9&&(g.type="spring"),d.render=c.extend(g,d.render),d},n.preSolveAll=function(u){for(var d=0;d<u.length;d+=1){var h=u[d],f=h.constraintImpulse;h.isStatic||f.x===0&&f.y===0&&f.angle===0||(h.position.x+=f.x,h.position.y+=f.y,h.angle+=f.angle)}},n.solveAll=function(u,d){for(var h=0;h<u.length;h+=1){var f=u[h],p=!f.bodyA||f.bodyA&&f.bodyA.isStatic,g=!f.bodyB||f.bodyB&&f.bodyB.isStatic;(p||g)&&n.solve(u[h],d)}for(h=0;h<u.length;h+=1)f=u[h],p=!f.bodyA||f.bodyA&&f.bodyA.isStatic,g=!f.bodyB||f.bodyB&&f.bodyB.isStatic,!p&&!g&&n.solve(u[h],d)},n.solve=function(u,d){var h=u.bodyA,f=u.bodyB,p=u.pointA,g=u.pointB;if(!(!h&&!f)){h&&!h.isStatic&&(r.rotate(p,h.angle-u.angleA,p),u.angleA=h.angle),f&&!f.isStatic&&(r.rotate(g,f.angle-u.angleB,g),u.angleB=f.angle);var v=p,y=g;if(h&&(v=r.add(h.position,p)),f&&(y=r.add(f.position,g)),!(!v||!y)){var m=r.sub(v,y),x=r.magnitude(m);x<n._minLength&&(x=n._minLength);var _=(x-u.length)/x,w=u.stiffness<1?u.stiffness*d:u.stiffness,b=r.mult(m,_*w),M=(h?h.inverseMass:0)+(f?f.inverseMass:0),S=(h?h.inverseInertia:0)+(f?f.inverseInertia:0),E=M+S,A,L,B,R,D;if(u.damping){var P=r.create();B=r.div(m,x),D=r.sub(f&&r.sub(f.position,f.positionPrev)||P,h&&r.sub(h.position,h.positionPrev)||P),R=r.dot(B,D)}h&&!h.isStatic&&(L=h.inverseMass/M,h.constraintImpulse.x-=b.x*L,h.constraintImpulse.y-=b.y*L,h.position.x-=b.x*L,h.position.y-=b.y*L,u.damping&&(h.positionPrev.x-=u.damping*B.x*R*L,h.positionPrev.y-=u.damping*B.y*R*L),A=r.cross(p,b)/E*n._torqueDampen*h.inverseInertia*(1-u.angularStiffness),h.constraintImpulse.angle-=A,h.angle-=A),f&&!f.isStatic&&(L=f.inverseMass/M,f.constraintImpulse.x+=b.x*L,f.constraintImpulse.y+=b.y*L,f.position.x+=b.x*L,f.position.y+=b.y*L,u.damping&&(f.positionPrev.x+=u.damping*B.x*R*L,f.positionPrev.y+=u.damping*B.y*R*L),A=r.cross(g,b)/E*n._torqueDampen*f.inverseInertia*(1-u.angularStiffness),f.constraintImpulse.angle+=A,f.angle+=A)}}},n.postSolveAll=function(u){for(var d=0;d<u.length;d++){var h=u[d],f=h.constraintImpulse;if(!(h.isStatic||f.x===0&&f.y===0&&f.angle===0)){s.set(h,!1);for(var p=0;p<h.parts.length;p++){var g=h.parts[p];i.translate(g.vertices,f),p>0&&(g.position.x+=f.x,g.position.y+=f.y),f.angle!==0&&(i.rotate(g.vertices,f.angle,h.position),l.rotate(g.axes,f.angle),p>0&&r.rotateAbout(g.position,f.angle,h.position,g.position)),a.update(g.bounds,g.vertices,h.velocity)}f.angle*=n._warming,f.x*=n._warming,f.y*=n._warming}}},n.pointAWorld=function(u){return{x:(u.bodyA?u.bodyA.position.x:0)+u.pointA.x,y:(u.bodyA?u.bodyA.position.y:0)+u.pointA.y}},n.pointBWorld=function(u){return{x:(u.bodyB?u.bodyB.position.x:0)+u.pointB.x,y:(u.bodyB?u.bodyB.position.y:0)+u.pointB.y}}})()},function(o,e,t){var n={};o.exports=n;var i=t(17);(function(){n.create=function(r,s){var a=r.bodyA,l=r.bodyB,c=r.parentA,u=r.parentB,d={id:n.id(a,l),bodyA:a,bodyB:l,contacts:{},activeContacts:[],separation:0,isActive:!0,confirmedActive:!0,isSensor:a.isSensor||l.isSensor,timeCreated:s,timeUpdated:s,inverseMass:c.inverseMass+u.inverseMass,friction:Math.min(c.friction,u.friction),frictionStatic:Math.max(c.frictionStatic,u.frictionStatic),restitution:Math.max(c.restitution,u.restitution),slop:Math.max(c.slop,u.slop)};return n.update(d,r,s),d},n.update=function(r,s,a){var l=r.contacts,c=s.supports,u=r.activeContacts,d=s.parentA,h=s.parentB;if(r.collision=s,r.inverseMass=d.inverseMass+h.inverseMass,r.friction=Math.min(d.friction,h.friction),r.frictionStatic=Math.max(d.frictionStatic,h.frictionStatic),r.restitution=Math.max(d.restitution,h.restitution),r.slop=Math.max(d.slop,h.slop),u.length=0,s.collided){for(var f=0;f<c.length;f++){var p=c[f],g=i.id(p),v=l[g];v?u.push(v):u.push(l[g]=i.create(p))}r.separation=s.depth,n.setActive(r,!0,a)}else r.isActive===!0&&n.setActive(r,!1,a)},n.setActive=function(r,s,a){s?(r.isActive=!0,r.timeUpdated=a):(r.isActive=!1,r.activeContacts.length=0)},n.id=function(r,s){return r.id<s.id?"A"+r.id+"B"+s.id:"A"+s.id+"B"+r.id}})()},function(o,e,t){var n={};o.exports=n;var i=t(2),r=t(0);(function(){n.fromVertices=function(s){for(var a={},l=0;l<s.length;l++){var c=(l+1)%s.length,u=i.normalise({x:s[c].y-s[l].y,y:s[l].x-s[c].x}),d=u.y===0?1/0:u.x/u.y;d=d.toFixed(3).toString(),a[d]=u}return r.values(a)},n.rotate=function(s,a){if(a!==0)for(var l=Math.cos(a),c=Math.sin(a),u=0;u<s.length;u++){var d=s[u],h;h=d.x*l-d.y*c,d.y=d.x*c+d.y*l,d.x=h}}})()},function(o,e,t){var n={};o.exports=n;var i=t(3),r=t(0),s=t(6),a=t(1),l=t(2);(function(){n.rectangle=function(c,u,d,h,f){f=f||{};var p={label:"Rectangle Body",position:{x:c,y:u},vertices:i.fromPath("L 0 0 L "+d+" 0 L "+d+" "+h+" L 0 "+h)};if(f.chamfer){var g=f.chamfer;p.vertices=i.chamfer(p.vertices,g.radius,g.quality,g.qualityMin,g.qualityMax),delete f.chamfer}return s.create(r.extend({},p,f))},n.trapezoid=function(c,u,d,h,f,p){p=p||{},f*=.5;var g=(1-f*2)*d,v=d*f,y=v+g,m=y+v,x;f<.5?x="L 0 0 L "+v+" "+-h+" L "+y+" "+-h+" L "+m+" 0":x="L 0 0 L "+y+" "+-h+" L "+m+" 0";var _={label:"Trapezoid Body",position:{x:c,y:u},vertices:i.fromPath(x)};if(p.chamfer){var w=p.chamfer;_.vertices=i.chamfer(_.vertices,w.radius,w.quality,w.qualityMin,w.qualityMax),delete p.chamfer}return s.create(r.extend({},_,p))},n.circle=function(c,u,d,h,f){h=h||{};var p={label:"Circle Body",circleRadius:d};f=f||25;var g=Math.ceil(Math.max(10,Math.min(f,d)));return g%2==1&&(g+=1),n.polygon(c,u,g,d,r.extend({},p,h))},n.polygon=function(c,u,d,h,f){if(f=f||{},d<3)return n.circle(c,u,h,f);for(var p=2*Math.PI/d,g="",v=p*.5,y=0;y<d;y+=1){var m=v+y*p,x=Math.cos(m)*h,_=Math.sin(m)*h;g+="L "+x.toFixed(3)+" "+_.toFixed(3)+" "}var w={label:"Polygon Body",position:{x:c,y:u},vertices:i.fromPath(g)};if(f.chamfer){var b=f.chamfer;w.vertices=i.chamfer(w.vertices,b.radius,b.quality,b.qualityMin,b.qualityMax),delete f.chamfer}return s.create(r.extend({},w,f))},n.fromVertices=function(c,u,d,h,f,p,g,v){var y=r.getDecomp(),m,x,_,w,b,M,S,E,A,L,B;for(m=Boolean(y&&y.quickDecomp),h=h||{},_=[],f=typeof f!="undefined"?f:!1,p=typeof p!="undefined"?p:.01,g=typeof g!="undefined"?g:10,v=typeof v!="undefined"?v:.01,r.isArray(d[0])||(d=[d]),L=0;L<d.length;L+=1)if(M=d[L],w=i.isConvex(M),b=!w,b&&!m&&r.warnOnce("Bodies.fromVertices: Install the 'poly-decomp' library and use Common.setDecomp or provide 'decomp' as a global to decompose concave vertices."),w||!m)w?M=i.clockwiseSort(M):M=i.hull(M),_.push({position:{x:c,y:u},vertices:M});else{var R=M.map(function(O){return[O.x,O.y]});y.makeCCW(R),p!==!1&&y.removeCollinearPoints(R,p),v!==!1&&y.removeDuplicatePoints&&y.removeDuplicatePoints(R,v);var D=y.quickDecomp(R);for(S=0;S<D.length;S++){var P=D[S],I=P.map(function(O){return{x:O[0],y:O[1]}});g>0&&i.area(I)<g||_.push({position:i.centre(I),vertices:I})}}for(S=0;S<_.length;S++)_[S]=s.create(r.extend(_[S],h));if(f){var N=5;for(S=0;S<_.length;S++){var G=_[S];for(E=S+1;E<_.length;E++){var z=_[E];if(a.overlaps(G.bounds,z.bounds)){var se=G.vertices,ne=z.vertices;for(A=0;A<G.vertices.length;A++)for(B=0;B<z.vertices.length;B++){var Q=l.magnitudeSquared(l.sub(se[(A+1)%se.length],ne[B])),j=l.magnitudeSquared(l.sub(se[A],ne[(B+1)%ne.length]));Q<N&&j<N&&(se[A].isInternal=!0,ne[B].isInternal=!0)}}}}}return _.length>1?(x=s.create(r.extend({parts:_.slice(0)},h)),s.setPosition(x,{x:c,y:u}),x):_[0]}})()},function(o,e,t){var n={};o.exports=n;var i=t(0);(function(){n.create=function(r){var s={};return r||i.log("Mouse.create: element was undefined, defaulting to document.body","warn"),s.element=r||document.body,s.absolute={x:0,y:0},s.position={x:0,y:0},s.mousedownPosition={x:0,y:0},s.mouseupPosition={x:0,y:0},s.offset={x:0,y:0},s.scale={x:1,y:1},s.wheelDelta=0,s.button=-1,s.pixelRatio=parseInt(s.element.getAttribute("data-pixel-ratio"),10)||1,s.sourceEvents={mousemove:null,mousedown:null,mouseup:null,mousewheel:null},s.mousemove=function(a){var l=n._getRelativeMousePosition(a,s.element,s.pixelRatio),c=a.changedTouches;c&&(s.button=0,a.preventDefault()),s.absolute.x=l.x,s.absolute.y=l.y,s.position.x=s.absolute.x*s.scale.x+s.offset.x,s.position.y=s.absolute.y*s.scale.y+s.offset.y,s.sourceEvents.mousemove=a},s.mousedown=function(a){var l=n._getRelativeMousePosition(a,s.element,s.pixelRatio),c=a.changedTouches;c?(s.button=0,a.preventDefault()):s.button=a.button,s.absolute.x=l.x,s.absolute.y=l.y,s.position.x=s.absolute.x*s.scale.x+s.offset.x,s.position.y=s.absolute.y*s.scale.y+s.offset.y,s.mousedownPosition.x=s.position.x,s.mousedownPosition.y=s.position.y,s.sourceEvents.mousedown=a},s.mouseup=function(a){var l=n._getRelativeMousePosition(a,s.element,s.pixelRatio),c=a.changedTouches;c&&a.preventDefault(),s.button=-1,s.absolute.x=l.x,s.absolute.y=l.y,s.position.x=s.absolute.x*s.scale.x+s.offset.x,s.position.y=s.absolute.y*s.scale.y+s.offset.y,s.mouseupPosition.x=s.position.x,s.mouseupPosition.y=s.position.y,s.sourceEvents.mouseup=a},s.mousewheel=function(a){s.wheelDelta=Math.max(-1,Math.min(1,a.wheelDelta||-a.detail)),a.preventDefault()},n.setElement(s,s.element),s},n.setElement=function(r,s){r.element=s,s.addEventListener("mousemove",r.mousemove),s.addEventListener("mousedown",r.mousedown),s.addEventListener("mouseup",r.mouseup),s.addEventListener("mousewheel",r.mousewheel),s.addEventListener("DOMMouseScroll",r.mousewheel),s.addEventListener("touchmove",r.mousemove),s.addEventListener("touchstart",r.mousedown),s.addEventListener("touchend",r.mouseup)},n.clearSourceEvents=function(r){r.sourceEvents.mousemove=null,r.sourceEvents.mousedown=null,r.sourceEvents.mouseup=null,r.sourceEvents.mousewheel=null,r.wheelDelta=0},n.setOffset=function(r,s){r.offset.x=s.x,r.offset.y=s.y,r.position.x=r.absolute.x*r.scale.x+r.offset.x,r.position.y=r.absolute.y*r.scale.y+r.offset.y},n.setScale=function(r,s){r.scale.x=s.x,r.scale.y=s.y,r.position.x=r.absolute.x*r.scale.x+r.offset.x,r.position.y=r.absolute.y*r.scale.y+r.offset.y},n._getRelativeMousePosition=function(r,s,a){var l=s.getBoundingClientRect(),c=document.documentElement||document.body.parentNode||document.body,u=window.pageXOffset!==void 0?window.pageXOffset:c.scrollLeft,d=window.pageYOffset!==void 0?window.pageYOffset:c.scrollTop,h=r.changedTouches,f,p;return h?(f=h[0].pageX-l.left-u,p=h[0].pageY-l.top-d):(f=r.pageX-l.left-u,p=r.pageY-l.top-d),{x:f/(s.clientWidth/(s.width||s.clientWidth)*a),y:p/(s.clientHeight/(s.height||s.clientHeight)*a)}}})()},function(o,e,t){var n={};o.exports=n;var i=t(14),r=t(9),s=t(1);(function(){n.collisions=function(a,l){for(var c=[],u=l.pairs.table,d=0;d<a.length;d++){var h=a[d][0],f=a[d][1];if(!((h.isStatic||h.isSleeping)&&(f.isStatic||f.isSleeping))&&!!n.canCollide(h.collisionFilter,f.collisionFilter)&&s.overlaps(h.bounds,f.bounds))for(var p=h.parts.length>1?1:0;p<h.parts.length;p++)for(var g=h.parts[p],v=f.parts.length>1?1:0;v<f.parts.length;v++){var y=f.parts[v];if(g===h&&y===f||s.overlaps(g.bounds,y.bounds)){var m=r.id(g,y),x=u[m],_;x&&x.isActive?_=x.collision:_=null;var w=i.collides(g,y,_);w.collided&&c.push(w)}}}return c},n.canCollide=function(a,l){return a.group===l.group&&a.group!==0?a.group>0:(a.mask&l.category)!=0&&(l.mask&a.category)!=0}})()},function(o,e,t){var n={};o.exports=n;var i=t(3),r=t(2);(function(){n.collides=function(s,a,l){var c,u,d,h,f=!1;if(l){var p=s.parent,g=a.parent,v=p.speed*p.speed+p.angularSpeed*p.angularSpeed+g.speed*g.speed+g.angularSpeed*g.angularSpeed;f=l&&l.collided&&v<.2,h=l}else h={collided:!1,bodyA:s,bodyB:a};if(l&&f){var y=h.axisBody,m=y===s?a:s,x=[y.axes[l.axisNumber]];if(d=n._overlapAxes(y.vertices,m.vertices,x),h.reused=!0,d.overlap<=0)return h.collided=!1,h}else{if(c=n._overlapAxes(s.vertices,a.vertices,s.axes),c.overlap<=0||(u=n._overlapAxes(a.vertices,s.vertices,a.axes),u.overlap<=0))return h.collided=!1,h;c.overlap<u.overlap?(d=c,h.axisBody=s):(d=u,h.axisBody=a),h.axisNumber=d.axisNumber}h.bodyA=s.id<a.id?s:a,h.bodyB=s.id<a.id?a:s,h.collided=!0,h.depth=d.overlap,h.parentA=h.bodyA.parent,h.parentB=h.bodyB.parent,s=h.bodyA,a=h.bodyB,r.dot(d.axis,r.sub(a.position,s.position))<0?h.normal={x:d.axis.x,y:d.axis.y}:h.normal={x:-d.axis.x,y:-d.axis.y},h.tangent=r.perp(h.normal),h.penetration=h.penetration||{},h.penetration.x=h.normal.x*h.depth,h.penetration.y=h.normal.y*h.depth;var _=n._findSupports(s,a,h.normal),w=[];if(i.contains(s.vertices,_[0])&&w.push(_[0]),i.contains(s.vertices,_[1])&&w.push(_[1]),w.length<2){var b=n._findSupports(a,s,r.neg(h.normal));i.contains(a.vertices,b[0])&&w.push(b[0]),w.length<2&&i.contains(a.vertices,b[1])&&w.push(b[1])}return w.length<1&&(w=[_[0]]),h.supports=w,h},n._overlapAxes=function(s,a,l){for(var c=r._temp[0],u=r._temp[1],d={overlap:Number.MAX_VALUE},h,f,p=0;p<l.length;p++){if(f=l[p],n._projectToAxis(c,s,f),n._projectToAxis(u,a,f),h=Math.min(c.max-u.min,u.max-c.min),h<=0)return d.overlap=h,d;h<d.overlap&&(d.overlap=h,d.axis=f,d.axisNumber=p)}return d},n._projectToAxis=function(s,a,l){for(var c=r.dot(a[0],l),u=c,d=1;d<a.length;d+=1){var h=r.dot(a[d],l);h>u?u=h:h<c&&(c=h)}s.min=c,s.max=u},n._findSupports=function(s,a,l){for(var c=Number.MAX_VALUE,u=r._temp[0],d=a.vertices,h=s.position,f,p,g,v,y=0;y<d.length;y++)p=d[y],u.x=p.x-h.x,u.y=p.y-h.y,f=-r.dot(l,u),f<c&&(c=f,g=p);var m=g.index-1>=0?g.index-1:d.length-1;p=d[m],u.x=p.x-h.x,u.y=p.y-h.y,c=-r.dot(l,u),v=p;var x=(g.index+1)%d.length;return p=d[x],u.x=p.x-h.x,u.y=p.y-h.y,f=-r.dot(l,u),f<c&&(v=p),[g,v]}})()},function(o,e,t){var n={};o.exports=n;var i=t(0);(function(){n._registry={},n.register=function(r){if(n.isPlugin(r)||i.warn("Plugin.register:",n.toString(r),"does not implement all required fields."),r.name in n._registry){var s=n._registry[r.name],a=n.versionParse(r.version).number,l=n.versionParse(s.version).number;a>l?(i.warn("Plugin.register:",n.toString(s),"was upgraded to",n.toString(r)),n._registry[r.name]=r):a<l?i.warn("Plugin.register:",n.toString(s),"can not be downgraded to",n.toString(r)):r!==s&&i.warn("Plugin.register:",n.toString(r),"is already registered to different plugin object")}else n._registry[r.name]=r;return r},n.resolve=function(r){return n._registry[n.dependencyParse(r).name]},n.toString=function(r){return typeof r=="string"?r:(r.name||"anonymous")+"@"+(r.version||r.range||"0.0.0")},n.isPlugin=function(r){return r&&r.name&&r.version&&r.install},n.isUsed=function(r,s){return r.used.indexOf(s)>-1},n.isFor=function(r,s){var a=r.for&&n.dependencyParse(r.for);return!r.for||s.name===a.name&&n.versionSatisfies(s.version,a.range)},n.use=function(r,s){if(r.uses=(r.uses||[]).concat(s||[]),r.uses.length===0){i.warn("Plugin.use:",n.toString(r),"does not specify any dependencies to install.");return}for(var a=n.dependencies(r),l=i.topologicalSort(a),c=[],u=0;u<l.length;u+=1)if(l[u]!==r.name){var d=n.resolve(l[u]);if(!d){c.push("\u274C "+l[u]);continue}n.isUsed(r,d.name)||(n.isFor(d,r)||(i.warn("Plugin.use:",n.toString(d),"is for",d.for,"but installed on",n.toString(r)+"."),d._warned=!0),d.install?d.install(r):(i.warn("Plugin.use:",n.toString(d),"does not specify an install function."),d._warned=!0),d._warned?(c.push("\u{1F536} "+n.toString(d)),delete d._warned):c.push("\u2705 "+n.toString(d)),r.used.push(d.name))}c.length>0&&i.info(c.join("  "))},n.dependencies=function(r,s){var a=n.dependencyParse(r),l=a.name;if(s=s||{},!(l in s)){r=n.resolve(r)||r,s[l]=i.map(r.uses||[],function(u){n.isPlugin(u)&&n.register(u);var d=n.dependencyParse(u),h=n.resolve(u);return h&&!n.versionSatisfies(h.version,d.range)?(i.warn("Plugin.dependencies:",n.toString(h),"does not satisfy",n.toString(d),"used by",n.toString(a)+"."),h._warned=!0,r._warned=!0):h||(i.warn("Plugin.dependencies:",n.toString(u),"used by",n.toString(a),"could not be resolved."),r._warned=!0),d.name});for(var c=0;c<s[l].length;c+=1)n.dependencies(s[l][c],s);return s}},n.dependencyParse=function(r){if(i.isString(r)){var s=/^[\w-]+(@(\*|[\^~]?\d+\.\d+\.\d+(-[0-9A-Za-z-]+)?))?$/;return s.test(r)||i.warn("Plugin.dependencyParse:",r,"is not a valid dependency string."),{name:r.split("@")[0],range:r.split("@")[1]||"*"}}return{name:r.name,range:r.range||r.version}},n.versionParse=function(r){var s=/^(\*)|(\^|~|>=|>)?\s*((\d+)\.(\d+)\.(\d+))(-[0-9A-Za-z-]+)?$/;s.test(r)||i.warn("Plugin.versionParse:",r,"is not a valid version or range.");var a=s.exec(r),l=Number(a[4]),c=Number(a[5]),u=Number(a[6]);return{isRange:Boolean(a[1]||a[2]),version:a[3],range:r,operator:a[1]||a[2]||"",major:l,minor:c,patch:u,parts:[l,c,u],prerelease:a[7],number:l*1e8+c*1e4+u}},n.versionSatisfies=function(r,s){s=s||"*";var a=n.versionParse(s),l=n.versionParse(r);if(a.isRange){if(a.operator==="*"||r==="*")return!0;if(a.operator===">")return l.number>a.number;if(a.operator===">=")return l.number>=a.number;if(a.operator==="~")return l.major===a.major&&l.minor===a.minor&&l.patch>=a.patch;if(a.operator==="^")return a.major>0?l.major===a.major&&l.number>=a.number:a.minor>0?l.minor===a.minor&&l.patch>=a.patch:l.patch===a.patch}return r===s||r==="*"}})()},function(o,e,t){var n={};o.exports=n;var i=t(0),r=t(5),s=t(1),a=t(4),l=t(2),c=t(12);(function(){var u,d;typeof window!="undefined"&&(u=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame||function(m){window.setTimeout(function(){m(i.now())},1e3/60)},d=window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.msCancelAnimationFrame),n._goodFps=30,n._goodDelta=1e3/60,n.create=function(m){var x={controller:n,engine:null,element:null,canvas:null,mouse:null,frameRequestId:null,timing:{historySize:60,delta:0,deltaHistory:[],lastTime:0,lastTimestamp:0,lastElapsed:0,timestampElapsed:0,timestampElapsedHistory:[],engineDeltaHistory:[],engineElapsedHistory:[],elapsedHistory:[]},options:{width:800,height:600,pixelRatio:1,background:"#14151f",wireframeBackground:"#14151f",hasBounds:!!m.bounds,enabled:!0,wireframes:!0,showSleeping:!0,showDebug:!1,showStats:!1,showPerformance:!1,showBroadphase:!1,showBounds:!1,showVelocity:!1,showCollisions:!1,showSeparations:!1,showAxes:!1,showPositions:!1,showAngleIndicator:!1,showIds:!1,showVertexNumbers:!1,showConvexHulls:!1,showInternalEdges:!1,showMousePosition:!1}},_=i.extend(x,m);return _.canvas&&(_.canvas.width=_.options.width||_.canvas.width,_.canvas.height=_.options.height||_.canvas.height),_.mouse=m.mouse,_.engine=m.engine,_.canvas=_.canvas||p(_.options.width,_.options.height),_.context=_.canvas.getContext("2d"),_.textures={},_.bounds=_.bounds||{min:{x:0,y:0},max:{x:_.canvas.width,y:_.canvas.height}},_.options.pixelRatio!==1&&n.setPixelRatio(_,_.options.pixelRatio),i.isElement(_.element)?_.element.appendChild(_.canvas):_.canvas.parentNode||i.log("Render.create: options.element was undefined, render.canvas was created but not appended","warn"),_},n.run=function(m){(function x(_){m.frameRequestId=u(x),h(m,_),n.world(m,_),(m.options.showStats||m.options.showDebug)&&n.stats(m,m.context,_),(m.options.showPerformance||m.options.showDebug)&&n.performance(m,m.context,_)})()},n.stop=function(m){d(m.frameRequestId)},n.setPixelRatio=function(m,x){var _=m.options,w=m.canvas;x==="auto"&&(x=g(w)),_.pixelRatio=x,w.setAttribute("data-pixel-ratio",x),w.width=_.width*x,w.height=_.height*x,w.style.width=_.width+"px",w.style.height=_.height+"px"},n.lookAt=function(m,x,_,w){w=typeof w!="undefined"?w:!0,x=i.isArray(x)?x:[x],_=_||{x:0,y:0};for(var b={min:{x:1/0,y:1/0},max:{x:-1/0,y:-1/0}},M=0;M<x.length;M+=1){var S=x[M],E=S.bounds?S.bounds.min:S.min||S.position||S,A=S.bounds?S.bounds.max:S.max||S.position||S;E&&A&&(E.x<b.min.x&&(b.min.x=E.x),A.x>b.max.x&&(b.max.x=A.x),E.y<b.min.y&&(b.min.y=E.y),A.y>b.max.y&&(b.max.y=A.y))}var L=b.max.x-b.min.x+2*_.x,B=b.max.y-b.min.y+2*_.y,R=m.canvas.height,D=m.canvas.width,P=D/R,I=L/B,N=1,G=1;I>P?G=I/P:N=P/I,m.options.hasBounds=!0,m.bounds.min.x=b.min.x,m.bounds.max.x=b.min.x+L*N,m.bounds.min.y=b.min.y,m.bounds.max.y=b.min.y+B*G,w&&(m.bounds.min.x+=L*.5-L*N*.5,m.bounds.max.x+=L*.5-L*N*.5,m.bounds.min.y+=B*.5-B*G*.5,m.bounds.max.y+=B*.5-B*G*.5),m.bounds.min.x-=_.x,m.bounds.max.x-=_.x,m.bounds.min.y-=_.y,m.bounds.max.y-=_.y,m.mouse&&(c.setScale(m.mouse,{x:(m.bounds.max.x-m.bounds.min.x)/m.canvas.width,y:(m.bounds.max.y-m.bounds.min.y)/m.canvas.height}),c.setOffset(m.mouse,m.bounds.min))},n.startViewTransform=function(m){var x=m.bounds.max.x-m.bounds.min.x,_=m.bounds.max.y-m.bounds.min.y,w=x/m.options.width,b=_/m.options.height;m.context.setTransform(m.options.pixelRatio/w,0,0,m.options.pixelRatio/b,0,0),m.context.translate(-m.bounds.min.x,-m.bounds.min.y)},n.endViewTransform=function(m){m.context.setTransform(m.options.pixelRatio,0,0,m.options.pixelRatio,0,0)},n.world=function(m,x){var _=i.now(),w=m.engine,b=w.world,M=m.canvas,S=m.context,E=m.options,A=m.timing,L=r.allBodies(b),B=r.allConstraints(b),R=E.wireframes?E.wireframeBackground:E.background,D=[],P=[],I,N={timestamp:w.timing.timestamp};if(a.trigger(m,"beforeRender",N),m.currentBackground!==R&&y(m,R),S.globalCompositeOperation="source-in",S.fillStyle="transparent",S.fillRect(0,0,M.width,M.height),S.globalCompositeOperation="source-over",E.hasBounds){for(I=0;I<L.length;I++){var G=L[I];s.overlaps(G.bounds,m.bounds)&&D.push(G)}for(I=0;I<B.length;I++){var z=B[I],se=z.bodyA,ne=z.bodyB,Q=z.pointA,j=z.pointB;se&&(Q=l.add(se.position,z.pointA)),ne&&(j=l.add(ne.position,z.pointB)),!(!Q||!j)&&(s.contains(m.bounds,Q)||s.contains(m.bounds,j))&&P.push(z)}n.startViewTransform(m),m.mouse&&(c.setScale(m.mouse,{x:(m.bounds.max.x-m.bounds.min.x)/m.options.width,y:(m.bounds.max.y-m.bounds.min.y)/m.options.height}),c.setOffset(m.mouse,m.bounds.min))}else P=B,D=L,m.options.pixelRatio!==1&&m.context.setTransform(m.options.pixelRatio,0,0,m.options.pixelRatio,0,0);!E.wireframes||w.enableSleeping&&E.showSleeping?n.bodies(m,D,S):(E.showConvexHulls&&n.bodyConvexHulls(m,D,S),n.bodyWireframes(m,D,S)),E.showBounds&&n.bodyBounds(m,D,S),(E.showAxes||E.showAngleIndicator)&&n.bodyAxes(m,D,S),E.showPositions&&n.bodyPositions(m,D,S),E.showVelocity&&n.bodyVelocity(m,D,S),E.showIds&&n.bodyIds(m,D,S),E.showSeparations&&n.separations(m,w.pairs.list,S),E.showCollisions&&n.collisions(m,w.pairs.list,S),E.showVertexNumbers&&n.vertexNumbers(m,D,S),E.showMousePosition&&n.mousePosition(m,m.mouse,S),n.constraints(P,S),E.showBroadphase&&n.grid(m,w.grid,S),E.hasBounds&&n.endViewTransform(m),a.trigger(m,"afterRender",N),A.lastElapsed=i.now()-_},n.stats=function(m,x,_){for(var w=m.engine,b=w.world,M=r.allBodies(b),S=0,E=55,A=44,L=0,B=0,R=0;R<M.length;R+=1)S+=M[R].parts.length;var D={Part:S,Body:M.length,Cons:r.allConstraints(b).length,Comp:r.allComposites(b).length,Pair:w.pairs.list.length};x.fillStyle="#0e0f19",x.fillRect(L,B,E*5.5,A),x.font="12px Arial",x.textBaseline="top",x.textAlign="right";for(var P in D){var I=D[P];x.fillStyle="#aaa",x.fillText(P,L+E,B+8),x.fillStyle="#eee",x.fillText(I,L+E,B+26),L+=E}},n.performance=function(m,x){var _=m.engine,w=m.timing,b=w.deltaHistory,M=w.elapsedHistory,S=w.timestampElapsedHistory,E=w.engineDeltaHistory,A=w.engineElapsedHistory,L=_.timing.lastDelta,B=f(b),R=f(M),D=f(E),P=f(A),I=f(S),N=I/B||0,G=1e3/B||0,z=4,se=12,ne=60,Q=34,j=10,O=69;x.fillStyle="#0e0f19",x.fillRect(0,50,se*4+ne*5+22,Q),n.status(x,j,O,ne,z,b.length,Math.round(G)+" fps",G/n._goodFps,function(ee){return b[ee]/B-1}),n.status(x,j+se+ne,O,ne,z,E.length,L.toFixed(2)+" dt",n._goodDelta/L,function(ee){return E[ee]/D-1}),n.status(x,j+(se+ne)*2,O,ne,z,A.length,P.toFixed(2)+" ut",1-P/n._goodFps,function(ee){return A[ee]/P-1}),n.status(x,j+(se+ne)*3,O,ne,z,M.length,R.toFixed(2)+" rt",1-R/n._goodFps,function(ee){return M[ee]/R-1}),n.status(x,j+(se+ne)*4,O,ne,z,S.length,N.toFixed(2)+" x",N*N*N,function(ee){return(S[ee]/b[ee]/N||0)-1})},n.status=function(m,x,_,w,b,M,S,E,A){m.strokeStyle="#888",m.fillStyle="#444",m.lineWidth=1,m.fillRect(x,_+7,w,1),m.beginPath(),m.moveTo(x,_+7-b*i.clamp(.4*A(0),-2,2));for(var L=0;L<w;L+=1)m.lineTo(x+L,_+7-(L<M?b*i.clamp(.4*A(L),-2,2):0));m.stroke(),m.fillStyle="hsl("+i.clamp(25+95*E,0,120)+",100%,60%)",m.fillRect(x,_-7,4,4),m.font="12px Arial",m.textBaseline="middle",m.textAlign="right",m.fillStyle="#eee",m.fillText(S,x+w,_-5)},n.constraints=function(m,x){for(var _=x,w=0;w<m.length;w++){var b=m[w];if(!(!b.render.visible||!b.pointA||!b.pointB)){var M=b.bodyA,S=b.bodyB,E,A;if(M?E=l.add(M.position,b.pointA):E=b.pointA,b.render.type==="pin")_.beginPath(),_.arc(E.x,E.y,3,0,2*Math.PI),_.closePath();else{if(S?A=l.add(S.position,b.pointB):A=b.pointB,_.beginPath(),_.moveTo(E.x,E.y),b.render.type==="spring")for(var L=l.sub(A,E),B=l.perp(l.normalise(L)),R=Math.ceil(i.clamp(b.length/5,12,20)),D,P=1;P<R;P+=1)D=P%2==0?1:-1,_.lineTo(E.x+L.x*(P/R)+B.x*D*4,E.y+L.y*(P/R)+B.y*D*4);_.lineTo(A.x,A.y)}b.render.lineWidth&&(_.lineWidth=b.render.lineWidth,_.strokeStyle=b.render.strokeStyle,_.stroke()),b.render.anchors&&(_.fillStyle=b.render.strokeStyle,_.beginPath(),_.arc(E.x,E.y,3,0,2*Math.PI),_.arc(A.x,A.y,3,0,2*Math.PI),_.closePath(),_.fill())}}},n.bodies=function(m,x,_){var w=_,b=m.engine,M=m.options,S=M.showInternalEdges||!M.wireframes,E,A,L,B;for(L=0;L<x.length;L++)if(E=x[L],!!E.render.visible){for(B=E.parts.length>1?1:0;B<E.parts.length;B++)if(A=E.parts[B],!!A.render.visible){if(M.showSleeping&&E.isSleeping?w.globalAlpha=.5*A.render.opacity:A.render.opacity!==1&&(w.globalAlpha=A.render.opacity),A.render.sprite&&A.render.sprite.texture&&!M.wireframes){var R=A.render.sprite,D=v(m,R.texture);w.translate(A.position.x,A.position.y),w.rotate(A.angle),w.drawImage(D,D.width*-R.xOffset*R.xScale,D.height*-R.yOffset*R.yScale,D.width*R.xScale,D.height*R.yScale),w.rotate(-A.angle),w.translate(-A.position.x,-A.position.y)}else{if(A.circleRadius)w.beginPath(),w.arc(A.position.x,A.position.y,A.circleRadius,0,2*Math.PI);else{w.beginPath(),w.moveTo(A.vertices[0].x,A.vertices[0].y);for(var P=1;P<A.vertices.length;P++)!A.vertices[P-1].isInternal||S?w.lineTo(A.vertices[P].x,A.vertices[P].y):w.moveTo(A.vertices[P].x,A.vertices[P].y),A.vertices[P].isInternal&&!S&&w.moveTo(A.vertices[(P+1)%A.vertices.length].x,A.vertices[(P+1)%A.vertices.length].y);w.lineTo(A.vertices[0].x,A.vertices[0].y),w.closePath()}M.wireframes?(w.lineWidth=1,w.strokeStyle="#bbb",w.stroke()):(w.fillStyle=A.render.fillStyle,A.render.lineWidth&&(w.lineWidth=A.render.lineWidth,w.strokeStyle=A.render.strokeStyle,w.stroke()),w.fill())}w.globalAlpha=1}}},n.bodyWireframes=function(m,x,_){var w=_,b=m.options.showInternalEdges,M,S,E,A,L;for(w.beginPath(),E=0;E<x.length;E++)if(M=x[E],!!M.render.visible)for(L=M.parts.length>1?1:0;L<M.parts.length;L++){for(S=M.parts[L],w.moveTo(S.vertices[0].x,S.vertices[0].y),A=1;A<S.vertices.length;A++)!S.vertices[A-1].isInternal||b?w.lineTo(S.vertices[A].x,S.vertices[A].y):w.moveTo(S.vertices[A].x,S.vertices[A].y),S.vertices[A].isInternal&&!b&&w.moveTo(S.vertices[(A+1)%S.vertices.length].x,S.vertices[(A+1)%S.vertices.length].y);w.lineTo(S.vertices[0].x,S.vertices[0].y)}w.lineWidth=1,w.strokeStyle="#bbb",w.stroke()},n.bodyConvexHulls=function(m,x,_){var w=_,b,M,S,E,A;for(w.beginPath(),S=0;S<x.length;S++)if(b=x[S],!(!b.render.visible||b.parts.length===1)){for(w.moveTo(b.vertices[0].x,b.vertices[0].y),E=1;E<b.vertices.length;E++)w.lineTo(b.vertices[E].x,b.vertices[E].y);w.lineTo(b.vertices[0].x,b.vertices[0].y)}w.lineWidth=1,w.strokeStyle="rgba(255,255,255,0.2)",w.stroke()},n.vertexNumbers=function(m,x,_){var w=_,b,M,S;for(b=0;b<x.length;b++){var E=x[b].parts;for(S=E.length>1?1:0;S<E.length;S++){var A=E[S];for(M=0;M<A.vertices.length;M++)w.fillStyle="rgba(255,255,255,0.2)",w.fillText(b+"_"+M,A.position.x+(A.vertices[M].x-A.position.x)*.8,A.position.y+(A.vertices[M].y-A.position.y)*.8)}}},n.mousePosition=function(m,x,_){var w=_;w.fillStyle="rgba(255,255,255,0.8)",w.fillText(x.position.x+"  "+x.position.y,x.position.x+5,x.position.y-5)},n.bodyBounds=function(m,x,_){var w=_,b=m.engine,M=m.options;w.beginPath();for(var S=0;S<x.length;S++){var E=x[S];if(E.render.visible)for(var A=x[S].parts,L=A.length>1?1:0;L<A.length;L++){var B=A[L];w.rect(B.bounds.min.x,B.bounds.min.y,B.bounds.max.x-B.bounds.min.x,B.bounds.max.y-B.bounds.min.y)}}M.wireframes?w.strokeStyle="rgba(255,255,255,0.08)":w.strokeStyle="rgba(0,0,0,0.1)",w.lineWidth=1,w.stroke()},n.bodyAxes=function(m,x,_){var w=_,b=m.engine,M=m.options,S,E,A,L;for(w.beginPath(),E=0;E<x.length;E++){var B=x[E],R=B.parts;if(!!B.render.visible)if(M.showAxes)for(A=R.length>1?1:0;A<R.length;A++)for(S=R[A],L=0;L<S.axes.length;L++){var D=S.axes[L];w.moveTo(S.position.x,S.position.y),w.lineTo(S.position.x+D.x*20,S.position.y+D.y*20)}else for(A=R.length>1?1:0;A<R.length;A++)for(S=R[A],L=0;L<S.axes.length;L++)w.moveTo(S.position.x,S.position.y),w.lineTo((S.vertices[0].x+S.vertices[S.vertices.length-1].x)/2,(S.vertices[0].y+S.vertices[S.vertices.length-1].y)/2)}M.wireframes?(w.strokeStyle="indianred",w.lineWidth=1):(w.strokeStyle="rgba(255, 255, 255, 0.4)",w.globalCompositeOperation="overlay",w.lineWidth=2),w.stroke(),w.globalCompositeOperation="source-over"},n.bodyPositions=function(m,x,_){var w=_,b=m.engine,M=m.options,S,E,A,L;for(w.beginPath(),A=0;A<x.length;A++)if(S=x[A],!!S.render.visible)for(L=0;L<S.parts.length;L++)E=S.parts[L],w.arc(E.position.x,E.position.y,3,0,2*Math.PI,!1),w.closePath();for(M.wireframes?w.fillStyle="indianred":w.fillStyle="rgba(0,0,0,0.5)",w.fill(),w.beginPath(),A=0;A<x.length;A++)S=x[A],S.render.visible&&(w.arc(S.positionPrev.x,S.positionPrev.y,2,0,2*Math.PI,!1),w.closePath());w.fillStyle="rgba(255,165,0,0.8)",w.fill()},n.bodyVelocity=function(m,x,_){var w=_;w.beginPath();for(var b=0;b<x.length;b++){var M=x[b];!M.render.visible||(w.moveTo(M.position.x,M.position.y),w.lineTo(M.position.x+(M.position.x-M.positionPrev.x)*2,M.position.y+(M.position.y-M.positionPrev.y)*2))}w.lineWidth=3,w.strokeStyle="cornflowerblue",w.stroke()},n.bodyIds=function(m,x,_){var w=_,b,M;for(b=0;b<x.length;b++)if(!!x[b].render.visible){var S=x[b].parts;for(M=S.length>1?1:0;M<S.length;M++){var E=S[M];w.font="12px Arial",w.fillStyle="rgba(255,255,255,0.5)",w.fillText(E.id,E.position.x+10,E.position.y-10)}}},n.collisions=function(m,x,_){var w=_,b=m.options,M,S,E,A,L,B,R;for(w.beginPath(),B=0;B<x.length;B++)if(M=x[B],!!M.isActive)for(S=M.collision,R=0;R<M.activeContacts.length;R++){var D=M.activeContacts[R],P=D.vertex;w.rect(P.x-1.5,P.y-1.5,3.5,3.5)}for(b.wireframes?w.fillStyle="rgba(255,255,255,0.7)":w.fillStyle="orange",w.fill(),w.beginPath(),B=0;B<x.length;B++)if(M=x[B],!!M.isActive&&(S=M.collision,M.activeContacts.length>0)){var I=M.activeContacts[0].vertex.x,N=M.activeContacts[0].vertex.y;M.activeContacts.length===2&&(I=(M.activeContacts[0].vertex.x+M.activeContacts[1].vertex.x)/2,N=(M.activeContacts[0].vertex.y+M.activeContacts[1].vertex.y)/2),S.bodyB===S.supports[0].body||S.bodyA.isStatic===!0?w.moveTo(I-S.normal.x*8,N-S.normal.y*8):w.moveTo(I+S.normal.x*8,N+S.normal.y*8),w.lineTo(I,N)}b.wireframes?w.strokeStyle="rgba(255,165,0,0.7)":w.strokeStyle="orange",w.lineWidth=1,w.stroke()},n.separations=function(m,x,_){var w=_,b=m.options,M,S,E,A,L,B,R;for(w.beginPath(),B=0;B<x.length;B++)if(M=x[B],!!M.isActive){S=M.collision,A=S.bodyA,L=S.bodyB;var D=1;!L.isStatic&&!A.isStatic&&(D=.5),L.isStatic&&(D=0),w.moveTo(L.position.x,L.position.y),w.lineTo(L.position.x-S.penetration.x*D,L.position.y-S.penetration.y*D),D=1,!L.isStatic&&!A.isStatic&&(D=.5),A.isStatic&&(D=0),w.moveTo(A.position.x,A.position.y),w.lineTo(A.position.x+S.penetration.x*D,A.position.y+S.penetration.y*D)}b.wireframes?w.strokeStyle="rgba(255,165,0,0.5)":w.strokeStyle="orange",w.stroke()},n.grid=function(m,x,_){var w=_,b=m.options;b.wireframes?w.strokeStyle="rgba(255,180,0,0.1)":w.strokeStyle="rgba(255,180,0,0.5)",w.beginPath();for(var M=i.keys(x.buckets),S=0;S<M.length;S++){var E=M[S];if(!(x.buckets[E].length<2)){var A=E.split(/C|R/);w.rect(.5+parseInt(A[1],10)*x.bucketWidth,.5+parseInt(A[2],10)*x.bucketHeight,x.bucketWidth,x.bucketHeight)}}w.lineWidth=1,w.stroke()},n.inspector=function(m,x){var _=m.engine,w=m.selected,b=m.render,M=b.options,S;if(M.hasBounds){var E=b.bounds.max.x-b.bounds.min.x,A=b.bounds.max.y-b.bounds.min.y,L=E/b.options.width,B=A/b.options.height;x.scale(1/L,1/B),x.translate(-b.bounds.min.x,-b.bounds.min.y)}for(var R=0;R<w.length;R++){var D=w[R].data;switch(x.translate(.5,.5),x.lineWidth=1,x.strokeStyle="rgba(255,165,0,0.9)",x.setLineDash([1,2]),D.type){case"body":S=D.bounds,x.beginPath(),x.rect(Math.floor(S.min.x-3),Math.floor(S.min.y-3),Math.floor(S.max.x-S.min.x+6),Math.floor(S.max.y-S.min.y+6)),x.closePath(),x.stroke();break;case"constraint":var P=D.pointA;D.bodyA&&(P=D.pointB),x.beginPath(),x.arc(P.x,P.y,10,0,2*Math.PI),x.closePath(),x.stroke();break}x.setLineDash([]),x.translate(-.5,-.5)}m.selectStart!==null&&(x.translate(.5,.5),x.lineWidth=1,x.strokeStyle="rgba(255,165,0,0.6)",x.fillStyle="rgba(255,165,0,0.1)",S=m.selectBounds,x.beginPath(),x.rect(Math.floor(S.min.x),Math.floor(S.min.y),Math.floor(S.max.x-S.min.x),Math.floor(S.max.y-S.min.y)),x.closePath(),x.stroke(),x.fill(),x.translate(-.5,-.5)),M.hasBounds&&x.setTransform(1,0,0,1,0,0)};var h=function(m,x){var _=m.engine,w=m.timing,b=w.historySize,M=_.timing.timestamp;w.delta=x-w.lastTime||n._goodDelta,w.lastTime=x,w.timestampElapsed=M-w.lastTimestamp||0,w.lastTimestamp=M,w.deltaHistory.unshift(w.delta),w.deltaHistory.length=Math.min(w.deltaHistory.length,b),w.engineDeltaHistory.unshift(_.timing.lastDelta),w.engineDeltaHistory.length=Math.min(w.engineDeltaHistory.length,b),w.timestampElapsedHistory.unshift(w.timestampElapsed),w.timestampElapsedHistory.length=Math.min(w.timestampElapsedHistory.length,b),w.engineElapsedHistory.unshift(_.timing.lastElapsed),w.engineElapsedHistory.length=Math.min(w.engineElapsedHistory.length,b),w.elapsedHistory.unshift(w.lastElapsed),w.elapsedHistory.length=Math.min(w.elapsedHistory.length,b)},f=function(m){for(var x=0,_=0;_<m.length;_+=1)x+=m[_];return x/m.length||0},p=function(m,x){var _=document.createElement("canvas");return _.width=m,_.height=x,_.oncontextmenu=function(){return!1},_.onselectstart=function(){return!1},_},g=function(m){var x=m.getContext("2d"),_=window.devicePixelRatio||1,w=x.webkitBackingStorePixelRatio||x.mozBackingStorePixelRatio||x.msBackingStorePixelRatio||x.oBackingStorePixelRatio||x.backingStorePixelRatio||1;return _/w},v=function(m,x){var _=m.textures[x];return _||(_=m.textures[x]=new Image,_.src=x,_)},y=function(m,x){var _=x;/(jpg|gif|png)$/.test(x)&&(_="url("+x+")"),m.canvas.style.background=_,m.canvas.style.backgroundSize="contain",m.currentBackground=x}})()},function(o,e){var t={};o.exports=t,function(){t.create=function(n){return{id:t.id(n),vertex:n,normalImpulse:0,tangentImpulse:0}},t.id=function(n){return n.body.id+"_"+n.index}}()},function(o,e,t){var n={};o.exports=n;var i=t(7),r=t(19),s=t(13),a=t(20),l=t(21),c=t(4),u=t(5),d=t(8),h=t(0),f=t(6);(function(){n.create=function(p){p=p||{};var g={positionIterations:6,velocityIterations:4,constraintIterations:2,enableSleeping:!1,events:[],plugin:{},grid:null,gravity:{x:0,y:1,scale:.001},timing:{timestamp:0,timeScale:1,lastDelta:0,lastElapsed:0}},v=h.extend(g,p);return v.world=p.world||u.create({label:"World"}),v.grid=l.create(p.grid||p.broadphase),v.pairs=a.create(),v.world.gravity=v.gravity,v.broadphase=v.grid,v.metrics={},v},n.update=function(p,g,v){var y=h.now();g=g||1e3/60,v=v||1;var m=p.world,x=p.timing,_=p.grid,w=[],b;x.timestamp+=g*x.timeScale,x.lastDelta=g*x.timeScale;var M={timestamp:x.timestamp};c.trigger(p,"beforeUpdate",M);var S=u.allBodies(m),E=u.allConstraints(m);for(p.enableSleeping&&i.update(S,x.timeScale),n._bodiesApplyGravity(S,p.gravity),n._bodiesUpdate(S,g,x.timeScale,v,m.bounds),d.preSolveAll(S),b=0;b<p.constraintIterations;b++)d.solveAll(E,x.timeScale);d.postSolveAll(S),m.isModified&&l.clear(_),l.update(_,S,p,m.isModified),w=_.pairsList,m.isModified&&u.setModified(m,!1,!1,!0);var A=s.collisions(w,p),L=p.pairs,B=x.timestamp;for(a.update(L,A,B),a.removeOld(L,B),p.enableSleeping&&i.afterCollisions(L.list,x.timeScale),L.collisionStart.length>0&&c.trigger(p,"collisionStart",{pairs:L.collisionStart}),r.preSolvePosition(L.list),b=0;b<p.positionIterations;b++)r.solvePosition(L.list,x.timeScale);for(r.postSolvePosition(S),d.preSolveAll(S),b=0;b<p.constraintIterations;b++)d.solveAll(E,x.timeScale);for(d.postSolveAll(S),r.preSolveVelocity(L.list),b=0;b<p.velocityIterations;b++)r.solveVelocity(L.list,x.timeScale);return L.collisionActive.length>0&&c.trigger(p,"collisionActive",{pairs:L.collisionActive}),L.collisionEnd.length>0&&c.trigger(p,"collisionEnd",{pairs:L.collisionEnd}),n._bodiesClearForces(S),c.trigger(p,"afterUpdate",M),p.timing.lastElapsed=h.now()-y,p},n.merge=function(p,g){if(h.extend(p,g),g.world){p.world=g.world,n.clear(p);for(var v=u.allBodies(p.world),y=0;y<v.length;y++){var m=v[y];i.set(m,!1),m.id=h.nextId()}}},n.clear=function(p){var g=p.world,v=u.allBodies(g);a.clear(p.pairs),l.clear(p.grid),l.update(p.grid,v,p,!0)},n._bodiesClearForces=function(p){for(var g=0;g<p.length;g++){var v=p[g];v.force.x=0,v.force.y=0,v.torque=0}},n._bodiesApplyGravity=function(p,g){var v=typeof g.scale!="undefined"?g.scale:.001;if(!(g.x===0&&g.y===0||v===0))for(var y=0;y<p.length;y++){var m=p[y];m.isStatic||m.isSleeping||(m.force.y+=m.mass*g.y*v,m.force.x+=m.mass*g.x*v)}},n._bodiesUpdate=function(p,g,v,y,m){for(var x=0;x<p.length;x++){var _=p[x];_.isStatic||_.isSleeping||f.update(_,g,v,y)}}})()},function(o,e,t){var n={};o.exports=n;var i=t(3),r=t(2),s=t(0),a=t(1);(function(){n._restingThresh=4,n._restingThreshTangent=6,n._positionDampen=.9,n._positionWarming=.8,n._frictionNormalMultiplier=5,n.preSolvePosition=function(l){var c,u,d;for(c=0;c<l.length;c++)u=l[c],!!u.isActive&&(d=u.activeContacts.length,u.collision.parentA.totalContacts+=d,u.collision.parentB.totalContacts+=d)},n.solvePosition=function(l,c){var u,d,h,f,p,g,v,y,m,x={},_=r._temp[0],w=r._temp[1],b=r._temp[2],M=r._temp[3];for(u=0;u<l.length;u++)d=l[u],!(!d.isActive||d.isSensor)&&(h=d.collision,f=h.parentA,p=h.parentB,g=h.normal,v=r.sub(r.add(p.positionImpulse,p.position,_),r.add(f.positionImpulse,r.sub(p.position,h.penetration,w),b),M),d.separation=r.dot(g,v));for(u=0;u<l.length;u++)d=l[u],!(!d.isActive||d.isSensor)&&(h=d.collision,f=h.parentA,p=h.parentB,g=h.normal,m=(d.separation-d.slop)*c,(f.isStatic||p.isStatic)&&(m*=2),f.isStatic||f.isSleeping||(y=n._positionDampen/f.totalContacts,f.positionImpulse.x+=g.x*m*y,f.positionImpulse.y+=g.y*m*y),p.isStatic||p.isSleeping||(y=n._positionDampen/p.totalContacts,p.positionImpulse.x-=g.x*m*y,p.positionImpulse.y-=g.y*m*y))},n.postSolvePosition=function(l){for(var c=0;c<l.length;c++){var u=l[c];if(u.totalContacts=0,u.positionImpulse.x!==0||u.positionImpulse.y!==0){for(var d=0;d<u.parts.length;d++){var h=u.parts[d];i.translate(h.vertices,u.positionImpulse),a.update(h.bounds,h.vertices,u.velocity),h.position.x+=u.positionImpulse.x,h.position.y+=u.positionImpulse.y}u.positionPrev.x+=u.positionImpulse.x,u.positionPrev.y+=u.positionImpulse.y,r.dot(u.positionImpulse,u.velocity)<0?(u.positionImpulse.x=0,u.positionImpulse.y=0):(u.positionImpulse.x*=n._positionWarming,u.positionImpulse.y*=n._positionWarming)}}},n.preSolveVelocity=function(l){var c,u,d,h,f,p,g,v,y,m,x,_,w,b,M=r._temp[0],S=r._temp[1];for(c=0;c<l.length;c++)if(d=l[c],!(!d.isActive||d.isSensor))for(h=d.activeContacts,f=d.collision,p=f.parentA,g=f.parentB,v=f.normal,y=f.tangent,u=0;u<h.length;u++)m=h[u],x=m.vertex,_=m.normalImpulse,w=m.tangentImpulse,(_!==0||w!==0)&&(M.x=v.x*_+y.x*w,M.y=v.y*_+y.y*w,p.isStatic||p.isSleeping||(b=r.sub(x,p.position,S),p.positionPrev.x+=M.x*p.inverseMass,p.positionPrev.y+=M.y*p.inverseMass,p.anglePrev+=r.cross(b,M)*p.inverseInertia),g.isStatic||g.isSleeping||(b=r.sub(x,g.position,S),g.positionPrev.x-=M.x*g.inverseMass,g.positionPrev.y-=M.y*g.inverseMass,g.anglePrev-=r.cross(b,M)*g.inverseInertia))},n.solveVelocity=function(l,c){for(var u=c*c,d=r._temp[0],h=r._temp[1],f=r._temp[2],p=r._temp[3],g=r._temp[4],v=r._temp[5],y=0;y<l.length;y++){var m=l[y];if(!(!m.isActive||m.isSensor)){var x=m.collision,_=x.parentA,w=x.parentB,b=x.normal,M=x.tangent,S=m.activeContacts,E=1/S.length;_.velocity.x=_.position.x-_.positionPrev.x,_.velocity.y=_.position.y-_.positionPrev.y,w.velocity.x=w.position.x-w.positionPrev.x,w.velocity.y=w.position.y-w.positionPrev.y,_.angularVelocity=_.angle-_.anglePrev,w.angularVelocity=w.angle-w.anglePrev;for(var A=0;A<S.length;A++){var L=S[A],B=L.vertex,R=r.sub(B,_.position,h),D=r.sub(B,w.position,f),P=r.add(_.velocity,r.mult(r.perp(R),_.angularVelocity),p),I=r.add(w.velocity,r.mult(r.perp(D),w.angularVelocity),g),N=r.sub(P,I,v),G=r.dot(b,N),z=r.dot(M,N),se=Math.abs(z),ne=s.sign(z),Q=(1+m.restitution)*G,j=s.clamp(m.separation+G,0,1)*n._frictionNormalMultiplier,O=z,ee=1/0;se>m.friction*m.frictionStatic*j*u&&(ee=se,O=s.clamp(m.friction*ne*u,-ee,ee));var V=r.cross(R,b),ie=r.cross(D,b),ue=E/(_.inverseMass+w.inverseMass+_.inverseInertia*V*V+w.inverseInertia*ie*ie);if(Q*=ue,O*=ue,G<0&&G*G>n._restingThresh*u)L.normalImpulse=0;else{var ye=L.normalImpulse;L.normalImpulse=Math.min(L.normalImpulse+Q,0),Q=L.normalImpulse-ye}if(z*z>n._restingThreshTangent*u)L.tangentImpulse=0;else{var pe=L.tangentImpulse;L.tangentImpulse=s.clamp(L.tangentImpulse+O,-ee,ee),O=L.tangentImpulse-pe}d.x=b.x*Q+M.x*O,d.y=b.y*Q+M.y*O,_.isStatic||_.isSleeping||(_.positionPrev.x+=d.x*_.inverseMass,_.positionPrev.y+=d.y*_.inverseMass,_.anglePrev+=r.cross(R,d)*_.inverseInertia),w.isStatic||w.isSleeping||(w.positionPrev.x-=d.x*w.inverseMass,w.positionPrev.y-=d.y*w.inverseMass,w.anglePrev-=r.cross(D,d)*w.inverseInertia)}}}}})()},function(o,e,t){var n={};o.exports=n;var i=t(9),r=t(0);(function(){n._pairMaxIdleLife=1e3,n.create=function(s){return r.extend({table:{},list:[],collisionStart:[],collisionActive:[],collisionEnd:[]},s)},n.update=function(s,a,l){var c=s.list,u=s.table,d=s.collisionStart,h=s.collisionEnd,f=s.collisionActive,p,g,v,y;for(d.length=0,h.length=0,f.length=0,y=0;y<c.length;y++)c[y].confirmedActive=!1;for(y=0;y<a.length;y++)p=a[y],p.collided&&(g=i.id(p.bodyA,p.bodyB),v=u[g],v?(v.isActive?f.push(v):d.push(v),i.update(v,p,l),v.confirmedActive=!0):(v=i.create(p,l),u[g]=v,d.push(v),c.push(v)));for(y=0;y<c.length;y++)v=c[y],v.isActive&&!v.confirmedActive&&(i.setActive(v,!1,l),h.push(v))},n.removeOld=function(s,a){var l=s.list,c=s.table,u=[],d,h,f,p;for(p=0;p<l.length;p++){if(d=l[p],h=d.collision,h.bodyA.isSleeping||h.bodyB.isSleeping){d.timeUpdated=a;continue}a-d.timeUpdated>n._pairMaxIdleLife&&u.push(p)}for(p=0;p<u.length;p++)f=u[p]-p,d=l[f],delete c[d.id],l.splice(f,1)},n.clear=function(s){return s.table={},s.list.length=0,s.collisionStart.length=0,s.collisionActive.length=0,s.collisionEnd.length=0,s}})()},function(o,e,t){var n={};o.exports=n;var i=t(9),r=t(0);(function(){n.create=function(s){var a={buckets:{},pairs:{},pairsList:[],bucketWidth:48,bucketHeight:48};return r.extend(a,s)},n.update=function(s,a,l,c){var u,d,h,f=l.world,p=s.buckets,g,v,y=!1;for(u=0;u<a.length;u++){var m=a[u];if(!(m.isSleeping&&!c)&&!(f.bounds&&(m.bounds.max.x<f.bounds.min.x||m.bounds.min.x>f.bounds.max.x||m.bounds.max.y<f.bounds.min.y||m.bounds.min.y>f.bounds.max.y))){var x=n._getRegion(s,m);if(!m.region||x.id!==m.region.id||c){(!m.region||c)&&(m.region=x);var _=n._regionUnion(x,m.region);for(d=_.startCol;d<=_.endCol;d++)for(h=_.startRow;h<=_.endRow;h++){v=n._getBucketId(d,h),g=p[v];var w=d>=x.startCol&&d<=x.endCol&&h>=x.startRow&&h<=x.endRow,b=d>=m.region.startCol&&d<=m.region.endCol&&h>=m.region.startRow&&h<=m.region.endRow;!w&&b&&b&&g&&n._bucketRemoveBody(s,g,m),(m.region===x||w&&!b||c)&&(g||(g=n._createBucket(p,v)),n._bucketAddBody(s,g,m))}m.region=x,y=!0}}}y&&(s.pairsList=n._createActivePairsList(s))},n.clear=function(s){s.buckets={},s.pairs={},s.pairsList=[]},n._regionUnion=function(s,a){var l=Math.min(s.startCol,a.startCol),c=Math.max(s.endCol,a.endCol),u=Math.min(s.startRow,a.startRow),d=Math.max(s.endRow,a.endRow);return n._createRegion(l,c,u,d)},n._getRegion=function(s,a){var l=a.bounds,c=Math.floor(l.min.x/s.bucketWidth),u=Math.floor(l.max.x/s.bucketWidth),d=Math.floor(l.min.y/s.bucketHeight),h=Math.floor(l.max.y/s.bucketHeight);return n._createRegion(c,u,d,h)},n._createRegion=function(s,a,l,c){return{id:s+","+a+","+l+","+c,startCol:s,endCol:a,startRow:l,endRow:c}},n._getBucketId=function(s,a){return"C"+s+"R"+a},n._createBucket=function(s,a){var l=s[a]=[];return l},n._bucketAddBody=function(s,a,l){for(var c=0;c<a.length;c++){var u=a[c];if(!(l.id===u.id||l.isStatic&&u.isStatic)){var d=i.id(l,u),h=s.pairs[d];h?h[2]+=1:s.pairs[d]=[l,u,1]}}a.push(l)},n._bucketRemoveBody=function(s,a,l){a.splice(r.indexOf(a,l),1);for(var c=0;c<a.length;c++){var u=a[c],d=i.id(l,u),h=s.pairs[d];h&&(h[2]-=1)}},n._createActivePairsList=function(s){var a,l,c=[];a=r.keys(s.pairs);for(var u=0;u<a.length;u++)l=s.pairs[a[u]],l[2]>0?c.push(l):delete s.pairs[a[u]];return c}})()},function(o,e,t){var n=o.exports=t(23);n.Axes=t(10),n.Bodies=t(11),n.Body=t(6),n.Bounds=t(1),n.Common=t(0),n.Composite=t(5),n.Composites=t(24),n.Constraint=t(8),n.Contact=t(17),n.Detector=t(13),n.Engine=t(18),n.Events=t(4),n.Grid=t(21),n.Mouse=t(12),n.MouseConstraint=t(25),n.Pair=t(9),n.Pairs=t(20),n.Plugin=t(15),n.Query=t(26),n.Render=t(16),n.Resolver=t(19),n.Runner=t(27),n.SAT=t(14),n.Sleeping=t(7),n.Svg=t(28),n.Vector=t(2),n.Vertices=t(3),n.World=t(29),n.Engine.run=n.Runner.run,n.Common.deprecated(n.Engine,"run","Engine.run \u27A4 use Matter.Runner.run(engine) instead")},function(o,e,t){var n={};o.exports=n;var i=t(15),r=t(0);(function(){n.name="matter-js",n.version="0.17.1",n.uses=[],n.used=[],n.use=function(){i.use(n,Array.prototype.slice.call(arguments))},n.before=function(s,a){return s=s.replace(/^Matter./,""),r.chainPathBefore(n,s,a)},n.after=function(s,a){return s=s.replace(/^Matter./,""),r.chainPathAfter(n,s,a)}})()},function(o,e,t){var n={};o.exports=n;var i=t(5),r=t(8),s=t(0),a=t(6),l=t(11),c=s.deprecated;(function(){n.stack=function(u,d,h,f,p,g,v){for(var y=i.create({label:"Stack"}),m=u,x=d,_,w=0,b=0;b<f;b++){for(var M=0,S=0;S<h;S++){var E=v(m,x,S,b,_,w);if(E){var A=E.bounds.max.y-E.bounds.min.y,L=E.bounds.max.x-E.bounds.min.x;A>M&&(M=A),a.translate(E,{x:L*.5,y:A*.5}),m=E.bounds.max.x+p,i.addBody(y,E),_=E,w+=1}else m+=p}x+=M+g,m=u}return y},n.chain=function(u,d,h,f,p,g){for(var v=u.bodies,y=1;y<v.length;y++){var m=v[y-1],x=v[y],_=m.bounds.max.y-m.bounds.min.y,w=m.bounds.max.x-m.bounds.min.x,b=x.bounds.max.y-x.bounds.min.y,M=x.bounds.max.x-x.bounds.min.x,S={bodyA:m,pointA:{x:w*d,y:_*h},bodyB:x,pointB:{x:M*f,y:b*p}},E=s.extend(S,g);i.addConstraint(u,r.create(E))}return u.label+=" Chain",u},n.mesh=function(u,d,h,f,p){var g=u.bodies,v,y,m,x,_;for(v=0;v<h;v++){for(y=1;y<d;y++)m=g[y-1+v*d],x=g[y+v*d],i.addConstraint(u,r.create(s.extend({bodyA:m,bodyB:x},p)));if(v>0)for(y=0;y<d;y++)m=g[y+(v-1)*d],x=g[y+v*d],i.addConstraint(u,r.create(s.extend({bodyA:m,bodyB:x},p))),f&&y>0&&(_=g[y-1+(v-1)*d],i.addConstraint(u,r.create(s.extend({bodyA:_,bodyB:x},p)))),f&&y<d-1&&(_=g[y+1+(v-1)*d],i.addConstraint(u,r.create(s.extend({bodyA:_,bodyB:x},p))))}return u.label+=" Mesh",u},n.pyramid=function(u,d,h,f,p,g,v){return n.stack(u,d,h,f,p,g,function(y,m,x,_,w,b){var M=Math.min(f,Math.ceil(h/2)),S=w?w.bounds.max.x-w.bounds.min.x:0;if(!(_>M)){_=M-_;var E=_,A=h-1-_;if(!(x<E||x>A)){b===1&&a.translate(w,{x:(x+(h%2==1?1:-1))*S,y:0});var L=w?x*S:0;return v(u+L+x*p,m,x,_,w,b)}}})},n.newtonsCradle=function(u,d,h,f,p){for(var g=i.create({label:"Newtons Cradle"}),v=0;v<h;v++){var y=1.9,m=l.circle(u+v*(f*y),d+p,f,{inertia:1/0,restitution:1,friction:0,frictionAir:1e-4,slop:1}),x=r.create({pointA:{x:u+v*(f*y),y:d},bodyB:m});i.addBody(g,m),i.addConstraint(g,x)}return g},c(n,"newtonsCradle","Composites.newtonsCradle \u27A4 moved to newtonsCradle example"),n.car=function(u,d,h,f,p){var g=a.nextGroup(!0),v=20,y=-h*.5+v,m=h*.5-v,x=0,_=i.create({label:"Car"}),w=l.rectangle(u,d,h,f,{collisionFilter:{group:g},chamfer:{radius:f*.5},density:2e-4}),b=l.circle(u+y,d+x,p,{collisionFilter:{group:g},friction:.8}),M=l.circle(u+m,d+x,p,{collisionFilter:{group:g},friction:.8}),S=r.create({bodyB:w,pointB:{x:y,y:x},bodyA:b,stiffness:1,length:0}),E=r.create({bodyB:w,pointB:{x:m,y:x},bodyA:M,stiffness:1,length:0});return i.addBody(_,w),i.addBody(_,b),i.addBody(_,M),i.addConstraint(_,S),i.addConstraint(_,E),_},c(n,"car","Composites.car \u27A4 moved to car example"),n.softBody=function(u,d,h,f,p,g,v,y,m,x){m=s.extend({inertia:1/0},m),x=s.extend({stiffness:.2,render:{type:"line",anchors:!1}},x);var _=n.stack(u,d,h,f,p,g,function(w,b){return l.circle(w,b,y,m)});return n.mesh(_,h,f,v,x),_.label="Soft Body",_},c(n,"softBody","Composites.softBody \u27A4 moved to softBody and cloth examples")})()},function(o,e,t){var n={};o.exports=n;var i=t(3),r=t(7),s=t(12),a=t(4),l=t(13),c=t(8),u=t(5),d=t(0),h=t(1);(function(){n.create=function(f,p){var g=(f?f.mouse:null)||(p?p.mouse:null);g||(f&&f.render&&f.render.canvas?g=s.create(f.render.canvas):p&&p.element?g=s.create(p.element):(g=s.create(),d.warn("MouseConstraint.create: options.mouse was undefined, options.element was undefined, may not function as expected")));var v=c.create({label:"Mouse Constraint",pointA:g.position,pointB:{x:0,y:0},length:.01,stiffness:.1,angularStiffness:1,render:{strokeStyle:"#90EE90",lineWidth:3}}),y={type:"mouseConstraint",mouse:g,element:null,body:null,constraint:v,collisionFilter:{category:1,mask:4294967295,group:0}},m=d.extend(y,p);return a.on(f,"beforeUpdate",function(){var x=u.allBodies(f.world);n.update(m,x),n._triggerEvents(m)}),m},n.update=function(f,p){var g=f.mouse,v=f.constraint,y=f.body;if(g.button===0){if(v.bodyB)r.set(v.bodyB,!1),v.pointA=g.position;else for(var m=0;m<p.length;m++)if(y=p[m],h.contains(y.bounds,g.position)&&l.canCollide(y.collisionFilter,f.collisionFilter))for(var x=y.parts.length>1?1:0;x<y.parts.length;x++){var _=y.parts[x];if(i.contains(_.vertices,g.position)){v.pointA=g.position,v.bodyB=f.body=y,v.pointB={x:g.position.x-y.position.x,y:g.position.y-y.position.y},v.angleB=y.angle,r.set(y,!1),a.trigger(f,"startdrag",{mouse:g,body:y});break}}}else v.bodyB=f.body=null,v.pointB=null,y&&a.trigger(f,"enddrag",{mouse:g,body:y})},n._triggerEvents=function(f){var p=f.mouse,g=p.sourceEvents;g.mousemove&&a.trigger(f,"mousemove",{mouse:p}),g.mousedown&&a.trigger(f,"mousedown",{mouse:p}),g.mouseup&&a.trigger(f,"mouseup",{mouse:p}),s.clearSourceEvents(p)}})()},function(o,e,t){var n={};o.exports=n;var i=t(2),r=t(14),s=t(1),a=t(11),l=t(3);(function(){n.collides=function(c,u){for(var d=[],h=0;h<u.length;h++){var f=u[h];if(s.overlaps(f.bounds,c.bounds))for(var p=f.parts.length===1?0:1;p<f.parts.length;p++){var g=f.parts[p];if(s.overlaps(g.bounds,c.bounds)){var v=r.collides(g,c);if(v.collided){d.push(v);break}}}}return d},n.ray=function(c,u,d,h){h=h||1e-100;for(var f=i.angle(u,d),p=i.magnitude(i.sub(u,d)),g=(d.x+u.x)*.5,v=(d.y+u.y)*.5,y=a.rectangle(g,v,p,h,{angle:f}),m=n.collides(y,c),x=0;x<m.length;x+=1){var _=m[x];_.body=_.bodyB=_.bodyA}return m},n.region=function(c,u,d){for(var h=[],f=0;f<c.length;f++){var p=c[f],g=s.overlaps(p.bounds,u);(g&&!d||!g&&d)&&h.push(p)}return h},n.point=function(c,u){for(var d=[],h=0;h<c.length;h++){var f=c[h];if(s.contains(f.bounds,u))for(var p=f.parts.length===1?0:1;p<f.parts.length;p++){var g=f.parts[p];if(s.contains(g.bounds,u)&&l.contains(g.vertices,u)){d.push(f);break}}}return d}})()},function(o,e,t){var n={};o.exports=n;var i=t(4),r=t(18),s=t(0);(function(){var a,l;if(typeof window!="undefined"&&(a=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame,l=window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.msCancelAnimationFrame),!a){var c;a=function(u){c=setTimeout(function(){u(s.now())},1e3/60)},l=function(){clearTimeout(c)}}n.create=function(u){var d={fps:60,correction:1,deltaSampleSize:60,counterTimestamp:0,frameCounter:0,deltaHistory:[],timePrev:null,timeScalePrev:1,frameRequestId:null,isFixed:!1,enabled:!0},h=s.extend(d,u);return h.delta=h.delta||1e3/h.fps,h.deltaMin=h.deltaMin||1e3/h.fps,h.deltaMax=h.deltaMax||1e3/(h.fps*.5),h.fps=1e3/h.delta,h},n.run=function(u,d){return typeof u.positionIterations!="undefined"&&(d=u,u=n.create()),function h(f){u.frameRequestId=a(h),f&&u.enabled&&n.tick(u,d,f)}(),u},n.tick=function(u,d,h){var f=d.timing,p=1,g,v={timestamp:f.timestamp};i.trigger(u,"beforeTick",v),u.isFixed?g=u.delta:(g=h-u.timePrev||u.delta,u.timePrev=h,u.deltaHistory.push(g),u.deltaHistory=u.deltaHistory.slice(-u.deltaSampleSize),g=Math.min.apply(null,u.deltaHistory),g=g<u.deltaMin?u.deltaMin:g,g=g>u.deltaMax?u.deltaMax:g,p=g/u.delta,u.delta=g),u.timeScalePrev!==0&&(p*=f.timeScale/u.timeScalePrev),f.timeScale===0&&(p=0),u.timeScalePrev=f.timeScale,u.correction=p,u.frameCounter+=1,h-u.counterTimestamp>=1e3&&(u.fps=u.frameCounter*((h-u.counterTimestamp)/1e3),u.counterTimestamp=h,u.frameCounter=0),i.trigger(u,"tick",v),i.trigger(u,"beforeUpdate",v),r.update(d,g,p),i.trigger(u,"afterUpdate",v),i.trigger(u,"afterTick",v)},n.stop=function(u){l(u.frameRequestId)},n.start=function(u,d){n.run(u,d)}})()},function(o,e,t){var n={};o.exports=n;var i=t(1),r=t(0);(function(){n.pathToVertices=function(s,a){typeof window!="undefined"&&!("SVGPathSeg"in window)&&r.warn("Svg.pathToVertices: SVGPathSeg not defined, a polyfill is required.");var l,c,u,d,h,f,p,g,v,y,m=[],x,_,w=0,b=0,M=0;a=a||15;var S=function(A,L,B){var R=B%2==1&&B>1;if(!v||A!=v.x||L!=v.y){v&&R?(x=v.x,_=v.y):(x=0,_=0);var D={x:x+A,y:_+L};(R||!v)&&(v=D),m.push(D),b=x+A,M=_+L}},E=function(A){var L=A.pathSegTypeAsLetter.toUpperCase();if(L!=="Z"){switch(L){case"M":case"L":case"T":case"C":case"S":case"Q":b=A.x,M=A.y;break;case"H":b=A.x;break;case"V":M=A.y;break}S(b,M,A.pathSegType)}};for(n._svgPathToAbsolute(s),u=s.getTotalLength(),f=[],l=0;l<s.pathSegList.numberOfItems;l+=1)f.push(s.pathSegList.getItem(l));for(p=f.concat();w<u;){if(y=s.getPathSegAtLength(w),h=f[y],h!=g){for(;p.length&&p[0]!=h;)E(p.shift());g=h}switch(h.pathSegTypeAsLetter.toUpperCase()){case"C":case"T":case"S":case"Q":case"A":d=s.getPointAtLength(w),S(d.x,d.y,0);break}w+=a}for(l=0,c=p.length;l<c;++l)E(p[l]);return m},n._svgPathToAbsolute=function(s){for(var a,l,c,u,d,h,f=s.pathSegList,p=0,g=0,v=f.numberOfItems,y=0;y<v;++y){var m=f.getItem(y),x=m.pathSegTypeAsLetter;if(/[MLHVCSQTA]/.test(x))"x"in m&&(p=m.x),"y"in m&&(g=m.y);else switch("x1"in m&&(c=p+m.x1),"x2"in m&&(d=p+m.x2),"y1"in m&&(u=g+m.y1),"y2"in m&&(h=g+m.y2),"x"in m&&(p+=m.x),"y"in m&&(g+=m.y),x){case"m":f.replaceItem(s.createSVGPathSegMovetoAbs(p,g),y);break;case"l":f.replaceItem(s.createSVGPathSegLinetoAbs(p,g),y);break;case"h":f.replaceItem(s.createSVGPathSegLinetoHorizontalAbs(p),y);break;case"v":f.replaceItem(s.createSVGPathSegLinetoVerticalAbs(g),y);break;case"c":f.replaceItem(s.createSVGPathSegCurvetoCubicAbs(p,g,c,u,d,h),y);break;case"s":f.replaceItem(s.createSVGPathSegCurvetoCubicSmoothAbs(p,g,d,h),y);break;case"q":f.replaceItem(s.createSVGPathSegCurvetoQuadraticAbs(p,g,c,u),y);break;case"t":f.replaceItem(s.createSVGPathSegCurvetoQuadraticSmoothAbs(p,g),y);break;case"a":f.replaceItem(s.createSVGPathSegArcAbs(p,g,m.r1,m.r2,m.angle,m.largeArcFlag,m.sweepFlag),y);break;case"z":case"Z":p=a,g=l;break}(x=="M"||x=="m")&&(a=p,l=g)}}})()},function(o,e,t){var n={};o.exports=n;var i=t(5),r=t(0);(function(){n.create=i.create,n.add=i.add,n.remove=i.remove,n.clear=i.clear,n.addComposite=i.addComposite,n.addBody=i.addBody,n.addConstraint=i.addConstraint})()}])})});var GN=Xd((HN,CT)=>{parcelRequire=function(o,e,t,n){var i,r=typeof parcelRequire=="function"&&parcelRequire,s=typeof Ox=="function"&&Ox;function a(u,d){if(!e[u]){if(!o[u]){var h=typeof parcelRequire=="function"&&parcelRequire;if(!d&&h)return h(u,!0);if(r)return r(u,!0);if(s&&typeof u=="string")return s(u);var f=new Error("Cannot find module '"+u+"'");throw f.code="MODULE_NOT_FOUND",f}g.resolve=function(v){return o[u][1][v]||v},g.cache={};var p=e[u]=new a.Module(u);o[u][0].call(p.exports,g,p,p.exports,this)}return e[u].exports;function g(v){return a(g.resolve(v))}}a.isParcelRequire=!0,a.Module=function(u){this.id=u,this.bundle=a,this.exports={}},a.modules=o,a.cache=e,a.parent=r,a.register=function(u,d){o[u]=[function(h,f){f.exports=d},{}]};for(var l=0;l<t.length;l++)try{a(t[l])}catch(u){i||(i=u)}if(t.length){var c=a(t[t.length-1]);typeof HN=="object"&&typeof CT!="undefined"?CT.exports=c:typeof define=="function"&&define.amd?define(function(){return c}):n&&(this[n]=c)}if(parcelRequire=a,i)throw i;return a}({EgBh:[function(o,e,t){var n={};n.useBlobBuilder=function(){try{return new Blob([]),!1}catch(s){return!0}}(),n.useArrayBufferView=!n.useBlobBuilder&&function(){try{return new Blob([new Uint8Array([])]).size===0}catch(s){return!0}}(),e.exports.binaryFeatures=n;var i=e.exports.BlobBuilder;function r(){this._pieces=[],this._parts=[]}typeof window!="undefined"&&(i=e.exports.BlobBuilder=window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder||window.BlobBuilder),r.prototype.append=function(s){typeof s=="number"?this._pieces.push(s):(this.flush(),this._parts.push(s))},r.prototype.flush=function(){if(this._pieces.length>0){var s=new Uint8Array(this._pieces);n.useArrayBufferView||(s=s.buffer),this._parts.push(s),this._pieces=[]}},r.prototype.getBuffer=function(){if(this.flush(),n.useBlobBuilder){for(var s=new i,a=0,l=this._parts.length;a<l;a++)s.append(this._parts[a]);return s.getBlob()}return new Blob(this._parts)},e.exports.BufferBuilder=r},{}],kdPp:[function(o,e,t){var n=o("./bufferbuilder").BufferBuilder,i=o("./bufferbuilder").binaryFeatures,r={unpack:function(u){return new s(u).unpack()},pack:function(u){var d=new a;return d.pack(u),d.getBuffer()}};function s(u){this.index=0,this.dataBuffer=u,this.dataView=new Uint8Array(this.dataBuffer),this.length=this.dataBuffer.byteLength}function a(){this.bufferBuilder=new n}function l(u){var d=u.charCodeAt(0);return d<=2047?"00":d<=65535?"000":d<=2097151?"0000":d<=67108863?"00000":"000000"}function c(u){return u.length>600?new Blob([u]).size:u.replace(/[^\u0000-\u007F]/g,l).length}e.exports=r,s.prototype.unpack=function(){var u,d=this.unpack_uint8();if(d<128)return d;if((224^d)<32)return(224^d)-32;if((u=160^d)<=15)return this.unpack_raw(u);if((u=176^d)<=15)return this.unpack_string(u);if((u=144^d)<=15)return this.unpack_array(u);if((u=128^d)<=15)return this.unpack_map(u);switch(d){case 192:return null;case 193:return;case 194:return!1;case 195:return!0;case 202:return this.unpack_float();case 203:return this.unpack_double();case 204:return this.unpack_uint8();case 205:return this.unpack_uint16();case 206:return this.unpack_uint32();case 207:return this.unpack_uint64();case 208:return this.unpack_int8();case 209:return this.unpack_int16();case 210:return this.unpack_int32();case 211:return this.unpack_int64();case 212:case 213:case 214:case 215:return;case 216:return u=this.unpack_uint16(),this.unpack_string(u);case 217:return u=this.unpack_uint32(),this.unpack_string(u);case 218:return u=this.unpack_uint16(),this.unpack_raw(u);case 219:return u=this.unpack_uint32(),this.unpack_raw(u);case 220:return u=this.unpack_uint16(),this.unpack_array(u);case 221:return u=this.unpack_uint32(),this.unpack_array(u);case 222:return u=this.unpack_uint16(),this.unpack_map(u);case 223:return u=this.unpack_uint32(),this.unpack_map(u)}},s.prototype.unpack_uint8=function(){var u=255&this.dataView[this.index];return this.index++,u},s.prototype.unpack_uint16=function(){var u=this.read(2),d=256*(255&u[0])+(255&u[1]);return this.index+=2,d},s.prototype.unpack_uint32=function(){var u=this.read(4),d=256*(256*(256*u[0]+u[1])+u[2])+u[3];return this.index+=4,d},s.prototype.unpack_uint64=function(){var u=this.read(8),d=256*(256*(256*(256*(256*(256*(256*u[0]+u[1])+u[2])+u[3])+u[4])+u[5])+u[6])+u[7];return this.index+=8,d},s.prototype.unpack_int8=function(){var u=this.unpack_uint8();return u<128?u:u-256},s.prototype.unpack_int16=function(){var u=this.unpack_uint16();return u<32768?u:u-65536},s.prototype.unpack_int32=function(){var u=this.unpack_uint32();return u<Math.pow(2,31)?u:u-Math.pow(2,32)},s.prototype.unpack_int64=function(){var u=this.unpack_uint64();return u<Math.pow(2,63)?u:u-Math.pow(2,64)},s.prototype.unpack_raw=function(u){if(this.length<this.index+u)throw new Error("BinaryPackFailure: index is out of range "+this.index+" "+u+" "+this.length);var d=this.dataBuffer.slice(this.index,this.index+u);return this.index+=u,d},s.prototype.unpack_string=function(u){for(var d,h,f=this.read(u),p=0,g="";p<u;)(d=f[p])<128?(g+=String.fromCharCode(d),p++):(192^d)<32?(h=(192^d)<<6|63&f[p+1],g+=String.fromCharCode(h),p+=2):(h=(15&d)<<12|(63&f[p+1])<<6|63&f[p+2],g+=String.fromCharCode(h),p+=3);return this.index+=u,g},s.prototype.unpack_array=function(u){for(var d=new Array(u),h=0;h<u;h++)d[h]=this.unpack();return d},s.prototype.unpack_map=function(u){for(var d={},h=0;h<u;h++){var f=this.unpack(),p=this.unpack();d[f]=p}return d},s.prototype.unpack_float=function(){var u=this.unpack_uint32(),d=(u>>23&255)-127;return(u>>31==0?1:-1)*(8388607&u|8388608)*Math.pow(2,d-23)},s.prototype.unpack_double=function(){var u=this.unpack_uint32(),d=this.unpack_uint32(),h=(u>>20&2047)-1023;return(u>>31==0?1:-1)*((1048575&u|1048576)*Math.pow(2,h-20)+d*Math.pow(2,h-52))},s.prototype.read=function(u){var d=this.index;if(d+u<=this.length)return this.dataView.subarray(d,d+u);throw new Error("BinaryPackFailure: read index out of range")},a.prototype.getBuffer=function(){return this.bufferBuilder.getBuffer()},a.prototype.pack=function(u){var d=typeof u;if(d==="string")this.pack_string(u);else if(d==="number")Math.floor(u)===u?this.pack_integer(u):this.pack_double(u);else if(d==="boolean")u===!0?this.bufferBuilder.append(195):u===!1&&this.bufferBuilder.append(194);else if(d==="undefined")this.bufferBuilder.append(192);else{if(d!=="object")throw new Error('Type "'+d+'" not yet supported');if(u===null)this.bufferBuilder.append(192);else{var h=u.constructor;if(h==Array)this.pack_array(u);else if(h==Blob||h==File||u instanceof Blob||u instanceof File)this.pack_bin(u);else if(h==ArrayBuffer)i.useArrayBufferView?this.pack_bin(new Uint8Array(u)):this.pack_bin(u);else if("BYTES_PER_ELEMENT"in u)i.useArrayBufferView?this.pack_bin(new Uint8Array(u.buffer)):this.pack_bin(u.buffer);else if(h==Object||h.toString().startsWith("class"))this.pack_object(u);else if(h==Date)this.pack_string(u.toString());else{if(typeof u.toBinaryPack!="function")throw new Error('Type "'+h.toString()+'" not yet supported');this.bufferBuilder.append(u.toBinaryPack())}}}this.bufferBuilder.flush()},a.prototype.pack_bin=function(u){var d=u.length||u.byteLength||u.size;if(d<=15)this.pack_uint8(160+d);else if(d<=65535)this.bufferBuilder.append(218),this.pack_uint16(d);else{if(!(d<=4294967295))throw new Error("Invalid length");this.bufferBuilder.append(219),this.pack_uint32(d)}this.bufferBuilder.append(u)},a.prototype.pack_string=function(u){var d=c(u);if(d<=15)this.pack_uint8(176+d);else if(d<=65535)this.bufferBuilder.append(216),this.pack_uint16(d);else{if(!(d<=4294967295))throw new Error("Invalid length");this.bufferBuilder.append(217),this.pack_uint32(d)}this.bufferBuilder.append(u)},a.prototype.pack_array=function(u){var d=u.length;if(d<=15)this.pack_uint8(144+d);else if(d<=65535)this.bufferBuilder.append(220),this.pack_uint16(d);else{if(!(d<=4294967295))throw new Error("Invalid length");this.bufferBuilder.append(221),this.pack_uint32(d)}for(var h=0;h<d;h++)this.pack(u[h])},a.prototype.pack_integer=function(u){if(u>=-32&&u<=127)this.bufferBuilder.append(255&u);else if(u>=0&&u<=255)this.bufferBuilder.append(204),this.pack_uint8(u);else if(u>=-128&&u<=127)this.bufferBuilder.append(208),this.pack_int8(u);else if(u>=0&&u<=65535)this.bufferBuilder.append(205),this.pack_uint16(u);else if(u>=-32768&&u<=32767)this.bufferBuilder.append(209),this.pack_int16(u);else if(u>=0&&u<=4294967295)this.bufferBuilder.append(206),this.pack_uint32(u);else if(u>=-2147483648&&u<=2147483647)this.bufferBuilder.append(210),this.pack_int32(u);else if(u>=-9223372036854776e3&&u<=9223372036854776e3)this.bufferBuilder.append(211),this.pack_int64(u);else{if(!(u>=0&&u<=18446744073709552e3))throw new Error("Invalid integer");this.bufferBuilder.append(207),this.pack_uint64(u)}},a.prototype.pack_double=function(u){var d=0;u<0&&(d=1,u=-u);var h=Math.floor(Math.log(u)/Math.LN2),f=u/Math.pow(2,h)-1,p=Math.floor(f*Math.pow(2,52)),g=Math.pow(2,32),v=d<<31|h+1023<<20|p/g&1048575,y=p%g;this.bufferBuilder.append(203),this.pack_int32(v),this.pack_int32(y)},a.prototype.pack_object=function(u){var d=Object.keys(u).length;if(d<=15)this.pack_uint8(128+d);else if(d<=65535)this.bufferBuilder.append(222),this.pack_uint16(d);else{if(!(d<=4294967295))throw new Error("Invalid length");this.bufferBuilder.append(223),this.pack_uint32(d)}for(var h in u)u.hasOwnProperty(h)&&(this.pack(h),this.pack(u[h]))},a.prototype.pack_uint8=function(u){this.bufferBuilder.append(u)},a.prototype.pack_uint16=function(u){this.bufferBuilder.append(u>>8),this.bufferBuilder.append(255&u)},a.prototype.pack_uint32=function(u){var d=4294967295&u;this.bufferBuilder.append((4278190080&d)>>>24),this.bufferBuilder.append((16711680&d)>>>16),this.bufferBuilder.append((65280&d)>>>8),this.bufferBuilder.append(255&d)},a.prototype.pack_uint64=function(u){var d=u/Math.pow(2,32),h=u%Math.pow(2,32);this.bufferBuilder.append((4278190080&d)>>>24),this.bufferBuilder.append((16711680&d)>>>16),this.bufferBuilder.append((65280&d)>>>8),this.bufferBuilder.append(255&d),this.bufferBuilder.append((4278190080&h)>>>24),this.bufferBuilder.append((16711680&h)>>>16),this.bufferBuilder.append((65280&h)>>>8),this.bufferBuilder.append(255&h)},a.prototype.pack_int8=function(u){this.bufferBuilder.append(255&u)},a.prototype.pack_int16=function(u){this.bufferBuilder.append((65280&u)>>8),this.bufferBuilder.append(255&u)},a.prototype.pack_int32=function(u){this.bufferBuilder.append(u>>>24&255),this.bufferBuilder.append((16711680&u)>>>16),this.bufferBuilder.append((65280&u)>>>8),this.bufferBuilder.append(255&u)},a.prototype.pack_int64=function(u){var d=Math.floor(u/Math.pow(2,32)),h=u%Math.pow(2,32);this.bufferBuilder.append((4278190080&d)>>>24),this.bufferBuilder.append((16711680&d)>>>16),this.bufferBuilder.append((65280&d)>>>8),this.bufferBuilder.append(255&d),this.bufferBuilder.append((4278190080&h)>>>24),this.bufferBuilder.append((16711680&h)>>>16),this.bufferBuilder.append((65280&h)>>>8),this.bufferBuilder.append(255&h)}},{"./bufferbuilder":"EgBh"}],iSxC:[function(o,e,t){"use strict";function n(m,x,_){return x in m?Object.defineProperty(m,x,{value:_,enumerable:!0,configurable:!0,writable:!0}):m[x]=_,m}function i(m){return(i=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(x){return typeof x}:function(x){return x&&typeof Symbol=="function"&&x.constructor===Symbol&&x!==Symbol.prototype?"symbol":typeof x})(m)}Object.defineProperty(t,"__esModule",{value:!0}),t.extractVersion=a,t.wrapPeerConnectionEvent=l,t.disableLog=c,t.disableWarnings=u,t.log=d,t.deprecated=h,t.detectBrowser=f,t.compactObject=g,t.walkStats=v,t.filterStats=y;var r=!0,s=!0;function a(m,x,_){var w=m.match(x);return w&&w.length>=_&&parseInt(w[_],10)}function l(m,x,_){if(m.RTCPeerConnection){var w=m.RTCPeerConnection.prototype,b=w.addEventListener;w.addEventListener=function(S,E){if(S!==x)return b.apply(this,arguments);var A=function(L){var B=_(L);B&&(E.handleEvent?E.handleEvent(B):E(B))};return this._eventMap=this._eventMap||{},this._eventMap[x]||(this._eventMap[x]=new Map),this._eventMap[x].set(E,A),b.apply(this,[S,A])};var M=w.removeEventListener;w.removeEventListener=function(S,E){if(S!==x||!this._eventMap||!this._eventMap[x])return M.apply(this,arguments);if(!this._eventMap[x].has(E))return M.apply(this,arguments);var A=this._eventMap[x].get(E);return this._eventMap[x].delete(E),this._eventMap[x].size===0&&delete this._eventMap[x],Object.keys(this._eventMap).length===0&&delete this._eventMap,M.apply(this,[S,A])},Object.defineProperty(w,"on"+x,{get:function(){return this["_on"+x]},set:function(S){this["_on"+x]&&(this.removeEventListener(x,this["_on"+x]),delete this["_on"+x]),S&&this.addEventListener(x,this["_on"+x]=S)},enumerable:!0,configurable:!0})}}function c(m){return typeof m!="boolean"?new Error("Argument type: "+i(m)+". Please use a boolean."):(r=m,m?"adapter.js logging disabled":"adapter.js logging enabled")}function u(m){return typeof m!="boolean"?new Error("Argument type: "+i(m)+". Please use a boolean."):(s=!m,"adapter.js deprecation warnings "+(m?"disabled":"enabled"))}function d(){if((typeof window=="undefined"?"undefined":i(window))==="object"){if(r)return;typeof console!="undefined"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function h(m,x){s&&console.warn(m+" is deprecated, please use "+x+" instead.")}function f(m){var x={browser:null,version:null};if(m===void 0||!m.navigator)return x.browser="Not a browser.",x;var{navigator:_}=m;if(_.mozGetUserMedia)x.browser="firefox",x.version=a(_.userAgent,/Firefox\/(\d+)\./,1);else if(_.webkitGetUserMedia||m.isSecureContext===!1&&m.webkitRTCPeerConnection&&!m.RTCIceGatherer)x.browser="chrome",x.version=a(_.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else if(_.mediaDevices&&_.userAgent.match(/Edge\/(\d+).(\d+)$/))x.browser="edge",x.version=a(_.userAgent,/Edge\/(\d+).(\d+)$/,2);else{if(!m.RTCPeerConnection||!_.userAgent.match(/AppleWebKit\/(\d+)\./))return x.browser="Not a supported browser.",x;x.browser="safari",x.version=a(_.userAgent,/AppleWebKit\/(\d+)\./,1),x.supportsUnifiedPlan=m.RTCRtpTransceiver&&"currentDirection"in m.RTCRtpTransceiver.prototype}return x}function p(m){return Object.prototype.toString.call(m)==="[object Object]"}function g(m){return p(m)?Object.keys(m).reduce(function(x,_){var w=p(m[_]),b=w?g(m[_]):m[_],M=w&&!Object.keys(b).length;return b===void 0||M?x:Object.assign(x,n({},_,b))},{}):m}function v(m,x,_){x&&!_.has(x.id)&&(_.set(x.id,x),Object.keys(x).forEach(function(w){w.endsWith("Id")?v(m,m.get(x[w]),_):w.endsWith("Ids")&&x[w].forEach(function(b){v(m,m.get(b),_)})}))}function y(m,x,_){var w=_?"outbound-rtp":"inbound-rtp",b=new Map;if(x===null)return b;var M=[];return m.forEach(function(S){S.type==="track"&&S.trackIdentifier===x.id&&M.push(S)}),M.forEach(function(S){m.forEach(function(E){E.type===w&&E.trackId===S.id&&v(m,E,b)})}),b}},{}],s6SN:[function(o,e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.shimGetUserMedia=l;var n=r(o("../utils.js"));function i(){if(typeof WeakMap!="function")return null;var c=new WeakMap;return i=function(){return c},c}function r(c){if(c&&c.__esModule)return c;if(c===null||typeof c!="object"&&typeof c!="function")return{default:c};var u=i();if(u&&u.has(c))return u.get(c);var d={},h=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var f in c)if(Object.prototype.hasOwnProperty.call(c,f)){var p=h?Object.getOwnPropertyDescriptor(c,f):null;p&&(p.get||p.set)?Object.defineProperty(d,f,p):d[f]=c[f]}return d.default=c,u&&u.set(c,d),d}function s(c){return(s=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(u){return typeof u}:function(u){return u&&typeof Symbol=="function"&&u.constructor===Symbol&&u!==Symbol.prototype?"symbol":typeof u})(c)}var a=n.log;function l(c,u){var d=c&&c.navigator;if(d.mediaDevices){var h=function(v){if(s(v)!=="object"||v.mandatory||v.optional)return v;var y={};return Object.keys(v).forEach(function(m){if(m!=="require"&&m!=="advanced"&&m!=="mediaSource"){var x=s(v[m])==="object"?v[m]:{ideal:v[m]};x.exact!==void 0&&typeof x.exact=="number"&&(x.min=x.max=x.exact);var _=function(b,M){return b?b+M.charAt(0).toUpperCase()+M.slice(1):M==="deviceId"?"sourceId":M};if(x.ideal!==void 0){y.optional=y.optional||[];var w={};typeof x.ideal=="number"?(w[_("min",m)]=x.ideal,y.optional.push(w),(w={})[_("max",m)]=x.ideal,y.optional.push(w)):(w[_("",m)]=x.ideal,y.optional.push(w))}x.exact!==void 0&&typeof x.exact!="number"?(y.mandatory=y.mandatory||{},y.mandatory[_("",m)]=x.exact):["min","max"].forEach(function(b){x[b]!==void 0&&(y.mandatory=y.mandatory||{},y.mandatory[_(b,m)]=x[b])})}}),v.advanced&&(y.optional=(y.optional||[]).concat(v.advanced)),y},f=function(v,y){if(u.version>=61)return y(v);if((v=JSON.parse(JSON.stringify(v)))&&s(v.audio)==="object"){var m=function(b,M,S){M in b&&!(S in b)&&(b[S]=b[M],delete b[M])};m((v=JSON.parse(JSON.stringify(v))).audio,"autoGainControl","googAutoGainControl"),m(v.audio,"noiseSuppression","googNoiseSuppression"),v.audio=h(v.audio)}if(v&&s(v.video)==="object"){var x=v.video.facingMode;x=x&&(s(x)==="object"?x:{ideal:x});var _,w=u.version<66;if(x&&(x.exact==="user"||x.exact==="environment"||x.ideal==="user"||x.ideal==="environment")&&(!d.mediaDevices.getSupportedConstraints||!d.mediaDevices.getSupportedConstraints().facingMode||w)&&(delete v.video.facingMode,x.exact==="environment"||x.ideal==="environment"?_=["back","rear"]:x.exact!=="user"&&x.ideal!=="user"||(_=["front"]),_))return d.mediaDevices.enumerateDevices().then(function(b){var M=(b=b.filter(function(S){return S.kind==="videoinput"})).find(function(S){return _.some(function(E){return S.label.toLowerCase().includes(E)})});return!M&&b.length&&_.includes("back")&&(M=b[b.length-1]),M&&(v.video.deviceId=x.exact?{exact:M.deviceId}:{ideal:M.deviceId}),v.video=h(v.video),a("chrome: "+JSON.stringify(v)),y(v)});v.video=h(v.video)}return a("chrome: "+JSON.stringify(v)),y(v)},p=function(v){return u.version>=64?v:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[v.name]||v.name,message:v.message,constraint:v.constraint||v.constraintName,toString:function(){return this.name+(this.message&&": ")+this.message}}};if(d.getUserMedia=function(v,y,m){f(v,function(x){d.webkitGetUserMedia(x,y,function(_){m&&m(p(_))})})}.bind(d),d.mediaDevices.getUserMedia){var g=d.mediaDevices.getUserMedia.bind(d.mediaDevices);d.mediaDevices.getUserMedia=function(v){return f(v,function(y){return g(y).then(function(m){if(y.audio&&!m.getAudioTracks().length||y.video&&!m.getVideoTracks().length)throw m.getTracks().forEach(function(x){x.stop()}),new DOMException("","NotFoundError");return m},function(m){return Promise.reject(p(m))})})}}}}},{"../utils.js":"iSxC"}],VHa8:[function(o,e,t){"use strict";function n(i,r){i.navigator.mediaDevices&&"getDisplayMedia"in i.navigator.mediaDevices||i.navigator.mediaDevices&&(typeof r=="function"?i.navigator.mediaDevices.getDisplayMedia=function(s){return r(s).then(function(a){var l=s.video&&s.video.width,c=s.video&&s.video.height,u=s.video&&s.video.frameRate;return s.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:a,maxFrameRate:u||3}},l&&(s.video.mandatory.maxWidth=l),c&&(s.video.mandatory.maxHeight=c),i.navigator.mediaDevices.getUserMedia(s)})}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))}Object.defineProperty(t,"__esModule",{value:!0}),t.shimGetDisplayMedia=n},{}],uI5X:[function(o,e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.shimMediaStream=u,t.shimOnTrack=d,t.shimGetSendersWithDtmf=h,t.shimGetStats=f,t.shimSenderReceiverGetStats=p,t.shimAddTrackRemoveTrackWithNative=g,t.shimAddTrackRemoveTrack=v,t.shimPeerConnection=y,t.fixNegotiationNeeded=m,Object.defineProperty(t,"shimGetUserMedia",{enumerable:!0,get:function(){return i.shimGetUserMedia}}),Object.defineProperty(t,"shimGetDisplayMedia",{enumerable:!0,get:function(){return r.shimGetDisplayMedia}});var n=a(o("../utils.js")),i=o("./getusermedia"),r=o("./getdisplaymedia");function s(){if(typeof WeakMap!="function")return null;var x=new WeakMap;return s=function(){return x},x}function a(x){if(x&&x.__esModule)return x;if(x===null||typeof x!="object"&&typeof x!="function")return{default:x};var _=s();if(_&&_.has(x))return _.get(x);var w={},b=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var M in x)if(Object.prototype.hasOwnProperty.call(x,M)){var S=b?Object.getOwnPropertyDescriptor(x,M):null;S&&(S.get||S.set)?Object.defineProperty(w,M,S):w[M]=x[M]}return w.default=x,_&&_.set(x,w),w}function l(x,_,w){return _ in x?Object.defineProperty(x,_,{value:w,enumerable:!0,configurable:!0,writable:!0}):x[_]=w,x}function c(x){return(c=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(_){return typeof _}:function(_){return _&&typeof Symbol=="function"&&_.constructor===Symbol&&_!==Symbol.prototype?"symbol":typeof _})(x)}function u(x){x.MediaStream=x.MediaStream||x.webkitMediaStream}function d(x){if(c(x)!=="object"||!x.RTCPeerConnection||"ontrack"in x.RTCPeerConnection.prototype)n.wrapPeerConnectionEvent(x,"track",function(w){return w.transceiver||Object.defineProperty(w,"transceiver",{value:{receiver:w.receiver}}),w});else{Object.defineProperty(x.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(w){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=w)},enumerable:!0,configurable:!0});var _=x.RTCPeerConnection.prototype.setRemoteDescription;x.RTCPeerConnection.prototype.setRemoteDescription=function(){var w=this;return this._ontrackpoly||(this._ontrackpoly=function(b){b.stream.addEventListener("addtrack",function(M){var S;S=x.RTCPeerConnection.prototype.getReceivers?w.getReceivers().find(function(A){return A.track&&A.track.id===M.track.id}):{track:M.track};var E=new Event("track");E.track=M.track,E.receiver=S,E.transceiver={receiver:S},E.streams=[b.stream],w.dispatchEvent(E)}),b.stream.getTracks().forEach(function(M){var S;S=x.RTCPeerConnection.prototype.getReceivers?w.getReceivers().find(function(A){return A.track&&A.track.id===M.id}):{track:M};var E=new Event("track");E.track=M,E.receiver=S,E.transceiver={receiver:S},E.streams=[b.stream],w.dispatchEvent(E)})},this.addEventListener("addstream",this._ontrackpoly)),_.apply(this,arguments)}}}function h(x){if(c(x)==="object"&&x.RTCPeerConnection&&!("getSenders"in x.RTCPeerConnection.prototype)&&"createDTMFSender"in x.RTCPeerConnection.prototype){var _=function(A,L){return{track:L,get dtmf(){return this._dtmf===void 0&&(L.kind==="audio"?this._dtmf=A.createDTMFSender(L):this._dtmf=null),this._dtmf},_pc:A}};if(!x.RTCPeerConnection.prototype.getSenders){x.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};var w=x.RTCPeerConnection.prototype.addTrack;x.RTCPeerConnection.prototype.addTrack=function(A,L){var B=w.apply(this,arguments);return B||(B=_(this,A),this._senders.push(B)),B};var b=x.RTCPeerConnection.prototype.removeTrack;x.RTCPeerConnection.prototype.removeTrack=function(A){b.apply(this,arguments);var L=this._senders.indexOf(A);L!==-1&&this._senders.splice(L,1)}}var M=x.RTCPeerConnection.prototype.addStream;x.RTCPeerConnection.prototype.addStream=function(A){var L=this;this._senders=this._senders||[],M.apply(this,[A]),A.getTracks().forEach(function(B){L._senders.push(_(L,B))})};var S=x.RTCPeerConnection.prototype.removeStream;x.RTCPeerConnection.prototype.removeStream=function(A){var L=this;this._senders=this._senders||[],S.apply(this,[A]),A.getTracks().forEach(function(B){var R=L._senders.find(function(D){return D.track===B});R&&L._senders.splice(L._senders.indexOf(R),1)})}}else if(c(x)==="object"&&x.RTCPeerConnection&&"getSenders"in x.RTCPeerConnection.prototype&&"createDTMFSender"in x.RTCPeerConnection.prototype&&x.RTCRtpSender&&!("dtmf"in x.RTCRtpSender.prototype)){var E=x.RTCPeerConnection.prototype.getSenders;x.RTCPeerConnection.prototype.getSenders=function(){var A=this,L=E.apply(this,[]);return L.forEach(function(B){return B._pc=A}),L},Object.defineProperty(x.RTCRtpSender.prototype,"dtmf",{get:function(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function f(x){if(x.RTCPeerConnection){var _=x.RTCPeerConnection.prototype.getStats;x.RTCPeerConnection.prototype.getStats=function(){var w=this,[b,M,S]=arguments;if(arguments.length>0&&typeof b=="function")return _.apply(this,arguments);if(_.length===0&&(arguments.length===0||typeof b!="function"))return _.apply(this,[]);var E=function(L){var B={};return L.result().forEach(function(R){var D={id:R.id,timestamp:R.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[R.type]||R.type};R.names().forEach(function(P){D[P]=R.stat(P)}),B[D.id]=D}),B},A=function(L){return new Map(Object.keys(L).map(function(B){return[B,L[B]]}))};return arguments.length>=2?_.apply(this,[function(L){M(A(E(L)))},b]):new Promise(function(L,B){_.apply(w,[function(R){L(A(E(R)))},B])}).then(M,S)}}}function p(x){if(c(x)==="object"&&x.RTCPeerConnection&&x.RTCRtpSender&&x.RTCRtpReceiver){if(!("getStats"in x.RTCRtpSender.prototype)){var _=x.RTCPeerConnection.prototype.getSenders;_&&(x.RTCPeerConnection.prototype.getSenders=function(){var S=this,E=_.apply(this,[]);return E.forEach(function(A){return A._pc=S}),E});var w=x.RTCPeerConnection.prototype.addTrack;w&&(x.RTCPeerConnection.prototype.addTrack=function(){var S=w.apply(this,arguments);return S._pc=this,S}),x.RTCRtpSender.prototype.getStats=function(){var S=this;return this._pc.getStats().then(function(E){return n.filterStats(E,S.track,!0)})}}if(!("getStats"in x.RTCRtpReceiver.prototype)){var b=x.RTCPeerConnection.prototype.getReceivers;b&&(x.RTCPeerConnection.prototype.getReceivers=function(){var S=this,E=b.apply(this,[]);return E.forEach(function(A){return A._pc=S}),E}),n.wrapPeerConnectionEvent(x,"track",function(S){return S.receiver._pc=S.srcElement,S}),x.RTCRtpReceiver.prototype.getStats=function(){var S=this;return this._pc.getStats().then(function(E){return n.filterStats(E,S.track,!1)})}}if("getStats"in x.RTCRtpSender.prototype&&"getStats"in x.RTCRtpReceiver.prototype){var M=x.RTCPeerConnection.prototype.getStats;x.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof x.MediaStreamTrack){var S,E,A,L=arguments[0];return this.getSenders().forEach(function(B){B.track===L&&(S?A=!0:S=B)}),this.getReceivers().forEach(function(B){return B.track===L&&(E?A=!0:E=B),B.track===L}),A||S&&E?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):S?S.getStats():E?E.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return M.apply(this,arguments)}}}}function g(x){x.RTCPeerConnection.prototype.getLocalStreams=function(){var S=this;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(function(E){return S._shimmedLocalStreams[E][0]})};var _=x.RTCPeerConnection.prototype.addTrack;x.RTCPeerConnection.prototype.addTrack=function(S,E){if(!E)return _.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};var A=_.apply(this,arguments);return this._shimmedLocalStreams[E.id]?this._shimmedLocalStreams[E.id].indexOf(A)===-1&&this._shimmedLocalStreams[E.id].push(A):this._shimmedLocalStreams[E.id]=[E,A],A};var w=x.RTCPeerConnection.prototype.addStream;x.RTCPeerConnection.prototype.addStream=function(S){var E=this;this._shimmedLocalStreams=this._shimmedLocalStreams||{},S.getTracks().forEach(function(B){if(E.getSenders().find(function(R){return R.track===B}))throw new DOMException("Track already exists.","InvalidAccessError")});var A=this.getSenders();w.apply(this,arguments);var L=this.getSenders().filter(function(B){return A.indexOf(B)===-1});this._shimmedLocalStreams[S.id]=[S].concat(L)};var b=x.RTCPeerConnection.prototype.removeStream;x.RTCPeerConnection.prototype.removeStream=function(S){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[S.id],b.apply(this,arguments)};var M=x.RTCPeerConnection.prototype.removeTrack;x.RTCPeerConnection.prototype.removeTrack=function(S){var E=this;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},S&&Object.keys(this._shimmedLocalStreams).forEach(function(A){var L=E._shimmedLocalStreams[A].indexOf(S);L!==-1&&E._shimmedLocalStreams[A].splice(L,1),E._shimmedLocalStreams[A].length===1&&delete E._shimmedLocalStreams[A]}),M.apply(this,arguments)}}function v(x,_){if(x.RTCPeerConnection){if(x.RTCPeerConnection.prototype.addTrack&&_.version>=65)return g(x);var w=x.RTCPeerConnection.prototype.getLocalStreams;x.RTCPeerConnection.prototype.getLocalStreams=function(){var L=this,B=w.apply(this);return this._reverseStreams=this._reverseStreams||{},B.map(function(R){return L._reverseStreams[R.id]})};var b=x.RTCPeerConnection.prototype.addStream;x.RTCPeerConnection.prototype.addStream=function(L){var B=this;if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},L.getTracks().forEach(function(D){if(B.getSenders().find(function(P){return P.track===D}))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[L.id]){var R=new x.MediaStream(L.getTracks());this._streams[L.id]=R,this._reverseStreams[R.id]=L,L=R}b.apply(this,[L])};var M=x.RTCPeerConnection.prototype.removeStream;x.RTCPeerConnection.prototype.removeStream=function(L){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},M.apply(this,[this._streams[L.id]||L]),delete this._reverseStreams[this._streams[L.id]?this._streams[L.id].id:L.id],delete this._streams[L.id]},x.RTCPeerConnection.prototype.addTrack=function(L,B){var R=this;if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");var D=[].slice.call(arguments,1);if(D.length!==1||!D[0].getTracks().find(function(N){return N===L}))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(function(N){return N.track===L}))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};var P=this._streams[B.id];if(P)P.addTrack(L),Promise.resolve().then(function(){R.dispatchEvent(new Event("negotiationneeded"))});else{var I=new x.MediaStream([L]);this._streams[B.id]=I,this._reverseStreams[I.id]=B,this.addStream(I)}return this.getSenders().find(function(N){return N.track===L})},["createOffer","createAnswer"].forEach(function(L){var B=x.RTCPeerConnection.prototype[L],R=l({},L,function(){var D=this,P=arguments;return arguments.length&&typeof arguments[0]=="function"?B.apply(this,[function(I){var N=A(D,I);P[0].apply(null,[N])},function(I){P[1]&&P[1].apply(null,I)},arguments[2]]):B.apply(this,arguments).then(function(I){return A(D,I)})});x.RTCPeerConnection.prototype[L]=R[L]});var S=x.RTCPeerConnection.prototype.setLocalDescription;x.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=(L=this,B=arguments[0],R=B.sdp,Object.keys(L._reverseStreams||[]).forEach(function(D){var P=L._reverseStreams[D],I=L._streams[P.id];R=R.replace(new RegExp(P.id,"g"),I.id)}),new RTCSessionDescription({type:B.type,sdp:R})),S.apply(this,arguments)):S.apply(this,arguments);var L,B,R};var E=Object.getOwnPropertyDescriptor(x.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(x.RTCPeerConnection.prototype,"localDescription",{get:function(){var L=E.get.apply(this);return L.type===""?L:A(this,L)}}),x.RTCPeerConnection.prototype.removeTrack=function(L){var B,R=this;if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!L._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(L._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{},Object.keys(this._streams).forEach(function(D){R._streams[D].getTracks().find(function(P){return L.track===P})&&(B=R._streams[D])}),B&&(B.getTracks().length===1?this.removeStream(this._reverseStreams[B.id]):B.removeTrack(L.track),this.dispatchEvent(new Event("negotiationneeded")))}}function A(L,B){var R=B.sdp;return Object.keys(L._reverseStreams||[]).forEach(function(D){var P=L._reverseStreams[D],I=L._streams[P.id];R=R.replace(new RegExp(I.id,"g"),P.id)}),new RTCSessionDescription({type:B.type,sdp:R})}}function y(x,_){!x.RTCPeerConnection&&x.webkitRTCPeerConnection&&(x.RTCPeerConnection=x.webkitRTCPeerConnection),x.RTCPeerConnection&&_.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(w){var b=x.RTCPeerConnection.prototype[w],M=l({},w,function(){return arguments[0]=new(w==="addIceCandidate"?x.RTCIceCandidate:x.RTCSessionDescription)(arguments[0]),b.apply(this,arguments)});x.RTCPeerConnection.prototype[w]=M[w]})}function m(x,_){n.wrapPeerConnectionEvent(x,"negotiationneeded",function(w){var b=w.target;if(!(_.version<72||b.getConfiguration&&b.getConfiguration().sdpSemantics==="plan-b")||b.signalingState==="stable")return w})}},{"../utils.js":"iSxC","./getusermedia":"s6SN","./getdisplaymedia":"VHa8"}],NZ1C:[function(o,e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.filterIceServers=s;var n=r(o("../utils"));function i(){if(typeof WeakMap!="function")return null;var a=new WeakMap;return i=function(){return a},a}function r(a){if(a&&a.__esModule)return a;if(a===null||typeof a!="object"&&typeof a!="function")return{default:a};var l=i();if(l&&l.has(a))return l.get(a);var c={},u=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var d in a)if(Object.prototype.hasOwnProperty.call(a,d)){var h=u?Object.getOwnPropertyDescriptor(a,d):null;h&&(h.get||h.set)?Object.defineProperty(c,d,h):c[d]=a[d]}return c.default=a,l&&l.set(a,c),c}function s(a,l){var c=!1;return(a=JSON.parse(JSON.stringify(a))).filter(function(u){if(u&&(u.urls||u.url)){var d=u.urls||u.url;u.url&&!u.urls&&n.deprecated("RTCIceServer.url","RTCIceServer.urls");var h=typeof d=="string";return h&&(d=[d]),d=d.filter(function(f){if(f.indexOf("stun:")===0)return!1;var p=f.startsWith("turn")&&!f.startsWith("turn:[")&&f.includes("transport=udp");return p&&!c?(c=!0,!0):p&&!c}),delete u.url,u.urls=h?d[0]:d,!!d.length}})}},{"../utils":"iSxC"}],YHvh:[function(o,e,t){"use strict";var n={generateIdentifier:function(){return Math.random().toString(36).substr(2,10)}};n.localCName=n.generateIdentifier(),n.splitLines=function(i){return i.trim().split(`
`).map(function(r){return r.trim()})},n.splitSections=function(i){return i.split(`
m=`).map(function(r,s){return(s>0?"m="+r:r).trim()+`\r
`})},n.getDescription=function(i){var r=n.splitSections(i);return r&&r[0]},n.getMediaSections=function(i){var r=n.splitSections(i);return r.shift(),r},n.matchPrefix=function(i,r){return n.splitLines(i).filter(function(s){return s.indexOf(r)===0})},n.parseCandidate=function(i){for(var r,s={foundation:(r=i.indexOf("a=candidate:")===0?i.substring(12).split(" "):i.substring(10).split(" "))[0],component:parseInt(r[1],10),protocol:r[2].toLowerCase(),priority:parseInt(r[3],10),ip:r[4],address:r[4],port:parseInt(r[5],10),type:r[7]},a=8;a<r.length;a+=2)switch(r[a]){case"raddr":s.relatedAddress=r[a+1];break;case"rport":s.relatedPort=parseInt(r[a+1],10);break;case"tcptype":s.tcpType=r[a+1];break;case"ufrag":s.ufrag=r[a+1],s.usernameFragment=r[a+1];break;default:s[r[a]]=r[a+1]}return s},n.writeCandidate=function(i){var r=[];r.push(i.foundation),r.push(i.component),r.push(i.protocol.toUpperCase()),r.push(i.priority),r.push(i.address||i.ip),r.push(i.port);var s=i.type;return r.push("typ"),r.push(s),s!=="host"&&i.relatedAddress&&i.relatedPort&&(r.push("raddr"),r.push(i.relatedAddress),r.push("rport"),r.push(i.relatedPort)),i.tcpType&&i.protocol.toLowerCase()==="tcp"&&(r.push("tcptype"),r.push(i.tcpType)),(i.usernameFragment||i.ufrag)&&(r.push("ufrag"),r.push(i.usernameFragment||i.ufrag)),"candidate:"+r.join(" ")},n.parseIceOptions=function(i){return i.substr(14).split(" ")},n.parseRtpMap=function(i){var r=i.substr(9).split(" "),s={payloadType:parseInt(r.shift(),10)};return r=r[0].split("/"),s.name=r[0],s.clockRate=parseInt(r[1],10),s.channels=r.length===3?parseInt(r[2],10):1,s.numChannels=s.channels,s},n.writeRtpMap=function(i){var r=i.payloadType;i.preferredPayloadType!==void 0&&(r=i.preferredPayloadType);var s=i.channels||i.numChannels||1;return"a=rtpmap:"+r+" "+i.name+"/"+i.clockRate+(s!==1?"/"+s:"")+`\r
`},n.parseExtmap=function(i){var r=i.substr(9).split(" ");return{id:parseInt(r[0],10),direction:r[0].indexOf("/")>0?r[0].split("/")[1]:"sendrecv",uri:r[1]}},n.writeExtmap=function(i){return"a=extmap:"+(i.id||i.preferredId)+(i.direction&&i.direction!=="sendrecv"?"/"+i.direction:"")+" "+i.uri+`\r
`},n.parseFmtp=function(i){for(var r,s={},a=i.substr(i.indexOf(" ")+1).split(";"),l=0;l<a.length;l++)s[(r=a[l].trim().split("="))[0].trim()]=r[1];return s},n.writeFmtp=function(i){var r="",s=i.payloadType;if(i.preferredPayloadType!==void 0&&(s=i.preferredPayloadType),i.parameters&&Object.keys(i.parameters).length){var a=[];Object.keys(i.parameters).forEach(function(l){i.parameters[l]?a.push(l+"="+i.parameters[l]):a.push(l)}),r+="a=fmtp:"+s+" "+a.join(";")+`\r
`}return r},n.parseRtcpFb=function(i){var r=i.substr(i.indexOf(" ")+1).split(" ");return{type:r.shift(),parameter:r.join(" ")}},n.writeRtcpFb=function(i){var r="",s=i.payloadType;return i.preferredPayloadType!==void 0&&(s=i.preferredPayloadType),i.rtcpFeedback&&i.rtcpFeedback.length&&i.rtcpFeedback.forEach(function(a){r+="a=rtcp-fb:"+s+" "+a.type+(a.parameter&&a.parameter.length?" "+a.parameter:"")+`\r
`}),r},n.parseSsrcMedia=function(i){var r=i.indexOf(" "),s={ssrc:parseInt(i.substr(7,r-7),10)},a=i.indexOf(":",r);return a>-1?(s.attribute=i.substr(r+1,a-r-1),s.value=i.substr(a+1)):s.attribute=i.substr(r+1),s},n.parseSsrcGroup=function(i){var r=i.substr(13).split(" ");return{semantics:r.shift(),ssrcs:r.map(function(s){return parseInt(s,10)})}},n.getMid=function(i){var r=n.matchPrefix(i,"a=mid:")[0];if(r)return r.substr(6)},n.parseFingerprint=function(i){var r=i.substr(14).split(" ");return{algorithm:r[0].toLowerCase(),value:r[1]}},n.getDtlsParameters=function(i,r){return{role:"auto",fingerprints:n.matchPrefix(i+r,"a=fingerprint:").map(n.parseFingerprint)}},n.writeDtlsParameters=function(i,r){var s="a=setup:"+r+`\r
`;return i.fingerprints.forEach(function(a){s+="a=fingerprint:"+a.algorithm+" "+a.value+`\r
`}),s},n.parseCryptoLine=function(i){var r=i.substr(9).split(" ");return{tag:parseInt(r[0],10),cryptoSuite:r[1],keyParams:r[2],sessionParams:r.slice(3)}},n.writeCryptoLine=function(i){return"a=crypto:"+i.tag+" "+i.cryptoSuite+" "+(typeof i.keyParams=="object"?n.writeCryptoKeyParams(i.keyParams):i.keyParams)+(i.sessionParams?" "+i.sessionParams.join(" "):"")+`\r
`},n.parseCryptoKeyParams=function(i){if(i.indexOf("inline:")!==0)return null;var r=i.substr(7).split("|");return{keyMethod:"inline",keySalt:r[0],lifeTime:r[1],mkiValue:r[2]?r[2].split(":")[0]:void 0,mkiLength:r[2]?r[2].split(":")[1]:void 0}},n.writeCryptoKeyParams=function(i){return i.keyMethod+":"+i.keySalt+(i.lifeTime?"|"+i.lifeTime:"")+(i.mkiValue&&i.mkiLength?"|"+i.mkiValue+":"+i.mkiLength:"")},n.getCryptoParameters=function(i,r){return n.matchPrefix(i+r,"a=crypto:").map(n.parseCryptoLine)},n.getIceParameters=function(i,r){var s=n.matchPrefix(i+r,"a=ice-ufrag:")[0],a=n.matchPrefix(i+r,"a=ice-pwd:")[0];return s&&a?{usernameFragment:s.substr(12),password:a.substr(10)}:null},n.writeIceParameters=function(i){return"a=ice-ufrag:"+i.usernameFragment+`\r
a=ice-pwd:`+i.password+`\r
`},n.parseRtpParameters=function(i){for(var r={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},s=n.splitLines(i)[0].split(" "),a=3;a<s.length;a++){var l=s[a],c=n.matchPrefix(i,"a=rtpmap:"+l+" ")[0];if(c){var u=n.parseRtpMap(c),d=n.matchPrefix(i,"a=fmtp:"+l+" ");switch(u.parameters=d.length?n.parseFmtp(d[0]):{},u.rtcpFeedback=n.matchPrefix(i,"a=rtcp-fb:"+l+" ").map(n.parseRtcpFb),r.codecs.push(u),u.name.toUpperCase()){case"RED":case"ULPFEC":r.fecMechanisms.push(u.name.toUpperCase())}}}return n.matchPrefix(i,"a=extmap:").forEach(function(h){r.headerExtensions.push(n.parseExtmap(h))}),r},n.writeRtpDescription=function(i,r){var s="";s+="m="+i+" ",s+=r.codecs.length>0?"9":"0",s+=" UDP/TLS/RTP/SAVPF ",s+=r.codecs.map(function(l){return l.preferredPayloadType!==void 0?l.preferredPayloadType:l.payloadType}).join(" ")+`\r
`,s+=`c=IN IP4 0.0.0.0\r
`,s+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,r.codecs.forEach(function(l){s+=n.writeRtpMap(l),s+=n.writeFmtp(l),s+=n.writeRtcpFb(l)});var a=0;return r.codecs.forEach(function(l){l.maxptime>a&&(a=l.maxptime)}),a>0&&(s+="a=maxptime:"+a+`\r
`),s+=`a=rtcp-mux\r
`,r.headerExtensions&&r.headerExtensions.forEach(function(l){s+=n.writeExtmap(l)}),s},n.parseRtpEncodingParameters=function(i){var r,s=[],a=n.parseRtpParameters(i),l=a.fecMechanisms.indexOf("RED")!==-1,c=a.fecMechanisms.indexOf("ULPFEC")!==-1,u=n.matchPrefix(i,"a=ssrc:").map(function(p){return n.parseSsrcMedia(p)}).filter(function(p){return p.attribute==="cname"}),d=u.length>0&&u[0].ssrc,h=n.matchPrefix(i,"a=ssrc-group:FID").map(function(p){return p.substr(17).split(" ").map(function(g){return parseInt(g,10)})});h.length>0&&h[0].length>1&&h[0][0]===d&&(r=h[0][1]),a.codecs.forEach(function(p){if(p.name.toUpperCase()==="RTX"&&p.parameters.apt){var g={ssrc:d,codecPayloadType:parseInt(p.parameters.apt,10)};d&&r&&(g.rtx={ssrc:r}),s.push(g),l&&((g=JSON.parse(JSON.stringify(g))).fec={ssrc:d,mechanism:c?"red+ulpfec":"red"},s.push(g))}}),s.length===0&&d&&s.push({ssrc:d});var f=n.matchPrefix(i,"b=");return f.length&&(f=f[0].indexOf("b=TIAS:")===0?parseInt(f[0].substr(7),10):f[0].indexOf("b=AS:")===0?1e3*parseInt(f[0].substr(5),10)*.95-16e3:void 0,s.forEach(function(p){p.maxBitrate=f})),s},n.parseRtcpParameters=function(i){var r={},s=n.matchPrefix(i,"a=ssrc:").map(function(c){return n.parseSsrcMedia(c)}).filter(function(c){return c.attribute==="cname"})[0];s&&(r.cname=s.value,r.ssrc=s.ssrc);var a=n.matchPrefix(i,"a=rtcp-rsize");r.reducedSize=a.length>0,r.compound=a.length===0;var l=n.matchPrefix(i,"a=rtcp-mux");return r.mux=l.length>0,r},n.parseMsid=function(i){var r,s=n.matchPrefix(i,"a=msid:");if(s.length===1)return{stream:(r=s[0].substr(7).split(" "))[0],track:r[1]};var a=n.matchPrefix(i,"a=ssrc:").map(function(l){return n.parseSsrcMedia(l)}).filter(function(l){return l.attribute==="msid"});return a.length>0?{stream:(r=a[0].value.split(" "))[0],track:r[1]}:void 0},n.parseSctpDescription=function(i){var r,s=n.parseMLine(i),a=n.matchPrefix(i,"a=max-message-size:");a.length>0&&(r=parseInt(a[0].substr(19),10)),isNaN(r)&&(r=65536);var l=n.matchPrefix(i,"a=sctp-port:");if(l.length>0)return{port:parseInt(l[0].substr(12),10),protocol:s.fmt,maxMessageSize:r};if(n.matchPrefix(i,"a=sctpmap:").length>0){var c=n.matchPrefix(i,"a=sctpmap:")[0].substr(10).split(" ");return{port:parseInt(c[0],10),protocol:c[1],maxMessageSize:r}}},n.writeSctpDescription=function(i,r){var s=[];return s=i.protocol!=="DTLS/SCTP"?["m="+i.kind+" 9 "+i.protocol+" "+r.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+r.port+`\r
`]:["m="+i.kind+" 9 "+i.protocol+" "+r.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+r.port+" "+r.protocol+` 65535\r
`],r.maxMessageSize!==void 0&&s.push("a=max-message-size:"+r.maxMessageSize+`\r
`),s.join("")},n.generateSessionId=function(){return Math.random().toString().substr(2,21)},n.writeSessionBoilerplate=function(i,r,s){var a=r!==void 0?r:2;return`v=0\r
o=`+(s||"thisisadapterortc")+" "+(i||n.generateSessionId())+" "+a+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},n.writeMediaSection=function(i,r,s,a){var l=n.writeRtpDescription(i.kind,r);if(l+=n.writeIceParameters(i.iceGatherer.getLocalParameters()),l+=n.writeDtlsParameters(i.dtlsTransport.getLocalParameters(),s==="offer"?"actpass":"active"),l+="a=mid:"+i.mid+`\r
`,i.direction?l+="a="+i.direction+`\r
`:i.rtpSender&&i.rtpReceiver?l+=`a=sendrecv\r
`:i.rtpSender?l+=`a=sendonly\r
`:i.rtpReceiver?l+=`a=recvonly\r
`:l+=`a=inactive\r
`,i.rtpSender){var c="msid:"+a.id+" "+i.rtpSender.track.id+`\r
`;l+="a="+c,l+="a=ssrc:"+i.sendEncodingParameters[0].ssrc+" "+c,i.sendEncodingParameters[0].rtx&&(l+="a=ssrc:"+i.sendEncodingParameters[0].rtx.ssrc+" "+c,l+="a=ssrc-group:FID "+i.sendEncodingParameters[0].ssrc+" "+i.sendEncodingParameters[0].rtx.ssrc+`\r
`)}return l+="a=ssrc:"+i.sendEncodingParameters[0].ssrc+" cname:"+n.localCName+`\r
`,i.rtpSender&&i.sendEncodingParameters[0].rtx&&(l+="a=ssrc:"+i.sendEncodingParameters[0].rtx.ssrc+" cname:"+n.localCName+`\r
`),l},n.getDirection=function(i,r){for(var s=n.splitLines(i),a=0;a<s.length;a++)switch(s[a]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return s[a].substr(2)}return r?n.getDirection(r):"sendrecv"},n.getKind=function(i){return n.splitLines(i)[0].split(" ")[0].substr(2)},n.isRejected=function(i){return i.split(" ",2)[1]==="0"},n.parseMLine=function(i){var r=n.splitLines(i)[0].substr(2).split(" ");return{kind:r[0],port:parseInt(r[1],10),protocol:r[2],fmt:r.slice(3).join(" ")}},n.parseOLine=function(i){var r=n.matchPrefix(i,"o=")[0].substr(2).split(" ");return{username:r[0],sessionId:r[1],sessionVersion:parseInt(r[2],10),netType:r[3],addressType:r[4],address:r[5]}},n.isValidSDP=function(i){if(typeof i!="string"||i.length===0)return!1;for(var r=n.splitLines(i),s=0;s<r.length;s++)if(r[s].length<2||r[s].charAt(1)!=="=")return!1;return!0},typeof e=="object"&&(e.exports=n)},{}],NJ2u:[function(o,e,t){"use strict";var n=o("sdp");function i(d){return{inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[d.type]||d.type}function r(d,h,f,p,g){var v=n.writeRtpDescription(d.kind,h);if(v+=n.writeIceParameters(d.iceGatherer.getLocalParameters()),v+=n.writeDtlsParameters(d.dtlsTransport.getLocalParameters(),f==="offer"?"actpass":g||"active"),v+="a=mid:"+d.mid+`\r
`,d.rtpSender&&d.rtpReceiver?v+=`a=sendrecv\r
`:d.rtpSender?v+=`a=sendonly\r
`:d.rtpReceiver?v+=`a=recvonly\r
`:v+=`a=inactive\r
`,d.rtpSender){var y=d.rtpSender._initialTrackId||d.rtpSender.track.id;d.rtpSender._initialTrackId=y;var m="msid:"+(p?p.id:"-")+" "+y+`\r
`;v+="a="+m,v+="a=ssrc:"+d.sendEncodingParameters[0].ssrc+" "+m,d.sendEncodingParameters[0].rtx&&(v+="a=ssrc:"+d.sendEncodingParameters[0].rtx.ssrc+" "+m,v+="a=ssrc-group:FID "+d.sendEncodingParameters[0].ssrc+" "+d.sendEncodingParameters[0].rtx.ssrc+`\r
`)}return v+="a=ssrc:"+d.sendEncodingParameters[0].ssrc+" cname:"+n.localCName+`\r
`,d.rtpSender&&d.sendEncodingParameters[0].rtx&&(v+="a=ssrc:"+d.sendEncodingParameters[0].rtx.ssrc+" cname:"+n.localCName+`\r
`),v}function s(d,h){var f=!1;return(d=JSON.parse(JSON.stringify(d))).filter(function(p){if(p&&(p.urls||p.url)){var g=p.urls||p.url;p.url&&!p.urls&&console.warn("RTCIceServer.url is deprecated! Use urls instead.");var v=typeof g=="string";return v&&(g=[g]),g=g.filter(function(y){return y.indexOf("turn:")===0&&y.indexOf("transport=udp")!==-1&&y.indexOf("turn:[")===-1&&!f?(f=!0,!0):y.indexOf("stun:")===0&&h>=14393&&y.indexOf("?transport=udp")===-1}),delete p.url,p.urls=v?g[0]:g,!!g.length}})}function a(d,h){var f={codecs:[],headerExtensions:[],fecMechanisms:[]},p=function(v,y){v=parseInt(v,10);for(var m=0;m<y.length;m++)if(y[m].payloadType===v||y[m].preferredPayloadType===v)return y[m]},g=function(v,y,m,x){var _=p(v.parameters.apt,m),w=p(y.parameters.apt,x);return _&&w&&_.name.toLowerCase()===w.name.toLowerCase()};return d.codecs.forEach(function(v){for(var y=0;y<h.codecs.length;y++){var m=h.codecs[y];if(v.name.toLowerCase()===m.name.toLowerCase()&&v.clockRate===m.clockRate){if(v.name.toLowerCase()==="rtx"&&v.parameters&&m.parameters.apt&&!g(v,m,d.codecs,h.codecs))continue;(m=JSON.parse(JSON.stringify(m))).numChannels=Math.min(v.numChannels,m.numChannels),f.codecs.push(m),m.rtcpFeedback=m.rtcpFeedback.filter(function(x){for(var _=0;_<v.rtcpFeedback.length;_++)if(v.rtcpFeedback[_].type===x.type&&v.rtcpFeedback[_].parameter===x.parameter)return!0;return!1});break}}}),d.headerExtensions.forEach(function(v){for(var y=0;y<h.headerExtensions.length;y++){var m=h.headerExtensions[y];if(v.uri===m.uri){f.headerExtensions.push(m);break}}}),f}function l(d,h,f){return{offer:{setLocalDescription:["stable","have-local-offer"],setRemoteDescription:["stable","have-remote-offer"]},answer:{setLocalDescription:["have-remote-offer","have-local-pranswer"],setRemoteDescription:["have-local-offer","have-remote-pranswer"]}}[h][d].indexOf(f)!==-1}function c(d,h){var f=d.getRemoteCandidates().find(function(p){return h.foundation===p.foundation&&h.ip===p.ip&&h.port===p.port&&h.priority===p.priority&&h.protocol===p.protocol&&h.type===p.type});return f||d.addRemoteCandidate(h),!f}function u(d,h){var f=new Error(h);return f.name=d,f.code={NotSupportedError:9,InvalidStateError:11,InvalidAccessError:15,TypeError:void 0,OperationError:void 0}[d],f}e.exports=function(d,h){function f(y,m){m.addTrack(y),m.dispatchEvent(new d.MediaStreamTrackEvent("addtrack",{track:y}))}function p(y,m,x,_){var w=new Event("track");w.track=m,w.receiver=x,w.transceiver={receiver:x},w.streams=_,d.setTimeout(function(){y._dispatchEvent("track",w)})}var g=function(y){var m=this,x=document.createDocumentFragment();if(["addEventListener","removeEventListener","dispatchEvent"].forEach(function(w){m[w]=x[w].bind(x)}),this.canTrickleIceCandidates=null,this.needNegotiation=!1,this.localStreams=[],this.remoteStreams=[],this._localDescription=null,this._remoteDescription=null,this.signalingState="stable",this.iceConnectionState="new",this.connectionState="new",this.iceGatheringState="new",y=JSON.parse(JSON.stringify(y||{})),this.usingBundle=y.bundlePolicy==="max-bundle",y.rtcpMuxPolicy==="negotiate")throw u("NotSupportedError","rtcpMuxPolicy 'negotiate' is not supported");switch(y.rtcpMuxPolicy||(y.rtcpMuxPolicy="require"),y.iceTransportPolicy){case"all":case"relay":break;default:y.iceTransportPolicy="all"}switch(y.bundlePolicy){case"balanced":case"max-compat":case"max-bundle":break;default:y.bundlePolicy="balanced"}if(y.iceServers=s(y.iceServers||[],h),this._iceGatherers=[],y.iceCandidatePoolSize)for(var _=y.iceCandidatePoolSize;_>0;_--)this._iceGatherers.push(new d.RTCIceGatherer({iceServers:y.iceServers,gatherPolicy:y.iceTransportPolicy}));else y.iceCandidatePoolSize=0;this._config=y,this.transceivers=[],this._sdpSessionId=n.generateSessionId(),this._sdpSessionVersion=0,this._dtlsRole=void 0,this._isClosed=!1};Object.defineProperty(g.prototype,"localDescription",{configurable:!0,get:function(){return this._localDescription}}),Object.defineProperty(g.prototype,"remoteDescription",{configurable:!0,get:function(){return this._remoteDescription}}),g.prototype.onicecandidate=null,g.prototype.onaddstream=null,g.prototype.ontrack=null,g.prototype.onremovestream=null,g.prototype.onsignalingstatechange=null,g.prototype.oniceconnectionstatechange=null,g.prototype.onconnectionstatechange=null,g.prototype.onicegatheringstatechange=null,g.prototype.onnegotiationneeded=null,g.prototype.ondatachannel=null,g.prototype._dispatchEvent=function(y,m){this._isClosed||(this.dispatchEvent(m),typeof this["on"+y]=="function"&&this["on"+y](m))},g.prototype._emitGatheringStateChange=function(){var y=new Event("icegatheringstatechange");this._dispatchEvent("icegatheringstatechange",y)},g.prototype.getConfiguration=function(){return this._config},g.prototype.getLocalStreams=function(){return this.localStreams},g.prototype.getRemoteStreams=function(){return this.remoteStreams},g.prototype._createTransceiver=function(y,m){var x=this.transceivers.length>0,_={track:null,iceGatherer:null,iceTransport:null,dtlsTransport:null,localCapabilities:null,remoteCapabilities:null,rtpSender:null,rtpReceiver:null,kind:y,mid:null,sendEncodingParameters:null,recvEncodingParameters:null,stream:null,associatedRemoteMediaStreams:[],wantReceive:!0};if(this.usingBundle&&x)_.iceTransport=this.transceivers[0].iceTransport,_.dtlsTransport=this.transceivers[0].dtlsTransport;else{var w=this._createIceAndDtlsTransports();_.iceTransport=w.iceTransport,_.dtlsTransport=w.dtlsTransport}return m||this.transceivers.push(_),_},g.prototype.addTrack=function(y,m){if(this._isClosed)throw u("InvalidStateError","Attempted to call addTrack on a closed peerconnection.");var x;if(this.transceivers.find(function(w){return w.track===y}))throw u("InvalidAccessError","Track already exists.");for(var _=0;_<this.transceivers.length;_++)this.transceivers[_].track||this.transceivers[_].kind!==y.kind||(x=this.transceivers[_]);return x||(x=this._createTransceiver(y.kind)),this._maybeFireNegotiationNeeded(),this.localStreams.indexOf(m)===-1&&this.localStreams.push(m),x.track=y,x.stream=m,x.rtpSender=new d.RTCRtpSender(y,x.dtlsTransport),x.rtpSender},g.prototype.addStream=function(y){var m=this;if(h>=15025)y.getTracks().forEach(function(_){m.addTrack(_,y)});else{var x=y.clone();y.getTracks().forEach(function(_,w){var b=x.getTracks()[w];_.addEventListener("enabled",function(M){b.enabled=M.enabled})}),x.getTracks().forEach(function(_){m.addTrack(_,x)})}},g.prototype.removeTrack=function(y){if(this._isClosed)throw u("InvalidStateError","Attempted to call removeTrack on a closed peerconnection.");if(!(y instanceof d.RTCRtpSender))throw new TypeError("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.");var m=this.transceivers.find(function(_){return _.rtpSender===y});if(!m)throw u("InvalidAccessError","Sender was not created by this connection.");var x=m.stream;m.rtpSender.stop(),m.rtpSender=null,m.track=null,m.stream=null,this.transceivers.map(function(_){return _.stream}).indexOf(x)===-1&&this.localStreams.indexOf(x)>-1&&this.localStreams.splice(this.localStreams.indexOf(x),1),this._maybeFireNegotiationNeeded()},g.prototype.removeStream=function(y){var m=this;y.getTracks().forEach(function(x){var _=m.getSenders().find(function(w){return w.track===x});_&&m.removeTrack(_)})},g.prototype.getSenders=function(){return this.transceivers.filter(function(y){return!!y.rtpSender}).map(function(y){return y.rtpSender})},g.prototype.getReceivers=function(){return this.transceivers.filter(function(y){return!!y.rtpReceiver}).map(function(y){return y.rtpReceiver})},g.prototype._createIceGatherer=function(y,m){var x=this;if(m&&y>0)return this.transceivers[0].iceGatherer;if(this._iceGatherers.length)return this._iceGatherers.shift();var _=new d.RTCIceGatherer({iceServers:this._config.iceServers,gatherPolicy:this._config.iceTransportPolicy});return Object.defineProperty(_,"state",{value:"new",writable:!0}),this.transceivers[y].bufferedCandidateEvents=[],this.transceivers[y].bufferCandidates=function(w){var b=!w.candidate||Object.keys(w.candidate).length===0;_.state=b?"completed":"gathering",x.transceivers[y].bufferedCandidateEvents!==null&&x.transceivers[y].bufferedCandidateEvents.push(w)},_.addEventListener("localcandidate",this.transceivers[y].bufferCandidates),_},g.prototype._gather=function(y,m){var x=this,_=this.transceivers[m].iceGatherer;if(!_.onlocalcandidate){var w=this.transceivers[m].bufferedCandidateEvents;this.transceivers[m].bufferedCandidateEvents=null,_.removeEventListener("localcandidate",this.transceivers[m].bufferCandidates),_.onlocalcandidate=function(b){if(!(x.usingBundle&&m>0)){var M=new Event("icecandidate");M.candidate={sdpMid:y,sdpMLineIndex:m};var S=b.candidate,E=!S||Object.keys(S).length===0;if(E)_.state!=="new"&&_.state!=="gathering"||(_.state="completed");else{_.state==="new"&&(_.state="gathering"),S.component=1,S.ufrag=_.getLocalParameters().usernameFragment;var A=n.writeCandidate(S);M.candidate=Object.assign(M.candidate,n.parseCandidate(A)),M.candidate.candidate=A,M.candidate.toJSON=function(){return{candidate:M.candidate.candidate,sdpMid:M.candidate.sdpMid,sdpMLineIndex:M.candidate.sdpMLineIndex,usernameFragment:M.candidate.usernameFragment}}}var L=n.getMediaSections(x._localDescription.sdp);L[M.candidate.sdpMLineIndex]+=E?`a=end-of-candidates\r
`:"a="+M.candidate.candidate+`\r
`,x._localDescription.sdp=n.getDescription(x._localDescription.sdp)+L.join("");var B=x.transceivers.every(function(R){return R.iceGatherer&&R.iceGatherer.state==="completed"});x.iceGatheringState!=="gathering"&&(x.iceGatheringState="gathering",x._emitGatheringStateChange()),E||x._dispatchEvent("icecandidate",M),B&&(x._dispatchEvent("icecandidate",new Event("icecandidate")),x.iceGatheringState="complete",x._emitGatheringStateChange())}},d.setTimeout(function(){w.forEach(function(b){_.onlocalcandidate(b)})},0)}},g.prototype._createIceAndDtlsTransports=function(){var y=this,m=new d.RTCIceTransport(null);m.onicestatechange=function(){y._updateIceConnectionState(),y._updateConnectionState()};var x=new d.RTCDtlsTransport(m);return x.ondtlsstatechange=function(){y._updateConnectionState()},x.onerror=function(){Object.defineProperty(x,"state",{value:"failed",writable:!0}),y._updateConnectionState()},{iceTransport:m,dtlsTransport:x}},g.prototype._disposeIceAndDtlsTransports=function(y){var m=this.transceivers[y].iceGatherer;m&&(delete m.onlocalcandidate,delete this.transceivers[y].iceGatherer);var x=this.transceivers[y].iceTransport;x&&(delete x.onicestatechange,delete this.transceivers[y].iceTransport);var _=this.transceivers[y].dtlsTransport;_&&(delete _.ondtlsstatechange,delete _.onerror,delete this.transceivers[y].dtlsTransport)},g.prototype._transceive=function(y,m,x){var _=a(y.localCapabilities,y.remoteCapabilities);m&&y.rtpSender&&(_.encodings=y.sendEncodingParameters,_.rtcp={cname:n.localCName,compound:y.rtcpParameters.compound},y.recvEncodingParameters.length&&(_.rtcp.ssrc=y.recvEncodingParameters[0].ssrc),y.rtpSender.send(_)),x&&y.rtpReceiver&&_.codecs.length>0&&(y.kind==="video"&&y.recvEncodingParameters&&h<15019&&y.recvEncodingParameters.forEach(function(w){delete w.rtx}),y.recvEncodingParameters.length?_.encodings=y.recvEncodingParameters:_.encodings=[{}],_.rtcp={compound:y.rtcpParameters.compound},y.rtcpParameters.cname&&(_.rtcp.cname=y.rtcpParameters.cname),y.sendEncodingParameters.length&&(_.rtcp.ssrc=y.sendEncodingParameters[0].ssrc),y.rtpReceiver.receive(_))},g.prototype.setLocalDescription=function(y){var m,x,_=this;if(["offer","answer"].indexOf(y.type)===-1)return Promise.reject(u("TypeError",'Unsupported type "'+y.type+'"'));if(!l("setLocalDescription",y.type,_.signalingState)||_._isClosed)return Promise.reject(u("InvalidStateError","Can not set local "+y.type+" in state "+_.signalingState));if(y.type==="offer")m=n.splitSections(y.sdp),x=m.shift(),m.forEach(function(b,M){var S=n.parseRtpParameters(b);_.transceivers[M].localCapabilities=S}),_.transceivers.forEach(function(b,M){_._gather(b.mid,M)});else if(y.type==="answer"){m=n.splitSections(_._remoteDescription.sdp),x=m.shift();var w=n.matchPrefix(x,"a=ice-lite").length>0;m.forEach(function(b,M){var S=_.transceivers[M],E=S.iceGatherer,A=S.iceTransport,L=S.dtlsTransport,B=S.localCapabilities,R=S.remoteCapabilities;if(!(n.isRejected(b)&&n.matchPrefix(b,"a=bundle-only").length===0)&&!S.rejected){var D=n.getIceParameters(b,x),P=n.getDtlsParameters(b,x);w&&(P.role="server"),_.usingBundle&&M!==0||(_._gather(S.mid,M),A.state==="new"&&A.start(E,D,w?"controlling":"controlled"),L.state==="new"&&L.start(P));var I=a(B,R);_._transceive(S,I.codecs.length>0,!1)}})}return _._localDescription={type:y.type,sdp:y.sdp},y.type==="offer"?_._updateSignalingState("have-local-offer"):_._updateSignalingState("stable"),Promise.resolve()},g.prototype.setRemoteDescription=function(y){var m=this;if(["offer","answer"].indexOf(y.type)===-1)return Promise.reject(u("TypeError",'Unsupported type "'+y.type+'"'));if(!l("setRemoteDescription",y.type,m.signalingState)||m._isClosed)return Promise.reject(u("InvalidStateError","Can not set remote "+y.type+" in state "+m.signalingState));var x={};m.remoteStreams.forEach(function(A){x[A.id]=A});var _=[],w=n.splitSections(y.sdp),b=w.shift(),M=n.matchPrefix(b,"a=ice-lite").length>0,S=n.matchPrefix(b,"a=group:BUNDLE ").length>0;m.usingBundle=S;var E=n.matchPrefix(b,"a=ice-options:")[0];return m.canTrickleIceCandidates=!!E&&E.substr(14).split(" ").indexOf("trickle")>=0,w.forEach(function(A,L){var B=n.splitLines(A),R=n.getKind(A),D=n.isRejected(A)&&n.matchPrefix(A,"a=bundle-only").length===0,P=B[0].substr(2).split(" ")[2],I=n.getDirection(A,b),N=n.parseMsid(A),G=n.getMid(A)||n.generateIdentifier();if(D||R==="application"&&(P==="DTLS/SCTP"||P==="UDP/DTLS/SCTP"))m.transceivers[L]={mid:G,kind:R,protocol:P,rejected:!0};else{var z,se,ne,Q,j,O,ee,V,ie;!D&&m.transceivers[L]&&m.transceivers[L].rejected&&(m.transceivers[L]=m._createTransceiver(R,!0));var ue,ye,pe=n.parseRtpParameters(A);D||(ue=n.getIceParameters(A,b),(ye=n.getDtlsParameters(A,b)).role="client"),ee=n.parseRtpEncodingParameters(A);var xe=n.parseRtcpParameters(A),X=n.matchPrefix(A,"a=end-of-candidates",b).length>0,$=n.matchPrefix(A,"a=candidate:").map(function(H){return n.parseCandidate(H)}).filter(function(H){return H.component===1});if((y.type==="offer"||y.type==="answer")&&!D&&S&&L>0&&m.transceivers[L]&&(m._disposeIceAndDtlsTransports(L),m.transceivers[L].iceGatherer=m.transceivers[0].iceGatherer,m.transceivers[L].iceTransport=m.transceivers[0].iceTransport,m.transceivers[L].dtlsTransport=m.transceivers[0].dtlsTransport,m.transceivers[L].rtpSender&&m.transceivers[L].rtpSender.setTransport(m.transceivers[0].dtlsTransport),m.transceivers[L].rtpReceiver&&m.transceivers[L].rtpReceiver.setTransport(m.transceivers[0].dtlsTransport)),y.type!=="offer"||D)y.type==="answer"&&!D&&(se=(z=m.transceivers[L]).iceGatherer,ne=z.iceTransport,Q=z.dtlsTransport,j=z.rtpReceiver,O=z.sendEncodingParameters,V=z.localCapabilities,m.transceivers[L].recvEncodingParameters=ee,m.transceivers[L].remoteCapabilities=pe,m.transceivers[L].rtcpParameters=xe,$.length&&ne.state==="new"&&(!M&&!X||S&&L!==0?$.forEach(function(H){c(z.iceTransport,H)}):ne.setRemoteCandidates($)),S&&L!==0||(ne.state==="new"&&ne.start(se,ue,"controlling"),Q.state==="new"&&Q.start(ye)),!a(z.localCapabilities,z.remoteCapabilities).codecs.filter(function(H){return H.name.toLowerCase()==="rtx"}).length&&z.sendEncodingParameters[0].rtx&&delete z.sendEncodingParameters[0].rtx,m._transceive(z,I==="sendrecv"||I==="recvonly",I==="sendrecv"||I==="sendonly"),!j||I!=="sendrecv"&&I!=="sendonly"?delete z.rtpReceiver:(ie=j.track,N?(x[N.stream]||(x[N.stream]=new d.MediaStream),f(ie,x[N.stream]),_.push([ie,j,x[N.stream]])):(x.default||(x.default=new d.MediaStream),f(ie,x.default),_.push([ie,j,x.default]))));else{(z=m.transceivers[L]||m._createTransceiver(R)).mid=G,z.iceGatherer||(z.iceGatherer=m._createIceGatherer(L,S)),$.length&&z.iceTransport.state==="new"&&(!X||S&&L!==0?$.forEach(function(H){c(z.iceTransport,H)}):z.iceTransport.setRemoteCandidates($)),V=d.RTCRtpReceiver.getCapabilities(R),h<15019&&(V.codecs=V.codecs.filter(function(H){return H.name!=="rtx"})),O=z.sendEncodingParameters||[{ssrc:1001*(2*L+2)}];var J,ce=!1;I==="sendrecv"||I==="sendonly"?(ce=!z.rtpReceiver,j=z.rtpReceiver||new d.RTCRtpReceiver(z.dtlsTransport,R),ce&&(ie=j.track,N&&N.stream==="-"||(N?(x[N.stream]||(x[N.stream]=new d.MediaStream,Object.defineProperty(x[N.stream],"id",{get:function(){return N.stream}})),Object.defineProperty(ie,"id",{get:function(){return N.track}}),J=x[N.stream]):(x.default||(x.default=new d.MediaStream),J=x.default)),J&&(f(ie,J),z.associatedRemoteMediaStreams.push(J)),_.push([ie,j,J]))):z.rtpReceiver&&z.rtpReceiver.track&&(z.associatedRemoteMediaStreams.forEach(function(H){var T,C,W=H.getTracks().find(function(Z){return Z.id===z.rtpReceiver.track.id});W&&(T=W,(C=H).removeTrack(T),C.dispatchEvent(new d.MediaStreamTrackEvent("removetrack",{track:T})))}),z.associatedRemoteMediaStreams=[]),z.localCapabilities=V,z.remoteCapabilities=pe,z.rtpReceiver=j,z.rtcpParameters=xe,z.sendEncodingParameters=O,z.recvEncodingParameters=ee,m._transceive(m.transceivers[L],!1,ce)}}}),m._dtlsRole===void 0&&(m._dtlsRole=y.type==="offer"?"active":"passive"),m._remoteDescription={type:y.type,sdp:y.sdp},y.type==="offer"?m._updateSignalingState("have-remote-offer"):m._updateSignalingState("stable"),Object.keys(x).forEach(function(A){var L=x[A];if(L.getTracks().length){if(m.remoteStreams.indexOf(L)===-1){m.remoteStreams.push(L);var B=new Event("addstream");B.stream=L,d.setTimeout(function(){m._dispatchEvent("addstream",B)})}_.forEach(function(R){var D=R[0],P=R[1];L.id===R[2].id&&p(m,D,P,[L])})}}),_.forEach(function(A){A[2]||p(m,A[0],A[1],[])}),d.setTimeout(function(){m&&m.transceivers&&m.transceivers.forEach(function(A){A.iceTransport&&A.iceTransport.state==="new"&&A.iceTransport.getRemoteCandidates().length>0&&(console.warn("Timeout for addRemoteCandidate. Consider sending an end-of-candidates notification"),A.iceTransport.addRemoteCandidate({}))})},4e3),Promise.resolve()},g.prototype.close=function(){this.transceivers.forEach(function(y){y.iceTransport&&y.iceTransport.stop(),y.dtlsTransport&&y.dtlsTransport.stop(),y.rtpSender&&y.rtpSender.stop(),y.rtpReceiver&&y.rtpReceiver.stop()}),this._isClosed=!0,this._updateSignalingState("closed")},g.prototype._updateSignalingState=function(y){this.signalingState=y;var m=new Event("signalingstatechange");this._dispatchEvent("signalingstatechange",m)},g.prototype._maybeFireNegotiationNeeded=function(){var y=this;this.signalingState==="stable"&&this.needNegotiation!==!0&&(this.needNegotiation=!0,d.setTimeout(function(){if(y.needNegotiation){y.needNegotiation=!1;var m=new Event("negotiationneeded");y._dispatchEvent("negotiationneeded",m)}},0))},g.prototype._updateIceConnectionState=function(){var y,m={new:0,closed:0,checking:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach(function(_){_.iceTransport&&!_.rejected&&m[_.iceTransport.state]++}),y="new",m.failed>0?y="failed":m.checking>0?y="checking":m.disconnected>0?y="disconnected":m.new>0?y="new":m.connected>0?y="connected":m.completed>0&&(y="completed"),y!==this.iceConnectionState){this.iceConnectionState=y;var x=new Event("iceconnectionstatechange");this._dispatchEvent("iceconnectionstatechange",x)}},g.prototype._updateConnectionState=function(){var y,m={new:0,closed:0,connecting:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach(function(_){_.iceTransport&&_.dtlsTransport&&!_.rejected&&(m[_.iceTransport.state]++,m[_.dtlsTransport.state]++)}),m.connected+=m.completed,y="new",m.failed>0?y="failed":m.connecting>0?y="connecting":m.disconnected>0?y="disconnected":m.new>0?y="new":m.connected>0&&(y="connected"),y!==this.connectionState){this.connectionState=y;var x=new Event("connectionstatechange");this._dispatchEvent("connectionstatechange",x)}},g.prototype.createOffer=function(){var y=this;if(y._isClosed)return Promise.reject(u("InvalidStateError","Can not call createOffer after close"));var m=y.transceivers.filter(function(M){return M.kind==="audio"}).length,x=y.transceivers.filter(function(M){return M.kind==="video"}).length,_=arguments[0];if(_){if(_.mandatory||_.optional)throw new TypeError("Legacy mandatory/optional constraints not supported.");_.offerToReceiveAudio!==void 0&&(m=_.offerToReceiveAudio===!0?1:_.offerToReceiveAudio===!1?0:_.offerToReceiveAudio),_.offerToReceiveVideo!==void 0&&(x=_.offerToReceiveVideo===!0?1:_.offerToReceiveVideo===!1?0:_.offerToReceiveVideo)}for(y.transceivers.forEach(function(M){M.kind==="audio"?--m<0&&(M.wantReceive=!1):M.kind==="video"&&--x<0&&(M.wantReceive=!1)});m>0||x>0;)m>0&&(y._createTransceiver("audio"),m--),x>0&&(y._createTransceiver("video"),x--);var w=n.writeSessionBoilerplate(y._sdpSessionId,y._sdpSessionVersion++);y.transceivers.forEach(function(M,S){var E=M.track,A=M.kind,L=M.mid||n.generateIdentifier();M.mid=L,M.iceGatherer||(M.iceGatherer=y._createIceGatherer(S,y.usingBundle));var B=d.RTCRtpSender.getCapabilities(A);h<15019&&(B.codecs=B.codecs.filter(function(D){return D.name!=="rtx"})),B.codecs.forEach(function(D){D.name==="H264"&&D.parameters["level-asymmetry-allowed"]===void 0&&(D.parameters["level-asymmetry-allowed"]="1"),M.remoteCapabilities&&M.remoteCapabilities.codecs&&M.remoteCapabilities.codecs.forEach(function(P){D.name.toLowerCase()===P.name.toLowerCase()&&D.clockRate===P.clockRate&&(D.preferredPayloadType=P.payloadType)})}),B.headerExtensions.forEach(function(D){(M.remoteCapabilities&&M.remoteCapabilities.headerExtensions||[]).forEach(function(P){D.uri===P.uri&&(D.id=P.id)})});var R=M.sendEncodingParameters||[{ssrc:1001*(2*S+1)}];E&&h>=15019&&A==="video"&&!R[0].rtx&&(R[0].rtx={ssrc:R[0].ssrc+1}),M.wantReceive&&(M.rtpReceiver=new d.RTCRtpReceiver(M.dtlsTransport,A)),M.localCapabilities=B,M.sendEncodingParameters=R}),y._config.bundlePolicy!=="max-compat"&&(w+="a=group:BUNDLE "+y.transceivers.map(function(M){return M.mid}).join(" ")+`\r
`),w+=`a=ice-options:trickle\r
`,y.transceivers.forEach(function(M,S){w+=r(M,M.localCapabilities,"offer",M.stream,y._dtlsRole),w+=`a=rtcp-rsize\r
`,!M.iceGatherer||y.iceGatheringState==="new"||S!==0&&y.usingBundle||(M.iceGatherer.getLocalCandidates().forEach(function(E){E.component=1,w+="a="+n.writeCandidate(E)+`\r
`}),M.iceGatherer.state==="completed"&&(w+=`a=end-of-candidates\r
`))});var b=new d.RTCSessionDescription({type:"offer",sdp:w});return Promise.resolve(b)},g.prototype.createAnswer=function(){var y=this;if(y._isClosed)return Promise.reject(u("InvalidStateError","Can not call createAnswer after close"));if(y.signalingState!=="have-remote-offer"&&y.signalingState!=="have-local-pranswer")return Promise.reject(u("InvalidStateError","Can not call createAnswer in signalingState "+y.signalingState));var m=n.writeSessionBoilerplate(y._sdpSessionId,y._sdpSessionVersion++);y.usingBundle&&(m+="a=group:BUNDLE "+y.transceivers.map(function(w){return w.mid}).join(" ")+`\r
`),m+=`a=ice-options:trickle\r
`;var x=n.getMediaSections(y._remoteDescription.sdp).length;y.transceivers.forEach(function(w,b){if(!(b+1>x)){if(w.rejected)return w.kind==="application"?w.protocol==="DTLS/SCTP"?m+=`m=application 0 DTLS/SCTP 5000\r
`:m+="m=application 0 "+w.protocol+` webrtc-datachannel\r
`:w.kind==="audio"?m+=`m=audio 0 UDP/TLS/RTP/SAVPF 0\r
a=rtpmap:0 PCMU/8000\r
`:w.kind==="video"&&(m+=`m=video 0 UDP/TLS/RTP/SAVPF 120\r
a=rtpmap:120 VP8/90000\r
`),void(m+=`c=IN IP4 0.0.0.0\r
a=inactive\r
a=mid:`+w.mid+`\r
`);var M;w.stream&&(w.kind==="audio"?M=w.stream.getAudioTracks()[0]:w.kind==="video"&&(M=w.stream.getVideoTracks()[0]),M&&h>=15019&&w.kind==="video"&&!w.sendEncodingParameters[0].rtx&&(w.sendEncodingParameters[0].rtx={ssrc:w.sendEncodingParameters[0].ssrc+1}));var S=a(w.localCapabilities,w.remoteCapabilities);!S.codecs.filter(function(E){return E.name.toLowerCase()==="rtx"}).length&&w.sendEncodingParameters[0].rtx&&delete w.sendEncodingParameters[0].rtx,m+=r(w,S,"answer",w.stream,y._dtlsRole),w.rtcpParameters&&w.rtcpParameters.reducedSize&&(m+=`a=rtcp-rsize\r
`)}});var _=new d.RTCSessionDescription({type:"answer",sdp:m});return Promise.resolve(_)},g.prototype.addIceCandidate=function(y){var m,x=this;return y&&y.sdpMLineIndex===void 0&&!y.sdpMid?Promise.reject(new TypeError("sdpMLineIndex or sdpMid required")):new Promise(function(_,w){if(!x._remoteDescription)return w(u("InvalidStateError","Can not add ICE candidate without a remote description"));if(y&&y.candidate!==""){var b=y.sdpMLineIndex;if(y.sdpMid){for(var M=0;M<x.transceivers.length;M++)if(x.transceivers[M].mid===y.sdpMid){b=M;break}}var S=x.transceivers[b];if(!S)return w(u("OperationError","Can not add ICE candidate"));if(S.rejected)return _();var E=Object.keys(y.candidate).length>0?n.parseCandidate(y.candidate):{};if(E.protocol==="tcp"&&(E.port===0||E.port===9)||E.component&&E.component!==1)return _();if((b===0||b>0&&S.iceTransport!==x.transceivers[0].iceTransport)&&!c(S.iceTransport,E))return w(u("OperationError","Can not add ICE candidate"));var A=y.candidate.trim();A.indexOf("a=")===0&&(A=A.substr(2)),(m=n.getMediaSections(x._remoteDescription.sdp))[b]+="a="+(E.type?A:"end-of-candidates")+`\r
`,x._remoteDescription.sdp=n.getDescription(x._remoteDescription.sdp)+m.join("")}else for(var L=0;L<x.transceivers.length&&(x.transceivers[L].rejected||(x.transceivers[L].iceTransport.addRemoteCandidate({}),(m=n.getMediaSections(x._remoteDescription.sdp))[L]+=`a=end-of-candidates\r
`,x._remoteDescription.sdp=n.getDescription(x._remoteDescription.sdp)+m.join(""),!x.usingBundle));L++);_()})},g.prototype.getStats=function(y){if(y&&y instanceof d.MediaStreamTrack){var m=null;if(this.transceivers.forEach(function(_){_.rtpSender&&_.rtpSender.track===y?m=_.rtpSender:_.rtpReceiver&&_.rtpReceiver.track===y&&(m=_.rtpReceiver)}),!m)throw u("InvalidAccessError","Invalid selector.");return m.getStats()}var x=[];return this.transceivers.forEach(function(_){["rtpSender","rtpReceiver","iceGatherer","iceTransport","dtlsTransport"].forEach(function(w){_[w]&&x.push(_[w].getStats())})}),Promise.all(x).then(function(_){var w=new Map;return _.forEach(function(b){b.forEach(function(M){w.set(M.id,M)})}),w})},["RTCRtpSender","RTCRtpReceiver","RTCIceGatherer","RTCIceTransport","RTCDtlsTransport"].forEach(function(y){var m=d[y];if(m&&m.prototype&&m.prototype.getStats){var x=m.prototype.getStats;m.prototype.getStats=function(){return x.apply(this).then(function(_){var w=new Map;return Object.keys(_).forEach(function(b){_[b].type=i(_[b]),w.set(b,_[b])}),w})}}});var v=["createOffer","createAnswer"];return v.forEach(function(y){var m=g.prototype[y];g.prototype[y]=function(){var x=arguments;return typeof x[0]=="function"||typeof x[1]=="function"?m.apply(this,[arguments[2]]).then(function(_){typeof x[0]=="function"&&x[0].apply(null,[_])},function(_){typeof x[1]=="function"&&x[1].apply(null,[_])}):m.apply(this,arguments)}}),(v=["setLocalDescription","setRemoteDescription","addIceCandidate"]).forEach(function(y){var m=g.prototype[y];g.prototype[y]=function(){var x=arguments;return typeof x[1]=="function"||typeof x[2]=="function"?m.apply(this,arguments).then(function(){typeof x[1]=="function"&&x[1].apply(null)},function(_){typeof x[2]=="function"&&x[2].apply(null,[_])}):m.apply(this,arguments)}}),["getStats"].forEach(function(y){var m=g.prototype[y];g.prototype[y]=function(){var x=arguments;return typeof x[1]=="function"?m.apply(this,arguments).then(function(){typeof x[1]=="function"&&x[1].apply(null)}):m.apply(this,arguments)}}),g}},{sdp:"YHvh"}],YdKx:[function(o,e,t){"use strict";function n(i){var r=i&&i.navigator,s=r.mediaDevices.getUserMedia.bind(r.mediaDevices);r.mediaDevices.getUserMedia=function(a){return s(a).catch(function(l){return Promise.reject(function(c){return{name:{PermissionDeniedError:"NotAllowedError"}[c.name]||c.name,message:c.message,constraint:c.constraint,toString:function(){return this.name}}}(l))})}}Object.defineProperty(t,"__esModule",{value:!0}),t.shimGetUserMedia=n},{}],P3bV:[function(o,e,t){"use strict";function n(i){"getDisplayMedia"in i.navigator&&i.navigator.mediaDevices&&(i.navigator.mediaDevices&&"getDisplayMedia"in i.navigator.mediaDevices||(i.navigator.mediaDevices.getDisplayMedia=i.navigator.getDisplayMedia.bind(i.navigator)))}Object.defineProperty(t,"__esModule",{value:!0}),t.shimGetDisplayMedia=n},{}],XRic:[function(o,e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.shimPeerConnection=d,t.shimReplaceTrack=h,Object.defineProperty(t,"shimGetUserMedia",{enumerable:!0,get:function(){return s.shimGetUserMedia}}),Object.defineProperty(t,"shimGetDisplayMedia",{enumerable:!0,get:function(){return a.shimGetDisplayMedia}});var n=u(o("../utils")),i=o("./filtericeservers"),r=l(o("rtcpeerconnection-shim")),s=o("./getusermedia"),a=o("./getdisplaymedia");function l(f){return f&&f.__esModule?f:{default:f}}function c(){if(typeof WeakMap!="function")return null;var f=new WeakMap;return c=function(){return f},f}function u(f){if(f&&f.__esModule)return f;if(f===null||typeof f!="object"&&typeof f!="function")return{default:f};var p=c();if(p&&p.has(f))return p.get(f);var g={},v=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var y in f)if(Object.prototype.hasOwnProperty.call(f,y)){var m=v?Object.getOwnPropertyDescriptor(f,y):null;m&&(m.get||m.set)?Object.defineProperty(g,y,m):g[y]=f[y]}return g.default=f,p&&p.set(f,g),g}function d(f,p){if(f.RTCIceGatherer&&(f.RTCIceCandidate||(f.RTCIceCandidate=function(y){return y}),f.RTCSessionDescription||(f.RTCSessionDescription=function(y){return y}),p.version<15025)){var g=Object.getOwnPropertyDescriptor(f.MediaStreamTrack.prototype,"enabled");Object.defineProperty(f.MediaStreamTrack.prototype,"enabled",{set:function(y){g.set.call(this,y);var m=new Event("enabled");m.enabled=y,this.dispatchEvent(m)}})}!f.RTCRtpSender||"dtmf"in f.RTCRtpSender.prototype||Object.defineProperty(f.RTCRtpSender.prototype,"dtmf",{get:function(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=new f.RTCDtmfSender(this):this.track.kind==="video"&&(this._dtmf=null)),this._dtmf}}),f.RTCDtmfSender&&!f.RTCDTMFSender&&(f.RTCDTMFSender=f.RTCDtmfSender);var v=(0,r.default)(f,p.version);f.RTCPeerConnection=function(y){return y&&y.iceServers&&(y.iceServers=(0,i.filterIceServers)(y.iceServers,p.version),n.log("ICE servers after filtering:",y.iceServers)),new v(y)},f.RTCPeerConnection.prototype=v.prototype}function h(f){!f.RTCRtpSender||"replaceTrack"in f.RTCRtpSender.prototype||(f.RTCRtpSender.prototype.replaceTrack=f.RTCRtpSender.prototype.setTrack)}},{"../utils":"iSxC","./filtericeservers":"NZ1C","rtcpeerconnection-shim":"NJ2u","./getusermedia":"YdKx","./getdisplaymedia":"P3bV"}],GzSv:[function(o,e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.shimGetUserMedia=a;var n=r(o("../utils"));function i(){if(typeof WeakMap!="function")return null;var l=new WeakMap;return i=function(){return l},l}function r(l){if(l&&l.__esModule)return l;if(l===null||typeof l!="object"&&typeof l!="function")return{default:l};var c=i();if(c&&c.has(l))return c.get(l);var u={},d=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var h in l)if(Object.prototype.hasOwnProperty.call(l,h)){var f=d?Object.getOwnPropertyDescriptor(l,h):null;f&&(f.get||f.set)?Object.defineProperty(u,h,f):u[h]=l[h]}return u.default=l,c&&c.set(l,u),u}function s(l){return(s=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(c){return typeof c}:function(c){return c&&typeof Symbol=="function"&&c.constructor===Symbol&&c!==Symbol.prototype?"symbol":typeof c})(l)}function a(l,c){var u=l&&l.navigator,d=l&&l.MediaStreamTrack;if(u.getUserMedia=function(v,y,m){n.deprecated("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),u.mediaDevices.getUserMedia(v).then(y,m)},!(c.version>55&&"autoGainControl"in u.mediaDevices.getSupportedConstraints())){var h=function(v,y,m){y in v&&!(m in v)&&(v[m]=v[y],delete v[y])},f=u.mediaDevices.getUserMedia.bind(u.mediaDevices);if(u.mediaDevices.getUserMedia=function(v){return s(v)==="object"&&s(v.audio)==="object"&&(v=JSON.parse(JSON.stringify(v)),h(v.audio,"autoGainControl","mozAutoGainControl"),h(v.audio,"noiseSuppression","mozNoiseSuppression")),f(v)},d&&d.prototype.getSettings){var p=d.prototype.getSettings;d.prototype.getSettings=function(){var v=p.apply(this,arguments);return h(v,"mozAutoGainControl","autoGainControl"),h(v,"mozNoiseSuppression","noiseSuppression"),v}}if(d&&d.prototype.applyConstraints){var g=d.prototype.applyConstraints;d.prototype.applyConstraints=function(v){return this.kind==="audio"&&s(v)==="object"&&(v=JSON.parse(JSON.stringify(v)),h(v,"autoGainControl","mozAutoGainControl"),h(v,"noiseSuppression","mozNoiseSuppression")),g.apply(this,[v])}}}}},{"../utils":"iSxC"}],UuGU:[function(o,e,t){"use strict";function n(i,r){i.navigator.mediaDevices&&"getDisplayMedia"in i.navigator.mediaDevices||i.navigator.mediaDevices&&(i.navigator.mediaDevices.getDisplayMedia=function(s){if(!s||!s.video){var a=new DOMException("getDisplayMedia without video constraints is undefined");return a.name="NotFoundError",a.code=8,Promise.reject(a)}return s.video===!0?s.video={mediaSource:r}:s.video.mediaSource=r,i.navigator.mediaDevices.getUserMedia(s)})}Object.defineProperty(t,"__esModule",{value:!0}),t.shimGetDisplayMedia=n},{}],Fzdr:[function(o,e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.shimOnTrack=u,t.shimPeerConnection=d,t.shimSenderGetStats=h,t.shimReceiverGetStats=f,t.shimRemoveStream=p,t.shimRTCDataChannel=g,t.shimAddTransceiver=v,t.shimGetParameters=y,t.shimCreateOffer=m,t.shimCreateAnswer=x,Object.defineProperty(t,"shimGetUserMedia",{enumerable:!0,get:function(){return i.shimGetUserMedia}}),Object.defineProperty(t,"shimGetDisplayMedia",{enumerable:!0,get:function(){return r.shimGetDisplayMedia}});var n=a(o("../utils")),i=o("./getusermedia"),r=o("./getdisplaymedia");function s(){if(typeof WeakMap!="function")return null;var _=new WeakMap;return s=function(){return _},_}function a(_){if(_&&_.__esModule)return _;if(_===null||typeof _!="object"&&typeof _!="function")return{default:_};var w=s();if(w&&w.has(_))return w.get(_);var b={},M=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var S in _)if(Object.prototype.hasOwnProperty.call(_,S)){var E=M?Object.getOwnPropertyDescriptor(_,S):null;E&&(E.get||E.set)?Object.defineProperty(b,S,E):b[S]=_[S]}return b.default=_,w&&w.set(_,b),b}function l(_,w,b){return w in _?Object.defineProperty(_,w,{value:b,enumerable:!0,configurable:!0,writable:!0}):_[w]=b,_}function c(_){return(c=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(w){return typeof w}:function(w){return w&&typeof Symbol=="function"&&w.constructor===Symbol&&w!==Symbol.prototype?"symbol":typeof w})(_)}function u(_){c(_)==="object"&&_.RTCTrackEvent&&"receiver"in _.RTCTrackEvent.prototype&&!("transceiver"in _.RTCTrackEvent.prototype)&&Object.defineProperty(_.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})}function d(_,w){if(c(_)==="object"&&(_.RTCPeerConnection||_.mozRTCPeerConnection)){!_.RTCPeerConnection&&_.mozRTCPeerConnection&&(_.RTCPeerConnection=_.mozRTCPeerConnection),w.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(S){var E=_.RTCPeerConnection.prototype[S],A=l({},S,function(){return arguments[0]=new(S==="addIceCandidate"?_.RTCIceCandidate:_.RTCSessionDescription)(arguments[0]),E.apply(this,arguments)});_.RTCPeerConnection.prototype[S]=A[S]});var b={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},M=_.RTCPeerConnection.prototype.getStats;_.RTCPeerConnection.prototype.getStats=function(){var[S,E,A]=arguments;return M.apply(this,[S||null]).then(function(L){if(w.version<53&&!E)try{L.forEach(function(B){B.type=b[B.type]||B.type})}catch(B){if(B.name!=="TypeError")throw B;L.forEach(function(R,D){L.set(D,Object.assign({},R,{type:b[R.type]||R.type}))})}return L}).then(E,A)}}}function h(_){if(c(_)==="object"&&_.RTCPeerConnection&&_.RTCRtpSender&&!(_.RTCRtpSender&&"getStats"in _.RTCRtpSender.prototype)){var w=_.RTCPeerConnection.prototype.getSenders;w&&(_.RTCPeerConnection.prototype.getSenders=function(){var M=this,S=w.apply(this,[]);return S.forEach(function(E){return E._pc=M}),S});var b=_.RTCPeerConnection.prototype.addTrack;b&&(_.RTCPeerConnection.prototype.addTrack=function(){var M=b.apply(this,arguments);return M._pc=this,M}),_.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}}function f(_){if(c(_)==="object"&&_.RTCPeerConnection&&_.RTCRtpSender&&!(_.RTCRtpSender&&"getStats"in _.RTCRtpReceiver.prototype)){var w=_.RTCPeerConnection.prototype.getReceivers;w&&(_.RTCPeerConnection.prototype.getReceivers=function(){var b=this,M=w.apply(this,[]);return M.forEach(function(S){return S._pc=b}),M}),n.wrapPeerConnectionEvent(_,"track",function(b){return b.receiver._pc=b.srcElement,b}),_.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}}function p(_){!_.RTCPeerConnection||"removeStream"in _.RTCPeerConnection.prototype||(_.RTCPeerConnection.prototype.removeStream=function(w){var b=this;n.deprecated("removeStream","removeTrack"),this.getSenders().forEach(function(M){M.track&&w.getTracks().includes(M.track)&&b.removeTrack(M)})})}function g(_){_.DataChannel&&!_.RTCDataChannel&&(_.RTCDataChannel=_.DataChannel)}function v(_){if(c(_)==="object"&&_.RTCPeerConnection){var w=_.RTCPeerConnection.prototype.addTransceiver;w&&(_.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];var b=arguments[1],M=b&&"sendEncodings"in b;M&&b.sendEncodings.forEach(function(L){if("rid"in L&&!/^[a-z0-9]{0,16}$/i.test(L.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in L&&!(parseFloat(L.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in L&&!(parseFloat(L.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});var S=w.apply(this,arguments);if(M){var{sender:E}=S,A=E.getParameters();"encodings"in A&&(A.encodings.length!==1||Object.keys(A.encodings[0]).length!==0)||(A.encodings=b.sendEncodings,E.sendEncodings=b.sendEncodings,this.setParametersPromises.push(E.setParameters(A).then(function(){delete E.sendEncodings}).catch(function(){delete E.sendEncodings})))}return S})}}function y(_){if(c(_)==="object"&&_.RTCRtpSender){var w=_.RTCRtpSender.prototype.getParameters;w&&(_.RTCRtpSender.prototype.getParameters=function(){var b=w.apply(this,arguments);return"encodings"in b||(b.encodings=[].concat(this.sendEncodings||[{}])),b})}}function m(_){if(c(_)==="object"&&_.RTCPeerConnection){var w=_.RTCPeerConnection.prototype.createOffer;_.RTCPeerConnection.prototype.createOffer=function(){var b=arguments,M=this;return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(function(){return w.apply(M,b)}).finally(function(){M.setParametersPromises=[]}):w.apply(this,arguments)}}}function x(_){if(c(_)==="object"&&_.RTCPeerConnection){var w=_.RTCPeerConnection.prototype.createAnswer;_.RTCPeerConnection.prototype.createAnswer=function(){var b=arguments,M=this;return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(function(){return w.apply(M,b)}).finally(function(){M.setParametersPromises=[]}):w.apply(this,arguments)}}}},{"../utils":"iSxC","./getusermedia":"GzSv","./getdisplaymedia":"UuGU"}],t1lL:[function(o,e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.shimLocalStreamsAPI=a,t.shimRemoteStreamsAPI=l,t.shimCallbacksAPI=c,t.shimGetUserMedia=u,t.shimConstraints=d,t.shimRTCIceServerUrls=h,t.shimTrackEventTransceiver=f,t.shimCreateOfferLegacy=p,t.shimAudioContext=g;var n=r(o("../utils"));function i(){if(typeof WeakMap!="function")return null;var v=new WeakMap;return i=function(){return v},v}function r(v){if(v&&v.__esModule)return v;if(v===null||typeof v!="object"&&typeof v!="function")return{default:v};var y=i();if(y&&y.has(v))return y.get(v);var m={},x=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var _ in v)if(Object.prototype.hasOwnProperty.call(v,_)){var w=x?Object.getOwnPropertyDescriptor(v,_):null;w&&(w.get||w.set)?Object.defineProperty(m,_,w):m[_]=v[_]}return m.default=v,y&&y.set(v,m),m}function s(v){return(s=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(y){return typeof y}:function(y){return y&&typeof Symbol=="function"&&y.constructor===Symbol&&y!==Symbol.prototype?"symbol":typeof y})(v)}function a(v){if(s(v)==="object"&&v.RTCPeerConnection){if("getLocalStreams"in v.RTCPeerConnection.prototype||(v.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in v.RTCPeerConnection.prototype)){var y=v.RTCPeerConnection.prototype.addTrack;v.RTCPeerConnection.prototype.addStream=function(m){var x=this;this._localStreams||(this._localStreams=[]),this._localStreams.includes(m)||this._localStreams.push(m),m.getAudioTracks().forEach(function(_){return y.call(x,_,m)}),m.getVideoTracks().forEach(function(_){return y.call(x,_,m)})},v.RTCPeerConnection.prototype.addTrack=function(m){for(var x=this,_=arguments.length,w=new Array(_>1?_-1:0),b=1;b<_;b++)w[b-1]=arguments[b];return w&&w.forEach(function(M){x._localStreams?x._localStreams.includes(M)||x._localStreams.push(M):x._localStreams=[M]}),y.apply(this,arguments)}}"removeStream"in v.RTCPeerConnection.prototype||(v.RTCPeerConnection.prototype.removeStream=function(m){var x=this;this._localStreams||(this._localStreams=[]);var _=this._localStreams.indexOf(m);if(_!==-1){this._localStreams.splice(_,1);var w=m.getTracks();this.getSenders().forEach(function(b){w.includes(b.track)&&x.removeTrack(b)})}})}}function l(v){if(s(v)==="object"&&v.RTCPeerConnection&&("getRemoteStreams"in v.RTCPeerConnection.prototype||(v.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in v.RTCPeerConnection.prototype))){Object.defineProperty(v.RTCPeerConnection.prototype,"onaddstream",{get:function(){return this._onaddstream},set:function(m){var x=this;this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=m),this.addEventListener("track",this._onaddstreampoly=function(_){_.streams.forEach(function(w){if(x._remoteStreams||(x._remoteStreams=[]),!x._remoteStreams.includes(w)){x._remoteStreams.push(w);var b=new Event("addstream");b.stream=w,x.dispatchEvent(b)}})})}});var y=v.RTCPeerConnection.prototype.setRemoteDescription;v.RTCPeerConnection.prototype.setRemoteDescription=function(){var m=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(x){x.streams.forEach(function(_){if(m._remoteStreams||(m._remoteStreams=[]),!(m._remoteStreams.indexOf(_)>=0)){m._remoteStreams.push(_);var w=new Event("addstream");w.stream=_,m.dispatchEvent(w)}})}),y.apply(m,arguments)}}}function c(v){if(s(v)==="object"&&v.RTCPeerConnection){var y=v.RTCPeerConnection.prototype,m=y.createOffer,x=y.createAnswer,_=y.setLocalDescription,w=y.setRemoteDescription,b=y.addIceCandidate;y.createOffer=function(S,E){var A=arguments.length>=2?arguments[2]:arguments[0],L=m.apply(this,[A]);return E?(L.then(S,E),Promise.resolve()):L},y.createAnswer=function(S,E){var A=arguments.length>=2?arguments[2]:arguments[0],L=x.apply(this,[A]);return E?(L.then(S,E),Promise.resolve()):L};var M=function(S,E,A){var L=_.apply(this,[S]);return A?(L.then(E,A),Promise.resolve()):L};y.setLocalDescription=M,M=function(S,E,A){var L=w.apply(this,[S]);return A?(L.then(E,A),Promise.resolve()):L},y.setRemoteDescription=M,M=function(S,E,A){var L=b.apply(this,[S]);return A?(L.then(E,A),Promise.resolve()):L},y.addIceCandidate=M}}function u(v){var y=v&&v.navigator;if(y.mediaDevices&&y.mediaDevices.getUserMedia){var m=y.mediaDevices,x=m.getUserMedia.bind(m);y.mediaDevices.getUserMedia=function(_){return x(d(_))}}!y.getUserMedia&&y.mediaDevices&&y.mediaDevices.getUserMedia&&(y.getUserMedia=function(_,w,b){y.mediaDevices.getUserMedia(_).then(w,b)}.bind(y))}function d(v){return v&&v.video!==void 0?Object.assign({},v,{video:n.compactObject(v.video)}):v}function h(v){if(v.RTCPeerConnection){var y=v.RTCPeerConnection;v.RTCPeerConnection=function(m,x){if(m&&m.iceServers){for(var _=[],w=0;w<m.iceServers.length;w++){var b=m.iceServers[w];!b.hasOwnProperty("urls")&&b.hasOwnProperty("url")?(n.deprecated("RTCIceServer.url","RTCIceServer.urls"),(b=JSON.parse(JSON.stringify(b))).urls=b.url,delete b.url,_.push(b)):_.push(m.iceServers[w])}m.iceServers=_}return new y(m,x)},v.RTCPeerConnection.prototype=y.prototype,"generateCertificate"in y&&Object.defineProperty(v.RTCPeerConnection,"generateCertificate",{get:function(){return y.generateCertificate}})}}function f(v){s(v)==="object"&&v.RTCTrackEvent&&"receiver"in v.RTCTrackEvent.prototype&&!("transceiver"in v.RTCTrackEvent.prototype)&&Object.defineProperty(v.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})}function p(v){var y=v.RTCPeerConnection.prototype.createOffer;v.RTCPeerConnection.prototype.createOffer=function(m){if(m){m.offerToReceiveAudio!==void 0&&(m.offerToReceiveAudio=!!m.offerToReceiveAudio);var x=this.getTransceivers().find(function(w){return w.receiver.track.kind==="audio"});m.offerToReceiveAudio===!1&&x?x.direction==="sendrecv"?x.setDirection?x.setDirection("sendonly"):x.direction="sendonly":x.direction==="recvonly"&&(x.setDirection?x.setDirection("inactive"):x.direction="inactive"):m.offerToReceiveAudio!==!0||x||this.addTransceiver("audio"),m.offerToReceiveVideo!==void 0&&(m.offerToReceiveVideo=!!m.offerToReceiveVideo);var _=this.getTransceivers().find(function(w){return w.receiver.track.kind==="video"});m.offerToReceiveVideo===!1&&_?_.direction==="sendrecv"?_.setDirection?_.setDirection("sendonly"):_.direction="sendonly":_.direction==="recvonly"&&(_.setDirection?_.setDirection("inactive"):_.direction="inactive"):m.offerToReceiveVideo!==!0||_||this.addTransceiver("video")}return y.apply(this,arguments)}}function g(v){s(v)!=="object"||v.AudioContext||(v.AudioContext=v.webkitAudioContext)}},{"../utils":"iSxC"}],GOQK:[function(o,e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.shimRTCIceCandidate=c,t.shimMaxMessageSize=u,t.shimSendThrowTypeError=d,t.shimConnectionState=h,t.removeExtmapAllowMixed=f,t.shimAddIceCandidateNullOrEmpty=p;var n=a(o("sdp")),i=s(o("./utils"));function r(){if(typeof WeakMap!="function")return null;var g=new WeakMap;return r=function(){return g},g}function s(g){if(g&&g.__esModule)return g;if(g===null||typeof g!="object"&&typeof g!="function")return{default:g};var v=r();if(v&&v.has(g))return v.get(g);var y={},m=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var x in g)if(Object.prototype.hasOwnProperty.call(g,x)){var _=m?Object.getOwnPropertyDescriptor(g,x):null;_&&(_.get||_.set)?Object.defineProperty(y,x,_):y[x]=g[x]}return y.default=g,v&&v.set(g,y),y}function a(g){return g&&g.__esModule?g:{default:g}}function l(g){return(l=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(v){return typeof v}:function(v){return v&&typeof Symbol=="function"&&v.constructor===Symbol&&v!==Symbol.prototype?"symbol":typeof v})(g)}function c(g){if(g.RTCIceCandidate&&!(g.RTCIceCandidate&&"foundation"in g.RTCIceCandidate.prototype)){var v=g.RTCIceCandidate;g.RTCIceCandidate=function(y){if(l(y)==="object"&&y.candidate&&y.candidate.indexOf("a=")===0&&((y=JSON.parse(JSON.stringify(y))).candidate=y.candidate.substr(2)),y.candidate&&y.candidate.length){var m=new v(y),x=n.default.parseCandidate(y.candidate),_=Object.assign(m,x);return _.toJSON=function(){return{candidate:_.candidate,sdpMid:_.sdpMid,sdpMLineIndex:_.sdpMLineIndex,usernameFragment:_.usernameFragment}},_}return new v(y)},g.RTCIceCandidate.prototype=v.prototype,i.wrapPeerConnectionEvent(g,"icecandidate",function(y){return y.candidate&&Object.defineProperty(y,"candidate",{value:new g.RTCIceCandidate(y.candidate),writable:"false"}),y})}}function u(g,v){if(g.RTCPeerConnection){"sctp"in g.RTCPeerConnection.prototype||Object.defineProperty(g.RTCPeerConnection.prototype,"sctp",{get:function(){return this._sctp===void 0?null:this._sctp}});var y=g.RTCPeerConnection.prototype.setRemoteDescription;g.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,v.browser==="chrome"&&v.version>=76){var{sdpSemantics:m}=this.getConfiguration();m==="plan-b"&&Object.defineProperty(this,"sctp",{get:function(){return this._sctp===void 0?null:this._sctp},enumerable:!0,configurable:!0})}if(function(A){if(!A||!A.sdp)return!1;var L=n.default.splitSections(A.sdp);return L.shift(),L.some(function(B){var R=n.default.parseMLine(B);return R&&R.kind==="application"&&R.protocol.indexOf("SCTP")!==-1})}(arguments[0])){var x,_=function(A){var L=A.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(L===null||L.length<2)return-1;var B=parseInt(L[1],10);return B!=B?-1:B}(arguments[0]),w=(S=_,E=65536,v.browser==="firefox"&&(E=v.version<57?S===-1?16384:2147483637:v.version<60?v.version===57?65535:65536:2147483637),E),b=function(A,L){var B=65536;v.browser==="firefox"&&v.version===57&&(B=65535);var R=n.default.matchPrefix(A.sdp,"a=max-message-size:");return R.length>0?B=parseInt(R[0].substr(19),10):v.browser==="firefox"&&L!==-1&&(B=2147483637),B}(arguments[0],_);x=w===0&&b===0?Number.POSITIVE_INFINITY:w===0||b===0?Math.max(w,b):Math.min(w,b);var M={};Object.defineProperty(M,"maxMessageSize",{get:function(){return x}}),this._sctp=M}var S,E;return y.apply(this,arguments)}}}function d(g){if(g.RTCPeerConnection&&"createDataChannel"in g.RTCPeerConnection.prototype){var v=g.RTCPeerConnection.prototype.createDataChannel;g.RTCPeerConnection.prototype.createDataChannel=function(){var m=v.apply(this,arguments);return y(m,this),m},i.wrapPeerConnectionEvent(g,"datachannel",function(m){return y(m.channel,m.target),m})}function y(m,x){var _=m.send;m.send=function(){var w=arguments[0],b=w.length||w.size||w.byteLength;if(m.readyState==="open"&&x.sctp&&b>x.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+x.sctp.maxMessageSize+" bytes)");return _.apply(m,arguments)}}}function h(g){if(g.RTCPeerConnection&&!("connectionState"in g.RTCPeerConnection.prototype)){var v=g.RTCPeerConnection.prototype;Object.defineProperty(v,"connectionState",{get:function(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(v,"onconnectionstatechange",{get:function(){return this._onconnectionstatechange||null},set:function(y){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),y&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=y)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(function(y){var m=v[y];v[y]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=function(x){var _=x.target;if(_._lastConnectionState!==_.connectionState){_._lastConnectionState=_.connectionState;var w=new Event("connectionstatechange",x);_.dispatchEvent(w)}return x},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),m.apply(this,arguments)}})}}function f(g,v){if(g.RTCPeerConnection&&!(v.browser==="chrome"&&v.version>=71||v.browser==="safari"&&v.version>=605)){var y=g.RTCPeerConnection.prototype.setRemoteDescription;g.RTCPeerConnection.prototype.setRemoteDescription=function(m){if(m&&m.sdp&&m.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){var x=m.sdp.split(`
`).filter(function(_){return _.trim()!=="a=extmap-allow-mixed"}).join(`
`);g.RTCSessionDescription&&m instanceof g.RTCSessionDescription?arguments[0]=new g.RTCSessionDescription({type:m.type,sdp:x}):m.sdp=x}return y.apply(this,arguments)}}}function p(g,v){if(g.RTCPeerConnection&&g.RTCPeerConnection.prototype){var y=g.RTCPeerConnection.prototype.addIceCandidate;y&&y.length!==0&&(g.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(v.browser==="chrome"&&v.version<78||v.browser==="firefox"&&v.version<68||v.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?Promise.resolve():y.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}}},{sdp:"YHvh","./utils":"iSxC"}],KtlG:[function(o,e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.adapterFactory=d;var n=u(o("./utils")),i=u(o("./chrome/chrome_shim")),r=u(o("./edge/edge_shim")),s=u(o("./firefox/firefox_shim")),a=u(o("./safari/safari_shim")),l=u(o("./common_shim"));function c(){if(typeof WeakMap!="function")return null;var h=new WeakMap;return c=function(){return h},h}function u(h){if(h&&h.__esModule)return h;if(h===null||typeof h!="object"&&typeof h!="function")return{default:h};var f=c();if(f&&f.has(h))return f.get(h);var p={},g=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var v in h)if(Object.prototype.hasOwnProperty.call(h,v)){var y=g?Object.getOwnPropertyDescriptor(h,v):null;y&&(y.get||y.set)?Object.defineProperty(p,v,y):p[v]=h[v]}return p.default=h,f&&f.set(h,p),p}function d(){var{window:h}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},f=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimEdge:!0,shimSafari:!0},p=n.log,g=n.detectBrowser(h),v={browserDetails:g,commonShim:l,extractVersion:n.extractVersion,disableLog:n.disableLog,disableWarnings:n.disableWarnings};switch(g.browser){case"chrome":if(!i||!i.shimPeerConnection||!f.shimChrome)return p("Chrome shim is not included in this adapter release."),v;if(g.version===null)return p("Chrome shim can not determine version, not shimming."),v;p("adapter.js shimming chrome."),v.browserShim=i,l.shimAddIceCandidateNullOrEmpty(h,g),i.shimGetUserMedia(h,g),i.shimMediaStream(h,g),i.shimPeerConnection(h,g),i.shimOnTrack(h,g),i.shimAddTrackRemoveTrack(h,g),i.shimGetSendersWithDtmf(h,g),i.shimGetStats(h,g),i.shimSenderReceiverGetStats(h,g),i.fixNegotiationNeeded(h,g),l.shimRTCIceCandidate(h,g),l.shimConnectionState(h,g),l.shimMaxMessageSize(h,g),l.shimSendThrowTypeError(h,g),l.removeExtmapAllowMixed(h,g);break;case"firefox":if(!s||!s.shimPeerConnection||!f.shimFirefox)return p("Firefox shim is not included in this adapter release."),v;p("adapter.js shimming firefox."),v.browserShim=s,l.shimAddIceCandidateNullOrEmpty(h,g),s.shimGetUserMedia(h,g),s.shimPeerConnection(h,g),s.shimOnTrack(h,g),s.shimRemoveStream(h,g),s.shimSenderGetStats(h,g),s.shimReceiverGetStats(h,g),s.shimRTCDataChannel(h,g),s.shimAddTransceiver(h,g),s.shimGetParameters(h,g),s.shimCreateOffer(h,g),s.shimCreateAnswer(h,g),l.shimRTCIceCandidate(h,g),l.shimConnectionState(h,g),l.shimMaxMessageSize(h,g),l.shimSendThrowTypeError(h,g);break;case"edge":if(!r||!r.shimPeerConnection||!f.shimEdge)return p("MS edge shim is not included in this adapter release."),v;p("adapter.js shimming edge."),v.browserShim=r,r.shimGetUserMedia(h,g),r.shimGetDisplayMedia(h,g),r.shimPeerConnection(h,g),r.shimReplaceTrack(h,g),l.shimMaxMessageSize(h,g),l.shimSendThrowTypeError(h,g);break;case"safari":if(!a||!f.shimSafari)return p("Safari shim is not included in this adapter release."),v;p("adapter.js shimming safari."),v.browserShim=a,l.shimAddIceCandidateNullOrEmpty(h,g),a.shimRTCIceServerUrls(h,g),a.shimCreateOfferLegacy(h,g),a.shimCallbacksAPI(h,g),a.shimLocalStreamsAPI(h,g),a.shimRemoteStreamsAPI(h,g),a.shimTrackEventTransceiver(h,g),a.shimGetUserMedia(h,g),a.shimAudioContext(h,g),l.shimRTCIceCandidate(h,g),l.shimMaxMessageSize(h,g),l.shimSendThrowTypeError(h,g),l.removeExtmapAllowMixed(h,g);break;default:p("Unsupported browser!")}return v}},{"./utils":"iSxC","./chrome/chrome_shim":"uI5X","./edge/edge_shim":"XRic","./firefox/firefox_shim":"Fzdr","./safari/safari_shim":"t1lL","./common_shim":"GOQK"}],tI1X:[function(o,e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=o("./adapter_factory.js"),i=(0,n.adapterFactory)({window:typeof window=="undefined"?void 0:window}),r=i;t.default=r},{"./adapter_factory.js":"KtlG"}],sXtV:[function(o,e,t){"use strict";var n=this&&this.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(t,"__esModule",{value:!0}),t.webRTCAdapter=void 0;var i=n(o("webrtc-adapter"));t.webRTCAdapter=i.default},{"webrtc-adapter":"tI1X"}],I31f:[function(o,e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Supports=void 0;var n=o("./adapter");t.Supports=new(function(){function i(){this.isIOS=["iPad","iPhone","iPod"].includes(navigator.platform),this.supportedBrowsers=["firefox","chrome","safari"],this.minFirefoxVersion=59,this.minChromeVersion=72,this.minSafariVersion=605}return i.prototype.isWebRTCSupported=function(){return typeof RTCPeerConnection!="undefined"},i.prototype.isBrowserSupported=function(){var r=this.getBrowser(),s=this.getVersion();return!!this.supportedBrowsers.includes(r)&&(r==="chrome"?s>=this.minChromeVersion:r==="firefox"?s>=this.minFirefoxVersion:r==="safari"&&!this.isIOS&&s>=this.minSafariVersion)},i.prototype.getBrowser=function(){return n.webRTCAdapter.browserDetails.browser},i.prototype.getVersion=function(){return n.webRTCAdapter.browserDetails.version||0},i.prototype.isUnifiedPlanSupported=function(){var r,s=this.getBrowser(),a=n.webRTCAdapter.browserDetails.version||0;if(s==="chrome"&&a<72)return!1;if(s==="firefox"&&a>=59)return!0;if(!(window.RTCRtpTransceiver&&"currentDirection"in RTCRtpTransceiver.prototype))return!1;var l=!1;try{(r=new RTCPeerConnection).addTransceiver("audio"),l=!0}catch(c){}finally{r&&r.close()}return l},i.prototype.toString=function(){return`Supports: 
    browser:`+this.getBrowser()+` 
    version:`+this.getVersion()+` 
    isIOS:`+this.isIOS+` 
    isWebRTCSupported:`+this.isWebRTCSupported()+` 
    isBrowserSupported:`+this.isBrowserSupported()+` 
    isUnifiedPlanSupported:`+this.isUnifiedPlanSupported()},i}())},{"./adapter":"sXtV"}],BHXf:[function(o,e,t){"use strict";var n=this&&this.__createBinding||(Object.create?function(c,u,d,h){h===void 0&&(h=d),Object.defineProperty(c,h,{enumerable:!0,get:function(){return u[d]}})}:function(c,u,d,h){h===void 0&&(h=d),c[h]=u[d]}),i=this&&this.__setModuleDefault||(Object.create?function(c,u){Object.defineProperty(c,"default",{enumerable:!0,value:u})}:function(c,u){c.default=u}),r=this&&this.__importStar||function(c){if(c&&c.__esModule)return c;var u={};if(c!=null)for(var d in c)d!=="default"&&Object.prototype.hasOwnProperty.call(c,d)&&n(u,c,d);return i(u,c),u};Object.defineProperty(t,"__esModule",{value:!0}),t.util=void 0;var s=r(o("peerjs-js-binarypack")),a=o("./supports"),l={iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:"turn:0.peerjs.com:3478",username:"peerjs",credential:"peerjsp"}],sdpSemantics:"unified-plan"};t.util=new(function(){function c(){this.CLOUD_HOST="0.peerjs.com",this.CLOUD_PORT=443,this.chunkedBrowsers={Chrome:1,chrome:1},this.chunkedMTU=16300,this.defaultConfig=l,this.browser=a.Supports.getBrowser(),this.browserVersion=a.Supports.getVersion(),this.supports=function(){var u,d={browser:a.Supports.isBrowserSupported(),webRTC:a.Supports.isWebRTCSupported(),audioVideo:!1,data:!1,binaryBlob:!1,reliable:!1};if(!d.webRTC)return d;try{u=new RTCPeerConnection(l),d.audioVideo=!0;var h=void 0;try{h=u.createDataChannel("_PEERJSTEST",{ordered:!0}),d.data=!0,d.reliable=!!h.ordered;try{h.binaryType="blob",d.binaryBlob=!a.Supports.isIOS}catch(f){}}catch(f){}finally{h&&h.close()}}catch(f){}finally{u&&u.close()}return d}(),this.pack=s.pack,this.unpack=s.unpack,this._dataCount=1}return c.prototype.noop=function(){},c.prototype.validateId=function(u){return!u||/^[A-Za-z0-9]+(?:[ _-][A-Za-z0-9]+)*$/.test(u)},c.prototype.chunk=function(u){for(var d=[],h=u.size,f=Math.ceil(h/t.util.chunkedMTU),p=0,g=0;g<h;){var v=Math.min(h,g+t.util.chunkedMTU),y=u.slice(g,v),m={__peerData:this._dataCount,n:p,data:y,total:f};d.push(m),g=v,p++}return this._dataCount++,d},c.prototype.blobToArrayBuffer=function(u,d){var h=new FileReader;return h.onload=function(f){f.target&&d(f.target.result)},h.readAsArrayBuffer(u),h},c.prototype.binaryStringToArrayBuffer=function(u){for(var d=new Uint8Array(u.length),h=0;h<u.length;h++)d[h]=255&u.charCodeAt(h);return d.buffer},c.prototype.randomToken=function(){return Math.random().toString(36).substr(2)},c.prototype.isSecure=function(){return location.protocol==="https:"},c}())},{"peerjs-js-binarypack":"kdPp","./supports":"I31f"}],JJlS:[function(o,e,t){"use strict";var n=Object.prototype.hasOwnProperty,i="~";function r(){}function s(u,d,h){this.fn=u,this.context=d,this.once=h||!1}function a(u,d,h,f,p){if(typeof h!="function")throw new TypeError("The listener must be a function");var g=new s(h,f||u,p),v=i?i+d:d;return u._events[v]?u._events[v].fn?u._events[v]=[u._events[v],g]:u._events[v].push(g):(u._events[v]=g,u._eventsCount++),u}function l(u,d){--u._eventsCount==0?u._events=new r:delete u._events[d]}function c(){this._events=new r,this._eventsCount=0}Object.create&&(r.prototype=Object.create(null),new r().__proto__||(i=!1)),c.prototype.eventNames=function(){var u,d,h=[];if(this._eventsCount===0)return h;for(d in u=this._events)n.call(u,d)&&h.push(i?d.slice(1):d);return Object.getOwnPropertySymbols?h.concat(Object.getOwnPropertySymbols(u)):h},c.prototype.listeners=function(u){var d=i?i+u:u,h=this._events[d];if(!h)return[];if(h.fn)return[h.fn];for(var f=0,p=h.length,g=new Array(p);f<p;f++)g[f]=h[f].fn;return g},c.prototype.listenerCount=function(u){var d=i?i+u:u,h=this._events[d];return h?h.fn?1:h.length:0},c.prototype.emit=function(u,d,h,f,p,g){var v=i?i+u:u;if(!this._events[v])return!1;var y,m,x=this._events[v],_=arguments.length;if(x.fn){switch(x.once&&this.removeListener(u,x.fn,void 0,!0),_){case 1:return x.fn.call(x.context),!0;case 2:return x.fn.call(x.context,d),!0;case 3:return x.fn.call(x.context,d,h),!0;case 4:return x.fn.call(x.context,d,h,f),!0;case 5:return x.fn.call(x.context,d,h,f,p),!0;case 6:return x.fn.call(x.context,d,h,f,p,g),!0}for(m=1,y=new Array(_-1);m<_;m++)y[m-1]=arguments[m];x.fn.apply(x.context,y)}else{var w,b=x.length;for(m=0;m<b;m++)switch(x[m].once&&this.removeListener(u,x[m].fn,void 0,!0),_){case 1:x[m].fn.call(x[m].context);break;case 2:x[m].fn.call(x[m].context,d);break;case 3:x[m].fn.call(x[m].context,d,h);break;case 4:x[m].fn.call(x[m].context,d,h,f);break;default:if(!y)for(w=1,y=new Array(_-1);w<_;w++)y[w-1]=arguments[w];x[m].fn.apply(x[m].context,y)}}return!0},c.prototype.on=function(u,d,h){return a(this,u,d,h,!1)},c.prototype.once=function(u,d,h){return a(this,u,d,h,!0)},c.prototype.removeListener=function(u,d,h,f){var p=i?i+u:u;if(!this._events[p])return this;if(!d)return l(this,p),this;var g=this._events[p];if(g.fn)g.fn!==d||f&&!g.once||h&&g.context!==h||l(this,p);else{for(var v=0,y=[],m=g.length;v<m;v++)(g[v].fn!==d||f&&!g[v].once||h&&g[v].context!==h)&&y.push(g[v]);y.length?this._events[p]=y.length===1?y[0]:y:l(this,p)}return this},c.prototype.removeAllListeners=function(u){var d;return u?(d=i?i+u:u,this._events[d]&&l(this,d)):(this._events=new r,this._eventsCount=0),this},c.prototype.off=c.prototype.removeListener,c.prototype.addListener=c.prototype.on,c.prefixed=i,c.EventEmitter=c,typeof e!="undefined"&&(e.exports=c)},{}],WOs9:[function(o,e,t){"use strict";var n=this&&this.__read||function(l,c){var u=typeof Symbol=="function"&&l[Symbol.iterator];if(!u)return l;var d,h,f=u.call(l),p=[];try{for(;(c===void 0||c-- >0)&&!(d=f.next()).done;)p.push(d.value)}catch(g){h={error:g}}finally{try{d&&!d.done&&(u=f.return)&&u.call(f)}finally{if(h)throw h.error}}return p},i=this&&this.__spreadArray||function(l,c){for(var u=0,d=c.length,h=l.length;u<d;u++,h++)l[h]=c[u];return l};Object.defineProperty(t,"__esModule",{value:!0}),t.LogLevel=void 0;var r,s="PeerJS: ";(function(l){l[l.Disabled=0]="Disabled",l[l.Errors=1]="Errors",l[l.Warnings=2]="Warnings",l[l.All=3]="All"})(r=t.LogLevel||(t.LogLevel={}));var a=function(){function l(){this._logLevel=r.Disabled}return Object.defineProperty(l.prototype,"logLevel",{get:function(){return this._logLevel},set:function(c){this._logLevel=c},enumerable:!1,configurable:!0}),l.prototype.log=function(){for(var c=[],u=0;u<arguments.length;u++)c[u]=arguments[u];this._logLevel>=r.All&&this._print.apply(this,i([r.All],n(c)))},l.prototype.warn=function(){for(var c=[],u=0;u<arguments.length;u++)c[u]=arguments[u];this._logLevel>=r.Warnings&&this._print.apply(this,i([r.Warnings],n(c)))},l.prototype.error=function(){for(var c=[],u=0;u<arguments.length;u++)c[u]=arguments[u];this._logLevel>=r.Errors&&this._print.apply(this,i([r.Errors],n(c)))},l.prototype.setLogFunction=function(c){this._print=c},l.prototype._print=function(c){for(var u=[],d=1;d<arguments.length;d++)u[d-1]=arguments[d];var h=i([s],n(u));for(var f in h)h[f]instanceof Error&&(h[f]="("+h[f].name+") "+h[f].message);c>=r.All?console.log.apply(console,i([],n(h))):c>=r.Warnings?console.warn.apply(console,i(["WARNING"],n(h))):c>=r.Errors&&console.error.apply(console,i(["ERROR"],n(h)))},l}();t.default=new a},{}],ZRYf:[function(o,e,t){"use strict";var n,i,r,s,a,l,c;Object.defineProperty(t,"__esModule",{value:!0}),t.ServerMessageType=t.SocketEventType=t.SerializationType=t.PeerErrorType=t.PeerEventType=t.ConnectionType=t.ConnectionEventType=void 0,function(u){u.Open="open",u.Stream="stream",u.Data="data",u.Close="close",u.Error="error",u.IceStateChanged="iceStateChanged"}(n=t.ConnectionEventType||(t.ConnectionEventType={})),function(u){u.Data="data",u.Media="media"}(i=t.ConnectionType||(t.ConnectionType={})),function(u){u.Open="open",u.Close="close",u.Connection="connection",u.Call="call",u.Disconnected="disconnected",u.Error="error"}(r=t.PeerEventType||(t.PeerEventType={})),function(u){u.BrowserIncompatible="browser-incompatible",u.Disconnected="disconnected",u.InvalidID="invalid-id",u.InvalidKey="invalid-key",u.Network="network",u.PeerUnavailable="peer-unavailable",u.SslUnavailable="ssl-unavailable",u.ServerError="server-error",u.SocketError="socket-error",u.SocketClosed="socket-closed",u.UnavailableID="unavailable-id",u.WebRTC="webrtc"}(s=t.PeerErrorType||(t.PeerErrorType={})),function(u){u.Binary="binary",u.BinaryUTF8="binary-utf8",u.JSON="json"}(a=t.SerializationType||(t.SerializationType={})),function(u){u.Message="message",u.Disconnected="disconnected",u.Error="error",u.Close="close"}(l=t.SocketEventType||(t.SocketEventType={})),function(u){u.Heartbeat="HEARTBEAT",u.Candidate="CANDIDATE",u.Offer="OFFER",u.Answer="ANSWER",u.Open="OPEN",u.Error="ERROR",u.IdTaken="ID-TAKEN",u.InvalidKey="INVALID-KEY",u.Leave="LEAVE",u.Expire="EXPIRE"}(c=t.ServerMessageType||(t.ServerMessageType={}))},{}],wJlv:[function(o,e,t){"use strict";var n=this&&this.__extends||function(){var h=function(f,p){return(h=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(g,v){g.__proto__=v}||function(g,v){for(var y in v)Object.prototype.hasOwnProperty.call(v,y)&&(g[y]=v[y])})(f,p)};return function(f,p){if(typeof p!="function"&&p!==null)throw new TypeError("Class extends value "+String(p)+" is not a constructor or null");function g(){this.constructor=f}h(f,p),f.prototype=p===null?Object.create(p):(g.prototype=p.prototype,new g)}}(),i=this&&this.__read||function(h,f){var p=typeof Symbol=="function"&&h[Symbol.iterator];if(!p)return h;var g,v,y=p.call(h),m=[];try{for(;(f===void 0||f-- >0)&&!(g=y.next()).done;)m.push(g.value)}catch(x){v={error:x}}finally{try{g&&!g.done&&(p=y.return)&&p.call(y)}finally{if(v)throw v.error}}return m},r=this&&this.__spreadArray||function(h,f){for(var p=0,g=f.length,v=h.length;p<g;p++,v++)h[v]=f[p];return h},s=this&&this.__values||function(h){var f=typeof Symbol=="function"&&Symbol.iterator,p=f&&h[f],g=0;if(p)return p.call(h);if(h&&typeof h.length=="number")return{next:function(){return h&&g>=h.length&&(h=void 0),{value:h&&h[g++],done:!h}}};throw new TypeError(f?"Object is not iterable.":"Symbol.iterator is not defined.")},a=this&&this.__importDefault||function(h){return h&&h.__esModule?h:{default:h}};Object.defineProperty(t,"__esModule",{value:!0}),t.Socket=void 0;var l=o("eventemitter3"),c=a(o("./logger")),u=o("./enums"),d=function(h){function f(p,g,v,y,m,x){x===void 0&&(x=5e3);var _=h.call(this)||this;_.pingInterval=x,_._disconnected=!0,_._messagesQueue=[];var w=p?"wss://":"ws://";return _._baseUrl=w+g+":"+v+y+"peerjs?key="+m,_}return n(f,h),f.prototype.start=function(p,g){var v=this;this._id=p;var y=this._baseUrl+"&id="+p+"&token="+g;!this._socket&&this._disconnected&&(this._socket=new WebSocket(y),this._disconnected=!1,this._socket.onmessage=function(m){var x;try{x=JSON.parse(m.data),c.default.log("Server message received:",x)}catch(_){return void c.default.log("Invalid server message",m.data)}v.emit(u.SocketEventType.Message,x)},this._socket.onclose=function(m){v._disconnected||(c.default.log("Socket closed.",m),v._cleanup(),v._disconnected=!0,v.emit(u.SocketEventType.Disconnected))},this._socket.onopen=function(){v._disconnected||(v._sendQueuedMessages(),c.default.log("Socket open"),v._scheduleHeartbeat())})},f.prototype._scheduleHeartbeat=function(){var p=this;this._wsPingTimer=setTimeout(function(){p._sendHeartbeat()},this.pingInterval)},f.prototype._sendHeartbeat=function(){if(this._wsOpen()){var p=JSON.stringify({type:u.ServerMessageType.Heartbeat});this._socket.send(p),this._scheduleHeartbeat()}else c.default.log("Cannot send heartbeat, because socket closed")},f.prototype._wsOpen=function(){return!!this._socket&&this._socket.readyState===1},f.prototype._sendQueuedMessages=function(){var p,g,v=r([],i(this._messagesQueue));this._messagesQueue=[];try{for(var y=s(v),m=y.next();!m.done;m=y.next()){var x=m.value;this.send(x)}}catch(_){p={error:_}}finally{try{m&&!m.done&&(g=y.return)&&g.call(y)}finally{if(p)throw p.error}}},f.prototype.send=function(p){if(!this._disconnected)if(this._id)if(p.type){if(this._wsOpen()){var g=JSON.stringify(p);this._socket.send(g)}}else this.emit(u.SocketEventType.Error,"Invalid message");else this._messagesQueue.push(p)},f.prototype.close=function(){this._disconnected||(this._cleanup(),this._disconnected=!0)},f.prototype._cleanup=function(){this._socket&&(this._socket.onopen=this._socket.onmessage=this._socket.onclose=null,this._socket.close(),this._socket=void 0),clearTimeout(this._wsPingTimer)},f}(l.EventEmitter);t.Socket=d},{eventemitter3:"JJlS","./logger":"WOs9","./enums":"ZRYf"}],HCdX:[function(o,e,t){"use strict";var n=this&&this.__assign||function(){return(n=Object.assign||function(d){for(var h,f=1,p=arguments.length;f<p;f++)for(var g in h=arguments[f])Object.prototype.hasOwnProperty.call(h,g)&&(d[g]=h[g]);return d}).apply(this,arguments)},i=this&&this.__awaiter||function(d,h,f,p){return new(f||(f=Promise))(function(g,v){function y(_){try{x(p.next(_))}catch(w){v(w)}}function m(_){try{x(p.throw(_))}catch(w){v(w)}}function x(_){var w;_.done?g(_.value):(w=_.value,w instanceof f?w:new f(function(b){b(w)})).then(y,m)}x((p=p.apply(d,h||[])).next())})},r=this&&this.__generator||function(d,h){var f,p,g,v,y={label:0,sent:function(){if(1&g[0])throw g[1];return g[1]},trys:[],ops:[]};return v={next:m(0),throw:m(1),return:m(2)},typeof Symbol=="function"&&(v[Symbol.iterator]=function(){return this}),v;function m(x){return function(_){return function(w){if(f)throw new TypeError("Generator is already executing.");for(;y;)try{if(f=1,p&&(g=2&w[0]?p.return:w[0]?p.throw||((g=p.return)&&g.call(p),0):p.next)&&!(g=g.call(p,w[1])).done)return g;switch(p=0,g&&(w=[2&w[0],g.value]),w[0]){case 0:case 1:g=w;break;case 4:return y.label++,{value:w[1],done:!1};case 5:y.label++,p=w[1],w=[0];continue;case 7:w=y.ops.pop(),y.trys.pop();continue;default:if(!(g=(g=y.trys).length>0&&g[g.length-1])&&(w[0]===6||w[0]===2)){y=0;continue}if(w[0]===3&&(!g||w[1]>g[0]&&w[1]<g[3])){y.label=w[1];break}if(w[0]===6&&y.label<g[1]){y.label=g[1],g=w;break}if(g&&y.label<g[2]){y.label=g[2],y.ops.push(w);break}g[2]&&y.ops.pop(),y.trys.pop();continue}w=h.call(d,y)}catch(b){w=[6,b],p=0}finally{f=g=0}if(5&w[0])throw w[1];return{value:w[0]?w[1]:void 0,done:!0}}([x,_])}}},s=this&&this.__importDefault||function(d){return d&&d.__esModule?d:{default:d}};Object.defineProperty(t,"__esModule",{value:!0}),t.Negotiator=void 0;var a=o("./util"),l=s(o("./logger")),c=o("./enums"),u=function(){function d(h){this.connection=h}return d.prototype.startConnection=function(h){var f=this._startPeerConnection();if(this.connection.peerConnection=f,this.connection.type===c.ConnectionType.Media&&h._stream&&this._addTracksToConnection(h._stream,f),h.originator){if(this.connection.type===c.ConnectionType.Data){var p=this.connection,g={ordered:!!h.reliable},v=f.createDataChannel(p.label,g);p.initialize(v)}this._makeOffer()}else this.handleSDP("OFFER",h.sdp)},d.prototype._startPeerConnection=function(){l.default.log("Creating RTCPeerConnection.");var h=new RTCPeerConnection(this.connection.provider.options.config);return this._setupListeners(h),h},d.prototype._setupListeners=function(h){var f=this,p=this.connection.peer,g=this.connection.connectionId,v=this.connection.type,y=this.connection.provider;l.default.log("Listening for ICE candidates."),h.onicecandidate=function(m){m.candidate&&m.candidate.candidate&&(l.default.log("Received ICE candidates for "+p+":",m.candidate),y.socket.send({type:c.ServerMessageType.Candidate,payload:{candidate:m.candidate,type:v,connectionId:g},dst:p}))},h.oniceconnectionstatechange=function(){switch(h.iceConnectionState){case"failed":l.default.log("iceConnectionState is failed, closing connections to "+p),f.connection.emit(c.ConnectionEventType.Error,new Error("Negotiation of connection to "+p+" failed.")),f.connection.close();break;case"closed":l.default.log("iceConnectionState is closed, closing connections to "+p),f.connection.emit(c.ConnectionEventType.Error,new Error("Connection to "+p+" closed.")),f.connection.close();break;case"disconnected":l.default.log("iceConnectionState changed to disconnected on the connection with "+p);break;case"completed":h.onicecandidate=a.util.noop}f.connection.emit(c.ConnectionEventType.IceStateChanged,h.iceConnectionState)},l.default.log("Listening for data channel"),h.ondatachannel=function(m){l.default.log("Received data channel");var x=m.channel;y.getConnection(p,g).initialize(x)},l.default.log("Listening for remote stream"),h.ontrack=function(m){l.default.log("Received remote stream");var x=m.streams[0],_=y.getConnection(p,g);if(_.type===c.ConnectionType.Media){var w=_;f._addStreamToMediaConnection(x,w)}}},d.prototype.cleanup=function(){l.default.log("Cleaning up PeerConnection to "+this.connection.peer);var h=this.connection.peerConnection;if(h){this.connection.peerConnection=null,h.onicecandidate=h.oniceconnectionstatechange=h.ondatachannel=h.ontrack=function(){};var f=h.signalingState!=="closed",p=!1;if(this.connection.type===c.ConnectionType.Data){var g=this.connection.dataChannel;g&&(p=!!g.readyState&&g.readyState!=="closed")}(f||p)&&h.close()}},d.prototype._makeOffer=function(){return i(this,void 0,Promise,function(){var h,f,p,g,v,y,m;return r(this,function(x){switch(x.label){case 0:h=this.connection.peerConnection,f=this.connection.provider,x.label=1;case 1:return x.trys.push([1,7,,8]),[4,h.createOffer(this.connection.options.constraints)];case 2:p=x.sent(),l.default.log("Created offer."),this.connection.options.sdpTransform&&typeof this.connection.options.sdpTransform=="function"&&(p.sdp=this.connection.options.sdpTransform(p.sdp)||p.sdp),x.label=3;case 3:return x.trys.push([3,5,,6]),[4,h.setLocalDescription(p)];case 4:return x.sent(),l.default.log("Set localDescription:",p,"for:"+this.connection.peer),g={sdp:p,type:this.connection.type,connectionId:this.connection.connectionId,metadata:this.connection.metadata,browser:a.util.browser},this.connection.type===c.ConnectionType.Data&&(v=this.connection,g=n(n({},g),{label:v.label,reliable:v.reliable,serialization:v.serialization})),f.socket.send({type:c.ServerMessageType.Offer,payload:g,dst:this.connection.peer}),[3,6];case 5:return(y=x.sent())!="OperationError: Failed to set local offer sdp: Called in wrong state: kHaveRemoteOffer"&&(f.emitError(c.PeerErrorType.WebRTC,y),l.default.log("Failed to setLocalDescription, ",y)),[3,6];case 6:return[3,8];case 7:return m=x.sent(),f.emitError(c.PeerErrorType.WebRTC,m),l.default.log("Failed to createOffer, ",m),[3,8];case 8:return[2]}})})},d.prototype._makeAnswer=function(){return i(this,void 0,Promise,function(){var h,f,p,g,v;return r(this,function(y){switch(y.label){case 0:h=this.connection.peerConnection,f=this.connection.provider,y.label=1;case 1:return y.trys.push([1,7,,8]),[4,h.createAnswer()];case 2:p=y.sent(),l.default.log("Created answer."),this.connection.options.sdpTransform&&typeof this.connection.options.sdpTransform=="function"&&(p.sdp=this.connection.options.sdpTransform(p.sdp)||p.sdp),y.label=3;case 3:return y.trys.push([3,5,,6]),[4,h.setLocalDescription(p)];case 4:return y.sent(),l.default.log("Set localDescription:",p,"for:"+this.connection.peer),f.socket.send({type:c.ServerMessageType.Answer,payload:{sdp:p,type:this.connection.type,connectionId:this.connection.connectionId,browser:a.util.browser},dst:this.connection.peer}),[3,6];case 5:return g=y.sent(),f.emitError(c.PeerErrorType.WebRTC,g),l.default.log("Failed to setLocalDescription, ",g),[3,6];case 6:return[3,8];case 7:return v=y.sent(),f.emitError(c.PeerErrorType.WebRTC,v),l.default.log("Failed to create answer, ",v),[3,8];case 8:return[2]}})})},d.prototype.handleSDP=function(h,f){return i(this,void 0,Promise,function(){var p,g,v,y;return r(this,function(m){switch(m.label){case 0:f=new RTCSessionDescription(f),p=this.connection.peerConnection,g=this.connection.provider,l.default.log("Setting remote description",f),v=this,m.label=1;case 1:return m.trys.push([1,5,,6]),[4,p.setRemoteDescription(f)];case 2:return m.sent(),l.default.log("Set remoteDescription:"+h+" for:"+this.connection.peer),h!=="OFFER"?[3,4]:[4,v._makeAnswer()];case 3:m.sent(),m.label=4;case 4:return[3,6];case 5:return y=m.sent(),g.emitError(c.PeerErrorType.WebRTC,y),l.default.log("Failed to setRemoteDescription, ",y),[3,6];case 6:return[2]}})})},d.prototype.handleCandidate=function(h){return i(this,void 0,Promise,function(){var f,p,g,v,y,m;return r(this,function(x){switch(x.label){case 0:l.default.log("handleCandidate:",h),f=h.candidate,p=h.sdpMLineIndex,g=h.sdpMid,v=this.connection.peerConnection,y=this.connection.provider,x.label=1;case 1:return x.trys.push([1,3,,4]),[4,v.addIceCandidate(new RTCIceCandidate({sdpMid:g,sdpMLineIndex:p,candidate:f}))];case 2:return x.sent(),l.default.log("Added ICE candidate for:"+this.connection.peer),[3,4];case 3:return m=x.sent(),y.emitError(c.PeerErrorType.WebRTC,m),l.default.log("Failed to handleCandidate, ",m),[3,4];case 4:return[2]}})})},d.prototype._addTracksToConnection=function(h,f){if(l.default.log("add tracks from stream "+h.id+" to peer connection"),!f.addTrack)return l.default.error("Your browser does't support RTCPeerConnection#addTrack. Ignored.");h.getTracks().forEach(function(p){f.addTrack(p,h)})},d.prototype._addStreamToMediaConnection=function(h,f){l.default.log("add stream "+h.id+" to media connection "+f.connectionId),f.addStream(h)},d}();t.Negotiator=u},{"./util":"BHXf","./logger":"WOs9","./enums":"ZRYf"}],tQFK:[function(o,e,t){"use strict";var n=this&&this.__extends||function(){var s=function(a,l){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(c,u){c.__proto__=u}||function(c,u){for(var d in u)Object.prototype.hasOwnProperty.call(u,d)&&(c[d]=u[d])})(a,l)};return function(a,l){if(typeof l!="function"&&l!==null)throw new TypeError("Class extends value "+String(l)+" is not a constructor or null");function c(){this.constructor=a}s(a,l),a.prototype=l===null?Object.create(l):(c.prototype=l.prototype,new c)}}();Object.defineProperty(t,"__esModule",{value:!0}),t.BaseConnection=void 0;var i=o("eventemitter3"),r=function(s){function a(l,c,u){var d=s.call(this)||this;return d.peer=l,d.provider=c,d.options=u,d._open=!1,d.metadata=u.metadata,d}return n(a,s),Object.defineProperty(a.prototype,"open",{get:function(){return this._open},enumerable:!1,configurable:!0}),a}(i.EventEmitter);t.BaseConnection=r},{eventemitter3:"JJlS"}],dbHP:[function(o,e,t){"use strict";var n=this&&this.__extends||function(){var f=function(p,g){return(f=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(v,y){v.__proto__=y}||function(v,y){for(var m in y)Object.prototype.hasOwnProperty.call(y,m)&&(v[m]=y[m])})(p,g)};return function(p,g){if(typeof g!="function"&&g!==null)throw new TypeError("Class extends value "+String(g)+" is not a constructor or null");function v(){this.constructor=p}f(p,g),p.prototype=g===null?Object.create(g):(v.prototype=g.prototype,new v)}}(),i=this&&this.__assign||function(){return(i=Object.assign||function(f){for(var p,g=1,v=arguments.length;g<v;g++)for(var y in p=arguments[g])Object.prototype.hasOwnProperty.call(p,y)&&(f[y]=p[y]);return f}).apply(this,arguments)},r=this&&this.__values||function(f){var p=typeof Symbol=="function"&&Symbol.iterator,g=p&&f[p],v=0;if(g)return g.call(f);if(f&&typeof f.length=="number")return{next:function(){return f&&v>=f.length&&(f=void 0),{value:f&&f[v++],done:!f}}};throw new TypeError(p?"Object is not iterable.":"Symbol.iterator is not defined.")},s=this&&this.__importDefault||function(f){return f&&f.__esModule?f:{default:f}};Object.defineProperty(t,"__esModule",{value:!0}),t.MediaConnection=void 0;var a=o("./util"),l=s(o("./logger")),c=o("./negotiator"),u=o("./enums"),d=o("./baseconnection"),h=function(f){function p(g,v,y){var m=f.call(this,g,v,y)||this;return m._localStream=m.options._stream,m.connectionId=m.options.connectionId||p.ID_PREFIX+a.util.randomToken(),m._negotiator=new c.Negotiator(m),m._localStream&&m._negotiator.startConnection({_stream:m._localStream,originator:!0}),m}return n(p,f),Object.defineProperty(p.prototype,"type",{get:function(){return u.ConnectionType.Media},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"localStream",{get:function(){return this._localStream},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"remoteStream",{get:function(){return this._remoteStream},enumerable:!1,configurable:!0}),p.prototype.addStream=function(g){l.default.log("Receiving stream",g),this._remoteStream=g,f.prototype.emit.call(this,u.ConnectionEventType.Stream,g)},p.prototype.handleMessage=function(g){var v=g.type,y=g.payload;switch(g.type){case u.ServerMessageType.Answer:this._negotiator.handleSDP(v,y.sdp),this._open=!0;break;case u.ServerMessageType.Candidate:this._negotiator.handleCandidate(y.candidate);break;default:l.default.warn("Unrecognized message type:"+v+" from peer:"+this.peer)}},p.prototype.answer=function(g,v){var y,m;if(v===void 0&&(v={}),this._localStream)l.default.warn("Local stream already exists on this MediaConnection. Are you answering a call twice?");else{this._localStream=g,v&&v.sdpTransform&&(this.options.sdpTransform=v.sdpTransform),this._negotiator.startConnection(i(i({},this.options._payload),{_stream:g}));var x=this.provider._getMessages(this.connectionId);try{for(var _=r(x),w=_.next();!w.done;w=_.next()){var b=w.value;this.handleMessage(b)}}catch(M){y={error:M}}finally{try{w&&!w.done&&(m=_.return)&&m.call(_)}finally{if(y)throw y.error}}this._open=!0}},p.prototype.close=function(){this._negotiator&&(this._negotiator.cleanup(),this._negotiator=null),this._localStream=null,this._remoteStream=null,this.provider&&(this.provider._removeConnection(this),this.provider=null),this.options&&this.options._stream&&(this.options._stream=null),this.open&&(this._open=!1,f.prototype.emit.call(this,u.ConnectionEventType.Close))},p.ID_PREFIX="mc_",p}(d.BaseConnection);t.MediaConnection=h},{"./util":"BHXf","./logger":"WOs9","./negotiator":"HCdX","./enums":"ZRYf","./baseconnection":"tQFK"}],GGp6:[function(o,e,t){"use strict";var n=this&&this.__extends||function(){var l=function(c,u){return(l=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,h){d.__proto__=h}||function(d,h){for(var f in h)Object.prototype.hasOwnProperty.call(h,f)&&(d[f]=h[f])})(c,u)};return function(c,u){if(typeof u!="function"&&u!==null)throw new TypeError("Class extends value "+String(u)+" is not a constructor or null");function d(){this.constructor=c}l(c,u),c.prototype=u===null?Object.create(u):(d.prototype=u.prototype,new d)}}(),i=this&&this.__importDefault||function(l){return l&&l.__esModule?l:{default:l}};Object.defineProperty(t,"__esModule",{value:!0}),t.EncodingQueue=void 0;var r=o("eventemitter3"),s=i(o("./logger")),a=function(l){function c(){var u=l.call(this)||this;return u.fileReader=new FileReader,u._queue=[],u._processing=!1,u.fileReader.onload=function(d){u._processing=!1,d.target&&u.emit("done",d.target.result),u.doNextTask()},u.fileReader.onerror=function(d){s.default.error("EncodingQueue error:",d),u._processing=!1,u.destroy(),u.emit("error",d)},u}return n(c,l),Object.defineProperty(c.prototype,"queue",{get:function(){return this._queue},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"size",{get:function(){return this.queue.length},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"processing",{get:function(){return this._processing},enumerable:!1,configurable:!0}),c.prototype.enque=function(u){this.queue.push(u),this.processing||this.doNextTask()},c.prototype.destroy=function(){this.fileReader.abort(),this._queue=[]},c.prototype.doNextTask=function(){this.size!==0&&(this.processing||(this._processing=!0,this.fileReader.readAsArrayBuffer(this.queue.shift())))},c}(r.EventEmitter);t.EncodingQueue=a},{eventemitter3:"JJlS","./logger":"WOs9"}],GBTQ:[function(o,e,t){"use strict";var n=this&&this.__extends||function(){var f=function(p,g){return(f=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(v,y){v.__proto__=y}||function(v,y){for(var m in y)Object.prototype.hasOwnProperty.call(y,m)&&(v[m]=y[m])})(p,g)};return function(p,g){if(typeof g!="function"&&g!==null)throw new TypeError("Class extends value "+String(g)+" is not a constructor or null");function v(){this.constructor=p}f(p,g),p.prototype=g===null?Object.create(g):(v.prototype=g.prototype,new v)}}(),i=this&&this.__values||function(f){var p=typeof Symbol=="function"&&Symbol.iterator,g=p&&f[p],v=0;if(g)return g.call(f);if(f&&typeof f.length=="number")return{next:function(){return f&&v>=f.length&&(f=void 0),{value:f&&f[v++],done:!f}}};throw new TypeError(p?"Object is not iterable.":"Symbol.iterator is not defined.")},r=this&&this.__importDefault||function(f){return f&&f.__esModule?f:{default:f}};Object.defineProperty(t,"__esModule",{value:!0}),t.DataConnection=void 0;var s=o("./util"),a=r(o("./logger")),l=o("./negotiator"),c=o("./enums"),u=o("./baseconnection"),d=o("./encodingQueue"),h=function(f){function p(g,v,y){var m=f.call(this,g,v,y)||this;return m.stringify=JSON.stringify,m.parse=JSON.parse,m._buffer=[],m._bufferSize=0,m._buffering=!1,m._chunkedData={},m._encodingQueue=new d.EncodingQueue,m.connectionId=m.options.connectionId||p.ID_PREFIX+s.util.randomToken(),m.label=m.options.label||m.connectionId,m.serialization=m.options.serialization||c.SerializationType.Binary,m.reliable=!!m.options.reliable,m._encodingQueue.on("done",function(x){m._bufferedSend(x)}),m._encodingQueue.on("error",function(){a.default.error("DC#"+m.connectionId+": Error occured in encoding from blob to arraybuffer, close DC"),m.close()}),m._negotiator=new l.Negotiator(m),m._negotiator.startConnection(m.options._payload||{originator:!0}),m}return n(p,f),Object.defineProperty(p.prototype,"type",{get:function(){return c.ConnectionType.Data},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"dataChannel",{get:function(){return this._dc},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"bufferSize",{get:function(){return this._bufferSize},enumerable:!1,configurable:!0}),p.prototype.initialize=function(g){this._dc=g,this._configureDataChannel()},p.prototype._configureDataChannel=function(){var g=this;s.util.supports.binaryBlob&&!s.util.supports.reliable||(this.dataChannel.binaryType="arraybuffer"),this.dataChannel.onopen=function(){a.default.log("DC#"+g.connectionId+" dc connection success"),g._open=!0,g.emit(c.ConnectionEventType.Open)},this.dataChannel.onmessage=function(v){a.default.log("DC#"+g.connectionId+" dc onmessage:",v.data),g._handleDataMessage(v)},this.dataChannel.onclose=function(){a.default.log("DC#"+g.connectionId+" dc closed for:",g.peer),g.close()}},p.prototype._handleDataMessage=function(g){var v=this,y=g.data,m=y.constructor,x=y;if(this.serialization===c.SerializationType.Binary||this.serialization===c.SerializationType.BinaryUTF8){if(m===Blob)return void s.util.blobToArrayBuffer(y,function(w){var b=s.util.unpack(w);v.emit(c.ConnectionEventType.Data,b)});if(m===ArrayBuffer)x=s.util.unpack(y);else if(m===String){var _=s.util.binaryStringToArrayBuffer(y);x=s.util.unpack(_)}}else this.serialization===c.SerializationType.JSON&&(x=this.parse(y));x.__peerData?this._handleChunk(x):f.prototype.emit.call(this,c.ConnectionEventType.Data,x)},p.prototype._handleChunk=function(g){var v=g.__peerData,y=this._chunkedData[v]||{data:[],count:0,total:g.total};if(y.data[g.n]=g.data,y.count++,this._chunkedData[v]=y,y.total===y.count){delete this._chunkedData[v];var m=new Blob(y.data);this._handleDataMessage({data:m})}},p.prototype.close=function(){this._buffer=[],this._bufferSize=0,this._chunkedData={},this._negotiator&&(this._negotiator.cleanup(),this._negotiator=null),this.provider&&(this.provider._removeConnection(this),this.provider=null),this.dataChannel&&(this.dataChannel.onopen=null,this.dataChannel.onmessage=null,this.dataChannel.onclose=null,this._dc=null),this._encodingQueue&&(this._encodingQueue.destroy(),this._encodingQueue.removeAllListeners(),this._encodingQueue=null),this.open&&(this._open=!1,f.prototype.emit.call(this,c.ConnectionEventType.Close))},p.prototype.send=function(g,v){if(this.open)if(this.serialization===c.SerializationType.JSON)this._bufferedSend(this.stringify(g));else if(this.serialization===c.SerializationType.Binary||this.serialization===c.SerializationType.BinaryUTF8){var y=s.util.pack(g);if(!v&&y.size>s.util.chunkedMTU)return void this._sendChunks(y);s.util.supports.binaryBlob?this._bufferedSend(y):this._encodingQueue.enque(y)}else this._bufferedSend(g);else f.prototype.emit.call(this,c.ConnectionEventType.Error,new Error("Connection is not open. You should listen for the `open` event before sending messages."))},p.prototype._bufferedSend=function(g){!this._buffering&&this._trySend(g)||(this._buffer.push(g),this._bufferSize=this._buffer.length)},p.prototype._trySend=function(g){var v=this;if(!this.open)return!1;if(this.dataChannel.bufferedAmount>p.MAX_BUFFERED_AMOUNT)return this._buffering=!0,setTimeout(function(){v._buffering=!1,v._tryBuffer()},50),!1;try{this.dataChannel.send(g)}catch(y){return a.default.error("DC#:"+this.connectionId+" Error when sending:",y),this._buffering=!0,this.close(),!1}return!0},p.prototype._tryBuffer=function(){if(this.open&&this._buffer.length!==0){var g=this._buffer[0];this._trySend(g)&&(this._buffer.shift(),this._bufferSize=this._buffer.length,this._tryBuffer())}},p.prototype._sendChunks=function(g){var v,y,m=s.util.chunk(g);a.default.log("DC#"+this.connectionId+" Try to send "+m.length+" chunks...");try{for(var x=i(m),_=x.next();!_.done;_=x.next()){var w=_.value;this.send(w,!0)}}catch(b){v={error:b}}finally{try{_&&!_.done&&(y=x.return)&&y.call(x)}finally{if(v)throw v.error}}},p.prototype.handleMessage=function(g){var v=g.payload;switch(g.type){case c.ServerMessageType.Answer:this._negotiator.handleSDP(g.type,v.sdp);break;case c.ServerMessageType.Candidate:this._negotiator.handleCandidate(v.candidate);break;default:a.default.warn("Unrecognized message type:",g.type,"from peer:",this.peer)}},p.ID_PREFIX="dc_",p.MAX_BUFFERED_AMOUNT=8388608,p}(u.BaseConnection);t.DataConnection=h},{"./util":"BHXf","./logger":"WOs9","./negotiator":"HCdX","./enums":"ZRYf","./baseconnection":"tQFK","./encodingQueue":"GGp6"}],in7L:[function(o,e,t){"use strict";var n=this&&this.__awaiter||function(c,u,d,h){return new(d||(d=Promise))(function(f,p){function g(m){try{y(h.next(m))}catch(x){p(x)}}function v(m){try{y(h.throw(m))}catch(x){p(x)}}function y(m){var x;m.done?f(m.value):(x=m.value,x instanceof d?x:new d(function(_){_(x)})).then(g,v)}y((h=h.apply(c,u||[])).next())})},i=this&&this.__generator||function(c,u){var d,h,f,p,g={label:0,sent:function(){if(1&f[0])throw f[1];return f[1]},trys:[],ops:[]};return p={next:v(0),throw:v(1),return:v(2)},typeof Symbol=="function"&&(p[Symbol.iterator]=function(){return this}),p;function v(y){return function(m){return function(x){if(d)throw new TypeError("Generator is already executing.");for(;g;)try{if(d=1,h&&(f=2&x[0]?h.return:x[0]?h.throw||((f=h.return)&&f.call(h),0):h.next)&&!(f=f.call(h,x[1])).done)return f;switch(h=0,f&&(x=[2&x[0],f.value]),x[0]){case 0:case 1:f=x;break;case 4:return g.label++,{value:x[1],done:!1};case 5:g.label++,h=x[1],x=[0];continue;case 7:x=g.ops.pop(),g.trys.pop();continue;default:if(!(f=(f=g.trys).length>0&&f[f.length-1])&&(x[0]===6||x[0]===2)){g=0;continue}if(x[0]===3&&(!f||x[1]>f[0]&&x[1]<f[3])){g.label=x[1];break}if(x[0]===6&&g.label<f[1]){g.label=f[1],f=x;break}if(f&&g.label<f[2]){g.label=f[2],g.ops.push(x);break}f[2]&&g.ops.pop(),g.trys.pop();continue}x=u.call(c,g)}catch(_){x=[6,_],h=0}finally{d=f=0}if(5&x[0])throw x[1];return{value:x[0]?x[1]:void 0,done:!0}}([y,m])}}},r=this&&this.__importDefault||function(c){return c&&c.__esModule?c:{default:c}};Object.defineProperty(t,"__esModule",{value:!0}),t.API=void 0;var s=o("./util"),a=r(o("./logger")),l=function(){function c(u){this._options=u}return c.prototype._buildUrl=function(u){var d=(this._options.secure?"https://":"http://")+this._options.host+":"+this._options.port+this._options.path+this._options.key+"/"+u;return d+="?ts="+new Date().getTime()+Math.random()},c.prototype.retrieveId=function(){return n(this,void 0,Promise,function(){var u,d,h,f;return i(this,function(p){switch(p.label){case 0:u=this._buildUrl("id"),p.label=1;case 1:return p.trys.push([1,3,,4]),[4,fetch(u)];case 2:if((d=p.sent()).status!==200)throw new Error("Error. Status:"+d.status);return[2,d.text()];case 3:throw h=p.sent(),a.default.error("Error retrieving ID",h),f="",this._options.path==="/"&&this._options.host!==s.util.CLOUD_HOST&&(f=" If you passed in a `path` to your self-hosted PeerServer, you'll also need to pass in that same path when creating a new Peer."),new Error("Could not get an ID from the server."+f);case 4:return[2]}})})},c.prototype.listAllPeers=function(){return n(this,void 0,Promise,function(){var u,d,h,f;return i(this,function(p){switch(p.label){case 0:u=this._buildUrl("peers"),p.label=1;case 1:return p.trys.push([1,3,,4]),[4,fetch(u)];case 2:if((d=p.sent()).status!==200)throw d.status===401?(h="",h=this._options.host===s.util.CLOUD_HOST?"It looks like you're using the cloud server. You can email team@peerjs.com to enable peer listing for your API key.":"You need to enable `allow_discovery` on your self-hosted PeerServer to use this feature.",new Error("It doesn't look like you have permission to list peers IDs. "+h)):new Error("Error. Status:"+d.status);return[2,d.json()];case 3:throw f=p.sent(),a.default.error("Error retrieving list peers",f),new Error("Could not get list peers from the server."+f);case 4:return[2]}})})},c}();t.API=l},{"./util":"BHXf","./logger":"WOs9"}],Hxpd:[function(o,e,t){"use strict";var n=this&&this.__extends||function(){var m=function(x,_){return(m=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(w,b){w.__proto__=b}||function(w,b){for(var M in b)Object.prototype.hasOwnProperty.call(b,M)&&(w[M]=b[M])})(x,_)};return function(x,_){if(typeof _!="function"&&_!==null)throw new TypeError("Class extends value "+String(_)+" is not a constructor or null");function w(){this.constructor=x}m(x,_),x.prototype=_===null?Object.create(_):(w.prototype=_.prototype,new w)}}(),i=this&&this.__assign||function(){return(i=Object.assign||function(m){for(var x,_=1,w=arguments.length;_<w;_++)for(var b in x=arguments[_])Object.prototype.hasOwnProperty.call(x,b)&&(m[b]=x[b]);return m}).apply(this,arguments)},r=this&&this.__values||function(m){var x=typeof Symbol=="function"&&Symbol.iterator,_=x&&m[x],w=0;if(_)return _.call(m);if(m&&typeof m.length=="number")return{next:function(){return m&&w>=m.length&&(m=void 0),{value:m&&m[w++],done:!m}}};throw new TypeError(x?"Object is not iterable.":"Symbol.iterator is not defined.")},s=this&&this.__read||function(m,x){var _=typeof Symbol=="function"&&m[Symbol.iterator];if(!_)return m;var w,b,M=_.call(m),S=[];try{for(;(x===void 0||x-- >0)&&!(w=M.next()).done;)S.push(w.value)}catch(E){b={error:E}}finally{try{w&&!w.done&&(_=M.return)&&_.call(M)}finally{if(b)throw b.error}}return S},a=this&&this.__importDefault||function(m){return m&&m.__esModule?m:{default:m}};Object.defineProperty(t,"__esModule",{value:!0}),t.Peer=void 0;var l=o("eventemitter3"),c=o("./util"),u=a(o("./logger")),d=o("./socket"),h=o("./mediaconnection"),f=o("./dataconnection"),p=o("./enums"),g=o("./api"),v=function(){return function(){}}(),y=function(m){function x(_,w){var b,M=m.call(this)||this;return M._id=null,M._lastServerId=null,M._destroyed=!1,M._disconnected=!1,M._open=!1,M._connections=new Map,M._lostMessages=new Map,_&&_.constructor==Object?w=_:_&&(b=_.toString()),w=i({debug:0,host:c.util.CLOUD_HOST,port:c.util.CLOUD_PORT,path:"/",key:x.DEFAULT_KEY,token:c.util.randomToken(),config:c.util.defaultConfig},w),M._options=w,M._options.host==="/"&&(M._options.host=window.location.hostname),M._options.path&&(M._options.path[0]!=="/"&&(M._options.path="/"+M._options.path),M._options.path[M._options.path.length-1]!=="/"&&(M._options.path+="/")),M._options.secure===void 0&&M._options.host!==c.util.CLOUD_HOST?M._options.secure=c.util.isSecure():M._options.host==c.util.CLOUD_HOST&&(M._options.secure=!0),M._options.logFunction&&u.default.setLogFunction(M._options.logFunction),u.default.logLevel=M._options.debug||0,M._api=new g.API(w),M._socket=M._createServerConnection(),c.util.supports.audioVideo||c.util.supports.data?b&&!c.util.validateId(b)?(M._delayedAbort(p.PeerErrorType.InvalidID,'ID "'+b+'" is invalid'),M):(b?M._initialize(b):M._api.retrieveId().then(function(S){return M._initialize(S)}).catch(function(S){return M._abort(p.PeerErrorType.ServerError,S)}),M):(M._delayedAbort(p.PeerErrorType.BrowserIncompatible,"The current browser does not support WebRTC"),M)}return n(x,m),Object.defineProperty(x.prototype,"id",{get:function(){return this._id},enumerable:!1,configurable:!0}),Object.defineProperty(x.prototype,"options",{get:function(){return this._options},enumerable:!1,configurable:!0}),Object.defineProperty(x.prototype,"open",{get:function(){return this._open},enumerable:!1,configurable:!0}),Object.defineProperty(x.prototype,"socket",{get:function(){return this._socket},enumerable:!1,configurable:!0}),Object.defineProperty(x.prototype,"connections",{get:function(){var _,w,b=Object.create(null);try{for(var M=r(this._connections),S=M.next();!S.done;S=M.next()){var E=s(S.value,2),A=E[0],L=E[1];b[A]=L}}catch(B){_={error:B}}finally{try{S&&!S.done&&(w=M.return)&&w.call(M)}finally{if(_)throw _.error}}return b},enumerable:!1,configurable:!0}),Object.defineProperty(x.prototype,"destroyed",{get:function(){return this._destroyed},enumerable:!1,configurable:!0}),Object.defineProperty(x.prototype,"disconnected",{get:function(){return this._disconnected},enumerable:!1,configurable:!0}),x.prototype._createServerConnection=function(){var _=this,w=new d.Socket(this._options.secure,this._options.host,this._options.port,this._options.path,this._options.key,this._options.pingInterval);return w.on(p.SocketEventType.Message,function(b){_._handleMessage(b)}),w.on(p.SocketEventType.Error,function(b){_._abort(p.PeerErrorType.SocketError,b)}),w.on(p.SocketEventType.Disconnected,function(){_.disconnected||(_.emitError(p.PeerErrorType.Network,"Lost connection to server."),_.disconnect())}),w.on(p.SocketEventType.Close,function(){_.disconnected||_._abort(p.PeerErrorType.SocketClosed,"Underlying socket is already closed.")}),w},x.prototype._initialize=function(_){this._id=_,this.socket.start(_,this._options.token)},x.prototype._handleMessage=function(_){var w,b,M=_.type,S=_.payload,E=_.src;switch(M){case p.ServerMessageType.Open:this._lastServerId=this.id,this._open=!0,this.emit(p.PeerEventType.Open,this.id);break;case p.ServerMessageType.Error:this._abort(p.PeerErrorType.ServerError,S.msg);break;case p.ServerMessageType.IdTaken:this._abort(p.PeerErrorType.UnavailableID,'ID "'+this.id+'" is taken');break;case p.ServerMessageType.InvalidKey:this._abort(p.PeerErrorType.InvalidKey,'API KEY "'+this._options.key+'" is invalid');break;case p.ServerMessageType.Leave:u.default.log("Received leave message from "+E),this._cleanupPeer(E),this._connections.delete(E);break;case p.ServerMessageType.Expire:this.emitError(p.PeerErrorType.PeerUnavailable,"Could not connect to peer "+E);break;case p.ServerMessageType.Offer:var A=S.connectionId;if((P=this.getConnection(E,A))&&(P.close(),u.default.warn("Offer received for existing Connection ID:"+A)),S.type===p.ConnectionType.Media)P=new h.MediaConnection(E,this,{connectionId:A,_payload:S,metadata:S.metadata}),this._addConnection(E,P),this.emit(p.PeerEventType.Call,P);else{if(S.type!==p.ConnectionType.Data)return void u.default.warn("Received malformed connection type:"+S.type);P=new f.DataConnection(E,this,{connectionId:A,_payload:S,metadata:S.metadata,label:S.label,serialization:S.serialization,reliable:S.reliable}),this._addConnection(E,P),this.emit(p.PeerEventType.Connection,P)}var L=this._getMessages(A);try{for(var B=r(L),R=B.next();!R.done;R=B.next()){var D=R.value;P.handleMessage(D)}}catch(I){w={error:I}}finally{try{R&&!R.done&&(b=B.return)&&b.call(B)}finally{if(w)throw w.error}}break;default:if(!S)return void u.default.warn("You received a malformed message from "+E+" of type "+M);var P;A=S.connectionId,(P=this.getConnection(E,A))&&P.peerConnection?P.handleMessage(_):A?this._storeMessage(A,_):u.default.warn("You received an unrecognized message:",_)}},x.prototype._storeMessage=function(_,w){this._lostMessages.has(_)||this._lostMessages.set(_,[]),this._lostMessages.get(_).push(w)},x.prototype._getMessages=function(_){var w=this._lostMessages.get(_);return w?(this._lostMessages.delete(_),w):[]},x.prototype.connect=function(_,w){if(w===void 0&&(w={}),this.disconnected)return u.default.warn("You cannot connect to a new Peer because you called .disconnect() on this Peer and ended your connection with the server. You can create a new Peer to reconnect, or call reconnect on this peer if you believe its ID to still be available."),void this.emitError(p.PeerErrorType.Disconnected,"Cannot connect to new Peer after disconnecting from server.");var b=new f.DataConnection(_,this,w);return this._addConnection(_,b),b},x.prototype.call=function(_,w,b){if(b===void 0&&(b={}),this.disconnected)return u.default.warn("You cannot connect to a new Peer because you called .disconnect() on this Peer and ended your connection with the server. You can create a new Peer to reconnect."),void this.emitError(p.PeerErrorType.Disconnected,"Cannot connect to new Peer after disconnecting from server.");if(w){b._stream=w;var M=new h.MediaConnection(_,this,b);return this._addConnection(_,M),M}u.default.error("To call a peer, you must provide a stream from your browser's `getUserMedia`.")},x.prototype._addConnection=function(_,w){u.default.log("add connection "+w.type+":"+w.connectionId+" to peerId:"+_),this._connections.has(_)||this._connections.set(_,[]),this._connections.get(_).push(w)},x.prototype._removeConnection=function(_){var w=this._connections.get(_.peer);if(w){var b=w.indexOf(_);b!==-1&&w.splice(b,1)}this._lostMessages.delete(_.connectionId)},x.prototype.getConnection=function(_,w){var b,M,S=this._connections.get(_);if(!S)return null;try{for(var E=r(S),A=E.next();!A.done;A=E.next()){var L=A.value;if(L.connectionId===w)return L}}catch(B){b={error:B}}finally{try{A&&!A.done&&(M=E.return)&&M.call(E)}finally{if(b)throw b.error}}return null},x.prototype._delayedAbort=function(_,w){var b=this;setTimeout(function(){b._abort(_,w)},0)},x.prototype._abort=function(_,w){u.default.error("Aborting!"),this.emitError(_,w),this._lastServerId?this.disconnect():this.destroy()},x.prototype.emitError=function(_,w){var b;u.default.error("Error:",w),(b=typeof w=="string"?new Error(w):w).type=_,this.emit(p.PeerEventType.Error,b)},x.prototype.destroy=function(){this.destroyed||(u.default.log("Destroy peer with ID:"+this.id),this.disconnect(),this._cleanup(),this._destroyed=!0,this.emit(p.PeerEventType.Close))},x.prototype._cleanup=function(){var _,w;try{for(var b=r(this._connections.keys()),M=b.next();!M.done;M=b.next()){var S=M.value;this._cleanupPeer(S),this._connections.delete(S)}}catch(E){_={error:E}}finally{try{M&&!M.done&&(w=b.return)&&w.call(b)}finally{if(_)throw _.error}}this.socket.removeAllListeners()},x.prototype._cleanupPeer=function(_){var w,b,M=this._connections.get(_);if(M)try{for(var S=r(M),E=S.next();!E.done;E=S.next())E.value.close()}catch(A){w={error:A}}finally{try{E&&!E.done&&(b=S.return)&&b.call(S)}finally{if(w)throw w.error}}},x.prototype.disconnect=function(){if(!this.disconnected){var _=this.id;u.default.log("Disconnect peer with ID:"+_),this._disconnected=!0,this._open=!1,this.socket.close(),this._lastServerId=_,this._id=null,this.emit(p.PeerEventType.Disconnected,_)}},x.prototype.reconnect=function(){if(this.disconnected&&!this.destroyed)u.default.log("Attempting reconnection to server with ID "+this._lastServerId),this._disconnected=!1,this._initialize(this._lastServerId);else{if(this.destroyed)throw new Error("This peer cannot reconnect to the server. It has already been destroyed.");if(this.disconnected||this.open)throw new Error("Peer "+this.id+" cannot reconnect because it is not disconnected from the server!");u.default.error("In a hurry? We're still trying to make the initial connection!")}},x.prototype.listAllPeers=function(_){var w=this;_===void 0&&(_=function(b){}),this._api.listAllPeers().then(function(b){return _(b)}).catch(function(b){return w._abort(p.PeerErrorType.ServerError,b)})},x.DEFAULT_KEY="peerjs",x}(l.EventEmitter);t.Peer=y},{eventemitter3:"JJlS","./util":"BHXf","./logger":"WOs9","./socket":"wJlv","./mediaconnection":"dbHP","./dataconnection":"GBTQ","./enums":"ZRYf","./api":"in7L"}],iTK6:[function(o,e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.peerjs=void 0;var n=o("./util"),i=o("./peer");t.peerjs={Peer:i.Peer,util:n.util},t.default=i.Peer,window.peerjs=t.peerjs,window.Peer=i.Peer},{"./util":"BHXf","./peer":"Hxpd"}]},{},["iTK6"],null)});var WN=Xd((gce,VN)=>{"use strict";VN.exports=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")}});var Cn={};NT(Cn,{ACESFilmicToneMapping:()=>cE,AddEquation:()=>_l,AddOperation:()=>sE,AdditiveAnimationBlendMode:()=>r_,AdditiveBlending:()=>Hx,AlphaFormat:()=>yE,AlwaysDepth:()=>$T,AlwaysStencilFunc:()=>hA,AmbientLight:()=>ma,AmbientLightProbe:()=>Mw,AnimationClip:()=>xs,AnimationLoader:()=>EC,AnimationMixer:()=>Rf,AnimationObjectGroup:()=>Cw,AnimationUtils:()=>Yt,ArcCurve:()=>zg,ArrayCamera:()=>Mg,ArrowHelper:()=>l2,Audio:()=>hy,AudioAnalyser:()=>Sw,AudioContext:()=>_w,AudioListener:()=>UC,AudioLoader:()=>ww,AxesHelper:()=>kw,AxisHelper:()=>zG,BackSide:()=>Qt,BasicDepthPacking:()=>lA,BasicShadowMap:()=>hO,BinaryTextureLoader:()=>WG,Bone:()=>fs,BooleanKeyframeTrack:()=>da,BoundingBoxHelper:()=>UG,Box2:()=>ho,Box3:()=>Sn,Box3Helper:()=>s2,BoxBufferGeometry:()=>ao,BoxGeometry:()=>ao,BoxHelper:()=>Nw,BufferAttribute:()=>Ye,BufferGeometry:()=>Ue,BufferGeometryLoader:()=>xw,ByteType:()=>hE,Cache:()=>uo,Camera:()=>au,CameraHelper:()=>r2,CanvasRenderer:()=>qG,CanvasTexture:()=>K_,CatmullRomCurve3:()=>Hg,CineonToneMapping:()=>lE,CircleBufferGeometry:()=>_u,CircleGeometry:()=>_u,ClampToEdgeWrapping:()=>an,Clock:()=>ga,Color:()=>De,ColorKeyframeTrack:()=>ny,CompressedTexture:()=>Fg,CompressedTextureLoader:()=>AC,ConeBufferGeometry:()=>wu,ConeGeometry:()=>wu,CubeCamera:()=>lf,CubeReflectionMapping:()=>jd,CubeRefractionMapping:()=>Yd,CubeTexture:()=>Il,CubeTextureLoader:()=>hw,CubeUVReflectionMapping:()=>Vc,CubeUVRefractionMapping:()=>Zd,CubicBezierCurve:()=>bf,CubicBezierCurve3:()=>Gg,CubicInterpolant:()=>lw,CullFaceBack:()=>kx,CullFaceFront:()=>kT,CullFaceFrontBack:()=>uO,CullFaceNone:()=>OT,Curve:()=>li,CurvePath:()=>fw,CustomBlending:()=>zT,CustomToneMapping:()=>uE,CylinderBufferGeometry:()=>ca,CylinderGeometry:()=>ca,Cylindrical:()=>qC,DataTexture:()=>aa,DataTexture2DArray:()=>wg,DataTexture3D:()=>bg,DataTextureLoader:()=>dw,DataUtils:()=>u2,DecrementStencilOp:()=>_O,DecrementWrapStencilOp:()=>bO,DefaultLoadingManager:()=>TC,DepthFormat:()=>Sl,DepthStencilFormat:()=>jc,DepthTexture:()=>$_,DirectionalLight:()=>bs,DirectionalLightHelper:()=>gy,DiscreteInterpolant:()=>cw,DodecahedronBufferGeometry:()=>bu,DodecahedronGeometry:()=>bu,DoubleSide:()=>Dr,DstAlphaFactor:()=>qT,DstColorFactor:()=>YT,DynamicBufferAttribute:()=>LG,DynamicCopyUsage:()=>NO,DynamicDrawUsage:()=>Yc,DynamicReadUsage:()=>DO,EdgesGeometry:()=>kg,EdgesHelper:()=>HG,EllipseCurve:()=>Mu,EqualDepth:()=>eE,EqualStencilFunc:()=>EO,EquirectangularReflectionMapping:()=>Gc,EquirectangularRefractionMapping:()=>Ym,Euler:()=>ri,EventDispatcher:()=>Wi,ExtrudeBufferGeometry:()=>zr,ExtrudeGeometry:()=>zr,FaceColors:()=>vG,FileLoader:()=>mn,FlatShading:()=>Ux,Float16BufferAttribute:()=>F_,Float32Attribute:()=>OG,Float32BufferAttribute:()=>Ne,Float64Attribute:()=>kG,Float64BufferAttribute:()=>B_,FloatType:()=>$s,Fog:()=>pu,FogExp2:()=>fu,Font:()=>cy,FontLoader:()=>FC,FrontSide:()=>Js,Frustum:()=>hu,GLBufferAttribute:()=>Rw,GLSL1:()=>kO,GLSL3:()=>c_,GammaEncoding:()=>$m,GreaterDepth:()=>nE,GreaterEqualDepth:()=>tE,GreaterEqualStencilFunc:()=>RO,GreaterStencilFunc:()=>CO,GridHelper:()=>Bw,Group:()=>Zn,HalfFloatType:()=>Ml,HemisphereLight:()=>Du,HemisphereLightHelper:()=>e2,HemisphereLightProbe:()=>bw,IcosahedronBufferGeometry:()=>Eu,IcosahedronGeometry:()=>Eu,ImageBitmapLoader:()=>Lf,ImageLoader:()=>pa,ImageUtils:()=>Ko,ImmediateRenderObject:()=>Iw,IncrementStencilOp:()=>xO,IncrementWrapStencilOp:()=>wO,InstancedBufferAttribute:()=>ay,InstancedBufferGeometry:()=>oy,InstancedInterleavedBuffer:()=>Lw,InstancedMesh:()=>Rg,Int16Attribute:()=>DG,Int16BufferAttribute:()=>I_,Int32Attribute:()=>BG,Int32BufferAttribute:()=>D_,Int8Attribute:()=>RG,Int8BufferAttribute:()=>L_,IntType:()=>fE,InterleavedBuffer:()=>ds,InterleavedBufferAttribute:()=>kr,Interpolant:()=>hr,InterpolateDiscrete:()=>Tl,InterpolateLinear:()=>Jo,InterpolateSmooth:()=>Zm,InvertStencilOp:()=>MO,JSONLoader:()=>jG,KeepStencilOp:()=>eg,KeyframeTrack:()=>dr,LOD:()=>j_,LatheBufferGeometry:()=>Au,LatheGeometry:()=>Au,Layers:()=>lg,LensFlare:()=>ZG,LessDepth:()=>QT,LessEqualDepth:()=>qm,LessEqualStencilFunc:()=>AO,LessStencilFunc:()=>TO,Light:()=>fr,LightProbe:()=>Bu,Line:()=>ai,Line3:()=>Gl,LineBasicMaterial:()=>zt,LineCurve:()=>Su,LineCurve3:()=>rw,LineDashedMaterial:()=>ey,LineLoop:()=>xu,LinePieces:()=>gG,LineSegments:()=>An,LineStrip:()=>mG,LinearEncoding:()=>Xn,LinearFilter:()=>Lt,LinearInterpolant:()=>ty,LinearMipMapLinearFilter:()=>gO,LinearMipMapNearestFilter:()=>mO,LinearMipmapLinearFilter:()=>hs,LinearMipmapNearestFilter:()=>Jd,LinearToneMapping:()=>oE,Loader:()=>tn,LoaderUtils:()=>Mi,LoadingManager:()=>iy,LogLuvEncoding:()=>aA,LoopOnce:()=>iA,LoopPingPong:()=>sA,LoopRepeat:()=>rA,LuminanceAlphaFormat:()=>xE,LuminanceFormat:()=>vE,MOUSE:()=>jo,Material:()=>un,MaterialLoader:()=>vw,Math:()=>cn,MathUtils:()=>cn,Matrix3:()=>vt,Matrix4:()=>Pe,MaxEquation:()=>Xx,Mesh:()=>et,MeshBasicMaterial:()=>Jt,MeshDepthMaterial:()=>df,MeshDistanceMaterial:()=>ff,MeshFaceMaterial:()=>_G,MeshLambertMaterial:()=>Iu,MeshMatcapMaterial:()=>Qg,MeshNormalMaterial:()=>$g,MeshPhongMaterial:()=>gs,MeshPhysicalMaterial:()=>Ol,MeshStandardMaterial:()=>Ur,MeshToonMaterial:()=>Kg,MinEquation:()=>Wx,MirroredRepeatWrapping:()=>wl,MixOperation:()=>rE,MultiMaterial:()=>wG,MultiplyBlending:()=>Vx,MultiplyOperation:()=>qd,NearestFilter:()=>ln,NearestMipMapLinearFilter:()=>pO,NearestMipMapNearestFilter:()=>fO,NearestMipmapLinearFilter:()=>Xc,NearestMipmapNearestFilter:()=>Wc,NeverDepth:()=>KT,NeverStencilFunc:()=>SO,NoBlending:()=>Ks,NoColors:()=>yG,NoToneMapping:()=>Zo,NormalAnimationBlendMode:()=>Jm,NormalBlending:()=>Hc,NotEqualDepth:()=>iE,NotEqualStencilFunc:()=>LO,NumberKeyframeTrack:()=>ys,Object3D:()=>$e,ObjectLoader:()=>ly,ObjectSpaceNormalMap:()=>uA,OctahedronBufferGeometry:()=>Fl,OctahedronGeometry:()=>Fl,OneFactor:()=>VT,OneMinusDstAlphaFactor:()=>jT,OneMinusDstColorFactor:()=>ZT,OneMinusSrcAlphaFactor:()=>jx,OneMinusSrcColorFactor:()=>XT,OrthographicCamera:()=>ci,PCFShadowMap:()=>zx,PCFSoftShadowMap:()=>Xm,PMREMGenerator:()=>y2,ParametricBufferGeometry:()=>jg,ParametricGeometry:()=>jg,Particle:()=>MG,ParticleBasicMaterial:()=>EG,ParticleSystem:()=>SG,ParticleSystemMaterial:()=>AG,Path:()=>_s,PerspectiveCamera:()=>It,Plane:()=>hn,PlaneBufferGeometry:()=>Bi,PlaneGeometry:()=>Bi,PlaneHelper:()=>o2,PointCloud:()=>bG,PointCloudMaterial:()=>TG,PointLight:()=>Xr,PointLightHelper:()=>KC,Points:()=>la,PointsMaterial:()=>ps,PolarGridHelper:()=>t2,PolyhedronBufferGeometry:()=>ms,PolyhedronGeometry:()=>ms,PositionalAudio:()=>GC,PropertyBinding:()=>st,PropertyMixer:()=>Tw,QuadraticBezierCurve:()=>Mf,QuadraticBezierCurve3:()=>Vg,Quaternion:()=>gt,QuaternionKeyframeTrack:()=>Hr,QuaternionLinearInterpolant:()=>uw,REVISION:()=>Zs,RGBADepthPacking:()=>cA,RGBAFormat:()=>Fi,RGBAIntegerFormat:()=>EE,RGBA_ASTC_10x10_Format:()=>zE,RGBA_ASTC_10x5_Format:()=>NE,RGBA_ASTC_10x6_Format:()=>OE,RGBA_ASTC_10x8_Format:()=>kE,RGBA_ASTC_12x10_Format:()=>UE,RGBA_ASTC_12x12_Format:()=>HE,RGBA_ASTC_4x4_Format:()=>CE,RGBA_ASTC_5x4_Format:()=>LE,RGBA_ASTC_5x5_Format:()=>RE,RGBA_ASTC_6x5_Format:()=>PE,RGBA_ASTC_6x6_Format:()=>IE,RGBA_ASTC_8x5_Format:()=>DE,RGBA_ASTC_8x6_Format:()=>FE,RGBA_ASTC_8x8_Format:()=>BE,RGBA_BPTC_Format:()=>GE,RGBA_ETC2_EAC_Format:()=>i_,RGBA_PVRTC_2BPPV1_Format:()=>t_,RGBA_PVRTC_4BPPV1_Format:()=>e_,RGBA_S3TC_DXT1_Format:()=>Zx,RGBA_S3TC_DXT3_Format:()=>Jx,RGBA_S3TC_DXT5_Format:()=>Kx,RGBDEncoding:()=>l_,RGBEEncoding:()=>Qm,RGBEFormat:()=>_E,RGBFormat:()=>Di,RGBIntegerFormat:()=>TE,RGBM16Encoding:()=>a_,RGBM7Encoding:()=>o_,RGB_ETC1_Format:()=>AE,RGB_ETC2_Format:()=>n_,RGB_PVRTC_2BPPV1_Format:()=>Qx,RGB_PVRTC_4BPPV1_Format:()=>$x,RGB_S3TC_DXT1_Format:()=>Yx,RGFormat:()=>ME,RGIntegerFormat:()=>SE,RawShaderMaterial:()=>Nl,Ray:()=>io,Raycaster:()=>Nu,RectAreaLight:()=>Fu,RedFormat:()=>wE,RedIntegerFormat:()=>bE,ReinhardToneMapping:()=>aE,RepeatWrapping:()=>En,ReplaceStencilOp:()=>vO,ReverseSubtractEquation:()=>HT,RingBufferGeometry:()=>ha,RingGeometry:()=>ha,SRGB8_ALPHA8_ASTC_10x10_Format:()=>eA,SRGB8_ALPHA8_ASTC_10x5_Format:()=>KE,SRGB8_ALPHA8_ASTC_10x6_Format:()=>$E,SRGB8_ALPHA8_ASTC_10x8_Format:()=>QE,SRGB8_ALPHA8_ASTC_12x10_Format:()=>tA,SRGB8_ALPHA8_ASTC_12x12_Format:()=>nA,SRGB8_ALPHA8_ASTC_4x4_Format:()=>VE,SRGB8_ALPHA8_ASTC_5x4_Format:()=>WE,SRGB8_ALPHA8_ASTC_5x5_Format:()=>XE,SRGB8_ALPHA8_ASTC_6x5_Format:()=>qE,SRGB8_ALPHA8_ASTC_6x6_Format:()=>jE,SRGB8_ALPHA8_ASTC_8x5_Format:()=>YE,SRGB8_ALPHA8_ASTC_8x6_Format:()=>ZE,SRGB8_ALPHA8_ASTC_8x8_Format:()=>JE,Scene:()=>Dl,SceneUtils:()=>YG,ShaderChunk:()=>lt,ShaderLib:()=>Or,ShaderMaterial:()=>Fn,ShadowMaterial:()=>Jg,Shape:()=>Wr,ShapeBufferGeometry:()=>Bl,ShapeGeometry:()=>Bl,ShapePath:()=>qr,ShapeUtils:()=>Zi,ShortType:()=>dE,Skeleton:()=>co,SkeletonHelper:()=>Fw,SkinnedMesh:()=>lo,SmoothShading:()=>dO,Sphere:()=>qi,SphereBufferGeometry:()=>Ji,SphereGeometry:()=>Ji,Spherical:()=>If,SphericalHarmonics3:()=>sy,SplineCurve:()=>Sf,SpotLight:()=>ws,SpotLightHelper:()=>fy,Sprite:()=>vf,SpriteMaterial:()=>pf,SrcAlphaFactor:()=>qx,SrcAlphaSaturateFactor:()=>JT,SrcColorFactor:()=>WT,StaticCopyUsage:()=>BO,StaticDrawUsage:()=>eo,StaticReadUsage:()=>IO,StereoCamera:()=>OC,StreamCopyUsage:()=>OO,StreamDrawUsage:()=>PO,StreamReadUsage:()=>FO,StringKeyframeTrack:()=>fa,SubtractEquation:()=>UT,SubtractiveBlending:()=>Gx,TOUCH:()=>Yo,TangentSpaceNormalMap:()=>Qs,TetrahedronBufferGeometry:()=>Cu,TetrahedronGeometry:()=>Cu,TextBufferGeometry:()=>Yg,TextGeometry:()=>Yg,Texture:()=>Vt,TextureLoader:()=>Vr,TorusBufferGeometry:()=>Lu,TorusGeometry:()=>Lu,TorusKnotBufferGeometry:()=>Ru,TorusKnotGeometry:()=>Ru,Triangle:()=>Zt,TriangleFanDrawMode:()=>Km,TriangleStripDrawMode:()=>s_,TrianglesDrawMode:()=>oA,TubeBufferGeometry:()=>Pu,TubeGeometry:()=>Pu,UVMapping:()=>jm,Uint16Attribute:()=>FG,Uint16BufferAttribute:()=>Pl,Uint32Attribute:()=>NG,Uint32BufferAttribute:()=>of,Uint8Attribute:()=>PG,Uint8BufferAttribute:()=>R_,Uint8ClampedAttribute:()=>IG,Uint8ClampedBufferAttribute:()=>P_,Uniform:()=>Pf,UniformsLib:()=>He,UniformsUtils:()=>sa,UnsignedByteType:()=>bl,UnsignedInt248Type:()=>qc,UnsignedIntType:()=>$d,UnsignedShort4444Type:()=>pE,UnsignedShort5551Type:()=>mE,UnsignedShort565Type:()=>gE,UnsignedShortType:()=>Kd,VSMShadowMap:()=>Uc,Vector2:()=>_e,Vector3:()=>U,Vector4:()=>tt,VectorKeyframeTrack:()=>vs,Vertex:()=>CG,VertexColors:()=>xG,VideoTexture:()=>J_,WebGL1Renderer:()=>X_,WebGLCubeRenderTarget:()=>cf,WebGLMultipleRenderTargets:()=>f_,WebGLMultisampleRenderTarget:()=>ng,WebGLRenderTarget:()=>Yn,WebGLRenderTargetCube:()=>XG,WebGLRenderer:()=>Rt,WebGLUtils:()=>KA,WireframeGeometry:()=>Zg,WireframeHelper:()=>GG,WrapAroundEnding:()=>Qd,XHRLoader:()=>VG,ZeroCurvatureEnding:()=>El,ZeroFactor:()=>GT,ZeroSlopeEnding:()=>Al,ZeroStencilOp:()=>yO,sRGBEncoding:()=>Vi});var Zs="130",jo={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},Yo={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},OT=0,kx=1,kT=2,uO=3,hO=0,zx=1,Xm=2,Uc=3,Js=0,Qt=1,Dr=2,Ux=1,dO=2,Ks=0,Hc=1,Hx=2,Gx=3,Vx=4,zT=5,_l=100,UT=101,HT=102,Wx=103,Xx=104,GT=200,VT=201,WT=202,XT=203,qx=204,jx=205,qT=206,jT=207,YT=208,ZT=209,JT=210,KT=0,$T=1,QT=2,qm=3,eE=4,tE=5,nE=6,iE=7,qd=0,rE=1,sE=2,Zo=0,oE=1,aE=2,lE=3,cE=4,uE=5,jm=300,jd=301,Yd=302,Gc=303,Ym=304,Vc=306,Zd=307,En=1e3,an=1001,wl=1002,ln=1003,Wc=1004,fO=1004,Xc=1005,pO=1005,Lt=1006,Jd=1007,mO=1007,hs=1008,gO=1008,bl=1009,hE=1010,dE=1011,Kd=1012,fE=1013,$d=1014,$s=1015,Ml=1016,pE=1017,mE=1018,gE=1019,qc=1020,yE=1021,Di=1022,Fi=1023,vE=1024,xE=1025,_E=Fi,Sl=1026,jc=1027,wE=1028,bE=1029,ME=1030,SE=1031,TE=1032,EE=1033,Yx=33776,Zx=33777,Jx=33778,Kx=33779,$x=35840,Qx=35841,e_=35842,t_=35843,AE=36196,n_=37492,i_=37496,CE=37808,LE=37809,RE=37810,PE=37811,IE=37812,DE=37813,FE=37814,BE=37815,NE=37816,OE=37817,kE=37818,zE=37819,UE=37820,HE=37821,GE=36492,VE=37840,WE=37841,XE=37842,qE=37843,jE=37844,YE=37845,ZE=37846,JE=37847,KE=37848,$E=37849,QE=37850,eA=37851,tA=37852,nA=37853,iA=2200,rA=2201,sA=2202,Tl=2300,Jo=2301,Zm=2302,El=2400,Al=2401,Qd=2402,Jm=2500,r_=2501,oA=0,s_=1,Km=2,Xn=3e3,Vi=3001,$m=3007,Qm=3002,aA=3003,o_=3004,a_=3005,l_=3006,lA=3200,cA=3201,Qs=0,uA=1,yO=0,eg=7680,vO=7681,xO=7682,_O=7683,wO=34055,bO=34056,MO=5386,SO=512,TO=513,EO=514,AO=515,CO=516,LO=517,RO=518,hA=519,eo=35044,Yc=35048,PO=35040,IO=35045,DO=35049,FO=35041,BO=35046,NO=35050,OO=35042,kO="100",c_="300 es",Wi=class{addEventListener(e,t){this._listeners===void 0&&(this._listeners={});let n=this._listeners;n[e]===void 0&&(n[e]=[]),n[e].indexOf(t)===-1&&n[e].push(t)}hasEventListener(e,t){if(this._listeners===void 0)return!1;let n=this._listeners;return n[e]!==void 0&&n[e].indexOf(t)!==-1}removeEventListener(e,t){if(this._listeners===void 0)return;let i=this._listeners[e];if(i!==void 0){let r=i.indexOf(t);r!==-1&&i.splice(r,1)}}dispatchEvent(e){if(this._listeners===void 0)return;let n=this._listeners[e.type];if(n!==void 0){e.target=this;let i=n.slice(0);for(let r=0,s=i.length;r<s;r++)i[r].call(this,e);e.target=null}}},qn=[];for(let o=0;o<256;o++)qn[o]=(o<16?"0":"")+o.toString(16);var tg=1234567,Cl=Math.PI/180,ef=180/Math.PI;function Xi(){let o=Math.random()*4294967295|0,e=Math.random()*4294967295|0,t=Math.random()*4294967295|0,n=Math.random()*4294967295|0;return(qn[o&255]+qn[o>>8&255]+qn[o>>16&255]+qn[o>>24&255]+"-"+qn[e&255]+qn[e>>8&255]+"-"+qn[e>>16&15|64]+qn[e>>24&255]+"-"+qn[t&63|128]+qn[t>>8&255]+"-"+qn[t>>16&255]+qn[t>>24&255]+qn[n&255]+qn[n>>8&255]+qn[n>>16&255]+qn[n>>24&255]).toUpperCase()}function jn(o,e,t){return Math.max(e,Math.min(t,o))}function u_(o,e){return(o%e+e)%e}function zO(o,e,t,n,i){return n+(o-e)*(i-n)/(t-e)}function UO(o,e,t){return o!==e?(t-o)/(e-o):0}function tf(o,e,t){return(1-t)*o+t*e}function HO(o,e,t,n){return tf(o,e,1-Math.exp(-t*n))}function GO(o,e=1){return e-Math.abs(u_(o,e*2)-e)}function VO(o,e,t){return o<=e?0:o>=t?1:(o=(o-e)/(t-e),o*o*(3-2*o))}function WO(o,e,t){return o<=e?0:o>=t?1:(o=(o-e)/(t-e),o*o*o*(o*(o*6-15)+10))}function XO(o,e){return o+Math.floor(Math.random()*(e-o+1))}function qO(o,e){return o+Math.random()*(e-o)}function jO(o){return o*(.5-Math.random())}function YO(o){return o!==void 0&&(tg=o%2147483647),tg=tg*16807%2147483647,(tg-1)/2147483646}function ZO(o){return o*Cl}function JO(o){return o*ef}function h_(o){return(o&o-1)==0&&o!==0}function dA(o){return Math.pow(2,Math.ceil(Math.log(o)/Math.LN2))}function fA(o){return Math.pow(2,Math.floor(Math.log(o)/Math.LN2))}function KO(o,e,t,n,i){let r=Math.cos,s=Math.sin,a=r(t/2),l=s(t/2),c=r((e+n)/2),u=s((e+n)/2),d=r((e-n)/2),h=s((e-n)/2),f=r((n-e)/2),p=s((n-e)/2);switch(i){case"XYX":o.set(a*u,l*d,l*h,a*c);break;case"YZY":o.set(l*h,a*u,l*d,a*c);break;case"ZXZ":o.set(l*d,l*h,a*u,a*c);break;case"XZX":o.set(a*u,l*p,l*f,a*c);break;case"YXY":o.set(l*f,a*u,l*p,a*c);break;case"ZYZ":o.set(l*p,l*f,a*u,a*c);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+i)}}var cn=Object.freeze({__proto__:null,DEG2RAD:Cl,RAD2DEG:ef,generateUUID:Xi,clamp:jn,euclideanModulo:u_,mapLinear:zO,inverseLerp:UO,lerp:tf,damp:HO,pingpong:GO,smoothstep:VO,smootherstep:WO,randInt:XO,randFloat:qO,randFloatSpread:jO,seededRandom:YO,degToRad:ZO,radToDeg:JO,isPowerOfTwo:h_,ceilPowerOfTwo:dA,floorPowerOfTwo:fA,setQuaternionFromProperEuler:KO}),_e=class{constructor(e=0,t=0){this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e,t){return t!==void 0?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this)}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e,t){return t!==void 0?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this)}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){let t=this.x,n=this.y,i=e.elements;return this.x=i[0]*t+i[3]*n+i[6],this.y=i[1]*t+i[4]*n+i[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}clampLength(e,t){let n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){let t=this.x-e.x,n=this.y-e.y;return t*t+n*n}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t,n){return n!==void 0&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){let n=Math.cos(t),i=Math.sin(t),r=this.x-e.x,s=this.y-e.y;return this.x=r*n-s*i+e.x,this.y=r*i+s*n+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}};_e.prototype.isVector2=!0;var vt=class{constructor(){this.elements=[1,0,0,0,1,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}set(e,t,n,i,r,s,a,l,c){let u=this.elements;return u[0]=e,u[1]=i,u[2]=a,u[3]=t,u[4]=r,u[5]=l,u[6]=n,u[7]=s,u[8]=c,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){let t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],this}extractBasis(e,t,n){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this}setFromMatrix4(e){let t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){let n=e.elements,i=t.elements,r=this.elements,s=n[0],a=n[3],l=n[6],c=n[1],u=n[4],d=n[7],h=n[2],f=n[5],p=n[8],g=i[0],v=i[3],y=i[6],m=i[1],x=i[4],_=i[7],w=i[2],b=i[5],M=i[8];return r[0]=s*g+a*m+l*w,r[3]=s*v+a*x+l*b,r[6]=s*y+a*_+l*M,r[1]=c*g+u*m+d*w,r[4]=c*v+u*x+d*b,r[7]=c*y+u*_+d*M,r[2]=h*g+f*m+p*w,r[5]=h*v+f*x+p*b,r[8]=h*y+f*_+p*M,this}multiplyScalar(e){let t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){let e=this.elements,t=e[0],n=e[1],i=e[2],r=e[3],s=e[4],a=e[5],l=e[6],c=e[7],u=e[8];return t*s*u-t*a*c-n*r*u+n*a*l+i*r*c-i*s*l}invert(){let e=this.elements,t=e[0],n=e[1],i=e[2],r=e[3],s=e[4],a=e[5],l=e[6],c=e[7],u=e[8],d=u*s-a*c,h=a*l-u*r,f=c*r-s*l,p=t*d+n*h+i*f;if(p===0)return this.set(0,0,0,0,0,0,0,0,0);let g=1/p;return e[0]=d*g,e[1]=(i*c-u*n)*g,e[2]=(a*n-i*s)*g,e[3]=h*g,e[4]=(u*t-i*l)*g,e[5]=(i*r-a*t)*g,e[6]=f*g,e[7]=(n*l-c*t)*g,e[8]=(s*t-n*r)*g,this}transpose(){let e,t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){let t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,n,i,r,s,a){let l=Math.cos(r),c=Math.sin(r);return this.set(n*l,n*c,-n*(l*s+c*a)+s+e,-i*c,i*l,-i*(-c*s+l*a)+a+t,0,0,1),this}scale(e,t){let n=this.elements;return n[0]*=e,n[3]*=e,n[6]*=e,n[1]*=t,n[4]*=t,n[7]*=t,this}rotate(e){let t=Math.cos(e),n=Math.sin(e),i=this.elements,r=i[0],s=i[3],a=i[6],l=i[1],c=i[4],u=i[7];return i[0]=t*r+n*l,i[3]=t*s+n*c,i[6]=t*a+n*u,i[1]=-n*r+t*l,i[4]=-n*s+t*c,i[7]=-n*a+t*u,this}translate(e,t){let n=this.elements;return n[0]+=e*n[2],n[3]+=e*n[5],n[6]+=e*n[8],n[1]+=t*n[2],n[4]+=t*n[5],n[7]+=t*n[8],this}equals(e){let t=this.elements,n=e.elements;for(let i=0;i<9;i++)if(t[i]!==n[i])return!1;return!0}fromArray(e,t=0){for(let n=0;n<9;n++)this.elements[n]=e[n+t];return this}toArray(e=[],t=0){let n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e}clone(){return new this.constructor().fromArray(this.elements)}};vt.prototype.isMatrix3=!0;var Zc,Ko=class{static getDataURL(e){if(/^data:/i.test(e.src)||typeof HTMLCanvasElement=="undefined")return e.src;let t;if(e instanceof HTMLCanvasElement)t=e;else{Zc===void 0&&(Zc=document.createElementNS("http://www.w3.org/1999/xhtml","canvas")),Zc.width=e.width,Zc.height=e.height;let n=Zc.getContext("2d");e instanceof ImageData?n.putImageData(e,0,0):n.drawImage(e,0,0,e.width,e.height),t=Zc}return t.width>2048||t.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),t.toDataURL("image/jpeg",.6)):t.toDataURL("image/png")}},$O=0,Vt=class extends Wi{constructor(e=Vt.DEFAULT_IMAGE,t=Vt.DEFAULT_MAPPING,n=an,i=an,r=Lt,s=hs,a=Fi,l=bl,c=1,u=Xn){super();Object.defineProperty(this,"id",{value:$O++}),this.uuid=Xi(),this.name="",this.image=e,this.mipmaps=[],this.mapping=t,this.wrapS=n,this.wrapT=i,this.magFilter=r,this.minFilter=s,this.anisotropy=c,this.format=a,this.internalFormat=null,this.type=l,this.offset=new _e(0,0),this.repeat=new _e(1,1),this.center=new _e(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new vt,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=u,this.version=0,this.onUpdate=null}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(e){return this.name=e.name,this.image=e.image,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.encoding=e.encoding,this}toJSON(e){let t=e===void 0||typeof e=="string";if(!t&&e.textures[this.uuid]!==void 0)return e.textures[this.uuid];let n={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};if(this.image!==void 0){let i=this.image;if(i.uuid===void 0&&(i.uuid=Xi()),!t&&e.images[i.uuid]===void 0){let r;if(Array.isArray(i)){r=[];for(let s=0,a=i.length;s<a;s++)i[s].isDataTexture?r.push(d_(i[s].image)):r.push(d_(i[s]))}else r=d_(i);e.images[i.uuid]={uuid:i.uuid,url:r}}n.image=i.uuid}return t||(e.textures[this.uuid]=n),n}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==jm)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case En:e.x=e.x-Math.floor(e.x);break;case an:e.x=e.x<0?0:1;break;case wl:Math.abs(Math.floor(e.x)%2)===1?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x);break}if(e.y<0||e.y>1)switch(this.wrapT){case En:e.y=e.y-Math.floor(e.y);break;case an:e.y=e.y<0?0:1;break;case wl:Math.abs(Math.floor(e.y)%2)===1?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y);break}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){e===!0&&this.version++}};Vt.DEFAULT_IMAGE=void 0;Vt.DEFAULT_MAPPING=jm;Vt.prototype.isTexture=!0;function d_(o){return typeof HTMLImageElement!="undefined"&&o instanceof HTMLImageElement||typeof HTMLCanvasElement!="undefined"&&o instanceof HTMLCanvasElement||typeof ImageBitmap!="undefined"&&o instanceof ImageBitmap?Ko.getDataURL(o):o.data?{data:Array.prototype.slice.call(o.data),width:o.width,height:o.height,type:o.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}var tt=class{constructor(e=0,t=0,n=0,i=1){this.x=e,this.y=t,this.z=n,this.w=i}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,n,i){return this.x=e,this.y=t,this.z=n,this.w=i,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w!==void 0?e.w:1,this}add(e,t){return t!==void 0?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this)}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e,t){return t!==void 0?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this)}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){let t=this.x,n=this.y,i=this.z,r=this.w,s=e.elements;return this.x=s[0]*t+s[4]*n+s[8]*i+s[12]*r,this.y=s[1]*t+s[5]*n+s[9]*i+s[13]*r,this.z=s[2]*t+s[6]*n+s[10]*i+s[14]*r,this.w=s[3]*t+s[7]*n+s[11]*i+s[15]*r,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);let t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,n,i,r,s=.01,a=.1,l=e.elements,c=l[0],u=l[4],d=l[8],h=l[1],f=l[5],p=l[9],g=l[2],v=l[6],y=l[10];if(Math.abs(u-h)<s&&Math.abs(d-g)<s&&Math.abs(p-v)<s){if(Math.abs(u+h)<a&&Math.abs(d+g)<a&&Math.abs(p+v)<a&&Math.abs(c+f+y-3)<a)return this.set(1,0,0,0),this;t=Math.PI;let x=(c+1)/2,_=(f+1)/2,w=(y+1)/2,b=(u+h)/4,M=(d+g)/4,S=(p+v)/4;return x>_&&x>w?x<s?(n=0,i=.707106781,r=.707106781):(n=Math.sqrt(x),i=b/n,r=M/n):_>w?_<s?(n=.707106781,i=0,r=.707106781):(i=Math.sqrt(_),n=b/i,r=S/i):w<s?(n=.707106781,i=.707106781,r=0):(r=Math.sqrt(w),n=M/r,i=S/r),this.set(n,i,r,t),this}let m=Math.sqrt((v-p)*(v-p)+(d-g)*(d-g)+(h-u)*(h-u));return Math.abs(m)<.001&&(m=1),this.x=(v-p)/m,this.y=(d-g)/m,this.z=(h-u)/m,this.w=Math.acos((c+f+y-1)/2),this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this}clampLength(e,t){let n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this.w=e.w+(t.w-e.w)*n,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t,n){return n!==void 0&&console.warn("THREE.Vector4: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}};tt.prototype.isVector4=!0;var Yn=class extends Wi{constructor(e,t,n={}){super();this.width=e,this.height=t,this.depth=1,this.scissor=new tt(0,0,e,t),this.scissorTest=!1,this.viewport=new tt(0,0,e,t),this.texture=new Vt(void 0,n.mapping,n.wrapS,n.wrapT,n.magFilter,n.minFilter,n.format,n.type,n.anisotropy,n.encoding),this.texture.image={width:e,height:t,depth:1},this.texture.generateMipmaps=n.generateMipmaps!==void 0?n.generateMipmaps:!1,this.texture.minFilter=n.minFilter!==void 0?n.minFilter:Lt,this.depthBuffer=n.depthBuffer!==void 0?n.depthBuffer:!0,this.stencilBuffer=n.stencilBuffer!==void 0?n.stencilBuffer:!1,this.depthTexture=n.depthTexture!==void 0?n.depthTexture:null}setTexture(e){e.image={width:this.width,height:this.height,depth:this.depth},this.texture=e}setSize(e,t,n=1){(this.width!==e||this.height!==t||this.depth!==n)&&(this.width=e,this.height=t,this.depth=n,this.texture.image.width=e,this.texture.image.height=t,this.texture.image.depth=n,this.dispose()),this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return new this.constructor().copy(this)}copy(e){return this.width=e.width,this.height=e.height,this.depth=e.depth,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.texture.image={...this.texture.image},this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.depthTexture=e.depthTexture,this}dispose(){this.dispatchEvent({type:"dispose"})}};Yn.prototype.isWebGLRenderTarget=!0;var f_=class extends Yn{constructor(e,t,n){super(e,t);let i=this.texture;this.texture=[];for(let r=0;r<n;r++)this.texture[r]=i.clone()}setSize(e,t,n=1){if(this.width!==e||this.height!==t||this.depth!==n){this.width=e,this.height=t,this.depth=n;for(let i=0,r=this.texture.length;i<r;i++)this.texture[i].image.width=e,this.texture[i].image.height=t,this.texture[i].image.depth=n;this.dispose()}return this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t),this}copy(e){this.dispose(),this.width=e.width,this.height=e.height,this.depth=e.depth,this.viewport.set(0,0,this.width,this.height),this.scissor.set(0,0,this.width,this.height),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.depthTexture=e.depthTexture,this.texture.length=0;for(let t=0,n=e.texture.length;t<n;t++)this.texture[t]=e.texture[t].clone();return this}};f_.prototype.isWebGLMultipleRenderTargets=!0;var ng=class extends Yn{constructor(e,t,n){super(e,t,n);this.samples=4}copy(e){return super.copy.call(this,e),this.samples=e.samples,this}};ng.prototype.isWebGLMultisampleRenderTarget=!0;var gt=class{constructor(e=0,t=0,n=0,i=1){this._x=e,this._y=t,this._z=n,this._w=i}static slerp(e,t,n,i){return console.warn("THREE.Quaternion: Static .slerp() has been deprecated. Use qm.slerpQuaternions( qa, qb, t ) instead."),n.slerpQuaternions(e,t,i)}static slerpFlat(e,t,n,i,r,s,a){let l=n[i+0],c=n[i+1],u=n[i+2],d=n[i+3],h=r[s+0],f=r[s+1],p=r[s+2],g=r[s+3];if(a===0){e[t+0]=l,e[t+1]=c,e[t+2]=u,e[t+3]=d;return}if(a===1){e[t+0]=h,e[t+1]=f,e[t+2]=p,e[t+3]=g;return}if(d!==g||l!==h||c!==f||u!==p){let v=1-a,y=l*h+c*f+u*p+d*g,m=y>=0?1:-1,x=1-y*y;if(x>Number.EPSILON){let w=Math.sqrt(x),b=Math.atan2(w,y*m);v=Math.sin(v*b)/w,a=Math.sin(a*b)/w}let _=a*m;if(l=l*v+h*_,c=c*v+f*_,u=u*v+p*_,d=d*v+g*_,v===1-a){let w=1/Math.sqrt(l*l+c*c+u*u+d*d);l*=w,c*=w,u*=w,d*=w}}e[t]=l,e[t+1]=c,e[t+2]=u,e[t+3]=d}static multiplyQuaternionsFlat(e,t,n,i,r,s){let a=n[i],l=n[i+1],c=n[i+2],u=n[i+3],d=r[s],h=r[s+1],f=r[s+2],p=r[s+3];return e[t]=a*p+u*d+l*f-c*h,e[t+1]=l*p+u*h+c*d-a*f,e[t+2]=c*p+u*f+a*h-l*d,e[t+3]=u*p-a*d-l*h-c*f,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,n,i){return this._x=e,this._y=t,this._z=n,this._w=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t){if(!(e&&e.isEuler))throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");let n=e._x,i=e._y,r=e._z,s=e._order,a=Math.cos,l=Math.sin,c=a(n/2),u=a(i/2),d=a(r/2),h=l(n/2),f=l(i/2),p=l(r/2);switch(s){case"XYZ":this._x=h*u*d+c*f*p,this._y=c*f*d-h*u*p,this._z=c*u*p+h*f*d,this._w=c*u*d-h*f*p;break;case"YXZ":this._x=h*u*d+c*f*p,this._y=c*f*d-h*u*p,this._z=c*u*p-h*f*d,this._w=c*u*d+h*f*p;break;case"ZXY":this._x=h*u*d-c*f*p,this._y=c*f*d+h*u*p,this._z=c*u*p+h*f*d,this._w=c*u*d-h*f*p;break;case"ZYX":this._x=h*u*d-c*f*p,this._y=c*f*d+h*u*p,this._z=c*u*p-h*f*d,this._w=c*u*d+h*f*p;break;case"YZX":this._x=h*u*d+c*f*p,this._y=c*f*d+h*u*p,this._z=c*u*p-h*f*d,this._w=c*u*d-h*f*p;break;case"XZY":this._x=h*u*d-c*f*p,this._y=c*f*d-h*u*p,this._z=c*u*p+h*f*d,this._w=c*u*d+h*f*p;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+s)}return t!==!1&&this._onChangeCallback(),this}setFromAxisAngle(e,t){let n=t/2,i=Math.sin(n);return this._x=e.x*i,this._y=e.y*i,this._z=e.z*i,this._w=Math.cos(n),this._onChangeCallback(),this}setFromRotationMatrix(e){let t=e.elements,n=t[0],i=t[4],r=t[8],s=t[1],a=t[5],l=t[9],c=t[2],u=t[6],d=t[10],h=n+a+d;if(h>0){let f=.5/Math.sqrt(h+1);this._w=.25/f,this._x=(u-l)*f,this._y=(r-c)*f,this._z=(s-i)*f}else if(n>a&&n>d){let f=2*Math.sqrt(1+n-a-d);this._w=(u-l)/f,this._x=.25*f,this._y=(i+s)/f,this._z=(r+c)/f}else if(a>d){let f=2*Math.sqrt(1+a-n-d);this._w=(r-c)/f,this._x=(i+s)/f,this._y=.25*f,this._z=(l+u)/f}else{let f=2*Math.sqrt(1+d-n-a);this._w=(s-i)/f,this._x=(r+c)/f,this._y=(l+u)/f,this._z=.25*f}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let n=e.dot(t)+1;return n<Number.EPSILON?(n=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=n):(this._x=0,this._y=-e.z,this._z=e.y,this._w=n)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=n),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(jn(this.dot(e),-1,1)))}rotateTowards(e,t){let n=this.angleTo(e);if(n===0)return this;let i=Math.min(1,t/n);return this.slerp(e,i),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return e===0?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e,t){return t!==void 0?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(e,t)):this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){let n=e._x,i=e._y,r=e._z,s=e._w,a=t._x,l=t._y,c=t._z,u=t._w;return this._x=n*u+s*a+i*c-r*l,this._y=i*u+s*l+r*a-n*c,this._z=r*u+s*c+n*l-i*a,this._w=s*u-n*a-i*l-r*c,this._onChangeCallback(),this}slerp(e,t){if(t===0)return this;if(t===1)return this.copy(e);let n=this._x,i=this._y,r=this._z,s=this._w,a=s*e._w+n*e._x+i*e._y+r*e._z;if(a<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,a=-a):this.copy(e),a>=1)return this._w=s,this._x=n,this._y=i,this._z=r,this;let l=1-a*a;if(l<=Number.EPSILON){let f=1-t;return this._w=f*s+t*this._w,this._x=f*n+t*this._x,this._y=f*i+t*this._y,this._z=f*r+t*this._z,this.normalize(),this._onChangeCallback(),this}let c=Math.sqrt(l),u=Math.atan2(c,a),d=Math.sin((1-t)*u)/c,h=Math.sin(t*u)/c;return this._w=s*d+this._w*h,this._x=n*d+this._x*h,this._y=i*d+this._y*h,this._z=r*d+this._z*h,this._onChangeCallback(),this}slerpQuaternions(e,t,n){this.copy(e).slerp(t,n)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}};gt.prototype.isQuaternion=!0;var U=class{constructor(e=0,t=0,n=0){this.x=e,this.y=t,this.z=n}set(e,t,n){return n===void 0&&(n=this.z),this.x=e,this.y=t,this.z=n,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e,t){return t!==void 0?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this)}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e,t){return t!==void 0?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this)}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e,t){return t!==void 0?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(e,t)):(this.x*=e.x,this.y*=e.y,this.z*=e.z,this)}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return e&&e.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(pA.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(pA.setFromAxisAngle(e,t))}applyMatrix3(e){let t=this.x,n=this.y,i=this.z,r=e.elements;return this.x=r[0]*t+r[3]*n+r[6]*i,this.y=r[1]*t+r[4]*n+r[7]*i,this.z=r[2]*t+r[5]*n+r[8]*i,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){let t=this.x,n=this.y,i=this.z,r=e.elements,s=1/(r[3]*t+r[7]*n+r[11]*i+r[15]);return this.x=(r[0]*t+r[4]*n+r[8]*i+r[12])*s,this.y=(r[1]*t+r[5]*n+r[9]*i+r[13])*s,this.z=(r[2]*t+r[6]*n+r[10]*i+r[14])*s,this}applyQuaternion(e){let t=this.x,n=this.y,i=this.z,r=e.x,s=e.y,a=e.z,l=e.w,c=l*t+s*i-a*n,u=l*n+a*t-r*i,d=l*i+r*n-s*t,h=-r*t-s*n-a*i;return this.x=c*l+h*-r+u*-a-d*-s,this.y=u*l+h*-s+d*-r-c*-a,this.z=d*l+h*-a+c*-s-u*-r,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){let t=this.x,n=this.y,i=this.z,r=e.elements;return this.x=r[0]*t+r[4]*n+r[8]*i,this.y=r[1]*t+r[5]*n+r[9]*i,this.z=r[2]*t+r[6]*n+r[10]*i,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this}clampLength(e,t){let n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this}cross(e,t){return t!==void 0?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(e,t)):this.crossVectors(this,e)}crossVectors(e,t){let n=e.x,i=e.y,r=e.z,s=t.x,a=t.y,l=t.z;return this.x=i*l-r*a,this.y=r*s-n*l,this.z=n*a-i*s,this}projectOnVector(e){let t=e.lengthSq();if(t===0)return this.set(0,0,0);let n=e.dot(this)/t;return this.copy(e).multiplyScalar(n)}projectOnPlane(e){return p_.copy(this).projectOnVector(e),this.sub(p_)}reflect(e){return this.sub(p_.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){let t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;let n=this.dot(e)/t;return Math.acos(jn(n,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){let t=this.x-e.x,n=this.y-e.y,i=this.z-e.z;return t*t+n*n+i*i}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,n){let i=Math.sin(t)*e;return this.x=i*Math.sin(n),this.y=Math.cos(t)*e,this.z=i*Math.cos(n),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,n){return this.x=e*Math.sin(t),this.y=n,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){let t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){let t=this.setFromMatrixColumn(e,0).length(),n=this.setFromMatrixColumn(e,1).length(),i=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=n,this.z=i,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,t*4)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,t*3)}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t,n){return n!==void 0&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}};U.prototype.isVector3=!0;var p_=new U,pA=new gt,Sn=class{constructor(e=new U(1/0,1/0,1/0),t=new U(-1/0,-1/0,-1/0)){this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){let t=1/0,n=1/0,i=1/0,r=-1/0,s=-1/0,a=-1/0;for(let l=0,c=e.length;l<c;l+=3){let u=e[l],d=e[l+1],h=e[l+2];u<t&&(t=u),d<n&&(n=d),h<i&&(i=h),u>r&&(r=u),d>s&&(s=d),h>a&&(a=h)}return this.min.set(t,n,i),this.max.set(r,s,a),this}setFromBufferAttribute(e){let t=1/0,n=1/0,i=1/0,r=-1/0,s=-1/0,a=-1/0;for(let l=0,c=e.count;l<c;l++){let u=e.getX(l),d=e.getY(l),h=e.getZ(l);u<t&&(t=u),d<n&&(n=d),h<i&&(i=h),u>r&&(r=u),d>s&&(s=d),h>a&&(a=h)}return this.min.set(t,n,i),this.max.set(r,s,a),this}setFromPoints(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){let n=nf.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}setFromObject(e){return this.makeEmpty(),this.expandByObject(e)}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e){e.updateWorldMatrix(!1,!1);let t=e.geometry;t!==void 0&&(t.boundingBox===null&&t.computeBoundingBox(),m_.copy(t.boundingBox),m_.applyMatrix4(e.matrixWorld),this.union(m_));let n=e.children;for(let i=0,r=n.length;i<r;i++)this.expandByObject(n[i]);return this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)}intersectsSphere(e){return this.clampPoint(e.center,nf),nf.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,n;return e.normal.x>0?(t=e.normal.x*this.min.x,n=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,n=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,n+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,n+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,n+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,n+=e.normal.z*this.min.z),t<=-e.constant&&n>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(rf),ig.subVectors(this.max,rf),Jc.subVectors(e.a,rf),Kc.subVectors(e.b,rf),$c.subVectors(e.c,rf),$o.subVectors(Kc,Jc),Qo.subVectors($c,Kc),Ll.subVectors(Jc,$c);let t=[0,-$o.z,$o.y,0,-Qo.z,Qo.y,0,-Ll.z,Ll.y,$o.z,0,-$o.x,Qo.z,0,-Qo.x,Ll.z,0,-Ll.x,-$o.y,$o.x,0,-Qo.y,Qo.x,0,-Ll.y,Ll.x,0];return!g_(t,Jc,Kc,$c,ig)||(t=[1,0,0,0,1,0,0,0,1],!g_(t,Jc,Kc,$c,ig))?!1:(rg.crossVectors($o,Qo),t=[rg.x,rg.y,rg.z],g_(t,Jc,Kc,$c,ig))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return nf.copy(e).clamp(this.min,this.max).sub(e).length()}getBoundingSphere(e){return this.getCenter(e.center),e.radius=this.getSize(nf).length()*.5,e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()?this:(to[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),to[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),to[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),to[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),to[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),to[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),to[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),to[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(to),this)}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}};Sn.prototype.isBox3=!0;var to=[new U,new U,new U,new U,new U,new U,new U,new U],nf=new U,m_=new Sn,Jc=new U,Kc=new U,$c=new U,$o=new U,Qo=new U,Ll=new U,rf=new U,ig=new U,rg=new U,Rl=new U;function g_(o,e,t,n,i){for(let r=0,s=o.length-3;r<=s;r+=3){Rl.fromArray(o,r);let a=i.x*Math.abs(Rl.x)+i.y*Math.abs(Rl.y)+i.z*Math.abs(Rl.z),l=e.dot(Rl),c=t.dot(Rl),u=n.dot(Rl);if(Math.max(-Math.max(l,c,u),Math.min(l,c,u))>a)return!1}return!0}var QO=new Sn,mA=new U,y_=new U,v_=new U,qi=class{constructor(e=new U,t=-1){this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){let n=this.center;t!==void 0?n.copy(t):QO.setFromPoints(e).getCenter(n);let i=0;for(let r=0,s=e.length;r<s;r++)i=Math.max(i,n.distanceToSquared(e[r]));return this.radius=Math.sqrt(i),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){let t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){let n=this.center.distanceToSquared(e);return t.copy(e),n>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){v_.subVectors(e,this.center);let t=v_.lengthSq();if(t>this.radius*this.radius){let n=Math.sqrt(t),i=(n-this.radius)*.5;this.center.add(v_.multiplyScalar(i/n)),this.radius+=i}return this}union(e){return y_.subVectors(e.center,this.center).normalize().multiplyScalar(e.radius),this.expandByPoint(mA.copy(e.center).add(y_)),this.expandByPoint(mA.copy(e.center).sub(y_)),this}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return new this.constructor().copy(this)}},no=new U,x_=new U,sg=new U,ea=new U,__=new U,og=new U,w_=new U,io=class{constructor(e=new U,t=new U(0,0,-1)){this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.direction).multiplyScalar(e).add(this.origin)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,no)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);let n=t.dot(this.direction);return n<0?t.copy(this.origin):t.copy(this.direction).multiplyScalar(n).add(this.origin)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){let t=no.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(no.copy(this.direction).multiplyScalar(t).add(this.origin),no.distanceToSquared(e))}distanceSqToSegment(e,t,n,i){x_.copy(e).add(t).multiplyScalar(.5),sg.copy(t).sub(e).normalize(),ea.copy(this.origin).sub(x_);let r=e.distanceTo(t)*.5,s=-this.direction.dot(sg),a=ea.dot(this.direction),l=-ea.dot(sg),c=ea.lengthSq(),u=Math.abs(1-s*s),d,h,f,p;if(u>0)if(d=s*l-a,h=s*a-l,p=r*u,d>=0)if(h>=-p)if(h<=p){let g=1/u;d*=g,h*=g,f=d*(d+s*h+2*a)+h*(s*d+h+2*l)+c}else h=r,d=Math.max(0,-(s*h+a)),f=-d*d+h*(h+2*l)+c;else h=-r,d=Math.max(0,-(s*h+a)),f=-d*d+h*(h+2*l)+c;else h<=-p?(d=Math.max(0,-(-s*r+a)),h=d>0?-r:Math.min(Math.max(-r,-l),r),f=-d*d+h*(h+2*l)+c):h<=p?(d=0,h=Math.min(Math.max(-r,-l),r),f=h*(h+2*l)+c):(d=Math.max(0,-(s*r+a)),h=d>0?r:Math.min(Math.max(-r,-l),r),f=-d*d+h*(h+2*l)+c);else h=s>0?-r:r,d=Math.max(0,-(s*h+a)),f=-d*d+h*(h+2*l)+c;return n&&n.copy(this.direction).multiplyScalar(d).add(this.origin),i&&i.copy(sg).multiplyScalar(h).add(x_),f}intersectSphere(e,t){no.subVectors(e.center,this.origin);let n=no.dot(this.direction),i=no.dot(no)-n*n,r=e.radius*e.radius;if(i>r)return null;let s=Math.sqrt(r-i),a=n-s,l=n+s;return a<0&&l<0?null:a<0?this.at(l,t):this.at(a,t)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){let t=e.normal.dot(this.direction);if(t===0)return e.distanceToPoint(this.origin)===0?0:null;let n=-(this.origin.dot(e.normal)+e.constant)/t;return n>=0?n:null}intersectPlane(e,t){let n=this.distanceToPlane(e);return n===null?null:this.at(n,t)}intersectsPlane(e){let t=e.distanceToPoint(this.origin);return t===0||e.normal.dot(this.direction)*t<0}intersectBox(e,t){let n,i,r,s,a,l,c=1/this.direction.x,u=1/this.direction.y,d=1/this.direction.z,h=this.origin;return c>=0?(n=(e.min.x-h.x)*c,i=(e.max.x-h.x)*c):(n=(e.max.x-h.x)*c,i=(e.min.x-h.x)*c),u>=0?(r=(e.min.y-h.y)*u,s=(e.max.y-h.y)*u):(r=(e.max.y-h.y)*u,s=(e.min.y-h.y)*u),n>s||r>i||((r>n||n!==n)&&(n=r),(s<i||i!==i)&&(i=s),d>=0?(a=(e.min.z-h.z)*d,l=(e.max.z-h.z)*d):(a=(e.max.z-h.z)*d,l=(e.min.z-h.z)*d),n>l||a>i)||((a>n||n!==n)&&(n=a),(l<i||i!==i)&&(i=l),i<0)?null:this.at(n>=0?n:i,t)}intersectsBox(e){return this.intersectBox(e,no)!==null}intersectTriangle(e,t,n,i,r){__.subVectors(t,e),og.subVectors(n,e),w_.crossVectors(__,og);let s=this.direction.dot(w_),a;if(s>0){if(i)return null;a=1}else if(s<0)a=-1,s=-s;else return null;ea.subVectors(this.origin,e);let l=a*this.direction.dot(og.crossVectors(ea,og));if(l<0)return null;let c=a*this.direction.dot(__.cross(ea));if(c<0||l+c>s)return null;let u=-a*ea.dot(w_);return u<0?null:this.at(u/s,r)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}},Pe=class{constructor(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}set(e,t,n,i,r,s,a,l,c,u,d,h,f,p,g,v){let y=this.elements;return y[0]=e,y[4]=t,y[8]=n,y[12]=i,y[1]=r,y[5]=s,y[9]=a,y[13]=l,y[2]=c,y[6]=u,y[10]=d,y[14]=h,y[3]=f,y[7]=p,y[11]=g,y[15]=v,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new Pe().fromArray(this.elements)}copy(e){let t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],this}copyPosition(e){let t=this.elements,n=e.elements;return t[12]=n[12],t[13]=n[13],t[14]=n[14],this}setFromMatrix3(e){let t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,n){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this}makeBasis(e,t,n){return this.set(e.x,t.x,n.x,0,e.y,t.y,n.y,0,e.z,t.z,n.z,0,0,0,0,1),this}extractRotation(e){let t=this.elements,n=e.elements,i=1/Qc.setFromMatrixColumn(e,0).length(),r=1/Qc.setFromMatrixColumn(e,1).length(),s=1/Qc.setFromMatrixColumn(e,2).length();return t[0]=n[0]*i,t[1]=n[1]*i,t[2]=n[2]*i,t[3]=0,t[4]=n[4]*r,t[5]=n[5]*r,t[6]=n[6]*r,t[7]=0,t[8]=n[8]*s,t[9]=n[9]*s,t[10]=n[10]*s,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){e&&e.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");let t=this.elements,n=e.x,i=e.y,r=e.z,s=Math.cos(n),a=Math.sin(n),l=Math.cos(i),c=Math.sin(i),u=Math.cos(r),d=Math.sin(r);if(e.order==="XYZ"){let h=s*u,f=s*d,p=a*u,g=a*d;t[0]=l*u,t[4]=-l*d,t[8]=c,t[1]=f+p*c,t[5]=h-g*c,t[9]=-a*l,t[2]=g-h*c,t[6]=p+f*c,t[10]=s*l}else if(e.order==="YXZ"){let h=l*u,f=l*d,p=c*u,g=c*d;t[0]=h+g*a,t[4]=p*a-f,t[8]=s*c,t[1]=s*d,t[5]=s*u,t[9]=-a,t[2]=f*a-p,t[6]=g+h*a,t[10]=s*l}else if(e.order==="ZXY"){let h=l*u,f=l*d,p=c*u,g=c*d;t[0]=h-g*a,t[4]=-s*d,t[8]=p+f*a,t[1]=f+p*a,t[5]=s*u,t[9]=g-h*a,t[2]=-s*c,t[6]=a,t[10]=s*l}else if(e.order==="ZYX"){let h=s*u,f=s*d,p=a*u,g=a*d;t[0]=l*u,t[4]=p*c-f,t[8]=h*c+g,t[1]=l*d,t[5]=g*c+h,t[9]=f*c-p,t[2]=-c,t[6]=a*l,t[10]=s*l}else if(e.order==="YZX"){let h=s*l,f=s*c,p=a*l,g=a*c;t[0]=l*u,t[4]=g-h*d,t[8]=p*d+f,t[1]=d,t[5]=s*u,t[9]=-a*u,t[2]=-c*u,t[6]=f*d+p,t[10]=h-g*d}else if(e.order==="XZY"){let h=s*l,f=s*c,p=a*l,g=a*c;t[0]=l*u,t[4]=-d,t[8]=c*u,t[1]=h*d+g,t[5]=s*u,t[9]=f*d-p,t[2]=p*d-f,t[6]=a*u,t[10]=g*d+h}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(ek,e,tk)}lookAt(e,t,n){let i=this.elements;return ji.subVectors(e,t),ji.lengthSq()===0&&(ji.z=1),ji.normalize(),ta.crossVectors(n,ji),ta.lengthSq()===0&&(Math.abs(n.z)===1?ji.x+=1e-4:ji.z+=1e-4,ji.normalize(),ta.crossVectors(n,ji)),ta.normalize(),ag.crossVectors(ji,ta),i[0]=ta.x,i[4]=ag.x,i[8]=ji.x,i[1]=ta.y,i[5]=ag.y,i[9]=ji.y,i[2]=ta.z,i[6]=ag.z,i[10]=ji.z,this}multiply(e,t){return t!==void 0?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(e,t)):this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){let n=e.elements,i=t.elements,r=this.elements,s=n[0],a=n[4],l=n[8],c=n[12],u=n[1],d=n[5],h=n[9],f=n[13],p=n[2],g=n[6],v=n[10],y=n[14],m=n[3],x=n[7],_=n[11],w=n[15],b=i[0],M=i[4],S=i[8],E=i[12],A=i[1],L=i[5],B=i[9],R=i[13],D=i[2],P=i[6],I=i[10],N=i[14],G=i[3],z=i[7],se=i[11],ne=i[15];return r[0]=s*b+a*A+l*D+c*G,r[4]=s*M+a*L+l*P+c*z,r[8]=s*S+a*B+l*I+c*se,r[12]=s*E+a*R+l*N+c*ne,r[1]=u*b+d*A+h*D+f*G,r[5]=u*M+d*L+h*P+f*z,r[9]=u*S+d*B+h*I+f*se,r[13]=u*E+d*R+h*N+f*ne,r[2]=p*b+g*A+v*D+y*G,r[6]=p*M+g*L+v*P+y*z,r[10]=p*S+g*B+v*I+y*se,r[14]=p*E+g*R+v*N+y*ne,r[3]=m*b+x*A+_*D+w*G,r[7]=m*M+x*L+_*P+w*z,r[11]=m*S+x*B+_*I+w*se,r[15]=m*E+x*R+_*N+w*ne,this}multiplyScalar(e){let t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){let e=this.elements,t=e[0],n=e[4],i=e[8],r=e[12],s=e[1],a=e[5],l=e[9],c=e[13],u=e[2],d=e[6],h=e[10],f=e[14],p=e[3],g=e[7],v=e[11],y=e[15];return p*(+r*l*d-i*c*d-r*a*h+n*c*h+i*a*f-n*l*f)+g*(+t*l*f-t*c*h+r*s*h-i*s*f+i*c*u-r*l*u)+v*(+t*c*d-t*a*f-r*s*d+n*s*f+r*a*u-n*c*u)+y*(-i*a*u-t*l*d+t*a*h+i*s*d-n*s*h+n*l*u)}transpose(){let e=this.elements,t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,n){let i=this.elements;return e.isVector3?(i[12]=e.x,i[13]=e.y,i[14]=e.z):(i[12]=e,i[13]=t,i[14]=n),this}invert(){let e=this.elements,t=e[0],n=e[1],i=e[2],r=e[3],s=e[4],a=e[5],l=e[6],c=e[7],u=e[8],d=e[9],h=e[10],f=e[11],p=e[12],g=e[13],v=e[14],y=e[15],m=d*v*c-g*h*c+g*l*f-a*v*f-d*l*y+a*h*y,x=p*h*c-u*v*c-p*l*f+s*v*f+u*l*y-s*h*y,_=u*g*c-p*d*c+p*a*f-s*g*f-u*a*y+s*d*y,w=p*d*l-u*g*l-p*a*h+s*g*h+u*a*v-s*d*v,b=t*m+n*x+i*_+r*w;if(b===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);let M=1/b;return e[0]=m*M,e[1]=(g*h*r-d*v*r-g*i*f+n*v*f+d*i*y-n*h*y)*M,e[2]=(a*v*r-g*l*r+g*i*c-n*v*c-a*i*y+n*l*y)*M,e[3]=(d*l*r-a*h*r-d*i*c+n*h*c+a*i*f-n*l*f)*M,e[4]=x*M,e[5]=(u*v*r-p*h*r+p*i*f-t*v*f-u*i*y+t*h*y)*M,e[6]=(p*l*r-s*v*r-p*i*c+t*v*c+s*i*y-t*l*y)*M,e[7]=(s*h*r-u*l*r+u*i*c-t*h*c-s*i*f+t*l*f)*M,e[8]=_*M,e[9]=(p*d*r-u*g*r-p*n*f+t*g*f+u*n*y-t*d*y)*M,e[10]=(s*g*r-p*a*r+p*n*c-t*g*c-s*n*y+t*a*y)*M,e[11]=(u*a*r-s*d*r-u*n*c+t*d*c+s*n*f-t*a*f)*M,e[12]=w*M,e[13]=(u*g*i-p*d*i+p*n*h-t*g*h-u*n*v+t*d*v)*M,e[14]=(p*a*i-s*g*i-p*n*l+t*g*l+s*n*v-t*a*v)*M,e[15]=(s*d*i-u*a*i+u*n*l-t*d*l-s*n*h+t*a*h)*M,this}scale(e){let t=this.elements,n=e.x,i=e.y,r=e.z;return t[0]*=n,t[4]*=i,t[8]*=r,t[1]*=n,t[5]*=i,t[9]*=r,t[2]*=n,t[6]*=i,t[10]*=r,t[3]*=n,t[7]*=i,t[11]*=r,this}getMaxScaleOnAxis(){let e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],n=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],i=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,n,i))}makeTranslation(e,t,n){return this.set(1,0,0,e,0,1,0,t,0,0,1,n,0,0,0,1),this}makeRotationX(e){let t=Math.cos(e),n=Math.sin(e);return this.set(1,0,0,0,0,t,-n,0,0,n,t,0,0,0,0,1),this}makeRotationY(e){let t=Math.cos(e),n=Math.sin(e);return this.set(t,0,n,0,0,1,0,0,-n,0,t,0,0,0,0,1),this}makeRotationZ(e){let t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,0,n,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){let n=Math.cos(t),i=Math.sin(t),r=1-n,s=e.x,a=e.y,l=e.z,c=r*s,u=r*a;return this.set(c*s+n,c*a-i*l,c*l+i*a,0,c*a+i*l,u*a+n,u*l-i*s,0,c*l-i*a,u*l+i*s,r*l*l+n,0,0,0,0,1),this}makeScale(e,t,n){return this.set(e,0,0,0,0,t,0,0,0,0,n,0,0,0,0,1),this}makeShear(e,t,n,i,r,s){return this.set(1,n,r,0,e,1,s,0,t,i,1,0,0,0,0,1),this}compose(e,t,n){let i=this.elements,r=t._x,s=t._y,a=t._z,l=t._w,c=r+r,u=s+s,d=a+a,h=r*c,f=r*u,p=r*d,g=s*u,v=s*d,y=a*d,m=l*c,x=l*u,_=l*d,w=n.x,b=n.y,M=n.z;return i[0]=(1-(g+y))*w,i[1]=(f+_)*w,i[2]=(p-x)*w,i[3]=0,i[4]=(f-_)*b,i[5]=(1-(h+y))*b,i[6]=(v+m)*b,i[7]=0,i[8]=(p+x)*M,i[9]=(v-m)*M,i[10]=(1-(h+g))*M,i[11]=0,i[12]=e.x,i[13]=e.y,i[14]=e.z,i[15]=1,this}decompose(e,t,n){let i=this.elements,r=Qc.set(i[0],i[1],i[2]).length(),s=Qc.set(i[4],i[5],i[6]).length(),a=Qc.set(i[8],i[9],i[10]).length();this.determinant()<0&&(r=-r),e.x=i[12],e.y=i[13],e.z=i[14],Fr.copy(this);let c=1/r,u=1/s,d=1/a;return Fr.elements[0]*=c,Fr.elements[1]*=c,Fr.elements[2]*=c,Fr.elements[4]*=u,Fr.elements[5]*=u,Fr.elements[6]*=u,Fr.elements[8]*=d,Fr.elements[9]*=d,Fr.elements[10]*=d,t.setFromRotationMatrix(Fr),n.x=r,n.y=s,n.z=a,this}makePerspective(e,t,n,i,r,s){s===void 0&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");let a=this.elements,l=2*r/(t-e),c=2*r/(n-i),u=(t+e)/(t-e),d=(n+i)/(n-i),h=-(s+r)/(s-r),f=-2*s*r/(s-r);return a[0]=l,a[4]=0,a[8]=u,a[12]=0,a[1]=0,a[5]=c,a[9]=d,a[13]=0,a[2]=0,a[6]=0,a[10]=h,a[14]=f,a[3]=0,a[7]=0,a[11]=-1,a[15]=0,this}makeOrthographic(e,t,n,i,r,s){let a=this.elements,l=1/(t-e),c=1/(n-i),u=1/(s-r),d=(t+e)*l,h=(n+i)*c,f=(s+r)*u;return a[0]=2*l,a[4]=0,a[8]=0,a[12]=-d,a[1]=0,a[5]=2*c,a[9]=0,a[13]=-h,a[2]=0,a[6]=0,a[10]=-2*u,a[14]=-f,a[3]=0,a[7]=0,a[11]=0,a[15]=1,this}equals(e){let t=this.elements,n=e.elements;for(let i=0;i<16;i++)if(t[i]!==n[i])return!1;return!0}fromArray(e,t=0){for(let n=0;n<16;n++)this.elements[n]=e[n+t];return this}toArray(e=[],t=0){let n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e[t+9]=n[9],e[t+10]=n[10],e[t+11]=n[11],e[t+12]=n[12],e[t+13]=n[13],e[t+14]=n[14],e[t+15]=n[15],e}};Pe.prototype.isMatrix4=!0;var Qc=new U,Fr=new Pe,ek=new U(0,0,0),tk=new U(1,1,1),ta=new U,ag=new U,ji=new U,gA=new Pe,yA=new gt,ri=class{constructor(e=0,t=0,n=0,i=ri.DefaultOrder){this._x=e,this._y=t,this._z=n,this._order=i}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,n,i=this._order){return this._x=e,this._y=t,this._z=n,this._order=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t=this._order,n=!0){let i=e.elements,r=i[0],s=i[4],a=i[8],l=i[1],c=i[5],u=i[9],d=i[2],h=i[6],f=i[10];switch(t){case"XYZ":this._y=Math.asin(jn(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-u,f),this._z=Math.atan2(-s,r)):(this._x=Math.atan2(h,c),this._z=0);break;case"YXZ":this._x=Math.asin(-jn(u,-1,1)),Math.abs(u)<.9999999?(this._y=Math.atan2(a,f),this._z=Math.atan2(l,c)):(this._y=Math.atan2(-d,r),this._z=0);break;case"ZXY":this._x=Math.asin(jn(h,-1,1)),Math.abs(h)<.9999999?(this._y=Math.atan2(-d,f),this._z=Math.atan2(-s,c)):(this._y=0,this._z=Math.atan2(l,r));break;case"ZYX":this._y=Math.asin(-jn(d,-1,1)),Math.abs(d)<.9999999?(this._x=Math.atan2(h,f),this._z=Math.atan2(l,r)):(this._x=0,this._z=Math.atan2(-s,c));break;case"YZX":this._z=Math.asin(jn(l,-1,1)),Math.abs(l)<.9999999?(this._x=Math.atan2(-u,c),this._y=Math.atan2(-d,r)):(this._x=0,this._y=Math.atan2(a,f));break;case"XZY":this._z=Math.asin(-jn(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(h,c),this._y=Math.atan2(a,r)):(this._x=Math.atan2(-u,f),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,n===!0&&this._onChangeCallback(),this}setFromQuaternion(e,t,n){return gA.makeRotationFromQuaternion(e),this.setFromRotationMatrix(gA,t,n)}setFromVector3(e,t=this._order){return this.set(e.x,e.y,e.z,t)}reorder(e){return yA.setFromEuler(this),this.setFromQuaternion(yA,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],e[3]!==void 0&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}toVector3(e){return e?e.set(this._x,this._y,this._z):new U(this._x,this._y,this._z)}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}};ri.prototype.isEuler=!0;ri.DefaultOrder="XYZ";ri.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"];var lg=class{constructor(){this.mask=1|0}set(e){this.mask=1<<e|0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=4294967295|0}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return(this.mask&e.mask)!=0}},nk=0,vA=new U,eu=new gt,ro=new Pe,cg=new U,sf=new U,ik=new U,rk=new gt,xA=new U(1,0,0),_A=new U(0,1,0),wA=new U(0,0,1),sk={type:"added"},bA={type:"removed"},$e=class extends Wi{constructor(){super();Object.defineProperty(this,"id",{value:nk++}),this.uuid=Xi(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=$e.DefaultUp.clone();let e=new U,t=new ri,n=new gt,i=new U(1,1,1);function r(){n.setFromEuler(t,!1)}function s(){t.setFromQuaternion(n,void 0,!1)}t._onChange(r),n._onChange(s),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:n},scale:{configurable:!0,enumerable:!0,value:i},modelViewMatrix:{value:new Pe},normalMatrix:{value:new vt}}),this.matrix=new Pe,this.matrixWorld=new Pe,this.matrixAutoUpdate=$e.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new lg,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return eu.setFromAxisAngle(e,t),this.quaternion.multiply(eu),this}rotateOnWorldAxis(e,t){return eu.setFromAxisAngle(e,t),this.quaternion.premultiply(eu),this}rotateX(e){return this.rotateOnAxis(xA,e)}rotateY(e){return this.rotateOnAxis(_A,e)}rotateZ(e){return this.rotateOnAxis(wA,e)}translateOnAxis(e,t){return vA.copy(e).applyQuaternion(this.quaternion),this.position.add(vA.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(xA,e)}translateY(e){return this.translateOnAxis(_A,e)}translateZ(e){return this.translateOnAxis(wA,e)}localToWorld(e){return e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return e.applyMatrix4(ro.copy(this.matrixWorld).invert())}lookAt(e,t,n){e.isVector3?cg.copy(e):cg.set(e,t,n);let i=this.parent;this.updateWorldMatrix(!0,!1),sf.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?ro.lookAt(sf,cg,this.up):ro.lookAt(cg,sf,this.up),this.quaternion.setFromRotationMatrix(ro),i&&(ro.extractRotation(i.matrixWorld),eu.setFromRotationMatrix(ro),this.quaternion.premultiply(eu.invert()))}add(e){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(e.parent!==null&&e.parent.remove(e),e.parent=this,this.children.push(e),e.dispatchEvent(sk)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let n=0;n<arguments.length;n++)this.remove(arguments[n]);return this}let t=this.children.indexOf(e);return t!==-1&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(bA)),this}removeFromParent(){let e=this.parent;return e!==null&&e.remove(this),this}clear(){for(let e=0;e<this.children.length;e++){let t=this.children[e];t.parent=null,t.dispatchEvent(bA)}return this.children.length=0,this}attach(e){return this.updateWorldMatrix(!0,!1),ro.copy(this.matrixWorld).invert(),e.parent!==null&&(e.parent.updateWorldMatrix(!0,!1),ro.multiply(e.parent.matrixWorld)),e.applyMatrix4(ro),this.add(e),e.updateWorldMatrix(!1,!0),this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let n=0,i=this.children.length;n<i;n++){let s=this.children[n].getObjectByProperty(e,t);if(s!==void 0)return s}}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(sf,e,ik),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(sf,rk,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);let t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(e){e(this);let t=this.children;for(let n=0,i=t.length;n<i;n++)t[n].traverse(e)}traverseVisible(e){if(this.visible===!1)return;e(this);let t=this.children;for(let n=0,i=t.length;n<i;n++)t[n].traverseVisible(e)}traverseAncestors(e){let t=this.parent;t!==null&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);let t=this.children;for(let n=0,i=t.length;n<i;n++)t[n].updateMatrixWorld(e)}updateWorldMatrix(e,t){let n=this.parent;if(e===!0&&n!==null&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),t===!0){let i=this.children;for(let r=0,s=i.length;r<s;r++)i[r].updateWorldMatrix(!1,!0)}}toJSON(e){let t=e===void 0||typeof e=="string",n={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{}},n.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});let i={};i.uuid=this.uuid,i.type=this.type,this.name!==""&&(i.name=this.name),this.castShadow===!0&&(i.castShadow=!0),this.receiveShadow===!0&&(i.receiveShadow=!0),this.visible===!1&&(i.visible=!1),this.frustumCulled===!1&&(i.frustumCulled=!1),this.renderOrder!==0&&(i.renderOrder=this.renderOrder),JSON.stringify(this.userData)!=="{}"&&(i.userData=this.userData),i.layers=this.layers.mask,i.matrix=this.matrix.toArray(),this.matrixAutoUpdate===!1&&(i.matrixAutoUpdate=!1),this.isInstancedMesh&&(i.type="InstancedMesh",i.count=this.count,i.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(i.instanceColor=this.instanceColor.toJSON()));function r(a,l){return a[l.uuid]===void 0&&(a[l.uuid]=l.toJSON(e)),l.uuid}if(this.isScene)this.background&&(this.background.isColor?i.background=this.background.toJSON():this.background.isTexture&&(i.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&(i.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){i.geometry=r(e.geometries,this.geometry);let a=this.geometry.parameters;if(a!==void 0&&a.shapes!==void 0){let l=a.shapes;if(Array.isArray(l))for(let c=0,u=l.length;c<u;c++){let d=l[c];r(e.shapes,d)}else r(e.shapes,l)}}if(this.isSkinnedMesh&&(i.bindMode=this.bindMode,i.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(r(e.skeletons,this.skeleton),i.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){let a=[];for(let l=0,c=this.material.length;l<c;l++)a.push(r(e.materials,this.material[l]));i.material=a}else i.material=r(e.materials,this.material);if(this.children.length>0){i.children=[];for(let a=0;a<this.children.length;a++)i.children.push(this.children[a].toJSON(e).object)}if(this.animations.length>0){i.animations=[];for(let a=0;a<this.animations.length;a++){let l=this.animations[a];i.animations.push(r(e.animations,l))}}if(t){let a=s(e.geometries),l=s(e.materials),c=s(e.textures),u=s(e.images),d=s(e.shapes),h=s(e.skeletons),f=s(e.animations);a.length>0&&(n.geometries=a),l.length>0&&(n.materials=l),c.length>0&&(n.textures=c),u.length>0&&(n.images=u),d.length>0&&(n.shapes=d),h.length>0&&(n.skeletons=h),f.length>0&&(n.animations=f)}return n.object=i,n;function s(a){let l=[];for(let c in a){let u=a[c];delete u.metadata,l.push(u)}return l}}clone(e){return new this.constructor().copy(this,e)}copy(e,t=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.userData=JSON.parse(JSON.stringify(e.userData)),t===!0)for(let n=0;n<e.children.length;n++){let i=e.children[n];this.add(i.clone())}return this}};$e.DefaultUp=new U(0,1,0);$e.DefaultMatrixAutoUpdate=!0;$e.prototype.isObject3D=!0;var Br=new U,so=new U,b_=new U,oo=new U,tu=new U,nu=new U,MA=new U,M_=new U,S_=new U,T_=new U,Zt=class{constructor(e=new U,t=new U,n=new U){this.a=e,this.b=t,this.c=n}static getNormal(e,t,n,i){i.subVectors(n,t),Br.subVectors(e,t),i.cross(Br);let r=i.lengthSq();return r>0?i.multiplyScalar(1/Math.sqrt(r)):i.set(0,0,0)}static getBarycoord(e,t,n,i,r){Br.subVectors(i,t),so.subVectors(n,t),b_.subVectors(e,t);let s=Br.dot(Br),a=Br.dot(so),l=Br.dot(b_),c=so.dot(so),u=so.dot(b_),d=s*c-a*a;if(d===0)return r.set(-2,-1,-1);let h=1/d,f=(c*l-a*u)*h,p=(s*u-a*l)*h;return r.set(1-f-p,p,f)}static containsPoint(e,t,n,i){return this.getBarycoord(e,t,n,i,oo),oo.x>=0&&oo.y>=0&&oo.x+oo.y<=1}static getUV(e,t,n,i,r,s,a,l){return this.getBarycoord(e,t,n,i,oo),l.set(0,0),l.addScaledVector(r,oo.x),l.addScaledVector(s,oo.y),l.addScaledVector(a,oo.z),l}static isFrontFacing(e,t,n,i){return Br.subVectors(n,t),so.subVectors(e,t),Br.cross(so).dot(i)<0}set(e,t,n){return this.a.copy(e),this.b.copy(t),this.c.copy(n),this}setFromPointsAndIndices(e,t,n,i){return this.a.copy(e[t]),this.b.copy(e[n]),this.c.copy(e[i]),this}clone(){return new this.constructor().copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return Br.subVectors(this.c,this.b),so.subVectors(this.a,this.b),Br.cross(so).length()*.5}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return Zt.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return Zt.getBarycoord(e,this.a,this.b,this.c,t)}getUV(e,t,n,i,r){return Zt.getUV(e,this.a,this.b,this.c,t,n,i,r)}containsPoint(e){return Zt.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return Zt.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){let n=this.a,i=this.b,r=this.c,s,a;tu.subVectors(i,n),nu.subVectors(r,n),M_.subVectors(e,n);let l=tu.dot(M_),c=nu.dot(M_);if(l<=0&&c<=0)return t.copy(n);S_.subVectors(e,i);let u=tu.dot(S_),d=nu.dot(S_);if(u>=0&&d<=u)return t.copy(i);let h=l*d-u*c;if(h<=0&&l>=0&&u<=0)return s=l/(l-u),t.copy(n).addScaledVector(tu,s);T_.subVectors(e,r);let f=tu.dot(T_),p=nu.dot(T_);if(p>=0&&f<=p)return t.copy(r);let g=f*c-l*p;if(g<=0&&c>=0&&p<=0)return a=c/(c-p),t.copy(n).addScaledVector(nu,a);let v=u*p-f*d;if(v<=0&&d-u>=0&&f-p>=0)return MA.subVectors(r,i),a=(d-u)/(d-u+(f-p)),t.copy(i).addScaledVector(MA,a);let y=1/(v+g+h);return s=g*y,a=h*y,t.copy(n).addScaledVector(tu,s).addScaledVector(nu,a)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}},ok=0,un=class extends Wi{constructor(){super();Object.defineProperty(this,"id",{value:ok++}),this.uuid=Xi(),this.name="",this.type="Material",this.fog=!0,this.blending=Hc,this.side=Js,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.blendSrc=qx,this.blendDst=jx,this.blendEquation=_l,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=qm,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=hA,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=eg,this.stencilZFail=eg,this.stencilZPass=eg,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaTest=0,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0}onBuild(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(e!==void 0)for(let t in e){let n=e[t];if(n===void 0){console.warn("THREE.Material: '"+t+"' parameter is undefined.");continue}if(t==="shading"){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=n===Ux;continue}let i=this[t];if(i===void 0){console.warn("THREE."+this.type+": '"+t+"' is not a property of this material.");continue}i&&i.isColor?i.set(n):i&&i.isVector3&&n&&n.isVector3?i.copy(n):this[t]=n}}toJSON(e){let t=e===void 0||typeof e=="string";t&&(e={textures:{},images:{}});let n={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};n.uuid=this.uuid,n.type=this.type,this.name!==""&&(n.name=this.name),this.color&&this.color.isColor&&(n.color=this.color.getHex()),this.roughness!==void 0&&(n.roughness=this.roughness),this.metalness!==void 0&&(n.metalness=this.metalness),this.sheen&&this.sheen.isColor&&(n.sheen=this.sheen.getHex()),this.emissive&&this.emissive.isColor&&(n.emissive=this.emissive.getHex()),this.emissiveIntensity&&this.emissiveIntensity!==1&&(n.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(n.specular=this.specular.getHex()),this.shininess!==void 0&&(n.shininess=this.shininess),this.clearcoat!==void 0&&(n.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(n.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(n.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(n.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(n.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,n.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.map&&this.map.isTexture&&(n.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(n.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(n.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(n.lightMap=this.lightMap.toJSON(e).uuid,n.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(n.aoMap=this.aoMap.toJSON(e).uuid,n.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(n.bumpMap=this.bumpMap.toJSON(e).uuid,n.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(n.normalMap=this.normalMap.toJSON(e).uuid,n.normalMapType=this.normalMapType,n.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(n.displacementMap=this.displacementMap.toJSON(e).uuid,n.displacementScale=this.displacementScale,n.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(n.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(n.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(n.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(n.specularMap=this.specularMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(n.envMap=this.envMap.toJSON(e).uuid,this.combine!==void 0&&(n.combine=this.combine)),this.envMapIntensity!==void 0&&(n.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(n.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(n.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(n.gradientMap=this.gradientMap.toJSON(e).uuid),this.transmission!==void 0&&(n.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(n.transmissionMap=this.transmissionMap.toJSON(e).uuid),this.thickness!==void 0&&(n.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(n.thicknessMap=this.thicknessMap.toJSON(e).uuid),this.attenuationDistance!==void 0&&(n.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(n.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(n.size=this.size),this.shadowSide!==null&&(n.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(n.sizeAttenuation=this.sizeAttenuation),this.blending!==Hc&&(n.blending=this.blending),this.side!==Js&&(n.side=this.side),this.vertexColors&&(n.vertexColors=!0),this.opacity<1&&(n.opacity=this.opacity),this.transparent===!0&&(n.transparent=this.transparent),n.depthFunc=this.depthFunc,n.depthTest=this.depthTest,n.depthWrite=this.depthWrite,n.colorWrite=this.colorWrite,n.stencilWrite=this.stencilWrite,n.stencilWriteMask=this.stencilWriteMask,n.stencilFunc=this.stencilFunc,n.stencilRef=this.stencilRef,n.stencilFuncMask=this.stencilFuncMask,n.stencilFail=this.stencilFail,n.stencilZFail=this.stencilZFail,n.stencilZPass=this.stencilZPass,this.rotation&&this.rotation!==0&&(n.rotation=this.rotation),this.polygonOffset===!0&&(n.polygonOffset=!0),this.polygonOffsetFactor!==0&&(n.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(n.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth&&this.linewidth!==1&&(n.linewidth=this.linewidth),this.dashSize!==void 0&&(n.dashSize=this.dashSize),this.gapSize!==void 0&&(n.gapSize=this.gapSize),this.scale!==void 0&&(n.scale=this.scale),this.dithering===!0&&(n.dithering=!0),this.alphaTest>0&&(n.alphaTest=this.alphaTest),this.alphaToCoverage===!0&&(n.alphaToCoverage=this.alphaToCoverage),this.premultipliedAlpha===!0&&(n.premultipliedAlpha=this.premultipliedAlpha),this.wireframe===!0&&(n.wireframe=this.wireframe),this.wireframeLinewidth>1&&(n.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(n.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(n.wireframeLinejoin=this.wireframeLinejoin),this.morphTargets===!0&&(n.morphTargets=!0),this.morphNormals===!0&&(n.morphNormals=!0),this.flatShading===!0&&(n.flatShading=this.flatShading),this.visible===!1&&(n.visible=!1),this.toneMapped===!1&&(n.toneMapped=!1),JSON.stringify(this.userData)!=="{}"&&(n.userData=this.userData);function i(r){let s=[];for(let a in r){let l=r[a];delete l.metadata,s.push(l)}return s}if(t){let r=i(e.textures),s=i(e.images);r.length>0&&(n.textures=r),s.length>0&&(n.images=s)}return n}clone(){return new this.constructor().copy(this)}copy(e){this.name=e.name,this.fog=e.fog,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;let t=e.clippingPlanes,n=null;if(t!==null){let i=t.length;n=new Array(i);for(let r=0;r!==i;++r)n[r]=t[r].clone()}return this.clippingPlanes=n,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){e===!0&&this.version++}};un.prototype.isMaterial=!0;var SA={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Nr={h:0,s:0,l:0},ug={h:0,s:0,l:0};function E_(o,e,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?o+(e-o)*6*t:t<1/2?e:t<2/3?o+(e-o)*6*(2/3-t):o}function A_(o){return o<.04045?o*.0773993808:Math.pow(o*.9478672986+.0521327014,2.4)}function C_(o){return o<.0031308?o*12.92:1.055*Math.pow(o,.41666)-.055}var De=class{constructor(e,t,n){return t===void 0&&n===void 0?this.set(e):this.setRGB(e,t,n)}set(e){return e&&e.isColor?this.copy(e):typeof e=="number"?this.setHex(e):typeof e=="string"&&this.setStyle(e),this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(e&255)/255,this}setRGB(e,t,n){return this.r=e,this.g=t,this.b=n,this}setHSL(e,t,n){if(e=u_(e,1),t=jn(t,0,1),n=jn(n,0,1),t===0)this.r=this.g=this.b=n;else{let i=n<=.5?n*(1+t):n+t-n*t,r=2*n-i;this.r=E_(r,i,e+1/3),this.g=E_(r,i,e),this.b=E_(r,i,e-1/3)}return this}setStyle(e){function t(i){i!==void 0&&parseFloat(i)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let n;if(n=/^((?:rgb|hsl)a?)\(([^\)]*)\)/.exec(e)){let i,r=n[1],s=n[2];switch(r){case"rgb":case"rgba":if(i=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(s))return this.r=Math.min(255,parseInt(i[1],10))/255,this.g=Math.min(255,parseInt(i[2],10))/255,this.b=Math.min(255,parseInt(i[3],10))/255,t(i[4]),this;if(i=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(s))return this.r=Math.min(100,parseInt(i[1],10))/100,this.g=Math.min(100,parseInt(i[2],10))/100,this.b=Math.min(100,parseInt(i[3],10))/100,t(i[4]),this;break;case"hsl":case"hsla":if(i=/^\s*(\d*\.?\d+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(s)){let a=parseFloat(i[1])/360,l=parseInt(i[2],10)/100,c=parseInt(i[3],10)/100;return t(i[4]),this.setHSL(a,l,c)}break}}else if(n=/^\#([A-Fa-f\d]+)$/.exec(e)){let i=n[1],r=i.length;if(r===3)return this.r=parseInt(i.charAt(0)+i.charAt(0),16)/255,this.g=parseInt(i.charAt(1)+i.charAt(1),16)/255,this.b=parseInt(i.charAt(2)+i.charAt(2),16)/255,this;if(r===6)return this.r=parseInt(i.charAt(0)+i.charAt(1),16)/255,this.g=parseInt(i.charAt(2)+i.charAt(3),16)/255,this.b=parseInt(i.charAt(4)+i.charAt(5),16)/255,this}return e&&e.length>0?this.setColorName(e):this}setColorName(e){let t=SA[e.toLowerCase()];return t!==void 0?this.setHex(t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copyGammaToLinear(e,t=2){return this.r=Math.pow(e.r,t),this.g=Math.pow(e.g,t),this.b=Math.pow(e.b,t),this}copyLinearToGamma(e,t=2){let n=t>0?1/t:1;return this.r=Math.pow(e.r,n),this.g=Math.pow(e.g,n),this.b=Math.pow(e.b,n),this}convertGammaToLinear(e){return this.copyGammaToLinear(this,e),this}convertLinearToGamma(e){return this.copyLinearToGamma(this,e),this}copySRGBToLinear(e){return this.r=A_(e.r),this.g=A_(e.g),this.b=A_(e.b),this}copyLinearToSRGB(e){return this.r=C_(e.r),this.g=C_(e.g),this.b=C_(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(){return this.r*255<<16^this.g*255<<8^this.b*255<<0}getHexString(){return("000000"+this.getHex().toString(16)).slice(-6)}getHSL(e){let t=this.r,n=this.g,i=this.b,r=Math.max(t,n,i),s=Math.min(t,n,i),a,l,c=(s+r)/2;if(s===r)a=0,l=0;else{let u=r-s;switch(l=c<=.5?u/(r+s):u/(2-r-s),r){case t:a=(n-i)/u+(n<i?6:0);break;case n:a=(i-t)/u+2;break;case i:a=(t-n)/u+4;break}a/=6}return e.h=a,e.s=l,e.l=c,e}getStyle(){return"rgb("+(this.r*255|0)+","+(this.g*255|0)+","+(this.b*255|0)+")"}offsetHSL(e,t,n){return this.getHSL(Nr),Nr.h+=e,Nr.s+=t,Nr.l+=n,this.setHSL(Nr.h,Nr.s,Nr.l),this}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,n){return this.r=e.r+(t.r-e.r)*n,this.g=e.g+(t.g-e.g)*n,this.b=e.b+(t.b-e.b)*n,this}lerpHSL(e,t){this.getHSL(Nr),e.getHSL(ug);let n=tf(Nr.h,ug.h,t),i=tf(Nr.s,ug.s,t),r=tf(Nr.l,ug.l,t);return this.setHSL(n,i,r),this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),e.normalized===!0&&(this.r/=255,this.g/=255,this.b/=255),this}toJSON(){return this.getHex()}};De.NAMES=SA;De.prototype.isColor=!0;De.prototype.r=1;De.prototype.g=1;De.prototype.b=1;var Jt=class extends un{constructor(e){super();this.type="MeshBasicMaterial",this.color=new De(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=qd,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.morphTargets=!1,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.morphTargets=e.morphTargets,this}};Jt.prototype.isMeshBasicMaterial=!0;var Wt=new U,hg=new _e,Ye=class{constructor(e,t,n){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.name="",this.array=e,this.itemSize=t,this.count=e!==void 0?e.length/t:0,this.normalized=n===!0,this.usage=eo,this.updateRange={offset:0,count:-1},this.version=0}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this}copyAt(e,t,n){e*=this.itemSize,n*=t.itemSize;for(let i=0,r=this.itemSize;i<r;i++)this.array[e+i]=t.array[n+i];return this}copyArray(e){return this.array.set(e),this}copyColorsArray(e){let t=this.array,n=0;for(let i=0,r=e.length;i<r;i++){let s=e[i];s===void 0&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",i),s=new De),t[n++]=s.r,t[n++]=s.g,t[n++]=s.b}return this}copyVector2sArray(e){let t=this.array,n=0;for(let i=0,r=e.length;i<r;i++){let s=e[i];s===void 0&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",i),s=new _e),t[n++]=s.x,t[n++]=s.y}return this}copyVector3sArray(e){let t=this.array,n=0;for(let i=0,r=e.length;i<r;i++){let s=e[i];s===void 0&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",i),s=new U),t[n++]=s.x,t[n++]=s.y,t[n++]=s.z}return this}copyVector4sArray(e){let t=this.array,n=0;for(let i=0,r=e.length;i<r;i++){let s=e[i];s===void 0&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",i),s=new tt),t[n++]=s.x,t[n++]=s.y,t[n++]=s.z,t[n++]=s.w}return this}applyMatrix3(e){if(this.itemSize===2)for(let t=0,n=this.count;t<n;t++)hg.fromBufferAttribute(this,t),hg.applyMatrix3(e),this.setXY(t,hg.x,hg.y);else if(this.itemSize===3)for(let t=0,n=this.count;t<n;t++)Wt.fromBufferAttribute(this,t),Wt.applyMatrix3(e),this.setXYZ(t,Wt.x,Wt.y,Wt.z);return this}applyMatrix4(e){for(let t=0,n=this.count;t<n;t++)Wt.x=this.getX(t),Wt.y=this.getY(t),Wt.z=this.getZ(t),Wt.applyMatrix4(e),this.setXYZ(t,Wt.x,Wt.y,Wt.z);return this}applyNormalMatrix(e){for(let t=0,n=this.count;t<n;t++)Wt.x=this.getX(t),Wt.y=this.getY(t),Wt.z=this.getZ(t),Wt.applyNormalMatrix(e),this.setXYZ(t,Wt.x,Wt.y,Wt.z);return this}transformDirection(e){for(let t=0,n=this.count;t<n;t++)Wt.x=this.getX(t),Wt.y=this.getY(t),Wt.z=this.getZ(t),Wt.transformDirection(e),this.setXYZ(t,Wt.x,Wt.y,Wt.z);return this}set(e,t=0){return this.array.set(e,t),this}getX(e){return this.array[e*this.itemSize]}setX(e,t){return this.array[e*this.itemSize]=t,this}getY(e){return this.array[e*this.itemSize+1]}setY(e,t){return this.array[e*this.itemSize+1]=t,this}getZ(e){return this.array[e*this.itemSize+2]}setZ(e,t){return this.array[e*this.itemSize+2]=t,this}getW(e){return this.array[e*this.itemSize+3]}setW(e,t){return this.array[e*this.itemSize+3]=t,this}setXY(e,t,n){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=n,this}setXYZ(e,t,n,i){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=i,this}setXYZW(e,t,n,i,r){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=i,this.array[e+3]=r,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){let e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.prototype.slice.call(this.array),normalized:this.normalized};return this.name!==""&&(e.name=this.name),this.usage!==eo&&(e.usage=this.usage),(this.updateRange.offset!==0||this.updateRange.count!==-1)&&(e.updateRange=this.updateRange),e}};Ye.prototype.isBufferAttribute=!0;var L_=class extends Ye{constructor(e,t,n){super(new Int8Array(e),t,n)}},R_=class extends Ye{constructor(e,t,n){super(new Uint8Array(e),t,n)}},P_=class extends Ye{constructor(e,t,n){super(new Uint8ClampedArray(e),t,n)}},I_=class extends Ye{constructor(e,t,n){super(new Int16Array(e),t,n)}},Pl=class extends Ye{constructor(e,t,n){super(new Uint16Array(e),t,n)}},D_=class extends Ye{constructor(e,t,n){super(new Int32Array(e),t,n)}},of=class extends Ye{constructor(e,t,n){super(new Uint32Array(e),t,n)}},F_=class extends Ye{constructor(e,t,n){super(new Uint16Array(e),t,n)}};F_.prototype.isFloat16BufferAttribute=!0;var Ne=class extends Ye{constructor(e,t,n){super(new Float32Array(e),t,n)}},B_=class extends Ye{constructor(e,t,n){super(new Float64Array(e),t,n)}};function TA(o){if(o.length===0)return-1/0;let e=o[0];for(let t=1,n=o.length;t<n;++t)o[t]>e&&(e=o[t]);return e}var ak={Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array};function iu(o,e){return new ak[o](e)}var lk=0,ur=new Pe,N_=new $e,ru=new U,Yi=new Sn,af=new Sn,Dn=new U,Ue=class extends Wi{constructor(){super();Object.defineProperty(this,"id",{value:lk++}),this.uuid=Xi(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(TA(e)>65535?of:Pl)(e,1):this.index=e,this}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return this.attributes[e]!==void 0}addGroup(e,t,n=0){this.groups.push({start:e,count:t,materialIndex:n})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){let t=this.attributes.position;t!==void 0&&(t.applyMatrix4(e),t.needsUpdate=!0);let n=this.attributes.normal;if(n!==void 0){let r=new vt().getNormalMatrix(e);n.applyNormalMatrix(r),n.needsUpdate=!0}let i=this.attributes.tangent;return i!==void 0&&(i.transformDirection(e),i.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(e){return ur.makeRotationFromQuaternion(e),this.applyMatrix4(ur),this}rotateX(e){return ur.makeRotationX(e),this.applyMatrix4(ur),this}rotateY(e){return ur.makeRotationY(e),this.applyMatrix4(ur),this}rotateZ(e){return ur.makeRotationZ(e),this.applyMatrix4(ur),this}translate(e,t,n){return ur.makeTranslation(e,t,n),this.applyMatrix4(ur),this}scale(e,t,n){return ur.makeScale(e,t,n),this.applyMatrix4(ur),this}lookAt(e){return N_.lookAt(e),N_.updateMatrix(),this.applyMatrix4(N_.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(ru).negate(),this.translate(ru.x,ru.y,ru.z),this}setFromPoints(e){let t=[];for(let n=0,i=e.length;n<i;n++){let r=e[n];t.push(r.x,r.y,r.z||0)}return this.setAttribute("position",new Ne(t,3)),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Sn);let e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingBox.set(new U(-1/0,-1/0,-1/0),new U(1/0,1/0,1/0));return}if(e!==void 0){if(this.boundingBox.setFromBufferAttribute(e),t)for(let n=0,i=t.length;n<i;n++){let r=t[n];Yi.setFromBufferAttribute(r),this.morphTargetsRelative?(Dn.addVectors(this.boundingBox.min,Yi.min),this.boundingBox.expandByPoint(Dn),Dn.addVectors(this.boundingBox.max,Yi.max),this.boundingBox.expandByPoint(Dn)):(this.boundingBox.expandByPoint(Yi.min),this.boundingBox.expandByPoint(Yi.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new qi);let e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingSphere.set(new U,1/0);return}if(e){let n=this.boundingSphere.center;if(Yi.setFromBufferAttribute(e),t)for(let r=0,s=t.length;r<s;r++){let a=t[r];af.setFromBufferAttribute(a),this.morphTargetsRelative?(Dn.addVectors(Yi.min,af.min),Yi.expandByPoint(Dn),Dn.addVectors(Yi.max,af.max),Yi.expandByPoint(Dn)):(Yi.expandByPoint(af.min),Yi.expandByPoint(af.max))}Yi.getCenter(n);let i=0;for(let r=0,s=e.count;r<s;r++)Dn.fromBufferAttribute(e,r),i=Math.max(i,n.distanceToSquared(Dn));if(t)for(let r=0,s=t.length;r<s;r++){let a=t[r],l=this.morphTargetsRelative;for(let c=0,u=a.count;c<u;c++)Dn.fromBufferAttribute(a,c),l&&(ru.fromBufferAttribute(e,c),Dn.add(ru)),i=Math.max(i,n.distanceToSquared(Dn))}this.boundingSphere.radius=Math.sqrt(i),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeFaceNormals(){}computeTangents(){let e=this.index,t=this.attributes;if(e===null||t.position===void 0||t.normal===void 0||t.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}let n=e.array,i=t.position.array,r=t.normal.array,s=t.uv.array,a=i.length/3;t.tangent===void 0&&this.setAttribute("tangent",new Ye(new Float32Array(4*a),4));let l=t.tangent.array,c=[],u=[];for(let A=0;A<a;A++)c[A]=new U,u[A]=new U;let d=new U,h=new U,f=new U,p=new _e,g=new _e,v=new _e,y=new U,m=new U;function x(A,L,B){d.fromArray(i,A*3),h.fromArray(i,L*3),f.fromArray(i,B*3),p.fromArray(s,A*2),g.fromArray(s,L*2),v.fromArray(s,B*2),h.sub(d),f.sub(d),g.sub(p),v.sub(p);let R=1/(g.x*v.y-v.x*g.y);!isFinite(R)||(y.copy(h).multiplyScalar(v.y).addScaledVector(f,-g.y).multiplyScalar(R),m.copy(f).multiplyScalar(g.x).addScaledVector(h,-v.x).multiplyScalar(R),c[A].add(y),c[L].add(y),c[B].add(y),u[A].add(m),u[L].add(m),u[B].add(m))}let _=this.groups;_.length===0&&(_=[{start:0,count:n.length}]);for(let A=0,L=_.length;A<L;++A){let B=_[A],R=B.start,D=B.count;for(let P=R,I=R+D;P<I;P+=3)x(n[P+0],n[P+1],n[P+2])}let w=new U,b=new U,M=new U,S=new U;function E(A){M.fromArray(r,A*3),S.copy(M);let L=c[A];w.copy(L),w.sub(M.multiplyScalar(M.dot(L))).normalize(),b.crossVectors(S,L);let R=b.dot(u[A])<0?-1:1;l[A*4]=w.x,l[A*4+1]=w.y,l[A*4+2]=w.z,l[A*4+3]=R}for(let A=0,L=_.length;A<L;++A){let B=_[A],R=B.start,D=B.count;for(let P=R,I=R+D;P<I;P+=3)E(n[P+0]),E(n[P+1]),E(n[P+2])}}computeVertexNormals(){let e=this.index,t=this.getAttribute("position");if(t!==void 0){let n=this.getAttribute("normal");if(n===void 0)n=new Ye(new Float32Array(t.count*3),3),this.setAttribute("normal",n);else for(let h=0,f=n.count;h<f;h++)n.setXYZ(h,0,0,0);let i=new U,r=new U,s=new U,a=new U,l=new U,c=new U,u=new U,d=new U;if(e)for(let h=0,f=e.count;h<f;h+=3){let p=e.getX(h+0),g=e.getX(h+1),v=e.getX(h+2);i.fromBufferAttribute(t,p),r.fromBufferAttribute(t,g),s.fromBufferAttribute(t,v),u.subVectors(s,r),d.subVectors(i,r),u.cross(d),a.fromBufferAttribute(n,p),l.fromBufferAttribute(n,g),c.fromBufferAttribute(n,v),a.add(u),l.add(u),c.add(u),n.setXYZ(p,a.x,a.y,a.z),n.setXYZ(g,l.x,l.y,l.z),n.setXYZ(v,c.x,c.y,c.z)}else for(let h=0,f=t.count;h<f;h+=3)i.fromBufferAttribute(t,h+0),r.fromBufferAttribute(t,h+1),s.fromBufferAttribute(t,h+2),u.subVectors(s,r),d.subVectors(i,r),u.cross(d),n.setXYZ(h+0,u.x,u.y,u.z),n.setXYZ(h+1,u.x,u.y,u.z),n.setXYZ(h+2,u.x,u.y,u.z);this.normalizeNormals(),n.needsUpdate=!0}}merge(e,t){if(!(e&&e.isBufferGeometry)){console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",e);return}t===void 0&&(t=0,console.warn("THREE.BufferGeometry.merge(): Overwriting original geometry, starting at offset=0. Use BufferGeometryUtils.mergeBufferGeometries() for lossless merge."));let n=this.attributes;for(let i in n){if(e.attributes[i]===void 0)continue;let s=n[i].array,a=e.attributes[i],l=a.array,c=a.itemSize*t,u=Math.min(l.length,s.length-c);for(let d=0,h=c;d<u;d++,h++)s[h]=l[d]}return this}normalizeNormals(){let e=this.attributes.normal;for(let t=0,n=e.count;t<n;t++)Dn.fromBufferAttribute(e,t),Dn.normalize(),e.setXYZ(t,Dn.x,Dn.y,Dn.z)}toNonIndexed(){function e(a,l){let c=a.array,u=a.itemSize,d=a.normalized,h=new c.constructor(l.length*u),f=0,p=0;for(let g=0,v=l.length;g<v;g++){a.isInterleavedBufferAttribute?f=l[g]*a.data.stride+a.offset:f=l[g]*u;for(let y=0;y<u;y++)h[p++]=c[f++]}return new Ye(h,u,d)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;let t=new Ue,n=this.index.array,i=this.attributes;for(let a in i){let l=i[a],c=e(l,n);t.setAttribute(a,c)}let r=this.morphAttributes;for(let a in r){let l=[],c=r[a];for(let u=0,d=c.length;u<d;u++){let h=c[u],f=e(h,n);l.push(f)}t.morphAttributes[a]=l}t.morphTargetsRelative=this.morphTargetsRelative;let s=this.groups;for(let a=0,l=s.length;a<l;a++){let c=s[a];t.addGroup(c.start,c.count,c.materialIndex)}return t}toJSON(){let e={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,this.name!==""&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),this.parameters!==void 0){let l=this.parameters;for(let c in l)l[c]!==void 0&&(e[c]=l[c]);return e}e.data={attributes:{}};let t=this.index;t!==null&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});let n=this.attributes;for(let l in n){let c=n[l];e.data.attributes[l]=c.toJSON(e.data)}let i={},r=!1;for(let l in this.morphAttributes){let c=this.morphAttributes[l],u=[];for(let d=0,h=c.length;d<h;d++){let f=c[d];u.push(f.toJSON(e.data))}u.length>0&&(i[l]=u,r=!0)}r&&(e.data.morphAttributes=i,e.data.morphTargetsRelative=this.morphTargetsRelative);let s=this.groups;s.length>0&&(e.data.groups=JSON.parse(JSON.stringify(s)));let a=this.boundingSphere;return a!==null&&(e.data.boundingSphere={center:a.center.toArray(),radius:a.radius}),e}clone(){return new Ue().copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;let t={};this.name=e.name;let n=e.index;n!==null&&this.setIndex(n.clone(t));let i=e.attributes;for(let c in i){let u=i[c];this.setAttribute(c,u.clone(t))}let r=e.morphAttributes;for(let c in r){let u=[],d=r[c];for(let h=0,f=d.length;h<f;h++)u.push(d[h].clone(t));this.morphAttributes[c]=u}this.morphTargetsRelative=e.morphTargetsRelative;let s=e.groups;for(let c=0,u=s.length;c<u;c++){let d=s[c];this.addGroup(d.start,d.count,d.materialIndex)}let a=e.boundingBox;a!==null&&(this.boundingBox=a.clone());let l=e.boundingSphere;return l!==null&&(this.boundingSphere=l.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}};Ue.prototype.isBufferGeometry=!0;var EA=new Pe,su=new io,O_=new qi,na=new U,ia=new U,ra=new U,k_=new U,z_=new U,U_=new U,dg=new U,fg=new U,pg=new U,mg=new _e,gg=new _e,yg=new _e,H_=new U,vg=new U,et=class extends $e{constructor(e=new Ue,t=new Jt){super();this.type="Mesh",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e){return super.copy(e),e.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),e.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=e.material,this.geometry=e.geometry,this}updateMorphTargets(){let e=this.geometry;if(e.isBufferGeometry){let t=e.morphAttributes,n=Object.keys(t);if(n.length>0){let i=t[n[0]];if(i!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let r=0,s=i.length;r<s;r++){let a=i[r].name||String(r);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=r}}}}else{let t=e.morphTargets;t!==void 0&&t.length>0&&console.error("THREE.Mesh.updateMorphTargets() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}}raycast(e,t){let n=this.geometry,i=this.material,r=this.matrixWorld;if(i===void 0||(n.boundingSphere===null&&n.computeBoundingSphere(),O_.copy(n.boundingSphere),O_.applyMatrix4(r),e.ray.intersectsSphere(O_)===!1)||(EA.copy(r).invert(),su.copy(e.ray).applyMatrix4(EA),n.boundingBox!==null&&su.intersectsBox(n.boundingBox)===!1))return;let s;if(n.isBufferGeometry){let a=n.index,l=n.attributes.position,c=n.morphAttributes.position,u=n.morphTargetsRelative,d=n.attributes.uv,h=n.attributes.uv2,f=n.groups,p=n.drawRange;if(a!==null)if(Array.isArray(i))for(let g=0,v=f.length;g<v;g++){let y=f[g],m=i[y.materialIndex],x=Math.max(y.start,p.start),_=Math.min(y.start+y.count,p.start+p.count);for(let w=x,b=_;w<b;w+=3){let M=a.getX(w),S=a.getX(w+1),E=a.getX(w+2);s=xg(this,m,e,su,l,c,u,d,h,M,S,E),s&&(s.faceIndex=Math.floor(w/3),s.face.materialIndex=y.materialIndex,t.push(s))}}else{let g=Math.max(0,p.start),v=Math.min(a.count,p.start+p.count);for(let y=g,m=v;y<m;y+=3){let x=a.getX(y),_=a.getX(y+1),w=a.getX(y+2);s=xg(this,i,e,su,l,c,u,d,h,x,_,w),s&&(s.faceIndex=Math.floor(y/3),t.push(s))}}else if(l!==void 0)if(Array.isArray(i))for(let g=0,v=f.length;g<v;g++){let y=f[g],m=i[y.materialIndex],x=Math.max(y.start,p.start),_=Math.min(y.start+y.count,p.start+p.count);for(let w=x,b=_;w<b;w+=3){let M=w,S=w+1,E=w+2;s=xg(this,m,e,su,l,c,u,d,h,M,S,E),s&&(s.faceIndex=Math.floor(w/3),s.face.materialIndex=y.materialIndex,t.push(s))}}else{let g=Math.max(0,p.start),v=Math.min(l.count,p.start+p.count);for(let y=g,m=v;y<m;y+=3){let x=y,_=y+1,w=y+2;s=xg(this,i,e,su,l,c,u,d,h,x,_,w),s&&(s.faceIndex=Math.floor(y/3),t.push(s))}}}else n.isGeometry&&console.error("THREE.Mesh.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}};et.prototype.isMesh=!0;function ck(o,e,t,n,i,r,s,a){let l;if(e.side===Qt?l=n.intersectTriangle(s,r,i,!0,a):l=n.intersectTriangle(i,r,s,e.side!==Dr,a),l===null)return null;vg.copy(a),vg.applyMatrix4(o.matrixWorld);let c=t.ray.origin.distanceTo(vg);return c<t.near||c>t.far?null:{distance:c,point:vg.clone(),object:o}}function xg(o,e,t,n,i,r,s,a,l,c,u,d){na.fromBufferAttribute(i,c),ia.fromBufferAttribute(i,u),ra.fromBufferAttribute(i,d);let h=o.morphTargetInfluences;if(e.morphTargets&&r&&h){dg.set(0,0,0),fg.set(0,0,0),pg.set(0,0,0);for(let p=0,g=r.length;p<g;p++){let v=h[p],y=r[p];v!==0&&(k_.fromBufferAttribute(y,c),z_.fromBufferAttribute(y,u),U_.fromBufferAttribute(y,d),s?(dg.addScaledVector(k_,v),fg.addScaledVector(z_,v),pg.addScaledVector(U_,v)):(dg.addScaledVector(k_.sub(na),v),fg.addScaledVector(z_.sub(ia),v),pg.addScaledVector(U_.sub(ra),v)))}na.add(dg),ia.add(fg),ra.add(pg)}o.isSkinnedMesh&&(o.boneTransform(c,na),o.boneTransform(u,ia),o.boneTransform(d,ra));let f=ck(o,e,t,n,na,ia,ra,H_);if(f){a&&(mg.fromBufferAttribute(a,c),gg.fromBufferAttribute(a,u),yg.fromBufferAttribute(a,d),f.uv=Zt.getUV(H_,na,ia,ra,mg,gg,yg,new _e)),l&&(mg.fromBufferAttribute(l,c),gg.fromBufferAttribute(l,u),yg.fromBufferAttribute(l,d),f.uv2=Zt.getUV(H_,na,ia,ra,mg,gg,yg,new _e));let p={a:c,b:u,c:d,normal:new U,materialIndex:0};Zt.getNormal(na,ia,ra,p.normal),f.face=p}return f}var ao=class extends Ue{constructor(e=1,t=1,n=1,i=1,r=1,s=1){super();this.type="BoxGeometry",this.parameters={width:e,height:t,depth:n,widthSegments:i,heightSegments:r,depthSegments:s};let a=this;i=Math.floor(i),r=Math.floor(r),s=Math.floor(s);let l=[],c=[],u=[],d=[],h=0,f=0;p("z","y","x",-1,-1,n,t,e,s,r,0),p("z","y","x",1,-1,n,t,-e,s,r,1),p("x","z","y",1,1,e,n,t,i,s,2),p("x","z","y",1,-1,e,n,-t,i,s,3),p("x","y","z",1,-1,e,t,n,i,r,4),p("x","y","z",-1,-1,e,t,-n,i,r,5),this.setIndex(l),this.setAttribute("position",new Ne(c,3)),this.setAttribute("normal",new Ne(u,3)),this.setAttribute("uv",new Ne(d,2));function p(g,v,y,m,x,_,w,b,M,S,E){let A=_/M,L=w/S,B=_/2,R=w/2,D=b/2,P=M+1,I=S+1,N=0,G=0,z=new U;for(let se=0;se<I;se++){let ne=se*L-R;for(let Q=0;Q<P;Q++){let j=Q*A-B;z[g]=j*m,z[v]=ne*x,z[y]=D,c.push(z.x,z.y,z.z),z[g]=0,z[v]=0,z[y]=b>0?1:-1,u.push(z.x,z.y,z.z),d.push(Q/M),d.push(1-se/S),N+=1}}for(let se=0;se<S;se++)for(let ne=0;ne<M;ne++){let Q=h+ne+P*se,j=h+ne+P*(se+1),O=h+(ne+1)+P*(se+1),ee=h+(ne+1)+P*se;l.push(Q,j,ee),l.push(j,O,ee),G+=6}a.addGroup(f,G,E),f+=G,h+=N}}static fromJSON(e){return new ao(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}};function ou(o){let e={};for(let t in o){e[t]={};for(let n in o[t]){let i=o[t][n];i&&(i.isColor||i.isMatrix3||i.isMatrix4||i.isVector2||i.isVector3||i.isVector4||i.isTexture||i.isQuaternion)?e[t][n]=i.clone():Array.isArray(i)?e[t][n]=i.slice():e[t][n]=i}}return e}function si(o){let e={};for(let t=0;t<o.length;t++){let n=ou(o[t]);for(let i in n)e[i]=n[i]}return e}var sa={clone:ou,merge:si},uk=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,hk=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`,Fn=class extends un{constructor(e){super();this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader=uk,this.fragmentShader=hk,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.morphTargets=!1,this.morphNormals=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,e!==void 0&&(e.attributes!==void 0&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(e))}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=ou(e.uniforms),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.lights=e.lights,this.clipping=e.clipping,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){let t=super.toJSON(e);t.glslVersion=this.glslVersion,t.uniforms={};for(let i in this.uniforms){let s=this.uniforms[i].value;s&&s.isTexture?t.uniforms[i]={type:"t",value:s.toJSON(e).uuid}:s&&s.isColor?t.uniforms[i]={type:"c",value:s.getHex()}:s&&s.isVector2?t.uniforms[i]={type:"v2",value:s.toArray()}:s&&s.isVector3?t.uniforms[i]={type:"v3",value:s.toArray()}:s&&s.isVector4?t.uniforms[i]={type:"v4",value:s.toArray()}:s&&s.isMatrix3?t.uniforms[i]={type:"m3",value:s.toArray()}:s&&s.isMatrix4?t.uniforms[i]={type:"m4",value:s.toArray()}:t.uniforms[i]={value:s}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader;let n={};for(let i in this.extensions)this.extensions[i]===!0&&(n[i]=!0);return Object.keys(n).length>0&&(t.extensions=n),t}};Fn.prototype.isShaderMaterial=!0;var au=class extends $e{constructor(){super();this.type="Camera",this.matrixWorldInverse=new Pe,this.projectionMatrix=new Pe,this.projectionMatrixInverse=new Pe}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this}getWorldDirection(e){this.updateWorldMatrix(!0,!1);let t=this.matrixWorld.elements;return e.set(-t[8],-t[9],-t[10]).normalize()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}};au.prototype.isCamera=!0;var It=class extends au{constructor(e=50,t=1,n=.1,i=2e3){super();this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=n,this.far=i,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=e.view===null?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){let t=.5*this.getFilmHeight()/e;this.fov=ef*2*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){let e=Math.tan(Cl*.5*this.fov);return .5*this.getFilmHeight()/e}getEffectiveFOV(){return ef*2*Math.atan(Math.tan(Cl*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(e,t,n,i,r,s){this.aspect=e/t,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=i,this.view.width=r,this.view.height=s,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){let e=this.near,t=e*Math.tan(Cl*.5*this.fov)/this.zoom,n=2*t,i=this.aspect*n,r=-.5*i,s=this.view;if(this.view!==null&&this.view.enabled){let l=s.fullWidth,c=s.fullHeight;r+=s.offsetX*i/l,t-=s.offsetY*n/c,i*=s.width/l,n*=s.height/c}let a=this.filmOffset;a!==0&&(r+=e*a/this.getFilmWidth()),this.projectionMatrix.makePerspective(r,r+i,t,t-n,e,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){let t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,this.view!==null&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}};It.prototype.isPerspectiveCamera=!0;var lu=90,cu=1,lf=class extends $e{constructor(e,t,n){super();if(this.type="CubeCamera",n.isWebGLCubeRenderTarget!==!0){console.error("THREE.CubeCamera: The constructor now expects an instance of WebGLCubeRenderTarget as third parameter.");return}this.renderTarget=n;let i=new It(lu,cu,e,t);i.layers=this.layers,i.up.set(0,-1,0),i.lookAt(new U(1,0,0)),this.add(i);let r=new It(lu,cu,e,t);r.layers=this.layers,r.up.set(0,-1,0),r.lookAt(new U(-1,0,0)),this.add(r);let s=new It(lu,cu,e,t);s.layers=this.layers,s.up.set(0,0,1),s.lookAt(new U(0,1,0)),this.add(s);let a=new It(lu,cu,e,t);a.layers=this.layers,a.up.set(0,0,-1),a.lookAt(new U(0,-1,0)),this.add(a);let l=new It(lu,cu,e,t);l.layers=this.layers,l.up.set(0,-1,0),l.lookAt(new U(0,0,1)),this.add(l);let c=new It(lu,cu,e,t);c.layers=this.layers,c.up.set(0,-1,0),c.lookAt(new U(0,0,-1)),this.add(c)}update(e,t){this.parent===null&&this.updateMatrixWorld();let n=this.renderTarget,[i,r,s,a,l,c]=this.children,u=e.xr.enabled,d=e.getRenderTarget();e.xr.enabled=!1;let h=n.texture.generateMipmaps;n.texture.generateMipmaps=!1,e.setRenderTarget(n,0),e.render(t,i),e.setRenderTarget(n,1),e.render(t,r),e.setRenderTarget(n,2),e.render(t,s),e.setRenderTarget(n,3),e.render(t,a),e.setRenderTarget(n,4),e.render(t,l),n.texture.generateMipmaps=h,e.setRenderTarget(n,5),e.render(t,c),e.setRenderTarget(d),e.xr.enabled=u}},Il=class extends Vt{constructor(e,t,n,i,r,s,a,l,c,u){e=e!==void 0?e:[],t=t!==void 0?t:jd,a=a!==void 0?a:Di;super(e,t,n,i,r,s,a,l,c,u);this._needsFlipEnvMap=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}};Il.prototype.isCubeTexture=!0;var cf=class extends Yn{constructor(e,t,n){Number.isInteger(t)&&(console.warn("THREE.WebGLCubeRenderTarget: constructor signature is now WebGLCubeRenderTarget( size, options )"),t=n);super(e,e,t);t=t||{},this.texture=new Il(void 0,t.mapping,t.wrapS,t.wrapT,t.magFilter,t.minFilter,t.format,t.type,t.anisotropy,t.encoding),this.texture.generateMipmaps=t.generateMipmaps!==void 0?t.generateMipmaps:!1,this.texture.minFilter=t.minFilter!==void 0?t.minFilter:Lt,this.texture._needsFlipEnvMap=!1}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.format=Fi,this.texture.encoding=t.encoding,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;let n={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},i=new ao(5,5,5),r=new Fn({name:"CubemapFromEquirect",uniforms:ou(n.uniforms),vertexShader:n.vertexShader,fragmentShader:n.fragmentShader,side:Qt,blending:Ks});r.uniforms.tEquirect.value=t;let s=new et(i,r),a=t.minFilter;return t.minFilter===hs&&(t.minFilter=Lt),new lf(1,10,this).update(e,s),t.minFilter=a,s.geometry.dispose(),s.material.dispose(),this}clear(e,t,n,i){let r=e.getRenderTarget();for(let s=0;s<6;s++)e.setRenderTarget(this,s),e.clear(t,n,i);e.setRenderTarget(r)}};cf.prototype.isWebGLCubeRenderTarget=!0;var G_=new U,dk=new U,fk=new vt,hn=class{constructor(e=new U(1,0,0),t=0){this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,n,i){return this.normal.set(e,t,n),this.constant=i,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,n){let i=G_.subVectors(n,t).cross(dk.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(i,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){let e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t.copy(this.normal).multiplyScalar(-this.distanceToPoint(e)).add(e)}intersectLine(e,t){let n=e.delta(G_),i=this.normal.dot(n);if(i===0)return this.distanceToPoint(e.start)===0?t.copy(e.start):null;let r=-(e.start.dot(this.normal)+this.constant)/i;return r<0||r>1?null:t.copy(n).multiplyScalar(r).add(e.start)}intersectsLine(e){let t=this.distanceToPoint(e.start),n=this.distanceToPoint(e.end);return t<0&&n>0||n<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){let n=t||fk.getNormalMatrix(e),i=this.coplanarPoint(G_).applyMatrix4(e),r=this.normal.applyMatrix3(n).normalize();return this.constant=-i.dot(r),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return new this.constructor().copy(this)}};hn.prototype.isPlane=!0;var uu=new qi,_g=new U,hu=class{constructor(e=new hn,t=new hn,n=new hn,i=new hn,r=new hn,s=new hn){this.planes=[e,t,n,i,r,s]}set(e,t,n,i,r,s){let a=this.planes;return a[0].copy(e),a[1].copy(t),a[2].copy(n),a[3].copy(i),a[4].copy(r),a[5].copy(s),this}copy(e){let t=this.planes;for(let n=0;n<6;n++)t[n].copy(e.planes[n]);return this}setFromProjectionMatrix(e){let t=this.planes,n=e.elements,i=n[0],r=n[1],s=n[2],a=n[3],l=n[4],c=n[5],u=n[6],d=n[7],h=n[8],f=n[9],p=n[10],g=n[11],v=n[12],y=n[13],m=n[14],x=n[15];return t[0].setComponents(a-i,d-l,g-h,x-v).normalize(),t[1].setComponents(a+i,d+l,g+h,x+v).normalize(),t[2].setComponents(a+r,d+c,g+f,x+y).normalize(),t[3].setComponents(a-r,d-c,g-f,x-y).normalize(),t[4].setComponents(a-s,d-u,g-p,x-m).normalize(),t[5].setComponents(a+s,d+u,g+p,x+m).normalize(),this}intersectsObject(e){let t=e.geometry;return t.boundingSphere===null&&t.computeBoundingSphere(),uu.copy(t.boundingSphere).applyMatrix4(e.matrixWorld),this.intersectsSphere(uu)}intersectsSprite(e){return uu.center.set(0,0,0),uu.radius=.7071067811865476,uu.applyMatrix4(e.matrixWorld),this.intersectsSphere(uu)}intersectsSphere(e){let t=this.planes,n=e.center,i=-e.radius;for(let r=0;r<6;r++)if(t[r].distanceToPoint(n)<i)return!1;return!0}intersectsBox(e){let t=this.planes;for(let n=0;n<6;n++){let i=t[n];if(_g.x=i.normal.x>0?e.max.x:e.min.x,_g.y=i.normal.y>0?e.max.y:e.min.y,_g.z=i.normal.z>0?e.max.z:e.min.z,i.distanceToPoint(_g)<0)return!1}return!0}containsPoint(e){let t=this.planes;for(let n=0;n<6;n++)if(t[n].distanceToPoint(e)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}};function AA(){let o=null,e=!1,t=null,n=null;function i(r,s){t(r,s),n=o.requestAnimationFrame(i)}return{start:function(){e!==!0&&t!==null&&(n=o.requestAnimationFrame(i),e=!0)},stop:function(){o.cancelAnimationFrame(n),e=!1},setAnimationLoop:function(r){t=r},setContext:function(r){o=r}}}function pk(o,e){let t=e.isWebGL2,n=new WeakMap;function i(c,u){let d=c.array,h=c.usage,f=o.createBuffer();o.bindBuffer(u,f),o.bufferData(u,d,h),c.onUploadCallback();let p=5126;return d instanceof Float32Array?p=5126:d instanceof Float64Array?console.warn("THREE.WebGLAttributes: Unsupported data buffer format: Float64Array."):d instanceof Uint16Array?c.isFloat16BufferAttribute?t?p=5131:console.warn("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2."):p=5123:d instanceof Int16Array?p=5122:d instanceof Uint32Array?p=5125:d instanceof Int32Array?p=5124:d instanceof Int8Array?p=5120:(d instanceof Uint8Array||d instanceof Uint8ClampedArray)&&(p=5121),{buffer:f,type:p,bytesPerElement:d.BYTES_PER_ELEMENT,version:c.version}}function r(c,u,d){let h=u.array,f=u.updateRange;o.bindBuffer(d,c),f.count===-1?o.bufferSubData(d,0,h):(t?o.bufferSubData(d,f.offset*h.BYTES_PER_ELEMENT,h,f.offset,f.count):o.bufferSubData(d,f.offset*h.BYTES_PER_ELEMENT,h.subarray(f.offset,f.offset+f.count)),f.count=-1)}function s(c){return c.isInterleavedBufferAttribute&&(c=c.data),n.get(c)}function a(c){c.isInterleavedBufferAttribute&&(c=c.data);let u=n.get(c);u&&(o.deleteBuffer(u.buffer),n.delete(c))}function l(c,u){if(c.isGLBufferAttribute){let h=n.get(c);(!h||h.version<c.version)&&n.set(c,{buffer:c.buffer,type:c.type,bytesPerElement:c.elementSize,version:c.version});return}c.isInterleavedBufferAttribute&&(c=c.data);let d=n.get(c);d===void 0?n.set(c,i(c,u)):d.version<c.version&&(r(d.buffer,c,u),d.version=c.version)}return{get:s,remove:a,update:l}}var Bi=class extends Ue{constructor(e=1,t=1,n=1,i=1){super();this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:n,heightSegments:i};let r=e/2,s=t/2,a=Math.floor(n),l=Math.floor(i),c=a+1,u=l+1,d=e/a,h=t/l,f=[],p=[],g=[],v=[];for(let y=0;y<u;y++){let m=y*h-s;for(let x=0;x<c;x++){let _=x*d-r;p.push(_,-m,0),g.push(0,0,1),v.push(x/a),v.push(1-y/l)}}for(let y=0;y<l;y++)for(let m=0;m<a;m++){let x=m+c*y,_=m+c*(y+1),w=m+1+c*(y+1),b=m+1+c*y;f.push(x,_,b),f.push(_,w,b)}this.setIndex(f),this.setAttribute("position",new Ne(p,3)),this.setAttribute("normal",new Ne(g,3)),this.setAttribute("uv",new Ne(v,2))}static fromJSON(e){return new Bi(e.width,e.height,e.widthSegments,e.heightSegments)}},mk=`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vUv ).g;
#endif`,gk=`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,yk=`#ifdef ALPHATEST
	if ( diffuseColor.a < ALPHATEST ) discard;
#endif`,vk=`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.specularRoughness );
	#endif
#endif`,xk=`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,_k="vec3 transformed = vec3( position );",wk=`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,bk=`vec2 integrateSpecularBRDF( const in float dotNV, const in float roughness ) {
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	return vec2( -1.04, 1.04 ) * a004 + r.zw;
}
float punctualLightIntensityToIrradianceFactor( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
#if defined ( PHYSICALLY_CORRECT_LIGHTS )
	float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
	if( cutoffDistance > 0.0 ) {
		distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
	}
	return distanceFalloff;
#else
	if( cutoffDistance > 0.0 && decayExponent > 0.0 ) {
		return pow( saturate( -lightDistance / cutoffDistance + 1.0 ), decayExponent );
	}
	return 1.0;
#endif
}
vec3 BRDF_Diffuse_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 specularColor, const in float dotVH ) {
	float fresnel = exp2( ( -5.55473 * dotVH - 6.98316 ) * dotVH );
	return ( 1.0 - specularColor ) * fresnel + specularColor;
}
vec3 F_Schlick_RoughnessDependent( const in vec3 F0, const in float dotNV, const in float roughness ) {
	float fresnel = exp2( ( -5.55473 * dotNV - 6.98316 ) * dotNV );
	vec3 Fr = max( vec3( 1.0 - roughness ), F0 ) - F0;
	return Fr * fresnel + F0;
}
float G_GGX_Smith( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gl = dotNL + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	float gv = dotNV + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	return 1.0 / ( gl * gv );
}
float G_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
vec3 BRDF_Specular_GGX( const in IncidentLight incidentLight, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float roughness ) {
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( incidentLight.direction + viewDir );
	float dotNL = saturate( dot( normal, incidentLight.direction ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotLH = saturate( dot( incidentLight.direction, halfDir ) );
	vec3 F = F_Schlick( specularColor, dotLH );
	float G = G_GGX_SmithCorrelated( alpha, dotNL, dotNV );
	float D = D_GGX( alpha, dotNH );
	return F * ( G * D );
}
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
vec3 BRDF_Specular_GGX_Environment( const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	vec2 brdf = integrateSpecularBRDF( dotNV, roughness );
	return specularColor * brdf.x + brdf.y;
}
void BRDF_Specular_Multiscattering_Environment( const in GeometricContext geometry, const in vec3 specularColor, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
	float dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );
	vec3 F = F_Schlick_RoughnessDependent( specularColor, dotNV, roughness );
	vec2 brdf = integrateSpecularBRDF( dotNV, roughness );
	vec3 FssEss = F * brdf.x + brdf.y;
	float Ess = brdf.x + brdf.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = specularColor + ( 1.0 - specularColor ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_Specular_BlinnPhong( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );
	float dotNH = saturate( dot( geometry.normal, halfDir ) );
	float dotLH = saturate( dot( incidentLight.direction, halfDir ) );
	vec3 F = F_Schlick( specularColor, dotLH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
}
float GGXRoughnessToBlinnExponent( const in float ggxRoughness ) {
	return ( 2.0 / pow2( ggxRoughness + 0.0001 ) - 2.0 );
}
float BlinnExponentToGGXRoughness( const in float blinnExponent ) {
	return sqrt( 2.0 / ( blinnExponent + 2.0 ) );
}
#if defined( USE_SHEEN )
float D_Charlie(float roughness, float NoH) {
	float invAlpha = 1.0 / roughness;
	float cos2h = NoH * NoH;
	float sin2h = max(1.0 - cos2h, 0.0078125);	return (2.0 + invAlpha) * pow(sin2h, invAlpha * 0.5) / (2.0 * PI);
}
float V_Neubelt(float NoV, float NoL) {
	return saturate(1.0 / (4.0 * (NoL + NoV - NoL * NoV)));
}
vec3 BRDF_Specular_Sheen( const in float roughness, const in vec3 L, const in GeometricContext geometry, vec3 specularColor ) {
	vec3 N = geometry.normal;
	vec3 V = geometry.viewDir;
	vec3 H = normalize( V + L );
	float dotNH = saturate( dot( N, H ) );
	return specularColor * D_Charlie( roughness, dotNH ) * V_Neubelt( dot(N, V), dot(N, L) );
}
#endif`,Mk=`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vUv );
		vec2 dSTdy = dFdy( vUv );
		float Hll = bumpScale * texture2D( bumpMap, vUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );
		vec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,Sk=`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#pragma unroll_loop_start
	for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
		plane = clippingPlanes[ i ];
		if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
	}
	#pragma unroll_loop_end
	#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
		bool clipped = true;
		#pragma unroll_loop_start
		for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
		}
		#pragma unroll_loop_end
		if ( clipped ) discard;
	#endif
#endif`,Tk=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,Ek=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,Ak=`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,Ck=`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,Lk=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,Rk=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	varying vec3 vColor;
#endif`,Pk=`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif`,Ik=`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate(a) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement(a) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract(sin(sn) * c);
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float max3( vec3 v ) { return max( max( v.x, v.y ), v.z ); }
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
struct GeometricContext {
	vec3 position;
	vec3 normal;
	vec3 viewDir;
#ifdef CLEARCOAT
	vec3 clearcoatNormal;
#endif
};
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
vec3 projectOnPlane(in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {
	float distance = dot( planeNormal, point - pointOnPlane );
	return - distance * planeNormal + point;
}
float sideOfPlane( in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {
	return sign( dot( point - pointOnPlane, planeNormal ) );
}
vec3 linePlaneIntersect( in vec3 pointOnLine, in vec3 lineDirection, in vec3 pointOnPlane, in vec3 planeNormal ) {
	return lineDirection * ( dot( planeNormal, pointOnPlane - pointOnLine ) / dot( planeNormal, lineDirection ) ) + pointOnLine;
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
float linearToRelativeLuminance( const in vec3 color ) {
	vec3 weights = vec3( 0.2126, 0.7152, 0.0722 );
	return dot( weights, color.rgb );
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}`,Dk=`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_maxMipLevel 8.0
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_maxTileSize 256.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		float texelSize = 1.0 / ( 3.0 * cubeUV_maxTileSize );
		vec2 uv = getUV( direction, face ) * ( faceSize - 1.0 );
		vec2 f = fract( uv );
		uv += 0.5 - f;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		if ( mipInt < cubeUV_maxMipLevel ) {
			uv.y += 2.0 * cubeUV_maxTileSize;
		}
		uv.y += filterInt * 2.0 * cubeUV_minTileSize;
		uv.x += 3.0 * max( 0.0, cubeUV_maxTileSize - 2.0 * faceSize );
		uv *= texelSize;
		vec3 tl = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;
		uv.x += texelSize;
		vec3 tr = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;
		uv.y += texelSize;
		vec3 br = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;
		uv.x -= texelSize;
		vec3 bl = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;
		vec3 tm = mix( tl, tr, f.x );
		vec3 bm = mix( bl, br, f.x );
		return mix( tm, bm, f.y );
	}
	#define r0 1.0
	#define v0 0.339
	#define m0 - 2.0
	#define r1 0.8
	#define v1 0.276
	#define m1 - 1.0
	#define r4 0.4
	#define v4 0.046
	#define m4 2.0
	#define r5 0.305
	#define v5 0.016
	#define m5 3.0
	#define r6 0.21
	#define v6 0.0038
	#define m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= r1 ) {
			mip = ( r0 - roughness ) * ( m1 - m0 ) / ( r0 - r1 ) + m0;
		} else if ( roughness >= r4 ) {
			mip = ( r1 - roughness ) * ( m4 - m1 ) / ( r1 - r4 ) + m1;
		} else if ( roughness >= r5 ) {
			mip = ( r4 - roughness ) * ( m5 - m4 ) / ( r4 - r5 ) + m4;
		} else if ( roughness >= r6 ) {
			mip = ( r5 - roughness ) * ( m6 - m5 ) / ( r5 - r6 ) + m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), m0, cubeUV_maxMipLevel );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,Fk=`vec3 transformedNormal = objectNormal;
#ifdef USE_INSTANCING
	mat3 m = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );
	transformedNormal = m * transformedNormal;
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	vec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,Bk=`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,Nk=`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );
#endif`,Ok=`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vUv );
	emissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,kk=`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,zk="gl_FragColor = linearToOutputTexel( gl_FragColor );",Uk=`
vec4 LinearToLinear( in vec4 value ) {
	return value;
}
vec4 GammaToLinear( in vec4 value, in float gammaFactor ) {
	return vec4( pow( value.rgb, vec3( gammaFactor ) ), value.a );
}
vec4 LinearToGamma( in vec4 value, in float gammaFactor ) {
	return vec4( pow( value.rgb, vec3( 1.0 / gammaFactor ) ), value.a );
}
vec4 sRGBToLinear( in vec4 value ) {
	return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );
}
vec4 LinearTosRGB( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}
vec4 RGBEToLinear( in vec4 value ) {
	return vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );
}
vec4 LinearToRGBE( in vec4 value ) {
	float maxComponent = max( max( value.r, value.g ), value.b );
	float fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );
	return vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );
}
vec4 RGBMToLinear( in vec4 value, in float maxRange ) {
	return vec4( value.rgb * value.a * maxRange, 1.0 );
}
vec4 LinearToRGBM( in vec4 value, in float maxRange ) {
	float maxRGB = max( value.r, max( value.g, value.b ) );
	float M = clamp( maxRGB / maxRange, 0.0, 1.0 );
	M = ceil( M * 255.0 ) / 255.0;
	return vec4( value.rgb / ( M * maxRange ), M );
}
vec4 RGBDToLinear( in vec4 value, in float maxRange ) {
	return vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );
}
vec4 LinearToRGBD( in vec4 value, in float maxRange ) {
	float maxRGB = max( value.r, max( value.g, value.b ) );
	float D = max( maxRange / maxRGB, 1.0 );
	D = clamp( floor( D ) / 255.0, 0.0, 1.0 );
	return vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );
}
const mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );
vec4 LinearToLogLuv( in vec4 value ) {
	vec3 Xp_Y_XYZp = cLogLuvM * value.rgb;
	Xp_Y_XYZp = max( Xp_Y_XYZp, vec3( 1e-6, 1e-6, 1e-6 ) );
	vec4 vResult;
	vResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;
	float Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;
	vResult.w = fract( Le );
	vResult.z = ( Le - ( floor( vResult.w * 255.0 ) ) / 255.0 ) / 255.0;
	return vResult;
}
const mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );
vec4 LogLuvToLinear( in vec4 value ) {
	float Le = value.z * 255.0 + value.w;
	vec3 Xp_Y_XYZp;
	Xp_Y_XYZp.y = exp2( ( Le - 127.0 ) / 2.0 );
	Xp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;
	Xp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;
	vec3 vRGB = cLogLuvInverseM * Xp_Y_XYZp.rgb;
	return vec4( max( vRGB, 0.0 ), 1.0 );
}`,Hk=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 envColor = textureCubeUV( envMap, reflectVec, 0.0 );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifndef ENVMAP_TYPE_CUBE_UV
		envColor = envMapTexelToLinear( envColor );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,Gk=`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	uniform int maxMipLevel;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
	
#endif`,Vk=`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,Wk=`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) ||defined( PHONG )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,Xk=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,qk=`#ifdef USE_FOG
	fogDepth = - mvPosition.z;
#endif`,jk=`#ifdef USE_FOG
	varying float fogDepth;
#endif`,Yk=`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * fogDepth * fogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, fogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,Zk=`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float fogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,Jk=`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return texture2D( gradientMap, coord ).rgb;
	#else
		return ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );
	#endif
}`,Kk=`#ifdef USE_LIGHTMAP
	vec4 lightMapTexel= texture2D( lightMap, vUv2 );
	reflectedLight.indirectDiffuse += PI * lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;
#endif`,$k=`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,Qk=`vec3 diffuse = vec3( 1.0 );
GeometricContext geometry;
geometry.position = mvPosition.xyz;
geometry.normal = normalize( transformedNormal );
geometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( -mvPosition.xyz );
GeometricContext backGeometry;
backGeometry.position = geometry.position;
backGeometry.normal = -geometry.normal;
backGeometry.viewDir = geometry.viewDir;
vLightFront = vec3( 0.0 );
vIndirectFront = vec3( 0.0 );
#ifdef DOUBLE_SIDED
	vLightBack = vec3( 0.0 );
	vIndirectBack = vec3( 0.0 );
#endif
IncidentLight directLight;
float dotNL;
vec3 directLightColor_Diffuse;
vIndirectFront += getAmbientLightIrradiance( ambientLightColor );
vIndirectFront += getLightProbeIrradiance( lightProbe, geometry );
#ifdef DOUBLE_SIDED
	vIndirectBack += getAmbientLightIrradiance( ambientLightColor );
	vIndirectBack += getLightProbeIrradiance( lightProbe, backGeometry );
#endif
#if NUM_POINT_LIGHTS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		getPointDirectLightIrradiance( pointLights[ i ], geometry, directLight );
		dotNL = dot( geometry.normal, directLight.direction );
		directLightColor_Diffuse = PI * directLight.color;
		vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
		#ifdef DOUBLE_SIDED
			vLightBack += saturate( -dotNL ) * directLightColor_Diffuse;
		#endif
	}
	#pragma unroll_loop_end
#endif
#if NUM_SPOT_LIGHTS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		getSpotDirectLightIrradiance( spotLights[ i ], geometry, directLight );
		dotNL = dot( geometry.normal, directLight.direction );
		directLightColor_Diffuse = PI * directLight.color;
		vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
		#ifdef DOUBLE_SIDED
			vLightBack += saturate( -dotNL ) * directLightColor_Diffuse;
		#endif
	}
	#pragma unroll_loop_end
#endif
#if NUM_DIR_LIGHTS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		getDirectionalDirectLightIrradiance( directionalLights[ i ], geometry, directLight );
		dotNL = dot( geometry.normal, directLight.direction );
		directLightColor_Diffuse = PI * directLight.color;
		vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
		#ifdef DOUBLE_SIDED
			vLightBack += saturate( -dotNL ) * directLightColor_Diffuse;
		#endif
	}
	#pragma unroll_loop_end
#endif
#if NUM_HEMI_LIGHTS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
		vIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );
		#ifdef DOUBLE_SIDED
			vIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry );
		#endif
	}
	#pragma unroll_loop_end
#endif`,ez=`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
uniform vec3 lightProbe[ 9 ];
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in GeometricContext geometry ) {
	vec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	#ifndef PHYSICALLY_CORRECT_LIGHTS
		irradiance *= PI;
	#endif
	return irradiance;
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalDirectLightIrradiance( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight directLight ) {
		directLight.color = directionalLight.color;
		directLight.direction = directionalLight.direction;
		directLight.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointDirectLightIrradiance( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight directLight ) {
		vec3 lVector = pointLight.position - geometry.position;
		directLight.direction = normalize( lVector );
		float lightDistance = length( lVector );
		directLight.color = pointLight.color;
		directLight.color *= punctualLightIntensityToIrradianceFactor( lightDistance, pointLight.distance, pointLight.decay );
		directLight.visible = ( directLight.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotDirectLightIrradiance( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight directLight ) {
		vec3 lVector = spotLight.position - geometry.position;
		directLight.direction = normalize( lVector );
		float lightDistance = length( lVector );
		float angleCos = dot( directLight.direction, spotLight.direction );
		if ( angleCos > spotLight.coneCos ) {
			float spotEffect = smoothstep( spotLight.coneCos, spotLight.penumbraCos, angleCos );
			directLight.color = spotLight.color;
			directLight.color *= spotEffect * punctualLightIntensityToIrradianceFactor( lightDistance, spotLight.distance, spotLight.decay );
			directLight.visible = true;
		} else {
			directLight.color = vec3( 0.0 );
			directLight.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in GeometricContext geometry ) {
		float dotNL = dot( geometry.normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		#ifndef PHYSICALLY_CORRECT_LIGHTS
			irradiance *= PI;
		#endif
		return irradiance;
	}
#endif`,tz=`#if defined( USE_ENVMAP )
	#ifdef ENVMAP_MODE_REFRACTION
		uniform float refractionRatio;
	#endif
	vec3 getLightProbeIndirectIrradiance( const in GeometricContext geometry, const in int maxMIPLevel ) {
		vec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );
		#ifdef ENVMAP_TYPE_CUBE
			vec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );
			#ifdef TEXTURE_LOD_EXT
				vec4 envMapColor = textureCubeLodEXT( envMap, queryVec, float( maxMIPLevel ) );
			#else
				vec4 envMapColor = textureCube( envMap, queryVec, float( maxMIPLevel ) );
			#endif
			envMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;
		#elif defined( ENVMAP_TYPE_CUBE_UV )
			vec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );
		#else
			vec4 envMapColor = vec4( 0.0 );
		#endif
		return PI * envMapColor.rgb * envMapIntensity;
	}
	float getSpecularMIPLevel( const in float roughness, const in int maxMIPLevel ) {
		float maxMIPLevelScalar = float( maxMIPLevel );
		float sigma = PI * roughness * roughness / ( 1.0 + roughness );
		float desiredMIPLevel = maxMIPLevelScalar + log2( sigma );
		return clamp( desiredMIPLevel, 0.0, maxMIPLevelScalar );
	}
	vec3 getLightProbeIndirectRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in int maxMIPLevel ) {
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( -viewDir, normal );
			reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
		#else
			vec3 reflectVec = refract( -viewDir, normal, refractionRatio );
		#endif
		reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
		float specularMIPLevel = getSpecularMIPLevel( roughness, maxMIPLevel );
		#ifdef ENVMAP_TYPE_CUBE
			vec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );
			#ifdef TEXTURE_LOD_EXT
				vec4 envMapColor = textureCubeLodEXT( envMap, queryReflectVec, specularMIPLevel );
			#else
				vec4 envMapColor = textureCube( envMap, queryReflectVec, specularMIPLevel );
			#endif
			envMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;
		#elif defined( ENVMAP_TYPE_CUBE_UV )
			vec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );
		#endif
		return envMapColor.rgb * envMapIntensity;
	}
#endif`,nz=`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,iz=`varying vec3 vViewPosition;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;
	#ifndef PHYSICALLY_CORRECT_LIGHTS
		irradiance *= PI;
	#endif
	reflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon
#define Material_LightProbeLOD( material )	(0)`,rz=`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,sz=`varying vec3 vViewPosition;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifndef PHYSICALLY_CORRECT_LIGHTS
		irradiance *= PI;
	#endif
	reflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_Specular_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong
#define Material_LightProbeLOD( material )	(0)`,oz=`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.specularRoughness = max( roughnessFactor, 0.0525 );material.specularRoughness += geometryRoughness;
material.specularRoughness = min( material.specularRoughness, 1.0 );
#ifdef REFLECTIVITY
	material.specularColor = mix( vec3( MAXIMUM_SPECULAR_COEFFICIENT * pow2( reflectivity ) ), diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( DEFAULT_SPECULAR_COEFFICIENT ), diffuseColor.rgb, metalnessFactor );
#endif
#ifdef CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheen;
#endif`,az=`struct PhysicalMaterial {
	vec3 diffuseColor;
	float specularRoughness;
	vec3 specularColor;
#ifdef CLEARCOAT
	float clearcoat;
	float clearcoatRoughness;
#endif
#ifdef USE_SHEEN
	vec3 sheenColor;
#endif
};
#define MAXIMUM_SPECULAR_COEFFICIENT 0.16
#define DEFAULT_SPECULAR_COEFFICIENT 0.04
float clearcoatDHRApprox( const in float roughness, const in float dotNL ) {
	return DEFAULT_SPECULAR_COEFFICIENT + ( 1.0 - DEFAULT_SPECULAR_COEFFICIENT ) * ( pow( 1.0 - dotNL, 5.0 ) * pow( 1.0 - roughness, 2.0 ) );
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometry.normal;
		vec3 viewDir = geometry.viewDir;
		vec3 position = geometry.position;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.specularRoughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifndef PHYSICALLY_CORRECT_LIGHTS
		irradiance *= PI;
	#endif
	#ifdef CLEARCOAT
		float ccDotNL = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = ccDotNL * directLight.color;
		#ifndef PHYSICALLY_CORRECT_LIGHTS
			ccIrradiance *= PI;
		#endif
		float clearcoatDHR = material.clearcoat * clearcoatDHRApprox( material.clearcoatRoughness, ccDotNL );
		reflectedLight.directSpecular += ccIrradiance * material.clearcoat * BRDF_Specular_GGX( directLight, geometry.viewDir, geometry.clearcoatNormal, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearcoatRoughness );
	#else
		float clearcoatDHR = 0.0;
	#endif
	#ifdef USE_SHEEN
		reflectedLight.directSpecular += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Specular_Sheen(
			material.specularRoughness,
			directLight.direction,
			geometry,
			material.sheenColor
		);
	#else
		reflectedLight.directSpecular += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Specular_GGX( directLight, geometry.viewDir, geometry.normal, material.specularColor, material.specularRoughness);
	#endif
	reflectedLight.directDiffuse += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef CLEARCOAT
		float ccDotNV = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );
		reflectedLight.indirectSpecular += clearcoatRadiance * material.clearcoat * BRDF_Specular_GGX_Environment( geometry.viewDir, geometry.clearcoatNormal, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearcoatRoughness );
		float ccDotNL = ccDotNV;
		float clearcoatDHR = material.clearcoat * clearcoatDHRApprox( material.clearcoatRoughness, ccDotNL );
	#else
		float clearcoatDHR = 0.0;
	#endif
	float clearcoatInv = 1.0 - clearcoatDHR;
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	BRDF_Specular_Multiscattering_Environment( geometry, material.specularColor, material.specularRoughness, singleScattering, multiScattering );
	vec3 diffuse = material.diffuseColor * ( 1.0 - ( singleScattering + multiScattering ) );
	reflectedLight.indirectSpecular += clearcoatInv * radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,lz=`
GeometricContext geometry;
geometry.position = - vViewPosition;
geometry.normal = normal;
geometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
#ifdef CLEARCOAT
	geometry.clearcoatNormal = clearcoatNormal;
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointDirectLightIrradiance( pointLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotDirectLightIrradiance( spotLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalDirectLightIrradiance( directionalLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	irradiance += getLightProbeIrradiance( lightProbe, geometry );
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,cz=`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel= texture2D( lightMap, vUv2 );
		vec3 lightMapIrradiance = lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;
		#ifndef PHYSICALLY_CORRECT_LIGHTS
			lightMapIrradiance *= PI;
		#endif
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getLightProbeIndirectIrradiance( geometry, maxMipLevel );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	radiance += getLightProbeIndirectRadiance( geometry.viewDir, geometry.normal, material.specularRoughness, maxMipLevel );
	#ifdef CLEARCOAT
		clearcoatRadiance += getLightProbeIndirectRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness, maxMipLevel );
	#endif
#endif`,uz=`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );
#endif`,hz=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	gl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,dz=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,fz=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		varying float vFragDepth;
		varying float vIsPerspective;
	#else
		uniform float logDepthBufFC;
	#endif
#endif`,pz=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		vFragDepth = 1.0 + gl_Position.w;
		vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
	#else
		if ( isPerspectiveMatrix( projectionMatrix ) ) {
			gl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;
			gl_Position.z *= gl_Position.w;
		}
	#endif
#endif`,mz=`#ifdef USE_MAP
	vec4 texelColor = texture2D( map, vUv );
	texelColor = mapTexelToLinear( texelColor );
	diffuseColor *= texelColor;
#endif`,gz=`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,yz=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
#endif
#ifdef USE_MAP
	vec4 mapTexel = texture2D( map, uv );
	diffuseColor *= mapTexelToLinear( mapTexel );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,vz=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	uniform mat3 uvTransform;
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,xz=`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vUv );
	metalnessFactor *= texelMetalness.b;
#endif`,_z=`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,wz=`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	objectNormal += morphNormal0 * morphTargetInfluences[ 0 ];
	objectNormal += morphNormal1 * morphTargetInfluences[ 1 ];
	objectNormal += morphNormal2 * morphTargetInfluences[ 2 ];
	objectNormal += morphNormal3 * morphTargetInfluences[ 3 ];
#endif`,bz=`#ifdef USE_MORPHTARGETS
	uniform float morphTargetBaseInfluence;
	#ifndef USE_MORPHNORMALS
		uniform float morphTargetInfluences[ 8 ];
	#else
		uniform float morphTargetInfluences[ 4 ];
	#endif
#endif`,Mz=`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	transformed += morphTarget0 * morphTargetInfluences[ 0 ];
	transformed += morphTarget1 * morphTargetInfluences[ 1 ];
	transformed += morphTarget2 * morphTargetInfluences[ 2 ];
	transformed += morphTarget3 * morphTargetInfluences[ 3 ];
	#ifndef USE_MORPHNORMALS
		transformed += morphTarget4 * morphTargetInfluences[ 4 ];
		transformed += morphTarget5 * morphTargetInfluences[ 5 ];
		transformed += morphTarget6 * morphTargetInfluences[ 6 ];
		transformed += morphTarget7 * morphTargetInfluences[ 7 ];
	#endif
#endif`,Sz=`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );
	vec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	#ifdef USE_TANGENT
		vec3 tangent = normalize( vTangent );
		vec3 bitangent = normalize( vBitangent );
		#ifdef DOUBLE_SIDED
			tangent = tangent * faceDirection;
			bitangent = bitangent * faceDirection;
		#endif
		#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )
			mat3 vTBN = mat3( tangent, bitangent, normal );
		#endif
	#endif
#endif
vec3 geometryNormal = normal;`,Tz=`#ifdef OBJECTSPACE_NORMALMAP
	normal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( TANGENTSPACE_NORMALMAP )
	vec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	#ifdef USE_TANGENT
		normal = normalize( vTBN * mapN );
	#else
		normal = perturbNormal2Arb( -vViewPosition, normal, mapN, faceDirection );
	#endif
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,Ez=`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef OBJECTSPACE_NORMALMAP
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )
	vec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN, float faceDirection ) {
		vec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );
		vec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );
		vec2 st0 = dFdx( vUv.st );
		vec2 st1 = dFdy( vUv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : faceDirection * inversesqrt( det );
		return normalize( T * ( mapN.x * scale ) + B * ( mapN.y * scale ) + N * mapN.z );
	}
#endif`,Az=`#ifdef CLEARCOAT
	vec3 clearcoatNormal = geometryNormal;
#endif`,Cz=`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	#ifdef USE_TANGENT
		clearcoatNormal = normalize( vTBN * clearcoatMapN );
	#else
		clearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN, faceDirection );
	#endif
#endif`,Lz=`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif`,Rz=`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;
const vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );
const vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );
const float ShiftRight8 = 1. / 256.;
vec4 packDepthToRGBA( const in float v ) {
	vec4 r = vec4( fract( v * PackFactors ), v );
	r.yzw -= r.xyz * ShiftRight8;	return r * PackUpscale;
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors );
}
vec4 pack2HalfToRGBA( vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ));
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w);
}
vec2 unpackRGBATo2Half( vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {
	return linearClipZ * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return (( near + viewZ ) * far ) / (( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * invClipZ - far );
}`,Pz=`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,Iz=`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,Dz=`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,Fz=`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,Bz=`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vUv );
	roughnessFactor *= texelRoughness.g;
#endif`,Nz=`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,Oz=`#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		varying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		float hard_shadow = step( compare , distribution.x );
		if (hard_shadow != 1.0 ) {
			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );
		bool inFrustum = all( inFrustumVec );
		bvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );
		bool frustumTest = all( frustumTestVec );
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ), 
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ), 
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ), 
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ), 
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ), 
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ), 
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return shadow;
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
		vec3 lightToPosition = shadowCoord.xyz;
		float dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );		dp += shadowBias;
		vec3 bd3D = normalize( lightToPosition );
		#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
			vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
			return (
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
			) * ( 1.0 / 9.0 );
		#else
			return texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
		#endif
	}
#endif`,kz=`#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHT_SHADOWS ];
		varying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,zz=`#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0 || NUM_SPOT_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0
		vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		vec4 shadowWorldPosition;
	#endif
	#if NUM_DIR_LIGHT_SHADOWS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
		vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias, 0 );
		vSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
		vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
	#endif
#endif`,Uz=`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,Hz=`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,Gz=`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	#ifdef BONE_TEXTURE
		uniform highp sampler2D boneTexture;
		uniform int boneTextureSize;
		mat4 getBoneMatrix( const in float i ) {
			float j = i * 4.0;
			float x = mod( j, float( boneTextureSize ) );
			float y = floor( j / float( boneTextureSize ) );
			float dx = 1.0 / float( boneTextureSize );
			float dy = 1.0 / float( boneTextureSize );
			y = dy * ( y + 0.5 );
			vec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );
			vec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );
			vec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );
			vec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );
			mat4 bone = mat4( v1, v2, v3, v4 );
			return bone;
		}
	#else
		uniform mat4 boneMatrices[ MAX_BONES ];
		mat4 getBoneMatrix( const in float i ) {
			mat4 bone = boneMatrices[ int(i) ];
			return bone;
		}
	#endif
#endif`,Vz=`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,Wz=`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,Xz=`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,qz=`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,jz=`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,Yz=`#ifndef saturate
#define saturate(a) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return toneMappingExposure * color;
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 OptimizedCineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,Zz=`#ifdef USE_TRANSMISSION
	float transmissionFactor = transmission;
	float thicknessFactor = thickness;
	#ifdef USE_TRANSMISSIONMAP
		transmissionFactor *= texture2D( transmissionMap, vUv ).r;
	#endif
	#ifdef USE_THICKNESSNMAP
		thicknessFactor *= texture2D( thicknessMap, vUv ).g;
	#endif
	vec3 pos = vWorldPosition.xyz / vWorldPosition.w;
	vec3 v = normalize( cameraPosition - pos );
	float ior = ( 1.0 + 0.4 * reflectivity ) / ( 1.0 - 0.4 * reflectivity );
	vec3 transmission = transmissionFactor * getIBLVolumeRefraction(
		normal, v, roughnessFactor, material.diffuseColor, totalSpecular,
		pos, modelMatrix, viewMatrix, projectionMatrix, ior, thicknessFactor,
		attenuationColor, attenuationDistance );
	totalDiffuse = mix( totalDiffuse, transmission, transmissionFactor );
#endif`,Jz=`#ifdef USE_TRANSMISSION
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec4 vWorldPosition;
	vec3 getVolumeTransmissionRay(vec3 n, vec3 v, float thickness, float ior, mat4 modelMatrix) {
		vec3 refractionVector = refract(-v, normalize(n), 1.0 / ior);
		vec3 modelScale;
		modelScale.x = length(vec3(modelMatrix[0].xyz));
		modelScale.y = length(vec3(modelMatrix[1].xyz));
		modelScale.z = length(vec3(modelMatrix[2].xyz));
		return normalize(refractionVector) * thickness * modelScale;
	}
	float applyIorToRoughness(float roughness, float ior) {
		return roughness * clamp(ior * 2.0 - 2.0, 0.0, 1.0);
	}
	vec3 getTransmissionSample(vec2 fragCoord, float roughness, float ior) {
		float framebufferLod = log2(transmissionSamplerSize.x) * applyIorToRoughness(roughness, ior);
		return texture2DLodEXT(transmissionSamplerMap, fragCoord.xy, framebufferLod).rgb;
	}
	vec3 applyVolumeAttenuation(vec3 radiance, float transmissionDistance, vec3 attenuationColor, float attenuationDistance) {
		if (attenuationDistance == 0.0) {
			return radiance;
		} else {
			vec3 attenuationCoefficient = -log(attenuationColor) / attenuationDistance;
			vec3 transmittance = exp(-attenuationCoefficient * transmissionDistance);			return transmittance * radiance;
		}
	}
	vec3 getIBLVolumeRefraction(vec3 n, vec3 v, float perceptualRoughness, vec3 baseColor, vec3 specularColor,
		vec3 position, mat4 modelMatrix, mat4 viewMatrix, mat4 projMatrix, float ior, float thickness,
		vec3 attenuationColor, float attenuationDistance) {
		vec3 transmissionRay = getVolumeTransmissionRay(n, v, thickness, ior, modelMatrix);
		vec3 refractedRayExit = position + transmissionRay;
		vec4 ndcPos = projMatrix * viewMatrix * vec4(refractedRayExit, 1.0);
		vec2 refractionCoords = ndcPos.xy / ndcPos.w;
		refractionCoords += 1.0;
		refractionCoords /= 2.0;
		vec3 transmittedLight = getTransmissionSample(refractionCoords, perceptualRoughness, ior);
		vec3 attenuatedColor = applyVolumeAttenuation(transmittedLight, length(transmissionRay), attenuationColor, attenuationDistance);
		return (1.0 - specularColor) * attenuatedColor * baseColor;
	}
#endif`,Kz=`#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )
	varying vec2 vUv;
#endif`,$z=`#ifdef USE_UV
	#ifdef UVS_VERTEX_ONLY
		vec2 vUv;
	#else
		varying vec2 vUv;
	#endif
	uniform mat3 uvTransform;
#endif`,Qz=`#ifdef USE_UV
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
#endif`,eU=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	varying vec2 vUv2;
#endif`,tU=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	attribute vec2 uv2;
	varying vec2 vUv2;
	uniform mat3 uv2Transform;
#endif`,nU=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	vUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;
#endif`,iU=`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION )
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`,rU=`uniform sampler2D t2D;
varying vec2 vUv;
void main() {
	vec4 texColor = texture2D( t2D, vUv );
	gl_FragColor = mapTexelToLinear( texColor );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,sU=`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,oU=`#include <envmap_common_pars_fragment>
uniform float opacity;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	vec3 vReflect = vWorldDirection;
	#include <envmap_fragment>
	gl_FragColor = envColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,aU=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,lU=`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <logdepthbuf_fragment>
	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#endif
}`,cU=`#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,uU=`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,hU=`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,dU=`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	vec4 texColor = texture2D( tEquirect, sampleUV );
	gl_FragColor = mapTexelToLinear( texColor );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,fU=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,pU=`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,mU=`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <color_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,gU=`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <cube_uv_reflection_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
	
		vec4 lightMapTexel= texture2D( lightMap, vUv2 );
		reflectedLight.indirectDiffuse += lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,yU=`#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <skinbase_vertex>
	#ifdef USE_ENVMAP
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,vU=`uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
varying vec3 vLightFront;
varying vec3 vIndirectFront;
#ifdef DOUBLE_SIDED
	varying vec3 vLightBack;
	varying vec3 vIndirectBack;
#endif
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <cube_uv_reflection_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <fog_pars_fragment>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <emissivemap_fragment>
	#ifdef DOUBLE_SIDED
		reflectedLight.indirectDiffuse += ( gl_FrontFacing ) ? vIndirectFront : vIndirectBack;
	#else
		reflectedLight.indirectDiffuse += vIndirectFront;
	#endif
	#include <lightmap_fragment>
	reflectedLight.indirectDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb );
	#ifdef DOUBLE_SIDED
		reflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;
	#else
		reflectedLight.directDiffuse = vLightFront;
	#endif
	reflectedLight.directDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb ) * getShadowMask();
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,xU=`#define LAMBERT
varying vec3 vLightFront;
varying vec3 vIndirectFront;
#ifdef DOUBLE_SIDED
	varying vec3 vLightBack;
	varying vec3 vIndirectBack;
#endif
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <envmap_pars_vertex>
#include <bsdfs>
#include <lights_pars_begin>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <lights_lambert_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,_U=`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <fog_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
		matcapColor = matcapTexelToLinear( matcapColor );
	#else
		vec4 matcapColor = vec4( 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,wU=`#define MATCAP
varying vec3 vViewPosition;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#ifndef FLAT_SHADED
		vNormal = normalize( transformedNormal );
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,bU=`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,MU=`#define TOON
varying vec3 vViewPosition;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,SU=`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <cube_uv_reflection_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,TU=`#define PHONG
varying vec3 vViewPosition;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,EU=`#define STANDARD
#ifdef PHYSICAL
	#define REFLECTIVITY
	#define CLEARCOAT
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform vec3 attenuationColor;
	uniform float attenuationDistance;
#endif
#ifdef REFLECTIVITY
	uniform float reflectivity;
#endif
#ifdef CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheen;
#endif
varying vec3 vViewPosition;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <bsdfs>
#include <transmission_pars_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <lights_physical_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,AU=`#define STANDARD
varying vec3 vViewPosition;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif
#ifdef USE_TRANSMISSION
	varying vec4 vWorldPosition;
#endif
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition;
#endif
}`,CU=`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	varying vec3 vViewPosition;
#endif
#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif
#include <packing>
#include <uv_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), opacity );
}`,LU=`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	varying vec3 vViewPosition;
#endif
#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	vViewPosition = - mvPosition.xyz;
#endif
}`,RU=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,PU=`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <color_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,IU=`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`,DU=`#include <common>
#include <fog_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <begin_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,FU=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`,BU=`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
	vec2 scale;
	scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
	scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,lt={alphamap_fragment:mk,alphamap_pars_fragment:gk,alphatest_fragment:yk,aomap_fragment:vk,aomap_pars_fragment:xk,begin_vertex:_k,beginnormal_vertex:wk,bsdfs:bk,bumpmap_pars_fragment:Mk,clipping_planes_fragment:Sk,clipping_planes_pars_fragment:Tk,clipping_planes_pars_vertex:Ek,clipping_planes_vertex:Ak,color_fragment:Ck,color_pars_fragment:Lk,color_pars_vertex:Rk,color_vertex:Pk,common:Ik,cube_uv_reflection_fragment:Dk,defaultnormal_vertex:Fk,displacementmap_pars_vertex:Bk,displacementmap_vertex:Nk,emissivemap_fragment:Ok,emissivemap_pars_fragment:kk,encodings_fragment:zk,encodings_pars_fragment:Uk,envmap_fragment:Hk,envmap_common_pars_fragment:Gk,envmap_pars_fragment:Vk,envmap_pars_vertex:Wk,envmap_physical_pars_fragment:tz,envmap_vertex:Xk,fog_vertex:qk,fog_pars_vertex:jk,fog_fragment:Yk,fog_pars_fragment:Zk,gradientmap_pars_fragment:Jk,lightmap_fragment:Kk,lightmap_pars_fragment:$k,lights_lambert_vertex:Qk,lights_pars_begin:ez,lights_toon_fragment:nz,lights_toon_pars_fragment:iz,lights_phong_fragment:rz,lights_phong_pars_fragment:sz,lights_physical_fragment:oz,lights_physical_pars_fragment:az,lights_fragment_begin:lz,lights_fragment_maps:cz,lights_fragment_end:uz,logdepthbuf_fragment:hz,logdepthbuf_pars_fragment:dz,logdepthbuf_pars_vertex:fz,logdepthbuf_vertex:pz,map_fragment:mz,map_pars_fragment:gz,map_particle_fragment:yz,map_particle_pars_fragment:vz,metalnessmap_fragment:xz,metalnessmap_pars_fragment:_z,morphnormal_vertex:wz,morphtarget_pars_vertex:bz,morphtarget_vertex:Mz,normal_fragment_begin:Sz,normal_fragment_maps:Tz,normalmap_pars_fragment:Ez,clearcoat_normal_fragment_begin:Az,clearcoat_normal_fragment_maps:Cz,clearcoat_pars_fragment:Lz,packing:Rz,premultiplied_alpha_fragment:Pz,project_vertex:Iz,dithering_fragment:Dz,dithering_pars_fragment:Fz,roughnessmap_fragment:Bz,roughnessmap_pars_fragment:Nz,shadowmap_pars_fragment:Oz,shadowmap_pars_vertex:kz,shadowmap_vertex:zz,shadowmask_pars_fragment:Uz,skinbase_vertex:Hz,skinning_pars_vertex:Gz,skinning_vertex:Vz,skinnormal_vertex:Wz,specularmap_fragment:Xz,specularmap_pars_fragment:qz,tonemapping_fragment:jz,tonemapping_pars_fragment:Yz,transmission_fragment:Zz,transmission_pars_fragment:Jz,uv_pars_fragment:Kz,uv_pars_vertex:$z,uv_vertex:Qz,uv2_pars_fragment:eU,uv2_pars_vertex:tU,uv2_vertex:nU,worldpos_vertex:iU,background_frag:rU,background_vert:sU,cube_frag:oU,cube_vert:aU,depth_frag:lU,depth_vert:cU,distanceRGBA_frag:uU,distanceRGBA_vert:hU,equirect_frag:dU,equirect_vert:fU,linedashed_frag:pU,linedashed_vert:mU,meshbasic_frag:gU,meshbasic_vert:yU,meshlambert_frag:vU,meshlambert_vert:xU,meshmatcap_frag:_U,meshmatcap_vert:wU,meshtoon_frag:bU,meshtoon_vert:MU,meshphong_frag:SU,meshphong_vert:TU,meshphysical_frag:EU,meshphysical_vert:AU,normal_frag:CU,normal_vert:LU,points_frag:RU,points_vert:PU,shadow_frag:IU,shadow_vert:DU,sprite_frag:FU,sprite_vert:BU},He={common:{diffuse:{value:new De(16777215)},opacity:{value:1},map:{value:null},uvTransform:{value:new vt},uv2Transform:{value:new vt},alphaMap:{value:null}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},refractionRatio:{value:.98},maxMipLevel:{value:0}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new _e(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new De(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new De(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},uvTransform:{value:new vt}},sprite:{diffuse:{value:new De(16777215)},opacity:{value:1},center:{value:new _e(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},uvTransform:{value:new vt}}},Or={basic:{uniforms:si([He.common,He.specularmap,He.envmap,He.aomap,He.lightmap,He.fog]),vertexShader:lt.meshbasic_vert,fragmentShader:lt.meshbasic_frag},lambert:{uniforms:si([He.common,He.specularmap,He.envmap,He.aomap,He.lightmap,He.emissivemap,He.fog,He.lights,{emissive:{value:new De(0)}}]),vertexShader:lt.meshlambert_vert,fragmentShader:lt.meshlambert_frag},phong:{uniforms:si([He.common,He.specularmap,He.envmap,He.aomap,He.lightmap,He.emissivemap,He.bumpmap,He.normalmap,He.displacementmap,He.fog,He.lights,{emissive:{value:new De(0)},specular:{value:new De(1118481)},shininess:{value:30}}]),vertexShader:lt.meshphong_vert,fragmentShader:lt.meshphong_frag},standard:{uniforms:si([He.common,He.envmap,He.aomap,He.lightmap,He.emissivemap,He.bumpmap,He.normalmap,He.displacementmap,He.roughnessmap,He.metalnessmap,He.fog,He.lights,{emissive:{value:new De(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:lt.meshphysical_vert,fragmentShader:lt.meshphysical_frag},toon:{uniforms:si([He.common,He.aomap,He.lightmap,He.emissivemap,He.bumpmap,He.normalmap,He.displacementmap,He.gradientmap,He.fog,He.lights,{emissive:{value:new De(0)}}]),vertexShader:lt.meshtoon_vert,fragmentShader:lt.meshtoon_frag},matcap:{uniforms:si([He.common,He.bumpmap,He.normalmap,He.displacementmap,He.fog,{matcap:{value:null}}]),vertexShader:lt.meshmatcap_vert,fragmentShader:lt.meshmatcap_frag},points:{uniforms:si([He.points,He.fog]),vertexShader:lt.points_vert,fragmentShader:lt.points_frag},dashed:{uniforms:si([He.common,He.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:lt.linedashed_vert,fragmentShader:lt.linedashed_frag},depth:{uniforms:si([He.common,He.displacementmap]),vertexShader:lt.depth_vert,fragmentShader:lt.depth_frag},normal:{uniforms:si([He.common,He.bumpmap,He.normalmap,He.displacementmap,{opacity:{value:1}}]),vertexShader:lt.normal_vert,fragmentShader:lt.normal_frag},sprite:{uniforms:si([He.sprite,He.fog]),vertexShader:lt.sprite_vert,fragmentShader:lt.sprite_frag},background:{uniforms:{uvTransform:{value:new vt},t2D:{value:null}},vertexShader:lt.background_vert,fragmentShader:lt.background_frag},cube:{uniforms:si([He.envmap,{opacity:{value:1}}]),vertexShader:lt.cube_vert,fragmentShader:lt.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:lt.equirect_vert,fragmentShader:lt.equirect_frag},distanceRGBA:{uniforms:si([He.common,He.displacementmap,{referencePosition:{value:new U},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:lt.distanceRGBA_vert,fragmentShader:lt.distanceRGBA_frag},shadow:{uniforms:si([He.lights,He.fog,{color:{value:new De(0)},opacity:{value:1}}]),vertexShader:lt.shadow_vert,fragmentShader:lt.shadow_frag}};Or.physical={uniforms:si([Or.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new _e(1,1)},clearcoatNormalMap:{value:null},sheen:{value:new De(0)},transmission:{value:0},transmissionMap:{value:null},transmissionSamplerSize:{value:new _e},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},attenuationDistance:{value:0},attenuationColor:{value:new De(0)}}]),vertexShader:lt.meshphysical_vert,fragmentShader:lt.meshphysical_frag};function NU(o,e,t,n,i){let r=new De(0),s=0,a,l,c=null,u=0,d=null;function h(p,g){let v=!1,y=g.isScene===!0?g.background:null;y&&y.isTexture&&(y=e.get(y));let m=o.xr,x=m.getSession&&m.getSession();x&&x.environmentBlendMode==="additive"&&(y=null),y===null?f(r,s):y&&y.isColor&&(f(y,1),v=!0),(o.autoClear||v)&&o.clear(o.autoClearColor,o.autoClearDepth,o.autoClearStencil),y&&(y.isCubeTexture||y.mapping===Vc)?(l===void 0&&(l=new et(new ao(1,1,1),new Fn({name:"BackgroundCubeMaterial",uniforms:ou(Or.cube.uniforms),vertexShader:Or.cube.vertexShader,fragmentShader:Or.cube.fragmentShader,side:Qt,depthTest:!1,depthWrite:!1,fog:!1})),l.geometry.deleteAttribute("normal"),l.geometry.deleteAttribute("uv"),l.onBeforeRender=function(_,w,b){this.matrixWorld.copyPosition(b.matrixWorld)},Object.defineProperty(l.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),n.update(l)),l.material.uniforms.envMap.value=y,l.material.uniforms.flipEnvMap.value=y.isCubeTexture&&y._needsFlipEnvMap?-1:1,(c!==y||u!==y.version||d!==o.toneMapping)&&(l.material.needsUpdate=!0,c=y,u=y.version,d=o.toneMapping),p.unshift(l,l.geometry,l.material,0,0,null)):y&&y.isTexture&&(a===void 0&&(a=new et(new Bi(2,2),new Fn({name:"BackgroundMaterial",uniforms:ou(Or.background.uniforms),vertexShader:Or.background.vertexShader,fragmentShader:Or.background.fragmentShader,side:Js,depthTest:!1,depthWrite:!1,fog:!1})),a.geometry.deleteAttribute("normal"),Object.defineProperty(a.material,"map",{get:function(){return this.uniforms.t2D.value}}),n.update(a)),a.material.uniforms.t2D.value=y,y.matrixAutoUpdate===!0&&y.updateMatrix(),a.material.uniforms.uvTransform.value.copy(y.matrix),(c!==y||u!==y.version||d!==o.toneMapping)&&(a.material.needsUpdate=!0,c=y,u=y.version,d=o.toneMapping),p.unshift(a,a.geometry,a.material,0,0,null))}function f(p,g){t.buffers.color.setClear(p.r,p.g,p.b,g,i)}return{getClearColor:function(){return r},setClearColor:function(p,g=1){r.set(p),s=g,f(r,s)},getClearAlpha:function(){return s},setClearAlpha:function(p){s=p,f(r,s)},render:h}}function OU(o,e,t,n){let i=o.getParameter(34921),r=n.isWebGL2?null:e.get("OES_vertex_array_object"),s=n.isWebGL2||r!==null,a={},l=g(null),c=l;function u(R,D,P,I,N){let G=!1;if(s){let z=p(I,P,D);c!==z&&(c=z,h(c.object)),G=v(I,N),G&&y(I,N)}else{let z=D.wireframe===!0;(c.geometry!==I.id||c.program!==P.id||c.wireframe!==z)&&(c.geometry=I.id,c.program=P.id,c.wireframe=z,G=!0)}R.isInstancedMesh===!0&&(G=!0),N!==null&&t.update(N,34963),G&&(M(R,D,P,I),N!==null&&o.bindBuffer(34963,t.get(N).buffer))}function d(){return n.isWebGL2?o.createVertexArray():r.createVertexArrayOES()}function h(R){return n.isWebGL2?o.bindVertexArray(R):r.bindVertexArrayOES(R)}function f(R){return n.isWebGL2?o.deleteVertexArray(R):r.deleteVertexArrayOES(R)}function p(R,D,P){let I=P.wireframe===!0,N=a[R.id];N===void 0&&(N={},a[R.id]=N);let G=N[D.id];G===void 0&&(G={},N[D.id]=G);let z=G[I];return z===void 0&&(z=g(d()),G[I]=z),z}function g(R){let D=[],P=[],I=[];for(let N=0;N<i;N++)D[N]=0,P[N]=0,I[N]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:D,enabledAttributes:P,attributeDivisors:I,object:R,attributes:{},index:null}}function v(R,D){let P=c.attributes,I=R.attributes,N=0;for(let G in I){let z=P[G],se=I[G];if(z===void 0||z.attribute!==se||z.data!==se.data)return!0;N++}return c.attributesNum!==N||c.index!==D}function y(R,D){let P={},I=R.attributes,N=0;for(let G in I){let z=I[G],se={};se.attribute=z,z.data&&(se.data=z.data),P[G]=se,N++}c.attributes=P,c.attributesNum=N,c.index=D}function m(){let R=c.newAttributes;for(let D=0,P=R.length;D<P;D++)R[D]=0}function x(R){_(R,0)}function _(R,D){let P=c.newAttributes,I=c.enabledAttributes,N=c.attributeDivisors;P[R]=1,I[R]===0&&(o.enableVertexAttribArray(R),I[R]=1),N[R]!==D&&((n.isWebGL2?o:e.get("ANGLE_instanced_arrays"))[n.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](R,D),N[R]=D)}function w(){let R=c.newAttributes,D=c.enabledAttributes;for(let P=0,I=D.length;P<I;P++)D[P]!==R[P]&&(o.disableVertexAttribArray(P),D[P]=0)}function b(R,D,P,I,N,G){n.isWebGL2===!0&&(P===5124||P===5125)?o.vertexAttribIPointer(R,D,P,N,G):o.vertexAttribPointer(R,D,P,I,N,G)}function M(R,D,P,I){if(n.isWebGL2===!1&&(R.isInstancedMesh||I.isInstancedBufferGeometry)&&e.get("ANGLE_instanced_arrays")===null)return;m();let N=I.attributes,G=P.getAttributes(),z=D.defaultAttributeValues;for(let se in G){let ne=G[se];if(ne>=0){let Q=N[se];if(Q!==void 0){let j=Q.normalized,O=Q.itemSize,ee=t.get(Q);if(ee===void 0)continue;let V=ee.buffer,ie=ee.type,ue=ee.bytesPerElement;if(Q.isInterleavedBufferAttribute){let ye=Q.data,pe=ye.stride,xe=Q.offset;ye&&ye.isInstancedInterleavedBuffer?(_(ne,ye.meshPerAttribute),I._maxInstanceCount===void 0&&(I._maxInstanceCount=ye.meshPerAttribute*ye.count)):x(ne),o.bindBuffer(34962,V),b(ne,O,ie,j,pe*ue,xe*ue)}else Q.isInstancedBufferAttribute?(_(ne,Q.meshPerAttribute),I._maxInstanceCount===void 0&&(I._maxInstanceCount=Q.meshPerAttribute*Q.count)):x(ne),o.bindBuffer(34962,V),b(ne,O,ie,j,0,0)}else if(se==="instanceMatrix"){let j=t.get(R.instanceMatrix);if(j===void 0)continue;let O=j.buffer,ee=j.type;_(ne+0,1),_(ne+1,1),_(ne+2,1),_(ne+3,1),o.bindBuffer(34962,O),o.vertexAttribPointer(ne+0,4,ee,!1,64,0),o.vertexAttribPointer(ne+1,4,ee,!1,64,16),o.vertexAttribPointer(ne+2,4,ee,!1,64,32),o.vertexAttribPointer(ne+3,4,ee,!1,64,48)}else if(se==="instanceColor"){let j=t.get(R.instanceColor);if(j===void 0)continue;let O=j.buffer,ee=j.type;_(ne,1),o.bindBuffer(34962,O),o.vertexAttribPointer(ne,3,ee,!1,12,0)}else if(z!==void 0){let j=z[se];if(j!==void 0)switch(j.length){case 2:o.vertexAttrib2fv(ne,j);break;case 3:o.vertexAttrib3fv(ne,j);break;case 4:o.vertexAttrib4fv(ne,j);break;default:o.vertexAttrib1fv(ne,j)}}}}w()}function S(){L();for(let R in a){let D=a[R];for(let P in D){let I=D[P];for(let N in I)f(I[N].object),delete I[N];delete D[P]}delete a[R]}}function E(R){if(a[R.id]===void 0)return;let D=a[R.id];for(let P in D){let I=D[P];for(let N in I)f(I[N].object),delete I[N];delete D[P]}delete a[R.id]}function A(R){for(let D in a){let P=a[D];if(P[R.id]===void 0)continue;let I=P[R.id];for(let N in I)f(I[N].object),delete I[N];delete P[R.id]}}function L(){B(),c!==l&&(c=l,h(c.object))}function B(){l.geometry=null,l.program=null,l.wireframe=!1}return{setup:u,reset:L,resetDefaultState:B,dispose:S,releaseStatesOfGeometry:E,releaseStatesOfProgram:A,initAttributes:m,enableAttribute:x,disableUnusedAttributes:w}}function kU(o,e,t,n){let i=n.isWebGL2,r;function s(c){r=c}function a(c,u){o.drawArrays(r,c,u),t.update(u,r,1)}function l(c,u,d){if(d===0)return;let h,f;if(i)h=o,f="drawArraysInstanced";else if(h=e.get("ANGLE_instanced_arrays"),f="drawArraysInstancedANGLE",h===null){console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}h[f](r,c,u,d),t.update(u,r,d)}this.setMode=s,this.render=a,this.renderInstances=l}function zU(o,e,t){let n;function i(){if(n!==void 0)return n;if(e.has("EXT_texture_filter_anisotropic")===!0){let M=e.get("EXT_texture_filter_anisotropic");n=o.getParameter(M.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else n=0;return n}function r(M){if(M==="highp"){if(o.getShaderPrecisionFormat(35633,36338).precision>0&&o.getShaderPrecisionFormat(35632,36338).precision>0)return"highp";M="mediump"}return M==="mediump"&&o.getShaderPrecisionFormat(35633,36337).precision>0&&o.getShaderPrecisionFormat(35632,36337).precision>0?"mediump":"lowp"}let s=typeof WebGL2RenderingContext!="undefined"&&o instanceof WebGL2RenderingContext||typeof WebGL2ComputeRenderingContext!="undefined"&&o instanceof WebGL2ComputeRenderingContext,a=t.precision!==void 0?t.precision:"highp",l=r(a);l!==a&&(console.warn("THREE.WebGLRenderer:",a,"not supported, using",l,"instead."),a=l);let c=s||e.has("WEBGL_draw_buffers"),u=t.logarithmicDepthBuffer===!0,d=o.getParameter(34930),h=o.getParameter(35660),f=o.getParameter(3379),p=o.getParameter(34076),g=o.getParameter(34921),v=o.getParameter(36347),y=o.getParameter(36348),m=o.getParameter(36349),x=h>0,_=s||e.has("OES_texture_float"),w=x&&_,b=s?o.getParameter(36183):0;return{isWebGL2:s,drawBuffers:c,getMaxAnisotropy:i,getMaxPrecision:r,precision:a,logarithmicDepthBuffer:u,maxTextures:d,maxVertexTextures:h,maxTextureSize:f,maxCubemapSize:p,maxAttributes:g,maxVertexUniforms:v,maxVaryings:y,maxFragmentUniforms:m,vertexTextures:x,floatFragmentTextures:_,floatVertexTextures:w,maxSamples:b}}function UU(o){let e=this,t=null,n=0,i=!1,r=!1,s=new hn,a=new vt,l={value:null,needsUpdate:!1};this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(d,h,f){let p=d.length!==0||h||n!==0||i;return i=h,t=u(d,f,0),n=d.length,p},this.beginShadows=function(){r=!0,u(null)},this.endShadows=function(){r=!1,c()},this.setState=function(d,h,f){let p=d.clippingPlanes,g=d.clipIntersection,v=d.clipShadows,y=o.get(d);if(!i||p===null||p.length===0||r&&!v)r?u(null):c();else{let m=r?0:n,x=m*4,_=y.clippingState||null;l.value=_,_=u(p,h,x,f);for(let w=0;w!==x;++w)_[w]=t[w];y.clippingState=_,this.numIntersection=g?this.numPlanes:0,this.numPlanes+=m}};function c(){l.value!==t&&(l.value=t,l.needsUpdate=n>0),e.numPlanes=n,e.numIntersection=0}function u(d,h,f,p){let g=d!==null?d.length:0,v=null;if(g!==0){if(v=l.value,p!==!0||v===null){let y=f+g*4,m=h.matrixWorldInverse;a.getNormalMatrix(m),(v===null||v.length<y)&&(v=new Float32Array(y));for(let x=0,_=f;x!==g;++x,_+=4)s.copy(d[x]).applyMatrix4(m,a),s.normal.toArray(v,_),v[_+3]=s.constant}l.value=v,l.needsUpdate=!0}return e.numPlanes=g,e.numIntersection=0,v}}function HU(o){let e=new WeakMap;function t(s,a){return a===Gc?s.mapping=jd:a===Ym&&(s.mapping=Yd),s}function n(s){if(s&&s.isTexture){let a=s.mapping;if(a===Gc||a===Ym)if(e.has(s)){let l=e.get(s).texture;return t(l,s.mapping)}else{let l=s.image;if(l&&l.height>0){let c=o.getRenderTarget(),u=new cf(l.height/2);return u.fromEquirectangularTexture(o,s),e.set(s,u),o.setRenderTarget(c),s.addEventListener("dispose",i),t(u.texture,s.mapping)}else return null}}return s}function i(s){let a=s.target;a.removeEventListener("dispose",i);let l=e.get(a);l!==void 0&&(e.delete(a),l.dispose())}function r(){e=new WeakMap}return{get:n,dispose:r}}function GU(o){let e={};function t(n){if(e[n]!==void 0)return e[n];let i;switch(n){case"WEBGL_depth_texture":i=o.getExtension("WEBGL_depth_texture")||o.getExtension("MOZ_WEBGL_depth_texture")||o.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":i=o.getExtension("EXT_texture_filter_anisotropic")||o.getExtension("MOZ_EXT_texture_filter_anisotropic")||o.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":i=o.getExtension("WEBGL_compressed_texture_s3tc")||o.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||o.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":i=o.getExtension("WEBGL_compressed_texture_pvrtc")||o.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:i=o.getExtension(n)}return e[n]=i,i}return{has:function(n){return t(n)!==null},init:function(n){n.isWebGL2?t("EXT_color_buffer_float"):(t("WEBGL_depth_texture"),t("OES_texture_float"),t("OES_texture_half_float"),t("OES_texture_half_float_linear"),t("OES_standard_derivatives"),t("OES_element_index_uint"),t("OES_vertex_array_object"),t("ANGLE_instanced_arrays")),t("OES_texture_float_linear"),t("EXT_color_buffer_half_float")},get:function(n){let i=t(n);return i===null&&console.warn("THREE.WebGLRenderer: "+n+" extension not supported."),i}}}function VU(o,e,t,n){let i={},r=new WeakMap;function s(d){let h=d.target;h.index!==null&&e.remove(h.index);for(let p in h.attributes)e.remove(h.attributes[p]);h.removeEventListener("dispose",s),delete i[h.id];let f=r.get(h);f&&(e.remove(f),r.delete(h)),n.releaseStatesOfGeometry(h),h.isInstancedBufferGeometry===!0&&delete h._maxInstanceCount,t.memory.geometries--}function a(d,h){return i[h.id]===!0||(h.addEventListener("dispose",s),i[h.id]=!0,t.memory.geometries++),h}function l(d){let h=d.attributes;for(let p in h)e.update(h[p],34962);let f=d.morphAttributes;for(let p in f){let g=f[p];for(let v=0,y=g.length;v<y;v++)e.update(g[v],34962)}}function c(d){let h=[],f=d.index,p=d.attributes.position,g=0;if(f!==null){let m=f.array;g=f.version;for(let x=0,_=m.length;x<_;x+=3){let w=m[x+0],b=m[x+1],M=m[x+2];h.push(w,b,b,M,M,w)}}else{let m=p.array;g=p.version;for(let x=0,_=m.length/3-1;x<_;x+=3){let w=x+0,b=x+1,M=x+2;h.push(w,b,b,M,M,w)}}let v=new(TA(h)>65535?of:Pl)(h,1);v.version=g;let y=r.get(d);y&&e.remove(y),r.set(d,v)}function u(d){let h=r.get(d);if(h){let f=d.index;f!==null&&h.version<f.version&&c(d)}else c(d);return r.get(d)}return{get:a,update:l,getWireframeAttribute:u}}function WU(o,e,t,n){let i=n.isWebGL2,r;function s(h){r=h}let a,l;function c(h){a=h.type,l=h.bytesPerElement}function u(h,f){o.drawElements(r,f,a,h*l),t.update(f,r,1)}function d(h,f,p){if(p===0)return;let g,v;if(i)g=o,v="drawElementsInstanced";else if(g=e.get("ANGLE_instanced_arrays"),v="drawElementsInstancedANGLE",g===null){console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}g[v](r,f,a,h*l,p),t.update(f,r,p)}this.setMode=s,this.setIndex=c,this.render=u,this.renderInstances=d}function XU(o){let e={geometries:0,textures:0},t={frame:0,calls:0,triangles:0,points:0,lines:0};function n(r,s,a){switch(t.calls++,s){case 4:t.triangles+=a*(r/3);break;case 1:t.lines+=a*(r/2);break;case 3:t.lines+=a*(r-1);break;case 2:t.lines+=a*r;break;case 0:t.points+=a*r;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",s);break}}function i(){t.frame++,t.calls=0,t.triangles=0,t.points=0,t.lines=0}return{memory:e,render:t,programs:null,autoReset:!0,reset:i,update:n}}function qU(o,e){return o[0]-e[0]}function jU(o,e){return Math.abs(e[1])-Math.abs(o[1])}function YU(o){let e={},t=new Float32Array(8),n=[];for(let r=0;r<8;r++)n[r]=[r,0];function i(r,s,a,l){let c=r.morphTargetInfluences,u=c===void 0?0:c.length,d=e[s.id];if(d===void 0||d.length!==u){d=[];for(let v=0;v<u;v++)d[v]=[v,0];e[s.id]=d}for(let v=0;v<u;v++){let y=d[v];y[0]=v,y[1]=c[v]}d.sort(jU);for(let v=0;v<8;v++)v<u&&d[v][1]?(n[v][0]=d[v][0],n[v][1]=d[v][1]):(n[v][0]=Number.MAX_SAFE_INTEGER,n[v][1]=0);n.sort(qU);let h=a.morphTargets&&s.morphAttributes.position,f=a.morphNormals&&s.morphAttributes.normal,p=0;for(let v=0;v<8;v++){let y=n[v],m=y[0],x=y[1];m!==Number.MAX_SAFE_INTEGER&&x?(h&&s.getAttribute("morphTarget"+v)!==h[m]&&s.setAttribute("morphTarget"+v,h[m]),f&&s.getAttribute("morphNormal"+v)!==f[m]&&s.setAttribute("morphNormal"+v,f[m]),t[v]=x,p+=x):(h&&s.hasAttribute("morphTarget"+v)===!0&&s.deleteAttribute("morphTarget"+v),f&&s.hasAttribute("morphNormal"+v)===!0&&s.deleteAttribute("morphNormal"+v),t[v]=0)}let g=s.morphTargetsRelative?1:1-p;l.getUniforms().setValue(o,"morphTargetBaseInfluence",g),l.getUniforms().setValue(o,"morphTargetInfluences",t)}return{update:i}}function ZU(o,e,t,n){let i=new WeakMap;function r(l){let c=n.render.frame,u=l.geometry,d=e.get(l,u);return i.get(d)!==c&&(e.update(d),i.set(d,c)),l.isInstancedMesh&&(l.hasEventListener("dispose",a)===!1&&l.addEventListener("dispose",a),t.update(l.instanceMatrix,34962),l.instanceColor!==null&&t.update(l.instanceColor,34962)),d}function s(){i=new WeakMap}function a(l){let c=l.target;c.removeEventListener("dispose",a),t.remove(c.instanceMatrix),c.instanceColor!==null&&t.remove(c.instanceColor)}return{update:r,dispose:s}}var wg=class extends Vt{constructor(e=null,t=1,n=1,i=1){super(null);this.image={data:e,width:t,height:n,depth:i},this.magFilter=ln,this.minFilter=ln,this.wrapR=an,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.needsUpdate=!0}};wg.prototype.isDataTexture2DArray=!0;var bg=class extends Vt{constructor(e=null,t=1,n=1,i=1){super(null);this.image={data:e,width:t,height:n,depth:i},this.magFilter=ln,this.minFilter=ln,this.wrapR=an,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.needsUpdate=!0}};bg.prototype.isDataTexture3D=!0;var CA=new Vt,JU=new wg,KU=new bg,LA=new Il,RA=[],PA=[],IA=new Float32Array(16),DA=new Float32Array(9),FA=new Float32Array(4);function du(o,e,t){let n=o[0];if(n<=0||n>0)return o;let i=e*t,r=RA[i];if(r===void 0&&(r=new Float32Array(i),RA[i]=r),e!==0){n.toArray(r,0);for(let s=1,a=0;s!==e;++s)a+=t,o[s].toArray(r,a)}return r}function bi(o,e){if(o.length!==e.length)return!1;for(let t=0,n=o.length;t<n;t++)if(o[t]!==e[t])return!1;return!0}function oi(o,e){for(let t=0,n=e.length;t<n;t++)o[t]=e[t]}function BA(o,e){let t=PA[e];t===void 0&&(t=new Int32Array(e),PA[e]=t);for(let n=0;n!==e;++n)t[n]=o.allocateTextureUnit();return t}function $U(o,e){let t=this.cache;t[0]!==e&&(o.uniform1f(this.addr,e),t[0]=e)}function QU(o,e){let t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(o.uniform2f(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(bi(t,e))return;o.uniform2fv(this.addr,e),oi(t,e)}}function eH(o,e){let t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(o.uniform3f(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else if(e.r!==void 0)(t[0]!==e.r||t[1]!==e.g||t[2]!==e.b)&&(o.uniform3f(this.addr,e.r,e.g,e.b),t[0]=e.r,t[1]=e.g,t[2]=e.b);else{if(bi(t,e))return;o.uniform3fv(this.addr,e),oi(t,e)}}function tH(o,e){let t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(o.uniform4f(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(bi(t,e))return;o.uniform4fv(this.addr,e),oi(t,e)}}function nH(o,e){let t=this.cache,n=e.elements;if(n===void 0){if(bi(t,e))return;o.uniformMatrix2fv(this.addr,!1,e),oi(t,e)}else{if(bi(t,n))return;FA.set(n),o.uniformMatrix2fv(this.addr,!1,FA),oi(t,n)}}function iH(o,e){let t=this.cache,n=e.elements;if(n===void 0){if(bi(t,e))return;o.uniformMatrix3fv(this.addr,!1,e),oi(t,e)}else{if(bi(t,n))return;DA.set(n),o.uniformMatrix3fv(this.addr,!1,DA),oi(t,n)}}function rH(o,e){let t=this.cache,n=e.elements;if(n===void 0){if(bi(t,e))return;o.uniformMatrix4fv(this.addr,!1,e),oi(t,e)}else{if(bi(t,n))return;IA.set(n),o.uniformMatrix4fv(this.addr,!1,IA),oi(t,n)}}function sH(o,e){let t=this.cache;t[0]!==e&&(o.uniform1i(this.addr,e),t[0]=e)}function oH(o,e){let t=this.cache;bi(t,e)||(o.uniform2iv(this.addr,e),oi(t,e))}function aH(o,e){let t=this.cache;bi(t,e)||(o.uniform3iv(this.addr,e),oi(t,e))}function lH(o,e){let t=this.cache;bi(t,e)||(o.uniform4iv(this.addr,e),oi(t,e))}function cH(o,e){let t=this.cache;t[0]!==e&&(o.uniform1ui(this.addr,e),t[0]=e)}function uH(o,e){let t=this.cache;bi(t,e)||(o.uniform2uiv(this.addr,e),oi(t,e))}function hH(o,e){let t=this.cache;bi(t,e)||(o.uniform3uiv(this.addr,e),oi(t,e))}function dH(o,e){let t=this.cache;bi(t,e)||(o.uniform4uiv(this.addr,e),oi(t,e))}function fH(o,e,t){let n=this.cache,i=t.allocateTextureUnit();n[0]!==i&&(o.uniform1i(this.addr,i),n[0]=i),t.safeSetTexture2D(e||CA,i)}function pH(o,e,t){let n=this.cache,i=t.allocateTextureUnit();n[0]!==i&&(o.uniform1i(this.addr,i),n[0]=i),t.setTexture3D(e||KU,i)}function mH(o,e,t){let n=this.cache,i=t.allocateTextureUnit();n[0]!==i&&(o.uniform1i(this.addr,i),n[0]=i),t.safeSetTextureCube(e||LA,i)}function gH(o,e,t){let n=this.cache,i=t.allocateTextureUnit();n[0]!==i&&(o.uniform1i(this.addr,i),n[0]=i),t.setTexture2DArray(e||JU,i)}function yH(o){switch(o){case 5126:return $U;case 35664:return QU;case 35665:return eH;case 35666:return tH;case 35674:return nH;case 35675:return iH;case 35676:return rH;case 5124:case 35670:return sH;case 35667:case 35671:return oH;case 35668:case 35672:return aH;case 35669:case 35673:return lH;case 5125:return cH;case 36294:return uH;case 36295:return hH;case 36296:return dH;case 35678:case 36198:case 36298:case 36306:case 35682:return fH;case 35679:case 36299:case 36307:return pH;case 35680:case 36300:case 36308:case 36293:return mH;case 36289:case 36303:case 36311:case 36292:return gH}}function vH(o,e){o.uniform1fv(this.addr,e)}function xH(o,e){let t=du(e,this.size,2);o.uniform2fv(this.addr,t)}function _H(o,e){let t=du(e,this.size,3);o.uniform3fv(this.addr,t)}function wH(o,e){let t=du(e,this.size,4);o.uniform4fv(this.addr,t)}function bH(o,e){let t=du(e,this.size,4);o.uniformMatrix2fv(this.addr,!1,t)}function MH(o,e){let t=du(e,this.size,9);o.uniformMatrix3fv(this.addr,!1,t)}function SH(o,e){let t=du(e,this.size,16);o.uniformMatrix4fv(this.addr,!1,t)}function TH(o,e){o.uniform1iv(this.addr,e)}function EH(o,e){o.uniform2iv(this.addr,e)}function AH(o,e){o.uniform3iv(this.addr,e)}function CH(o,e){o.uniform4iv(this.addr,e)}function LH(o,e){o.uniform1uiv(this.addr,e)}function RH(o,e){o.uniform2uiv(this.addr,e)}function PH(o,e){o.uniform3uiv(this.addr,e)}function IH(o,e){o.uniform4uiv(this.addr,e)}function DH(o,e,t){let n=e.length,i=BA(t,n);o.uniform1iv(this.addr,i);for(let r=0;r!==n;++r)t.safeSetTexture2D(e[r]||CA,i[r])}function FH(o,e,t){let n=e.length,i=BA(t,n);o.uniform1iv(this.addr,i);for(let r=0;r!==n;++r)t.safeSetTextureCube(e[r]||LA,i[r])}function BH(o){switch(o){case 5126:return vH;case 35664:return xH;case 35665:return _H;case 35666:return wH;case 35674:return bH;case 35675:return MH;case 35676:return SH;case 5124:case 35670:return TH;case 35667:case 35671:return EH;case 35668:case 35672:return AH;case 35669:case 35673:return CH;case 5125:return LH;case 36294:return RH;case 36295:return PH;case 36296:return IH;case 35678:case 36198:case 36298:case 36306:case 35682:return DH;case 35680:case 36300:case 36308:case 36293:return FH}}function NH(o,e,t){this.id=o,this.addr=t,this.cache=[],this.setValue=yH(e.type)}function NA(o,e,t){this.id=o,this.addr=t,this.cache=[],this.size=e.size,this.setValue=BH(e.type)}NA.prototype.updateCache=function(o){let e=this.cache;o instanceof Float32Array&&e.length!==o.length&&(this.cache=new Float32Array(o.length)),oi(e,o)};function OA(o){this.id=o,this.seq=[],this.map={}}OA.prototype.setValue=function(o,e,t){let n=this.seq;for(let i=0,r=n.length;i!==r;++i){let s=n[i];s.setValue(o,e[s.id],t)}};var V_=/(\w+)(\])?(\[|\.)?/g;function kA(o,e){o.seq.push(e),o.map[e.id]=e}function OH(o,e,t){let n=o.name,i=n.length;for(V_.lastIndex=0;;){let r=V_.exec(n),s=V_.lastIndex,a=r[1],l=r[2]==="]",c=r[3];if(l&&(a=a|0),c===void 0||c==="["&&s+2===i){kA(t,c===void 0?new NH(a,o,e):new NA(a,o,e));break}else{let d=t.map[a];d===void 0&&(d=new OA(a),kA(t,d)),t=d}}}function oa(o,e){this.seq=[],this.map={};let t=o.getProgramParameter(e,35718);for(let n=0;n<t;++n){let i=o.getActiveUniform(e,n),r=o.getUniformLocation(e,i.name);OH(i,r,this)}}oa.prototype.setValue=function(o,e,t,n){let i=this.map[e];i!==void 0&&i.setValue(o,t,n)};oa.prototype.setOptional=function(o,e,t){let n=e[t];n!==void 0&&this.setValue(o,t,n)};oa.upload=function(o,e,t,n){for(let i=0,r=e.length;i!==r;++i){let s=e[i],a=t[s.id];a.needsUpdate!==!1&&s.setValue(o,a.value,n)}};oa.seqWithValue=function(o,e){let t=[];for(let n=0,i=o.length;n!==i;++n){let r=o[n];r.id in e&&t.push(r)}return t};function zA(o,e,t){let n=o.createShader(e);return o.shaderSource(n,t),o.compileShader(n),n}var kH=0;function zH(o){let e=o.split(`
`);for(let t=0;t<e.length;t++)e[t]=t+1+": "+e[t];return e.join(`
`)}function UA(o){switch(o){case Xn:return["Linear","( value )"];case Vi:return["sRGB","( value )"];case Qm:return["RGBE","( value )"];case o_:return["RGBM","( value, 7.0 )"];case a_:return["RGBM","( value, 16.0 )"];case l_:return["RGBD","( value, 256.0 )"];case $m:return["Gamma","( value, float( GAMMA_FACTOR ) )"];case aA:return["LogLuv","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported encoding:",o),["Linear","( value )"]}}function HA(o,e,t){let n=o.getShaderParameter(e,35713),i=o.getShaderInfoLog(e).trim();if(n&&i==="")return"";let r=o.getShaderSource(e);return"THREE.WebGLShader: gl.getShaderInfoLog() "+t+`
`+i+zH(r)}function uf(o,e){let t=UA(e);return"vec4 "+o+"( vec4 value ) { return "+t[0]+"ToLinear"+t[1]+"; }"}function UH(o,e){let t=UA(e);return"vec4 "+o+"( vec4 value ) { return LinearTo"+t[0]+t[1]+"; }"}function HH(o,e){let t;switch(e){case oE:t="Linear";break;case aE:t="Reinhard";break;case lE:t="OptimizedCineon";break;case cE:t="ACESFilmic";break;case uE:t="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",e),t="Linear"}return"vec3 "+o+"( vec3 color ) { return "+t+"ToneMapping( color ); }"}function GH(o){return[o.extensionDerivatives||o.envMapCubeUV||o.bumpMap||o.tangentSpaceNormalMap||o.clearcoatNormalMap||o.flatShading||o.shaderID==="physical"?"#extension GL_OES_standard_derivatives : enable":"",(o.extensionFragDepth||o.logarithmicDepthBuffer)&&o.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",o.extensionDrawBuffers&&o.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(o.extensionShaderTextureLOD||o.envMap||o.transmission>0)&&o.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(hf).join(`
`)}function VH(o){let e=[];for(let t in o){let n=o[t];n!==!1&&e.push("#define "+t+" "+n)}return e.join(`
`)}function WH(o,e){let t={},n=o.getProgramParameter(e,35721);for(let i=0;i<n;i++){let s=o.getActiveAttrib(e,i).name;t[s]=o.getAttribLocation(e,s)}return t}function hf(o){return o!==""}function GA(o,e){return o.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function VA(o,e){return o.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}var XH=/^[ \t]*#include +<([\w\d./]+)>/gm;function W_(o){return o.replace(XH,qH)}function qH(o,e){let t=lt[e];if(t===void 0)throw new Error("Can not resolve #include <"+e+">");return W_(t)}var jH=/#pragma unroll_loop[\s]+?for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g,YH=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function WA(o){return o.replace(YH,XA).replace(jH,ZH)}function ZH(o,e,t,n){return console.warn("WebGLProgram: #pragma unroll_loop shader syntax is deprecated. Please use #pragma unroll_loop_start syntax instead."),XA(o,e,t,n)}function XA(o,e,t,n){let i="";for(let r=parseInt(e);r<parseInt(t);r++)i+=n.replace(/\[\s*i\s*\]/g,"[ "+r+" ]").replace(/UNROLLED_LOOP_INDEX/g,r);return i}function qA(o){let e="precision "+o.precision+` float;
precision `+o.precision+" int;";return o.precision==="highp"?e+=`
#define HIGH_PRECISION`:o.precision==="mediump"?e+=`
#define MEDIUM_PRECISION`:o.precision==="lowp"&&(e+=`
#define LOW_PRECISION`),e}function JH(o){let e="SHADOWMAP_TYPE_BASIC";return o.shadowMapType===zx?e="SHADOWMAP_TYPE_PCF":o.shadowMapType===Xm?e="SHADOWMAP_TYPE_PCF_SOFT":o.shadowMapType===Uc&&(e="SHADOWMAP_TYPE_VSM"),e}function KH(o){let e="ENVMAP_TYPE_CUBE";if(o.envMap)switch(o.envMapMode){case jd:case Yd:e="ENVMAP_TYPE_CUBE";break;case Vc:case Zd:e="ENVMAP_TYPE_CUBE_UV";break}return e}function $H(o){let e="ENVMAP_MODE_REFLECTION";if(o.envMap)switch(o.envMapMode){case Yd:case Zd:e="ENVMAP_MODE_REFRACTION";break}return e}function QH(o){let e="ENVMAP_BLENDING_NONE";if(o.envMap)switch(o.combine){case qd:e="ENVMAP_BLENDING_MULTIPLY";break;case rE:e="ENVMAP_BLENDING_MIX";break;case sE:e="ENVMAP_BLENDING_ADD";break}return e}function e4(o,e,t,n){let i=o.getContext(),r=t.defines,s=t.vertexShader,a=t.fragmentShader,l=JH(t),c=KH(t),u=$H(t),d=QH(t),h=o.gammaFactor>0?o.gammaFactor:1,f=t.isWebGL2?"":GH(t),p=VH(r),g=i.createProgram(),v,y,m=t.glslVersion?"#version "+t.glslVersion+`
`:"";t.isRawShaderMaterial?(v=[p].filter(hf).join(`
`),v.length>0&&(v+=`
`),y=[f,p].filter(hf).join(`
`),y.length>0&&(y+=`
`)):(v=[qA(t),"#define SHADER_NAME "+t.shaderName,p,t.instancing?"#define USE_INSTANCING":"",t.instancingColor?"#define USE_INSTANCING_COLOR":"",t.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define GAMMA_FACTOR "+h,"#define MAX_BONES "+t.maxBones,t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.map?"#define USE_MAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+u:"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMap&&t.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",t.normalMap&&t.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.displacementMap&&t.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.vertexTangents?"#define USE_TANGENT":"",t.vertexColors?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUvs?"#define USE_UV":"",t.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",t.flatShading?"#define FLAT_SHADED":"",t.skinning?"#define USE_SKINNING":"",t.useVertexTexture?"#define BONE_TEXTURE":"",t.morphTargets?"#define USE_MORPHTARGETS":"",t.morphNormals&&t.flatShading===!1?"#define USE_MORPHNORMALS":"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+l:"",t.sizeAttenuation?"#define USE_SIZEATTENUATION":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",t.logarithmicDepthBuffer&&t.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","	attribute vec3 morphTarget0;","	attribute vec3 morphTarget1;","	attribute vec3 morphTarget2;","	attribute vec3 morphTarget3;","	#ifdef USE_MORPHNORMALS","		attribute vec3 morphNormal0;","		attribute vec3 morphNormal1;","		attribute vec3 morphNormal2;","		attribute vec3 morphNormal3;","	#else","		attribute vec3 morphTarget4;","		attribute vec3 morphTarget5;","		attribute vec3 morphTarget6;","		attribute vec3 morphTarget7;","	#endif","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(hf).join(`
`),y=[f,qA(t),"#define SHADER_NAME "+t.shaderName,p,t.alphaTest?"#define ALPHATEST "+t.alphaTest+(t.alphaTest%1?"":".0"):"","#define GAMMA_FACTOR "+h,t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.map?"#define USE_MAP":"",t.matcap?"#define USE_MATCAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+c:"",t.envMap?"#define "+u:"",t.envMap?"#define "+d:"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMap&&t.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",t.normalMap&&t.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.sheen?"#define USE_SHEEN":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.vertexTangents?"#define USE_TANGENT":"",t.vertexColors||t.instancingColor?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUvs?"#define USE_UV":"",t.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",t.gradientMap?"#define USE_GRADIENTMAP":"",t.flatShading?"#define FLAT_SHADED":"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+l:"",t.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",t.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",t.logarithmicDepthBuffer&&t.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"",(t.extensionShaderTextureLOD||t.envMap)&&t.rendererExtensionShaderTextureLod?"#define TEXTURE_LOD_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",t.toneMapping!==Zo?"#define TONE_MAPPING":"",t.toneMapping!==Zo?lt.tonemapping_pars_fragment:"",t.toneMapping!==Zo?HH("toneMapping",t.toneMapping):"",t.dithering?"#define DITHERING":"",lt.encodings_pars_fragment,t.map?uf("mapTexelToLinear",t.mapEncoding):"",t.matcap?uf("matcapTexelToLinear",t.matcapEncoding):"",t.envMap?uf("envMapTexelToLinear",t.envMapEncoding):"",t.emissiveMap?uf("emissiveMapTexelToLinear",t.emissiveMapEncoding):"",t.lightMap?uf("lightMapTexelToLinear",t.lightMapEncoding):"",UH("linearToOutputTexel",t.outputEncoding),t.depthPacking?"#define DEPTH_PACKING "+t.depthPacking:"",`
`].filter(hf).join(`
`)),s=W_(s),s=GA(s,t),s=VA(s,t),a=W_(a),a=GA(a,t),a=VA(a,t),s=WA(s),a=WA(a),t.isWebGL2&&t.isRawShaderMaterial!==!0&&(m=`#version 300 es
`,v=["#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+v,y=["#define varying in",t.glslVersion===c_?"":"out highp vec4 pc_fragColor;",t.glslVersion===c_?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+y);let x=m+v+s,_=m+y+a,w=zA(i,35633,x),b=zA(i,35632,_);if(i.attachShader(g,w),i.attachShader(g,b),t.index0AttributeName!==void 0?i.bindAttribLocation(g,0,t.index0AttributeName):t.morphTargets===!0&&i.bindAttribLocation(g,0,"position"),i.linkProgram(g),o.debug.checkShaderErrors){let E=i.getProgramInfoLog(g).trim(),A=i.getShaderInfoLog(w).trim(),L=i.getShaderInfoLog(b).trim(),B=!0,R=!0;if(i.getProgramParameter(g,35714)===!1){B=!1;let D=HA(i,w,"vertex"),P=HA(i,b,"fragment");console.error("THREE.WebGLProgram: shader error: ",i.getError(),"35715",i.getProgramParameter(g,35715),"gl.getProgramInfoLog",E,D,P)}else E!==""?console.warn("THREE.WebGLProgram: gl.getProgramInfoLog()",E):(A===""||L==="")&&(R=!1);R&&(this.diagnostics={runnable:B,programLog:E,vertexShader:{log:A,prefix:v},fragmentShader:{log:L,prefix:y}})}i.deleteShader(w),i.deleteShader(b);let M;this.getUniforms=function(){return M===void 0&&(M=new oa(i,g)),M};let S;return this.getAttributes=function(){return S===void 0&&(S=WH(i,g)),S},this.destroy=function(){n.releaseStatesOfProgram(this),i.deleteProgram(g),this.program=void 0},this.name=t.shaderName,this.id=kH++,this.cacheKey=e,this.usedTimes=1,this.program=g,this.vertexShader=w,this.fragmentShader=b,this}function t4(o,e,t,n,i,r){let s=[],a=n.isWebGL2,l=n.logarithmicDepthBuffer,c=n.floatVertexTextures,u=n.maxVertexUniforms,d=n.vertexTextures,h=n.precision,f={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"},p=["precision","isWebGL2","supportsVertexTextures","outputEncoding","instancing","instancingColor","map","mapEncoding","matcap","matcapEncoding","envMap","envMapMode","envMapEncoding","envMapCubeUV","lightMap","lightMapEncoding","aoMap","emissiveMap","emissiveMapEncoding","bumpMap","normalMap","objectSpaceNormalMap","tangentSpaceNormalMap","clearcoatMap","clearcoatRoughnessMap","clearcoatNormalMap","displacementMap","specularMap","roughnessMap","metalnessMap","gradientMap","alphaMap","combine","vertexColors","vertexAlphas","vertexTangents","vertexUvs","uvsVertexOnly","fog","useFog","fogExp2","flatShading","sizeAttenuation","logarithmicDepthBuffer","skinning","maxBones","useVertexTexture","morphTargets","morphNormals","premultipliedAlpha","numDirLights","numPointLights","numSpotLights","numHemiLights","numRectAreaLights","numDirLightShadows","numPointLightShadows","numSpotLightShadows","shadowMapEnabled","shadowMapType","toneMapping","physicallyCorrectLights","alphaTest","doubleSided","flipSided","numClippingPlanes","numClipIntersection","depthPacking","dithering","sheen","transmission","transmissionMap","thicknessMap"];function g(b){let S=b.skeleton.bones;if(c)return 1024;{let A=Math.floor((u-20)/4),L=Math.min(A,S.length);return L<S.length?(console.warn("THREE.WebGLRenderer: Skeleton has "+S.length+" bones. This GPU supports "+L+"."),0):L}}function v(b){let M;return b&&b.isTexture?M=b.encoding:b&&b.isWebGLRenderTarget?(console.warn("THREE.WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead."),M=b.texture.encoding):M=Xn,M}function y(b,M,S,E,A){let L=E.fog,B=b.isMeshStandardMaterial?E.environment:null,R=e.get(b.envMap||B),D=f[b.type],P=A.isSkinnedMesh?g(A):0;b.precision!==null&&(h=n.getMaxPrecision(b.precision),h!==b.precision&&console.warn("THREE.WebGLProgram.getParameters:",b.precision,"not supported, using",h,"instead."));let I,N;if(D){let se=Or[D];I=se.vertexShader,N=se.fragmentShader}else I=b.vertexShader,N=b.fragmentShader;let G=o.getRenderTarget();return{isWebGL2:a,shaderID:D,shaderName:b.type,vertexShader:I,fragmentShader:N,defines:b.defines,isRawShaderMaterial:b.isRawShaderMaterial===!0,glslVersion:b.glslVersion,precision:h,instancing:A.isInstancedMesh===!0,instancingColor:A.isInstancedMesh===!0&&A.instanceColor!==null,supportsVertexTextures:d,outputEncoding:G!==null?v(G.texture):o.outputEncoding,map:!!b.map,mapEncoding:v(b.map),matcap:!!b.matcap,matcapEncoding:v(b.matcap),envMap:!!R,envMapMode:R&&R.mapping,envMapEncoding:v(R),envMapCubeUV:!!R&&(R.mapping===Vc||R.mapping===Zd),lightMap:!!b.lightMap,lightMapEncoding:v(b.lightMap),aoMap:!!b.aoMap,emissiveMap:!!b.emissiveMap,emissiveMapEncoding:v(b.emissiveMap),bumpMap:!!b.bumpMap,normalMap:!!b.normalMap,objectSpaceNormalMap:b.normalMapType===uA,tangentSpaceNormalMap:b.normalMapType===Qs,clearcoatMap:!!b.clearcoatMap,clearcoatRoughnessMap:!!b.clearcoatRoughnessMap,clearcoatNormalMap:!!b.clearcoatNormalMap,displacementMap:!!b.displacementMap,roughnessMap:!!b.roughnessMap,metalnessMap:!!b.metalnessMap,specularMap:!!b.specularMap,alphaMap:!!b.alphaMap,gradientMap:!!b.gradientMap,sheen:!!b.sheen,transmission:!!b.transmission,transmissionMap:!!b.transmissionMap,thicknessMap:!!b.thicknessMap,combine:b.combine,vertexTangents:b.normalMap&&b.vertexTangents,vertexColors:b.vertexColors,vertexAlphas:b.vertexColors===!0&&A.geometry&&A.geometry.attributes.color&&A.geometry.attributes.color.itemSize===4,vertexUvs:!!b.map||!!b.bumpMap||!!b.normalMap||!!b.specularMap||!!b.alphaMap||!!b.emissiveMap||!!b.roughnessMap||!!b.metalnessMap||!!b.clearcoatMap||!!b.clearcoatRoughnessMap||!!b.clearcoatNormalMap||!!b.displacementMap||!!b.transmissionMap||!!b.thicknessMap,uvsVertexOnly:!(!!b.map||!!b.bumpMap||!!b.normalMap||!!b.specularMap||!!b.alphaMap||!!b.emissiveMap||!!b.roughnessMap||!!b.metalnessMap||!!b.clearcoatNormalMap||!!b.transmission||!!b.transmissionMap||!!b.thicknessMap)&&!!b.displacementMap,fog:!!L,useFog:b.fog,fogExp2:L&&L.isFogExp2,flatShading:!!b.flatShading,sizeAttenuation:b.sizeAttenuation,logarithmicDepthBuffer:l,skinning:A.isSkinnedMesh===!0&&P>0,maxBones:P,useVertexTexture:c,morphTargets:b.morphTargets,morphNormals:b.morphNormals,numDirLights:M.directional.length,numPointLights:M.point.length,numSpotLights:M.spot.length,numRectAreaLights:M.rectArea.length,numHemiLights:M.hemi.length,numDirLightShadows:M.directionalShadowMap.length,numPointLightShadows:M.pointShadowMap.length,numSpotLightShadows:M.spotShadowMap.length,numClippingPlanes:r.numPlanes,numClipIntersection:r.numIntersection,dithering:b.dithering,shadowMapEnabled:o.shadowMap.enabled&&S.length>0,shadowMapType:o.shadowMap.type,toneMapping:b.toneMapped?o.toneMapping:Zo,physicallyCorrectLights:o.physicallyCorrectLights,premultipliedAlpha:b.premultipliedAlpha,alphaTest:b.alphaTest,doubleSided:b.side===Dr,flipSided:b.side===Qt,depthPacking:b.depthPacking!==void 0?b.depthPacking:!1,index0AttributeName:b.index0AttributeName,extensionDerivatives:b.extensions&&b.extensions.derivatives,extensionFragDepth:b.extensions&&b.extensions.fragDepth,extensionDrawBuffers:b.extensions&&b.extensions.drawBuffers,extensionShaderTextureLOD:b.extensions&&b.extensions.shaderTextureLOD,rendererExtensionFragDepth:a||t.has("EXT_frag_depth"),rendererExtensionDrawBuffers:a||t.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:a||t.has("EXT_shader_texture_lod"),customProgramCacheKey:b.customProgramCacheKey()}}function m(b){let M=[];if(b.shaderID?M.push(b.shaderID):(M.push(b.fragmentShader),M.push(b.vertexShader)),b.defines!==void 0)for(let S in b.defines)M.push(S),M.push(b.defines[S]);if(b.isRawShaderMaterial===!1){for(let S=0;S<p.length;S++)M.push(b[p[S]]);M.push(o.outputEncoding),M.push(o.gammaFactor)}return M.push(b.customProgramCacheKey),M.join()}function x(b){let M=f[b.type],S;if(M){let E=Or[M];S=sa.clone(E.uniforms)}else S=b.uniforms;return S}function _(b,M){let S;for(let E=0,A=s.length;E<A;E++){let L=s[E];if(L.cacheKey===M){S=L,++S.usedTimes;break}}return S===void 0&&(S=new e4(o,M,b,i),s.push(S)),S}function w(b){if(--b.usedTimes==0){let M=s.indexOf(b);s[M]=s[s.length-1],s.pop(),b.destroy()}}return{getParameters:y,getProgramCacheKey:m,getUniforms:x,acquireProgram:_,releaseProgram:w,programs:s}}function n4(){let o=new WeakMap;function e(r){let s=o.get(r);return s===void 0&&(s={},o.set(r,s)),s}function t(r){o.delete(r)}function n(r,s,a){o.get(r)[s]=a}function i(){o=new WeakMap}return{get:e,remove:t,update:n,dispose:i}}function i4(o,e){return o.groupOrder!==e.groupOrder?o.groupOrder-e.groupOrder:o.renderOrder!==e.renderOrder?o.renderOrder-e.renderOrder:o.program!==e.program?o.program.id-e.program.id:o.material.id!==e.material.id?o.material.id-e.material.id:o.z!==e.z?o.z-e.z:o.id-e.id}function jA(o,e){return o.groupOrder!==e.groupOrder?o.groupOrder-e.groupOrder:o.renderOrder!==e.renderOrder?o.renderOrder-e.renderOrder:o.z!==e.z?e.z-o.z:o.id-e.id}function YA(o){let e=[],t=0,n=[],i=[],r=[],s={id:-1};function a(){t=0,n.length=0,i.length=0,r.length=0}function l(f,p,g,v,y,m){let x=e[t],_=o.get(g);return x===void 0?(x={id:f.id,object:f,geometry:p,material:g,program:_.program||s,groupOrder:v,renderOrder:f.renderOrder,z:y,group:m},e[t]=x):(x.id=f.id,x.object=f,x.geometry=p,x.material=g,x.program=_.program||s,x.groupOrder=v,x.renderOrder=f.renderOrder,x.z=y,x.group=m),t++,x}function c(f,p,g,v,y,m){let x=l(f,p,g,v,y,m);g.transmission>0?i.push(x):g.transparent===!0?r.push(x):n.push(x)}function u(f,p,g,v,y,m){let x=l(f,p,g,v,y,m);g.transmission>0?i.unshift(x):g.transparent===!0?r.unshift(x):n.unshift(x)}function d(f,p){n.length>1&&n.sort(f||i4),i.length>1&&i.sort(p||jA),r.length>1&&r.sort(p||jA)}function h(){for(let f=t,p=e.length;f<p;f++){let g=e[f];if(g.id===null)break;g.id=null,g.object=null,g.geometry=null,g.material=null,g.program=null,g.group=null}}return{opaque:n,transmissive:i,transparent:r,init:a,push:c,unshift:u,finish:h,sort:d}}function r4(o){let e=new WeakMap;function t(i,r){let s;return e.has(i)===!1?(s=new YA(o),e.set(i,[s])):r>=e.get(i).length?(s=new YA(o),e.get(i).push(s)):s=e.get(i)[r],s}function n(){e=new WeakMap}return{get:t,dispose:n}}function s4(){let o={};return{get:function(e){if(o[e.id]!==void 0)return o[e.id];let t;switch(e.type){case"DirectionalLight":t={direction:new U,color:new De};break;case"SpotLight":t={position:new U,direction:new U,color:new De,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":t={position:new U,color:new De,distance:0,decay:0};break;case"HemisphereLight":t={direction:new U,skyColor:new De,groundColor:new De};break;case"RectAreaLight":t={color:new De,position:new U,halfWidth:new U,halfHeight:new U};break}return o[e.id]=t,t}}}function o4(){let o={};return{get:function(e){if(o[e.id]!==void 0)return o[e.id];let t;switch(e.type){case"DirectionalLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new _e};break;case"SpotLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new _e};break;case"PointLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new _e,shadowCameraNear:1,shadowCameraFar:1e3};break}return o[e.id]=t,t}}}var a4=0;function l4(o,e){return(e.castShadow?1:0)-(o.castShadow?1:0)}function c4(o,e){let t=new s4,n=o4(),i={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadow:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[]};for(let u=0;u<9;u++)i.probe.push(new U);let r=new U,s=new Pe,a=new Pe;function l(u){let d=0,h=0,f=0;for(let M=0;M<9;M++)i.probe[M].set(0,0,0);let p=0,g=0,v=0,y=0,m=0,x=0,_=0,w=0;u.sort(l4);for(let M=0,S=u.length;M<S;M++){let E=u[M],A=E.color,L=E.intensity,B=E.distance,R=E.shadow&&E.shadow.map?E.shadow.map.texture:null;if(E.isAmbientLight)d+=A.r*L,h+=A.g*L,f+=A.b*L;else if(E.isLightProbe)for(let D=0;D<9;D++)i.probe[D].addScaledVector(E.sh.coefficients[D],L);else if(E.isDirectionalLight){let D=t.get(E);if(D.color.copy(E.color).multiplyScalar(E.intensity),E.castShadow){let P=E.shadow,I=n.get(E);I.shadowBias=P.bias,I.shadowNormalBias=P.normalBias,I.shadowRadius=P.radius,I.shadowMapSize=P.mapSize,i.directionalShadow[p]=I,i.directionalShadowMap[p]=R,i.directionalShadowMatrix[p]=E.shadow.matrix,x++}i.directional[p]=D,p++}else if(E.isSpotLight){let D=t.get(E);if(D.position.setFromMatrixPosition(E.matrixWorld),D.color.copy(A).multiplyScalar(L),D.distance=B,D.coneCos=Math.cos(E.angle),D.penumbraCos=Math.cos(E.angle*(1-E.penumbra)),D.decay=E.decay,E.castShadow){let P=E.shadow,I=n.get(E);I.shadowBias=P.bias,I.shadowNormalBias=P.normalBias,I.shadowRadius=P.radius,I.shadowMapSize=P.mapSize,i.spotShadow[v]=I,i.spotShadowMap[v]=R,i.spotShadowMatrix[v]=E.shadow.matrix,w++}i.spot[v]=D,v++}else if(E.isRectAreaLight){let D=t.get(E);D.color.copy(A).multiplyScalar(L),D.halfWidth.set(E.width*.5,0,0),D.halfHeight.set(0,E.height*.5,0),i.rectArea[y]=D,y++}else if(E.isPointLight){let D=t.get(E);if(D.color.copy(E.color).multiplyScalar(E.intensity),D.distance=E.distance,D.decay=E.decay,E.castShadow){let P=E.shadow,I=n.get(E);I.shadowBias=P.bias,I.shadowNormalBias=P.normalBias,I.shadowRadius=P.radius,I.shadowMapSize=P.mapSize,I.shadowCameraNear=P.camera.near,I.shadowCameraFar=P.camera.far,i.pointShadow[g]=I,i.pointShadowMap[g]=R,i.pointShadowMatrix[g]=E.shadow.matrix,_++}i.point[g]=D,g++}else if(E.isHemisphereLight){let D=t.get(E);D.skyColor.copy(E.color).multiplyScalar(L),D.groundColor.copy(E.groundColor).multiplyScalar(L),i.hemi[m]=D,m++}}y>0&&(e.isWebGL2||o.has("OES_texture_float_linear")===!0?(i.rectAreaLTC1=He.LTC_FLOAT_1,i.rectAreaLTC2=He.LTC_FLOAT_2):o.has("OES_texture_half_float_linear")===!0?(i.rectAreaLTC1=He.LTC_HALF_1,i.rectAreaLTC2=He.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),i.ambient[0]=d,i.ambient[1]=h,i.ambient[2]=f;let b=i.hash;(b.directionalLength!==p||b.pointLength!==g||b.spotLength!==v||b.rectAreaLength!==y||b.hemiLength!==m||b.numDirectionalShadows!==x||b.numPointShadows!==_||b.numSpotShadows!==w)&&(i.directional.length=p,i.spot.length=v,i.rectArea.length=y,i.point.length=g,i.hemi.length=m,i.directionalShadow.length=x,i.directionalShadowMap.length=x,i.pointShadow.length=_,i.pointShadowMap.length=_,i.spotShadow.length=w,i.spotShadowMap.length=w,i.directionalShadowMatrix.length=x,i.pointShadowMatrix.length=_,i.spotShadowMatrix.length=w,b.directionalLength=p,b.pointLength=g,b.spotLength=v,b.rectAreaLength=y,b.hemiLength=m,b.numDirectionalShadows=x,b.numPointShadows=_,b.numSpotShadows=w,i.version=a4++)}function c(u,d){let h=0,f=0,p=0,g=0,v=0,y=d.matrixWorldInverse;for(let m=0,x=u.length;m<x;m++){let _=u[m];if(_.isDirectionalLight){let w=i.directional[h];w.direction.setFromMatrixPosition(_.matrixWorld),r.setFromMatrixPosition(_.target.matrixWorld),w.direction.sub(r),w.direction.transformDirection(y),h++}else if(_.isSpotLight){let w=i.spot[p];w.position.setFromMatrixPosition(_.matrixWorld),w.position.applyMatrix4(y),w.direction.setFromMatrixPosition(_.matrixWorld),r.setFromMatrixPosition(_.target.matrixWorld),w.direction.sub(r),w.direction.transformDirection(y),p++}else if(_.isRectAreaLight){let w=i.rectArea[g];w.position.setFromMatrixPosition(_.matrixWorld),w.position.applyMatrix4(y),a.identity(),s.copy(_.matrixWorld),s.premultiply(y),a.extractRotation(s),w.halfWidth.set(_.width*.5,0,0),w.halfHeight.set(0,_.height*.5,0),w.halfWidth.applyMatrix4(a),w.halfHeight.applyMatrix4(a),g++}else if(_.isPointLight){let w=i.point[f];w.position.setFromMatrixPosition(_.matrixWorld),w.position.applyMatrix4(y),f++}else if(_.isHemisphereLight){let w=i.hemi[v];w.direction.setFromMatrixPosition(_.matrixWorld),w.direction.transformDirection(y),w.direction.normalize(),v++}}}return{setup:l,setupView:c,state:i}}function ZA(o,e){let t=new c4(o,e),n=[],i=[];function r(){n.length=0,i.length=0}function s(d){n.push(d)}function a(d){i.push(d)}function l(){t.setup(n)}function c(d){t.setupView(n,d)}return{init:r,state:{lightsArray:n,shadowsArray:i,lights:t},setupLights:l,setupLightsView:c,pushLight:s,pushShadow:a}}function u4(o,e){let t=new WeakMap;function n(r,s=0){let a;return t.has(r)===!1?(a=new ZA(o,e),t.set(r,[a])):s>=t.get(r).length?(a=new ZA(o,e),t.get(r).push(a)):a=t.get(r)[s],a}function i(){t=new WeakMap}return{get:n,dispose:i}}var df=class extends un{constructor(e){super();this.type="MeshDepthMaterial",this.depthPacking=lA,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.morphTargets=e.morphTargets,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}};df.prototype.isMeshDepthMaterial=!0;var ff=class extends un{constructor(e){super();this.type="MeshDistanceMaterial",this.referencePosition=new U,this.nearDistance=1,this.farDistance=1e3,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.fog=!1,this.setValues(e)}copy(e){return super.copy(e),this.referencePosition.copy(e.referencePosition),this.nearDistance=e.nearDistance,this.farDistance=e.farDistance,this.morphTargets=e.morphTargets,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}};ff.prototype.isMeshDistanceMaterial=!0;var h4=`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
	float mean = 0.0;
	float squared_mean = 0.0;
	float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy ) / resolution ) );
	for ( float i = -1.0; i < 1.0 ; i += SAMPLE_RATE) {
		#ifdef HORIZONTAL_PASS
			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( i, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, i ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean * HALF_SAMPLE_RATE;
	squared_mean = squared_mean * HALF_SAMPLE_RATE;
	float std_dev = sqrt( squared_mean - mean * mean );
	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`,d4=`void main() {
	gl_Position = vec4( position, 1.0 );
}`;function JA(o,e,t){let n=new hu,i=new _e,r=new _e,s=new tt,a=[],l=[],c={},u=t.maxTextureSize,d={0:Qt,1:Js,2:Dr},h=new Fn({defines:{SAMPLE_RATE:2/8,HALF_SAMPLE_RATE:1/8},uniforms:{shadow_pass:{value:null},resolution:{value:new _e},radius:{value:4}},vertexShader:d4,fragmentShader:h4}),f=h.clone();f.defines.HORIZONTAL_PASS=1;let p=new Ue;p.setAttribute("position",new Ye(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));let g=new et(p,h),v=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=zx,this.render=function(b,M,S){if(v.enabled===!1||v.autoUpdate===!1&&v.needsUpdate===!1||b.length===0)return;let E=o.getRenderTarget(),A=o.getActiveCubeFace(),L=o.getActiveMipmapLevel(),B=o.state;B.setBlending(Ks),B.buffers.color.setClear(1,1,1,1),B.buffers.depth.setTest(!0),B.setScissorTest(!1);for(let R=0,D=b.length;R<D;R++){let P=b[R],I=P.shadow;if(I===void 0){console.warn("THREE.WebGLShadowMap:",P,"has no shadow.");continue}if(I.autoUpdate===!1&&I.needsUpdate===!1)continue;i.copy(I.mapSize);let N=I.getFrameExtents();if(i.multiply(N),r.copy(I.mapSize),(i.x>u||i.y>u)&&(i.x>u&&(r.x=Math.floor(u/N.x),i.x=r.x*N.x,I.mapSize.x=r.x),i.y>u&&(r.y=Math.floor(u/N.y),i.y=r.y*N.y,I.mapSize.y=r.y)),I.map===null&&!I.isPointLightShadow&&this.type===Uc){let z={minFilter:Lt,magFilter:Lt,format:Fi};I.map=new Yn(i.x,i.y,z),I.map.texture.name=P.name+".shadowMap",I.mapPass=new Yn(i.x,i.y,z),I.camera.updateProjectionMatrix()}if(I.map===null){let z={minFilter:ln,magFilter:ln,format:Fi};I.map=new Yn(i.x,i.y,z),I.map.texture.name=P.name+".shadowMap",I.camera.updateProjectionMatrix()}o.setRenderTarget(I.map),o.clear();let G=I.getViewportCount();for(let z=0;z<G;z++){let se=I.getViewport(z);s.set(r.x*se.x,r.y*se.y,r.x*se.z,r.y*se.w),B.viewport(s),I.updateMatrices(P,z),n=I.getFrustum(),w(M,S,I.camera,P,this.type)}!I.isPointLightShadow&&this.type===Uc&&y(I,S),I.needsUpdate=!1}v.needsUpdate=!1,o.setRenderTarget(E,A,L)};function y(b,M){let S=e.update(g);h.uniforms.shadow_pass.value=b.map.texture,h.uniforms.resolution.value=b.mapSize,h.uniforms.radius.value=b.radius,o.setRenderTarget(b.mapPass),o.clear(),o.renderBufferDirect(M,null,S,h,g,null),f.uniforms.shadow_pass.value=b.mapPass.texture,f.uniforms.resolution.value=b.mapSize,f.uniforms.radius.value=b.radius,o.setRenderTarget(b.map),o.clear(),o.renderBufferDirect(M,null,S,f,g,null)}function m(b){let M=b<<0,S=a[M];return S===void 0&&(S=new df({depthPacking:cA,morphTargets:b}),a[M]=S),S}function x(b){let M=b<<0,S=l[M];return S===void 0&&(S=new ff({morphTargets:b}),l[M]=S),S}function _(b,M,S,E,A,L,B){let R=null,D=m,P=b.customDepthMaterial;if(E.isPointLight===!0&&(D=x,P=b.customDistanceMaterial),P===void 0){let I=!1;S.morphTargets===!0&&(I=M.morphAttributes&&M.morphAttributes.position&&M.morphAttributes.position.length>0),R=D(I)}else R=P;if(o.localClippingEnabled&&S.clipShadows===!0&&S.clippingPlanes.length!==0){let I=R.uuid,N=S.uuid,G=c[I];G===void 0&&(G={},c[I]=G);let z=G[N];z===void 0&&(z=R.clone(),G[N]=z),R=z}return R.visible=S.visible,R.wireframe=S.wireframe,B===Uc?R.side=S.shadowSide!==null?S.shadowSide:S.side:R.side=S.shadowSide!==null?S.shadowSide:d[S.side],R.clipShadows=S.clipShadows,R.clippingPlanes=S.clippingPlanes,R.clipIntersection=S.clipIntersection,R.wireframeLinewidth=S.wireframeLinewidth,R.linewidth=S.linewidth,E.isPointLight===!0&&R.isMeshDistanceMaterial===!0&&(R.referencePosition.setFromMatrixPosition(E.matrixWorld),R.nearDistance=A,R.farDistance=L),R}function w(b,M,S,E,A){if(b.visible===!1)return;if(b.layers.test(M.layers)&&(b.isMesh||b.isLine||b.isPoints)&&(b.castShadow||b.receiveShadow&&A===Uc)&&(!b.frustumCulled||n.intersectsObject(b))){b.modelViewMatrix.multiplyMatrices(S.matrixWorldInverse,b.matrixWorld);let R=e.update(b),D=b.material;if(Array.isArray(D)){let P=R.groups;for(let I=0,N=P.length;I<N;I++){let G=P[I],z=D[G.materialIndex];if(z&&z.visible){let se=_(b,R,z,E,S.near,S.far,A);o.renderBufferDirect(S,null,R,se,b,G)}}}else if(D.visible){let P=_(b,R,D,E,S.near,S.far,A);o.renderBufferDirect(S,null,R,P,b,null)}}let B=b.children;for(let R=0,D=B.length;R<D;R++)w(B[R],M,S,E,A)}}function f4(o,e,t){let n=t.isWebGL2;function i(){let k=!1,de=new tt,K=null,be=new tt(0,0,0,0);return{setMask:function(we){K!==we&&!k&&(o.colorMask(we,we,we,we),K=we)},setLocked:function(we){k=we},setClear:function(we,We,ve,Be,nt){nt===!0&&(we*=Be,We*=Be,ve*=Be),de.set(we,We,ve,Be),be.equals(de)===!1&&(o.clearColor(we,We,ve,Be),be.copy(de))},reset:function(){k=!1,K=null,be.set(-1,0,0,0)}}}function r(){let k=!1,de=null,K=null,be=null;return{setTest:function(we){we?O(2929):ee(2929)},setMask:function(we){de!==we&&!k&&(o.depthMask(we),de=we)},setFunc:function(we){if(K!==we){if(we)switch(we){case KT:o.depthFunc(512);break;case $T:o.depthFunc(519);break;case QT:o.depthFunc(513);break;case qm:o.depthFunc(515);break;case eE:o.depthFunc(514);break;case tE:o.depthFunc(518);break;case nE:o.depthFunc(516);break;case iE:o.depthFunc(517);break;default:o.depthFunc(515)}else o.depthFunc(515);K=we}},setLocked:function(we){k=we},setClear:function(we){be!==we&&(o.clearDepth(we),be=we)},reset:function(){k=!1,de=null,K=null,be=null}}}function s(){let k=!1,de=null,K=null,be=null,we=null,We=null,ve=null,Be=null,nt=null;return{setTest:function(Xe){k||(Xe?O(2960):ee(2960))},setMask:function(Xe){de!==Xe&&!k&&(o.stencilMask(Xe),de=Xe)},setFunc:function(Xe,_t,wt){(K!==Xe||be!==_t||we!==wt)&&(o.stencilFunc(Xe,_t,wt),K=Xe,be=_t,we=wt)},setOp:function(Xe,_t,wt){(We!==Xe||ve!==_t||Be!==wt)&&(o.stencilOp(Xe,_t,wt),We=Xe,ve=_t,Be=wt)},setLocked:function(Xe){k=Xe},setClear:function(Xe){nt!==Xe&&(o.clearStencil(Xe),nt=Xe)},reset:function(){k=!1,de=null,K=null,be=null,we=null,We=null,ve=null,Be=null,nt=null}}}let a=new i,l=new r,c=new s,u={},d=null,h={},f=null,p=!1,g=null,v=null,y=null,m=null,x=null,_=null,w=null,b=!1,M=null,S=null,E=null,A=null,L=null,B=o.getParameter(35661),R=!1,D=0,P=o.getParameter(7938);P.indexOf("WebGL")!==-1?(D=parseFloat(/^WebGL (\d)/.exec(P)[1]),R=D>=1):P.indexOf("OpenGL ES")!==-1&&(D=parseFloat(/^OpenGL ES (\d)/.exec(P)[1]),R=D>=2);let I=null,N={},G=o.getParameter(3088),z=o.getParameter(2978),se=new tt().fromArray(G),ne=new tt().fromArray(z);function Q(k,de,K){let be=new Uint8Array(4),we=o.createTexture();o.bindTexture(k,we),o.texParameteri(k,10241,9728),o.texParameteri(k,10240,9728);for(let We=0;We<K;We++)o.texImage2D(de+We,0,6408,1,1,0,6408,5121,be);return we}let j={};j[3553]=Q(3553,3553,1),j[34067]=Q(34067,34069,6),a.setClear(0,0,0,1),l.setClear(1),c.setClear(0),O(2929),l.setFunc(qm),$(!1),J(kx),O(2884),xe(Ks);function O(k){u[k]!==!0&&(o.enable(k),u[k]=!0)}function ee(k){u[k]!==!1&&(o.disable(k),u[k]=!1)}function V(k){k!==d&&(o.bindFramebuffer(36160,k),d=k)}function ie(k,de){return de===null&&d!==null&&(de=d),h[k]!==de?(o.bindFramebuffer(k,de),h[k]=de,n&&(k===36009&&(h[36160]=de),k===36160&&(h[36009]=de)),!0):!1}function ue(k){return f!==k?(o.useProgram(k),f=k,!0):!1}let ye={[_l]:32774,[UT]:32778,[HT]:32779};if(n)ye[Wx]=32775,ye[Xx]=32776;else{let k=e.get("EXT_blend_minmax");k!==null&&(ye[Wx]=k.MIN_EXT,ye[Xx]=k.MAX_EXT)}let pe={[GT]:0,[VT]:1,[WT]:768,[qx]:770,[JT]:776,[YT]:774,[qT]:772,[XT]:769,[jx]:771,[ZT]:775,[jT]:773};function xe(k,de,K,be,we,We,ve,Be){if(k===Ks){p===!0&&(ee(3042),p=!1);return}if(p===!1&&(O(3042),p=!0),k!==zT){if(k!==g||Be!==b){if((v!==_l||x!==_l)&&(o.blendEquation(32774),v=_l,x=_l),Be)switch(k){case Hc:o.blendFuncSeparate(1,771,1,771);break;case Hx:o.blendFunc(1,1);break;case Gx:o.blendFuncSeparate(0,0,769,771);break;case Vx:o.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",k);break}else switch(k){case Hc:o.blendFuncSeparate(770,771,1,771);break;case Hx:o.blendFunc(770,1);break;case Gx:o.blendFunc(0,769);break;case Vx:o.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",k);break}y=null,m=null,_=null,w=null,g=k,b=Be}return}we=we||de,We=We||K,ve=ve||be,(de!==v||we!==x)&&(o.blendEquationSeparate(ye[de],ye[we]),v=de,x=we),(K!==y||be!==m||We!==_||ve!==w)&&(o.blendFuncSeparate(pe[K],pe[be],pe[We],pe[ve]),y=K,m=be,_=We,w=ve),g=k,b=null}function X(k,de){k.side===Dr?ee(2884):O(2884);let K=k.side===Qt;de&&(K=!K),$(K),k.blending===Hc&&k.transparent===!1?xe(Ks):xe(k.blending,k.blendEquation,k.blendSrc,k.blendDst,k.blendEquationAlpha,k.blendSrcAlpha,k.blendDstAlpha,k.premultipliedAlpha),l.setFunc(k.depthFunc),l.setTest(k.depthTest),l.setMask(k.depthWrite),a.setMask(k.colorWrite);let be=k.stencilWrite;c.setTest(be),be&&(c.setMask(k.stencilWriteMask),c.setFunc(k.stencilFunc,k.stencilRef,k.stencilFuncMask),c.setOp(k.stencilFail,k.stencilZFail,k.stencilZPass)),H(k.polygonOffset,k.polygonOffsetFactor,k.polygonOffsetUnits),k.alphaToCoverage===!0?O(32926):ee(32926)}function $(k){M!==k&&(k?o.frontFace(2304):o.frontFace(2305),M=k)}function J(k){k!==OT?(O(2884),k!==S&&(k===kx?o.cullFace(1029):k===kT?o.cullFace(1028):o.cullFace(1032))):ee(2884),S=k}function ce(k){k!==E&&(R&&o.lineWidth(k),E=k)}function H(k,de,K){k?(O(32823),(A!==de||L!==K)&&(o.polygonOffset(de,K),A=de,L=K)):ee(32823)}function T(k){k?O(3089):ee(3089)}function C(k){k===void 0&&(k=33984+B-1),I!==k&&(o.activeTexture(k),I=k)}function W(k,de){I===null&&C();let K=N[I];K===void 0&&(K={type:void 0,texture:void 0},N[I]=K),(K.type!==k||K.texture!==de)&&(o.bindTexture(k,de||j[k]),K.type=k,K.texture=de)}function Z(){let k=N[I];k!==void 0&&k.type!==void 0&&(o.bindTexture(k.type,null),k.type=void 0,k.texture=void 0)}function he(){try{o.compressedTexImage2D.apply(o,arguments)}catch(k){console.error("THREE.WebGLState:",k)}}function me(){try{o.texImage2D.apply(o,arguments)}catch(k){console.error("THREE.WebGLState:",k)}}function Ee(){try{o.texImage3D.apply(o,arguments)}catch(k){console.error("THREE.WebGLState:",k)}}function Se(k){se.equals(k)===!1&&(o.scissor(k.x,k.y,k.z,k.w),se.copy(k))}function oe(k){ne.equals(k)===!1&&(o.viewport(k.x,k.y,k.z,k.w),ne.copy(k))}function ge(){o.disable(3042),o.disable(2884),o.disable(2929),o.disable(32823),o.disable(3089),o.disable(2960),o.disable(32926),o.blendEquation(32774),o.blendFunc(1,0),o.blendFuncSeparate(1,0,1,0),o.colorMask(!0,!0,!0,!0),o.clearColor(0,0,0,0),o.depthMask(!0),o.depthFunc(513),o.clearDepth(1),o.stencilMask(4294967295),o.stencilFunc(519,0,4294967295),o.stencilOp(7680,7680,7680),o.clearStencil(0),o.cullFace(1029),o.frontFace(2305),o.polygonOffset(0,0),o.activeTexture(33984),o.bindFramebuffer(36160,null),n===!0&&(o.bindFramebuffer(36009,null),o.bindFramebuffer(36008,null)),o.useProgram(null),o.lineWidth(1),o.scissor(0,0,o.canvas.width,o.canvas.height),o.viewport(0,0,o.canvas.width,o.canvas.height),u={},I=null,N={},d=null,h={},f=null,p=!1,g=null,v=null,y=null,m=null,x=null,_=null,w=null,b=!1,M=null,S=null,E=null,A=null,L=null,se.set(0,0,o.canvas.width,o.canvas.height),ne.set(0,0,o.canvas.width,o.canvas.height),a.reset(),l.reset(),c.reset()}return{buffers:{color:a,depth:l,stencil:c},enable:O,disable:ee,bindFramebuffer:ie,bindXRFramebuffer:V,useProgram:ue,setBlending:xe,setMaterial:X,setFlipSided:$,setCullFace:J,setLineWidth:ce,setPolygonOffset:H,setScissorTest:T,activeTexture:C,bindTexture:W,unbindTexture:Z,compressedTexImage2D:he,texImage2D:me,texImage3D:Ee,scissor:Se,viewport:oe,reset:ge}}function p4(o,e,t,n,i,r,s){let a=i.isWebGL2,l=i.maxTextures,c=i.maxCubemapSize,u=i.maxTextureSize,d=i.maxSamples,h=new WeakMap,f,p=!1;try{p=typeof OffscreenCanvas!="undefined"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch(T){}function g(T,C){return p?new OffscreenCanvas(T,C):document.createElementNS("http://www.w3.org/1999/xhtml","canvas")}function v(T,C,W,Z){let he=1;if((T.width>Z||T.height>Z)&&(he=Z/Math.max(T.width,T.height)),he<1||C===!0)if(typeof HTMLImageElement!="undefined"&&T instanceof HTMLImageElement||typeof HTMLCanvasElement!="undefined"&&T instanceof HTMLCanvasElement||typeof ImageBitmap!="undefined"&&T instanceof ImageBitmap){let me=C?fA:Math.floor,Ee=me(he*T.width),Se=me(he*T.height);f===void 0&&(f=g(Ee,Se));let oe=W?g(Ee,Se):f;return oe.width=Ee,oe.height=Se,oe.getContext("2d").drawImage(T,0,0,Ee,Se),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+T.width+"x"+T.height+") to ("+Ee+"x"+Se+")."),oe}else return"data"in T&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+T.width+"x"+T.height+")."),T;return T}function y(T){return h_(T.width)&&h_(T.height)}function m(T){return a?!1:T.wrapS!==an||T.wrapT!==an||T.minFilter!==ln&&T.minFilter!==Lt}function x(T,C){return T.generateMipmaps&&C&&T.minFilter!==ln&&T.minFilter!==Lt}function _(T,C,W,Z,he=1){o.generateMipmap(T);let me=n.get(C);me.__maxMipLevel=Math.log2(Math.max(W,Z,he))}function w(T,C,W){if(a===!1)return C;if(T!==null){if(o[T]!==void 0)return o[T];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+T+"'")}let Z=C;return C===6403&&(W===5126&&(Z=33326),W===5131&&(Z=33325),W===5121&&(Z=33321)),C===6407&&(W===5126&&(Z=34837),W===5131&&(Z=34843),W===5121&&(Z=32849)),C===6408&&(W===5126&&(Z=34836),W===5131&&(Z=34842),W===5121&&(Z=32856)),(Z===33325||Z===33326||Z===34842||Z===34836)&&e.get("EXT_color_buffer_float"),Z}function b(T){return T===ln||T===Wc||T===Xc?9728:9729}function M(T){let C=T.target;C.removeEventListener("dispose",M),E(C),C.isVideoTexture&&h.delete(C),s.memory.textures--}function S(T){let C=T.target;C.removeEventListener("dispose",S),A(C)}function E(T){let C=n.get(T);C.__webglInit!==void 0&&(o.deleteTexture(C.__webglTexture),n.remove(T))}function A(T){let C=T.texture,W=n.get(T),Z=n.get(C);if(!!T){if(Z.__webglTexture!==void 0&&(o.deleteTexture(Z.__webglTexture),s.memory.textures--),T.depthTexture&&T.depthTexture.dispose(),T.isWebGLCubeRenderTarget)for(let he=0;he<6;he++)o.deleteFramebuffer(W.__webglFramebuffer[he]),W.__webglDepthbuffer&&o.deleteRenderbuffer(W.__webglDepthbuffer[he]);else o.deleteFramebuffer(W.__webglFramebuffer),W.__webglDepthbuffer&&o.deleteRenderbuffer(W.__webglDepthbuffer),W.__webglMultisampledFramebuffer&&o.deleteFramebuffer(W.__webglMultisampledFramebuffer),W.__webglColorRenderbuffer&&o.deleteRenderbuffer(W.__webglColorRenderbuffer),W.__webglDepthRenderbuffer&&o.deleteRenderbuffer(W.__webglDepthRenderbuffer);if(T.isWebGLMultipleRenderTargets)for(let he=0,me=C.length;he<me;he++){let Ee=n.get(C[he]);Ee.__webglTexture&&(o.deleteTexture(Ee.__webglTexture),s.memory.textures--),n.remove(C[he])}n.remove(C),n.remove(T)}}let L=0;function B(){L=0}function R(){let T=L;return T>=l&&console.warn("THREE.WebGLTextures: Trying to use "+T+" texture units while this GPU supports only "+l),L+=1,T}function D(T,C){let W=n.get(T);if(T.isVideoTexture&&X(T),T.version>0&&W.__version!==T.version){let Z=T.image;if(Z===void 0)console.warn("THREE.WebGLRenderer: Texture marked for update but image is undefined");else if(Z.complete===!1)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete");else{Q(W,T,C);return}}t.activeTexture(33984+C),t.bindTexture(3553,W.__webglTexture)}function P(T,C){let W=n.get(T);if(T.version>0&&W.__version!==T.version){Q(W,T,C);return}t.activeTexture(33984+C),t.bindTexture(35866,W.__webglTexture)}function I(T,C){let W=n.get(T);if(T.version>0&&W.__version!==T.version){Q(W,T,C);return}t.activeTexture(33984+C),t.bindTexture(32879,W.__webglTexture)}function N(T,C){let W=n.get(T);if(T.version>0&&W.__version!==T.version){j(W,T,C);return}t.activeTexture(33984+C),t.bindTexture(34067,W.__webglTexture)}let G={[En]:10497,[an]:33071,[wl]:33648},z={[ln]:9728,[Wc]:9984,[Xc]:9986,[Lt]:9729,[Jd]:9985,[hs]:9987};function se(T,C,W){if(W?(o.texParameteri(T,10242,G[C.wrapS]),o.texParameteri(T,10243,G[C.wrapT]),(T===32879||T===35866)&&o.texParameteri(T,32882,G[C.wrapR]),o.texParameteri(T,10240,z[C.magFilter]),o.texParameteri(T,10241,z[C.minFilter])):(o.texParameteri(T,10242,33071),o.texParameteri(T,10243,33071),(T===32879||T===35866)&&o.texParameteri(T,32882,33071),(C.wrapS!==an||C.wrapT!==an)&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),o.texParameteri(T,10240,b(C.magFilter)),o.texParameteri(T,10241,b(C.minFilter)),C.minFilter!==ln&&C.minFilter!==Lt&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),e.has("EXT_texture_filter_anisotropic")===!0){let Z=e.get("EXT_texture_filter_anisotropic");if(C.type===$s&&e.has("OES_texture_float_linear")===!1||a===!1&&C.type===Ml&&e.has("OES_texture_half_float_linear")===!1)return;(C.anisotropy>1||n.get(C).__currentAnisotropy)&&(o.texParameterf(T,Z.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(C.anisotropy,i.getMaxAnisotropy())),n.get(C).__currentAnisotropy=C.anisotropy)}}function ne(T,C){T.__webglInit===void 0&&(T.__webglInit=!0,C.addEventListener("dispose",M),T.__webglTexture=o.createTexture(),s.memory.textures++)}function Q(T,C,W){let Z=3553;C.isDataTexture2DArray&&(Z=35866),C.isDataTexture3D&&(Z=32879),ne(T,C),t.activeTexture(33984+W),t.bindTexture(Z,T.__webglTexture),o.pixelStorei(37440,C.flipY),o.pixelStorei(37441,C.premultiplyAlpha),o.pixelStorei(3317,C.unpackAlignment),o.pixelStorei(37443,0);let he=m(C)&&y(C.image)===!1,me=v(C.image,he,!1,u),Ee=y(me)||a,Se=r.convert(C.format),oe=r.convert(C.type),ge=w(C.internalFormat,Se,oe);se(Z,C,Ee);let k,de=C.mipmaps;if(C.isDepthTexture)ge=6402,a?C.type===$s?ge=36012:C.type===$d?ge=33190:C.type===qc?ge=35056:ge=33189:C.type===$s&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),C.format===Sl&&ge===6402&&C.type!==Kd&&C.type!==$d&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),C.type=Kd,oe=r.convert(C.type)),C.format===jc&&ge===6402&&(ge=34041,C.type!==qc&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),C.type=qc,oe=r.convert(C.type))),t.texImage2D(3553,0,ge,me.width,me.height,0,Se,oe,null);else if(C.isDataTexture)if(de.length>0&&Ee){for(let K=0,be=de.length;K<be;K++)k=de[K],t.texImage2D(3553,K,ge,k.width,k.height,0,Se,oe,k.data);C.generateMipmaps=!1,T.__maxMipLevel=de.length-1}else t.texImage2D(3553,0,ge,me.width,me.height,0,Se,oe,me.data),T.__maxMipLevel=0;else if(C.isCompressedTexture){for(let K=0,be=de.length;K<be;K++)k=de[K],C.format!==Fi&&C.format!==Di?Se!==null?t.compressedTexImage2D(3553,K,ge,k.width,k.height,0,k.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):t.texImage2D(3553,K,ge,k.width,k.height,0,Se,oe,k.data);T.__maxMipLevel=de.length-1}else if(C.isDataTexture2DArray)t.texImage3D(35866,0,ge,me.width,me.height,me.depth,0,Se,oe,me.data),T.__maxMipLevel=0;else if(C.isDataTexture3D)t.texImage3D(32879,0,ge,me.width,me.height,me.depth,0,Se,oe,me.data),T.__maxMipLevel=0;else if(de.length>0&&Ee){for(let K=0,be=de.length;K<be;K++)k=de[K],t.texImage2D(3553,K,ge,Se,oe,k);C.generateMipmaps=!1,T.__maxMipLevel=de.length-1}else t.texImage2D(3553,0,ge,Se,oe,me),T.__maxMipLevel=0;x(C,Ee)&&_(Z,C,me.width,me.height),T.__version=C.version,C.onUpdate&&C.onUpdate(C)}function j(T,C,W){if(C.image.length!==6)return;ne(T,C),t.activeTexture(33984+W),t.bindTexture(34067,T.__webglTexture),o.pixelStorei(37440,C.flipY),o.pixelStorei(37441,C.premultiplyAlpha),o.pixelStorei(3317,C.unpackAlignment),o.pixelStorei(37443,0);let Z=C&&(C.isCompressedTexture||C.image[0].isCompressedTexture),he=C.image[0]&&C.image[0].isDataTexture,me=[];for(let K=0;K<6;K++)!Z&&!he?me[K]=v(C.image[K],!1,!0,c):me[K]=he?C.image[K].image:C.image[K];let Ee=me[0],Se=y(Ee)||a,oe=r.convert(C.format),ge=r.convert(C.type),k=w(C.internalFormat,oe,ge);se(34067,C,Se);let de;if(Z){for(let K=0;K<6;K++){de=me[K].mipmaps;for(let be=0;be<de.length;be++){let we=de[be];C.format!==Fi&&C.format!==Di?oe!==null?t.compressedTexImage2D(34069+K,be,k,we.width,we.height,0,we.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):t.texImage2D(34069+K,be,k,we.width,we.height,0,oe,ge,we.data)}}T.__maxMipLevel=de.length-1}else{de=C.mipmaps;for(let K=0;K<6;K++)if(he){t.texImage2D(34069+K,0,k,me[K].width,me[K].height,0,oe,ge,me[K].data);for(let be=0;be<de.length;be++){let We=de[be].image[K].image;t.texImage2D(34069+K,be+1,k,We.width,We.height,0,oe,ge,We.data)}}else{t.texImage2D(34069+K,0,k,oe,ge,me[K]);for(let be=0;be<de.length;be++){let we=de[be];t.texImage2D(34069+K,be+1,k,oe,ge,we.image[K])}}T.__maxMipLevel=de.length}x(C,Se)&&_(34067,C,Ee.width,Ee.height),T.__version=C.version,C.onUpdate&&C.onUpdate(C)}function O(T,C,W,Z,he){let me=r.convert(W.format),Ee=r.convert(W.type),Se=w(W.internalFormat,me,Ee);he===32879||he===35866?t.texImage3D(he,0,Se,C.width,C.height,C.depth,0,me,Ee,null):t.texImage2D(he,0,Se,C.width,C.height,0,me,Ee,null),t.bindFramebuffer(36160,T),o.framebufferTexture2D(36160,Z,he,n.get(W).__webglTexture,0),t.bindFramebuffer(36160,null)}function ee(T,C,W){if(o.bindRenderbuffer(36161,T),C.depthBuffer&&!C.stencilBuffer){let Z=33189;if(W){let he=C.depthTexture;he&&he.isDepthTexture&&(he.type===$s?Z=36012:he.type===$d&&(Z=33190));let me=xe(C);o.renderbufferStorageMultisample(36161,me,Z,C.width,C.height)}else o.renderbufferStorage(36161,Z,C.width,C.height);o.framebufferRenderbuffer(36160,36096,36161,T)}else if(C.depthBuffer&&C.stencilBuffer){if(W){let Z=xe(C);o.renderbufferStorageMultisample(36161,Z,35056,C.width,C.height)}else o.renderbufferStorage(36161,34041,C.width,C.height);o.framebufferRenderbuffer(36160,33306,36161,T)}else{let Z=C.isWebGLMultipleRenderTargets===!0?C.texture[0]:C.texture,he=r.convert(Z.format),me=r.convert(Z.type),Ee=w(Z.internalFormat,he,me);if(W){let Se=xe(C);o.renderbufferStorageMultisample(36161,Se,Ee,C.width,C.height)}else o.renderbufferStorage(36161,Ee,C.width,C.height)}o.bindRenderbuffer(36161,null)}function V(T,C){if(C&&C.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(t.bindFramebuffer(36160,T),!(C.depthTexture&&C.depthTexture.isDepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");(!n.get(C.depthTexture).__webglTexture||C.depthTexture.image.width!==C.width||C.depthTexture.image.height!==C.height)&&(C.depthTexture.image.width=C.width,C.depthTexture.image.height=C.height,C.depthTexture.needsUpdate=!0),D(C.depthTexture,0);let Z=n.get(C.depthTexture).__webglTexture;if(C.depthTexture.format===Sl)o.framebufferTexture2D(36160,36096,3553,Z,0);else if(C.depthTexture.format===jc)o.framebufferTexture2D(36160,33306,3553,Z,0);else throw new Error("Unknown depthTexture format")}function ie(T){let C=n.get(T),W=T.isWebGLCubeRenderTarget===!0;if(T.depthTexture){if(W)throw new Error("target.depthTexture not supported in Cube render targets");V(C.__webglFramebuffer,T)}else if(W){C.__webglDepthbuffer=[];for(let Z=0;Z<6;Z++)t.bindFramebuffer(36160,C.__webglFramebuffer[Z]),C.__webglDepthbuffer[Z]=o.createRenderbuffer(),ee(C.__webglDepthbuffer[Z],T,!1)}else t.bindFramebuffer(36160,C.__webglFramebuffer),C.__webglDepthbuffer=o.createRenderbuffer(),ee(C.__webglDepthbuffer,T,!1);t.bindFramebuffer(36160,null)}function ue(T){let C=T.texture,W=n.get(T),Z=n.get(C);T.addEventListener("dispose",S),T.isWebGLMultipleRenderTargets!==!0&&(Z.__webglTexture=o.createTexture(),Z.__version=C.version,s.memory.textures++);let he=T.isWebGLCubeRenderTarget===!0,me=T.isWebGLMultipleRenderTargets===!0,Ee=T.isWebGLMultisampleRenderTarget===!0,Se=C.isDataTexture3D||C.isDataTexture2DArray,oe=y(T)||a;if(a&&C.format===Di&&(C.type===$s||C.type===Ml)&&(C.format=Fi,console.warn("THREE.WebGLRenderer: Rendering to textures with RGB format is not supported. Using RGBA format instead.")),he){W.__webglFramebuffer=[];for(let ge=0;ge<6;ge++)W.__webglFramebuffer[ge]=o.createFramebuffer()}else if(W.__webglFramebuffer=o.createFramebuffer(),me)if(i.drawBuffers){let ge=T.texture;for(let k=0,de=ge.length;k<de;k++){let K=n.get(ge[k]);K.__webglTexture===void 0&&(K.__webglTexture=o.createTexture(),s.memory.textures++)}}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");else if(Ee)if(a){W.__webglMultisampledFramebuffer=o.createFramebuffer(),W.__webglColorRenderbuffer=o.createRenderbuffer(),o.bindRenderbuffer(36161,W.__webglColorRenderbuffer);let ge=r.convert(C.format),k=r.convert(C.type),de=w(C.internalFormat,ge,k),K=xe(T);o.renderbufferStorageMultisample(36161,K,de,T.width,T.height),t.bindFramebuffer(36160,W.__webglMultisampledFramebuffer),o.framebufferRenderbuffer(36160,36064,36161,W.__webglColorRenderbuffer),o.bindRenderbuffer(36161,null),T.depthBuffer&&(W.__webglDepthRenderbuffer=o.createRenderbuffer(),ee(W.__webglDepthRenderbuffer,T,!0)),t.bindFramebuffer(36160,null)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.");if(he){t.bindTexture(34067,Z.__webglTexture),se(34067,C,oe);for(let ge=0;ge<6;ge++)O(W.__webglFramebuffer[ge],T,C,36064,34069+ge);x(C,oe)&&_(34067,C,T.width,T.height),t.bindTexture(34067,null)}else if(me){let ge=T.texture;for(let k=0,de=ge.length;k<de;k++){let K=ge[k],be=n.get(K);t.bindTexture(3553,be.__webglTexture),se(3553,K,oe),O(W.__webglFramebuffer,T,K,36064+k,3553),x(K,oe)&&_(3553,K,T.width,T.height)}t.bindTexture(3553,null)}else{let ge=3553;Se&&(a?ge=C.isDataTexture3D?32879:35866:console.warn("THREE.DataTexture3D and THREE.DataTexture2DArray only supported with WebGL2.")),t.bindTexture(ge,Z.__webglTexture),se(ge,C,oe),O(W.__webglFramebuffer,T,C,36064,ge),x(C,oe)&&_(ge,C,T.width,T.height,T.depth),t.bindTexture(ge,null)}T.depthBuffer&&ie(T)}function ye(T){let C=y(T)||a,W=T.isWebGLMultipleRenderTargets===!0?T.texture:[T.texture];for(let Z=0,he=W.length;Z<he;Z++){let me=W[Z];if(x(me,C)){let Ee=T.isWebGLCubeRenderTarget?34067:3553,Se=n.get(me).__webglTexture;t.bindTexture(Ee,Se),_(Ee,me,T.width,T.height),t.bindTexture(Ee,null)}}}function pe(T){if(T.isWebGLMultisampleRenderTarget)if(a){let C=T.width,W=T.height,Z=16384;T.depthBuffer&&(Z|=256),T.stencilBuffer&&(Z|=1024);let he=n.get(T);t.bindFramebuffer(36008,he.__webglMultisampledFramebuffer),t.bindFramebuffer(36009,he.__webglFramebuffer),o.blitFramebuffer(0,0,C,W,0,0,C,W,Z,9728),t.bindFramebuffer(36008,null),t.bindFramebuffer(36009,he.__webglMultisampledFramebuffer)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.")}function xe(T){return a&&T.isWebGLMultisampleRenderTarget?Math.min(d,T.samples):0}function X(T){let C=s.render.frame;h.get(T)!==C&&(h.set(T,C),T.update())}let $=!1,J=!1;function ce(T,C){T&&T.isWebGLRenderTarget&&($===!1&&(console.warn("THREE.WebGLTextures.safeSetTexture2D: don't use render targets as textures. Use their .texture property instead."),$=!0),T=T.texture),D(T,C)}function H(T,C){T&&T.isWebGLCubeRenderTarget&&(J===!1&&(console.warn("THREE.WebGLTextures.safeSetTextureCube: don't use cube render targets as textures. Use their .texture property instead."),J=!0),T=T.texture),N(T,C)}this.allocateTextureUnit=R,this.resetTextureUnits=B,this.setTexture2D=D,this.setTexture2DArray=P,this.setTexture3D=I,this.setTextureCube=N,this.setupRenderTarget=ue,this.updateRenderTargetMipmap=ye,this.updateMultisampleRenderTarget=pe,this.safeSetTexture2D=ce,this.safeSetTextureCube=H}function KA(o,e,t){let n=t.isWebGL2;function i(r){let s;if(r===bl)return 5121;if(r===pE)return 32819;if(r===mE)return 32820;if(r===gE)return 33635;if(r===hE)return 5120;if(r===dE)return 5122;if(r===Kd)return 5123;if(r===fE)return 5124;if(r===$d)return 5125;if(r===$s)return 5126;if(r===Ml)return n?5131:(s=e.get("OES_texture_half_float"),s!==null?s.HALF_FLOAT_OES:null);if(r===yE)return 6406;if(r===Di)return 6407;if(r===Fi)return 6408;if(r===vE)return 6409;if(r===xE)return 6410;if(r===Sl)return 6402;if(r===jc)return 34041;if(r===wE)return 6403;if(r===bE)return 36244;if(r===ME)return 33319;if(r===SE)return 33320;if(r===TE)return 36248;if(r===EE)return 36249;if(r===Yx||r===Zx||r===Jx||r===Kx)if(s=e.get("WEBGL_compressed_texture_s3tc"),s!==null){if(r===Yx)return s.COMPRESSED_RGB_S3TC_DXT1_EXT;if(r===Zx)return s.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(r===Jx)return s.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(r===Kx)return s.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(r===$x||r===Qx||r===e_||r===t_)if(s=e.get("WEBGL_compressed_texture_pvrtc"),s!==null){if(r===$x)return s.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(r===Qx)return s.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(r===e_)return s.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(r===t_)return s.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(r===AE)return s=e.get("WEBGL_compressed_texture_etc1"),s!==null?s.COMPRESSED_RGB_ETC1_WEBGL:null;if((r===n_||r===i_)&&(s=e.get("WEBGL_compressed_texture_etc"),s!==null)){if(r===n_)return s.COMPRESSED_RGB8_ETC2;if(r===i_)return s.COMPRESSED_RGBA8_ETC2_EAC}if(r===CE||r===LE||r===RE||r===PE||r===IE||r===DE||r===FE||r===BE||r===NE||r===OE||r===kE||r===zE||r===UE||r===HE||r===VE||r===WE||r===XE||r===qE||r===jE||r===YE||r===ZE||r===JE||r===KE||r===$E||r===QE||r===eA||r===tA||r===nA)return s=e.get("WEBGL_compressed_texture_astc"),s!==null?r:null;if(r===GE)return s=e.get("EXT_texture_compression_bptc"),s!==null?r:null;if(r===qc)return n?34042:(s=e.get("WEBGL_depth_texture"),s!==null?s.UNSIGNED_INT_24_8_WEBGL:null)}return{convert:i}}var Mg=class extends It{constructor(e=[]){super();this.cameras=e}};Mg.prototype.isArrayCamera=!0;var Zn=class extends $e{constructor(){super();this.type="Group"}};Zn.prototype.isGroup=!0;var m4={type:"move"},Sg=class{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new Zn,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new Zn,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new U,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new U),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new Zn,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new U,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new U),this._grip}dispatchEvent(e){return this._targetRay!==null&&this._targetRay.dispatchEvent(e),this._grip!==null&&this._grip.dispatchEvent(e),this._hand!==null&&this._hand.dispatchEvent(e),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(e,t,n){let i=null,r=null,s=null,a=this._targetRay,l=this._grip,c=this._hand;if(e&&t.session.visibilityState!=="visible-blurred")if(a!==null&&(i=t.getPose(e.targetRaySpace,n),i!==null&&(a.matrix.fromArray(i.transform.matrix),a.matrix.decompose(a.position,a.rotation,a.scale),i.linearVelocity?(a.hasLinearVelocity=!0,a.linearVelocity.copy(i.linearVelocity)):a.hasLinearVelocity=!1,i.angularVelocity?(a.hasAngularVelocity=!0,a.angularVelocity.copy(i.angularVelocity)):a.hasAngularVelocity=!1,this.dispatchEvent(m4))),c&&e.hand){s=!0;for(let g of e.hand.values()){let v=t.getJointPose(g,n);if(c.joints[g.jointName]===void 0){let m=new Zn;m.matrixAutoUpdate=!1,m.visible=!1,c.joints[g.jointName]=m,c.add(m)}let y=c.joints[g.jointName];v!==null&&(y.matrix.fromArray(v.transform.matrix),y.matrix.decompose(y.position,y.rotation,y.scale),y.jointRadius=v.radius),y.visible=v!==null}let u=c.joints["index-finger-tip"],d=c.joints["thumb-tip"],h=u.position.distanceTo(d.position),f=.02,p=.005;c.inputState.pinching&&h>f+p?(c.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!c.inputState.pinching&&h<=f-p&&(c.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else l!==null&&e.gripSpace&&(r=t.getPose(e.gripSpace,n),r!==null&&(l.matrix.fromArray(r.transform.matrix),l.matrix.decompose(l.position,l.rotation,l.scale),r.linearVelocity?(l.hasLinearVelocity=!0,l.linearVelocity.copy(r.linearVelocity)):l.hasLinearVelocity=!1,r.angularVelocity?(l.hasAngularVelocity=!0,l.angularVelocity.copy(r.angularVelocity)):l.hasAngularVelocity=!1));return a!==null&&(a.visible=i!==null),l!==null&&(l.visible=r!==null),c!==null&&(c.visible=s!==null),this}},$A=class extends Wi{constructor(e,t){super();let n=this,i=e.state,r=null,s=1,a=null,l="local-floor",c=null,u=null,d=null,h=null,f=[],p=new Map,g=new It;g.layers.enable(1),g.viewport=new tt;let v=new It;v.layers.enable(2),v.viewport=new tt;let y=[g,v],m=new Mg;m.layers.enable(1),m.layers.enable(2);let x=null,_=null;this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(P){let I=f[P];return I===void 0&&(I=new Sg,f[P]=I),I.getTargetRaySpace()},this.getControllerGrip=function(P){let I=f[P];return I===void 0&&(I=new Sg,f[P]=I),I.getGripSpace()},this.getHand=function(P){let I=f[P];return I===void 0&&(I=new Sg,f[P]=I),I.getHandSpace()};function w(P){let I=p.get(P.inputSource);I&&I.dispatchEvent({type:P.type,data:P.inputSource})}function b(){p.forEach(function(P,I){P.disconnect(I)}),p.clear(),x=null,_=null,i.bindXRFramebuffer(null),e.setRenderTarget(e.getRenderTarget()),D.stop(),n.isPresenting=!1,n.dispatchEvent({type:"sessionend"})}this.setFramebufferScaleFactor=function(P){s=P,n.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(P){l=P,n.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return a},this.getSession=function(){return r},this.setSession=async function(P){if(r=P,r!==null){r.addEventListener("select",w),r.addEventListener("selectstart",w),r.addEventListener("selectend",w),r.addEventListener("squeeze",w),r.addEventListener("squeezestart",w),r.addEventListener("squeezeend",w),r.addEventListener("end",b),r.addEventListener("inputsourceschange",M);let I=t.getContextAttributes();if(I.xrCompatible!==!0&&await t.makeXRCompatible(),r.renderState.layers===void 0){let N={antialias:I.antialias,alpha:I.alpha,depth:I.depth,stencil:I.stencil,framebufferScaleFactor:s},G=new XRWebGLLayer(r,t,N);r.updateRenderState({baseLayer:G})}else{let N=0;I.depth&&(N=I.stencil?34041:6402);let G={colorFormat:I.alpha?6408:6407,depthFormat:N,scaleFactor:s};u=new XRWebGLBinding(r,t),h=u.createProjectionLayer(G),d=t.createFramebuffer(),r.updateRenderState({layers:[h]})}a=await r.requestReferenceSpace(l),D.setContext(r),D.start(),n.isPresenting=!0,n.dispatchEvent({type:"sessionstart"})}};function M(P){let I=r.inputSources;for(let N=0;N<f.length;N++)p.set(I[N],f[N]);for(let N=0;N<P.removed.length;N++){let G=P.removed[N],z=p.get(G);z&&(z.dispatchEvent({type:"disconnected",data:G}),p.delete(G))}for(let N=0;N<P.added.length;N++){let G=P.added[N],z=p.get(G);z&&z.dispatchEvent({type:"connected",data:G})}}let S=new U,E=new U;function A(P,I,N){S.setFromMatrixPosition(I.matrixWorld),E.setFromMatrixPosition(N.matrixWorld);let G=S.distanceTo(E),z=I.projectionMatrix.elements,se=N.projectionMatrix.elements,ne=z[14]/(z[10]-1),Q=z[14]/(z[10]+1),j=(z[9]+1)/z[5],O=(z[9]-1)/z[5],ee=(z[8]-1)/z[0],V=(se[8]+1)/se[0],ie=ne*ee,ue=ne*V,ye=G/(-ee+V),pe=ye*-ee;I.matrixWorld.decompose(P.position,P.quaternion,P.scale),P.translateX(pe),P.translateZ(ye),P.matrixWorld.compose(P.position,P.quaternion,P.scale),P.matrixWorldInverse.copy(P.matrixWorld).invert();let xe=ne+ye,X=Q+ye,$=ie-pe,J=ue+(G-pe),ce=j*Q/X*xe,H=O*Q/X*xe;P.projectionMatrix.makePerspective($,J,ce,H,xe,X)}function L(P,I){I===null?P.matrixWorld.copy(P.matrix):P.matrixWorld.multiplyMatrices(I.matrixWorld,P.matrix),P.matrixWorldInverse.copy(P.matrixWorld).invert()}this.updateCamera=function(P){if(r===null)return;m.near=v.near=g.near=P.near,m.far=v.far=g.far=P.far,(x!==m.near||_!==m.far)&&(r.updateRenderState({depthNear:m.near,depthFar:m.far}),x=m.near,_=m.far);let I=P.parent,N=m.cameras;L(m,I);for(let z=0;z<N.length;z++)L(N[z],I);m.matrixWorld.decompose(m.position,m.quaternion,m.scale),P.position.copy(m.position),P.quaternion.copy(m.quaternion),P.scale.copy(m.scale),P.matrix.copy(m.matrix),P.matrixWorld.copy(m.matrixWorld);let G=P.children;for(let z=0,se=G.length;z<se;z++)G[z].updateMatrixWorld(!0);N.length===2?A(m,g,v):m.projectionMatrix.copy(g.projectionMatrix)},this.getCamera=function(){return m};let B=null;function R(P,I){if(c=I.getViewerPose(a),c!==null){let G=c.views,z=r.renderState.baseLayer;r.renderState.layers===void 0&&i.bindXRFramebuffer(z.framebuffer);let se=!1;G.length!==m.cameras.length&&(m.cameras.length=0,se=!0);for(let ne=0;ne<G.length;ne++){let Q=G[ne],j=null;if(r.renderState.layers===void 0)j=z.getViewport(Q);else{let ee=u.getViewSubImage(h,Q);i.bindXRFramebuffer(d),t.framebufferTexture2D(36160,36064,3553,ee.colorTexture,0),ee.depthStencilTexture!==void 0&&t.framebufferTexture2D(36160,36096,3553,ee.depthStencilTexture,0),j=ee.viewport}let O=y[ne];O.matrix.fromArray(Q.transform.matrix),O.projectionMatrix.fromArray(Q.projectionMatrix),O.viewport.set(j.x,j.y,j.width,j.height),ne===0&&m.matrix.copy(O.matrix),se===!0&&m.cameras.push(O)}}let N=r.inputSources;for(let G=0;G<f.length;G++){let z=f[G],se=N[G];z.update(se,I,a)}B&&B(P,I)}let D=new AA;D.setAnimationLoop(R),this.setAnimationLoop=function(P){B=P},this.dispose=function(){}}};function g4(o){function e(y,m){y.fogColor.value.copy(m.color),m.isFog?(y.fogNear.value=m.near,y.fogFar.value=m.far):m.isFogExp2&&(y.fogDensity.value=m.density)}function t(y,m,x,_,w){m.isMeshBasicMaterial?n(y,m):m.isMeshLambertMaterial?(n(y,m),l(y,m)):m.isMeshToonMaterial?(n(y,m),u(y,m)):m.isMeshPhongMaterial?(n(y,m),c(y,m)):m.isMeshStandardMaterial?(n(y,m),m.isMeshPhysicalMaterial?h(y,m,w):d(y,m)):m.isMeshMatcapMaterial?(n(y,m),f(y,m)):m.isMeshDepthMaterial?(n(y,m),p(y,m)):m.isMeshDistanceMaterial?(n(y,m),g(y,m)):m.isMeshNormalMaterial?(n(y,m),v(y,m)):m.isLineBasicMaterial?(i(y,m),m.isLineDashedMaterial&&r(y,m)):m.isPointsMaterial?s(y,m,x,_):m.isSpriteMaterial?a(y,m):m.isShadowMaterial?(y.color.value.copy(m.color),y.opacity.value=m.opacity):m.isShaderMaterial&&(m.uniformsNeedUpdate=!1)}function n(y,m){y.opacity.value=m.opacity,m.color&&y.diffuse.value.copy(m.color),m.emissive&&y.emissive.value.copy(m.emissive).multiplyScalar(m.emissiveIntensity),m.map&&(y.map.value=m.map),m.alphaMap&&(y.alphaMap.value=m.alphaMap),m.specularMap&&(y.specularMap.value=m.specularMap);let x=o.get(m).envMap;if(x){y.envMap.value=x,y.flipEnvMap.value=x.isCubeTexture&&x._needsFlipEnvMap?-1:1,y.reflectivity.value=m.reflectivity,y.refractionRatio.value=m.refractionRatio;let b=o.get(x).__maxMipLevel;b!==void 0&&(y.maxMipLevel.value=b)}m.lightMap&&(y.lightMap.value=m.lightMap,y.lightMapIntensity.value=m.lightMapIntensity),m.aoMap&&(y.aoMap.value=m.aoMap,y.aoMapIntensity.value=m.aoMapIntensity);let _;m.map?_=m.map:m.specularMap?_=m.specularMap:m.displacementMap?_=m.displacementMap:m.normalMap?_=m.normalMap:m.bumpMap?_=m.bumpMap:m.roughnessMap?_=m.roughnessMap:m.metalnessMap?_=m.metalnessMap:m.alphaMap?_=m.alphaMap:m.emissiveMap?_=m.emissiveMap:m.clearcoatMap?_=m.clearcoatMap:m.clearcoatNormalMap?_=m.clearcoatNormalMap:m.clearcoatRoughnessMap&&(_=m.clearcoatRoughnessMap),_!==void 0&&(_.isWebGLRenderTarget&&(_=_.texture),_.matrixAutoUpdate===!0&&_.updateMatrix(),y.uvTransform.value.copy(_.matrix));let w;m.aoMap?w=m.aoMap:m.lightMap&&(w=m.lightMap),w!==void 0&&(w.isWebGLRenderTarget&&(w=w.texture),w.matrixAutoUpdate===!0&&w.updateMatrix(),y.uv2Transform.value.copy(w.matrix))}function i(y,m){y.diffuse.value.copy(m.color),y.opacity.value=m.opacity}function r(y,m){y.dashSize.value=m.dashSize,y.totalSize.value=m.dashSize+m.gapSize,y.scale.value=m.scale}function s(y,m,x,_){y.diffuse.value.copy(m.color),y.opacity.value=m.opacity,y.size.value=m.size*x,y.scale.value=_*.5,m.map&&(y.map.value=m.map),m.alphaMap&&(y.alphaMap.value=m.alphaMap);let w;m.map?w=m.map:m.alphaMap&&(w=m.alphaMap),w!==void 0&&(w.matrixAutoUpdate===!0&&w.updateMatrix(),y.uvTransform.value.copy(w.matrix))}function a(y,m){y.diffuse.value.copy(m.color),y.opacity.value=m.opacity,y.rotation.value=m.rotation,m.map&&(y.map.value=m.map),m.alphaMap&&(y.alphaMap.value=m.alphaMap);let x;m.map?x=m.map:m.alphaMap&&(x=m.alphaMap),x!==void 0&&(x.matrixAutoUpdate===!0&&x.updateMatrix(),y.uvTransform.value.copy(x.matrix))}function l(y,m){m.emissiveMap&&(y.emissiveMap.value=m.emissiveMap)}function c(y,m){y.specular.value.copy(m.specular),y.shininess.value=Math.max(m.shininess,1e-4),m.emissiveMap&&(y.emissiveMap.value=m.emissiveMap),m.bumpMap&&(y.bumpMap.value=m.bumpMap,y.bumpScale.value=m.bumpScale,m.side===Qt&&(y.bumpScale.value*=-1)),m.normalMap&&(y.normalMap.value=m.normalMap,y.normalScale.value.copy(m.normalScale),m.side===Qt&&y.normalScale.value.negate()),m.displacementMap&&(y.displacementMap.value=m.displacementMap,y.displacementScale.value=m.displacementScale,y.displacementBias.value=m.displacementBias)}function u(y,m){m.gradientMap&&(y.gradientMap.value=m.gradientMap),m.emissiveMap&&(y.emissiveMap.value=m.emissiveMap),m.bumpMap&&(y.bumpMap.value=m.bumpMap,y.bumpScale.value=m.bumpScale,m.side===Qt&&(y.bumpScale.value*=-1)),m.normalMap&&(y.normalMap.value=m.normalMap,y.normalScale.value.copy(m.normalScale),m.side===Qt&&y.normalScale.value.negate()),m.displacementMap&&(y.displacementMap.value=m.displacementMap,y.displacementScale.value=m.displacementScale,y.displacementBias.value=m.displacementBias)}function d(y,m){y.roughness.value=m.roughness,y.metalness.value=m.metalness,m.roughnessMap&&(y.roughnessMap.value=m.roughnessMap),m.metalnessMap&&(y.metalnessMap.value=m.metalnessMap),m.emissiveMap&&(y.emissiveMap.value=m.emissiveMap),m.bumpMap&&(y.bumpMap.value=m.bumpMap,y.bumpScale.value=m.bumpScale,m.side===Qt&&(y.bumpScale.value*=-1)),m.normalMap&&(y.normalMap.value=m.normalMap,y.normalScale.value.copy(m.normalScale),m.side===Qt&&y.normalScale.value.negate()),m.displacementMap&&(y.displacementMap.value=m.displacementMap,y.displacementScale.value=m.displacementScale,y.displacementBias.value=m.displacementBias),o.get(m).envMap&&(y.envMapIntensity.value=m.envMapIntensity)}function h(y,m,x){d(y,m),y.reflectivity.value=m.reflectivity,y.clearcoat.value=m.clearcoat,y.clearcoatRoughness.value=m.clearcoatRoughness,m.sheen&&y.sheen.value.copy(m.sheen),m.clearcoatMap&&(y.clearcoatMap.value=m.clearcoatMap),m.clearcoatRoughnessMap&&(y.clearcoatRoughnessMap.value=m.clearcoatRoughnessMap),m.clearcoatNormalMap&&(y.clearcoatNormalScale.value.copy(m.clearcoatNormalScale),y.clearcoatNormalMap.value=m.clearcoatNormalMap,m.side===Qt&&y.clearcoatNormalScale.value.negate()),y.transmission.value=m.transmission,m.transmissionMap&&(y.transmissionMap.value=m.transmissionMap),m.transmission>0&&(y.transmissionSamplerMap.value=x.texture,y.transmissionSamplerSize.value.set(x.width,x.height)),y.thickness.value=m.thickness,m.thicknessMap&&(y.thicknessMap.value=m.thicknessMap),y.attenuationDistance.value=m.attenuationDistance,y.attenuationColor.value.copy(m.attenuationColor)}function f(y,m){m.matcap&&(y.matcap.value=m.matcap),m.bumpMap&&(y.bumpMap.value=m.bumpMap,y.bumpScale.value=m.bumpScale,m.side===Qt&&(y.bumpScale.value*=-1)),m.normalMap&&(y.normalMap.value=m.normalMap,y.normalScale.value.copy(m.normalScale),m.side===Qt&&y.normalScale.value.negate()),m.displacementMap&&(y.displacementMap.value=m.displacementMap,y.displacementScale.value=m.displacementScale,y.displacementBias.value=m.displacementBias)}function p(y,m){m.displacementMap&&(y.displacementMap.value=m.displacementMap,y.displacementScale.value=m.displacementScale,y.displacementBias.value=m.displacementBias)}function g(y,m){m.displacementMap&&(y.displacementMap.value=m.displacementMap,y.displacementScale.value=m.displacementScale,y.displacementBias.value=m.displacementBias),y.referencePosition.value.copy(m.referencePosition),y.nearDistance.value=m.nearDistance,y.farDistance.value=m.farDistance}function v(y,m){m.bumpMap&&(y.bumpMap.value=m.bumpMap,y.bumpScale.value=m.bumpScale,m.side===Qt&&(y.bumpScale.value*=-1)),m.normalMap&&(y.normalMap.value=m.normalMap,y.normalScale.value.copy(m.normalScale),m.side===Qt&&y.normalScale.value.negate()),m.displacementMap&&(y.displacementMap.value=m.displacementMap,y.displacementScale.value=m.displacementScale,y.displacementBias.value=m.displacementBias)}return{refreshFogUniforms:e,refreshMaterialUniforms:t}}function y4(){let o=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");return o.style.display="block",o}function Rt(o={}){let e=o.canvas!==void 0?o.canvas:y4(),t=o.context!==void 0?o.context:null,n=o.alpha!==void 0?o.alpha:!1,i=o.depth!==void 0?o.depth:!0,r=o.stencil!==void 0?o.stencil:!0,s=o.antialias!==void 0?o.antialias:!1,a=o.premultipliedAlpha!==void 0?o.premultipliedAlpha:!0,l=o.preserveDrawingBuffer!==void 0?o.preserveDrawingBuffer:!1,c=o.powerPreference!==void 0?o.powerPreference:"default",u=o.failIfMajorPerformanceCaveat!==void 0?o.failIfMajorPerformanceCaveat:!1,d=null,h=null,f=[],p=[];this.domElement=e,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.gammaFactor=2,this.outputEncoding=Xn,this.physicallyCorrectLights=!1,this.toneMapping=Zo,this.toneMappingExposure=1;let g=this,v=!1,y=0,m=0,x=null,_=-1,w=null,b=new tt,M=new tt,S=null,E=e.width,A=e.height,L=1,B=null,R=null,D=new tt(0,0,E,A),P=new tt(0,0,E,A),I=!1,N=[],G=new hu,z=!1,se=!1,ne=null,Q=new Pe,j=new U,O={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function ee(){return x===null?L:1}let V=t;function ie(F,q){for(let Y=0;Y<F.length;Y++){let te=F[Y],fe=e.getContext(te,q);if(fe!==null)return fe}return null}try{let F={alpha:n,depth:i,stencil:r,antialias:s,premultipliedAlpha:a,preserveDrawingBuffer:l,powerPreference:c,failIfMajorPerformanceCaveat:u};if(e.addEventListener("webglcontextlost",We,!1),e.addEventListener("webglcontextrestored",ve,!1),V===null){let q=["webgl2","webgl","experimental-webgl"];if(g.isWebGL1Renderer===!0&&q.shift(),V=ie(q,F),V===null)throw ie(q)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}V.getShaderPrecisionFormat===void 0&&(V.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(F){throw console.error("THREE.WebGLRenderer: "+F.message),F}let ue,ye,pe,xe,X,$,J,ce,H,T,C,W,Z,he,me,Ee,Se,oe,ge,k,de,K;function be(){ue=new GU(V),ye=new zU(V,ue,o),ue.init(ye),de=new KA(V,ue,ye),pe=new f4(V,ue,ye),N[0]=1029,xe=new XU(V),X=new n4,$=new p4(V,ue,pe,X,ye,de,xe),J=new HU(g),ce=new pk(V,ye),K=new OU(V,ue,ce,ye),H=new VU(V,ce,xe,K),T=new ZU(V,H,ce,xe),oe=new YU(V),me=new UU(X),C=new t4(g,J,ue,ye,K,me),W=new g4(X),Z=new r4(X),he=new u4(ue,ye),Se=new NU(g,J,pe,T,a),Ee=new JA(g,T,ye),ge=new kU(V,ue,xe,ye),k=new WU(V,ue,xe,ye),xe.programs=C.programs,g.capabilities=ye,g.extensions=ue,g.properties=X,g.renderLists=Z,g.shadowMap=Ee,g.state=pe,g.info=xe}be();let we=new $A(g,V);this.xr=we,this.getContext=function(){return V},this.getContextAttributes=function(){return V.getContextAttributes()},this.forceContextLoss=function(){let F=ue.get("WEBGL_lose_context");F&&F.loseContext()},this.forceContextRestore=function(){let F=ue.get("WEBGL_lose_context");F&&F.restoreContext()},this.getPixelRatio=function(){return L},this.setPixelRatio=function(F){F!==void 0&&(L=F,this.setSize(E,A,!1))},this.getSize=function(F){return F.set(E,A)},this.setSize=function(F,q,Y){if(we.isPresenting){console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting.");return}E=F,A=q,e.width=Math.floor(F*L),e.height=Math.floor(q*L),Y!==!1&&(e.style.width=F+"px",e.style.height=q+"px"),this.setViewport(0,0,F,q)},this.getDrawingBufferSize=function(F){return F.set(E*L,A*L).floor()},this.setDrawingBufferSize=function(F,q,Y){E=F,A=q,L=Y,e.width=Math.floor(F*Y),e.height=Math.floor(q*Y),this.setViewport(0,0,F,q)},this.getCurrentViewport=function(F){return F.copy(b)},this.getViewport=function(F){return F.copy(D)},this.setViewport=function(F,q,Y,te){F.isVector4?D.set(F.x,F.y,F.z,F.w):D.set(F,q,Y,te),pe.viewport(b.copy(D).multiplyScalar(L).floor())},this.getScissor=function(F){return F.copy(P)},this.setScissor=function(F,q,Y,te){F.isVector4?P.set(F.x,F.y,F.z,F.w):P.set(F,q,Y,te),pe.scissor(M.copy(P).multiplyScalar(L).floor())},this.getScissorTest=function(){return I},this.setScissorTest=function(F){pe.setScissorTest(I=F)},this.setOpaqueSort=function(F){B=F},this.setTransparentSort=function(F){R=F},this.getClearColor=function(F){return F.copy(Se.getClearColor())},this.setClearColor=function(){Se.setClearColor.apply(Se,arguments)},this.getClearAlpha=function(){return Se.getClearAlpha()},this.setClearAlpha=function(){Se.setClearAlpha.apply(Se,arguments)},this.clear=function(F,q,Y){let te=0;(F===void 0||F)&&(te|=16384),(q===void 0||q)&&(te|=256),(Y===void 0||Y)&&(te|=1024),V.clear(te)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){e.removeEventListener("webglcontextlost",We,!1),e.removeEventListener("webglcontextrestored",ve,!1),Z.dispose(),he.dispose(),X.dispose(),J.dispose(),T.dispose(),K.dispose(),we.dispose(),we.removeEventListener("sessionstart",ii),we.removeEventListener("sessionend",In),ne&&(ne.dispose(),ne=null),Bt.stop()};function We(F){F.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),v=!0}function ve(){console.log("THREE.WebGLRenderer: Context Restored."),v=!1;let F=xe.autoReset,q=Ee.enabled,Y=Ee.autoUpdate,te=Ee.needsUpdate,fe=Ee.type;be(),xe.autoReset=F,Ee.enabled=q,Ee.autoUpdate=Y,Ee.needsUpdate=te,Ee.type=fe}function Be(F){let q=F.target;q.removeEventListener("dispose",Be),nt(q)}function nt(F){Xe(F),X.remove(F)}function Xe(F){let q=X.get(F).programs;q!==void 0&&q.forEach(function(Y){C.releaseProgram(Y)})}function _t(F,q){F.render(function(Y){g.renderBufferImmediate(Y,q)})}this.renderBufferImmediate=function(F,q){K.initAttributes();let Y=X.get(F);F.hasPositions&&!Y.position&&(Y.position=V.createBuffer()),F.hasNormals&&!Y.normal&&(Y.normal=V.createBuffer()),F.hasUvs&&!Y.uv&&(Y.uv=V.createBuffer()),F.hasColors&&!Y.color&&(Y.color=V.createBuffer());let te=q.getAttributes();F.hasPositions&&(V.bindBuffer(34962,Y.position),V.bufferData(34962,F.positionArray,35048),K.enableAttribute(te.position),V.vertexAttribPointer(te.position,3,5126,!1,0,0)),F.hasNormals&&(V.bindBuffer(34962,Y.normal),V.bufferData(34962,F.normalArray,35048),K.enableAttribute(te.normal),V.vertexAttribPointer(te.normal,3,5126,!1,0,0)),F.hasUvs&&(V.bindBuffer(34962,Y.uv),V.bufferData(34962,F.uvArray,35048),K.enableAttribute(te.uv),V.vertexAttribPointer(te.uv,2,5126,!1,0,0)),F.hasColors&&(V.bindBuffer(34962,Y.color),V.bufferData(34962,F.colorArray,35048),K.enableAttribute(te.color),V.vertexAttribPointer(te.color,3,5126,!1,0,0)),K.disableUnusedAttributes(),V.drawArrays(4,0,F.count),F.count=0},this.renderBufferDirect=function(F,q,Y,te,fe,Fe){q===null&&(q=O);let Le=fe.isMesh&&fe.matrixWorld.determinant()<0,Te=re(F,q,te,fe);pe.setMaterial(te,Le);let Re=Y.index,Ae=Y.attributes.position;if(Re===null){if(Ae===void 0||Ae.count===0)return}else if(Re.count===0)return;let ze=1;te.wireframe===!0&&(Re=H.getWireframeAttribute(Y),ze=2),(te.morphTargets||te.morphNormals)&&oe.update(fe,Y,te,Te),K.setup(fe,te,Te,Y,Re);let Ie,je=ge;Re!==null&&(Ie=ce.get(Re),je=k,je.setIndex(Ie));let rt=Re!==null?Re.count:Ae.count,at=Y.drawRange.start*ze,dt=Y.drawRange.count*ze,Ke=Fe!==null?Fe.start*ze:0,Ct=Fe!==null?Fe.count*ze:1/0,it=Math.max(at,Ke),Wd=Math.min(rt,at+dt,Ke+Ct)-1,Ys=Math.max(0,Wd-it+1);if(Ys!==0){if(fe.isMesh)te.wireframe===!0?(pe.setLineWidth(te.wireframeLinewidth*ee()),je.setMode(1)):je.setMode(4);else if(fe.isLine){let Ir=te.linewidth;Ir===void 0&&(Ir=1),pe.setLineWidth(Ir*ee()),fe.isLineSegments?je.setMode(1):fe.isLineLoop?je.setMode(2):je.setMode(3)}else fe.isPoints?je.setMode(0):fe.isSprite&&je.setMode(4);if(fe.isInstancedMesh)je.renderInstances(it,Ys,fe.count);else if(Y.isInstancedBufferGeometry){let Ir=Math.min(Y.instanceCount,Y._maxInstanceCount);je.renderInstances(it,Ys,Ir)}else je.render(it,Ys)}},this.compile=function(F,q){h=he.get(F),h.init(),F.traverseVisible(function(Y){Y.isLight&&Y.layers.test(q.layers)&&(h.pushLight(Y),Y.castShadow&&h.pushShadow(Y))}),h.setupLights(),F.traverse(function(Y){let te=Y.material;if(te)if(Array.isArray(te))for(let fe=0;fe<te.length;fe++){let Fe=te[fe];js(Fe,F,Y)}else js(te,F,Y)})};let wt=null;function Pr(F){wt&&wt(F)}function ii(){Bt.stop()}function In(){Bt.start()}let Bt=new AA;Bt.setAnimationLoop(Pr),typeof window!="undefined"&&Bt.setContext(window),this.setAnimationLoop=function(F){wt=F,we.setAnimationLoop(F),F===null?Bt.stop():Bt.start()},we.addEventListener("sessionstart",ii),we.addEventListener("sessionend",In),this.render=function(F,q){if(q!==void 0&&q.isCamera!==!0){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(v===!0)return;F.autoUpdate===!0&&F.updateMatrixWorld(),q.parent===null&&q.updateMatrixWorld(),we.enabled===!0&&we.isPresenting===!0&&(we.cameraAutoUpdate===!0&&we.updateCamera(q),q=we.getCamera()),F.isScene===!0&&F.onBeforeRender(g,F,q,x),h=he.get(F,p.length),h.init(),p.push(h),Q.multiplyMatrices(q.projectionMatrix,q.matrixWorldInverse),G.setFromProjectionMatrix(Q),se=this.localClippingEnabled,z=me.init(this.clippingPlanes,se,q),d=Z.get(F,f.length),d.init(),f.push(d),Wo(F,q,0,g.sortObjects),d.finish(),g.sortObjects===!0&&d.sort(B,R),z===!0&&me.beginShadows();let Y=h.state.shadowsArray;Ee.render(Y,F,q),h.setupLights(),h.setupLightsView(q),z===!0&&me.endShadows(),this.info.autoReset===!0&&this.info.reset(),Se.render(d,F);let te=d.opaque,fe=d.transmissive,Fe=d.transparent;te.length>0&&cr(te,F,q),fe.length>0&&vl(te,fe,F,q),Fe.length>0&&cr(Fe,F,q),x!==null&&($.updateMultisampleRenderTarget(x),$.updateRenderTargetMipmap(x)),F.isScene===!0&&F.onAfterRender(g,F,q),pe.buffers.depth.setTest(!0),pe.buffers.depth.setMask(!0),pe.buffers.color.setMask(!0),pe.setPolygonOffset(!1),K.resetDefaultState(),_=-1,w=null,p.pop(),p.length>0?h=p[p.length-1]:h=null,f.pop(),f.length>0?d=f[f.length-1]:d=null};function Wo(F,q,Y,te){if(F.visible===!1)return;if(F.layers.test(q.layers)){if(F.isGroup)Y=F.renderOrder;else if(F.isLOD)F.autoUpdate===!0&&F.update(q);else if(F.isLight)h.pushLight(F),F.castShadow&&h.pushShadow(F);else if(F.isSprite){if(!F.frustumCulled||G.intersectsSprite(F)){te&&j.setFromMatrixPosition(F.matrixWorld).applyMatrix4(Q);let Le=T.update(F),Te=F.material;Te.visible&&d.push(F,Le,Te,Y,j.z,null)}}else if(F.isImmediateRenderObject)te&&j.setFromMatrixPosition(F.matrixWorld).applyMatrix4(Q),d.push(F,null,F.material,Y,j.z,null);else if((F.isMesh||F.isLine||F.isPoints)&&(F.isSkinnedMesh&&F.skeleton.frame!==xe.render.frame&&(F.skeleton.update(),F.skeleton.frame=xe.render.frame),!F.frustumCulled||G.intersectsObject(F))){te&&j.setFromMatrixPosition(F.matrixWorld).applyMatrix4(Q);let Le=T.update(F),Te=F.material;if(Array.isArray(Te)){let Re=Le.groups;for(let Ae=0,ze=Re.length;Ae<ze;Ae++){let Ie=Re[Ae],je=Te[Ie.materialIndex];je&&je.visible&&d.push(F,Le,je,Y,j.z,Ie)}}else Te.visible&&d.push(F,Le,Te,Y,j.z,null)}}let Fe=F.children;for(let Le=0,Te=Fe.length;Le<Te;Le++)Wo(Fe[Le],q,Y,te)}function vl(F,q,Y,te){if(ne===null){let Te=s===!0&&ye.isWebGL2===!0?ng:Yn;ne=new Te(1024,1024,{generateMipmaps:!0,type:de.convert(Ml)!==null?Ml:bl,minFilter:hs,magFilter:ln,wrapS:an,wrapT:an})}let fe=g.getRenderTarget();g.setRenderTarget(ne),g.clear();let Fe=g.toneMapping;g.toneMapping=Zo,cr(F,Y,te),g.toneMapping=Fe,$.updateMultisampleRenderTarget(ne),$.updateRenderTargetMipmap(ne),g.setRenderTarget(fe),cr(q,Y,te)}function cr(F,q,Y){let te=q.isScene===!0?q.overrideMaterial:null;for(let fe=0,Fe=F.length;fe<Fe;fe++){let Le=F[fe],Te=Le.object,Re=Le.geometry,Ae=te===null?Le.material:te,ze=Le.group;if(Y.isArrayCamera){let Ie=Y.cameras;for(let je=0,rt=Ie.length;je<rt;je++){let at=Ie[je];Te.layers.test(at.layers)&&(pe.viewport(b.copy(at.viewport)),h.setupLightsView(at),Xo(Te,q,at,Re,Ae,ze))}}else Xo(Te,q,Y,Re,Ae,ze)}}function Xo(F,q,Y,te,fe,Fe){if(F.onBeforeRender(g,q,Y,te,fe,Fe),F.modelViewMatrix.multiplyMatrices(Y.matrixWorldInverse,F.matrixWorld),F.normalMatrix.getNormalMatrix(F.modelViewMatrix),F.isImmediateRenderObject){let Le=re(Y,q,fe,F);pe.setMaterial(fe),K.reset(),_t(F,Le)}else fe.transparent===!0&&fe.side===Dr?(fe.side=Qt,fe.needsUpdate=!0,g.renderBufferDirect(Y,q,te,fe,F,Fe),fe.side=Js,fe.needsUpdate=!0,g.renderBufferDirect(Y,q,te,fe,F,Fe),fe.side=Dr):g.renderBufferDirect(Y,q,te,fe,F,Fe);F.onAfterRender(g,q,Y,te,fe,Fe)}function js(F,q,Y){q.isScene!==!0&&(q=O);let te=X.get(F),fe=h.state.lights,Fe=h.state.shadowsArray,Le=fe.state.version,Te=C.getParameters(F,fe.state,Fe,q,Y),Re=C.getProgramCacheKey(Te),Ae=te.programs;te.environment=F.isMeshStandardMaterial?q.environment:null,te.fog=q.fog,te.envMap=J.get(F.envMap||te.environment),Ae===void 0&&(F.addEventListener("dispose",Be),Ae=new Map,te.programs=Ae);let ze=Ae.get(Re);if(ze!==void 0){if(te.currentProgram===ze&&te.lightsStateVersion===Le)return xl(F,Te),ze}else Te.uniforms=C.getUniforms(F),F.onBuild(Te,g),F.onBeforeCompile(Te,g),ze=C.acquireProgram(Te,Re),Ae.set(Re,ze),te.uniforms=Te.uniforms;let Ie=te.uniforms;(!F.isShaderMaterial&&!F.isRawShaderMaterial||F.clipping===!0)&&(Ie.clippingPlanes=me.uniform),xl(F,Te),te.needsLights=Me(F),te.lightsStateVersion=Le,te.needsLights&&(Ie.ambientLightColor.value=fe.state.ambient,Ie.lightProbe.value=fe.state.probe,Ie.directionalLights.value=fe.state.directional,Ie.directionalLightShadows.value=fe.state.directionalShadow,Ie.spotLights.value=fe.state.spot,Ie.spotLightShadows.value=fe.state.spotShadow,Ie.rectAreaLights.value=fe.state.rectArea,Ie.ltc_1.value=fe.state.rectAreaLTC1,Ie.ltc_2.value=fe.state.rectAreaLTC2,Ie.pointLights.value=fe.state.point,Ie.pointLightShadows.value=fe.state.pointShadow,Ie.hemisphereLights.value=fe.state.hemi,Ie.directionalShadowMap.value=fe.state.directionalShadowMap,Ie.directionalShadowMatrix.value=fe.state.directionalShadowMatrix,Ie.spotShadowMap.value=fe.state.spotShadowMap,Ie.spotShadowMatrix.value=fe.state.spotShadowMatrix,Ie.pointShadowMap.value=fe.state.pointShadowMap,Ie.pointShadowMatrix.value=fe.state.pointShadowMatrix);let je=ze.getUniforms(),rt=oa.seqWithValue(je.seq,Ie);return te.currentProgram=ze,te.uniformsList=rt,ze}function xl(F,q){let Y=X.get(F);Y.outputEncoding=q.outputEncoding,Y.instancing=q.instancing,Y.skinning=q.skinning,Y.numClippingPlanes=q.numClippingPlanes,Y.numIntersection=q.numClipIntersection,Y.vertexAlphas=q.vertexAlphas}function re(F,q,Y,te){q.isScene!==!0&&(q=O),$.resetTextureUnits();let fe=q.fog,Fe=Y.isMeshStandardMaterial?q.environment:null,Le=x===null?g.outputEncoding:x.texture.encoding,Te=J.get(Y.envMap||Fe),Re=Y.vertexColors===!0&&te.geometry&&te.geometry.attributes.color&&te.geometry.attributes.color.itemSize===4,Ae=X.get(Y),ze=h.state.lights;if(z===!0&&(se===!0||F!==w)){let it=F===w&&Y.id===_;me.setState(Y,F,it)}let Ie=!1;Y.version===Ae.__version?(Ae.needsLights&&Ae.lightsStateVersion!==ze.state.version||Ae.outputEncoding!==Le||te.isInstancedMesh&&Ae.instancing===!1||!te.isInstancedMesh&&Ae.instancing===!0||te.isSkinnedMesh&&Ae.skinning===!1||!te.isSkinnedMesh&&Ae.skinning===!0||Ae.envMap!==Te||Y.fog&&Ae.fog!==fe||Ae.numClippingPlanes!==void 0&&(Ae.numClippingPlanes!==me.numPlanes||Ae.numIntersection!==me.numIntersection)||Ae.vertexAlphas!==Re)&&(Ie=!0):(Ie=!0,Ae.__version=Y.version);let je=Ae.currentProgram;Ie===!0&&(je=js(Y,q,te));let rt=!1,at=!1,dt=!1,Ke=je.getUniforms(),Ct=Ae.uniforms;if(pe.useProgram(je.program)&&(rt=!0,at=!0,dt=!0),Y.id!==_&&(_=Y.id,at=!0),rt||w!==F){if(Ke.setValue(V,"projectionMatrix",F.projectionMatrix),ye.logarithmicDepthBuffer&&Ke.setValue(V,"logDepthBufFC",2/(Math.log(F.far+1)/Math.LN2)),w!==F&&(w=F,at=!0,dt=!0),Y.isShaderMaterial||Y.isMeshPhongMaterial||Y.isMeshToonMaterial||Y.isMeshStandardMaterial||Y.envMap){let it=Ke.map.cameraPosition;it!==void 0&&it.setValue(V,j.setFromMatrixPosition(F.matrixWorld))}(Y.isMeshPhongMaterial||Y.isMeshToonMaterial||Y.isMeshLambertMaterial||Y.isMeshBasicMaterial||Y.isMeshStandardMaterial||Y.isShaderMaterial)&&Ke.setValue(V,"isOrthographic",F.isOrthographicCamera===!0),(Y.isMeshPhongMaterial||Y.isMeshToonMaterial||Y.isMeshLambertMaterial||Y.isMeshBasicMaterial||Y.isMeshStandardMaterial||Y.isShaderMaterial||Y.isShadowMaterial||te.isSkinnedMesh)&&Ke.setValue(V,"viewMatrix",F.matrixWorldInverse)}if(te.isSkinnedMesh){Ke.setOptional(V,te,"bindMatrix"),Ke.setOptional(V,te,"bindMatrixInverse");let it=te.skeleton;it&&(ye.floatVertexTextures?(it.boneTexture===null&&it.computeBoneTexture(),Ke.setValue(V,"boneTexture",it.boneTexture,$),Ke.setValue(V,"boneTextureSize",it.boneTextureSize)):Ke.setOptional(V,it,"boneMatrices"))}return(at||Ae.receiveShadow!==te.receiveShadow)&&(Ae.receiveShadow=te.receiveShadow,Ke.setValue(V,"receiveShadow",te.receiveShadow)),at&&(Ke.setValue(V,"toneMappingExposure",g.toneMappingExposure),Ae.needsLights&&Ce(Ct,dt),fe&&Y.fog&&W.refreshFogUniforms(Ct,fe),W.refreshMaterialUniforms(Ct,Y,L,A,ne),oa.upload(V,Ae.uniformsList,Ct,$)),Y.isShaderMaterial&&Y.uniformsNeedUpdate===!0&&(oa.upload(V,Ae.uniformsList,Ct,$),Y.uniformsNeedUpdate=!1),Y.isSpriteMaterial&&Ke.setValue(V,"center",te.center),Ke.setValue(V,"modelViewMatrix",te.modelViewMatrix),Ke.setValue(V,"normalMatrix",te.normalMatrix),Ke.setValue(V,"modelMatrix",te.matrixWorld),je}function Ce(F,q){F.ambientLightColor.needsUpdate=q,F.lightProbe.needsUpdate=q,F.directionalLights.needsUpdate=q,F.directionalLightShadows.needsUpdate=q,F.pointLights.needsUpdate=q,F.pointLightShadows.needsUpdate=q,F.spotLights.needsUpdate=q,F.spotLightShadows.needsUpdate=q,F.rectAreaLights.needsUpdate=q,F.hemisphereLights.needsUpdate=q}function Me(F){return F.isMeshLambertMaterial||F.isMeshToonMaterial||F.isMeshPhongMaterial||F.isMeshStandardMaterial||F.isShadowMaterial||F.isShaderMaterial&&F.lights===!0}this.getActiveCubeFace=function(){return y},this.getActiveMipmapLevel=function(){return m},this.getRenderTarget=function(){return x},this.setRenderTarget=function(F,q=0,Y=0){x=F,y=q,m=Y,F&&X.get(F).__webglFramebuffer===void 0&&$.setupRenderTarget(F);let te=null,fe=!1,Fe=!1;if(F){let Te=F.texture;(Te.isDataTexture3D||Te.isDataTexture2DArray)&&(Fe=!0);let Re=X.get(F).__webglFramebuffer;F.isWebGLCubeRenderTarget?(te=Re[q],fe=!0):F.isWebGLMultisampleRenderTarget?te=X.get(F).__webglMultisampledFramebuffer:te=Re,b.copy(F.viewport),M.copy(F.scissor),S=F.scissorTest}else b.copy(D).multiplyScalar(L).floor(),M.copy(P).multiplyScalar(L).floor(),S=I;if(pe.bindFramebuffer(36160,te)&&ye.drawBuffers){let Te=!1;if(F)if(F.isWebGLMultipleRenderTargets){let Re=F.texture;if(N.length!==Re.length||N[0]!==36064){for(let Ae=0,ze=Re.length;Ae<ze;Ae++)N[Ae]=36064+Ae;N.length=Re.length,Te=!0}}else(N.length!==1||N[0]!==36064)&&(N[0]=36064,N.length=1,Te=!0);else(N.length!==1||N[0]!==1029)&&(N[0]=1029,N.length=1,Te=!0);Te&&(ye.isWebGL2?V.drawBuffers(N):ue.get("WEBGL_draw_buffers").drawBuffersWEBGL(N))}if(pe.viewport(b),pe.scissor(M),pe.setScissorTest(S),fe){let Te=X.get(F.texture);V.framebufferTexture2D(36160,36064,34069+q,Te.__webglTexture,Y)}else if(Fe){let Te=X.get(F.texture),Re=q||0;V.framebufferTextureLayer(36160,36064,Te.__webglTexture,Y||0,Re)}},this.readRenderTargetPixels=function(F,q,Y,te,fe,Fe,Le){if(!(F&&F.isWebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}let Te=X.get(F).__webglFramebuffer;if(F.isWebGLCubeRenderTarget&&Le!==void 0&&(Te=Te[Le]),Te){pe.bindFramebuffer(36160,Te);try{let Re=F.texture,Ae=Re.format,ze=Re.type;if(Ae!==Fi&&de.convert(Ae)!==V.getParameter(35739)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}let Ie=ze===Ml&&(ue.has("EXT_color_buffer_half_float")||ye.isWebGL2&&ue.has("EXT_color_buffer_float"));if(ze!==bl&&de.convert(ze)!==V.getParameter(35738)&&!(ze===$s&&(ye.isWebGL2||ue.has("OES_texture_float")||ue.has("WEBGL_color_buffer_float")))&&!Ie){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}V.checkFramebufferStatus(36160)===36053?q>=0&&q<=F.width-te&&Y>=0&&Y<=F.height-fe&&V.readPixels(q,Y,te,fe,de.convert(Ae),de.convert(ze),Fe):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.")}finally{let Re=x!==null?X.get(x).__webglFramebuffer:null;pe.bindFramebuffer(36160,Re)}}},this.copyFramebufferToTexture=function(F,q,Y=0){let te=Math.pow(2,-Y),fe=Math.floor(q.image.width*te),Fe=Math.floor(q.image.height*te),Le=de.convert(q.format);ye.isWebGL2&&(Le===6407&&(Le=32849),Le===6408&&(Le=32856)),$.setTexture2D(q,0),V.copyTexImage2D(3553,Y,Le,F.x,F.y,fe,Fe,0),pe.unbindTexture()},this.copyTextureToTexture=function(F,q,Y,te=0){let fe=q.image.width,Fe=q.image.height,Le=de.convert(Y.format),Te=de.convert(Y.type);$.setTexture2D(Y,0),V.pixelStorei(37440,Y.flipY),V.pixelStorei(37441,Y.premultiplyAlpha),V.pixelStorei(3317,Y.unpackAlignment),q.isDataTexture?V.texSubImage2D(3553,te,F.x,F.y,fe,Fe,Le,Te,q.image.data):q.isCompressedTexture?V.compressedTexSubImage2D(3553,te,F.x,F.y,q.mipmaps[0].width,q.mipmaps[0].height,Le,q.mipmaps[0].data):V.texSubImage2D(3553,te,F.x,F.y,Le,Te,q.image),te===0&&Y.generateMipmaps&&V.generateMipmap(3553),pe.unbindTexture()},this.copyTextureToTexture3D=function(F,q,Y,te,fe=0){if(g.isWebGL1Renderer){console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");return}let Fe=F.max.x-F.min.x+1,Le=F.max.y-F.min.y+1,Te=F.max.z-F.min.z+1,Re=de.convert(te.format),Ae=de.convert(te.type),ze;if(te.isDataTexture3D)$.setTexture3D(te,0),ze=32879;else if(te.isDataTexture2DArray)$.setTexture2DArray(te,0),ze=35866;else{console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");return}V.pixelStorei(37440,te.flipY),V.pixelStorei(37441,te.premultiplyAlpha),V.pixelStorei(3317,te.unpackAlignment);let Ie=V.getParameter(3314),je=V.getParameter(32878),rt=V.getParameter(3316),at=V.getParameter(3315),dt=V.getParameter(32877),Ke=Y.isCompressedTexture?Y.mipmaps[0]:Y.image;V.pixelStorei(3314,Ke.width),V.pixelStorei(32878,Ke.height),V.pixelStorei(3316,F.min.x),V.pixelStorei(3315,F.min.y),V.pixelStorei(32877,F.min.z),Y.isDataTexture||Y.isDataTexture3D?V.texSubImage3D(ze,fe,q.x,q.y,q.z,Fe,Le,Te,Re,Ae,Ke.data):Y.isCompressedTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),V.compressedTexSubImage3D(ze,fe,q.x,q.y,q.z,Fe,Le,Te,Re,Ke.data)):V.texSubImage3D(ze,fe,q.x,q.y,q.z,Fe,Le,Te,Re,Ae,Ke),V.pixelStorei(3314,Ie),V.pixelStorei(32878,je),V.pixelStorei(3316,rt),V.pixelStorei(3315,at),V.pixelStorei(32877,dt),fe===0&&te.generateMipmaps&&V.generateMipmap(ze),pe.unbindTexture()},this.initTexture=function(F){$.setTexture2D(F,0),pe.unbindTexture()},this.resetState=function(){y=0,m=0,x=null,pe.reset(),K.reset()},typeof __THREE_DEVTOOLS__!="undefined"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}var X_=class extends Rt{};X_.prototype.isWebGL1Renderer=!0;var fu=class{constructor(e,t=25e-5){this.name="",this.color=new De(e),this.density=t}clone(){return new fu(this.color,this.density)}toJSON(){return{type:"FogExp2",color:this.color.getHex(),density:this.density}}};fu.prototype.isFogExp2=!0;var pu=class{constructor(e,t=1,n=1e3){this.name="",this.color=new De(e),this.near=t,this.far=n}clone(){return new pu(this.color,this.near,this.far)}toJSON(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}}};pu.prototype.isFog=!0;var Dl=class extends $e{constructor(){super();this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0,typeof __THREE_DEVTOOLS__!="undefined"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),e.background!==null&&(this.background=e.background.clone()),e.environment!==null&&(this.environment=e.environment.clone()),e.fog!==null&&(this.fog=e.fog.clone()),e.overrideMaterial!==null&&(this.overrideMaterial=e.overrideMaterial.clone()),this.autoUpdate=e.autoUpdate,this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){let t=super.toJSON(e);return this.fog!==null&&(t.object.fog=this.fog.toJSON()),t}};Dl.prototype.isScene=!0;var ds=class{constructor(e,t){this.array=e,this.stride=t,this.count=e!==void 0?e.length/t:0,this.usage=eo,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=Xi()}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}copyAt(e,t,n){e*=this.stride,n*=t.stride;for(let i=0,r=this.stride;i<r;i++)this.array[e+i]=t.array[n+i];return this}set(e,t=0){return this.array.set(e,t),this}clone(e){e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=Xi()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);let t=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),n=new this.constructor(t,this.stride);return n.setUsage(this.usage),n}onUpload(e){return this.onUploadCallback=e,this}toJSON(e){return e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=Xi()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=Array.prototype.slice.call(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}};ds.prototype.isInterleavedBuffer=!0;var pn=new U,kr=class{constructor(e,t,n,i=!1){this.name="",this.data=e,this.itemSize=t,this.offset=n,this.normalized=i===!0}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){this.data.needsUpdate=e}applyMatrix4(e){for(let t=0,n=this.data.count;t<n;t++)pn.x=this.getX(t),pn.y=this.getY(t),pn.z=this.getZ(t),pn.applyMatrix4(e),this.setXYZ(t,pn.x,pn.y,pn.z);return this}applyNormalMatrix(e){for(let t=0,n=this.count;t<n;t++)pn.x=this.getX(t),pn.y=this.getY(t),pn.z=this.getZ(t),pn.applyNormalMatrix(e),this.setXYZ(t,pn.x,pn.y,pn.z);return this}transformDirection(e){for(let t=0,n=this.count;t<n;t++)pn.x=this.getX(t),pn.y=this.getY(t),pn.z=this.getZ(t),pn.transformDirection(e),this.setXYZ(t,pn.x,pn.y,pn.z);return this}setX(e,t){return this.data.array[e*this.data.stride+this.offset]=t,this}setY(e,t){return this.data.array[e*this.data.stride+this.offset+1]=t,this}setZ(e,t){return this.data.array[e*this.data.stride+this.offset+2]=t,this}setW(e,t){return this.data.array[e*this.data.stride+this.offset+3]=t,this}getX(e){return this.data.array[e*this.data.stride+this.offset]}getY(e){return this.data.array[e*this.data.stride+this.offset+1]}getZ(e){return this.data.array[e*this.data.stride+this.offset+2]}getW(e){return this.data.array[e*this.data.stride+this.offset+3]}setXY(e,t,n){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=n,this}setXYZ(e,t,n,i){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=i,this}setXYZW(e,t,n,i,r){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=i,this.data.array[e+3]=r,this}clone(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interlaved buffer attribute will deinterleave buffer data.");let t=[];for(let n=0;n<this.count;n++){let i=n*this.data.stride+this.offset;for(let r=0;r<this.itemSize;r++)t.push(this.data.array[i+r])}return new Ye(new this.array.constructor(t),this.itemSize,this.normalized)}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new kr(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interlaved buffer attribute will deinterleave buffer data.");let t=[];for(let n=0;n<this.count;n++){let i=n*this.data.stride+this.offset;for(let r=0;r<this.itemSize;r++)t.push(this.data.array[i+r])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:t,normalized:this.normalized}}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}};kr.prototype.isInterleavedBufferAttribute=!0;var pf=class extends un{constructor(e){super();this.type="SpriteMaterial",this.color=new De(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this}};pf.prototype.isSpriteMaterial=!0;var mu,mf=new U,gu=new U,yu=new U,vu=new _e,gf=new _e,QA=new Pe,Tg=new U,yf=new U,Eg=new U,eC=new _e,q_=new _e,tC=new _e,vf=class extends $e{constructor(e){super();if(this.type="Sprite",mu===void 0){mu=new Ue;let t=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),n=new ds(t,5);mu.setIndex([0,1,2,0,2,3]),mu.setAttribute("position",new kr(n,3,0,!1)),mu.setAttribute("uv",new kr(n,2,3,!1))}this.geometry=mu,this.material=e!==void 0?e:new pf,this.center=new _e(.5,.5)}raycast(e,t){e.camera===null&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),gu.setFromMatrixScale(this.matrixWorld),QA.copy(e.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(e.camera.matrixWorldInverse,this.matrixWorld),yu.setFromMatrixPosition(this.modelViewMatrix),e.camera.isPerspectiveCamera&&this.material.sizeAttenuation===!1&&gu.multiplyScalar(-yu.z);let n=this.material.rotation,i,r;n!==0&&(r=Math.cos(n),i=Math.sin(n));let s=this.center;Ag(Tg.set(-.5,-.5,0),yu,s,gu,i,r),Ag(yf.set(.5,-.5,0),yu,s,gu,i,r),Ag(Eg.set(.5,.5,0),yu,s,gu,i,r),eC.set(0,0),q_.set(1,0),tC.set(1,1);let a=e.ray.intersectTriangle(Tg,yf,Eg,!1,mf);if(a===null&&(Ag(yf.set(-.5,.5,0),yu,s,gu,i,r),q_.set(0,1),a=e.ray.intersectTriangle(Tg,Eg,yf,!1,mf),a===null))return;let l=e.ray.origin.distanceTo(mf);l<e.near||l>e.far||t.push({distance:l,point:mf.clone(),uv:Zt.getUV(mf,Tg,yf,Eg,eC,q_,tC,new _e),face:null,object:this})}copy(e){return super.copy(e),e.center!==void 0&&this.center.copy(e.center),this.material=e.material,this}};vf.prototype.isSprite=!0;function Ag(o,e,t,n,i,r){vu.subVectors(o,t).addScalar(.5).multiply(n),i!==void 0?(gf.x=r*vu.x-i*vu.y,gf.y=i*vu.x+r*vu.y):gf.copy(vu),o.copy(e),o.x+=gf.x,o.y+=gf.y,o.applyMatrix4(QA)}var Cg=new U,nC=new U,j_=class extends $e{constructor(){super();this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]},isLOD:{value:!0}}),this.autoUpdate=!0}copy(e){super.copy(e,!1);let t=e.levels;for(let n=0,i=t.length;n<i;n++){let r=t[n];this.addLevel(r.object.clone(),r.distance)}return this.autoUpdate=e.autoUpdate,this}addLevel(e,t=0){t=Math.abs(t);let n=this.levels,i;for(i=0;i<n.length&&!(t<n[i].distance);i++);return n.splice(i,0,{distance:t,object:e}),this.add(e),this}getCurrentLevel(){return this._currentLevel}getObjectForDistance(e){let t=this.levels;if(t.length>0){let n,i;for(n=1,i=t.length;n<i&&!(e<t[n].distance);n++);return t[n-1].object}return null}raycast(e,t){if(this.levels.length>0){Cg.setFromMatrixPosition(this.matrixWorld);let i=e.ray.origin.distanceTo(Cg);this.getObjectForDistance(i).raycast(e,t)}}update(e){let t=this.levels;if(t.length>1){Cg.setFromMatrixPosition(e.matrixWorld),nC.setFromMatrixPosition(this.matrixWorld);let n=Cg.distanceTo(nC)/e.zoom;t[0].object.visible=!0;let i,r;for(i=1,r=t.length;i<r&&n>=t[i].distance;i++)t[i-1].object.visible=!1,t[i].object.visible=!0;for(this._currentLevel=i-1;i<r;i++)t[i].object.visible=!1}}toJSON(e){let t=super.toJSON(e);this.autoUpdate===!1&&(t.object.autoUpdate=!1),t.object.levels=[];let n=this.levels;for(let i=0,r=n.length;i<r;i++){let s=n[i];t.object.levels.push({object:s.object.uuid,distance:s.distance})}return t}},iC=new U,rC=new tt,sC=new tt,v4=new U,oC=new Pe,lo=class extends et{constructor(e,t){super(e,t);this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new Pe,this.bindMatrixInverse=new Pe}copy(e){return super.copy(e),this.bindMode=e.bindMode,this.bindMatrix.copy(e.bindMatrix),this.bindMatrixInverse.copy(e.bindMatrixInverse),this.skeleton=e.skeleton,this}bind(e,t){this.skeleton=e,t===void 0&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.copy(t).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){let e=new tt,t=this.geometry.attributes.skinWeight;for(let n=0,i=t.count;n<i;n++){e.x=t.getX(n),e.y=t.getY(n),e.z=t.getZ(n),e.w=t.getW(n);let r=1/e.manhattanLength();r!==1/0?e.multiplyScalar(r):e.set(1,0,0,0),t.setXYZW(n,e.x,e.y,e.z,e.w)}}updateMatrixWorld(e){super.updateMatrixWorld(e),this.bindMode==="attached"?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode==="detached"?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}boneTransform(e,t){let n=this.skeleton,i=this.geometry;rC.fromBufferAttribute(i.attributes.skinIndex,e),sC.fromBufferAttribute(i.attributes.skinWeight,e),iC.fromBufferAttribute(i.attributes.position,e).applyMatrix4(this.bindMatrix),t.set(0,0,0);for(let r=0;r<4;r++){let s=sC.getComponent(r);if(s!==0){let a=rC.getComponent(r);oC.multiplyMatrices(n.bones[a].matrixWorld,n.boneInverses[a]),t.addScaledVector(v4.copy(iC).applyMatrix4(oC),s)}}return t.applyMatrix4(this.bindMatrixInverse)}};lo.prototype.isSkinnedMesh=!0;var fs=class extends $e{constructor(){super();this.type="Bone"}};fs.prototype.isBone=!0;var aa=class extends Vt{constructor(e=null,t=1,n=1,i,r,s,a,l,c=ln,u=ln,d,h){super(null,s,a,l,c,u,i,r,d,h);this.image={data:e,width:t,height:n},this.magFilter=c,this.minFilter=u,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.needsUpdate=!0}};aa.prototype.isDataTexture=!0;var aC=new Pe,x4=new Pe,co=class{constructor(e=[],t=[]){this.uuid=Xi(),this.bones=e.slice(0),this.boneInverses=t,this.boneMatrices=null,this.boneTexture=null,this.boneTextureSize=0,this.frame=-1,this.init()}init(){let e=this.bones,t=this.boneInverses;if(this.boneMatrices=new Float32Array(e.length*16),t.length===0)this.calculateInverses();else if(e.length!==t.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let n=0,i=this.bones.length;n<i;n++)this.boneInverses.push(new Pe)}}calculateInverses(){this.boneInverses.length=0;for(let e=0,t=this.bones.length;e<t;e++){let n=new Pe;this.bones[e]&&n.copy(this.bones[e].matrixWorld).invert(),this.boneInverses.push(n)}}pose(){for(let e=0,t=this.bones.length;e<t;e++){let n=this.bones[e];n&&n.matrixWorld.copy(this.boneInverses[e]).invert()}for(let e=0,t=this.bones.length;e<t;e++){let n=this.bones[e];n&&(n.parent&&n.parent.isBone?(n.matrix.copy(n.parent.matrixWorld).invert(),n.matrix.multiply(n.matrixWorld)):n.matrix.copy(n.matrixWorld),n.matrix.decompose(n.position,n.quaternion,n.scale))}}update(){let e=this.bones,t=this.boneInverses,n=this.boneMatrices,i=this.boneTexture;for(let r=0,s=e.length;r<s;r++){let a=e[r]?e[r].matrixWorld:x4;aC.multiplyMatrices(a,t[r]),aC.toArray(n,r*16)}i!==null&&(i.needsUpdate=!0)}clone(){return new co(this.bones,this.boneInverses)}computeBoneTexture(){let e=Math.sqrt(this.bones.length*4);e=dA(e),e=Math.max(e,4);let t=new Float32Array(e*e*4);t.set(this.boneMatrices);let n=new aa(t,e,e,Fi,$s);return this.boneMatrices=t,this.boneTexture=n,this.boneTextureSize=e,this}getBoneByName(e){for(let t=0,n=this.bones.length;t<n;t++){let i=this.bones[t];if(i.name===e)return i}}dispose(){this.boneTexture!==null&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(e,t){this.uuid=e.uuid;for(let n=0,i=e.bones.length;n<i;n++){let r=e.bones[n],s=t[r];s===void 0&&(console.warn("THREE.Skeleton: No bone found with UUID:",r),s=new fs),this.bones.push(s),this.boneInverses.push(new Pe().fromArray(e.boneInverses[n]))}return this.init(),this}toJSON(){let e={metadata:{version:4.5,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};e.uuid=this.uuid;let t=this.bones,n=this.boneInverses;for(let i=0,r=t.length;i<r;i++){let s=t[i];e.bones.push(s.uuid);let a=n[i];e.boneInverses.push(a.toArray())}return e}},lC=new Pe,cC=new Pe,Lg=[],xf=new et,Rg=class extends et{constructor(e,t,n){super(e,t);this.instanceMatrix=new Ye(new Float32Array(n*16),16),this.instanceColor=null,this.count=n,this.frustumCulled=!1}copy(e){return super.copy(e),this.instanceMatrix.copy(e.instanceMatrix),e.instanceColor!==null&&(this.instanceColor=e.instanceColor.clone()),this.count=e.count,this}getColorAt(e,t){t.fromArray(this.instanceColor.array,e*3)}getMatrixAt(e,t){t.fromArray(this.instanceMatrix.array,e*16)}raycast(e,t){let n=this.matrixWorld,i=this.count;if(xf.geometry=this.geometry,xf.material=this.material,xf.material!==void 0)for(let r=0;r<i;r++){this.getMatrixAt(r,lC),cC.multiplyMatrices(n,lC),xf.matrixWorld=cC,xf.raycast(e,Lg);for(let s=0,a=Lg.length;s<a;s++){let l=Lg[s];l.instanceId=r,l.object=this,t.push(l)}Lg.length=0}}setColorAt(e,t){this.instanceColor===null&&(this.instanceColor=new Ye(new Float32Array(this.count*3),3)),t.toArray(this.instanceColor.array,e*3)}setMatrixAt(e,t){t.toArray(this.instanceMatrix.array,e*16)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"})}};Rg.prototype.isInstancedMesh=!0;var zt=class extends un{constructor(e){super();this.type="LineBasicMaterial",this.color=new De(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.morphTargets=!1,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.morphTargets=e.morphTargets,this}};zt.prototype.isLineBasicMaterial=!0;var uC=new U,hC=new U,dC=new Pe,Y_=new io,Pg=new qi,ai=class extends $e{constructor(e=new Ue,t=new zt){super();this.type="Line",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e){return super.copy(e),this.material=e.material,this.geometry=e.geometry,this}computeLineDistances(){let e=this.geometry;if(e.isBufferGeometry)if(e.index===null){let t=e.attributes.position,n=[0];for(let i=1,r=t.count;i<r;i++)uC.fromBufferAttribute(t,i-1),hC.fromBufferAttribute(t,i),n[i]=n[i-1],n[i]+=uC.distanceTo(hC);e.setAttribute("lineDistance",new Ne(n,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else e.isGeometry&&console.error("THREE.Line.computeLineDistances() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");return this}raycast(e,t){let n=this.geometry,i=this.matrixWorld,r=e.params.Line.threshold,s=n.drawRange;if(n.boundingSphere===null&&n.computeBoundingSphere(),Pg.copy(n.boundingSphere),Pg.applyMatrix4(i),Pg.radius+=r,e.ray.intersectsSphere(Pg)===!1)return;dC.copy(i).invert(),Y_.copy(e.ray).applyMatrix4(dC);let a=r/((this.scale.x+this.scale.y+this.scale.z)/3),l=a*a,c=new U,u=new U,d=new U,h=new U,f=this.isLineSegments?2:1;if(n.isBufferGeometry){let p=n.index,v=n.attributes.position;if(p!==null){let y=Math.max(0,s.start),m=Math.min(p.count,s.start+s.count);for(let x=y,_=m-1;x<_;x+=f){let w=p.getX(x),b=p.getX(x+1);if(c.fromBufferAttribute(v,w),u.fromBufferAttribute(v,b),Y_.distanceSqToSegment(c,u,h,d)>l)continue;h.applyMatrix4(this.matrixWorld);let S=e.ray.origin.distanceTo(h);S<e.near||S>e.far||t.push({distance:S,point:d.clone().applyMatrix4(this.matrixWorld),index:x,face:null,faceIndex:null,object:this})}}else{let y=Math.max(0,s.start),m=Math.min(v.count,s.start+s.count);for(let x=y,_=m-1;x<_;x+=f){if(c.fromBufferAttribute(v,x),u.fromBufferAttribute(v,x+1),Y_.distanceSqToSegment(c,u,h,d)>l)continue;h.applyMatrix4(this.matrixWorld);let b=e.ray.origin.distanceTo(h);b<e.near||b>e.far||t.push({distance:b,point:d.clone().applyMatrix4(this.matrixWorld),index:x,face:null,faceIndex:null,object:this})}}}else n.isGeometry&&console.error("THREE.Line.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}updateMorphTargets(){let e=this.geometry;if(e.isBufferGeometry){let t=e.morphAttributes,n=Object.keys(t);if(n.length>0){let i=t[n[0]];if(i!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let r=0,s=i.length;r<s;r++){let a=i[r].name||String(r);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=r}}}}else{let t=e.morphTargets;t!==void 0&&t.length>0&&console.error("THREE.Line.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}};ai.prototype.isLine=!0;var fC=new U,pC=new U,An=class extends ai{constructor(e,t){super(e,t);this.type="LineSegments"}computeLineDistances(){let e=this.geometry;if(e.isBufferGeometry)if(e.index===null){let t=e.attributes.position,n=[];for(let i=0,r=t.count;i<r;i+=2)fC.fromBufferAttribute(t,i),pC.fromBufferAttribute(t,i+1),n[i]=i===0?0:n[i-1],n[i+1]=n[i]+fC.distanceTo(pC);e.setAttribute("lineDistance",new Ne(n,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else e.isGeometry&&console.error("THREE.LineSegments.computeLineDistances() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");return this}};An.prototype.isLineSegments=!0;var xu=class extends ai{constructor(e,t){super(e,t);this.type="LineLoop"}};xu.prototype.isLineLoop=!0;var ps=class extends un{constructor(e){super();this.type="PointsMaterial",this.color=new De(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.morphTargets=!1,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.morphTargets=e.morphTargets,this}};ps.prototype.isPointsMaterial=!0;var mC=new Pe,Z_=new io,Ig=new qi,Dg=new U,la=class extends $e{constructor(e=new Ue,t=new ps){super();this.type="Points",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e){return super.copy(e),this.material=e.material,this.geometry=e.geometry,this}raycast(e,t){let n=this.geometry,i=this.matrixWorld,r=e.params.Points.threshold,s=n.drawRange;if(n.boundingSphere===null&&n.computeBoundingSphere(),Ig.copy(n.boundingSphere),Ig.applyMatrix4(i),Ig.radius+=r,e.ray.intersectsSphere(Ig)===!1)return;mC.copy(i).invert(),Z_.copy(e.ray).applyMatrix4(mC);let a=r/((this.scale.x+this.scale.y+this.scale.z)/3),l=a*a;if(n.isBufferGeometry){let c=n.index,d=n.attributes.position;if(c!==null){let h=Math.max(0,s.start),f=Math.min(c.count,s.start+s.count);for(let p=h,g=f;p<g;p++){let v=c.getX(p);Dg.fromBufferAttribute(d,v),gC(Dg,v,l,i,e,t,this)}}else{let h=Math.max(0,s.start),f=Math.min(d.count,s.start+s.count);for(let p=h,g=f;p<g;p++)Dg.fromBufferAttribute(d,p),gC(Dg,p,l,i,e,t,this)}}else console.error("THREE.Points.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}updateMorphTargets(){let e=this.geometry;if(e.isBufferGeometry){let t=e.morphAttributes,n=Object.keys(t);if(n.length>0){let i=t[n[0]];if(i!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let r=0,s=i.length;r<s;r++){let a=i[r].name||String(r);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=r}}}}else{let t=e.morphTargets;t!==void 0&&t.length>0&&console.error("THREE.Points.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}};la.prototype.isPoints=!0;function gC(o,e,t,n,i,r,s){let a=Z_.distanceSqToPoint(o);if(a<t){let l=new U;Z_.closestPointToPoint(o,l),l.applyMatrix4(n);let c=i.ray.origin.distanceTo(l);if(c<i.near||c>i.far)return;r.push({distance:c,distanceToRay:Math.sqrt(a),point:l,index:e,face:null,object:s})}}var J_=class extends Vt{constructor(e,t,n,i,r,s,a,l,c){super(e,t,n,i,r,s,a,l,c);this.format=a!==void 0?a:Di,this.minFilter=s!==void 0?s:Lt,this.magFilter=r!==void 0?r:Lt,this.generateMipmaps=!1;let u=this;function d(){u.needsUpdate=!0,e.requestVideoFrameCallback(d)}"requestVideoFrameCallback"in e&&e.requestVideoFrameCallback(d)}clone(){return new this.constructor(this.image).copy(this)}update(){let e=this.image;"requestVideoFrameCallback"in e===!1&&e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}};J_.prototype.isVideoTexture=!0;var Fg=class extends Vt{constructor(e,t,n,i,r,s,a,l,c,u,d,h){super(null,s,a,l,c,u,i,r,d,h);this.image={width:t,height:n},this.mipmaps=e,this.flipY=!1,this.generateMipmaps=!1}};Fg.prototype.isCompressedTexture=!0;var K_=class extends Vt{constructor(e,t,n,i,r,s,a,l,c){super(e,t,n,i,r,s,a,l,c);this.needsUpdate=!0}};K_.prototype.isCanvasTexture=!0;var $_=class extends Vt{constructor(e,t,n,i,r,s,a,l,c,u){if(u=u!==void 0?u:Sl,u!==Sl&&u!==jc)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");n===void 0&&u===Sl&&(n=Kd),n===void 0&&u===jc&&(n=qc);super(null,i,r,s,a,l,u,n,c);this.image={width:e,height:t},this.magFilter=a!==void 0?a:ln,this.minFilter=l!==void 0?l:ln,this.flipY=!1,this.generateMipmaps=!1}};$_.prototype.isDepthTexture=!0;var _u=class extends Ue{constructor(e=1,t=8,n=0,i=Math.PI*2){super();this.type="CircleGeometry",this.parameters={radius:e,segments:t,thetaStart:n,thetaLength:i},t=Math.max(3,t);let r=[],s=[],a=[],l=[],c=new U,u=new _e;s.push(0,0,0),a.push(0,0,1),l.push(.5,.5);for(let d=0,h=3;d<=t;d++,h+=3){let f=n+d/t*i;c.x=e*Math.cos(f),c.y=e*Math.sin(f),s.push(c.x,c.y,c.z),a.push(0,0,1),u.x=(s[h]/e+1)/2,u.y=(s[h+1]/e+1)/2,l.push(u.x,u.y)}for(let d=1;d<=t;d++)r.push(d,d+1,0);this.setIndex(r),this.setAttribute("position",new Ne(s,3)),this.setAttribute("normal",new Ne(a,3)),this.setAttribute("uv",new Ne(l,2))}static fromJSON(e){return new _u(e.radius,e.segments,e.thetaStart,e.thetaLength)}},ca=class extends Ue{constructor(e=1,t=1,n=1,i=8,r=1,s=!1,a=0,l=Math.PI*2){super();this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:n,radialSegments:i,heightSegments:r,openEnded:s,thetaStart:a,thetaLength:l};let c=this;i=Math.floor(i),r=Math.floor(r);let u=[],d=[],h=[],f=[],p=0,g=[],v=n/2,y=0;m(),s===!1&&(e>0&&x(!0),t>0&&x(!1)),this.setIndex(u),this.setAttribute("position",new Ne(d,3)),this.setAttribute("normal",new Ne(h,3)),this.setAttribute("uv",new Ne(f,2));function m(){let _=new U,w=new U,b=0,M=(t-e)/n;for(let S=0;S<=r;S++){let E=[],A=S/r,L=A*(t-e)+e;for(let B=0;B<=i;B++){let R=B/i,D=R*l+a,P=Math.sin(D),I=Math.cos(D);w.x=L*P,w.y=-A*n+v,w.z=L*I,d.push(w.x,w.y,w.z),_.set(P,M,I).normalize(),h.push(_.x,_.y,_.z),f.push(R,1-A),E.push(p++)}g.push(E)}for(let S=0;S<i;S++)for(let E=0;E<r;E++){let A=g[E][S],L=g[E+1][S],B=g[E+1][S+1],R=g[E][S+1];u.push(A,L,R),u.push(L,B,R),b+=6}c.addGroup(y,b,0),y+=b}function x(_){let w=p,b=new _e,M=new U,S=0,E=_===!0?e:t,A=_===!0?1:-1;for(let B=1;B<=i;B++)d.push(0,v*A,0),h.push(0,A,0),f.push(.5,.5),p++;let L=p;for(let B=0;B<=i;B++){let D=B/i*l+a,P=Math.cos(D),I=Math.sin(D);M.x=E*I,M.y=v*A,M.z=E*P,d.push(M.x,M.y,M.z),h.push(0,A,0),b.x=P*.5+.5,b.y=I*.5*A+.5,f.push(b.x,b.y),p++}for(let B=0;B<i;B++){let R=w+B,D=L+B;_===!0?u.push(D,D+1,R):u.push(D+1,D,R),S+=3}c.addGroup(y,S,_===!0?1:2),y+=S}}static fromJSON(e){return new ca(e.radiusTop,e.radiusBottom,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}},wu=class extends ca{constructor(e=1,t=1,n=8,i=1,r=!1,s=0,a=Math.PI*2){super(0,e,t,n,i,r,s,a);this.type="ConeGeometry",this.parameters={radius:e,height:t,radialSegments:n,heightSegments:i,openEnded:r,thetaStart:s,thetaLength:a}}static fromJSON(e){return new wu(e.radius,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}},ms=class extends Ue{constructor(e,t,n=1,i=0){super();this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:t,radius:n,detail:i};let r=[],s=[];a(i),c(n),u(),this.setAttribute("position",new Ne(r,3)),this.setAttribute("normal",new Ne(r.slice(),3)),this.setAttribute("uv",new Ne(s,2)),i===0?this.computeVertexNormals():this.normalizeNormals();function a(m){let x=new U,_=new U,w=new U;for(let b=0;b<t.length;b+=3)f(t[b+0],x),f(t[b+1],_),f(t[b+2],w),l(x,_,w,m)}function l(m,x,_,w){let b=w+1,M=[];for(let S=0;S<=b;S++){M[S]=[];let E=m.clone().lerp(_,S/b),A=x.clone().lerp(_,S/b),L=b-S;for(let B=0;B<=L;B++)B===0&&S===b?M[S][B]=E:M[S][B]=E.clone().lerp(A,B/L)}for(let S=0;S<b;S++)for(let E=0;E<2*(b-S)-1;E++){let A=Math.floor(E/2);E%2==0?(h(M[S][A+1]),h(M[S+1][A]),h(M[S][A])):(h(M[S][A+1]),h(M[S+1][A+1]),h(M[S+1][A]))}}function c(m){let x=new U;for(let _=0;_<r.length;_+=3)x.x=r[_+0],x.y=r[_+1],x.z=r[_+2],x.normalize().multiplyScalar(m),r[_+0]=x.x,r[_+1]=x.y,r[_+2]=x.z}function u(){let m=new U;for(let x=0;x<r.length;x+=3){m.x=r[x+0],m.y=r[x+1],m.z=r[x+2];let _=v(m)/2/Math.PI+.5,w=y(m)/Math.PI+.5;s.push(_,1-w)}p(),d()}function d(){for(let m=0;m<s.length;m+=6){let x=s[m+0],_=s[m+2],w=s[m+4],b=Math.max(x,_,w),M=Math.min(x,_,w);b>.9&&M<.1&&(x<.2&&(s[m+0]+=1),_<.2&&(s[m+2]+=1),w<.2&&(s[m+4]+=1))}}function h(m){r.push(m.x,m.y,m.z)}function f(m,x){let _=m*3;x.x=e[_+0],x.y=e[_+1],x.z=e[_+2]}function p(){let m=new U,x=new U,_=new U,w=new U,b=new _e,M=new _e,S=new _e;for(let E=0,A=0;E<r.length;E+=9,A+=6){m.set(r[E+0],r[E+1],r[E+2]),x.set(r[E+3],r[E+4],r[E+5]),_.set(r[E+6],r[E+7],r[E+8]),b.set(s[A+0],s[A+1]),M.set(s[A+2],s[A+3]),S.set(s[A+4],s[A+5]),w.copy(m).add(x).add(_).divideScalar(3);let L=v(w);g(b,A+0,m,L),g(M,A+2,x,L),g(S,A+4,_,L)}}function g(m,x,_,w){w<0&&m.x===1&&(s[x]=m.x-1),_.x===0&&_.z===0&&(s[x]=w/2/Math.PI+.5)}function v(m){return Math.atan2(m.z,-m.x)}function y(m){return Math.atan2(-m.y,Math.sqrt(m.x*m.x+m.z*m.z))}}static fromJSON(e){return new ms(e.vertices,e.indices,e.radius,e.details)}},bu=class extends ms{constructor(e=1,t=0){let n=(1+Math.sqrt(5))/2,i=1/n,r=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-i,-n,0,-i,n,0,i,-n,0,i,n,-i,-n,0,-i,n,0,i,-n,0,i,n,0,-n,0,-i,n,0,-i,-n,0,i,n,0,i],s=[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9];super(r,s,e,t);this.type="DodecahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new bu(e.radius,e.detail)}},Bg=new U,Ng=new U,Q_=new U,Og=new Zt,kg=class extends Ue{constructor(e,t){super();if(this.type="EdgesGeometry",this.parameters={thresholdAngle:t},t=t!==void 0?t:1,e.isGeometry===!0){console.error("THREE.EdgesGeometry no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");return}let i=Math.pow(10,4),r=Math.cos(Cl*t),s=e.getIndex(),a=e.getAttribute("position"),l=s?s.count:a.count,c=[0,0,0],u=["a","b","c"],d=new Array(3),h={},f=[];for(let p=0;p<l;p+=3){s?(c[0]=s.getX(p),c[1]=s.getX(p+1),c[2]=s.getX(p+2)):(c[0]=p,c[1]=p+1,c[2]=p+2);let{a:g,b:v,c:y}=Og;if(g.fromBufferAttribute(a,c[0]),v.fromBufferAttribute(a,c[1]),y.fromBufferAttribute(a,c[2]),Og.getNormal(Q_),d[0]=`${Math.round(g.x*i)},${Math.round(g.y*i)},${Math.round(g.z*i)}`,d[1]=`${Math.round(v.x*i)},${Math.round(v.y*i)},${Math.round(v.z*i)}`,d[2]=`${Math.round(y.x*i)},${Math.round(y.y*i)},${Math.round(y.z*i)}`,!(d[0]===d[1]||d[1]===d[2]||d[2]===d[0]))for(let m=0;m<3;m++){let x=(m+1)%3,_=d[m],w=d[x],b=Og[u[m]],M=Og[u[x]],S=`${_}_${w}`,E=`${w}_${_}`;E in h&&h[E]?(Q_.dot(h[E].normal)<=r&&(f.push(b.x,b.y,b.z),f.push(M.x,M.y,M.z)),h[E]=null):S in h||(h[S]={index0:c[m],index1:c[x],normal:Q_.clone()})}}for(let p in h)if(h[p]){let{index0:g,index1:v}=h[p];Bg.fromBufferAttribute(a,g),Ng.fromBufferAttribute(a,v),f.push(Bg.x,Bg.y,Bg.z),f.push(Ng.x,Ng.y,Ng.z)}this.setAttribute("position",new Ne(f,3))}},li=class{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(e,t){let n=this.getUtoTmapping(e);return this.getPoint(n,t)}getPoints(e=5){let t=[];for(let n=0;n<=e;n++)t.push(this.getPoint(n/e));return t}getSpacedPoints(e=5){let t=[];for(let n=0;n<=e;n++)t.push(this.getPointAt(n/e));return t}getLength(){let e=this.getLengths();return e[e.length-1]}getLengths(e=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;let t=[],n,i=this.getPoint(0),r=0;t.push(0);for(let s=1;s<=e;s++)n=this.getPoint(s/e),r+=n.distanceTo(i),t.push(r),i=n;return this.cacheArcLengths=t,t}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(e,t){let n=this.getLengths(),i=0,r=n.length,s;t?s=t:s=e*n[r-1];let a=0,l=r-1,c;for(;a<=l;)if(i=Math.floor(a+(l-a)/2),c=n[i]-s,c<0)a=i+1;else if(c>0)l=i-1;else{l=i;break}if(i=l,n[i]===s)return i/(r-1);let u=n[i],h=n[i+1]-u,f=(s-u)/h;return(i+f)/(r-1)}getTangent(e,t){let n=1e-4,i=e-n,r=e+n;i<0&&(i=0),r>1&&(r=1);let s=this.getPoint(i),a=this.getPoint(r),l=t||(s.isVector2?new _e:new U);return l.copy(a).sub(s).normalize(),l}getTangentAt(e,t){let n=this.getUtoTmapping(e);return this.getTangent(n,t)}computeFrenetFrames(e,t){let n=new U,i=[],r=[],s=[],a=new U,l=new Pe;for(let f=0;f<=e;f++){let p=f/e;i[f]=this.getTangentAt(p,new U),i[f].normalize()}r[0]=new U,s[0]=new U;let c=Number.MAX_VALUE,u=Math.abs(i[0].x),d=Math.abs(i[0].y),h=Math.abs(i[0].z);u<=c&&(c=u,n.set(1,0,0)),d<=c&&(c=d,n.set(0,1,0)),h<=c&&n.set(0,0,1),a.crossVectors(i[0],n).normalize(),r[0].crossVectors(i[0],a),s[0].crossVectors(i[0],r[0]);for(let f=1;f<=e;f++){if(r[f]=r[f-1].clone(),s[f]=s[f-1].clone(),a.crossVectors(i[f-1],i[f]),a.length()>Number.EPSILON){a.normalize();let p=Math.acos(jn(i[f-1].dot(i[f]),-1,1));r[f].applyMatrix4(l.makeRotationAxis(a,p))}s[f].crossVectors(i[f],r[f])}if(t===!0){let f=Math.acos(jn(r[0].dot(r[e]),-1,1));f/=e,i[0].dot(a.crossVectors(r[0],r[e]))>0&&(f=-f);for(let p=1;p<=e;p++)r[p].applyMatrix4(l.makeRotationAxis(i[p],f*p)),s[p].crossVectors(i[p],r[p])}return{tangents:i,normals:r,binormals:s}}clone(){return new this.constructor().copy(this)}copy(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}toJSON(){let e={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e}fromJSON(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}},Mu=class extends li{constructor(e=0,t=0,n=1,i=1,r=0,s=Math.PI*2,a=!1,l=0){super();this.type="EllipseCurve",this.aX=e,this.aY=t,this.xRadius=n,this.yRadius=i,this.aStartAngle=r,this.aEndAngle=s,this.aClockwise=a,this.aRotation=l}getPoint(e,t){let n=t||new _e,i=Math.PI*2,r=this.aEndAngle-this.aStartAngle,s=Math.abs(r)<Number.EPSILON;for(;r<0;)r+=i;for(;r>i;)r-=i;r<Number.EPSILON&&(s?r=0:r=i),this.aClockwise===!0&&!s&&(r===i?r=-i:r=r-i);let a=this.aStartAngle+e*r,l=this.aX+this.xRadius*Math.cos(a),c=this.aY+this.yRadius*Math.sin(a);if(this.aRotation!==0){let u=Math.cos(this.aRotation),d=Math.sin(this.aRotation),h=l-this.aX,f=c-this.aY;l=h*u-f*d+this.aX,c=h*d+f*u+this.aY}return n.set(l,c)}copy(e){return super.copy(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}toJSON(){let e=super.toJSON();return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e}fromJSON(e){return super.fromJSON(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}};Mu.prototype.isEllipseCurve=!0;var zg=class extends Mu{constructor(e,t,n,i,r,s){super(e,t,n,n,i,r,s);this.type="ArcCurve"}};zg.prototype.isArcCurve=!0;function ew(){let o=0,e=0,t=0,n=0;function i(r,s,a,l){o=r,e=a,t=-3*r+3*s-2*a-l,n=2*r-2*s+a+l}return{initCatmullRom:function(r,s,a,l,c){i(s,a,c*(a-r),c*(l-s))},initNonuniformCatmullRom:function(r,s,a,l,c,u,d){let h=(s-r)/c-(a-r)/(c+u)+(a-s)/u,f=(a-s)/u-(l-s)/(u+d)+(l-a)/d;h*=u,f*=u,i(s,a,h,f)},calc:function(r){let s=r*r,a=s*r;return o+e*r+t*s+n*a}}}var Ug=new U,tw=new ew,nw=new ew,iw=new ew,Hg=class extends li{constructor(e=[],t=!1,n="centripetal",i=.5){super();this.type="CatmullRomCurve3",this.points=e,this.closed=t,this.curveType=n,this.tension=i}getPoint(e,t=new U){let n=t,i=this.points,r=i.length,s=(r-(this.closed?0:1))*e,a=Math.floor(s),l=s-a;this.closed?a+=a>0?0:(Math.floor(Math.abs(a)/r)+1)*r:l===0&&a===r-1&&(a=r-2,l=1);let c,u;this.closed||a>0?c=i[(a-1)%r]:(Ug.subVectors(i[0],i[1]).add(i[0]),c=Ug);let d=i[a%r],h=i[(a+1)%r];if(this.closed||a+2<r?u=i[(a+2)%r]:(Ug.subVectors(i[r-1],i[r-2]).add(i[r-1]),u=Ug),this.curveType==="centripetal"||this.curveType==="chordal"){let f=this.curveType==="chordal"?.5:.25,p=Math.pow(c.distanceToSquared(d),f),g=Math.pow(d.distanceToSquared(h),f),v=Math.pow(h.distanceToSquared(u),f);g<1e-4&&(g=1),p<1e-4&&(p=g),v<1e-4&&(v=g),tw.initNonuniformCatmullRom(c.x,d.x,h.x,u.x,p,g,v),nw.initNonuniformCatmullRom(c.y,d.y,h.y,u.y,p,g,v),iw.initNonuniformCatmullRom(c.z,d.z,h.z,u.z,p,g,v)}else this.curveType==="catmullrom"&&(tw.initCatmullRom(c.x,d.x,h.x,u.x,this.tension),nw.initCatmullRom(c.y,d.y,h.y,u.y,this.tension),iw.initCatmullRom(c.z,d.z,h.z,u.z,this.tension));return n.set(tw.calc(l),nw.calc(l),iw.calc(l)),n}copy(e){super.copy(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){let i=e.points[t];this.points.push(i.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}toJSON(){let e=super.toJSON();e.points=[];for(let t=0,n=this.points.length;t<n;t++){let i=this.points[t];e.points.push(i.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){let i=e.points[t];this.points.push(new U().fromArray(i))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}};Hg.prototype.isCatmullRomCurve3=!0;function yC(o,e,t,n,i){let r=(n-e)*.5,s=(i-t)*.5,a=o*o,l=o*a;return(2*t-2*n+r+s)*l+(-3*t+3*n-2*r-s)*a+r*o+t}function _4(o,e){let t=1-o;return t*t*e}function w4(o,e){return 2*(1-o)*o*e}function b4(o,e){return o*o*e}function _f(o,e,t,n){return _4(o,e)+w4(o,t)+b4(o,n)}function M4(o,e){let t=1-o;return t*t*t*e}function S4(o,e){let t=1-o;return 3*t*t*o*e}function T4(o,e){return 3*(1-o)*o*o*e}function E4(o,e){return o*o*o*e}function wf(o,e,t,n,i){return M4(o,e)+S4(o,t)+T4(o,n)+E4(o,i)}var bf=class extends li{constructor(e=new _e,t=new _e,n=new _e,i=new _e){super();this.type="CubicBezierCurve",this.v0=e,this.v1=t,this.v2=n,this.v3=i}getPoint(e,t=new _e){let n=t,i=this.v0,r=this.v1,s=this.v2,a=this.v3;return n.set(wf(e,i.x,r.x,s.x,a.x),wf(e,i.y,r.y,s.y,a.y)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){let e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}};bf.prototype.isCubicBezierCurve=!0;var Gg=class extends li{constructor(e=new U,t=new U,n=new U,i=new U){super();this.type="CubicBezierCurve3",this.v0=e,this.v1=t,this.v2=n,this.v3=i}getPoint(e,t=new U){let n=t,i=this.v0,r=this.v1,s=this.v2,a=this.v3;return n.set(wf(e,i.x,r.x,s.x,a.x),wf(e,i.y,r.y,s.y,a.y),wf(e,i.z,r.z,s.z,a.z)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){let e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}};Gg.prototype.isCubicBezierCurve3=!0;var Su=class extends li{constructor(e=new _e,t=new _e){super();this.type="LineCurve",this.v1=e,this.v2=t}getPoint(e,t=new _e){let n=t;return e===1?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(e).add(this.v1)),n}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e,t){let n=t||new _e;return n.copy(this.v2).sub(this.v1).normalize(),n}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){let e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}};Su.prototype.isLineCurve=!0;var rw=class extends li{constructor(e=new U,t=new U){super();this.type="LineCurve3",this.isLineCurve3=!0,this.v1=e,this.v2=t}getPoint(e,t=new U){let n=t;return e===1?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(e).add(this.v1)),n}getPointAt(e,t){return this.getPoint(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){let e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}},Mf=class extends li{constructor(e=new _e,t=new _e,n=new _e){super();this.type="QuadraticBezierCurve",this.v0=e,this.v1=t,this.v2=n}getPoint(e,t=new _e){let n=t,i=this.v0,r=this.v1,s=this.v2;return n.set(_f(e,i.x,r.x,s.x),_f(e,i.y,r.y,s.y)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){let e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}};Mf.prototype.isQuadraticBezierCurve=!0;var Vg=class extends li{constructor(e=new U,t=new U,n=new U){super();this.type="QuadraticBezierCurve3",this.v0=e,this.v1=t,this.v2=n}getPoint(e,t=new U){let n=t,i=this.v0,r=this.v1,s=this.v2;return n.set(_f(e,i.x,r.x,s.x),_f(e,i.y,r.y,s.y),_f(e,i.z,r.z,s.z)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){let e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}};Vg.prototype.isQuadraticBezierCurve3=!0;var Sf=class extends li{constructor(e=[]){super();this.type="SplineCurve",this.points=e}getPoint(e,t=new _e){let n=t,i=this.points,r=(i.length-1)*e,s=Math.floor(r),a=r-s,l=i[s===0?s:s-1],c=i[s],u=i[s>i.length-2?i.length-1:s+1],d=i[s>i.length-3?i.length-1:s+2];return n.set(yC(a,l.x,c.x,u.x,d.x),yC(a,l.y,c.y,u.y,d.y)),n}copy(e){super.copy(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){let i=e.points[t];this.points.push(i.clone())}return this}toJSON(){let e=super.toJSON();e.points=[];for(let t=0,n=this.points.length;t<n;t++){let i=this.points[t];e.points.push(i.toArray())}return e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){let i=e.points[t];this.points.push(new _e().fromArray(i))}return this}};Sf.prototype.isSplineCurve=!0;var sw=Object.freeze({__proto__:null,ArcCurve:zg,CatmullRomCurve3:Hg,CubicBezierCurve:bf,CubicBezierCurve3:Gg,EllipseCurve:Mu,LineCurve:Su,LineCurve3:rw,QuadraticBezierCurve:Mf,QuadraticBezierCurve3:Vg,SplineCurve:Sf}),A4={triangulate:function(o,e,t=2){let n=e&&e.length,i=n?e[0]*t:o.length,r=vC(o,0,i,t,!0),s=[];if(!r||r.next===r.prev)return s;let a,l,c,u,d,h,f;if(n&&(r=I4(o,e,r,t)),o.length>80*t){a=c=o[0],l=u=o[1];for(let p=t;p<i;p+=t)d=o[p],h=o[p+1],d<a&&(a=d),h<l&&(l=h),d>c&&(c=d),h>u&&(u=h);f=Math.max(c-a,u-l),f=f!==0?1/f:0}return Tf(r,s,t,a,l,f),s}};function vC(o,e,t,n,i){let r,s;if(i===V4(o,e,t,n)>0)for(r=e;r<t;r+=n)s=wC(r,o[r],o[r+1],s);else for(r=t-n;r>=e;r-=n)s=wC(r,o[r],o[r+1],s);return s&&Wg(s,s.next)&&(Af(s),s=s.next),s}function ua(o,e){if(!o)return o;e||(e=o);let t=o,n;do if(n=!1,!t.steiner&&(Wg(t,t.next)||en(t.prev,t,t.next)===0)){if(Af(t),t=e=t.prev,t===t.next)break;n=!0}else t=t.next;while(n||t!==e);return e}function Tf(o,e,t,n,i,r,s){if(!o)return;!s&&r&&O4(o,n,i,r);let a=o,l,c;for(;o.prev!==o.next;){if(l=o.prev,c=o.next,r?L4(o,n,i,r):C4(o)){e.push(l.i/t),e.push(o.i/t),e.push(c.i/t),Af(o),o=c.next,a=c.next;continue}if(o=c,o===a){s?s===1?(o=R4(ua(o),e,t),Tf(o,e,t,n,i,r,2)):s===2&&P4(o,e,t,n,i,r):Tf(ua(o),e,t,n,i,r,1);break}}}function C4(o){let e=o.prev,t=o,n=o.next;if(en(e,t,n)>=0)return!1;let i=o.next.next;for(;i!==o.prev;){if(Tu(e.x,e.y,t.x,t.y,n.x,n.y,i.x,i.y)&&en(i.prev,i,i.next)>=0)return!1;i=i.next}return!0}function L4(o,e,t,n){let i=o.prev,r=o,s=o.next;if(en(i,r,s)>=0)return!1;let a=i.x<r.x?i.x<s.x?i.x:s.x:r.x<s.x?r.x:s.x,l=i.y<r.y?i.y<s.y?i.y:s.y:r.y<s.y?r.y:s.y,c=i.x>r.x?i.x>s.x?i.x:s.x:r.x>s.x?r.x:s.x,u=i.y>r.y?i.y>s.y?i.y:s.y:r.y>s.y?r.y:s.y,d=ow(a,l,e,t,n),h=ow(c,u,e,t,n),f=o.prevZ,p=o.nextZ;for(;f&&f.z>=d&&p&&p.z<=h;){if(f!==o.prev&&f!==o.next&&Tu(i.x,i.y,r.x,r.y,s.x,s.y,f.x,f.y)&&en(f.prev,f,f.next)>=0||(f=f.prevZ,p!==o.prev&&p!==o.next&&Tu(i.x,i.y,r.x,r.y,s.x,s.y,p.x,p.y)&&en(p.prev,p,p.next)>=0))return!1;p=p.nextZ}for(;f&&f.z>=d;){if(f!==o.prev&&f!==o.next&&Tu(i.x,i.y,r.x,r.y,s.x,s.y,f.x,f.y)&&en(f.prev,f,f.next)>=0)return!1;f=f.prevZ}for(;p&&p.z<=h;){if(p!==o.prev&&p!==o.next&&Tu(i.x,i.y,r.x,r.y,s.x,s.y,p.x,p.y)&&en(p.prev,p,p.next)>=0)return!1;p=p.nextZ}return!0}function R4(o,e,t){let n=o;do{let i=n.prev,r=n.next.next;!Wg(i,r)&&xC(i,n,n.next,r)&&Ef(i,r)&&Ef(r,i)&&(e.push(i.i/t),e.push(n.i/t),e.push(r.i/t),Af(n),Af(n.next),n=o=r),n=n.next}while(n!==o);return ua(n)}function P4(o,e,t,n,i,r){let s=o;do{let a=s.next.next;for(;a!==s.prev;){if(s.i!==a.i&&U4(s,a)){let l=_C(s,a);s=ua(s,s.next),l=ua(l,l.next),Tf(s,e,t,n,i,r),Tf(l,e,t,n,i,r);return}a=a.next}s=s.next}while(s!==o)}function I4(o,e,t,n){let i=[],r,s,a,l,c;for(r=0,s=e.length;r<s;r++)a=e[r]*n,l=r<s-1?e[r+1]*n:o.length,c=vC(o,a,l,n,!1),c===c.next&&(c.steiner=!0),i.push(z4(c));for(i.sort(D4),r=0;r<i.length;r++)F4(i[r],t),t=ua(t,t.next);return t}function D4(o,e){return o.x-e.x}function F4(o,e){if(e=B4(o,e),e){let t=_C(e,o);ua(e,e.next),ua(t,t.next)}}function B4(o,e){let t=e,n=o.x,i=o.y,r=-1/0,s;do{if(i<=t.y&&i>=t.next.y&&t.next.y!==t.y){let h=t.x+(i-t.y)*(t.next.x-t.x)/(t.next.y-t.y);if(h<=n&&h>r){if(r=h,h===n){if(i===t.y)return t;if(i===t.next.y)return t.next}s=t.x<t.next.x?t:t.next}}t=t.next}while(t!==e);if(!s)return null;if(n===r)return s;let a=s,l=s.x,c=s.y,u=1/0,d;t=s;do n>=t.x&&t.x>=l&&n!==t.x&&Tu(i<c?n:r,i,l,c,i<c?r:n,i,t.x,t.y)&&(d=Math.abs(i-t.y)/(n-t.x),Ef(t,o)&&(d<u||d===u&&(t.x>s.x||t.x===s.x&&N4(s,t)))&&(s=t,u=d)),t=t.next;while(t!==a);return s}function N4(o,e){return en(o.prev,o,e.prev)<0&&en(e.next,o,o.next)<0}function O4(o,e,t,n){let i=o;do i.z===null&&(i.z=ow(i.x,i.y,e,t,n)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next;while(i!==o);i.prevZ.nextZ=null,i.prevZ=null,k4(i)}function k4(o){let e,t,n,i,r,s,a,l,c=1;do{for(t=o,o=null,r=null,s=0;t;){for(s++,n=t,a=0,e=0;e<c&&(a++,n=n.nextZ,!!n);e++);for(l=c;a>0||l>0&&n;)a!==0&&(l===0||!n||t.z<=n.z)?(i=t,t=t.nextZ,a--):(i=n,n=n.nextZ,l--),r?r.nextZ=i:o=i,i.prevZ=r,r=i;t=n}r.nextZ=null,c*=2}while(s>1);return o}function ow(o,e,t,n,i){return o=32767*(o-t)*i,e=32767*(e-n)*i,o=(o|o<<8)&16711935,o=(o|o<<4)&252645135,o=(o|o<<2)&858993459,o=(o|o<<1)&1431655765,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,o|e<<1}function z4(o){let e=o,t=o;do(e.x<t.x||e.x===t.x&&e.y<t.y)&&(t=e),e=e.next;while(e!==o);return t}function Tu(o,e,t,n,i,r,s,a){return(i-s)*(e-a)-(o-s)*(r-a)>=0&&(o-s)*(n-a)-(t-s)*(e-a)>=0&&(t-s)*(r-a)-(i-s)*(n-a)>=0}function U4(o,e){return o.next.i!==e.i&&o.prev.i!==e.i&&!H4(o,e)&&(Ef(o,e)&&Ef(e,o)&&G4(o,e)&&(en(o.prev,o,e.prev)||en(o,e.prev,e))||Wg(o,e)&&en(o.prev,o,o.next)>0&&en(e.prev,e,e.next)>0)}function en(o,e,t){return(e.y-o.y)*(t.x-e.x)-(e.x-o.x)*(t.y-e.y)}function Wg(o,e){return o.x===e.x&&o.y===e.y}function xC(o,e,t,n){let i=qg(en(o,e,t)),r=qg(en(o,e,n)),s=qg(en(t,n,o)),a=qg(en(t,n,e));return!!(i!==r&&s!==a||i===0&&Xg(o,t,e)||r===0&&Xg(o,n,e)||s===0&&Xg(t,o,n)||a===0&&Xg(t,e,n))}function Xg(o,e,t){return e.x<=Math.max(o.x,t.x)&&e.x>=Math.min(o.x,t.x)&&e.y<=Math.max(o.y,t.y)&&e.y>=Math.min(o.y,t.y)}function qg(o){return o>0?1:o<0?-1:0}function H4(o,e){let t=o;do{if(t.i!==o.i&&t.next.i!==o.i&&t.i!==e.i&&t.next.i!==e.i&&xC(t,t.next,o,e))return!0;t=t.next}while(t!==o);return!1}function Ef(o,e){return en(o.prev,o,o.next)<0?en(o,e,o.next)>=0&&en(o,o.prev,e)>=0:en(o,e,o.prev)<0||en(o,o.next,e)<0}function G4(o,e){let t=o,n=!1,i=(o.x+e.x)/2,r=(o.y+e.y)/2;do t.y>r!=t.next.y>r&&t.next.y!==t.y&&i<(t.next.x-t.x)*(r-t.y)/(t.next.y-t.y)+t.x&&(n=!n),t=t.next;while(t!==o);return n}function _C(o,e){let t=new aw(o.i,o.x,o.y),n=new aw(e.i,e.x,e.y),i=o.next,r=e.prev;return o.next=e,e.prev=o,t.next=i,i.prev=t,n.next=t,t.prev=n,r.next=n,n.prev=r,n}function wC(o,e,t,n){let i=new aw(o,e,t);return n?(i.next=n.next,i.prev=n,n.next.prev=i,n.next=i):(i.prev=i,i.next=i),i}function Af(o){o.next.prev=o.prev,o.prev.next=o.next,o.prevZ&&(o.prevZ.nextZ=o.nextZ),o.nextZ&&(o.nextZ.prevZ=o.prevZ)}function aw(o,e,t){this.i=o,this.x=e,this.y=t,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function V4(o,e,t,n){let i=0;for(let r=e,s=t-n;r<t;r+=n)i+=(o[s]-o[r])*(o[r+1]+o[s+1]),s=r;return i}var Zi=class{static area(e){let t=e.length,n=0;for(let i=t-1,r=0;r<t;i=r++)n+=e[i].x*e[r].y-e[r].x*e[i].y;return n*.5}static isClockWise(e){return Zi.area(e)<0}static triangulateShape(e,t){let n=[],i=[],r=[];bC(e),MC(n,e);let s=e.length;t.forEach(bC);for(let l=0;l<t.length;l++)i.push(s),s+=t[l].length,MC(n,t[l]);let a=A4.triangulate(n,i);for(let l=0;l<a.length;l+=3)r.push(a.slice(l,l+3));return r}};function bC(o){let e=o.length;e>2&&o[e-1].equals(o[0])&&o.pop()}function MC(o,e){for(let t=0;t<e.length;t++)o.push(e[t].x),o.push(e[t].y)}var zr=class extends Ue{constructor(e,t){super();this.type="ExtrudeGeometry",this.parameters={shapes:e,options:t},e=Array.isArray(e)?e:[e];let n=this,i=[],r=[];for(let a=0,l=e.length;a<l;a++){let c=e[a];s(c)}this.setAttribute("position",new Ne(i,3)),this.setAttribute("uv",new Ne(r,2)),this.computeVertexNormals();function s(a){let l=[],c=t.curveSegments!==void 0?t.curveSegments:12,u=t.steps!==void 0?t.steps:1,d=t.depth!==void 0?t.depth:100,h=t.bevelEnabled!==void 0?t.bevelEnabled:!0,f=t.bevelThickness!==void 0?t.bevelThickness:6,p=t.bevelSize!==void 0?t.bevelSize:f-2,g=t.bevelOffset!==void 0?t.bevelOffset:0,v=t.bevelSegments!==void 0?t.bevelSegments:3,y=t.extrudePath,m=t.UVGenerator!==void 0?t.UVGenerator:W4;t.amount!==void 0&&(console.warn("THREE.ExtrudeBufferGeometry: amount has been renamed to depth."),d=t.amount);let x,_=!1,w,b,M,S;y&&(x=y.getSpacedPoints(u),_=!0,h=!1,w=y.computeFrenetFrames(u,!1),b=new U,M=new U,S=new U),h||(v=0,f=0,p=0,g=0);let E=a.extractPoints(c),A=E.shape,L=E.holes;if(!Zi.isClockWise(A)){A=A.reverse();for(let X=0,$=L.length;X<$;X++){let J=L[X];Zi.isClockWise(J)&&(L[X]=J.reverse())}}let R=Zi.triangulateShape(A,L),D=A;for(let X=0,$=L.length;X<$;X++){let J=L[X];A=A.concat(J)}function P(X,$,J){return $||console.error("THREE.ExtrudeGeometry: vec does not exist"),$.clone().multiplyScalar(J).add(X)}let I=A.length,N=R.length;function G(X,$,J){let ce,H,T,C=X.x-$.x,W=X.y-$.y,Z=J.x-X.x,he=J.y-X.y,me=C*C+W*W,Ee=C*he-W*Z;if(Math.abs(Ee)>Number.EPSILON){let Se=Math.sqrt(me),oe=Math.sqrt(Z*Z+he*he),ge=$.x-W/Se,k=$.y+C/Se,de=J.x-he/oe,K=J.y+Z/oe,be=((de-ge)*he-(K-k)*Z)/(C*he-W*Z);ce=ge+C*be-X.x,H=k+W*be-X.y;let we=ce*ce+H*H;if(we<=2)return new _e(ce,H);T=Math.sqrt(we/2)}else{let Se=!1;C>Number.EPSILON?Z>Number.EPSILON&&(Se=!0):C<-Number.EPSILON?Z<-Number.EPSILON&&(Se=!0):Math.sign(W)===Math.sign(he)&&(Se=!0),Se?(ce=-W,H=C,T=Math.sqrt(me)):(ce=C,H=W,T=Math.sqrt(me/2))}return new _e(ce/T,H/T)}let z=[];for(let X=0,$=D.length,J=$-1,ce=X+1;X<$;X++,J++,ce++)J===$&&(J=0),ce===$&&(ce=0),z[X]=G(D[X],D[J],D[ce]);let se=[],ne,Q=z.concat();for(let X=0,$=L.length;X<$;X++){let J=L[X];ne=[];for(let ce=0,H=J.length,T=H-1,C=ce+1;ce<H;ce++,T++,C++)T===H&&(T=0),C===H&&(C=0),ne[ce]=G(J[ce],J[T],J[C]);se.push(ne),Q=Q.concat(ne)}for(let X=0;X<v;X++){let $=X/v,J=f*Math.cos($*Math.PI/2),ce=p*Math.sin($*Math.PI/2)+g;for(let H=0,T=D.length;H<T;H++){let C=P(D[H],z[H],ce);ie(C.x,C.y,-J)}for(let H=0,T=L.length;H<T;H++){let C=L[H];ne=se[H];for(let W=0,Z=C.length;W<Z;W++){let he=P(C[W],ne[W],ce);ie(he.x,he.y,-J)}}}let j=p+g;for(let X=0;X<I;X++){let $=h?P(A[X],Q[X],j):A[X];_?(M.copy(w.normals[0]).multiplyScalar($.x),b.copy(w.binormals[0]).multiplyScalar($.y),S.copy(x[0]).add(M).add(b),ie(S.x,S.y,S.z)):ie($.x,$.y,0)}for(let X=1;X<=u;X++)for(let $=0;$<I;$++){let J=h?P(A[$],Q[$],j):A[$];_?(M.copy(w.normals[X]).multiplyScalar(J.x),b.copy(w.binormals[X]).multiplyScalar(J.y),S.copy(x[X]).add(M).add(b),ie(S.x,S.y,S.z)):ie(J.x,J.y,d/u*X)}for(let X=v-1;X>=0;X--){let $=X/v,J=f*Math.cos($*Math.PI/2),ce=p*Math.sin($*Math.PI/2)+g;for(let H=0,T=D.length;H<T;H++){let C=P(D[H],z[H],ce);ie(C.x,C.y,d+J)}for(let H=0,T=L.length;H<T;H++){let C=L[H];ne=se[H];for(let W=0,Z=C.length;W<Z;W++){let he=P(C[W],ne[W],ce);_?ie(he.x,he.y+x[u-1].y,x[u-1].x+J):ie(he.x,he.y,d+J)}}}O(),ee();function O(){let X=i.length/3;if(h){let $=0,J=I*$;for(let ce=0;ce<N;ce++){let H=R[ce];ue(H[2]+J,H[1]+J,H[0]+J)}$=u+v*2,J=I*$;for(let ce=0;ce<N;ce++){let H=R[ce];ue(H[0]+J,H[1]+J,H[2]+J)}}else{for(let $=0;$<N;$++){let J=R[$];ue(J[2],J[1],J[0])}for(let $=0;$<N;$++){let J=R[$];ue(J[0]+I*u,J[1]+I*u,J[2]+I*u)}}n.addGroup(X,i.length/3-X,0)}function ee(){let X=i.length/3,$=0;V(D,$),$+=D.length;for(let J=0,ce=L.length;J<ce;J++){let H=L[J];V(H,$),$+=H.length}n.addGroup(X,i.length/3-X,1)}function V(X,$){let J=X.length;for(;--J>=0;){let ce=J,H=J-1;H<0&&(H=X.length-1);for(let T=0,C=u+v*2;T<C;T++){let W=I*T,Z=I*(T+1),he=$+ce+W,me=$+H+W,Ee=$+H+Z,Se=$+ce+Z;ye(he,me,Ee,Se)}}}function ie(X,$,J){l.push(X),l.push($),l.push(J)}function ue(X,$,J){pe(X),pe($),pe(J);let ce=i.length/3,H=m.generateTopUV(n,i,ce-3,ce-2,ce-1);xe(H[0]),xe(H[1]),xe(H[2])}function ye(X,$,J,ce){pe(X),pe($),pe(ce),pe($),pe(J),pe(ce);let H=i.length/3,T=m.generateSideWallUV(n,i,H-6,H-3,H-2,H-1);xe(T[0]),xe(T[1]),xe(T[3]),xe(T[1]),xe(T[2]),xe(T[3])}function pe(X){i.push(l[X*3+0]),i.push(l[X*3+1]),i.push(l[X*3+2])}function xe(X){r.push(X.x),r.push(X.y)}}}toJSON(){let e=super.toJSON(),t=this.parameters.shapes,n=this.parameters.options;return X4(t,n,e)}static fromJSON(e,t){let n=[];for(let r=0,s=e.shapes.length;r<s;r++){let a=t[e.shapes[r]];n.push(a)}let i=e.options.extrudePath;return i!==void 0&&(e.options.extrudePath=new sw[i.type]().fromJSON(i)),new zr(n,e.options)}},W4={generateTopUV:function(o,e,t,n,i){let r=e[t*3],s=e[t*3+1],a=e[n*3],l=e[n*3+1],c=e[i*3],u=e[i*3+1];return[new _e(r,s),new _e(a,l),new _e(c,u)]},generateSideWallUV:function(o,e,t,n,i,r){let s=e[t*3],a=e[t*3+1],l=e[t*3+2],c=e[n*3],u=e[n*3+1],d=e[n*3+2],h=e[i*3],f=e[i*3+1],p=e[i*3+2],g=e[r*3],v=e[r*3+1],y=e[r*3+2];return Math.abs(a-u)<Math.abs(s-c)?[new _e(s,1-l),new _e(c,1-d),new _e(h,1-p),new _e(g,1-y)]:[new _e(a,1-l),new _e(u,1-d),new _e(f,1-p),new _e(v,1-y)]}};function X4(o,e,t){if(t.shapes=[],Array.isArray(o))for(let n=0,i=o.length;n<i;n++){let r=o[n];t.shapes.push(r.uuid)}else t.shapes.push(o.uuid);return e.extrudePath!==void 0&&(t.options.extrudePath=e.extrudePath.toJSON()),t}var Eu=class extends ms{constructor(e=1,t=0){let n=(1+Math.sqrt(5))/2,i=[-1,n,0,1,n,0,-1,-n,0,1,-n,0,0,-1,n,0,1,n,0,-1,-n,0,1,-n,n,0,-1,n,0,1,-n,0,-1,-n,0,1],r=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1];super(i,r,e,t);this.type="IcosahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new Eu(e.radius,e.detail)}},Au=class extends Ue{constructor(e,t=12,n=0,i=Math.PI*2){super();this.type="LatheGeometry",this.parameters={points:e,segments:t,phiStart:n,phiLength:i},t=Math.floor(t),i=jn(i,0,Math.PI*2);let r=[],s=[],a=[],l=1/t,c=new U,u=new _e;for(let d=0;d<=t;d++){let h=n+d*l*i,f=Math.sin(h),p=Math.cos(h);for(let g=0;g<=e.length-1;g++)c.x=e[g].x*f,c.y=e[g].y,c.z=e[g].x*p,s.push(c.x,c.y,c.z),u.x=d/t,u.y=g/(e.length-1),a.push(u.x,u.y)}for(let d=0;d<t;d++)for(let h=0;h<e.length-1;h++){let f=h+d*e.length,p=f,g=f+e.length,v=f+e.length+1,y=f+1;r.push(p,g,y),r.push(g,v,y)}if(this.setIndex(r),this.setAttribute("position",new Ne(s,3)),this.setAttribute("uv",new Ne(a,2)),this.computeVertexNormals(),i===Math.PI*2){let d=this.attributes.normal.array,h=new U,f=new U,p=new U,g=t*e.length*3;for(let v=0,y=0;v<e.length;v++,y+=3)h.x=d[y+0],h.y=d[y+1],h.z=d[y+2],f.x=d[g+y+0],f.y=d[g+y+1],f.z=d[g+y+2],p.addVectors(h,f).normalize(),d[y+0]=d[g+y+0]=p.x,d[y+1]=d[g+y+1]=p.y,d[y+2]=d[g+y+2]=p.z}}static fromJSON(e){return new Au(e.points,e.segments,e.phiStart,e.phiLength)}},Fl=class extends ms{constructor(e=1,t=0){let n=[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],i=[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2];super(n,i,e,t);this.type="OctahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new Fl(e.radius,e.detail)}},jg=class extends Ue{constructor(e,t,n){super();this.type="ParametricGeometry",this.parameters={func:e,slices:t,stacks:n};let i=[],r=[],s=[],a=[],l=1e-5,c=new U,u=new U,d=new U,h=new U,f=new U;e.length<3&&console.error("THREE.ParametricGeometry: Function must now modify a Vector3 as third parameter.");let p=t+1;for(let g=0;g<=n;g++){let v=g/n;for(let y=0;y<=t;y++){let m=y/t;e(m,v,u),r.push(u.x,u.y,u.z),m-l>=0?(e(m-l,v,d),h.subVectors(u,d)):(e(m+l,v,d),h.subVectors(d,u)),v-l>=0?(e(m,v-l,d),f.subVectors(u,d)):(e(m,v+l,d),f.subVectors(d,u)),c.crossVectors(h,f).normalize(),s.push(c.x,c.y,c.z),a.push(m,v)}}for(let g=0;g<n;g++)for(let v=0;v<t;v++){let y=g*p+v,m=g*p+v+1,x=(g+1)*p+v+1,_=(g+1)*p+v;i.push(y,m,_),i.push(m,x,_)}this.setIndex(i),this.setAttribute("position",new Ne(r,3)),this.setAttribute("normal",new Ne(s,3)),this.setAttribute("uv",new Ne(a,2))}},ha=class extends Ue{constructor(e=.5,t=1,n=8,i=1,r=0,s=Math.PI*2){super();this.type="RingGeometry",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:n,phiSegments:i,thetaStart:r,thetaLength:s},n=Math.max(3,n),i=Math.max(1,i);let a=[],l=[],c=[],u=[],d=e,h=(t-e)/i,f=new U,p=new _e;for(let g=0;g<=i;g++){for(let v=0;v<=n;v++){let y=r+v/n*s;f.x=d*Math.cos(y),f.y=d*Math.sin(y),l.push(f.x,f.y,f.z),c.push(0,0,1),p.x=(f.x/t+1)/2,p.y=(f.y/t+1)/2,u.push(p.x,p.y)}d+=h}for(let g=0;g<i;g++){let v=g*(n+1);for(let y=0;y<n;y++){let m=y+v,x=m,_=m+n+1,w=m+n+2,b=m+1;a.push(x,_,b),a.push(_,w,b)}}this.setIndex(a),this.setAttribute("position",new Ne(l,3)),this.setAttribute("normal",new Ne(c,3)),this.setAttribute("uv",new Ne(u,2))}static fromJSON(e){return new ha(e.innerRadius,e.outerRadius,e.thetaSegments,e.phiSegments,e.thetaStart,e.thetaLength)}},Bl=class extends Ue{constructor(e,t=12){super();this.type="ShapeGeometry",this.parameters={shapes:e,curveSegments:t};let n=[],i=[],r=[],s=[],a=0,l=0;if(Array.isArray(e)===!1)c(e);else for(let u=0;u<e.length;u++)c(e[u]),this.addGroup(a,l,u),a+=l,l=0;this.setIndex(n),this.setAttribute("position",new Ne(i,3)),this.setAttribute("normal",new Ne(r,3)),this.setAttribute("uv",new Ne(s,2));function c(u){let d=i.length/3,h=u.extractPoints(t),f=h.shape,p=h.holes;Zi.isClockWise(f)===!1&&(f=f.reverse());for(let v=0,y=p.length;v<y;v++){let m=p[v];Zi.isClockWise(m)===!0&&(p[v]=m.reverse())}let g=Zi.triangulateShape(f,p);for(let v=0,y=p.length;v<y;v++){let m=p[v];f=f.concat(m)}for(let v=0,y=f.length;v<y;v++){let m=f[v];i.push(m.x,m.y,0),r.push(0,0,1),s.push(m.x,m.y)}for(let v=0,y=g.length;v<y;v++){let m=g[v],x=m[0]+d,_=m[1]+d,w=m[2]+d;n.push(x,_,w),l+=3}}}toJSON(){let e=super.toJSON(),t=this.parameters.shapes;return q4(t,e)}static fromJSON(e,t){let n=[];for(let i=0,r=e.shapes.length;i<r;i++){let s=t[e.shapes[i]];n.push(s)}return new Bl(n,e.curveSegments)}};function q4(o,e){if(e.shapes=[],Array.isArray(o))for(let t=0,n=o.length;t<n;t++){let i=o[t];e.shapes.push(i.uuid)}else e.shapes.push(o.uuid);return e}var Ji=class extends Ue{constructor(e=1,t=8,n=6,i=0,r=Math.PI*2,s=0,a=Math.PI){super();this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:n,phiStart:i,phiLength:r,thetaStart:s,thetaLength:a},t=Math.max(3,Math.floor(t)),n=Math.max(2,Math.floor(n));let l=Math.min(s+a,Math.PI),c=0,u=[],d=new U,h=new U,f=[],p=[],g=[],v=[];for(let y=0;y<=n;y++){let m=[],x=y/n,_=0;y==0&&s==0?_=.5/t:y==n&&l==Math.PI&&(_=-.5/t);for(let w=0;w<=t;w++){let b=w/t;d.x=-e*Math.cos(i+b*r)*Math.sin(s+x*a),d.y=e*Math.cos(s+x*a),d.z=e*Math.sin(i+b*r)*Math.sin(s+x*a),p.push(d.x,d.y,d.z),h.copy(d).normalize(),g.push(h.x,h.y,h.z),v.push(b+_,1-x),m.push(c++)}u.push(m)}for(let y=0;y<n;y++)for(let m=0;m<t;m++){let x=u[y][m+1],_=u[y][m],w=u[y+1][m],b=u[y+1][m+1];(y!==0||s>0)&&f.push(x,_,b),(y!==n-1||l<Math.PI)&&f.push(_,w,b)}this.setIndex(f),this.setAttribute("position",new Ne(p,3)),this.setAttribute("normal",new Ne(g,3)),this.setAttribute("uv",new Ne(v,2))}static fromJSON(e){return new Ji(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength)}},Cu=class extends ms{constructor(e=1,t=0){let n=[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],i=[2,1,0,0,3,2,1,3,0,2,3,1];super(n,i,e,t);this.type="TetrahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new Cu(e.radius,e.detail)}},Yg=class extends zr{constructor(e,t={}){let n=t.font;if(!(n&&n.isFont))return console.error("THREE.TextGeometry: font parameter is not an instance of THREE.Font."),new Ue;let i=n.generateShapes(e,t.size);t.depth=t.height!==void 0?t.height:50,t.bevelThickness===void 0&&(t.bevelThickness=10),t.bevelSize===void 0&&(t.bevelSize=8),t.bevelEnabled===void 0&&(t.bevelEnabled=!1);super(i,t);this.type="TextGeometry"}},Lu=class extends Ue{constructor(e=1,t=.4,n=8,i=6,r=Math.PI*2){super();this.type="TorusGeometry",this.parameters={radius:e,tube:t,radialSegments:n,tubularSegments:i,arc:r},n=Math.floor(n),i=Math.floor(i);let s=[],a=[],l=[],c=[],u=new U,d=new U,h=new U;for(let f=0;f<=n;f++)for(let p=0;p<=i;p++){let g=p/i*r,v=f/n*Math.PI*2;d.x=(e+t*Math.cos(v))*Math.cos(g),d.y=(e+t*Math.cos(v))*Math.sin(g),d.z=t*Math.sin(v),a.push(d.x,d.y,d.z),u.x=e*Math.cos(g),u.y=e*Math.sin(g),h.subVectors(d,u).normalize(),l.push(h.x,h.y,h.z),c.push(p/i),c.push(f/n)}for(let f=1;f<=n;f++)for(let p=1;p<=i;p++){let g=(i+1)*f+p-1,v=(i+1)*(f-1)+p-1,y=(i+1)*(f-1)+p,m=(i+1)*f+p;s.push(g,v,m),s.push(v,y,m)}this.setIndex(s),this.setAttribute("position",new Ne(a,3)),this.setAttribute("normal",new Ne(l,3)),this.setAttribute("uv",new Ne(c,2))}static fromJSON(e){return new Lu(e.radius,e.tube,e.radialSegments,e.tubularSegments,e.arc)}},Ru=class extends Ue{constructor(e=1,t=.4,n=64,i=8,r=2,s=3){super();this.type="TorusKnotGeometry",this.parameters={radius:e,tube:t,tubularSegments:n,radialSegments:i,p:r,q:s},n=Math.floor(n),i=Math.floor(i);let a=[],l=[],c=[],u=[],d=new U,h=new U,f=new U,p=new U,g=new U,v=new U,y=new U;for(let x=0;x<=n;++x){let _=x/n*r*Math.PI*2;m(_,r,s,e,f),m(_+.01,r,s,e,p),v.subVectors(p,f),y.addVectors(p,f),g.crossVectors(v,y),y.crossVectors(g,v),g.normalize(),y.normalize();for(let w=0;w<=i;++w){let b=w/i*Math.PI*2,M=-t*Math.cos(b),S=t*Math.sin(b);d.x=f.x+(M*y.x+S*g.x),d.y=f.y+(M*y.y+S*g.y),d.z=f.z+(M*y.z+S*g.z),l.push(d.x,d.y,d.z),h.subVectors(d,f).normalize(),c.push(h.x,h.y,h.z),u.push(x/n),u.push(w/i)}}for(let x=1;x<=n;x++)for(let _=1;_<=i;_++){let w=(i+1)*(x-1)+(_-1),b=(i+1)*x+(_-1),M=(i+1)*x+_,S=(i+1)*(x-1)+_;a.push(w,b,S),a.push(b,M,S)}this.setIndex(a),this.setAttribute("position",new Ne(l,3)),this.setAttribute("normal",new Ne(c,3)),this.setAttribute("uv",new Ne(u,2));function m(x,_,w,b,M){let S=Math.cos(x),E=Math.sin(x),A=w/_*x,L=Math.cos(A);M.x=b*(2+L)*.5*S,M.y=b*(2+L)*E*.5,M.z=b*Math.sin(A)*.5}}static fromJSON(e){return new Ru(e.radius,e.tube,e.tubularSegments,e.radialSegments,e.p,e.q)}},Pu=class extends Ue{constructor(e,t=64,n=1,i=8,r=!1){super();this.type="TubeGeometry",this.parameters={path:e,tubularSegments:t,radius:n,radialSegments:i,closed:r};let s=e.computeFrenetFrames(t,r);this.tangents=s.tangents,this.normals=s.normals,this.binormals=s.binormals;let a=new U,l=new U,c=new _e,u=new U,d=[],h=[],f=[],p=[];g(),this.setIndex(p),this.setAttribute("position",new Ne(d,3)),this.setAttribute("normal",new Ne(h,3)),this.setAttribute("uv",new Ne(f,2));function g(){for(let x=0;x<t;x++)v(x);v(r===!1?t:0),m(),y()}function v(x){u=e.getPointAt(x/t,u);let _=s.normals[x],w=s.binormals[x];for(let b=0;b<=i;b++){let M=b/i*Math.PI*2,S=Math.sin(M),E=-Math.cos(M);l.x=E*_.x+S*w.x,l.y=E*_.y+S*w.y,l.z=E*_.z+S*w.z,l.normalize(),h.push(l.x,l.y,l.z),a.x=u.x+n*l.x,a.y=u.y+n*l.y,a.z=u.z+n*l.z,d.push(a.x,a.y,a.z)}}function y(){for(let x=1;x<=t;x++)for(let _=1;_<=i;_++){let w=(i+1)*(x-1)+(_-1),b=(i+1)*x+(_-1),M=(i+1)*x+_,S=(i+1)*(x-1)+_;p.push(w,b,S),p.push(b,M,S)}}function m(){for(let x=0;x<=t;x++)for(let _=0;_<=i;_++)c.x=x/t,c.y=_/i,f.push(c.x,c.y)}}toJSON(){let e=super.toJSON();return e.path=this.parameters.path.toJSON(),e}static fromJSON(e){return new Pu(new sw[e.path.type]().fromJSON(e.path),e.tubularSegments,e.radius,e.radialSegments,e.closed)}},Zg=class extends Ue{constructor(e){super();if(this.type="WireframeGeometry",e.isGeometry===!0){console.error("THREE.WireframeGeometry no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");return}let t=[],n=[0,0],i={},r=new U;if(e.index!==null){let s=e.attributes.position,a=e.index,l=e.groups;l.length===0&&(l=[{start:0,count:a.count,materialIndex:0}]);for(let c=0,u=l.length;c<u;++c){let d=l[c],h=d.start,f=d.count;for(let p=h,g=h+f;p<g;p+=3)for(let v=0;v<3;v++){let y=a.getX(p+v),m=a.getX(p+(v+1)%3);n[0]=Math.min(y,m),n[1]=Math.max(y,m);let x=n[0]+","+n[1];i[x]===void 0&&(i[x]={index1:n[0],index2:n[1]})}}for(let c in i){let u=i[c];r.fromBufferAttribute(s,u.index1),t.push(r.x,r.y,r.z),r.fromBufferAttribute(s,u.index2),t.push(r.x,r.y,r.z)}}else{let s=e.attributes.position;for(let a=0,l=s.count/3;a<l;a++)for(let c=0;c<3;c++){let u=3*a+c;r.fromBufferAttribute(s,u),t.push(r.x,r.y,r.z);let d=3*a+(c+1)%3;r.fromBufferAttribute(s,d),t.push(r.x,r.y,r.z)}}this.setAttribute("position",new Ne(t,3))}},SC=Object.freeze({__proto__:null,BoxGeometry:ao,BoxBufferGeometry:ao,CircleGeometry:_u,CircleBufferGeometry:_u,ConeGeometry:wu,ConeBufferGeometry:wu,CylinderGeometry:ca,CylinderBufferGeometry:ca,DodecahedronGeometry:bu,DodecahedronBufferGeometry:bu,EdgesGeometry:kg,ExtrudeGeometry:zr,ExtrudeBufferGeometry:zr,IcosahedronGeometry:Eu,IcosahedronBufferGeometry:Eu,LatheGeometry:Au,LatheBufferGeometry:Au,OctahedronGeometry:Fl,OctahedronBufferGeometry:Fl,ParametricGeometry:jg,ParametricBufferGeometry:jg,PlaneGeometry:Bi,PlaneBufferGeometry:Bi,PolyhedronGeometry:ms,PolyhedronBufferGeometry:ms,RingGeometry:ha,RingBufferGeometry:ha,ShapeGeometry:Bl,ShapeBufferGeometry:Bl,SphereGeometry:Ji,SphereBufferGeometry:Ji,TetrahedronGeometry:Cu,TetrahedronBufferGeometry:Cu,TextGeometry:Yg,TextBufferGeometry:Yg,TorusGeometry:Lu,TorusBufferGeometry:Lu,TorusKnotGeometry:Ru,TorusKnotBufferGeometry:Ru,TubeGeometry:Pu,TubeBufferGeometry:Pu,WireframeGeometry:Zg}),Jg=class extends un{constructor(e){super();this.type="ShadowMaterial",this.color=new De(0),this.transparent=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this}};Jg.prototype.isShadowMaterial=!0;var Nl=class extends Fn{constructor(e){super(e);this.type="RawShaderMaterial"}};Nl.prototype.isRawShaderMaterial=!0;var Ur=class extends un{constructor(e){super();this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new De(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new De(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Qs,this.normalScale=new _e(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.morphTargets=!1,this.morphNormals=!1,this.flatShading=!1,this.vertexTangents=!1,this.setValues(e)}copy(e){return super.copy(e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapIntensity=e.envMapIntensity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this.flatShading=e.flatShading,this.vertexTangents=e.vertexTangents,this}};Ur.prototype.isMeshStandardMaterial=!0;var Ol=class extends Ur{constructor(e){super();this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.clearcoat=0,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new _e(1,1),this.clearcoatNormalMap=null,this.reflectivity=.5,Object.defineProperty(this,"ior",{get:function(){return(1+.4*this.reflectivity)/(1-.4*this.reflectivity)},set:function(t){this.reflectivity=jn(2.5*(t-1)/(t+1),0,1)}}),this.sheen=null,this.transmission=0,this.transmissionMap=null,this.thickness=.01,this.thicknessMap=null,this.attenuationDistance=0,this.attenuationColor=new De(1,1,1),this.setValues(e)}copy(e){return super.copy(e),this.defines={STANDARD:"",PHYSICAL:""},this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.reflectivity=e.reflectivity,e.sheen?this.sheen=(this.sheen||new De).copy(e.sheen):this.sheen=null,this.transmission=e.transmission,this.transmissionMap=e.transmissionMap,this.thickness=e.thickness,this.thicknessMap=e.thicknessMap,this.attenuationDistance=e.attenuationDistance,this.attenuationColor.copy(e.attenuationColor),this}};Ol.prototype.isMeshPhysicalMaterial=!0;var gs=class extends un{constructor(e){super();this.type="MeshPhongMaterial",this.color=new De(16777215),this.specular=new De(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new De(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Qs,this.normalScale=new _e(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=qd,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.morphTargets=!1,this.morphNormals=!1,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this.flatShading=e.flatShading,this}};gs.prototype.isMeshPhongMaterial=!0;var Kg=class extends un{constructor(e){super();this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new De(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new De(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Qs,this.normalScale=new _e(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.gradientMap=e.gradientMap,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this}};Kg.prototype.isMeshToonMaterial=!0;var $g=class extends un{constructor(e){super();this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Qs,this.normalScale=new _e(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.morphTargets=!1,this.morphNormals=!1,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this.flatShading=e.flatShading,this}};$g.prototype.isMeshNormalMaterial=!0;var Iu=class extends un{constructor(e){super();this.type="MeshLambertMaterial",this.color=new De(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new De(0),this.emissiveIntensity=1,this.emissiveMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=qd,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this}};Iu.prototype.isMeshLambertMaterial=!0;var Qg=class extends un{constructor(e){super();this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new De(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Qs,this.normalScale=new _e(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.morphTargets=!1,this.morphNormals=!1,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.defines={MATCAP:""},this.color.copy(e.color),this.matcap=e.matcap,this.map=e.map,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this.flatShading=e.flatShading,this}};Qg.prototype.isMeshMatcapMaterial=!0;var ey=class extends zt{constructor(e){super();this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}copy(e){return super.copy(e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this}};ey.prototype.isLineDashedMaterial=!0;var j4=Object.freeze({__proto__:null,ShadowMaterial:Jg,SpriteMaterial:pf,RawShaderMaterial:Nl,ShaderMaterial:Fn,PointsMaterial:ps,MeshPhysicalMaterial:Ol,MeshStandardMaterial:Ur,MeshPhongMaterial:gs,MeshToonMaterial:Kg,MeshNormalMaterial:$g,MeshLambertMaterial:Iu,MeshDepthMaterial:df,MeshDistanceMaterial:ff,MeshBasicMaterial:Jt,MeshMatcapMaterial:Qg,LineDashedMaterial:ey,LineBasicMaterial:zt,Material:un}),Yt={arraySlice:function(o,e,t){return Yt.isTypedArray(o)?new o.constructor(o.subarray(e,t!==void 0?t:o.length)):o.slice(e,t)},convertArray:function(o,e,t){return!o||!t&&o.constructor===e?o:typeof e.BYTES_PER_ELEMENT=="number"?new e(o):Array.prototype.slice.call(o)},isTypedArray:function(o){return ArrayBuffer.isView(o)&&!(o instanceof DataView)},getKeyframeOrder:function(o){function e(i,r){return o[i]-o[r]}let t=o.length,n=new Array(t);for(let i=0;i!==t;++i)n[i]=i;return n.sort(e),n},sortedArray:function(o,e,t){let n=o.length,i=new o.constructor(n);for(let r=0,s=0;s!==n;++r){let a=t[r]*e;for(let l=0;l!==e;++l)i[s++]=o[a+l]}return i},flattenJSON:function(o,e,t,n){let i=1,r=o[0];for(;r!==void 0&&r[n]===void 0;)r=o[i++];if(r===void 0)return;let s=r[n];if(s!==void 0)if(Array.isArray(s))do s=r[n],s!==void 0&&(e.push(r.time),t.push.apply(t,s)),r=o[i++];while(r!==void 0);else if(s.toArray!==void 0)do s=r[n],s!==void 0&&(e.push(r.time),s.toArray(t,t.length)),r=o[i++];while(r!==void 0);else do s=r[n],s!==void 0&&(e.push(r.time),t.push(s)),r=o[i++];while(r!==void 0)},subclip:function(o,e,t,n,i=30){let r=o.clone();r.name=e;let s=[];for(let l=0;l<r.tracks.length;++l){let c=r.tracks[l],u=c.getValueSize(),d=[],h=[];for(let f=0;f<c.times.length;++f){let p=c.times[f]*i;if(!(p<t||p>=n)){d.push(c.times[f]);for(let g=0;g<u;++g)h.push(c.values[f*u+g])}}d.length!==0&&(c.times=Yt.convertArray(d,c.times.constructor),c.values=Yt.convertArray(h,c.values.constructor),s.push(c))}r.tracks=s;let a=1/0;for(let l=0;l<r.tracks.length;++l)a>r.tracks[l].times[0]&&(a=r.tracks[l].times[0]);for(let l=0;l<r.tracks.length;++l)r.tracks[l].shift(-1*a);return r.resetDuration(),r},makeClipAdditive:function(o,e=0,t=o,n=30){n<=0&&(n=30);let i=t.tracks.length,r=e/n;for(let s=0;s<i;++s){let a=t.tracks[s],l=a.ValueTypeName;if(l==="bool"||l==="string")continue;let c=o.tracks.find(function(y){return y.name===a.name&&y.ValueTypeName===l});if(c===void 0)continue;let u=0,d=a.getValueSize();a.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(u=d/3);let h=0,f=c.getValueSize();c.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(h=f/3);let p=a.times.length-1,g;if(r<=a.times[0]){let y=u,m=d-u;g=Yt.arraySlice(a.values,y,m)}else if(r>=a.times[p]){let y=p*d+u,m=y+d-u;g=Yt.arraySlice(a.values,y,m)}else{let y=a.createInterpolant(),m=u,x=d-u;y.evaluate(r),g=Yt.arraySlice(y.resultBuffer,m,x)}l==="quaternion"&&new gt().fromArray(g).normalize().conjugate().toArray(g);let v=c.times.length;for(let y=0;y<v;++y){let m=y*f+h;if(l==="quaternion")gt.multiplyQuaternionsFlat(c.values,m,g,0,c.values,m);else{let x=f-h*2;for(let _=0;_<x;++_)c.values[m+_]-=g[_]}}}return o.blendMode=r_,o}},hr=class{constructor(e,t,n,i){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=i!==void 0?i:new t.constructor(n),this.sampleValues=t,this.valueSize=n,this.settings=null,this.DefaultSettings_={}}evaluate(e){let t=this.parameterPositions,n=this._cachedIndex,i=t[n],r=t[n-1];e:{t:{let s;n:{i:if(!(e<i)){for(let a=n+2;;){if(i===void 0){if(e<r)break i;return n=t.length,this._cachedIndex=n,this.afterEnd_(n-1,e,r)}if(n===a)break;if(r=i,i=t[++n],e<i)break t}s=t.length;break n}if(!(e>=r)){let a=t[1];e<a&&(n=2,r=a);for(let l=n-2;;){if(r===void 0)return this._cachedIndex=0,this.beforeStart_(0,e,i);if(n===l)break;if(i=r,r=t[--n-1],e>=r)break t}s=n,n=0;break n}break e}for(;n<s;){let a=n+s>>>1;e<t[a]?s=a:n=a+1}if(i=t[n],r=t[n-1],r===void 0)return this._cachedIndex=0,this.beforeStart_(0,e,i);if(i===void 0)return n=t.length,this._cachedIndex=n,this.afterEnd_(n-1,r,e)}this._cachedIndex=n,this.intervalChanged_(n,r,i)}return this.interpolate_(n,r,e,i)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(e){let t=this.resultBuffer,n=this.sampleValues,i=this.valueSize,r=e*i;for(let s=0;s!==i;++s)t[s]=n[r+s];return t}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}};hr.prototype.beforeStart_=hr.prototype.copySampleValue_;hr.prototype.afterEnd_=hr.prototype.copySampleValue_;var lw=class extends hr{constructor(e,t,n,i){super(e,t,n,i);this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:El,endingEnd:El}}intervalChanged_(e,t,n){let i=this.parameterPositions,r=e-2,s=e+1,a=i[r],l=i[s];if(a===void 0)switch(this.getSettings_().endingStart){case Al:r=e,a=2*t-n;break;case Qd:r=i.length-2,a=t+i[r]-i[r+1];break;default:r=e,a=n}if(l===void 0)switch(this.getSettings_().endingEnd){case Al:s=e,l=2*n-t;break;case Qd:s=1,l=n+i[1]-i[0];break;default:s=e-1,l=t}let c=(n-t)*.5,u=this.valueSize;this._weightPrev=c/(t-a),this._weightNext=c/(l-n),this._offsetPrev=r*u,this._offsetNext=s*u}interpolate_(e,t,n,i){let r=this.resultBuffer,s=this.sampleValues,a=this.valueSize,l=e*a,c=l-a,u=this._offsetPrev,d=this._offsetNext,h=this._weightPrev,f=this._weightNext,p=(n-t)/(i-t),g=p*p,v=g*p,y=-h*v+2*h*g-h*p,m=(1+h)*v+(-1.5-2*h)*g+(-.5+h)*p+1,x=(-1-f)*v+(1.5+f)*g+.5*p,_=f*v-f*g;for(let w=0;w!==a;++w)r[w]=y*s[u+w]+m*s[c+w]+x*s[l+w]+_*s[d+w];return r}},ty=class extends hr{constructor(e,t,n,i){super(e,t,n,i)}interpolate_(e,t,n,i){let r=this.resultBuffer,s=this.sampleValues,a=this.valueSize,l=e*a,c=l-a,u=(n-t)/(i-t),d=1-u;for(let h=0;h!==a;++h)r[h]=s[c+h]*d+s[l+h]*u;return r}},cw=class extends hr{constructor(e,t,n,i){super(e,t,n,i)}interpolate_(e){return this.copySampleValue_(e-1)}},dr=class{constructor(e,t,n,i){if(e===void 0)throw new Error("THREE.KeyframeTrack: track name is undefined");if(t===void 0||t.length===0)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=Yt.convertArray(t,this.TimeBufferType),this.values=Yt.convertArray(n,this.ValueBufferType),this.setInterpolation(i||this.DefaultInterpolation)}static toJSON(e){let t=e.constructor,n;if(t.toJSON!==this.toJSON)n=t.toJSON(e);else{n={name:e.name,times:Yt.convertArray(e.times,Array),values:Yt.convertArray(e.values,Array)};let i=e.getInterpolation();i!==e.DefaultInterpolation&&(n.interpolation=i)}return n.type=e.ValueTypeName,n}InterpolantFactoryMethodDiscrete(e){return new cw(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodLinear(e){return new ty(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodSmooth(e){return new lw(this.times,this.values,this.getValueSize(),e)}setInterpolation(e){let t;switch(e){case Tl:t=this.InterpolantFactoryMethodDiscrete;break;case Jo:t=this.InterpolantFactoryMethodLinear;break;case Zm:t=this.InterpolantFactoryMethodSmooth;break}if(t===void 0){let n="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(this.createInterpolant===void 0)if(e!==this.DefaultInterpolation)this.setInterpolation(this.DefaultInterpolation);else throw new Error(n);return console.warn("THREE.KeyframeTrack:",n),this}return this.createInterpolant=t,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return Tl;case this.InterpolantFactoryMethodLinear:return Jo;case this.InterpolantFactoryMethodSmooth:return Zm}}getValueSize(){return this.values.length/this.times.length}shift(e){if(e!==0){let t=this.times;for(let n=0,i=t.length;n!==i;++n)t[n]+=e}return this}scale(e){if(e!==1){let t=this.times;for(let n=0,i=t.length;n!==i;++n)t[n]*=e}return this}trim(e,t){let n=this.times,i=n.length,r=0,s=i-1;for(;r!==i&&n[r]<e;)++r;for(;s!==-1&&n[s]>t;)--s;if(++s,r!==0||s!==i){r>=s&&(s=Math.max(s,1),r=s-1);let a=this.getValueSize();this.times=Yt.arraySlice(n,r,s),this.values=Yt.arraySlice(this.values,r*a,s*a)}return this}validate(){let e=!0,t=this.getValueSize();t-Math.floor(t)!=0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);let n=this.times,i=this.values,r=n.length;r===0&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);let s=null;for(let a=0;a!==r;a++){let l=n[a];if(typeof l=="number"&&isNaN(l)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,a,l),e=!1;break}if(s!==null&&s>l){console.error("THREE.KeyframeTrack: Out of order keys.",this,a,l,s),e=!1;break}s=l}if(i!==void 0&&Yt.isTypedArray(i))for(let a=0,l=i.length;a!==l;++a){let c=i[a];if(isNaN(c)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,a,c),e=!1;break}}return e}optimize(){let e=Yt.arraySlice(this.times),t=Yt.arraySlice(this.values),n=this.getValueSize(),i=this.getInterpolation()===Zm,r=e.length-1,s=1;for(let a=1;a<r;++a){let l=!1,c=e[a],u=e[a+1];if(c!==u&&(a!==1||c!==e[0]))if(i)l=!0;else{let d=a*n,h=d-n,f=d+n;for(let p=0;p!==n;++p){let g=t[d+p];if(g!==t[h+p]||g!==t[f+p]){l=!0;break}}}if(l){if(a!==s){e[s]=e[a];let d=a*n,h=s*n;for(let f=0;f!==n;++f)t[h+f]=t[d+f]}++s}}if(r>0){e[s]=e[r];for(let a=r*n,l=s*n,c=0;c!==n;++c)t[l+c]=t[a+c];++s}return s!==e.length?(this.times=Yt.arraySlice(e,0,s),this.values=Yt.arraySlice(t,0,s*n)):(this.times=e,this.values=t),this}clone(){let e=Yt.arraySlice(this.times,0),t=Yt.arraySlice(this.values,0),n=this.constructor,i=new n(this.name,e,t);return i.createInterpolant=this.createInterpolant,i}};dr.prototype.TimeBufferType=Float32Array;dr.prototype.ValueBufferType=Float32Array;dr.prototype.DefaultInterpolation=Jo;var da=class extends dr{};da.prototype.ValueTypeName="bool";da.prototype.ValueBufferType=Array;da.prototype.DefaultInterpolation=Tl;da.prototype.InterpolantFactoryMethodLinear=void 0;da.prototype.InterpolantFactoryMethodSmooth=void 0;var ny=class extends dr{};ny.prototype.ValueTypeName="color";var ys=class extends dr{};ys.prototype.ValueTypeName="number";var uw=class extends hr{constructor(e,t,n,i){super(e,t,n,i)}interpolate_(e,t,n,i){let r=this.resultBuffer,s=this.sampleValues,a=this.valueSize,l=(n-t)/(i-t),c=e*a;for(let u=c+a;c!==u;c+=4)gt.slerpFlat(r,0,s,c-a,s,c,l);return r}},Hr=class extends dr{InterpolantFactoryMethodLinear(e){return new uw(this.times,this.values,this.getValueSize(),e)}};Hr.prototype.ValueTypeName="quaternion";Hr.prototype.DefaultInterpolation=Jo;Hr.prototype.InterpolantFactoryMethodSmooth=void 0;var fa=class extends dr{};fa.prototype.ValueTypeName="string";fa.prototype.ValueBufferType=Array;fa.prototype.DefaultInterpolation=Tl;fa.prototype.InterpolantFactoryMethodLinear=void 0;fa.prototype.InterpolantFactoryMethodSmooth=void 0;var vs=class extends dr{};vs.prototype.ValueTypeName="vector";var xs=class{constructor(e,t=-1,n,i=Jm){this.name=e,this.tracks=n,this.duration=t,this.blendMode=i,this.uuid=Xi(),this.duration<0&&this.resetDuration()}static parse(e){let t=[],n=e.tracks,i=1/(e.fps||1);for(let s=0,a=n.length;s!==a;++s)t.push(Z4(n[s]).scale(i));let r=new this(e.name,e.duration,t,e.blendMode);return r.uuid=e.uuid,r}static toJSON(e){let t=[],n=e.tracks,i={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid,blendMode:e.blendMode};for(let r=0,s=n.length;r!==s;++r)t.push(dr.toJSON(n[r]));return i}static CreateFromMorphTargetSequence(e,t,n,i){let r=t.length,s=[];for(let a=0;a<r;a++){let l=[],c=[];l.push((a+r-1)%r,a,(a+1)%r),c.push(0,1,0);let u=Yt.getKeyframeOrder(l);l=Yt.sortedArray(l,1,u),c=Yt.sortedArray(c,1,u),!i&&l[0]===0&&(l.push(r),c.push(c[0])),s.push(new ys(".morphTargetInfluences["+t[a].name+"]",l,c).scale(1/n))}return new this(e,-1,s)}static findByName(e,t){let n=e;if(!Array.isArray(e)){let i=e;n=i.geometry&&i.geometry.animations||i.animations}for(let i=0;i<n.length;i++)if(n[i].name===t)return n[i];return null}static CreateClipsFromMorphTargetSequences(e,t,n){let i={},r=/^([\w-]*?)([\d]+)$/;for(let a=0,l=e.length;a<l;a++){let c=e[a],u=c.name.match(r);if(u&&u.length>1){let d=u[1],h=i[d];h||(i[d]=h=[]),h.push(c)}}let s=[];for(let a in i)s.push(this.CreateFromMorphTargetSequence(a,i[a],t,n));return s}static parseAnimation(e,t){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;let n=function(d,h,f,p,g){if(f.length!==0){let v=[],y=[];Yt.flattenJSON(f,v,y,p),v.length!==0&&g.push(new d(h,v,y))}},i=[],r=e.name||"default",s=e.fps||30,a=e.blendMode,l=e.length||-1,c=e.hierarchy||[];for(let d=0;d<c.length;d++){let h=c[d].keys;if(!(!h||h.length===0))if(h[0].morphTargets){let f={},p;for(p=0;p<h.length;p++)if(h[p].morphTargets)for(let g=0;g<h[p].morphTargets.length;g++)f[h[p].morphTargets[g]]=-1;for(let g in f){let v=[],y=[];for(let m=0;m!==h[p].morphTargets.length;++m){let x=h[p];v.push(x.time),y.push(x.morphTarget===g?1:0)}i.push(new ys(".morphTargetInfluence["+g+"]",v,y))}l=f.length*(s||1)}else{let f=".bones["+t[d].name+"]";n(vs,f+".position",h,"pos",i),n(Hr,f+".quaternion",h,"rot",i),n(vs,f+".scale",h,"scl",i)}}return i.length===0?null:new this(r,l,i,a)}resetDuration(){let e=this.tracks,t=0;for(let n=0,i=e.length;n!==i;++n){let r=this.tracks[n];t=Math.max(t,r.times[r.times.length-1])}return this.duration=t,this}trim(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this}validate(){let e=!0;for(let t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e}optimize(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}clone(){let e=[];for(let t=0;t<this.tracks.length;t++)e.push(this.tracks[t].clone());return new this.constructor(this.name,this.duration,e,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}};function Y4(o){switch(o.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return ys;case"vector":case"vector2":case"vector3":case"vector4":return vs;case"color":return ny;case"quaternion":return Hr;case"bool":case"boolean":return da;case"string":return fa}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+o)}function Z4(o){if(o.type===void 0)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");let e=Y4(o.type);if(o.times===void 0){let t=[],n=[];Yt.flattenJSON(o.keys,t,n,"value"),o.times=t,o.values=n}return e.parse!==void 0?e.parse(o):new e(o.name,o.times,o.values,o.interpolation)}var uo={enabled:!1,files:{},add:function(o,e){this.enabled!==!1&&(this.files[o]=e)},get:function(o){if(this.enabled!==!1)return this.files[o]},remove:function(o){delete this.files[o]},clear:function(){this.files={}}},iy=class{constructor(e,t,n){let i=this,r=!1,s=0,a=0,l,c=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=n,this.itemStart=function(u){a++,r===!1&&i.onStart!==void 0&&i.onStart(u,s,a),r=!0},this.itemEnd=function(u){s++,i.onProgress!==void 0&&i.onProgress(u,s,a),s===a&&(r=!1,i.onLoad!==void 0&&i.onLoad())},this.itemError=function(u){i.onError!==void 0&&i.onError(u)},this.resolveURL=function(u){return l?l(u):u},this.setURLModifier=function(u){return l=u,this},this.addHandler=function(u,d){return c.push(u,d),this},this.removeHandler=function(u){let d=c.indexOf(u);return d!==-1&&c.splice(d,2),this},this.getHandler=function(u){for(let d=0,h=c.length;d<h;d+=2){let f=c[d],p=c[d+1];if(f.global&&(f.lastIndex=0),f.test(u))return p}return null}}},TC=new iy,tn=class{constructor(e){this.manager=e!==void 0?e:TC,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,t){let n=this;return new Promise(function(i,r){n.load(e,i,t,r)})}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}},Gr={},mn=class extends tn{constructor(e){super(e)}load(e,t,n,i){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);let r=this,s=uo.get(e);if(s!==void 0)return r.manager.itemStart(e),setTimeout(function(){t&&t(s),r.manager.itemEnd(e)},0),s;if(Gr[e]!==void 0){Gr[e].push({onLoad:t,onProgress:n,onError:i});return}let a=/^data:(.*?)(;base64)?,(.*)$/,l=e.match(a),c;if(l){let u=l[1],d=!!l[2],h=l[3];h=decodeURIComponent(h),d&&(h=atob(h));try{let f,p=(this.responseType||"").toLowerCase();switch(p){case"arraybuffer":case"blob":let g=new Uint8Array(h.length);for(let y=0;y<h.length;y++)g[y]=h.charCodeAt(y);p==="blob"?f=new Blob([g.buffer],{type:u}):f=g.buffer;break;case"document":f=new DOMParser().parseFromString(h,u);break;case"json":f=JSON.parse(h);break;default:f=h;break}setTimeout(function(){t&&t(f),r.manager.itemEnd(e)},0)}catch(f){setTimeout(function(){i&&i(f),r.manager.itemError(e),r.manager.itemEnd(e)},0)}}else{Gr[e]=[],Gr[e].push({onLoad:t,onProgress:n,onError:i}),c=new XMLHttpRequest,c.open("GET",e,!0),c.addEventListener("load",function(u){let d=this.response,h=Gr[e];if(delete Gr[e],this.status===200||this.status===0){this.status===0&&console.warn("THREE.FileLoader: HTTP Status 0 received."),uo.add(e,d);for(let f=0,p=h.length;f<p;f++){let g=h[f];g.onLoad&&g.onLoad(d)}r.manager.itemEnd(e)}else{for(let f=0,p=h.length;f<p;f++){let g=h[f];g.onError&&g.onError(u)}r.manager.itemError(e),r.manager.itemEnd(e)}},!1),c.addEventListener("progress",function(u){let d=Gr[e];for(let h=0,f=d.length;h<f;h++){let p=d[h];p.onProgress&&p.onProgress(u)}},!1),c.addEventListener("error",function(u){let d=Gr[e];delete Gr[e];for(let h=0,f=d.length;h<f;h++){let p=d[h];p.onError&&p.onError(u)}r.manager.itemError(e),r.manager.itemEnd(e)},!1),c.addEventListener("abort",function(u){let d=Gr[e];delete Gr[e];for(let h=0,f=d.length;h<f;h++){let p=d[h];p.onError&&p.onError(u)}r.manager.itemError(e),r.manager.itemEnd(e)},!1),this.responseType!==void 0&&(c.responseType=this.responseType),this.withCredentials!==void 0&&(c.withCredentials=this.withCredentials),c.overrideMimeType&&c.overrideMimeType(this.mimeType!==void 0?this.mimeType:"text/plain");for(let u in this.requestHeader)c.setRequestHeader(u,this.requestHeader[u]);c.send(null)}return r.manager.itemStart(e),c}setResponseType(e){return this.responseType=e,this}setMimeType(e){return this.mimeType=e,this}},EC=class extends tn{constructor(e){super(e)}load(e,t,n,i){let r=this,s=new mn(this.manager);s.setPath(this.path),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials),s.load(e,function(a){try{t(r.parse(JSON.parse(a)))}catch(l){i?i(l):console.error(l),r.manager.itemError(e)}},n,i)}parse(e){let t=[];for(let n=0;n<e.length;n++){let i=xs.parse(e[n]);t.push(i)}return t}},AC=class extends tn{constructor(e){super(e)}load(e,t,n,i){let r=this,s=[],a=new Fg,l=new mn(this.manager);l.setPath(this.path),l.setResponseType("arraybuffer"),l.setRequestHeader(this.requestHeader),l.setWithCredentials(r.withCredentials);let c=0;function u(d){l.load(e[d],function(h){let f=r.parse(h,!0);s[d]={width:f.width,height:f.height,format:f.format,mipmaps:f.mipmaps},c+=1,c===6&&(f.mipmapCount===1&&(a.minFilter=Lt),a.image=s,a.format=f.format,a.needsUpdate=!0,t&&t(a))},n,i)}if(Array.isArray(e))for(let d=0,h=e.length;d<h;++d)u(d);else l.load(e,function(d){let h=r.parse(d,!0);if(h.isCubemap){let f=h.mipmaps.length/h.mipmapCount;for(let p=0;p<f;p++){s[p]={mipmaps:[]};for(let g=0;g<h.mipmapCount;g++)s[p].mipmaps.push(h.mipmaps[p*h.mipmapCount+g]),s[p].format=h.format,s[p].width=h.width,s[p].height=h.height}a.image=s}else a.image.width=h.width,a.image.height=h.height,a.mipmaps=h.mipmaps;h.mipmapCount===1&&(a.minFilter=Lt),a.format=h.format,a.needsUpdate=!0,t&&t(a)},n,i);return a}},pa=class extends tn{constructor(e){super(e)}load(e,t,n,i){this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);let r=this,s=uo.get(e);if(s!==void 0)return r.manager.itemStart(e),setTimeout(function(){t&&t(s),r.manager.itemEnd(e)},0),s;let a=document.createElementNS("http://www.w3.org/1999/xhtml","img");function l(){a.removeEventListener("load",l,!1),a.removeEventListener("error",c,!1),uo.add(e,this),t&&t(this),r.manager.itemEnd(e)}function c(u){a.removeEventListener("load",l,!1),a.removeEventListener("error",c,!1),i&&i(u),r.manager.itemError(e),r.manager.itemEnd(e)}return a.addEventListener("load",l,!1),a.addEventListener("error",c,!1),e.substr(0,5)!=="data:"&&this.crossOrigin!==void 0&&(a.crossOrigin=this.crossOrigin),r.manager.itemStart(e),a.src=e,a}},hw=class extends tn{constructor(e){super(e)}load(e,t,n,i){let r=new Il,s=new pa(this.manager);s.setCrossOrigin(this.crossOrigin),s.setPath(this.path);let a=0;function l(c){s.load(e[c],function(u){r.images[c]=u,a++,a===6&&(r.needsUpdate=!0,t&&t(r))},void 0,i)}for(let c=0;c<e.length;++c)l(c);return r}},dw=class extends tn{constructor(e){super(e)}load(e,t,n,i){let r=this,s=new aa,a=new mn(this.manager);return a.setResponseType("arraybuffer"),a.setRequestHeader(this.requestHeader),a.setPath(this.path),a.setWithCredentials(r.withCredentials),a.load(e,function(l){let c=r.parse(l);!c||(c.image!==void 0?s.image=c.image:c.data!==void 0&&(s.image.width=c.width,s.image.height=c.height,s.image.data=c.data),s.wrapS=c.wrapS!==void 0?c.wrapS:an,s.wrapT=c.wrapT!==void 0?c.wrapT:an,s.magFilter=c.magFilter!==void 0?c.magFilter:Lt,s.minFilter=c.minFilter!==void 0?c.minFilter:Lt,s.anisotropy=c.anisotropy!==void 0?c.anisotropy:1,c.encoding!==void 0&&(s.encoding=c.encoding),c.flipY!==void 0&&(s.flipY=c.flipY),c.format!==void 0&&(s.format=c.format),c.type!==void 0&&(s.type=c.type),c.mipmaps!==void 0&&(s.mipmaps=c.mipmaps,s.minFilter=hs),c.mipmapCount===1&&(s.minFilter=Lt),c.generateMipmaps!==void 0&&(s.generateMipmaps=c.generateMipmaps),s.needsUpdate=!0,t&&t(s,c))},n,i),s}},Vr=class extends tn{constructor(e){super(e)}load(e,t,n,i){let r=new Vt,s=new pa(this.manager);return s.setCrossOrigin(this.crossOrigin),s.setPath(this.path),s.load(e,function(a){r.image=a;let l=e.search(/\.jpe?g($|\?)/i)>0||e.search(/^data\:image\/jpeg/)===0;r.format=l?Di:Fi,r.needsUpdate=!0,t!==void 0&&t(r)},n,i),r}},fw=class extends li{constructor(){super();this.type="CurvePath",this.curves=[],this.autoClose=!1}add(e){this.curves.push(e)}closePath(){let e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);e.equals(t)||this.curves.push(new Su(t,e))}getPoint(e){let t=e*this.getLength(),n=this.getCurveLengths(),i=0;for(;i<n.length;){if(n[i]>=t){let r=n[i]-t,s=this.curves[i],a=s.getLength(),l=a===0?0:1-r/a;return s.getPointAt(l)}i++}return null}getLength(){let e=this.getCurveLengths();return e[e.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;let e=[],t=0;for(let n=0,i=this.curves.length;n<i;n++)t+=this.curves[n].getLength(),e.push(t);return this.cacheLengths=e,e}getSpacedPoints(e=40){let t=[];for(let n=0;n<=e;n++)t.push(this.getPoint(n/e));return this.autoClose&&t.push(t[0]),t}getPoints(e=12){let t=[],n;for(let i=0,r=this.curves;i<r.length;i++){let s=r[i],a=s&&s.isEllipseCurve?e*2:s&&(s.isLineCurve||s.isLineCurve3)?1:s&&s.isSplineCurve?e*s.points.length:e,l=s.getPoints(a);for(let c=0;c<l.length;c++){let u=l[c];n&&n.equals(u)||(t.push(u),n=u)}}return this.autoClose&&t.length>1&&!t[t.length-1].equals(t[0])&&t.push(t[0]),t}copy(e){super.copy(e),this.curves=[];for(let t=0,n=e.curves.length;t<n;t++){let i=e.curves[t];this.curves.push(i.clone())}return this.autoClose=e.autoClose,this}toJSON(){let e=super.toJSON();e.autoClose=this.autoClose,e.curves=[];for(let t=0,n=this.curves.length;t<n;t++){let i=this.curves[t];e.curves.push(i.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.autoClose=e.autoClose,this.curves=[];for(let t=0,n=e.curves.length;t<n;t++){let i=e.curves[t];this.curves.push(new sw[i.type]().fromJSON(i))}return this}},_s=class extends fw{constructor(e){super();this.type="Path",this.currentPoint=new _e,e&&this.setFromPoints(e)}setFromPoints(e){this.moveTo(e[0].x,e[0].y);for(let t=1,n=e.length;t<n;t++)this.lineTo(e[t].x,e[t].y);return this}moveTo(e,t){return this.currentPoint.set(e,t),this}lineTo(e,t){let n=new Su(this.currentPoint.clone(),new _e(e,t));return this.curves.push(n),this.currentPoint.set(e,t),this}quadraticCurveTo(e,t,n,i){let r=new Mf(this.currentPoint.clone(),new _e(e,t),new _e(n,i));return this.curves.push(r),this.currentPoint.set(n,i),this}bezierCurveTo(e,t,n,i,r,s){let a=new bf(this.currentPoint.clone(),new _e(e,t),new _e(n,i),new _e(r,s));return this.curves.push(a),this.currentPoint.set(r,s),this}splineThru(e){let t=[this.currentPoint.clone()].concat(e),n=new Sf(t);return this.curves.push(n),this.currentPoint.copy(e[e.length-1]),this}arc(e,t,n,i,r,s){let a=this.currentPoint.x,l=this.currentPoint.y;return this.absarc(e+a,t+l,n,i,r,s),this}absarc(e,t,n,i,r,s){return this.absellipse(e,t,n,n,i,r,s),this}ellipse(e,t,n,i,r,s,a,l){let c=this.currentPoint.x,u=this.currentPoint.y;return this.absellipse(e+c,t+u,n,i,r,s,a,l),this}absellipse(e,t,n,i,r,s,a,l){let c=new Mu(e,t,n,i,r,s,a,l);if(this.curves.length>0){let d=c.getPoint(0);d.equals(this.currentPoint)||this.lineTo(d.x,d.y)}this.curves.push(c);let u=c.getPoint(1);return this.currentPoint.copy(u),this}copy(e){return super.copy(e),this.currentPoint.copy(e.currentPoint),this}toJSON(){let e=super.toJSON();return e.currentPoint=this.currentPoint.toArray(),e}fromJSON(e){return super.fromJSON(e),this.currentPoint.fromArray(e.currentPoint),this}},Wr=class extends _s{constructor(e){super(e);this.uuid=Xi(),this.type="Shape",this.holes=[]}getPointsHoles(e){let t=[];for(let n=0,i=this.holes.length;n<i;n++)t[n]=this.holes[n].getPoints(e);return t}extractPoints(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}}copy(e){super.copy(e),this.holes=[];for(let t=0,n=e.holes.length;t<n;t++){let i=e.holes[t];this.holes.push(i.clone())}return this}toJSON(){let e=super.toJSON();e.uuid=this.uuid,e.holes=[];for(let t=0,n=this.holes.length;t<n;t++){let i=this.holes[t];e.holes.push(i.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.uuid=e.uuid,this.holes=[];for(let t=0,n=e.holes.length;t<n;t++){let i=e.holes[t];this.holes.push(new _s().fromJSON(i))}return this}},fr=class extends $e{constructor(e,t=1){super();this.type="Light",this.color=new De(e),this.intensity=t}dispose(){}copy(e){return super.copy(e),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){let t=super.toJSON(e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,this.groundColor!==void 0&&(t.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(t.object.distance=this.distance),this.angle!==void 0&&(t.object.angle=this.angle),this.decay!==void 0&&(t.object.decay=this.decay),this.penumbra!==void 0&&(t.object.penumbra=this.penumbra),this.shadow!==void 0&&(t.object.shadow=this.shadow.toJSON()),t}};fr.prototype.isLight=!0;var Du=class extends fr{constructor(e,t,n){super(e,n);this.type="HemisphereLight",this.position.copy($e.DefaultUp),this.updateMatrix(),this.groundColor=new De(t)}copy(e){return fr.prototype.copy.call(this,e),this.groundColor.copy(e.groundColor),this}};Du.prototype.isHemisphereLight=!0;var CC=new Pe,LC=new U,RC=new U,ry=class{constructor(e){this.camera=e,this.bias=0,this.normalBias=0,this.radius=1,this.mapSize=new _e(512,512),this.map=null,this.mapPass=null,this.matrix=new Pe,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new hu,this._frameExtents=new _e(1,1),this._viewportCount=1,this._viewports=[new tt(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){let t=this.camera,n=this.matrix;LC.setFromMatrixPosition(e.matrixWorld),t.position.copy(LC),RC.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(RC),t.updateMatrixWorld(),CC.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(CC),n.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),n.multiply(t.projectionMatrix),n.multiply(t.matrixWorldInverse)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){let e={};return this.bias!==0&&(e.bias=this.bias),this.normalBias!==0&&(e.normalBias=this.normalBias),this.radius!==1&&(e.radius=this.radius),(this.mapSize.x!==512||this.mapSize.y!==512)&&(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}},pw=class extends ry{constructor(){super(new It(50,1,.5,500));this.focus=1}updateMatrices(e){let t=this.camera,n=ef*2*e.angle*this.focus,i=this.mapSize.width/this.mapSize.height,r=e.distance||t.far;(n!==t.fov||i!==t.aspect||r!==t.far)&&(t.fov=n,t.aspect=i,t.far=r,t.updateProjectionMatrix()),super.updateMatrices(e)}copy(e){return super.copy(e),this.focus=e.focus,this}};pw.prototype.isSpotLightShadow=!0;var ws=class extends fr{constructor(e,t,n=0,i=Math.PI/3,r=0,s=1){super(e,t);this.type="SpotLight",this.position.copy($e.DefaultUp),this.updateMatrix(),this.target=new $e,this.distance=n,this.angle=i,this.penumbra=r,this.decay=s,this.shadow=new pw}get power(){return this.intensity*Math.PI}set power(e){this.intensity=e/Math.PI}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}};ws.prototype.isSpotLight=!0;var PC=new Pe,Cf=new U,mw=new U,gw=class extends ry{constructor(){super(new It(90,1,.5,500));this._frameExtents=new _e(4,2),this._viewportCount=6,this._viewports=[new tt(2,1,1,1),new tt(0,1,1,1),new tt(3,1,1,1),new tt(1,1,1,1),new tt(3,0,1,1),new tt(1,0,1,1)],this._cubeDirections=[new U(1,0,0),new U(-1,0,0),new U(0,0,1),new U(0,0,-1),new U(0,1,0),new U(0,-1,0)],this._cubeUps=[new U(0,1,0),new U(0,1,0),new U(0,1,0),new U(0,1,0),new U(0,0,1),new U(0,0,-1)]}updateMatrices(e,t=0){let n=this.camera,i=this.matrix,r=e.distance||n.far;r!==n.far&&(n.far=r,n.updateProjectionMatrix()),Cf.setFromMatrixPosition(e.matrixWorld),n.position.copy(Cf),mw.copy(n.position),mw.add(this._cubeDirections[t]),n.up.copy(this._cubeUps[t]),n.lookAt(mw),n.updateMatrixWorld(),i.makeTranslation(-Cf.x,-Cf.y,-Cf.z),PC.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),this._frustum.setFromProjectionMatrix(PC)}};gw.prototype.isPointLightShadow=!0;var Xr=class extends fr{constructor(e,t,n=0,i=1){super(e,t);this.type="PointLight",this.distance=n,this.decay=i,this.shadow=new gw}get power(){return this.intensity*4*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}};Xr.prototype.isPointLight=!0;var ci=class extends au{constructor(e=-1,t=1,n=1,i=-1,r=.1,s=2e3){super();this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=n,this.bottom=i,this.near=r,this.far=s,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=e.view===null?null:Object.assign({},e.view),this}setViewOffset(e,t,n,i,r,s){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=i,this.view.width=r,this.view.height=s,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){let e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,i=(this.top+this.bottom)/2,r=n-e,s=n+e,a=i+t,l=i-t;if(this.view!==null&&this.view.enabled){let c=(this.right-this.left)/this.view.fullWidth/this.zoom,u=(this.top-this.bottom)/this.view.fullHeight/this.zoom;r+=c*this.view.offsetX,s=r+c*this.view.width,a-=u*this.view.offsetY,l=a-u*this.view.height}this.projectionMatrix.makeOrthographic(r,s,a,l,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){let t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,this.view!==null&&(t.object.view=Object.assign({},this.view)),t}};ci.prototype.isOrthographicCamera=!0;var yw=class extends ry{constructor(){super(new ci(-5,5,5,-5,.5,500))}};yw.prototype.isDirectionalLightShadow=!0;var bs=class extends fr{constructor(e,t){super(e,t);this.type="DirectionalLight",this.position.copy($e.DefaultUp),this.updateMatrix(),this.target=new $e,this.shadow=new yw}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}};bs.prototype.isDirectionalLight=!0;var ma=class extends fr{constructor(e,t){super(e,t);this.type="AmbientLight"}};ma.prototype.isAmbientLight=!0;var Fu=class extends fr{constructor(e,t,n=10,i=10){super(e,t);this.type="RectAreaLight",this.width=n,this.height=i}copy(e){return super.copy(e),this.width=e.width,this.height=e.height,this}toJSON(e){let t=super.toJSON(e);return t.object.width=this.width,t.object.height=this.height,t}};Fu.prototype.isRectAreaLight=!0;var sy=class{constructor(){this.coefficients=[];for(let e=0;e<9;e++)this.coefficients.push(new U)}set(e){for(let t=0;t<9;t++)this.coefficients[t].copy(e[t]);return this}zero(){for(let e=0;e<9;e++)this.coefficients[e].set(0,0,0);return this}getAt(e,t){let n=e.x,i=e.y,r=e.z,s=this.coefficients;return t.copy(s[0]).multiplyScalar(.282095),t.addScaledVector(s[1],.488603*i),t.addScaledVector(s[2],.488603*r),t.addScaledVector(s[3],.488603*n),t.addScaledVector(s[4],1.092548*(n*i)),t.addScaledVector(s[5],1.092548*(i*r)),t.addScaledVector(s[6],.315392*(3*r*r-1)),t.addScaledVector(s[7],1.092548*(n*r)),t.addScaledVector(s[8],.546274*(n*n-i*i)),t}getIrradianceAt(e,t){let n=e.x,i=e.y,r=e.z,s=this.coefficients;return t.copy(s[0]).multiplyScalar(.886227),t.addScaledVector(s[1],2*.511664*i),t.addScaledVector(s[2],2*.511664*r),t.addScaledVector(s[3],2*.511664*n),t.addScaledVector(s[4],2*.429043*n*i),t.addScaledVector(s[5],2*.429043*i*r),t.addScaledVector(s[6],.743125*r*r-.247708),t.addScaledVector(s[7],2*.429043*n*r),t.addScaledVector(s[8],.429043*(n*n-i*i)),t}add(e){for(let t=0;t<9;t++)this.coefficients[t].add(e.coefficients[t]);return this}addScaledSH(e,t){for(let n=0;n<9;n++)this.coefficients[n].addScaledVector(e.coefficients[n],t);return this}scale(e){for(let t=0;t<9;t++)this.coefficients[t].multiplyScalar(e);return this}lerp(e,t){for(let n=0;n<9;n++)this.coefficients[n].lerp(e.coefficients[n],t);return this}equals(e){for(let t=0;t<9;t++)if(!this.coefficients[t].equals(e.coefficients[t]))return!1;return!0}copy(e){return this.set(e.coefficients)}clone(){return new this.constructor().copy(this)}fromArray(e,t=0){let n=this.coefficients;for(let i=0;i<9;i++)n[i].fromArray(e,t+i*3);return this}toArray(e=[],t=0){let n=this.coefficients;for(let i=0;i<9;i++)n[i].toArray(e,t+i*3);return e}static getBasisAt(e,t){let n=e.x,i=e.y,r=e.z;t[0]=.282095,t[1]=.488603*i,t[2]=.488603*r,t[3]=.488603*n,t[4]=1.092548*n*i,t[5]=1.092548*i*r,t[6]=.315392*(3*r*r-1),t[7]=1.092548*n*r,t[8]=.546274*(n*n-i*i)}};sy.prototype.isSphericalHarmonics3=!0;var Bu=class extends fr{constructor(e=new sy,t=1){super(void 0,t);this.sh=e}copy(e){return super.copy(e),this.sh.copy(e.sh),this}fromJSON(e){return this.intensity=e.intensity,this.sh.fromArray(e.sh),this}toJSON(e){let t=super.toJSON(e);return t.object.sh=this.sh.toArray(),t}};Bu.prototype.isLightProbe=!0;var vw=class extends tn{constructor(e){super(e);this.textures={}}load(e,t,n,i){let r=this,s=new mn(r.manager);s.setPath(r.path),s.setRequestHeader(r.requestHeader),s.setWithCredentials(r.withCredentials),s.load(e,function(a){try{t(r.parse(JSON.parse(a)))}catch(l){i?i(l):console.error(l),r.manager.itemError(e)}},n,i)}parse(e){let t=this.textures;function n(r){return t[r]===void 0&&console.warn("THREE.MaterialLoader: Undefined texture",r),t[r]}let i=new j4[e.type];if(e.uuid!==void 0&&(i.uuid=e.uuid),e.name!==void 0&&(i.name=e.name),e.color!==void 0&&i.color!==void 0&&i.color.setHex(e.color),e.roughness!==void 0&&(i.roughness=e.roughness),e.metalness!==void 0&&(i.metalness=e.metalness),e.sheen!==void 0&&(i.sheen=new De().setHex(e.sheen)),e.emissive!==void 0&&i.emissive!==void 0&&i.emissive.setHex(e.emissive),e.specular!==void 0&&i.specular!==void 0&&i.specular.setHex(e.specular),e.shininess!==void 0&&(i.shininess=e.shininess),e.clearcoat!==void 0&&(i.clearcoat=e.clearcoat),e.clearcoatRoughness!==void 0&&(i.clearcoatRoughness=e.clearcoatRoughness),e.transmission!==void 0&&(i.transmission=e.transmission),e.thickness!==void 0&&(i.thickness=e.thickness),e.attenuationDistance!==void 0&&(i.attenuationDistance=e.attenuationDistance),e.attenuationColor!==void 0&&i.attenuationColor!==void 0&&i.attenuationColor.setHex(e.attenuationColor),e.fog!==void 0&&(i.fog=e.fog),e.flatShading!==void 0&&(i.flatShading=e.flatShading),e.blending!==void 0&&(i.blending=e.blending),e.combine!==void 0&&(i.combine=e.combine),e.side!==void 0&&(i.side=e.side),e.shadowSide!==void 0&&(i.shadowSide=e.shadowSide),e.opacity!==void 0&&(i.opacity=e.opacity),e.transparent!==void 0&&(i.transparent=e.transparent),e.alphaTest!==void 0&&(i.alphaTest=e.alphaTest),e.depthTest!==void 0&&(i.depthTest=e.depthTest),e.depthWrite!==void 0&&(i.depthWrite=e.depthWrite),e.colorWrite!==void 0&&(i.colorWrite=e.colorWrite),e.stencilWrite!==void 0&&(i.stencilWrite=e.stencilWrite),e.stencilWriteMask!==void 0&&(i.stencilWriteMask=e.stencilWriteMask),e.stencilFunc!==void 0&&(i.stencilFunc=e.stencilFunc),e.stencilRef!==void 0&&(i.stencilRef=e.stencilRef),e.stencilFuncMask!==void 0&&(i.stencilFuncMask=e.stencilFuncMask),e.stencilFail!==void 0&&(i.stencilFail=e.stencilFail),e.stencilZFail!==void 0&&(i.stencilZFail=e.stencilZFail),e.stencilZPass!==void 0&&(i.stencilZPass=e.stencilZPass),e.wireframe!==void 0&&(i.wireframe=e.wireframe),e.wireframeLinewidth!==void 0&&(i.wireframeLinewidth=e.wireframeLinewidth),e.wireframeLinecap!==void 0&&(i.wireframeLinecap=e.wireframeLinecap),e.wireframeLinejoin!==void 0&&(i.wireframeLinejoin=e.wireframeLinejoin),e.rotation!==void 0&&(i.rotation=e.rotation),e.linewidth!==1&&(i.linewidth=e.linewidth),e.dashSize!==void 0&&(i.dashSize=e.dashSize),e.gapSize!==void 0&&(i.gapSize=e.gapSize),e.scale!==void 0&&(i.scale=e.scale),e.polygonOffset!==void 0&&(i.polygonOffset=e.polygonOffset),e.polygonOffsetFactor!==void 0&&(i.polygonOffsetFactor=e.polygonOffsetFactor),e.polygonOffsetUnits!==void 0&&(i.polygonOffsetUnits=e.polygonOffsetUnits),e.morphTargets!==void 0&&(i.morphTargets=e.morphTargets),e.morphNormals!==void 0&&(i.morphNormals=e.morphNormals),e.dithering!==void 0&&(i.dithering=e.dithering),e.alphaToCoverage!==void 0&&(i.alphaToCoverage=e.alphaToCoverage),e.premultipliedAlpha!==void 0&&(i.premultipliedAlpha=e.premultipliedAlpha),e.vertexTangents!==void 0&&(i.vertexTangents=e.vertexTangents),e.visible!==void 0&&(i.visible=e.visible),e.toneMapped!==void 0&&(i.toneMapped=e.toneMapped),e.userData!==void 0&&(i.userData=e.userData),e.vertexColors!==void 0&&(typeof e.vertexColors=="number"?i.vertexColors=e.vertexColors>0:i.vertexColors=e.vertexColors),e.uniforms!==void 0)for(let r in e.uniforms){let s=e.uniforms[r];switch(i.uniforms[r]={},s.type){case"t":i.uniforms[r].value=n(s.value);break;case"c":i.uniforms[r].value=new De().setHex(s.value);break;case"v2":i.uniforms[r].value=new _e().fromArray(s.value);break;case"v3":i.uniforms[r].value=new U().fromArray(s.value);break;case"v4":i.uniforms[r].value=new tt().fromArray(s.value);break;case"m3":i.uniforms[r].value=new vt().fromArray(s.value);break;case"m4":i.uniforms[r].value=new Pe().fromArray(s.value);break;default:i.uniforms[r].value=s.value}}if(e.defines!==void 0&&(i.defines=e.defines),e.vertexShader!==void 0&&(i.vertexShader=e.vertexShader),e.fragmentShader!==void 0&&(i.fragmentShader=e.fragmentShader),e.extensions!==void 0)for(let r in e.extensions)i.extensions[r]=e.extensions[r];if(e.shading!==void 0&&(i.flatShading=e.shading===1),e.size!==void 0&&(i.size=e.size),e.sizeAttenuation!==void 0&&(i.sizeAttenuation=e.sizeAttenuation),e.map!==void 0&&(i.map=n(e.map)),e.matcap!==void 0&&(i.matcap=n(e.matcap)),e.alphaMap!==void 0&&(i.alphaMap=n(e.alphaMap)),e.bumpMap!==void 0&&(i.bumpMap=n(e.bumpMap)),e.bumpScale!==void 0&&(i.bumpScale=e.bumpScale),e.normalMap!==void 0&&(i.normalMap=n(e.normalMap)),e.normalMapType!==void 0&&(i.normalMapType=e.normalMapType),e.normalScale!==void 0){let r=e.normalScale;Array.isArray(r)===!1&&(r=[r,r]),i.normalScale=new _e().fromArray(r)}return e.displacementMap!==void 0&&(i.displacementMap=n(e.displacementMap)),e.displacementScale!==void 0&&(i.displacementScale=e.displacementScale),e.displacementBias!==void 0&&(i.displacementBias=e.displacementBias),e.roughnessMap!==void 0&&(i.roughnessMap=n(e.roughnessMap)),e.metalnessMap!==void 0&&(i.metalnessMap=n(e.metalnessMap)),e.emissiveMap!==void 0&&(i.emissiveMap=n(e.emissiveMap)),e.emissiveIntensity!==void 0&&(i.emissiveIntensity=e.emissiveIntensity),e.specularMap!==void 0&&(i.specularMap=n(e.specularMap)),e.envMap!==void 0&&(i.envMap=n(e.envMap)),e.envMapIntensity!==void 0&&(i.envMapIntensity=e.envMapIntensity),e.reflectivity!==void 0&&(i.reflectivity=e.reflectivity),e.refractionRatio!==void 0&&(i.refractionRatio=e.refractionRatio),e.lightMap!==void 0&&(i.lightMap=n(e.lightMap)),e.lightMapIntensity!==void 0&&(i.lightMapIntensity=e.lightMapIntensity),e.aoMap!==void 0&&(i.aoMap=n(e.aoMap)),e.aoMapIntensity!==void 0&&(i.aoMapIntensity=e.aoMapIntensity),e.gradientMap!==void 0&&(i.gradientMap=n(e.gradientMap)),e.clearcoatMap!==void 0&&(i.clearcoatMap=n(e.clearcoatMap)),e.clearcoatRoughnessMap!==void 0&&(i.clearcoatRoughnessMap=n(e.clearcoatRoughnessMap)),e.clearcoatNormalMap!==void 0&&(i.clearcoatNormalMap=n(e.clearcoatNormalMap)),e.clearcoatNormalScale!==void 0&&(i.clearcoatNormalScale=new _e().fromArray(e.clearcoatNormalScale)),e.transmissionMap!==void 0&&(i.transmissionMap=n(e.transmissionMap)),e.thicknessMap!==void 0&&(i.thicknessMap=n(e.thicknessMap)),i}setTextures(e){return this.textures=e,this}},Mi=class{static decodeText(e){if(typeof TextDecoder!="undefined")return new TextDecoder().decode(e);let t="";for(let n=0,i=e.length;n<i;n++)t+=String.fromCharCode(e[n]);try{return decodeURIComponent(escape(t))}catch(n){return t}}static extractUrlBase(e){let t=e.lastIndexOf("/");return t===-1?"./":e.substr(0,t+1)}},oy=class extends Ue{constructor(){super();this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(e){return super.copy(e),this.instanceCount=e.instanceCount,this}clone(){return new this.constructor().copy(this)}toJSON(){let e=super.toJSON(this);return e.instanceCount=this.instanceCount,e.isInstancedBufferGeometry=!0,e}};oy.prototype.isInstancedBufferGeometry=!0;var ay=class extends Ye{constructor(e,t,n,i=1){typeof n=="number"&&(i=n,n=!1,console.error("THREE.InstancedBufferAttribute: The constructor now expects normalized as the third argument."));super(e,t,n);this.meshPerAttribute=i}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}toJSON(){let e=super.toJSON();return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}};ay.prototype.isInstancedBufferAttribute=!0;var xw=class extends tn{constructor(e){super(e)}load(e,t,n,i){let r=this,s=new mn(r.manager);s.setPath(r.path),s.setRequestHeader(r.requestHeader),s.setWithCredentials(r.withCredentials),s.load(e,function(a){try{t(r.parse(JSON.parse(a)))}catch(l){i?i(l):console.error(l),r.manager.itemError(e)}},n,i)}parse(e){let t={},n={};function i(f,p){if(t[p]!==void 0)return t[p];let v=f.interleavedBuffers[p],y=r(f,v.buffer),m=iu(v.type,y),x=new ds(m,v.stride);return x.uuid=v.uuid,t[p]=x,x}function r(f,p){if(n[p]!==void 0)return n[p];let v=f.arrayBuffers[p],y=new Uint32Array(v).buffer;return n[p]=y,y}let s=e.isInstancedBufferGeometry?new oy:new Ue,a=e.data.index;if(a!==void 0){let f=iu(a.type,a.array);s.setIndex(new Ye(f,1))}let l=e.data.attributes;for(let f in l){let p=l[f],g;if(p.isInterleavedBufferAttribute){let v=i(e.data,p.data);g=new kr(v,p.itemSize,p.offset,p.normalized)}else{let v=iu(p.type,p.array),y=p.isInstancedBufferAttribute?ay:Ye;g=new y(v,p.itemSize,p.normalized)}p.name!==void 0&&(g.name=p.name),p.usage!==void 0&&g.setUsage(p.usage),p.updateRange!==void 0&&(g.updateRange.offset=p.updateRange.offset,g.updateRange.count=p.updateRange.count),s.setAttribute(f,g)}let c=e.data.morphAttributes;if(c)for(let f in c){let p=c[f],g=[];for(let v=0,y=p.length;v<y;v++){let m=p[v],x;if(m.isInterleavedBufferAttribute){let _=i(e.data,m.data);x=new kr(_,m.itemSize,m.offset,m.normalized)}else{let _=iu(m.type,m.array);x=new Ye(_,m.itemSize,m.normalized)}m.name!==void 0&&(x.name=m.name),g.push(x)}s.morphAttributes[f]=g}e.data.morphTargetsRelative&&(s.morphTargetsRelative=!0);let d=e.data.groups||e.data.drawcalls||e.data.offsets;if(d!==void 0)for(let f=0,p=d.length;f!==p;++f){let g=d[f];s.addGroup(g.start,g.count,g.materialIndex)}let h=e.data.boundingSphere;if(h!==void 0){let f=new U;h.center!==void 0&&f.fromArray(h.center),s.boundingSphere=new qi(f,h.radius)}return e.name&&(s.name=e.name),e.userData&&(s.userData=e.userData),s}},ly=class extends tn{constructor(e){super(e)}load(e,t,n,i){let r=this,s=this.path===""?Mi.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||s;let a=new mn(this.manager);a.setPath(this.path),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(e,function(l){let c=null;try{c=JSON.parse(l)}catch(d){i!==void 0&&i(d),console.error("THREE:ObjectLoader: Can't parse "+e+".",d.message);return}let u=c.metadata;if(u===void 0||u.type===void 0||u.type.toLowerCase()==="geometry"){console.error("THREE.ObjectLoader: Can't load "+e);return}r.parse(c,t)},n,i)}async loadAsync(e,t){let n=this,i=this.path===""?Mi.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||i;let r=new mn(this.manager);r.setPath(this.path),r.setRequestHeader(this.requestHeader),r.setWithCredentials(this.withCredentials);let s=await r.loadAsync(e,t),a=JSON.parse(s),l=a.metadata;if(l===void 0||l.type===void 0||l.type.toLowerCase()==="geometry")throw new Error("THREE.ObjectLoader: Can't load "+e);return await n.parseAsync(a)}parse(e,t){let n=this.parseAnimations(e.animations),i=this.parseShapes(e.shapes),r=this.parseGeometries(e.geometries,i),s=this.parseImages(e.images,function(){t!==void 0&&t(c)}),a=this.parseTextures(e.textures,s),l=this.parseMaterials(e.materials,a),c=this.parseObject(e.object,r,l,a,n),u=this.parseSkeletons(e.skeletons,c);if(this.bindSkeletons(c,u),t!==void 0){let d=!1;for(let h in s)if(s[h]instanceof HTMLImageElement){d=!0;break}d===!1&&t(c)}return c}async parseAsync(e){let t=this.parseAnimations(e.animations),n=this.parseShapes(e.shapes),i=this.parseGeometries(e.geometries,n),r=await this.parseImagesAsync(e.images),s=this.parseTextures(e.textures,r),a=this.parseMaterials(e.materials,s),l=this.parseObject(e.object,i,a,s,t),c=this.parseSkeletons(e.skeletons,l);return this.bindSkeletons(l,c),l}parseShapes(e){let t={};if(e!==void 0)for(let n=0,i=e.length;n<i;n++){let r=new Wr().fromJSON(e[n]);t[r.uuid]=r}return t}parseSkeletons(e,t){let n={},i={};if(t.traverse(function(r){r.isBone&&(i[r.uuid]=r)}),e!==void 0)for(let r=0,s=e.length;r<s;r++){let a=new co().fromJSON(e[r],i);n[a.uuid]=a}return n}parseGeometries(e,t){let n={};if(e!==void 0){let i=new xw;for(let r=0,s=e.length;r<s;r++){let a,l=e[r];switch(l.type){case"BufferGeometry":case"InstancedBufferGeometry":a=i.parse(l);break;case"Geometry":console.error("THREE.ObjectLoader: The legacy Geometry type is no longer supported.");break;default:l.type in SC?a=SC[l.type].fromJSON(l,t):console.warn(`THREE.ObjectLoader: Unsupported geometry type "${l.type}"`)}a.uuid=l.uuid,l.name!==void 0&&(a.name=l.name),a.isBufferGeometry===!0&&l.userData!==void 0&&(a.userData=l.userData),n[l.uuid]=a}}return n}parseMaterials(e,t){let n={},i={};if(e!==void 0){let r=new vw;r.setTextures(t);for(let s=0,a=e.length;s<a;s++){let l=e[s];if(l.type==="MultiMaterial"){let c=[];for(let u=0;u<l.materials.length;u++){let d=l.materials[u];n[d.uuid]===void 0&&(n[d.uuid]=r.parse(d)),c.push(n[d.uuid])}i[l.uuid]=c}else n[l.uuid]===void 0&&(n[l.uuid]=r.parse(l)),i[l.uuid]=n[l.uuid]}}return i}parseAnimations(e){let t={};if(e!==void 0)for(let n=0;n<e.length;n++){let i=e[n],r=xs.parse(i);t[r.uuid]=r}return t}parseImages(e,t){let n=this,i={},r;function s(l){return n.manager.itemStart(l),r.load(l,function(){n.manager.itemEnd(l)},void 0,function(){n.manager.itemError(l),n.manager.itemEnd(l)})}function a(l){if(typeof l=="string"){let c=l,u=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(c)?c:n.resourcePath+c;return s(u)}else return l.data?{data:iu(l.type,l.data),width:l.width,height:l.height}:null}if(e!==void 0&&e.length>0){let l=new iy(t);r=new pa(l),r.setCrossOrigin(this.crossOrigin);for(let c=0,u=e.length;c<u;c++){let d=e[c],h=d.url;if(Array.isArray(h)){i[d.uuid]=[];for(let f=0,p=h.length;f<p;f++){let g=h[f],v=a(g);v!==null&&(v instanceof HTMLImageElement?i[d.uuid].push(v):i[d.uuid].push(new aa(v.data,v.width,v.height)))}}else{let f=a(d.url);f!==null&&(i[d.uuid]=f)}}}return i}async parseImagesAsync(e){let t=this,n={},i;async function r(s){if(typeof s=="string"){let a=s,l=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(a)?a:t.resourcePath+a;return await i.loadAsync(l)}else return s.data?{data:iu(s.type,s.data),width:s.width,height:s.height}:null}if(e!==void 0&&e.length>0){i=new pa(this.manager),i.setCrossOrigin(this.crossOrigin);for(let s=0,a=e.length;s<a;s++){let l=e[s],c=l.url;if(Array.isArray(c)){n[l.uuid]=[];for(let u=0,d=c.length;u<d;u++){let h=c[u],f=await r(h);f!==null&&(f instanceof HTMLImageElement?n[l.uuid].push(f):n[l.uuid].push(new aa(f.data,f.width,f.height)))}}else{let u=await r(l.url);u!==null&&(n[l.uuid]=u)}}}return n}parseTextures(e,t){function n(r,s){return typeof r=="number"?r:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",r),s[r])}let i={};if(e!==void 0)for(let r=0,s=e.length;r<s;r++){let a=e[r];a.image===void 0&&console.warn('THREE.ObjectLoader: No "image" specified for',a.uuid),t[a.image]===void 0&&console.warn("THREE.ObjectLoader: Undefined image",a.image);let l,c=t[a.image];Array.isArray(c)?(l=new Il(c),c.length===6&&(l.needsUpdate=!0)):(c&&c.data?l=new aa(c.data,c.width,c.height):l=new Vt(c),c&&(l.needsUpdate=!0)),l.uuid=a.uuid,a.name!==void 0&&(l.name=a.name),a.mapping!==void 0&&(l.mapping=n(a.mapping,J4)),a.offset!==void 0&&l.offset.fromArray(a.offset),a.repeat!==void 0&&l.repeat.fromArray(a.repeat),a.center!==void 0&&l.center.fromArray(a.center),a.rotation!==void 0&&(l.rotation=a.rotation),a.wrap!==void 0&&(l.wrapS=n(a.wrap[0],IC),l.wrapT=n(a.wrap[1],IC)),a.format!==void 0&&(l.format=a.format),a.type!==void 0&&(l.type=a.type),a.encoding!==void 0&&(l.encoding=a.encoding),a.minFilter!==void 0&&(l.minFilter=n(a.minFilter,DC)),a.magFilter!==void 0&&(l.magFilter=n(a.magFilter,DC)),a.anisotropy!==void 0&&(l.anisotropy=a.anisotropy),a.flipY!==void 0&&(l.flipY=a.flipY),a.premultiplyAlpha!==void 0&&(l.premultiplyAlpha=a.premultiplyAlpha),a.unpackAlignment!==void 0&&(l.unpackAlignment=a.unpackAlignment),i[a.uuid]=l}return i}parseObject(e,t,n,i,r){let s;function a(h){return t[h]===void 0&&console.warn("THREE.ObjectLoader: Undefined geometry",h),t[h]}function l(h){if(h!==void 0){if(Array.isArray(h)){let f=[];for(let p=0,g=h.length;p<g;p++){let v=h[p];n[v]===void 0&&console.warn("THREE.ObjectLoader: Undefined material",v),f.push(n[v])}return f}return n[h]===void 0&&console.warn("THREE.ObjectLoader: Undefined material",h),n[h]}}function c(h){return i[h]===void 0&&console.warn("THREE.ObjectLoader: Undefined texture",h),i[h]}let u,d;switch(e.type){case"Scene":s=new Dl,e.background!==void 0&&(Number.isInteger(e.background)?s.background=new De(e.background):s.background=c(e.background)),e.environment!==void 0&&(s.environment=c(e.environment)),e.fog!==void 0&&(e.fog.type==="Fog"?s.fog=new pu(e.fog.color,e.fog.near,e.fog.far):e.fog.type==="FogExp2"&&(s.fog=new fu(e.fog.color,e.fog.density)));break;case"PerspectiveCamera":s=new It(e.fov,e.aspect,e.near,e.far),e.focus!==void 0&&(s.focus=e.focus),e.zoom!==void 0&&(s.zoom=e.zoom),e.filmGauge!==void 0&&(s.filmGauge=e.filmGauge),e.filmOffset!==void 0&&(s.filmOffset=e.filmOffset),e.view!==void 0&&(s.view=Object.assign({},e.view));break;case"OrthographicCamera":s=new ci(e.left,e.right,e.top,e.bottom,e.near,e.far),e.zoom!==void 0&&(s.zoom=e.zoom),e.view!==void 0&&(s.view=Object.assign({},e.view));break;case"AmbientLight":s=new ma(e.color,e.intensity);break;case"DirectionalLight":s=new bs(e.color,e.intensity);break;case"PointLight":s=new Xr(e.color,e.intensity,e.distance,e.decay);break;case"RectAreaLight":s=new Fu(e.color,e.intensity,e.width,e.height);break;case"SpotLight":s=new ws(e.color,e.intensity,e.distance,e.angle,e.penumbra,e.decay);break;case"HemisphereLight":s=new Du(e.color,e.groundColor,e.intensity);break;case"LightProbe":s=new Bu().fromJSON(e);break;case"SkinnedMesh":u=a(e.geometry),d=l(e.material),s=new lo(u,d),e.bindMode!==void 0&&(s.bindMode=e.bindMode),e.bindMatrix!==void 0&&s.bindMatrix.fromArray(e.bindMatrix),e.skeleton!==void 0&&(s.skeleton=e.skeleton);break;case"Mesh":u=a(e.geometry),d=l(e.material),s=new et(u,d);break;case"InstancedMesh":u=a(e.geometry),d=l(e.material);let h=e.count,f=e.instanceMatrix,p=e.instanceColor;s=new Rg(u,d,h),s.instanceMatrix=new Ye(new Float32Array(f.array),16),p!==void 0&&(s.instanceColor=new Ye(new Float32Array(p.array),p.itemSize));break;case"LOD":s=new j_;break;case"Line":s=new ai(a(e.geometry),l(e.material));break;case"LineLoop":s=new xu(a(e.geometry),l(e.material));break;case"LineSegments":s=new An(a(e.geometry),l(e.material));break;case"PointCloud":case"Points":s=new la(a(e.geometry),l(e.material));break;case"Sprite":s=new vf(l(e.material));break;case"Group":s=new Zn;break;case"Bone":s=new fs;break;default:s=new $e}if(s.uuid=e.uuid,e.name!==void 0&&(s.name=e.name),e.matrix!==void 0?(s.matrix.fromArray(e.matrix),e.matrixAutoUpdate!==void 0&&(s.matrixAutoUpdate=e.matrixAutoUpdate),s.matrixAutoUpdate&&s.matrix.decompose(s.position,s.quaternion,s.scale)):(e.position!==void 0&&s.position.fromArray(e.position),e.rotation!==void 0&&s.rotation.fromArray(e.rotation),e.quaternion!==void 0&&s.quaternion.fromArray(e.quaternion),e.scale!==void 0&&s.scale.fromArray(e.scale)),e.castShadow!==void 0&&(s.castShadow=e.castShadow),e.receiveShadow!==void 0&&(s.receiveShadow=e.receiveShadow),e.shadow&&(e.shadow.bias!==void 0&&(s.shadow.bias=e.shadow.bias),e.shadow.normalBias!==void 0&&(s.shadow.normalBias=e.shadow.normalBias),e.shadow.radius!==void 0&&(s.shadow.radius=e.shadow.radius),e.shadow.mapSize!==void 0&&s.shadow.mapSize.fromArray(e.shadow.mapSize),e.shadow.camera!==void 0&&(s.shadow.camera=this.parseObject(e.shadow.camera))),e.visible!==void 0&&(s.visible=e.visible),e.frustumCulled!==void 0&&(s.frustumCulled=e.frustumCulled),e.renderOrder!==void 0&&(s.renderOrder=e.renderOrder),e.userData!==void 0&&(s.userData=e.userData),e.layers!==void 0&&(s.layers.mask=e.layers),e.children!==void 0){let h=e.children;for(let f=0;f<h.length;f++)s.add(this.parseObject(h[f],t,n,i,r))}if(e.animations!==void 0){let h=e.animations;for(let f=0;f<h.length;f++){let p=h[f];s.animations.push(r[p])}}if(e.type==="LOD"){e.autoUpdate!==void 0&&(s.autoUpdate=e.autoUpdate);let h=e.levels;for(let f=0;f<h.length;f++){let p=h[f],g=s.getObjectByProperty("uuid",p.object);g!==void 0&&s.addLevel(g,p.distance)}}return s}bindSkeletons(e,t){Object.keys(t).length!==0&&e.traverse(function(n){if(n.isSkinnedMesh===!0&&n.skeleton!==void 0){let i=t[n.skeleton];i===void 0?console.warn("THREE.ObjectLoader: No skeleton found with UUID:",n.skeleton):n.bind(i,n.bindMatrix)}})}setTexturePath(e){return console.warn("THREE.ObjectLoader: .setTexturePath() has been renamed to .setResourcePath()."),this.setResourcePath(e)}},J4={UVMapping:jm,CubeReflectionMapping:jd,CubeRefractionMapping:Yd,EquirectangularReflectionMapping:Gc,EquirectangularRefractionMapping:Ym,CubeUVReflectionMapping:Vc,CubeUVRefractionMapping:Zd},IC={RepeatWrapping:En,ClampToEdgeWrapping:an,MirroredRepeatWrapping:wl},DC={NearestFilter:ln,NearestMipmapNearestFilter:Wc,NearestMipmapLinearFilter:Xc,LinearFilter:Lt,LinearMipmapNearestFilter:Jd,LinearMipmapLinearFilter:hs},Lf=class extends tn{constructor(e){super(e);typeof createImageBitmap=="undefined"&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),typeof fetch=="undefined"&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(e){return this.options=e,this}load(e,t,n,i){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);let r=this,s=uo.get(e);if(s!==void 0)return r.manager.itemStart(e),setTimeout(function(){t&&t(s),r.manager.itemEnd(e)},0),s;let a={};a.credentials=this.crossOrigin==="anonymous"?"same-origin":"include",a.headers=this.requestHeader,fetch(e,a).then(function(l){return l.blob()}).then(function(l){return createImageBitmap(l,Object.assign(r.options,{colorSpaceConversion:"none"}))}).then(function(l){uo.add(e,l),t&&t(l),r.manager.itemEnd(e)}).catch(function(l){i&&i(l),r.manager.itemError(e),r.manager.itemEnd(e)}),r.manager.itemStart(e)}};Lf.prototype.isImageBitmapLoader=!0;var qr=class{constructor(){this.type="ShapePath",this.color=new De,this.subPaths=[],this.currentPath=null}moveTo(e,t){return this.currentPath=new _s,this.subPaths.push(this.currentPath),this.currentPath.moveTo(e,t),this}lineTo(e,t){return this.currentPath.lineTo(e,t),this}quadraticCurveTo(e,t,n,i){return this.currentPath.quadraticCurveTo(e,t,n,i),this}bezierCurveTo(e,t,n,i,r,s){return this.currentPath.bezierCurveTo(e,t,n,i,r,s),this}splineThru(e){return this.currentPath.splineThru(e),this}toShapes(e,t){function n(m){let x=[];for(let _=0,w=m.length;_<w;_++){let b=m[_],M=new Wr;M.curves=b.curves,x.push(M)}return x}function i(m,x){let _=x.length,w=!1;for(let b=_-1,M=0;M<_;b=M++){let S=x[b],E=x[M],A=E.x-S.x,L=E.y-S.y;if(Math.abs(L)>Number.EPSILON){if(L<0&&(S=x[M],A=-A,E=x[b],L=-L),m.y<S.y||m.y>E.y)continue;if(m.y===S.y){if(m.x===S.x)return!0}else{let B=L*(m.x-S.x)-A*(m.y-S.y);if(B===0)return!0;if(B<0)continue;w=!w}}else{if(m.y!==S.y)continue;if(E.x<=m.x&&m.x<=S.x||S.x<=m.x&&m.x<=E.x)return!0}}return w}let r=Zi.isClockWise,s=this.subPaths;if(s.length===0)return[];if(t===!0)return n(s);let a,l,c,u=[];if(s.length===1)return l=s[0],c=new Wr,c.curves=l.curves,u.push(c),u;let d=!r(s[0].getPoints());d=e?!d:d;let h=[],f=[],p=[],g=0,v;f[g]=void 0,p[g]=[];for(let m=0,x=s.length;m<x;m++)l=s[m],v=l.getPoints(),a=r(v),a=e?!a:a,a?(!d&&f[g]&&g++,f[g]={s:new Wr,p:v},f[g].s.curves=l.curves,d&&g++,p[g]=[]):p[g].push({h:l,p:v[0]});if(!f[0])return n(s);if(f.length>1){let m=!1,x=[];for(let _=0,w=f.length;_<w;_++)h[_]=[];for(let _=0,w=f.length;_<w;_++){let b=p[_];for(let M=0;M<b.length;M++){let S=b[M],E=!0;for(let A=0;A<f.length;A++)i(S.p,f[A].p)&&(_!==A&&x.push({froms:_,tos:A,hole:M}),E?(E=!1,h[A].push(S)):m=!0);E&&h[_].push(S)}}x.length>0&&(m||(p=h))}let y;for(let m=0,x=f.length;m<x;m++){c=f[m].s,u.push(c),y=p[m];for(let _=0,w=y.length;_<w;_++)c.holes.push(y[_].h)}return u}},cy=class{constructor(e){this.type="Font",this.data=e}generateShapes(e,t=100){let n=[],i=K4(e,t,this.data);for(let r=0,s=i.length;r<s;r++)Array.prototype.push.apply(n,i[r].toShapes());return n}};function K4(o,e,t){let n=Array.from(o),i=e/t.resolution,r=(t.boundingBox.yMax-t.boundingBox.yMin+t.underlineThickness)*i,s=[],a=0,l=0;for(let c=0;c<n.length;c++){let u=n[c];if(u===`
`)a=0,l-=r;else{let d=$4(u,i,a,l,t);a+=d.offsetX,s.push(d.path)}}return s}function $4(o,e,t,n,i){let r=i.glyphs[o]||i.glyphs["?"];if(!r){console.error('THREE.Font: character "'+o+'" does not exists in font family '+i.familyName+".");return}let s=new qr,a,l,c,u,d,h,f,p;if(r.o){let g=r._cachedOutline||(r._cachedOutline=r.o.split(" "));for(let v=0,y=g.length;v<y;)switch(g[v++]){case"m":a=g[v++]*e+t,l=g[v++]*e+n,s.moveTo(a,l);break;case"l":a=g[v++]*e+t,l=g[v++]*e+n,s.lineTo(a,l);break;case"q":c=g[v++]*e+t,u=g[v++]*e+n,d=g[v++]*e+t,h=g[v++]*e+n,s.quadraticCurveTo(d,h,c,u);break;case"b":c=g[v++]*e+t,u=g[v++]*e+n,d=g[v++]*e+t,h=g[v++]*e+n,f=g[v++]*e+t,p=g[v++]*e+n,s.bezierCurveTo(d,h,f,p,c,u);break}}return{offsetX:r.ha*e,path:s}}cy.prototype.isFont=!0;var FC=class extends tn{constructor(e){super(e)}load(e,t,n,i){let r=this,s=new mn(this.manager);s.setPath(this.path),s.setRequestHeader(this.requestHeader),s.setWithCredentials(r.withCredentials),s.load(e,function(a){let l;try{l=JSON.parse(a)}catch(u){console.warn("THREE.FontLoader: typeface.js support is being deprecated. Use typeface.json instead."),l=JSON.parse(a.substring(65,a.length-2))}let c=r.parse(l);t&&t(c)},n,i)}parse(e){return new cy(e)}},uy,_w={getContext:function(){return uy===void 0&&(uy=new(window.AudioContext||window.webkitAudioContext)),uy},setContext:function(o){uy=o}},ww=class extends tn{constructor(e){super(e)}load(e,t,n,i){let r=this,s=new mn(this.manager);s.setResponseType("arraybuffer"),s.setPath(this.path),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials),s.load(e,function(a){try{let l=a.slice(0);_w.getContext().decodeAudioData(l,function(u){t(u)})}catch(l){i?i(l):console.error(l),r.manager.itemError(e)}},n,i)}},bw=class extends Bu{constructor(e,t,n=1){super(void 0,n);let i=new De().set(e),r=new De().set(t),s=new U(i.r,i.g,i.b),a=new U(r.r,r.g,r.b),l=Math.sqrt(Math.PI),c=l*Math.sqrt(.75);this.sh.coefficients[0].copy(s).add(a).multiplyScalar(l),this.sh.coefficients[1].copy(s).sub(a).multiplyScalar(c)}};bw.prototype.isHemisphereLightProbe=!0;var Mw=class extends Bu{constructor(e,t=1){super(void 0,t);let n=new De().set(e);this.sh.coefficients[0].set(n.r,n.g,n.b).multiplyScalar(2*Math.sqrt(Math.PI))}};Mw.prototype.isAmbientLightProbe=!0;var BC=new Pe,NC=new Pe,OC=class{constructor(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new It,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new It,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}update(e){let t=this._cache;if(t.focus!==e.focus||t.fov!==e.fov||t.aspect!==e.aspect*this.aspect||t.near!==e.near||t.far!==e.far||t.zoom!==e.zoom||t.eyeSep!==this.eyeSep){t.focus=e.focus,t.fov=e.fov,t.aspect=e.aspect*this.aspect,t.near=e.near,t.far=e.far,t.zoom=e.zoom,t.eyeSep=this.eyeSep;let i=e.projectionMatrix.clone(),r=t.eyeSep/2,s=r*t.near/t.focus,a=t.near*Math.tan(Cl*t.fov*.5)/t.zoom,l,c;NC.elements[12]=-r,BC.elements[12]=r,l=-a*t.aspect+s,c=a*t.aspect+s,i.elements[0]=2*t.near/(c-l),i.elements[8]=(c+l)/(c-l),this.cameraL.projectionMatrix.copy(i),l=-a*t.aspect-s,c=a*t.aspect-s,i.elements[0]=2*t.near/(c-l),i.elements[8]=(c+l)/(c-l),this.cameraR.projectionMatrix.copy(i)}this.cameraL.matrixWorld.copy(e.matrixWorld).multiply(NC),this.cameraR.matrixWorld.copy(e.matrixWorld).multiply(BC)}},ga=class{constructor(e=!0){this.autoStart=e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=kC(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){let t=kC();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}};function kC(){return(typeof performance=="undefined"?Date:performance).now()}var kl=new U,zC=new gt,Q4=new U,zl=new U,UC=class extends $e{constructor(){super();this.type="AudioListener",this.context=_w.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new ga}getInput(){return this.gain}removeFilter(){return this.filter!==null&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this}getFilter(){return this.filter}setFilter(e){return this.filter!==null?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=e,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this}getMasterVolume(){return this.gain.gain.value}setMasterVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}updateMatrixWorld(e){super.updateMatrixWorld(e);let t=this.context.listener,n=this.up;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(kl,zC,Q4),zl.set(0,0,-1).applyQuaternion(zC),t.positionX){let i=this.context.currentTime+this.timeDelta;t.positionX.linearRampToValueAtTime(kl.x,i),t.positionY.linearRampToValueAtTime(kl.y,i),t.positionZ.linearRampToValueAtTime(kl.z,i),t.forwardX.linearRampToValueAtTime(zl.x,i),t.forwardY.linearRampToValueAtTime(zl.y,i),t.forwardZ.linearRampToValueAtTime(zl.z,i),t.upX.linearRampToValueAtTime(n.x,i),t.upY.linearRampToValueAtTime(n.y,i),t.upZ.linearRampToValueAtTime(n.z,i)}else t.setPosition(kl.x,kl.y,kl.z),t.setOrientation(zl.x,zl.y,zl.z,n.x,n.y,n.z)}},hy=class extends $e{constructor(e){super();this.type="Audio",this.listener=e,this.context=e.context,this.gain=this.context.createGain(),this.gain.connect(e.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(e){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=e,this.connect(),this}setMediaElementSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(e),this.connect(),this}setMediaStreamSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(e),this.connect(),this}setBuffer(e){return this.buffer=e,this.sourceType="buffer",this.autoplay&&this.play(),this}play(e=0){if(this.isPlaying===!0){console.warn("THREE.Audio: Audio is already playing.");return}if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}this._startedAt=this.context.currentTime+e;let t=this.context.createBufferSource();return t.buffer=this.buffer,t.loop=this.loop,t.loopStart=this.loopStart,t.loopEnd=this.loopEnd,t.onended=this.onEnded.bind(this),t.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=t,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.isPlaying===!0&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,this.loop===!0&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this}stop(){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this._progress=0,this.source.stop(),this.source.onended=null,this.isPlaying=!1,this}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].connect(this.filters[e]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].disconnect(this.filters[e]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}getFilters(){return this.filters}setFilters(e){return e||(e=[]),this._connected===!0?(this.disconnect(),this.filters=e.slice(),this.connect()):this.filters=e.slice(),this}setDetune(e){if(this.detune=e,this.source.detune!==void 0)return this.isPlaying===!0&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(e){return this.setFilters(e?[e]:[])}setPlaybackRate(e){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.playbackRate=e,this.isPlaying===!0&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1}getLoop(){return this.hasPlaybackControl===!1?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}setLoop(e){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.loop=e,this.isPlaying===!0&&(this.source.loop=this.loop),this}setLoopStart(e){return this.loopStart=e,this}setLoopEnd(e){return this.loopEnd=e,this}getVolume(){return this.gain.gain.value}setVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}},Ul=new U,HC=new gt,eG=new U,Hl=new U,GC=class extends hy{constructor(e){super(e);this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}getOutput(){return this.panner}getRefDistance(){return this.panner.refDistance}setRefDistance(e){return this.panner.refDistance=e,this}getRolloffFactor(){return this.panner.rolloffFactor}setRolloffFactor(e){return this.panner.rolloffFactor=e,this}getDistanceModel(){return this.panner.distanceModel}setDistanceModel(e){return this.panner.distanceModel=e,this}getMaxDistance(){return this.panner.maxDistance}setMaxDistance(e){return this.panner.maxDistance=e,this}setDirectionalCone(e,t,n){return this.panner.coneInnerAngle=e,this.panner.coneOuterAngle=t,this.panner.coneOuterGain=n,this}updateMatrixWorld(e){if(super.updateMatrixWorld(e),this.hasPlaybackControl===!0&&this.isPlaying===!1)return;this.matrixWorld.decompose(Ul,HC,eG),Hl.set(0,0,1).applyQuaternion(HC);let t=this.panner;if(t.positionX){let n=this.context.currentTime+this.listener.timeDelta;t.positionX.linearRampToValueAtTime(Ul.x,n),t.positionY.linearRampToValueAtTime(Ul.y,n),t.positionZ.linearRampToValueAtTime(Ul.z,n),t.orientationX.linearRampToValueAtTime(Hl.x,n),t.orientationY.linearRampToValueAtTime(Hl.y,n),t.orientationZ.linearRampToValueAtTime(Hl.z,n)}else t.setPosition(Ul.x,Ul.y,Ul.z),t.setOrientation(Hl.x,Hl.y,Hl.z)}},Sw=class{constructor(e,t=2048){this.analyser=e.context.createAnalyser(),this.analyser.fftSize=t,this.data=new Uint8Array(this.analyser.frequencyBinCount),e.getOutput().connect(this.analyser)}getFrequencyData(){return this.analyser.getByteFrequencyData(this.data),this.data}getAverageFrequency(){let e=0,t=this.getFrequencyData();for(let n=0;n<t.length;n++)e+=t[n];return e/t.length}},Tw=class{constructor(e,t,n){this.binding=e,this.valueSize=n;let i,r,s;switch(t){case"quaternion":i=this._slerp,r=this._slerpAdditive,s=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(n*6),this._workIndex=5;break;case"string":case"bool":i=this._select,r=this._select,s=this._setAdditiveIdentityOther,this.buffer=new Array(n*5);break;default:i=this._lerp,r=this._lerpAdditive,s=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(n*5)}this._mixBufferRegion=i,this._mixBufferRegionAdditive=r,this._setIdentity=s,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(e,t){let n=this.buffer,i=this.valueSize,r=e*i+i,s=this.cumulativeWeight;if(s===0){for(let a=0;a!==i;++a)n[r+a]=n[a];s=t}else{s+=t;let a=t/s;this._mixBufferRegion(n,r,0,a,i)}this.cumulativeWeight=s}accumulateAdditive(e){let t=this.buffer,n=this.valueSize,i=n*this._addIndex;this.cumulativeWeightAdditive===0&&this._setIdentity(),this._mixBufferRegionAdditive(t,i,0,e,n),this.cumulativeWeightAdditive+=e}apply(e){let t=this.valueSize,n=this.buffer,i=e*t+t,r=this.cumulativeWeight,s=this.cumulativeWeightAdditive,a=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,r<1){let l=t*this._origIndex;this._mixBufferRegion(n,i,l,1-r,t)}s>0&&this._mixBufferRegionAdditive(n,i,this._addIndex*t,1,t);for(let l=t,c=t+t;l!==c;++l)if(n[l]!==n[l+t]){a.setValue(n,i);break}}saveOriginalState(){let e=this.binding,t=this.buffer,n=this.valueSize,i=n*this._origIndex;e.getValue(t,i);for(let r=n,s=i;r!==s;++r)t[r]=t[i+r%n];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){let e=this.valueSize*3;this.binding.setValue(this.buffer,e)}_setAdditiveIdentityNumeric(){let e=this._addIndex*this.valueSize,t=e+this.valueSize;for(let n=e;n<t;n++)this.buffer[n]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){let e=this._origIndex*this.valueSize,t=this._addIndex*this.valueSize;for(let n=0;n<this.valueSize;n++)this.buffer[t+n]=this.buffer[e+n]}_select(e,t,n,i,r){if(i>=.5)for(let s=0;s!==r;++s)e[t+s]=e[n+s]}_slerp(e,t,n,i){gt.slerpFlat(e,t,e,t,e,n,i)}_slerpAdditive(e,t,n,i,r){let s=this._workIndex*r;gt.multiplyQuaternionsFlat(e,s,e,t,e,n),gt.slerpFlat(e,t,e,t,e,s,i)}_lerp(e,t,n,i,r){let s=1-i;for(let a=0;a!==r;++a){let l=t+a;e[l]=e[l]*s+e[n+a]*i}}_lerpAdditive(e,t,n,i,r){for(let s=0;s!==r;++s){let a=t+s;e[a]=e[a]+e[n+s]*i}}},Ew="\\[\\]\\.:\\/",tG=new RegExp("["+Ew+"]","g"),Aw="[^"+Ew+"]",nG="[^"+Ew.replace("\\.","")+"]",iG=/((?:WC+[\/:])*)/.source.replace("WC",Aw),rG=/(WCOD+)?/.source.replace("WCOD",nG),sG=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",Aw),oG=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",Aw),aG=new RegExp("^"+iG+rG+sG+oG+"$"),lG=["material","materials","bones"],VC=class{constructor(e,t,n){let i=n||st.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,i)}getValue(e,t){this.bind();let n=this._targetGroup.nCachedObjects_,i=this._bindings[n];i!==void 0&&i.getValue(e,t)}setValue(e,t){let n=this._bindings;for(let i=this._targetGroup.nCachedObjects_,r=n.length;i!==r;++i)n[i].setValue(e,t)}bind(){let e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].bind()}unbind(){let e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].unbind()}},st=class{constructor(e,t,n){this.path=t,this.parsedPath=n||st.parseTrackName(t),this.node=st.findNode(e,this.parsedPath.nodeName)||e,this.rootNode=e,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(e,t,n){return e&&e.isAnimationObjectGroup?new st.Composite(e,t,n):new st(e,t,n)}static sanitizeNodeName(e){return e.replace(/\s/g,"_").replace(tG,"")}static parseTrackName(e){let t=aG.exec(e);if(!t)throw new Error("PropertyBinding: Cannot parse trackName: "+e);let n={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},i=n.nodeName&&n.nodeName.lastIndexOf(".");if(i!==void 0&&i!==-1){let r=n.nodeName.substring(i+1);lG.indexOf(r)!==-1&&(n.nodeName=n.nodeName.substring(0,i),n.objectName=r)}if(n.propertyName===null||n.propertyName.length===0)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return n}static findNode(e,t){if(!t||t===""||t==="."||t===-1||t===e.name||t===e.uuid)return e;if(e.skeleton){let n=e.skeleton.getBoneByName(t);if(n!==void 0)return n}if(e.children){let n=function(r){for(let s=0;s<r.length;s++){let a=r[s];if(a.name===t||a.uuid===t)return a;let l=n(a.children);if(l)return l}return null},i=n(e.children);if(i)return i}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(e,t){e[t]=this.node[this.propertyName]}_getValue_array(e,t){let n=this.resolvedProperty;for(let i=0,r=n.length;i!==r;++i)e[t++]=n[i]}_getValue_arrayElement(e,t){e[t]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(e,t){this.resolvedProperty.toArray(e,t)}_setValue_direct(e,t){this.targetObject[this.propertyName]=e[t]}_setValue_direct_setNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(e,t){let n=this.resolvedProperty;for(let i=0,r=n.length;i!==r;++i)n[i]=e[t++]}_setValue_array_setNeedsUpdate(e,t){let n=this.resolvedProperty;for(let i=0,r=n.length;i!==r;++i)n[i]=e[t++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(e,t){let n=this.resolvedProperty;for(let i=0,r=n.length;i!==r;++i)n[i]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(e,t){this.resolvedProperty[this.propertyIndex]=e[t]}_setValue_arrayElement_setNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(e,t){this.resolvedProperty.fromArray(e,t)}_setValue_fromArray_setNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(e,t){this.bind(),this.getValue(e,t)}_setValue_unbound(e,t){this.bind(),this.setValue(e,t)}bind(){let e=this.node,t=this.parsedPath,n=t.objectName,i=t.propertyName,r=t.propertyIndex;if(e||(e=st.findNode(this.rootNode,t.nodeName)||this.rootNode,this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!e){console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.");return}if(n){let c=t.objectIndex;switch(n){case"materials":if(!e.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.materials){console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);return}e=e.material.materials;break;case"bones":if(!e.skeleton){console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);return}e=e.skeleton.bones;for(let u=0;u<e.length;u++)if(e[u].name===c){c=u;break}break;default:if(e[n]===void 0){console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);return}e=e[n]}if(c!==void 0){if(e[c]===void 0){console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);return}e=e[c]}}let s=e[i];if(s===void 0){let c=t.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+c+"."+i+" but it wasn't found.",e);return}let a=this.Versioning.None;this.targetObject=e,e.needsUpdate!==void 0?a=this.Versioning.NeedsUpdate:e.matrixWorldNeedsUpdate!==void 0&&(a=this.Versioning.MatrixWorldNeedsUpdate);let l=this.BindingType.Direct;if(r!==void 0){if(i==="morphTargetInfluences"){if(!e.geometry){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);return}if(e.geometry.isBufferGeometry){if(!e.geometry.morphAttributes){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);return}e.morphTargetDictionary[r]!==void 0&&(r=e.morphTargetDictionary[r])}else{console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences on THREE.Geometry. Use THREE.BufferGeometry instead.",this);return}}l=this.BindingType.ArrayElement,this.resolvedProperty=s,this.propertyIndex=r}else s.fromArray!==void 0&&s.toArray!==void 0?(l=this.BindingType.HasFromToArray,this.resolvedProperty=s):Array.isArray(s)?(l=this.BindingType.EntireArray,this.resolvedProperty=s):this.propertyName=i;this.getValue=this.GetterByBindingType[l],this.setValue=this.SetterByBindingTypeAndVersioning[l][a]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}};st.Composite=VC;st.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3};st.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2};st.prototype.GetterByBindingType=[st.prototype._getValue_direct,st.prototype._getValue_array,st.prototype._getValue_arrayElement,st.prototype._getValue_toArray];st.prototype.SetterByBindingTypeAndVersioning=[[st.prototype._setValue_direct,st.prototype._setValue_direct_setNeedsUpdate,st.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[st.prototype._setValue_array,st.prototype._setValue_array_setNeedsUpdate,st.prototype._setValue_array_setMatrixWorldNeedsUpdate],[st.prototype._setValue_arrayElement,st.prototype._setValue_arrayElement_setNeedsUpdate,st.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[st.prototype._setValue_fromArray,st.prototype._setValue_fromArray_setNeedsUpdate,st.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];var Cw=class{constructor(){this.uuid=Xi(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;let e={};this._indicesByUUID=e;for(let n=0,i=arguments.length;n!==i;++n)e[arguments[n].uuid]=n;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};let t=this;this.stats={objects:{get total(){return t._objects.length},get inUse(){return this.total-t.nCachedObjects_}},get bindingsPerObject(){return t._bindings.length}}}add(){let e=this._objects,t=this._indicesByUUID,n=this._paths,i=this._parsedPaths,r=this._bindings,s=r.length,a,l=e.length,c=this.nCachedObjects_;for(let u=0,d=arguments.length;u!==d;++u){let h=arguments[u],f=h.uuid,p=t[f];if(p===void 0){p=l++,t[f]=p,e.push(h);for(let g=0,v=s;g!==v;++g)r[g].push(new st(h,n[g],i[g]))}else if(p<c){a=e[p];let g=--c,v=e[g];t[v.uuid]=p,e[p]=v,t[f]=g,e[g]=h;for(let y=0,m=s;y!==m;++y){let x=r[y],_=x[g],w=x[p];x[p]=_,w===void 0&&(w=new st(h,n[y],i[y])),x[g]=w}}else e[p]!==a&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=c}remove(){let e=this._objects,t=this._indicesByUUID,n=this._bindings,i=n.length,r=this.nCachedObjects_;for(let s=0,a=arguments.length;s!==a;++s){let l=arguments[s],c=l.uuid,u=t[c];if(u!==void 0&&u>=r){let d=r++,h=e[d];t[h.uuid]=u,e[u]=h,t[c]=d,e[d]=l;for(let f=0,p=i;f!==p;++f){let g=n[f],v=g[d],y=g[u];g[u]=v,g[d]=y}}}this.nCachedObjects_=r}uncache(){let e=this._objects,t=this._indicesByUUID,n=this._bindings,i=n.length,r=this.nCachedObjects_,s=e.length;for(let a=0,l=arguments.length;a!==l;++a){let c=arguments[a],u=c.uuid,d=t[u];if(d!==void 0)if(delete t[u],d<r){let h=--r,f=e[h],p=--s,g=e[p];t[f.uuid]=d,e[d]=f,t[g.uuid]=h,e[h]=g,e.pop();for(let v=0,y=i;v!==y;++v){let m=n[v],x=m[h],_=m[p];m[d]=x,m[h]=_,m.pop()}}else{let h=--s,f=e[h];h>0&&(t[f.uuid]=d),e[d]=f,e.pop();for(let p=0,g=i;p!==g;++p){let v=n[p];v[d]=v[h],v.pop()}}}this.nCachedObjects_=r}subscribe_(e,t){let n=this._bindingsIndicesByPath,i=n[e],r=this._bindings;if(i!==void 0)return r[i];let s=this._paths,a=this._parsedPaths,l=this._objects,c=l.length,u=this.nCachedObjects_,d=new Array(c);i=r.length,n[e]=i,s.push(e),a.push(t),r.push(d);for(let h=u,f=l.length;h!==f;++h){let p=l[h];d[h]=new st(p,e,t)}return d}unsubscribe_(e){let t=this._bindingsIndicesByPath,n=t[e];if(n!==void 0){let i=this._paths,r=this._parsedPaths,s=this._bindings,a=s.length-1,l=s[a],c=e[a];t[c]=n,s[n]=l,s.pop(),r[n]=r[a],r.pop(),i[n]=i[a],i.pop()}}};Cw.prototype.isAnimationObjectGroup=!0;var WC=class{constructor(e,t,n=null,i=t.blendMode){this._mixer=e,this._clip=t,this._localRoot=n,this.blendMode=i;let r=t.tracks,s=r.length,a=new Array(s),l={endingStart:El,endingEnd:El};for(let c=0;c!==s;++c){let u=r[c].createInterpolant(null);a[c]=u,u.settings=l}this._interpolantSettings=l,this._interpolants=a,this._propertyBindings=new Array(s),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=rA,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&this.timeScale!==0&&this._startTime===null&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(e){return this._startTime=e,this}setLoop(e,t){return this.loop=e,this.repetitions=t,this}setEffectiveWeight(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(e){return this._scheduleFading(e,0,1)}fadeOut(e){return this._scheduleFading(e,1,0)}crossFadeFrom(e,t,n){if(e.fadeOut(t),this.fadeIn(t),n){let i=this._clip.duration,r=e._clip.duration,s=r/i,a=i/r;e.warp(1,s,t),this.warp(a,1,t)}return this}crossFadeTo(e,t,n){return e.crossFadeFrom(this,t,n)}stopFading(){let e=this._weightInterpolant;return e!==null&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}setEffectiveTimeScale(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(e){return this.timeScale=this._clip.duration/e,this.stopWarping()}syncWith(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()}halt(e){return this.warp(this._effectiveTimeScale,0,e)}warp(e,t,n){let i=this._mixer,r=i.time,s=this.timeScale,a=this._timeScaleInterpolant;a===null&&(a=i._lendControlInterpolant(),this._timeScaleInterpolant=a);let l=a.parameterPositions,c=a.sampleValues;return l[0]=r,l[1]=r+n,c[0]=e/s,c[1]=t/s,this}stopWarping(){let e=this._timeScaleInterpolant;return e!==null&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(e,t,n,i){if(!this.enabled){this._updateWeight(e);return}let r=this._startTime;if(r!==null){let l=(e-r)*n;if(l<0||n===0)return;this._startTime=null,t=n*l}t*=this._updateTimeScale(e);let s=this._updateTime(t),a=this._updateWeight(e);if(a>0){let l=this._interpolants,c=this._propertyBindings;switch(this.blendMode){case r_:for(let u=0,d=l.length;u!==d;++u)l[u].evaluate(s),c[u].accumulateAdditive(a);break;case Jm:default:for(let u=0,d=l.length;u!==d;++u)l[u].evaluate(s),c[u].accumulate(i,a)}}}_updateWeight(e){let t=0;if(this.enabled){t=this.weight;let n=this._weightInterpolant;if(n!==null){let i=n.evaluate(e)[0];t*=i,e>n.parameterPositions[1]&&(this.stopFading(),i===0&&(this.enabled=!1))}}return this._effectiveWeight=t,t}_updateTimeScale(e){let t=0;if(!this.paused){t=this.timeScale;let n=this._timeScaleInterpolant;n!==null&&(t*=n.evaluate(e)[0],e>n.parameterPositions[1]&&(this.stopWarping(),t===0?this.paused=!0:this.timeScale=t))}return this._effectiveTimeScale=t,t}_updateTime(e){let t=this._clip.duration,n=this.loop,i=this.time+e,r=this._loopCount,s=n===sA;if(e===0)return r===-1?i:s&&(r&1)==1?t-i:i;if(n===iA){r===-1&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(i>=t)i=t;else if(i<0)i=0;else{this.time=i;break e}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=i,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(r===-1&&(e>=0?(r=0,this._setEndings(!0,this.repetitions===0,s)):this._setEndings(this.repetitions===0,!0,s)),i>=t||i<0){let a=Math.floor(i/t);i-=t*a,r+=Math.abs(a);let l=this.repetitions-r;if(l<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,i=e>0?t:0,this.time=i,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(l===1){let c=e<0;this._setEndings(c,!c,s)}else this._setEndings(!1,!1,s);this._loopCount=r,this.time=i,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:a})}}else this.time=i;if(s&&(r&1)==1)return t-i}return i}_setEndings(e,t,n){let i=this._interpolantSettings;n?(i.endingStart=Al,i.endingEnd=Al):(e?i.endingStart=this.zeroSlopeAtStart?Al:El:i.endingStart=Qd,t?i.endingEnd=this.zeroSlopeAtEnd?Al:El:i.endingEnd=Qd)}_scheduleFading(e,t,n){let i=this._mixer,r=i.time,s=this._weightInterpolant;s===null&&(s=i._lendControlInterpolant(),this._weightInterpolant=s);let a=s.parameterPositions,l=s.sampleValues;return a[0]=r,l[0]=t,a[1]=r+e,l[1]=n,this}},Rf=class extends Wi{constructor(e){super();this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(e,t){let n=e._localRoot||this._root,i=e._clip.tracks,r=i.length,s=e._propertyBindings,a=e._interpolants,l=n.uuid,c=this._bindingsByRootAndName,u=c[l];u===void 0&&(u={},c[l]=u);for(let d=0;d!==r;++d){let h=i[d],f=h.name,p=u[f];if(p!==void 0)s[d]=p;else{if(p=s[d],p!==void 0){p._cacheIndex===null&&(++p.referenceCount,this._addInactiveBinding(p,l,f));continue}let g=t&&t._propertyBindings[d].binding.parsedPath;p=new Tw(st.create(n,f,g),h.ValueTypeName,h.getValueSize()),++p.referenceCount,this._addInactiveBinding(p,l,f),s[d]=p}a[d].resultBuffer=p.buffer}}_activateAction(e){if(!this._isActiveAction(e)){if(e._cacheIndex===null){let n=(e._localRoot||this._root).uuid,i=e._clip.uuid,r=this._actionsByClip[i];this._bindAction(e,r&&r.knownActions[0]),this._addInactiveAction(e,i,n)}let t=e._propertyBindings;for(let n=0,i=t.length;n!==i;++n){let r=t[n];r.useCount++==0&&(this._lendBinding(r),r.saveOriginalState())}this._lendAction(e)}}_deactivateAction(e){if(this._isActiveAction(e)){let t=e._propertyBindings;for(let n=0,i=t.length;n!==i;++n){let r=t[n];--r.useCount==0&&(r.restoreOriginalState(),this._takeBackBinding(r))}this._takeBackAction(e)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;let e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}}_isActiveAction(e){let t=e._cacheIndex;return t!==null&&t<this._nActiveActions}_addInactiveAction(e,t,n){let i=this._actions,r=this._actionsByClip,s=r[t];if(s===void 0)s={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,r[t]=s;else{let a=s.knownActions;e._byClipCacheIndex=a.length,a.push(e)}e._cacheIndex=i.length,i.push(e),s.actionByRoot[n]=e}_removeInactiveAction(e){let t=this._actions,n=t[t.length-1],i=e._cacheIndex;n._cacheIndex=i,t[i]=n,t.pop(),e._cacheIndex=null;let r=e._clip.uuid,s=this._actionsByClip,a=s[r],l=a.knownActions,c=l[l.length-1],u=e._byClipCacheIndex;c._byClipCacheIndex=u,l[u]=c,l.pop(),e._byClipCacheIndex=null;let d=a.actionByRoot,h=(e._localRoot||this._root).uuid;delete d[h],l.length===0&&delete s[r],this._removeInactiveBindingsForAction(e)}_removeInactiveBindingsForAction(e){let t=e._propertyBindings;for(let n=0,i=t.length;n!==i;++n){let r=t[n];--r.referenceCount==0&&this._removeInactiveBinding(r)}}_lendAction(e){let t=this._actions,n=e._cacheIndex,i=this._nActiveActions++,r=t[i];e._cacheIndex=i,t[i]=e,r._cacheIndex=n,t[n]=r}_takeBackAction(e){let t=this._actions,n=e._cacheIndex,i=--this._nActiveActions,r=t[i];e._cacheIndex=i,t[i]=e,r._cacheIndex=n,t[n]=r}_addInactiveBinding(e,t,n){let i=this._bindingsByRootAndName,r=this._bindings,s=i[t];s===void 0&&(s={},i[t]=s),s[n]=e,e._cacheIndex=r.length,r.push(e)}_removeInactiveBinding(e){let t=this._bindings,n=e.binding,i=n.rootNode.uuid,r=n.path,s=this._bindingsByRootAndName,a=s[i],l=t[t.length-1],c=e._cacheIndex;l._cacheIndex=c,t[c]=l,t.pop(),delete a[r],Object.keys(a).length===0&&delete s[i]}_lendBinding(e){let t=this._bindings,n=e._cacheIndex,i=this._nActiveBindings++,r=t[i];e._cacheIndex=i,t[i]=e,r._cacheIndex=n,t[n]=r}_takeBackBinding(e){let t=this._bindings,n=e._cacheIndex,i=--this._nActiveBindings,r=t[i];e._cacheIndex=i,t[i]=e,r._cacheIndex=n,t[n]=r}_lendControlInterpolant(){let e=this._controlInterpolants,t=this._nActiveControlInterpolants++,n=e[t];return n===void 0&&(n=new ty(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer),n.__cacheIndex=t,e[t]=n),n}_takeBackControlInterpolant(e){let t=this._controlInterpolants,n=e.__cacheIndex,i=--this._nActiveControlInterpolants,r=t[i];e.__cacheIndex=i,t[i]=e,r.__cacheIndex=n,t[n]=r}clipAction(e,t,n){let i=t||this._root,r=i.uuid,s=typeof e=="string"?xs.findByName(i,e):e,a=s!==null?s.uuid:e,l=this._actionsByClip[a],c=null;if(n===void 0&&(s!==null?n=s.blendMode:n=Jm),l!==void 0){let d=l.actionByRoot[r];if(d!==void 0&&d.blendMode===n)return d;c=l.knownActions[0],s===null&&(s=c._clip)}if(s===null)return null;let u=new WC(this,s,t,n);return this._bindAction(u,c),this._addInactiveAction(u,a,r),u}existingAction(e,t){let n=t||this._root,i=n.uuid,r=typeof e=="string"?xs.findByName(n,e):e,s=r?r.uuid:e,a=this._actionsByClip[s];return a!==void 0&&a.actionByRoot[i]||null}stopAllAction(){let e=this._actions,t=this._nActiveActions;for(let n=t-1;n>=0;--n)e[n].stop();return this}update(e){e*=this.timeScale;let t=this._actions,n=this._nActiveActions,i=this.time+=e,r=Math.sign(e),s=this._accuIndex^=1;for(let c=0;c!==n;++c)t[c]._update(i,e,r,s);let a=this._bindings,l=this._nActiveBindings;for(let c=0;c!==l;++c)a[c].apply(s);return this}setTime(e){this.time=0;for(let t=0;t<this._actions.length;t++)this._actions[t].time=0;return this.update(e)}getRoot(){return this._root}uncacheClip(e){let t=this._actions,n=e.uuid,i=this._actionsByClip,r=i[n];if(r!==void 0){let s=r.knownActions;for(let a=0,l=s.length;a!==l;++a){let c=s[a];this._deactivateAction(c);let u=c._cacheIndex,d=t[t.length-1];c._cacheIndex=null,c._byClipCacheIndex=null,d._cacheIndex=u,t[u]=d,t.pop(),this._removeInactiveBindingsForAction(c)}delete i[n]}}uncacheRoot(e){let t=e.uuid,n=this._actionsByClip;for(let s in n){let a=n[s].actionByRoot,l=a[t];l!==void 0&&(this._deactivateAction(l),this._removeInactiveAction(l))}let i=this._bindingsByRootAndName,r=i[t];if(r!==void 0)for(let s in r){let a=r[s];a.restoreOriginalState(),this._removeInactiveBinding(a)}}uncacheAction(e,t){let n=this.existingAction(e,t);n!==null&&(this._deactivateAction(n),this._removeInactiveAction(n))}};Rf.prototype._controlInterpolantsResultBuffer=new Float32Array(1);var Pf=class{constructor(e){typeof e=="string"&&(console.warn("THREE.Uniform: Type parameter is no longer needed."),e=arguments[1]),this.value=e}clone(){return new Pf(this.value.clone===void 0?this.value:this.value.clone())}},Lw=class extends ds{constructor(e,t,n=1){super(e,t);this.meshPerAttribute=n}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}clone(e){let t=super.clone(e);return t.meshPerAttribute=this.meshPerAttribute,t}toJSON(e){let t=super.toJSON(e);return t.isInstancedInterleavedBuffer=!0,t.meshPerAttribute=this.meshPerAttribute,t}};Lw.prototype.isInstancedInterleavedBuffer=!0;var Rw=class{constructor(e,t,n,i,r){this.buffer=e,this.type=t,this.itemSize=n,this.elementSize=i,this.count=r,this.version=0}set needsUpdate(e){e===!0&&this.version++}setBuffer(e){return this.buffer=e,this}setType(e,t){return this.type=e,this.elementSize=t,this}setItemSize(e){return this.itemSize=e,this}setCount(e){return this.count=e,this}};Rw.prototype.isGLBufferAttribute=!0;var Nu=class{constructor(e,t,n=0,i=1/0){this.ray=new io(e,t),this.near=n,this.far=i,this.camera=null,this.layers=new lg,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(e,t){this.ray.set(e,t)}setFromCamera(e,t){t&&t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):t&&t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):console.error("THREE.Raycaster: Unsupported camera type: "+t.type)}intersectObject(e,t=!1,n=[]){return Pw(e,this,n,t),n.sort(XC),n}intersectObjects(e,t=!1,n=[]){for(let i=0,r=e.length;i<r;i++)Pw(e[i],this,n,t);return n.sort(XC),n}};function XC(o,e){return o.distance-e.distance}function Pw(o,e,t,n){if(o.layers.test(e.layers)&&o.raycast(e,t),n===!0){let i=o.children;for(let r=0,s=i.length;r<s;r++)Pw(i[r],e,t,!0)}}var If=class{constructor(e=1,t=0,n=0){return this.radius=e,this.phi=t,this.theta=n,this}set(e,t,n){return this.radius=e,this.phi=t,this.theta=n,this}copy(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}makeSafe(){let e=1e-6;return this.phi=Math.max(e,Math.min(Math.PI-e,this.phi)),this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,n){return this.radius=Math.sqrt(e*e+t*t+n*n),this.radius===0?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,n),this.phi=Math.acos(jn(t/this.radius,-1,1))),this}clone(){return new this.constructor().copy(this)}},qC=class{constructor(e=1,t=0,n=0){return this.radius=e,this.theta=t,this.y=n,this}set(e,t,n){return this.radius=e,this.theta=t,this.y=n,this}copy(e){return this.radius=e.radius,this.theta=e.theta,this.y=e.y,this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,n){return this.radius=Math.sqrt(e*e+n*n),this.theta=Math.atan2(e,n),this.y=t,this}clone(){return new this.constructor().copy(this)}},jC=new _e,ho=class{constructor(e=new _e(1/0,1/0),t=new _e(-1/0,-1/0)){this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromPoints(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){let n=jC.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(e){return this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y)}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return jC.copy(e).clamp(this.min,this.max).sub(e).length()}intersect(e){return this.min.max(e.min),this.max.min(e.max),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}};ho.prototype.isBox2=!0;var YC=new U,dy=new U,Gl=class{constructor(e=new U,t=new U){this.start=e,this.end=t}set(e,t){return this.start.copy(e),this.end.copy(t),this}copy(e){return this.start.copy(e.start),this.end.copy(e.end),this}getCenter(e){return e.addVectors(this.start,this.end).multiplyScalar(.5)}delta(e){return e.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(e,t){return this.delta(t).multiplyScalar(e).add(this.start)}closestPointToPointParameter(e,t){YC.subVectors(e,this.start),dy.subVectors(this.end,this.start);let n=dy.dot(dy),r=dy.dot(YC)/n;return t&&(r=jn(r,0,1)),r}closestPointToPoint(e,t,n){let i=this.closestPointToPointParameter(e,t);return this.delta(n).multiplyScalar(i).add(this.start)}applyMatrix4(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this}equals(e){return e.start.equals(this.start)&&e.end.equals(this.end)}clone(){return new this.constructor().copy(this)}},Iw=class extends $e{constructor(e){super();this.material=e,this.render=function(){},this.hasPositions=!1,this.hasNormals=!1,this.hasColors=!1,this.hasUvs=!1,this.positionArray=null,this.normalArray=null,this.colorArray=null,this.uvArray=null,this.count=0}};Iw.prototype.isImmediateRenderObject=!0;var ZC=new U,fy=class extends $e{constructor(e,t){super();this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=t;let n=new Ue,i=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let s=0,a=1,l=32;s<l;s++,a++){let c=s/l*Math.PI*2,u=a/l*Math.PI*2;i.push(Math.cos(c),Math.sin(c),1,Math.cos(u),Math.sin(u),1)}n.setAttribute("position",new Ne(i,3));let r=new zt({fog:!1,toneMapped:!1});this.cone=new An(n,r),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateMatrixWorld();let e=this.light.distance?this.light.distance:1e3,t=e*Math.tan(this.light.angle);this.cone.scale.set(t,t,e),ZC.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(ZC),this.color!==void 0?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}},ya=new U,py=new Pe,Dw=new Pe,Fw=class extends An{constructor(e){let t=JC(e),n=new Ue,i=[],r=[],s=new De(0,0,1),a=new De(0,1,0);for(let c=0;c<t.length;c++){let u=t[c];u.parent&&u.parent.isBone&&(i.push(0,0,0),i.push(0,0,0),r.push(s.r,s.g,s.b),r.push(a.r,a.g,a.b))}n.setAttribute("position",new Ne(i,3)),n.setAttribute("color",new Ne(r,3));let l=new zt({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0});super(n,l);this.type="SkeletonHelper",this.isSkeletonHelper=!0,this.root=e,this.bones=t,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1}updateMatrixWorld(e){let t=this.bones,n=this.geometry,i=n.getAttribute("position");Dw.copy(this.root.matrixWorld).invert();for(let r=0,s=0;r<t.length;r++){let a=t[r];a.parent&&a.parent.isBone&&(py.multiplyMatrices(Dw,a.matrixWorld),ya.setFromMatrixPosition(py),i.setXYZ(s,ya.x,ya.y,ya.z),py.multiplyMatrices(Dw,a.parent.matrixWorld),ya.setFromMatrixPosition(py),i.setXYZ(s+1,ya.x,ya.y,ya.z),s+=2)}n.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(e)}};function JC(o){let e=[];o&&o.isBone&&e.push(o);for(let t=0;t<o.children.length;t++)e.push.apply(e,JC(o.children[t]));return e}var KC=class extends et{constructor(e,t,n){let i=new Ji(t,4,2),r=new Jt({wireframe:!0,fog:!1,toneMapped:!1});super(i,r);this.light=e,this.light.updateMatrixWorld(),this.color=n,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){this.color!==void 0?this.material.color.set(this.color):this.material.color.copy(this.light.color)}},cG=new U,$C=new De,QC=new De,e2=class extends $e{constructor(e,t,n){super();this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=n;let i=new Fl(t);i.rotateY(Math.PI*.5),this.material=new Jt({wireframe:!0,fog:!1,toneMapped:!1}),this.color===void 0&&(this.material.vertexColors=!0);let r=i.getAttribute("position"),s=new Float32Array(r.count*3);i.setAttribute("color",new Ye(s,3)),this.add(new et(i,this.material)),this.update()}dispose(){this.children[0].geometry.dispose(),this.children[0].material.dispose()}update(){let e=this.children[0];if(this.color!==void 0)this.material.color.set(this.color);else{let t=e.geometry.getAttribute("color");$C.copy(this.light.color),QC.copy(this.light.groundColor);for(let n=0,i=t.count;n<i;n++){let r=n<i/2?$C:QC;t.setXYZ(n,r.r,r.g,r.b)}t.needsUpdate=!0}e.lookAt(cG.setFromMatrixPosition(this.light.matrixWorld).negate())}},Bw=class extends An{constructor(e=10,t=10,n=4473924,i=8947848){n=new De(n),i=new De(i);let r=t/2,s=e/t,a=e/2,l=[],c=[];for(let h=0,f=0,p=-a;h<=t;h++,p+=s){l.push(-a,0,p,a,0,p),l.push(p,0,-a,p,0,a);let g=h===r?n:i;g.toArray(c,f),f+=3,g.toArray(c,f),f+=3,g.toArray(c,f),f+=3,g.toArray(c,f),f+=3}let u=new Ue;u.setAttribute("position",new Ne(l,3)),u.setAttribute("color",new Ne(c,3));let d=new zt({vertexColors:!0,toneMapped:!1});super(u,d);this.type="GridHelper"}},t2=class extends An{constructor(e=10,t=16,n=8,i=64,r=4473924,s=8947848){r=new De(r),s=new De(s);let a=[],l=[];for(let d=0;d<=t;d++){let h=d/t*(Math.PI*2),f=Math.sin(h)*e,p=Math.cos(h)*e;a.push(0,0,0),a.push(f,0,p);let g=d&1?r:s;l.push(g.r,g.g,g.b),l.push(g.r,g.g,g.b)}for(let d=0;d<=n;d++){let h=d&1?r:s,f=e-e/n*d;for(let p=0;p<i;p++){let g=p/i*(Math.PI*2),v=Math.sin(g)*f,y=Math.cos(g)*f;a.push(v,0,y),l.push(h.r,h.g,h.b),g=(p+1)/i*(Math.PI*2),v=Math.sin(g)*f,y=Math.cos(g)*f,a.push(v,0,y),l.push(h.r,h.g,h.b)}}let c=new Ue;c.setAttribute("position",new Ne(a,3)),c.setAttribute("color",new Ne(l,3));let u=new zt({vertexColors:!0,toneMapped:!1});super(c,u);this.type="PolarGridHelper"}},n2=new U,my=new U,i2=new U,gy=class extends $e{constructor(e,t,n){super();this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=n,t===void 0&&(t=1);let i=new Ue;i.setAttribute("position",new Ne([-t,t,0,t,t,0,t,-t,0,-t,-t,0,-t,t,0],3));let r=new zt({fog:!1,toneMapped:!1});this.lightPlane=new ai(i,r),this.add(this.lightPlane),i=new Ue,i.setAttribute("position",new Ne([0,0,0,0,0,1],3)),this.targetLine=new ai(i,r),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){n2.setFromMatrixPosition(this.light.matrixWorld),my.setFromMatrixPosition(this.light.target.matrixWorld),i2.subVectors(my,n2),this.lightPlane.lookAt(my),this.color!==void 0?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(my),this.targetLine.scale.z=i2.length()}},yy=new U,dn=new au,r2=class extends An{constructor(e){let t=new Ue,n=new zt({color:16777215,vertexColors:!0,toneMapped:!1}),i=[],r=[],s={},a=new De(16755200),l=new De(16711680),c=new De(43775),u=new De(16777215),d=new De(3355443);h("n1","n2",a),h("n2","n4",a),h("n4","n3",a),h("n3","n1",a),h("f1","f2",a),h("f2","f4",a),h("f4","f3",a),h("f3","f1",a),h("n1","f1",a),h("n2","f2",a),h("n3","f3",a),h("n4","f4",a),h("p","n1",l),h("p","n2",l),h("p","n3",l),h("p","n4",l),h("u1","u2",c),h("u2","u3",c),h("u3","u1",c),h("c","t",u),h("p","c",d),h("cn1","cn2",d),h("cn3","cn4",d),h("cf1","cf2",d),h("cf3","cf4",d);function h(p,g,v){f(p,v),f(g,v)}function f(p,g){i.push(0,0,0),r.push(g.r,g.g,g.b),s[p]===void 0&&(s[p]=[]),s[p].push(i.length/3-1)}t.setAttribute("position",new Ne(i,3)),t.setAttribute("color",new Ne(r,3));super(t,n);this.type="CameraHelper",this.camera=e,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=s,this.update()}update(){let e=this.geometry,t=this.pointMap,n=1,i=1;dn.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),gn("c",t,e,dn,0,0,-1),gn("t",t,e,dn,0,0,1),gn("n1",t,e,dn,-n,-i,-1),gn("n2",t,e,dn,n,-i,-1),gn("n3",t,e,dn,-n,i,-1),gn("n4",t,e,dn,n,i,-1),gn("f1",t,e,dn,-n,-i,1),gn("f2",t,e,dn,n,-i,1),gn("f3",t,e,dn,-n,i,1),gn("f4",t,e,dn,n,i,1),gn("u1",t,e,dn,n*.7,i*1.1,-1),gn("u2",t,e,dn,-n*.7,i*1.1,-1),gn("u3",t,e,dn,0,i*2,-1),gn("cf1",t,e,dn,-n,0,1),gn("cf2",t,e,dn,n,0,1),gn("cf3",t,e,dn,0,-i,1),gn("cf4",t,e,dn,0,i,1),gn("cn1",t,e,dn,-n,0,-1),gn("cn2",t,e,dn,n,0,-1),gn("cn3",t,e,dn,0,-i,-1),gn("cn4",t,e,dn,0,i,-1),e.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}};function gn(o,e,t,n,i,r,s){yy.set(i,r,s).unproject(n);let a=e[o];if(a!==void 0){let l=t.getAttribute("position");for(let c=0,u=a.length;c<u;c++)l.setXYZ(a[c],yy.x,yy.y,yy.z)}}var vy=new Sn,Nw=class extends An{constructor(e,t=16776960){let n=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),i=new Float32Array(8*3),r=new Ue;r.setIndex(new Ye(n,1)),r.setAttribute("position",new Ye(i,3));super(r,new zt({color:t,toneMapped:!1}));this.object=e,this.type="BoxHelper",this.matrixAutoUpdate=!1,this.update()}update(e){if(e!==void 0&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),this.object!==void 0&&vy.setFromObject(this.object),vy.isEmpty())return;let t=vy.min,n=vy.max,i=this.geometry.attributes.position,r=i.array;r[0]=n.x,r[1]=n.y,r[2]=n.z,r[3]=t.x,r[4]=n.y,r[5]=n.z,r[6]=t.x,r[7]=t.y,r[8]=n.z,r[9]=n.x,r[10]=t.y,r[11]=n.z,r[12]=n.x,r[13]=n.y,r[14]=t.z,r[15]=t.x,r[16]=n.y,r[17]=t.z,r[18]=t.x,r[19]=t.y,r[20]=t.z,r[21]=n.x,r[22]=t.y,r[23]=t.z,i.needsUpdate=!0,this.geometry.computeBoundingSphere()}setFromObject(e){return this.object=e,this.update(),this}copy(e){return An.prototype.copy.call(this,e),this.object=e.object,this}},s2=class extends An{constructor(e,t=16776960){let n=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),i=[1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],r=new Ue;r.setIndex(new Ye(n,1)),r.setAttribute("position",new Ne(i,3));super(r,new zt({color:t,toneMapped:!1}));this.box=e,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(e){let t=this.box;t.isEmpty()||(t.getCenter(this.position),t.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(e))}},o2=class extends ai{constructor(e,t=1,n=16776960){let i=n,r=[1,-1,1,-1,1,1,-1,-1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,0,0,1,0,0,0],s=new Ue;s.setAttribute("position",new Ne(r,3)),s.computeBoundingSphere();super(s,new zt({color:i,toneMapped:!1}));this.type="PlaneHelper",this.plane=e,this.size=t;let a=[1,1,1,-1,1,1,-1,-1,1,1,1,1,-1,-1,1,1,-1,1],l=new Ue;l.setAttribute("position",new Ne(a,3)),l.computeBoundingSphere(),this.add(new et(l,new Jt({color:i,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1})))}updateMatrixWorld(e){let t=-this.plane.constant;Math.abs(t)<1e-8&&(t=1e-8),this.scale.set(.5*this.size,.5*this.size,t),this.children[0].material.side=t<0?Qt:Js,this.lookAt(this.plane.normal),super.updateMatrixWorld(e)}},a2=new U,xy,Ow,l2=class extends $e{constructor(e=new U(0,0,1),t=new U(0,0,0),n=1,i=16776960,r=n*.2,s=r*.2){super();this.type="ArrowHelper",xy===void 0&&(xy=new Ue,xy.setAttribute("position",new Ne([0,0,0,0,1,0],3)),Ow=new ca(0,.5,1,5,1),Ow.translate(0,-.5,0)),this.position.copy(t),this.line=new ai(xy,new zt({color:i,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new et(Ow,new Jt({color:i,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(e),this.setLength(n,r,s)}setDirection(e){if(e.y>.99999)this.quaternion.set(0,0,0,1);else if(e.y<-.99999)this.quaternion.set(1,0,0,0);else{a2.set(e.z,0,-e.x).normalize();let t=Math.acos(e.y);this.quaternion.setFromAxisAngle(a2,t)}}setLength(e,t=e*.2,n=t*.2){this.line.scale.set(1,Math.max(1e-4,e-t),1),this.line.updateMatrix(),this.cone.scale.set(n,t,n),this.cone.position.y=e,this.cone.updateMatrix()}setColor(e){this.line.material.color.set(e),this.cone.material.color.set(e)}copy(e){return super.copy(e,!1),this.line.copy(e.line),this.cone.copy(e.cone),this}},kw=class extends An{constructor(e=1){let t=[0,0,0,e,0,0,0,0,0,0,e,0,0,0,0,0,0,e],n=[1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],i=new Ue;i.setAttribute("position",new Ne(t,3)),i.setAttribute("color",new Ne(n,3));let r=new zt({vertexColors:!0,toneMapped:!1});super(i,r);this.type="AxesHelper"}setColors(e,t,n){let i=new De,r=this.geometry.attributes.color.array;return i.set(e),i.toArray(r,0),i.toArray(r,3),i.set(t),i.toArray(r,6),i.toArray(r,9),i.set(n),i.toArray(r,12),i.toArray(r,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}},c2=new Float32Array(1),uG=new Int32Array(c2.buffer),u2=class{static toHalfFloat(e){c2[0]=e;let t=uG[0],n=t>>16&32768,i=t>>12&2047,r=t>>23&255;return r<103?n:r>142?(n|=31744,n|=(r==255?0:1)&&t&8388607,n):r<113?(i|=2048,n|=(i>>114-r)+(i>>113-r&1),n):(n|=r-112<<10|i>>1,n+=i&1,n)}},Ou=4,va=8,Ms=Math.pow(2,va),h2=[.125,.215,.35,.446,.526,.582],d2=va-Ou+1+h2.length,ku=20,Ss={[Xn]:0,[Vi]:1,[Qm]:2,[o_]:3,[a_]:4,[l_]:5,[$m]:6},Vl=new Jt({side:Qt,depthWrite:!1,depthTest:!1}),hG=new et(new ao,Vl),zw=new ci,{_lodPlanes:Df,_sizeLods:f2,_sigmas:_y}=fG(),p2=new De,Uw=null,Wl=(1+Math.sqrt(5))/2,zu=1/Wl,m2=[new U(1,1,1),new U(-1,1,1),new U(1,1,-1),new U(-1,1,-1),new U(0,Wl,zu),new U(0,Wl,-zu),new U(zu,0,Wl),new U(-zu,0,Wl),new U(Wl,zu,0),new U(-Wl,zu,0)];function g2(o){let e=Math.max(o.r,o.g,o.b),t=Math.min(Math.max(Math.ceil(Math.log2(e)),-128),127);return o.multiplyScalar(Math.pow(2,-t)),(t+128)/255}var y2=class{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._blurMaterial=pG(ku),this._equirectShader=null,this._cubemapShader=null,this._compileMaterial(this._blurMaterial)}fromScene(e,t=0,n=.1,i=100){Uw=this._renderer.getRenderTarget();let r=this._allocateTargets();return this._sceneToCubeUV(e,n,i,r),t>0&&this._blur(r,0,0,t),this._applyPMREM(r),this._cleanup(r),r}fromEquirectangular(e){return this._fromTexture(e)}fromCubemap(e){return this._fromTexture(e)}compileCubemapShader(){this._cubemapShader===null&&(this._cubemapShader=_2(),this._compileMaterial(this._cubemapShader))}compileEquirectangularShader(){this._equirectShader===null&&(this._equirectShader=x2(),this._compileMaterial(this._equirectShader))}dispose(){this._blurMaterial.dispose(),this._cubemapShader!==null&&this._cubemapShader.dispose(),this._equirectShader!==null&&this._equirectShader.dispose();for(let e=0;e<Df.length;e++)Df[e].dispose()}_cleanup(e){this._pingPongRenderTarget.dispose(),this._renderer.setRenderTarget(Uw),e.scissorTest=!1,wy(e,0,0,e.width,e.height)}_fromTexture(e){Uw=this._renderer.getRenderTarget();let t=this._allocateTargets(e);return this._textureToCubeUV(e,t),this._applyPMREM(t),this._cleanup(t),t}_allocateTargets(e){let t={magFilter:ln,minFilter:ln,generateMipmaps:!1,type:bl,format:_E,encoding:dG(e)?e.encoding:Qm,depthBuffer:!1},n=v2(t);return n.depthBuffer=!e,this._pingPongRenderTarget=v2(t),n}_compileMaterial(e){let t=new et(Df[0],e);this._renderer.compile(t,zw)}_sceneToCubeUV(e,t,n,i){let r=90,s=1,a=new It(r,s,t,n),l=[1,-1,1,1,1,1],c=[1,1,1,-1,-1,-1],u=this._renderer,d=u.autoClear,h=u.outputEncoding,f=u.toneMapping;u.getClearColor(p2),u.toneMapping=Zo,u.outputEncoding=Xn,u.autoClear=!1;let p=!1,g=e.background;if(g){if(g.isColor){Vl.color.copy(g).convertSRGBToLinear(),e.background=null;let v=g2(Vl.color);Vl.opacity=v,p=!0}}else{Vl.color.copy(p2).convertSRGBToLinear();let v=g2(Vl.color);Vl.opacity=v,p=!0}for(let v=0;v<6;v++){let y=v%3;y==0?(a.up.set(0,l[v],0),a.lookAt(c[v],0,0)):y==1?(a.up.set(0,0,l[v]),a.lookAt(0,c[v],0)):(a.up.set(0,l[v],0),a.lookAt(0,0,c[v])),wy(i,y*Ms,v>2?Ms:0,Ms,Ms),u.setRenderTarget(i),p&&u.render(hG,a),u.render(e,a)}u.toneMapping=f,u.outputEncoding=h,u.autoClear=d}_textureToCubeUV(e,t){let n=this._renderer;e.isCubeTexture?this._cubemapShader==null&&(this._cubemapShader=_2()):this._equirectShader==null&&(this._equirectShader=x2());let i=e.isCubeTexture?this._cubemapShader:this._equirectShader,r=new et(Df[0],i),s=i.uniforms;s.envMap.value=e,e.isCubeTexture||s.texelSize.value.set(1/e.image.width,1/e.image.height),s.inputEncoding.value=Ss[e.encoding],s.outputEncoding.value=Ss[t.texture.encoding],wy(t,0,0,3*Ms,2*Ms),n.setRenderTarget(t),n.render(r,zw)}_applyPMREM(e){let t=this._renderer,n=t.autoClear;t.autoClear=!1;for(let i=1;i<d2;i++){let r=Math.sqrt(_y[i]*_y[i]-_y[i-1]*_y[i-1]),s=m2[(i-1)%m2.length];this._blur(e,i-1,i,r,s)}t.autoClear=n}_blur(e,t,n,i,r){let s=this._pingPongRenderTarget;this._halfBlur(e,s,t,n,i,"latitudinal",r),this._halfBlur(s,e,n,n,i,"longitudinal",r)}_halfBlur(e,t,n,i,r,s,a){let l=this._renderer,c=this._blurMaterial;s!=="latitudinal"&&s!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");let u=3,d=new et(Df[i],c),h=c.uniforms,f=f2[n]-1,p=isFinite(r)?Math.PI/(2*f):2*Math.PI/(2*ku-1),g=r/p,v=isFinite(r)?1+Math.floor(u*g):ku;v>ku&&console.warn(`sigmaRadians, ${r}, is too large and will clip, as it requested ${v} samples when the maximum is set to ${ku}`);let y=[],m=0;for(let b=0;b<ku;++b){let M=b/g,S=Math.exp(-M*M/2);y.push(S),b==0?m+=S:b<v&&(m+=2*S)}for(let b=0;b<y.length;b++)y[b]=y[b]/m;h.envMap.value=e.texture,h.samples.value=v,h.weights.value=y,h.latitudinal.value=s==="latitudinal",a&&(h.poleAxis.value=a),h.dTheta.value=p,h.mipInt.value=va-n,h.inputEncoding.value=Ss[e.texture.encoding],h.outputEncoding.value=Ss[e.texture.encoding];let x=f2[i],_=3*Math.max(0,Ms-2*x),w=(i===0?0:2*Ms)+2*x*(i>va-Ou?i-va+Ou:0);wy(t,_,w,3*x,2*x),l.setRenderTarget(t),l.render(d,zw)}};function dG(o){return o===void 0||o.type!==bl?!1:o.encoding===Xn||o.encoding===Vi||o.encoding===$m}function fG(){let o=[],e=[],t=[],n=va;for(let i=0;i<d2;i++){let r=Math.pow(2,n);e.push(r);let s=1/r;i>va-Ou?s=h2[i-va+Ou-1]:i==0&&(s=0),t.push(s);let a=1/(r-1),l=-a/2,c=1+a/2,u=[l,l,c,l,c,c,l,l,c,c,l,c],d=6,h=6,f=3,p=2,g=1,v=new Float32Array(f*h*d),y=new Float32Array(p*h*d),m=new Float32Array(g*h*d);for(let _=0;_<d;_++){let w=_%3*2/3-1,b=_>2?0:-1,M=[w,b,0,w+2/3,b,0,w+2/3,b+1,0,w,b,0,w+2/3,b+1,0,w,b+1,0];v.set(M,f*h*_),y.set(u,p*h*_);let S=[_,_,_,_,_,_];m.set(S,g*h*_)}let x=new Ue;x.setAttribute("position",new Ye(v,f)),x.setAttribute("uv",new Ye(y,p)),x.setAttribute("faceIndex",new Ye(m,g)),o.push(x),n>Ou&&n--}return{_lodPlanes:o,_sizeLods:e,_sigmas:t}}function v2(o){let e=new Yn(3*Ms,3*Ms,o);return e.texture.mapping=Vc,e.texture.name="PMREM.cubeUv",e.scissorTest=!0,e}function wy(o,e,t,n,i){o.viewport.set(e,t,n,i),o.scissor.set(e,t,n,i)}function pG(o){let e=new Float32Array(o),t=new U(0,1,0);return new Nl({name:"SphericalGaussianBlur",defines:{n:o},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:e},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:t},inputEncoding:{value:Ss[Xn]},outputEncoding:{value:Ss[Xn]}},vertexShader:Hw(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			${Gw()}

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

				gl_FragColor = linearToOutputTexel( gl_FragColor );

			}
		`,blending:Ks,depthTest:!1,depthWrite:!1})}function x2(){let o=new _e(1,1);return new Nl({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null},texelSize:{value:o},inputEncoding:{value:Ss[Xn]},outputEncoding:{value:Ss[Xn]}},vertexShader:Hw(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform vec2 texelSize;

			${Gw()}

			#include <common>

			void main() {

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				vec2 f = fract( uv / texelSize - 0.5 );
				uv -= f * texelSize;
				vec3 tl = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;
				uv.x += texelSize.x;
				vec3 tr = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;
				uv.y += texelSize.y;
				vec3 br = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;
				uv.x -= texelSize.x;
				vec3 bl = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;

				vec3 tm = mix( tl, tr, f.x );
				vec3 bm = mix( bl, br, f.x );
				gl_FragColor.rgb = mix( tm, bm, f.y );

				gl_FragColor = linearToOutputTexel( gl_FragColor );

			}
		`,blending:Ks,depthTest:!1,depthWrite:!1})}function _2(){return new Nl({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},inputEncoding:{value:Ss[Xn]},outputEncoding:{value:Ss[Xn]}},vertexShader:Hw(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			${Gw()}

			void main() {

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb = envMapTexelToLinear( textureCube( envMap, vec3( - vOutputDirection.x, vOutputDirection.yz ) ) ).rgb;
				gl_FragColor = linearToOutputTexel( gl_FragColor );

			}
		`,blending:Ks,depthTest:!1,depthWrite:!1})}function Hw(){return`

		precision mediump float;
		precision mediump int;

		attribute vec3 position;
		attribute vec2 uv;
		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`}function Gw(){return`

		uniform int inputEncoding;
		uniform int outputEncoding;

		#include <encodings_pars_fragment>

		vec4 inputTexelToLinear( vec4 value ) {

			if ( inputEncoding == 0 ) {

				return value;

			} else if ( inputEncoding == 1 ) {

				return sRGBToLinear( value );

			} else if ( inputEncoding == 2 ) {

				return RGBEToLinear( value );

			} else if ( inputEncoding == 3 ) {

				return RGBMToLinear( value, 7.0 );

			} else if ( inputEncoding == 4 ) {

				return RGBMToLinear( value, 16.0 );

			} else if ( inputEncoding == 5 ) {

				return RGBDToLinear( value, 256.0 );

			} else {

				return GammaToLinear( value, 2.2 );

			}

		}

		vec4 linearToOutputTexel( vec4 value ) {

			if ( outputEncoding == 0 ) {

				return value;

			} else if ( outputEncoding == 1 ) {

				return LinearTosRGB( value );

			} else if ( outputEncoding == 2 ) {

				return LinearToRGBE( value );

			} else if ( outputEncoding == 3 ) {

				return LinearToRGBM( value, 7.0 );

			} else if ( outputEncoding == 4 ) {

				return LinearToRGBM( value, 16.0 );

			} else if ( outputEncoding == 5 ) {

				return LinearToRGBD( value, 256.0 );

			} else {

				return LinearToGamma( value, 2.2 );

			}

		}

		vec4 envMapTexelToLinear( vec4 color ) {

			return inputTexelToLinear( color );

		}
	`}var mG=0,gG=1,yG=0,vG=1,xG=2;function _G(o){return console.warn("THREE.MeshFaceMaterial has been removed. Use an Array instead."),o}function wG(o=[]){return console.warn("THREE.MultiMaterial has been removed. Use an Array instead."),o.isMultiMaterial=!0,o.materials=o,o.clone=function(){return o.slice()},o}function bG(o,e){return console.warn("THREE.PointCloud has been renamed to THREE.Points."),new la(o,e)}function MG(o){return console.warn("THREE.Particle has been renamed to THREE.Sprite."),new vf(o)}function SG(o,e){return console.warn("THREE.ParticleSystem has been renamed to THREE.Points."),new la(o,e)}function TG(o){return console.warn("THREE.PointCloudMaterial has been renamed to THREE.PointsMaterial."),new ps(o)}function EG(o){return console.warn("THREE.ParticleBasicMaterial has been renamed to THREE.PointsMaterial."),new ps(o)}function AG(o){return console.warn("THREE.ParticleSystemMaterial has been renamed to THREE.PointsMaterial."),new ps(o)}function CG(o,e,t){return console.warn("THREE.Vertex has been removed. Use THREE.Vector3 instead."),new U(o,e,t)}function LG(o,e){return console.warn("THREE.DynamicBufferAttribute has been removed. Use new THREE.BufferAttribute().setUsage( THREE.DynamicDrawUsage ) instead."),new Ye(o,e).setUsage(Yc)}function RG(o,e){return console.warn("THREE.Int8Attribute has been removed. Use new THREE.Int8BufferAttribute() instead."),new L_(o,e)}function PG(o,e){return console.warn("THREE.Uint8Attribute has been removed. Use new THREE.Uint8BufferAttribute() instead."),new R_(o,e)}function IG(o,e){return console.warn("THREE.Uint8ClampedAttribute has been removed. Use new THREE.Uint8ClampedBufferAttribute() instead."),new P_(o,e)}function DG(o,e){return console.warn("THREE.Int16Attribute has been removed. Use new THREE.Int16BufferAttribute() instead."),new I_(o,e)}function FG(o,e){return console.warn("THREE.Uint16Attribute has been removed. Use new THREE.Uint16BufferAttribute() instead."),new Pl(o,e)}function BG(o,e){return console.warn("THREE.Int32Attribute has been removed. Use new THREE.Int32BufferAttribute() instead."),new D_(o,e)}function NG(o,e){return console.warn("THREE.Uint32Attribute has been removed. Use new THREE.Uint32BufferAttribute() instead."),new of(o,e)}function OG(o,e){return console.warn("THREE.Float32Attribute has been removed. Use new THREE.Float32BufferAttribute() instead."),new Ne(o,e)}function kG(o,e){return console.warn("THREE.Float64Attribute has been removed. Use new THREE.Float64BufferAttribute() instead."),new B_(o,e)}li.create=function(o,e){return console.log("THREE.Curve.create() has been deprecated"),o.prototype=Object.create(li.prototype),o.prototype.constructor=o,o.prototype.getPoint=e,o};_s.prototype.fromPoints=function(o){return console.warn("THREE.Path: .fromPoints() has been renamed to .setFromPoints()."),this.setFromPoints(o)};function zG(o){return console.warn("THREE.AxisHelper has been renamed to THREE.AxesHelper."),new kw(o)}function UG(o,e){return console.warn("THREE.BoundingBoxHelper has been deprecated. Creating a THREE.BoxHelper instead."),new Nw(o,e)}function HG(o,e){return console.warn("THREE.EdgesHelper has been removed. Use THREE.EdgesGeometry instead."),new An(new kg(o.geometry),new zt({color:e!==void 0?e:16777215}))}Bw.prototype.setColors=function(){console.error("THREE.GridHelper: setColors() has been deprecated, pass them in the constructor instead.")};Fw.prototype.update=function(){console.error("THREE.SkeletonHelper: update() no longer needs to be called.")};function GG(o,e){return console.warn("THREE.WireframeHelper has been removed. Use THREE.WireframeGeometry instead."),new An(new Zg(o.geometry),new zt({color:e!==void 0?e:16777215}))}tn.prototype.extractUrlBase=function(o){return console.warn("THREE.Loader: .extractUrlBase() has been deprecated. Use THREE.LoaderUtils.extractUrlBase() instead."),Mi.extractUrlBase(o)};tn.Handlers={add:function(){console.error("THREE.Loader: Handlers.add() has been removed. Use LoadingManager.addHandler() instead.")},get:function(){console.error("THREE.Loader: Handlers.get() has been removed. Use LoadingManager.getHandler() instead.")}};function VG(o){return console.warn("THREE.XHRLoader has been renamed to THREE.FileLoader."),new mn(o)}function WG(o){return console.warn("THREE.BinaryTextureLoader has been renamed to THREE.DataTextureLoader."),new dw(o)}ho.prototype.center=function(o){return console.warn("THREE.Box2: .center() has been renamed to .getCenter()."),this.getCenter(o)};ho.prototype.empty=function(){return console.warn("THREE.Box2: .empty() has been renamed to .isEmpty()."),this.isEmpty()};ho.prototype.isIntersectionBox=function(o){return console.warn("THREE.Box2: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(o)};ho.prototype.size=function(o){return console.warn("THREE.Box2: .size() has been renamed to .getSize()."),this.getSize(o)};Sn.prototype.center=function(o){return console.warn("THREE.Box3: .center() has been renamed to .getCenter()."),this.getCenter(o)};Sn.prototype.empty=function(){return console.warn("THREE.Box3: .empty() has been renamed to .isEmpty()."),this.isEmpty()};Sn.prototype.isIntersectionBox=function(o){return console.warn("THREE.Box3: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(o)};Sn.prototype.isIntersectionSphere=function(o){return console.warn("THREE.Box3: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(o)};Sn.prototype.size=function(o){return console.warn("THREE.Box3: .size() has been renamed to .getSize()."),this.getSize(o)};qi.prototype.empty=function(){return console.warn("THREE.Sphere: .empty() has been renamed to .isEmpty()."),this.isEmpty()};hu.prototype.setFromMatrix=function(o){return console.warn("THREE.Frustum: .setFromMatrix() has been renamed to .setFromProjectionMatrix()."),this.setFromProjectionMatrix(o)};Gl.prototype.center=function(o){return console.warn("THREE.Line3: .center() has been renamed to .getCenter()."),this.getCenter(o)};vt.prototype.flattenToArrayOffset=function(o,e){return console.warn("THREE.Matrix3: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(o,e)};vt.prototype.multiplyVector3=function(o){return console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),o.applyMatrix3(this)};vt.prototype.multiplyVector3Array=function(){console.error("THREE.Matrix3: .multiplyVector3Array() has been removed.")};vt.prototype.applyToBufferAttribute=function(o){return console.warn("THREE.Matrix3: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix3( matrix ) instead."),o.applyMatrix3(this)};vt.prototype.applyToVector3Array=function(){console.error("THREE.Matrix3: .applyToVector3Array() has been removed.")};vt.prototype.getInverse=function(o){return console.warn("THREE.Matrix3: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead."),this.copy(o).invert()};Pe.prototype.extractPosition=function(o){return console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(o)};Pe.prototype.flattenToArrayOffset=function(o,e){return console.warn("THREE.Matrix4: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(o,e)};Pe.prototype.getPosition=function(){return console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead."),new U().setFromMatrixColumn(this,3)};Pe.prototype.setRotationFromQuaternion=function(o){return console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion()."),this.makeRotationFromQuaternion(o)};Pe.prototype.multiplyToArray=function(){console.warn("THREE.Matrix4: .multiplyToArray() has been removed.")};Pe.prototype.multiplyVector3=function(o){return console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) instead."),o.applyMatrix4(this)};Pe.prototype.multiplyVector4=function(o){return console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),o.applyMatrix4(this)};Pe.prototype.multiplyVector3Array=function(){console.error("THREE.Matrix4: .multiplyVector3Array() has been removed.")};Pe.prototype.rotateAxis=function(o){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),o.transformDirection(this)};Pe.prototype.crossVector=function(o){return console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),o.applyMatrix4(this)};Pe.prototype.translate=function(){console.error("THREE.Matrix4: .translate() has been removed.")};Pe.prototype.rotateX=function(){console.error("THREE.Matrix4: .rotateX() has been removed.")};Pe.prototype.rotateY=function(){console.error("THREE.Matrix4: .rotateY() has been removed.")};Pe.prototype.rotateZ=function(){console.error("THREE.Matrix4: .rotateZ() has been removed.")};Pe.prototype.rotateByAxis=function(){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")};Pe.prototype.applyToBufferAttribute=function(o){return console.warn("THREE.Matrix4: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix4( matrix ) instead."),o.applyMatrix4(this)};Pe.prototype.applyToVector3Array=function(){console.error("THREE.Matrix4: .applyToVector3Array() has been removed.")};Pe.prototype.makeFrustum=function(o,e,t,n,i,r){return console.warn("THREE.Matrix4: .makeFrustum() has been removed. Use .makePerspective( left, right, top, bottom, near, far ) instead."),this.makePerspective(o,e,n,t,i,r)};Pe.prototype.getInverse=function(o){return console.warn("THREE.Matrix4: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead."),this.copy(o).invert()};hn.prototype.isIntersectionLine=function(o){return console.warn("THREE.Plane: .isIntersectionLine() has been renamed to .intersectsLine()."),this.intersectsLine(o)};gt.prototype.multiplyVector3=function(o){return console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),o.applyQuaternion(this)};gt.prototype.inverse=function(){return console.warn("THREE.Quaternion: .inverse() has been renamed to invert()."),this.invert()};io.prototype.isIntersectionBox=function(o){return console.warn("THREE.Ray: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(o)};io.prototype.isIntersectionPlane=function(o){return console.warn("THREE.Ray: .isIntersectionPlane() has been renamed to .intersectsPlane()."),this.intersectsPlane(o)};io.prototype.isIntersectionSphere=function(o){return console.warn("THREE.Ray: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(o)};Zt.prototype.area=function(){return console.warn("THREE.Triangle: .area() has been renamed to .getArea()."),this.getArea()};Zt.prototype.barycoordFromPoint=function(o,e){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),this.getBarycoord(o,e)};Zt.prototype.midpoint=function(o){return console.warn("THREE.Triangle: .midpoint() has been renamed to .getMidpoint()."),this.getMidpoint(o)};Zt.prototypenormal=function(o){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),this.getNormal(o)};Zt.prototype.plane=function(o){return console.warn("THREE.Triangle: .plane() has been renamed to .getPlane()."),this.getPlane(o)};Zt.barycoordFromPoint=function(o,e,t,n,i){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),Zt.getBarycoord(o,e,t,n,i)};Zt.normal=function(o,e,t,n){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),Zt.getNormal(o,e,t,n)};Wr.prototype.extractAllPoints=function(o){return console.warn("THREE.Shape: .extractAllPoints() has been removed. Use .extractPoints() instead."),this.extractPoints(o)};Wr.prototype.extrude=function(o){return console.warn("THREE.Shape: .extrude() has been removed. Use ExtrudeGeometry() instead."),new zr(this,o)};Wr.prototype.makeGeometry=function(o){return console.warn("THREE.Shape: .makeGeometry() has been removed. Use ShapeGeometry() instead."),new Bl(this,o)};_e.prototype.fromAttribute=function(o,e,t){return console.warn("THREE.Vector2: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(o,e,t)};_e.prototype.distanceToManhattan=function(o){return console.warn("THREE.Vector2: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(o)};_e.prototype.lengthManhattan=function(){return console.warn("THREE.Vector2: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()};U.prototype.setEulerFromRotationMatrix=function(){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")};U.prototype.setEulerFromQuaternion=function(){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")};U.prototype.getPositionFromMatrix=function(o){return console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(o)};U.prototype.getScaleFromMatrix=function(o){return console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(o)};U.prototype.getColumnFromMatrix=function(o,e){return console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(e,o)};U.prototype.applyProjection=function(o){return console.warn("THREE.Vector3: .applyProjection() has been removed. Use .applyMatrix4( m ) instead."),this.applyMatrix4(o)};U.prototype.fromAttribute=function(o,e,t){return console.warn("THREE.Vector3: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(o,e,t)};U.prototype.distanceToManhattan=function(o){return console.warn("THREE.Vector3: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(o)};U.prototype.lengthManhattan=function(){return console.warn("THREE.Vector3: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()};tt.prototype.fromAttribute=function(o,e,t){return console.warn("THREE.Vector4: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(o,e,t)};tt.prototype.lengthManhattan=function(){return console.warn("THREE.Vector4: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()};$e.prototype.getChildByName=function(o){return console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(o)};$e.prototype.renderDepth=function(){console.warn("THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")};$e.prototype.translate=function(o,e){return console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead."),this.translateOnAxis(e,o)};$e.prototype.getWorldRotation=function(){console.error("THREE.Object3D: .getWorldRotation() has been removed. Use THREE.Object3D.getWorldQuaternion( target ) instead.")};$e.prototype.applyMatrix=function(o){return console.warn("THREE.Object3D: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(o)};Object.defineProperties($e.prototype,{eulerOrder:{get:function(){return console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order},set:function(o){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order=o}},useQuaternion:{get:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")}}});et.prototype.setDrawMode=function(){console.error("THREE.Mesh: .setDrawMode() has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")};Object.defineProperties(et.prototype,{drawMode:{get:function(){return console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode."),oA},set:function(){console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")}}});lo.prototype.initBones=function(){console.error("THREE.SkinnedMesh: initBones() has been removed.")};It.prototype.setLens=function(o,e){console.warn("THREE.PerspectiveCamera.setLens is deprecated. Use .setFocalLength and .filmGauge for a photographic setup."),e!==void 0&&(this.filmGauge=e),this.setFocalLength(o)};Object.defineProperties(fr.prototype,{onlyShadow:{set:function(){console.warn("THREE.Light: .onlyShadow has been removed.")}},shadowCameraFov:{set:function(o){console.warn("THREE.Light: .shadowCameraFov is now .shadow.camera.fov."),this.shadow.camera.fov=o}},shadowCameraLeft:{set:function(o){console.warn("THREE.Light: .shadowCameraLeft is now .shadow.camera.left."),this.shadow.camera.left=o}},shadowCameraRight:{set:function(o){console.warn("THREE.Light: .shadowCameraRight is now .shadow.camera.right."),this.shadow.camera.right=o}},shadowCameraTop:{set:function(o){console.warn("THREE.Light: .shadowCameraTop is now .shadow.camera.top."),this.shadow.camera.top=o}},shadowCameraBottom:{set:function(o){console.warn("THREE.Light: .shadowCameraBottom is now .shadow.camera.bottom."),this.shadow.camera.bottom=o}},shadowCameraNear:{set:function(o){console.warn("THREE.Light: .shadowCameraNear is now .shadow.camera.near."),this.shadow.camera.near=o}},shadowCameraFar:{set:function(o){console.warn("THREE.Light: .shadowCameraFar is now .shadow.camera.far."),this.shadow.camera.far=o}},shadowCameraVisible:{set:function(){console.warn("THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow.camera ) instead.")}},shadowBias:{set:function(o){console.warn("THREE.Light: .shadowBias is now .shadow.bias."),this.shadow.bias=o}},shadowDarkness:{set:function(){console.warn("THREE.Light: .shadowDarkness has been removed.")}},shadowMapWidth:{set:function(o){console.warn("THREE.Light: .shadowMapWidth is now .shadow.mapSize.width."),this.shadow.mapSize.width=o}},shadowMapHeight:{set:function(o){console.warn("THREE.Light: .shadowMapHeight is now .shadow.mapSize.height."),this.shadow.mapSize.height=o}}});Object.defineProperties(Ye.prototype,{length:{get:function(){return console.warn("THREE.BufferAttribute: .length has been deprecated. Use .count instead."),this.array.length}},dynamic:{get:function(){return console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.usage===Yc},set:function(){console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.setUsage(Yc)}}});Ye.prototype.setDynamic=function(o){return console.warn("THREE.BufferAttribute: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(o===!0?Yc:eo),this};Ye.prototype.copyIndicesArray=function(){console.error("THREE.BufferAttribute: .copyIndicesArray() has been removed.")},Ye.prototype.setArray=function(){console.error("THREE.BufferAttribute: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")};Ue.prototype.addIndex=function(o){console.warn("THREE.BufferGeometry: .addIndex() has been renamed to .setIndex()."),this.setIndex(o)};Ue.prototype.addAttribute=function(o,e){return console.warn("THREE.BufferGeometry: .addAttribute() has been renamed to .setAttribute()."),!(e&&e.isBufferAttribute)&&!(e&&e.isInterleavedBufferAttribute)?(console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),this.setAttribute(o,new Ye(arguments[1],arguments[2]))):o==="index"?(console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute."),this.setIndex(e),this):this.setAttribute(o,e)};Ue.prototype.addDrawCall=function(o,e,t){t!==void 0&&console.warn("THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset."),console.warn("THREE.BufferGeometry: .addDrawCall() is now .addGroup()."),this.addGroup(o,e)};Ue.prototype.clearDrawCalls=function(){console.warn("THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups()."),this.clearGroups()};Ue.prototype.computeOffsets=function(){console.warn("THREE.BufferGeometry: .computeOffsets() has been removed.")};Ue.prototype.removeAttribute=function(o){return console.warn("THREE.BufferGeometry: .removeAttribute() has been renamed to .deleteAttribute()."),this.deleteAttribute(o)};Ue.prototype.applyMatrix=function(o){return console.warn("THREE.BufferGeometry: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(o)};Object.defineProperties(Ue.prototype,{drawcalls:{get:function(){return console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups."),this.groups}},offsets:{get:function(){return console.warn("THREE.BufferGeometry: .offsets has been renamed to .groups."),this.groups}}});ds.prototype.setDynamic=function(o){return console.warn("THREE.InterleavedBuffer: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(o===!0?Yc:eo),this};ds.prototype.setArray=function(){console.error("THREE.InterleavedBuffer: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")};zr.prototype.getArrays=function(){console.error("THREE.ExtrudeGeometry: .getArrays() has been removed.")};zr.prototype.addShapeList=function(){console.error("THREE.ExtrudeGeometry: .addShapeList() has been removed.")};zr.prototype.addShape=function(){console.error("THREE.ExtrudeGeometry: .addShape() has been removed.")};Dl.prototype.dispose=function(){console.error("THREE.Scene: .dispose() has been removed.")};Pf.prototype.onUpdate=function(){return console.warn("THREE.Uniform: .onUpdate() has been removed. Use object.onBeforeRender() instead."),this};Object.defineProperties(un.prototype,{wrapAround:{get:function(){console.warn("THREE.Material: .wrapAround has been removed.")},set:function(){console.warn("THREE.Material: .wrapAround has been removed.")}},overdraw:{get:function(){console.warn("THREE.Material: .overdraw has been removed.")},set:function(){console.warn("THREE.Material: .overdraw has been removed.")}},wrapRGB:{get:function(){return console.warn("THREE.Material: .wrapRGB has been removed."),new De}},shading:{get:function(){console.error("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead.")},set:function(o){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=o===Ux}},stencilMask:{get:function(){return console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask},set:function(o){console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask=o}}});Object.defineProperties(Fn.prototype,{derivatives:{get:function(){return console.warn("THREE.ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives},set:function(o){console.warn("THREE. ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives=o}}});Rt.prototype.clearTarget=function(o,e,t,n){console.warn("THREE.WebGLRenderer: .clearTarget() has been deprecated. Use .setRenderTarget() and .clear() instead."),this.setRenderTarget(o),this.clear(e,t,n)};Rt.prototype.animate=function(o){console.warn("THREE.WebGLRenderer: .animate() is now .setAnimationLoop()."),this.setAnimationLoop(o)};Rt.prototype.getCurrentRenderTarget=function(){return console.warn("THREE.WebGLRenderer: .getCurrentRenderTarget() is now .getRenderTarget()."),this.getRenderTarget()};Rt.prototype.getMaxAnisotropy=function(){return console.warn("THREE.WebGLRenderer: .getMaxAnisotropy() is now .capabilities.getMaxAnisotropy()."),this.capabilities.getMaxAnisotropy()};Rt.prototype.getPrecision=function(){return console.warn("THREE.WebGLRenderer: .getPrecision() is now .capabilities.precision."),this.capabilities.precision};Rt.prototype.resetGLState=function(){return console.warn("THREE.WebGLRenderer: .resetGLState() is now .state.reset()."),this.state.reset()};Rt.prototype.supportsFloatTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' )."),this.extensions.get("OES_texture_float")};Rt.prototype.supportsHalfFloatTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' )."),this.extensions.get("OES_texture_half_float")};Rt.prototype.supportsStandardDerivatives=function(){return console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' )."),this.extensions.get("OES_standard_derivatives")};Rt.prototype.supportsCompressedTextureS3TC=function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' )."),this.extensions.get("WEBGL_compressed_texture_s3tc")};Rt.prototype.supportsCompressedTexturePVRTC=function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' )."),this.extensions.get("WEBGL_compressed_texture_pvrtc")};Rt.prototype.supportsBlendMinMax=function(){return console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' )."),this.extensions.get("EXT_blend_minmax")};Rt.prototype.supportsVertexTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsVertexTextures() is now .capabilities.vertexTextures."),this.capabilities.vertexTextures};Rt.prototype.supportsInstancedArrays=function(){return console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' )."),this.extensions.get("ANGLE_instanced_arrays")};Rt.prototype.enableScissorTest=function(o){console.warn("THREE.WebGLRenderer: .enableScissorTest() is now .setScissorTest()."),this.setScissorTest(o)};Rt.prototype.initMaterial=function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")};Rt.prototype.addPrePlugin=function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")};Rt.prototype.addPostPlugin=function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")};Rt.prototype.updateShadowMap=function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")};Rt.prototype.setFaceCulling=function(){console.warn("THREE.WebGLRenderer: .setFaceCulling() has been removed.")};Rt.prototype.allocTextureUnit=function(){console.warn("THREE.WebGLRenderer: .allocTextureUnit() has been removed.")};Rt.prototype.setTexture=function(){console.warn("THREE.WebGLRenderer: .setTexture() has been removed.")};Rt.prototype.setTexture2D=function(){console.warn("THREE.WebGLRenderer: .setTexture2D() has been removed.")};Rt.prototype.setTextureCube=function(){console.warn("THREE.WebGLRenderer: .setTextureCube() has been removed.")};Rt.prototype.getActiveMipMapLevel=function(){return console.warn("THREE.WebGLRenderer: .getActiveMipMapLevel() is now .getActiveMipmapLevel()."),this.getActiveMipmapLevel()};Object.defineProperties(Rt.prototype,{shadowMapEnabled:{get:function(){return this.shadowMap.enabled},set:function(o){console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled."),this.shadowMap.enabled=o}},shadowMapType:{get:function(){return this.shadowMap.type},set:function(o){console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type."),this.shadowMap.type=o}},shadowMapCullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")}},context:{get:function(){return console.warn("THREE.WebGLRenderer: .context has been removed. Use .getContext() instead."),this.getContext()}},vr:{get:function(){return console.warn("THREE.WebGLRenderer: .vr has been renamed to .xr"),this.xr}},gammaInput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead."),!1},set:function(){console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead.")}},gammaOutput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),!1},set:function(o){console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),this.outputEncoding=o===!0?Vi:Xn}},toneMappingWhitePoint:{get:function(){return console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed."),1},set:function(){console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed.")}}});Object.defineProperties(JA.prototype,{cullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")}},renderReverseSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")}},renderSingleSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")}}});function XG(o,e,t){return console.warn("THREE.WebGLRenderTargetCube( width, height, options ) is now WebGLCubeRenderTarget( size, options )."),new cf(o,t)}Object.defineProperties(Yn.prototype,{wrapS:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS},set:function(o){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS=o}},wrapT:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT},set:function(o){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT=o}},magFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter},set:function(o){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter=o}},minFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter},set:function(o){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter=o}},anisotropy:{get:function(){return console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy},set:function(o){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy=o}},offset:{get:function(){return console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset},set:function(o){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset=o}},repeat:{get:function(){return console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat},set:function(o){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat=o}},format:{get:function(){return console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format},set:function(o){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format=o}},type:{get:function(){return console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type},set:function(o){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type=o}},generateMipmaps:{get:function(){return console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps},set:function(o){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps=o}}});hy.prototype.load=function(o){console.warn("THREE.Audio: .load has been deprecated. Use THREE.AudioLoader instead.");let e=this;return new ww().load(o,function(n){e.setBuffer(n)}),this};Sw.prototype.getData=function(){return console.warn("THREE.AudioAnalyser: .getData() is now .getFrequencyData()."),this.getFrequencyData()};lf.prototype.updateCubeMap=function(o,e){return console.warn("THREE.CubeCamera: .updateCubeMap() is now .update()."),this.update(o,e)};lf.prototype.clear=function(o,e,t,n){return console.warn("THREE.CubeCamera: .clear() is now .renderTarget.clear()."),this.renderTarget.clear(o,e,t,n)};Ko.crossOrigin=void 0;Ko.loadTexture=function(o,e,t,n){console.warn("THREE.ImageUtils.loadTexture has been deprecated. Use THREE.TextureLoader() instead.");let i=new Vr;i.setCrossOrigin(this.crossOrigin);let r=i.load(o,t,void 0,n);return e&&(r.mapping=e),r};Ko.loadTextureCube=function(o,e,t,n){console.warn("THREE.ImageUtils.loadTextureCube has been deprecated. Use THREE.CubeTextureLoader() instead.");let i=new hw;i.setCrossOrigin(this.crossOrigin);let r=i.load(o,t,void 0,n);return e&&(r.mapping=e),r};Ko.loadCompressedTexture=function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")};Ko.loadCompressedTextureCube=function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")};function qG(){console.error("THREE.CanvasRenderer has been removed")}function jG(){console.error("THREE.JSONLoader has been removed.")}var YG={createMultiMaterialObject:function(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")},detach:function(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")},attach:function(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")}};function ZG(){console.error("THREE.LensFlare has been moved to /examples/jsm/objects/Lensflare.js")}typeof __THREE_DEVTOOLS__!="undefined"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:Zs}}));typeof window!="undefined"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=Zs);var Ts=new Pe,Vw=new $e,by=new U,pr=class extends Wi{constructor(){super();this.uuid=cn.generateUUID(),this.name="",this.type="Geometry",this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.elementsNeedUpdate=!1,this.verticesNeedUpdate=!1,this.uvsNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.lineDistancesNeedUpdate=!1,this.groupsNeedUpdate=!1}applyMatrix4(e){let t=new vt().getNormalMatrix(e);for(let n=0,i=this.vertices.length;n<i;n++)this.vertices[n].applyMatrix4(e);for(let n=0,i=this.faces.length;n<i;n++){let r=this.faces[n];r.normal.applyMatrix3(t).normalize();for(let s=0,a=r.vertexNormals.length;s<a;s++)r.vertexNormals[s].applyMatrix3(t).normalize()}return this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this.verticesNeedUpdate=!0,this.normalsNeedUpdate=!0,this}rotateX(e){return Ts.makeRotationX(e),this.applyMatrix4(Ts),this}rotateY(e){return Ts.makeRotationY(e),this.applyMatrix4(Ts),this}rotateZ(e){return Ts.makeRotationZ(e),this.applyMatrix4(Ts),this}translate(e,t,n){return Ts.makeTranslation(e,t,n),this.applyMatrix4(Ts),this}scale(e,t,n){return Ts.makeScale(e,t,n),this.applyMatrix4(Ts),this}lookAt(e){return Vw.lookAt(e),Vw.updateMatrix(),this.applyMatrix4(Vw.matrix),this}fromBufferGeometry(e){let t=this,n=e.index!==null?e.index:void 0,i=e.attributes;if(i.position===void 0)return console.error("THREE.Geometry.fromBufferGeometry(): Position attribute required for conversion."),this;let r=i.position,s=i.normal,a=i.color,l=i.uv,c=i.uv2;c!==void 0&&(this.faceVertexUvs[1]=[]);for(let h=0;h<r.count;h++)t.vertices.push(new U().fromBufferAttribute(r,h)),a!==void 0&&t.colors.push(new De().fromBufferAttribute(a,h));function u(h,f,p,g){let v=a===void 0?[]:[t.colors[h].clone(),t.colors[f].clone(),t.colors[p].clone()],y=s===void 0?[]:[new U().fromBufferAttribute(s,h),new U().fromBufferAttribute(s,f),new U().fromBufferAttribute(s,p)],m=new Ww(h,f,p,y,v,g);t.faces.push(m),l!==void 0&&t.faceVertexUvs[0].push([new _e().fromBufferAttribute(l,h),new _e().fromBufferAttribute(l,f),new _e().fromBufferAttribute(l,p)]),c!==void 0&&t.faceVertexUvs[1].push([new _e().fromBufferAttribute(c,h),new _e().fromBufferAttribute(c,f),new _e().fromBufferAttribute(c,p)])}let d=e.groups;if(d.length>0)for(let h=0;h<d.length;h++){let f=d[h],p=f.start,g=f.count;for(let v=p,y=p+g;v<y;v+=3)n!==void 0?u(n.getX(v),n.getX(v+1),n.getX(v+2),f.materialIndex):u(v,v+1,v+2,f.materialIndex)}else if(n!==void 0)for(let h=0;h<n.count;h+=3)u(n.getX(h),n.getX(h+1),n.getX(h+2));else for(let h=0;h<r.count;h+=3)u(h,h+1,h+2);return this.computeFaceNormals(),e.boundingBox!==null&&(this.boundingBox=e.boundingBox.clone()),e.boundingSphere!==null&&(this.boundingSphere=e.boundingSphere.clone()),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(by).negate(),this.translate(by.x,by.y,by.z),this}normalize(){this.computeBoundingSphere();let e=this.boundingSphere.center,t=this.boundingSphere.radius,n=t===0?1:1/t,i=new Pe;return i.set(n,0,0,-n*e.x,0,n,0,-n*e.y,0,0,n,-n*e.z,0,0,0,1),this.applyMatrix4(i),this}computeFaceNormals(){let e=new U,t=new U;for(let n=0,i=this.faces.length;n<i;n++){let r=this.faces[n],s=this.vertices[r.a],a=this.vertices[r.b],l=this.vertices[r.c];e.subVectors(l,a),t.subVectors(s,a),e.cross(t),e.normalize(),r.normal.copy(e)}}computeVertexNormals(e=!0){let t=new Array(this.vertices.length);for(let n=0,i=this.vertices.length;n<i;n++)t[n]=new U;if(e){let n=new U,i=new U;for(let r=0,s=this.faces.length;r<s;r++){let a=this.faces[r],l=this.vertices[a.a],c=this.vertices[a.b],u=this.vertices[a.c];n.subVectors(u,c),i.subVectors(l,c),n.cross(i),t[a.a].add(n),t[a.b].add(n),t[a.c].add(n)}}else{this.computeFaceNormals();for(let n=0,i=this.faces.length;n<i;n++){let r=this.faces[n];t[r.a].add(r.normal),t[r.b].add(r.normal),t[r.c].add(r.normal)}}for(let n=0,i=this.vertices.length;n<i;n++)t[n].normalize();for(let n=0,i=this.faces.length;n<i;n++){let r=this.faces[n],s=r.vertexNormals;s.length===3?(s[0].copy(t[r.a]),s[1].copy(t[r.b]),s[2].copy(t[r.c])):(s[0]=t[r.a].clone(),s[1]=t[r.b].clone(),s[2]=t[r.c].clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)}computeFlatVertexNormals(){this.computeFaceNormals();for(let e=0,t=this.faces.length;e<t;e++){let n=this.faces[e],i=n.vertexNormals;i.length===3?(i[0].copy(n.normal),i[1].copy(n.normal),i[2].copy(n.normal)):(i[0]=n.normal.clone(),i[1]=n.normal.clone(),i[2]=n.normal.clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)}computeMorphNormals(){for(let t=0,n=this.faces.length;t<n;t++){let i=this.faces[t];i.__originalFaceNormal?i.__originalFaceNormal.copy(i.normal):i.__originalFaceNormal=i.normal.clone(),i.__originalVertexNormals||(i.__originalVertexNormals=[]);for(let r=0,s=i.vertexNormals.length;r<s;r++)i.__originalVertexNormals[r]?i.__originalVertexNormals[r].copy(i.vertexNormals[r]):i.__originalVertexNormals[r]=i.vertexNormals[r].clone()}let e=new pr;e.faces=this.faces;for(let t=0,n=this.morphTargets.length;t<n;t++){if(!this.morphNormals[t]){this.morphNormals[t]={},this.morphNormals[t].faceNormals=[],this.morphNormals[t].vertexNormals=[];let r=this.morphNormals[t].faceNormals,s=this.morphNormals[t].vertexNormals;for(let a=0,l=this.faces.length;a<l;a++){let c=new U,u={a:new U,b:new U,c:new U};r.push(c),s.push(u)}}let i=this.morphNormals[t];e.vertices=this.morphTargets[t].vertices,e.computeFaceNormals(),e.computeVertexNormals();for(let r=0,s=this.faces.length;r<s;r++){let a=this.faces[r],l=i.faceNormals[r],c=i.vertexNormals[r];l.copy(a.normal),c.a.copy(a.vertexNormals[0]),c.b.copy(a.vertexNormals[1]),c.c.copy(a.vertexNormals[2])}}for(let t=0,n=this.faces.length;t<n;t++){let i=this.faces[t];i.normal=i.__originalFaceNormal,i.vertexNormals=i.__originalVertexNormals}}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Sn),this.boundingBox.setFromPoints(this.vertices)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new qi),this.boundingSphere.setFromPoints(this.vertices)}merge(e,t,n=0){if(!(e&&e.isGeometry)){console.error("THREE.Geometry.merge(): geometry not an instance of THREE.Geometry.",e);return}let i,r=this.vertices.length,s=this.vertices,a=e.vertices,l=this.faces,c=e.faces,u=this.colors,d=e.colors;t!==void 0&&(i=new vt().getNormalMatrix(t));for(let h=0,f=a.length;h<f;h++){let g=a[h].clone();t!==void 0&&g.applyMatrix4(t),s.push(g)}for(let h=0,f=d.length;h<f;h++)u.push(d[h].clone());for(let h=0,f=c.length;h<f;h++){let p=c[h],g,v,y=p.vertexNormals,m=p.vertexColors,x=new Ww(p.a+r,p.b+r,p.c+r);x.normal.copy(p.normal),i!==void 0&&x.normal.applyMatrix3(i).normalize();for(let _=0,w=y.length;_<w;_++)g=y[_].clone(),i!==void 0&&g.applyMatrix3(i).normalize(),x.vertexNormals.push(g);x.color.copy(p.color);for(let _=0,w=m.length;_<w;_++)v=m[_],x.vertexColors.push(v.clone());x.materialIndex=p.materialIndex+n,l.push(x)}for(let h=0,f=e.faceVertexUvs.length;h<f;h++){let p=e.faceVertexUvs[h];this.faceVertexUvs[h]===void 0&&(this.faceVertexUvs[h]=[]);for(let g=0,v=p.length;g<v;g++){let y=p[g],m=[];for(let x=0,_=y.length;x<_;x++)m.push(y[x].clone());this.faceVertexUvs[h].push(m)}}}mergeMesh(e){if(!(e&&e.isMesh)){console.error("THREE.Geometry.mergeMesh(): mesh not an instance of THREE.Mesh.",e);return}e.matrixAutoUpdate&&e.updateMatrix(),this.merge(e.geometry,e.matrix)}mergeVertices(e=4){let t={},n=[],i=[],r=Math.pow(10,e);for(let l=0,c=this.vertices.length;l<c;l++){let u=this.vertices[l],d=Math.round(u.x*r)+"_"+Math.round(u.y*r)+"_"+Math.round(u.z*r);t[d]===void 0?(t[d]=l,n.push(this.vertices[l]),i[l]=n.length-1):i[l]=i[t[d]]}let s=[];for(let l=0,c=this.faces.length;l<c;l++){let u=this.faces[l];u.a=i[u.a],u.b=i[u.b],u.c=i[u.c];let d=[u.a,u.b,u.c];for(let h=0;h<3;h++)if(d[h]===d[(h+1)%3]){s.push(l);break}}for(let l=s.length-1;l>=0;l--){let c=s[l];this.faces.splice(c,1);for(let u=0,d=this.faceVertexUvs.length;u<d;u++)this.faceVertexUvs[u].splice(c,1)}let a=this.vertices.length-n.length;return this.vertices=n,a}setFromPoints(e){this.vertices=[];for(let t=0,n=e.length;t<n;t++){let i=e[t];this.vertices.push(new U(i.x,i.y,i.z||0))}return this}sortFacesByMaterialIndex(){let e=this.faces,t=e.length;for(let l=0;l<t;l++)e[l]._id=l;function n(l,c){return l.materialIndex-c.materialIndex}e.sort(n);let i=this.faceVertexUvs[0],r=this.faceVertexUvs[1],s,a;i&&i.length===t&&(s=[]),r&&r.length===t&&(a=[]);for(let l=0;l<t;l++){let c=e[l]._id;s&&s.push(i[c]),a&&a.push(r[c])}s&&(this.faceVertexUvs[0]=s),a&&(this.faceVertexUvs[1]=a)}toJSON(){let e={metadata:{version:4.5,type:"Geometry",generator:"Geometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,this.name!==""&&(e.name=this.name),this.parameters!==void 0){let p=this.parameters;for(let g in p)p[g]!==void 0&&(e[g]=p[g]);return e}let t=[];for(let p=0;p<this.vertices.length;p++){let g=this.vertices[p];t.push(g.x,g.y,g.z)}let n=[],i=[],r={},s=[],a={},l=[],c={};for(let p=0;p<this.faces.length;p++){let g=this.faces[p],v=!0,y=!1,m=this.faceVertexUvs[0][p]!==void 0,x=g.normal.length()>0,_=g.vertexNormals.length>0,w=g.color.r!==1||g.color.g!==1||g.color.b!==1,b=g.vertexColors.length>0,M=0;if(M=u(M,0,0),M=u(M,1,v),M=u(M,2,y),M=u(M,3,m),M=u(M,4,x),M=u(M,5,_),M=u(M,6,w),M=u(M,7,b),n.push(M),n.push(g.a,g.b,g.c),n.push(g.materialIndex),m){let S=this.faceVertexUvs[0][p];n.push(f(S[0]),f(S[1]),f(S[2]))}if(x&&n.push(d(g.normal)),_){let S=g.vertexNormals;n.push(d(S[0]),d(S[1]),d(S[2]))}if(w&&n.push(h(g.color)),b){let S=g.vertexColors;n.push(h(S[0]),h(S[1]),h(S[2]))}}function u(p,g,v){return v?p|1<<g:p&~(1<<g)}function d(p){let g=p.x.toString()+p.y.toString()+p.z.toString();return r[g]!==void 0||(r[g]=i.length/3,i.push(p.x,p.y,p.z)),r[g]}function h(p){let g=p.r.toString()+p.g.toString()+p.b.toString();return a[g]!==void 0||(a[g]=s.length,s.push(p.getHex())),a[g]}function f(p){let g=p.x.toString()+p.y.toString();return c[g]!==void 0||(c[g]=l.length/2,l.push(p.x,p.y)),c[g]}return e.data={},e.data.vertices=t,e.data.normals=i,s.length>0&&(e.data.colors=s),l.length>0&&(e.data.uvs=[l]),e.data.faces=n,e}clone(){return new pr().copy(this)}copy(e){this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.name=e.name;let t=e.vertices;for(let h=0,f=t.length;h<f;h++)this.vertices.push(t[h].clone());let n=e.colors;for(let h=0,f=n.length;h<f;h++)this.colors.push(n[h].clone());let i=e.faces;for(let h=0,f=i.length;h<f;h++)this.faces.push(i[h].clone());for(let h=0,f=e.faceVertexUvs.length;h<f;h++){let p=e.faceVertexUvs[h];this.faceVertexUvs[h]===void 0&&(this.faceVertexUvs[h]=[]);for(let g=0,v=p.length;g<v;g++){let y=p[g],m=[];for(let x=0,_=y.length;x<_;x++){let w=y[x];m.push(w.clone())}this.faceVertexUvs[h].push(m)}}let r=e.morphTargets;for(let h=0,f=r.length;h<f;h++){let p={};if(p.name=r[h].name,r[h].vertices!==void 0){p.vertices=[];for(let g=0,v=r[h].vertices.length;g<v;g++)p.vertices.push(r[h].vertices[g].clone())}if(r[h].normals!==void 0){p.normals=[];for(let g=0,v=r[h].normals.length;g<v;g++)p.normals.push(r[h].normals[g].clone())}this.morphTargets.push(p)}let s=e.morphNormals;for(let h=0,f=s.length;h<f;h++){let p={};if(s[h].vertexNormals!==void 0){p.vertexNormals=[];for(let g=0,v=s[h].vertexNormals.length;g<v;g++){let y=s[h].vertexNormals[g],m={};m.a=y.a.clone(),m.b=y.b.clone(),m.c=y.c.clone(),p.vertexNormals.push(m)}}if(s[h].faceNormals!==void 0){p.faceNormals=[];for(let g=0,v=s[h].faceNormals.length;g<v;g++)p.faceNormals.push(s[h].faceNormals[g].clone())}this.morphNormals.push(p)}let a=e.skinWeights;for(let h=0,f=a.length;h<f;h++)this.skinWeights.push(a[h].clone());let l=e.skinIndices;for(let h=0,f=l.length;h<f;h++)this.skinIndices.push(l[h].clone());let c=e.lineDistances;for(let h=0,f=c.length;h<f;h++)this.lineDistances.push(c[h]);let u=e.boundingBox;u!==null&&(this.boundingBox=u.clone());let d=e.boundingSphere;return d!==null&&(this.boundingSphere=d.clone()),this.elementsNeedUpdate=e.elementsNeedUpdate,this.verticesNeedUpdate=e.verticesNeedUpdate,this.uvsNeedUpdate=e.uvsNeedUpdate,this.normalsNeedUpdate=e.normalsNeedUpdate,this.colorsNeedUpdate=e.colorsNeedUpdate,this.lineDistancesNeedUpdate=e.lineDistancesNeedUpdate,this.groupsNeedUpdate=e.groupsNeedUpdate,this}toBufferGeometry(){let e=new w2().fromGeometry(this),t=new Ue,n=new Float32Array(e.vertices.length*3);if(t.setAttribute("position",new Ye(n,3).copyVector3sArray(e.vertices)),e.normals.length>0){let i=new Float32Array(e.normals.length*3);t.setAttribute("normal",new Ye(i,3).copyVector3sArray(e.normals))}if(e.colors.length>0){let i=new Float32Array(e.colors.length*3);t.setAttribute("color",new Ye(i,3).copyColorsArray(e.colors))}if(e.uvs.length>0){let i=new Float32Array(e.uvs.length*2);t.setAttribute("uv",new Ye(i,2).copyVector2sArray(e.uvs))}if(e.uvs2.length>0){let i=new Float32Array(e.uvs2.length*2);t.setAttribute("uv2",new Ye(i,2).copyVector2sArray(e.uvs2))}t.groups=e.groups;for(let i in e.morphTargets){let r=[],s=e.morphTargets[i];for(let a=0,l=s.length;a<l;a++){let c=s[a],u=new Ne(c.data.length*3,3);u.name=c.name,r.push(u.copyVector3sArray(c.data))}t.morphAttributes[i]=r}if(e.skinIndices.length>0){let i=new Ne(e.skinIndices.length*4,4);t.setAttribute("skinIndex",i.copyVector4sArray(e.skinIndices))}if(e.skinWeights.length>0){let i=new Ne(e.skinWeights.length*4,4);t.setAttribute("skinWeight",i.copyVector4sArray(e.skinWeights))}return e.boundingSphere!==null&&(t.boundingSphere=e.boundingSphere.clone()),e.boundingBox!==null&&(t.boundingBox=e.boundingBox.clone()),t}computeTangents(){console.error("THREE.Geometry: .computeTangents() has been removed.")}computeLineDistances(){console.error("THREE.Geometry: .computeLineDistances() has been removed. Use THREE.Line.computeLineDistances() instead.")}applyMatrix(e){return console.warn("THREE.Geometry: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(e)}dispose(){this.dispatchEvent({type:"dispose"})}static createBufferGeometryFromObject(e){let t=new Ue,n=e.geometry;if(e.isPoints||e.isLine){let i=new Ne(n.vertices.length*3,3),r=new Ne(n.colors.length*3,3);if(t.setAttribute("position",i.copyVector3sArray(n.vertices)),t.setAttribute("color",r.copyColorsArray(n.colors)),n.lineDistances&&n.lineDistances.length===n.vertices.length){let s=new Ne(n.lineDistances.length,1);t.setAttribute("lineDistance",s.copyArray(n.lineDistances))}n.boundingSphere!==null&&(t.boundingSphere=n.boundingSphere.clone()),n.boundingBox!==null&&(t.boundingBox=n.boundingBox.clone())}else e.isMesh&&(t=n.toBufferGeometry());return t}};pr.prototype.isGeometry=!0;var w2=class{constructor(){this.vertices=[],this.normals=[],this.colors=[],this.uvs=[],this.uvs2=[],this.groups=[],this.morphTargets={},this.skinWeights=[],this.skinIndices=[],this.boundingBox=null,this.boundingSphere=null,this.verticesNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.uvsNeedUpdate=!1,this.groupsNeedUpdate=!1}computeGroups(e){let t=[],n,i,r,s=e.faces;for(i=0;i<s.length;i++){let a=s[i];a.materialIndex!==r&&(r=a.materialIndex,n!==void 0&&(n.count=i*3-n.start,t.push(n)),n={start:i*3,materialIndex:r})}n!==void 0&&(n.count=i*3-n.start,t.push(n)),this.groups=t}fromGeometry(e){let t=e.faces,n=e.vertices,i=e.faceVertexUvs,r=i[0]&&i[0].length>0,s=i[1]&&i[1].length>0,a=e.morphTargets,l=a.length,c;if(l>0){c=[];for(let y=0;y<l;y++)c[y]={name:a[y].name,data:[]};this.morphTargets.position=c}let u=e.morphNormals,d=u.length,h;if(d>0){h=[];for(let y=0;y<d;y++)h[y]={name:u[y].name,data:[]};this.morphTargets.normal=h}let f=e.skinIndices,p=e.skinWeights,g=f.length===n.length,v=p.length===n.length;n.length>0&&t.length===0&&console.error("THREE.DirectGeometry: Faceless geometries are not supported.");for(let y=0;y<t.length;y++){let m=t[y];this.vertices.push(n[m.a],n[m.b],n[m.c]);let x=m.vertexNormals;if(x.length===3)this.normals.push(x[0],x[1],x[2]);else{let w=m.normal;this.normals.push(w,w,w)}let _=m.vertexColors;if(_.length===3)this.colors.push(_[0],_[1],_[2]);else{let w=m.color;this.colors.push(w,w,w)}if(r===!0){let w=i[0][y];w!==void 0?this.uvs.push(w[0],w[1],w[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv ",y),this.uvs.push(new _e,new _e,new _e))}if(s===!0){let w=i[1][y];w!==void 0?this.uvs2.push(w[0],w[1],w[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv2 ",y),this.uvs2.push(new _e,new _e,new _e))}for(let w=0;w<l;w++){let b=a[w].vertices;c[w].data.push(b[m.a],b[m.b],b[m.c])}for(let w=0;w<d;w++){let b=u[w].vertexNormals[y];h[w].data.push(b.a,b.b,b.c)}g&&this.skinIndices.push(f[m.a],f[m.b],f[m.c]),v&&this.skinWeights.push(p[m.a],p[m.b],p[m.c])}return this.computeGroups(e),this.verticesNeedUpdate=e.verticesNeedUpdate,this.normalsNeedUpdate=e.normalsNeedUpdate,this.colorsNeedUpdate=e.colorsNeedUpdate,this.uvsNeedUpdate=e.uvsNeedUpdate,this.groupsNeedUpdate=e.groupsNeedUpdate,e.boundingSphere!==null&&(this.boundingSphere=e.boundingSphere.clone()),e.boundingBox!==null&&(this.boundingBox=e.boundingBox.clone()),this}},Ww=class{constructor(e,t,n,i,r,s=0){this.a=e,this.b=t,this.c=n,this.normal=i&&i.isVector3?i:new U,this.vertexNormals=Array.isArray(i)?i:[],this.color=r&&r.isColor?r:new De,this.vertexColors=Array.isArray(r)?r:[],this.materialIndex=s}clone(){return new this.constructor().copy(this)}copy(e){this.a=e.a,this.b=e.b,this.c=e.c,this.normal.copy(e.normal),this.color.copy(e.color),this.materialIndex=e.materialIndex;for(let t=0,n=e.vertexNormals.length;t<n;t++)this.vertexNormals[t]=e.vertexNormals[t].clone();for(let t=0,n=e.vertexColors.length;t<n;t++)this.vertexColors[t]=e.vertexColors[t].clone();return this}};var Xw=class{constructor(e,t,n,i,r,s=0){this.a=e,this.b=t,this.c=n,this.normal=i&&i.isVector3?i:new U,this.vertexNormals=Array.isArray(i)?i:[],this.color=r&&r.isColor?r:new De,this.vertexColors=Array.isArray(r)?r:[],this.materialIndex=s}clone(){return new this.constructor().copy(this)}copy(e){this.a=e.a,this.b=e.b,this.c=e.c,this.normal.copy(e.normal),this.color.copy(e.color),this.materialIndex=e.materialIndex;for(let t=0,n=e.vertexNormals.length;t<n;t++)this.vertexNormals[t]=e.vertexNormals[t].clone();for(let t=0,n=e.vertexColors.length;t<n;t++)this.vertexColors[t]=e.vertexColors[t].clone();return this}};var Xl=class extends tn{constructor(e){super(e);this.defaultDPI=90,this.defaultUnit="px"}load(e,t,n,i){let r=this,s=new mn(r.manager);s.setPath(r.path),s.setRequestHeader(r.requestHeader),s.setWithCredentials(r.withCredentials),s.load(e,function(a){try{t(r.parse(a))}catch(l){i?i(l):console.error(l),r.manager.itemError(e)}},n,i)}parse(e){let t=this;function n(Q,j){if(Q.nodeType!==1)return;let O=_(Q),ee=!0,V=null;switch(Q.nodeName){case"svg":break;case"style":r(Q);break;case"g":j=p(Q,j);break;case"path":j=p(Q,j),Q.hasAttribute("d")&&(V=i(Q));break;case"rect":j=p(Q,j),V=l(Q);break;case"polygon":j=p(Q,j),V=c(Q);break;case"polyline":j=p(Q,j),V=u(Q);break;case"circle":j=p(Q,j),V=d(Q);break;case"ellipse":j=p(Q,j),V=h(Q);break;case"line":j=p(Q,j),V=f(Q);break;case"defs":ee=!1;break;case"use":j=p(Q,j);let ie=Q.href.baseVal.substring(1),ue=Q.viewportElement.getElementById(ie);ue?n(ue,j):console.warn("SVGLoader: 'use node' references non-existent node id: "+ie);break;default:}if(V&&(j.fill!==void 0&&j.fill!=="none"&&V.color.setStyle(j.fill),b(V,z),A.push(V),V.userData={node:Q,style:j}),ee){let ie=Q.childNodes;for(let ue=0;ue<ie.length;ue++)n(ie[ue],j)}O&&(B.pop(),B.length>0?z.copy(B[B.length-1]):z.identity())}function i(Q){let j=new qr,O=new _e,ee=new _e,V=new _e,ie=!0,ue=!1,pe=Q.getAttribute("d").match(/[a-df-z][^a-df-z]*/ig);for(let xe=0,X=pe.length;xe<X;xe++){let $=pe[xe],J=$.charAt(0),ce=$.substr(1).trim();ie===!0&&(ue=!0,ie=!1);let H;switch(J){case"M":H=v(ce);for(let T=0,C=H.length;T<C;T+=2)O.x=H[T+0],O.y=H[T+1],ee.x=O.x,ee.y=O.y,T===0?j.moveTo(O.x,O.y):j.lineTo(O.x,O.y),T===0&&ue===!0&&V.copy(O);break;case"H":H=v(ce);for(let T=0,C=H.length;T<C;T++)O.x=H[T],ee.x=O.x,ee.y=O.y,j.lineTo(O.x,O.y),T===0&&ue===!0&&V.copy(O);break;case"V":H=v(ce);for(let T=0,C=H.length;T<C;T++)O.y=H[T],ee.x=O.x,ee.y=O.y,j.lineTo(O.x,O.y),T===0&&ue===!0&&V.copy(O);break;case"L":H=v(ce);for(let T=0,C=H.length;T<C;T+=2)O.x=H[T+0],O.y=H[T+1],ee.x=O.x,ee.y=O.y,j.lineTo(O.x,O.y),T===0&&ue===!0&&V.copy(O);break;case"C":H=v(ce);for(let T=0,C=H.length;T<C;T+=6)j.bezierCurveTo(H[T+0],H[T+1],H[T+2],H[T+3],H[T+4],H[T+5]),ee.x=H[T+2],ee.y=H[T+3],O.x=H[T+4],O.y=H[T+5],T===0&&ue===!0&&V.copy(O);break;case"S":H=v(ce);for(let T=0,C=H.length;T<C;T+=4)j.bezierCurveTo(g(O.x,ee.x),g(O.y,ee.y),H[T+0],H[T+1],H[T+2],H[T+3]),ee.x=H[T+0],ee.y=H[T+1],O.x=H[T+2],O.y=H[T+3],T===0&&ue===!0&&V.copy(O);break;case"Q":H=v(ce);for(let T=0,C=H.length;T<C;T+=4)j.quadraticCurveTo(H[T+0],H[T+1],H[T+2],H[T+3]),ee.x=H[T+0],ee.y=H[T+1],O.x=H[T+2],O.y=H[T+3],T===0&&ue===!0&&V.copy(O);break;case"T":H=v(ce);for(let T=0,C=H.length;T<C;T+=2){let W=g(O.x,ee.x),Z=g(O.y,ee.y);j.quadraticCurveTo(W,Z,H[T+0],H[T+1]),ee.x=W,ee.y=Z,O.x=H[T+0],O.y=H[T+1],T===0&&ue===!0&&V.copy(O)}break;case"A":H=v(ce,[3,4],7);for(let T=0,C=H.length;T<C;T+=7){if(H[T+5]==O.x&&H[T+6]==O.y)continue;let W=O.clone();O.x=H[T+5],O.y=H[T+6],ee.x=O.x,ee.y=O.y,s(j,H[T],H[T+1],H[T+2],H[T+3],H[T+4],W,O),T===0&&ue===!0&&V.copy(O)}break;case"m":H=v(ce);for(let T=0,C=H.length;T<C;T+=2)O.x+=H[T+0],O.y+=H[T+1],ee.x=O.x,ee.y=O.y,T===0?j.moveTo(O.x,O.y):j.lineTo(O.x,O.y),T===0&&ue===!0&&V.copy(O);break;case"h":H=v(ce);for(let T=0,C=H.length;T<C;T++)O.x+=H[T],ee.x=O.x,ee.y=O.y,j.lineTo(O.x,O.y),T===0&&ue===!0&&V.copy(O);break;case"v":H=v(ce);for(let T=0,C=H.length;T<C;T++)O.y+=H[T],ee.x=O.x,ee.y=O.y,j.lineTo(O.x,O.y),T===0&&ue===!0&&V.copy(O);break;case"l":H=v(ce);for(let T=0,C=H.length;T<C;T+=2)O.x+=H[T+0],O.y+=H[T+1],ee.x=O.x,ee.y=O.y,j.lineTo(O.x,O.y),T===0&&ue===!0&&V.copy(O);break;case"c":H=v(ce);for(let T=0,C=H.length;T<C;T+=6)j.bezierCurveTo(O.x+H[T+0],O.y+H[T+1],O.x+H[T+2],O.y+H[T+3],O.x+H[T+4],O.y+H[T+5]),ee.x=O.x+H[T+2],ee.y=O.y+H[T+3],O.x+=H[T+4],O.y+=H[T+5],T===0&&ue===!0&&V.copy(O);break;case"s":H=v(ce);for(let T=0,C=H.length;T<C;T+=4)j.bezierCurveTo(g(O.x,ee.x),g(O.y,ee.y),O.x+H[T+0],O.y+H[T+1],O.x+H[T+2],O.y+H[T+3]),ee.x=O.x+H[T+0],ee.y=O.y+H[T+1],O.x+=H[T+2],O.y+=H[T+3],T===0&&ue===!0&&V.copy(O);break;case"q":H=v(ce);for(let T=0,C=H.length;T<C;T+=4)j.quadraticCurveTo(O.x+H[T+0],O.y+H[T+1],O.x+H[T+2],O.y+H[T+3]),ee.x=O.x+H[T+0],ee.y=O.y+H[T+1],O.x+=H[T+2],O.y+=H[T+3],T===0&&ue===!0&&V.copy(O);break;case"t":H=v(ce);for(let T=0,C=H.length;T<C;T+=2){let W=g(O.x,ee.x),Z=g(O.y,ee.y);j.quadraticCurveTo(W,Z,O.x+H[T+0],O.y+H[T+1]),ee.x=W,ee.y=Z,O.x=O.x+H[T+0],O.y=O.y+H[T+1],T===0&&ue===!0&&V.copy(O)}break;case"a":H=v(ce,[3,4],7);for(let T=0,C=H.length;T<C;T+=7){if(H[T+5]==0&&H[T+6]==0)continue;let W=O.clone();O.x+=H[T+5],O.y+=H[T+6],ee.x=O.x,ee.y=O.y,s(j,H[T],H[T+1],H[T+2],H[T+3],H[T+4],W,O),T===0&&ue===!0&&V.copy(O)}break;case"Z":case"z":j.currentPath.autoClose=!0,j.currentPath.curves.length>0&&(O.copy(V),j.currentPath.currentPoint.copy(O),ie=!0);break;default:console.warn($)}ue=!1}return j}function r(Q){if(!(!Q.sheet||!Q.sheet.cssRules||!Q.sheet.cssRules.length))for(let j=0;j<Q.sheet.cssRules.length;j++){let O=Q.sheet.cssRules[j];if(O.type!==1)continue;let ee=O.selectorText.split(/,/gm).filter(Boolean).map(V=>V.trim());for(let V=0;V<ee.length;V++)L[ee[V]]=Object.assign(L[ee[V]]||{},O.style)}}function s(Q,j,O,ee,V,ie,ue,ye){if(j==0||O==0){Q.lineTo(ye.x,ye.y);return}ee=ee*Math.PI/180,j=Math.abs(j),O=Math.abs(O);let pe=(ue.x-ye.x)/2,xe=(ue.y-ye.y)/2,X=Math.cos(ee)*pe+Math.sin(ee)*xe,$=-Math.sin(ee)*pe+Math.cos(ee)*xe,J=j*j,ce=O*O,H=X*X,T=$*$,C=H/J+T/ce;if(C>1){let de=Math.sqrt(C);j=de*j,O=de*O,J=j*j,ce=O*O}let W=J*T+ce*H,Z=(J*ce-W)/W,he=Math.sqrt(Math.max(0,Z));V===ie&&(he=-he);let me=he*j*$/O,Ee=-he*O*X/j,Se=Math.cos(ee)*me-Math.sin(ee)*Ee+(ue.x+ye.x)/2,oe=Math.sin(ee)*me+Math.cos(ee)*Ee+(ue.y+ye.y)/2,ge=a(1,0,(X-me)/j,($-Ee)/O),k=a((X-me)/j,($-Ee)/O,(-X-me)/j,(-$-Ee)/O)%(Math.PI*2);Q.currentPath.absellipse(Se,oe,j,O,ge,ge+k,ie===0,ee)}function a(Q,j,O,ee){let V=Q*O+j*ee,ie=Math.sqrt(Q*Q+j*j)*Math.sqrt(O*O+ee*ee),ue=Math.acos(Math.max(-1,Math.min(1,V/ie)));return Q*ee-j*O<0&&(ue=-ue),ue}function l(Q){let j=x(Q.getAttribute("x")||0),O=x(Q.getAttribute("y")||0),ee=x(Q.getAttribute("rx")||0),V=x(Q.getAttribute("ry")||0),ie=x(Q.getAttribute("width")),ue=x(Q.getAttribute("height")),ye=new qr;return ye.moveTo(j+2*ee,O),ye.lineTo(j+ie-2*ee,O),(ee!==0||V!==0)&&ye.bezierCurveTo(j+ie,O,j+ie,O,j+ie,O+2*V),ye.lineTo(j+ie,O+ue-2*V),(ee!==0||V!==0)&&ye.bezierCurveTo(j+ie,O+ue,j+ie,O+ue,j+ie-2*ee,O+ue),ye.lineTo(j+2*ee,O+ue),(ee!==0||V!==0)&&ye.bezierCurveTo(j,O+ue,j,O+ue,j,O+ue-2*V),ye.lineTo(j,O+2*V),(ee!==0||V!==0)&&ye.bezierCurveTo(j,O,j,O,j+2*ee,O),ye}function c(Q){function j(ie,ue,ye){let pe=x(ue),xe=x(ye);V===0?ee.moveTo(pe,xe):ee.lineTo(pe,xe),V++}let O=/(-?[\d\.?]+)[,|\s](-?[\d\.?]+)/g,ee=new qr,V=0;return Q.getAttribute("points").replace(O,j),ee.currentPath.autoClose=!0,ee}function u(Q){function j(ie,ue,ye){let pe=x(ue),xe=x(ye);V===0?ee.moveTo(pe,xe):ee.lineTo(pe,xe),V++}let O=/(-?[\d\.?]+)[,|\s](-?[\d\.?]+)/g,ee=new qr,V=0;return Q.getAttribute("points").replace(O,j),ee.currentPath.autoClose=!1,ee}function d(Q){let j=x(Q.getAttribute("cx")||0),O=x(Q.getAttribute("cy")||0),ee=x(Q.getAttribute("r")||0),V=new _s;V.absarc(j,O,ee,0,Math.PI*2);let ie=new qr;return ie.subPaths.push(V),ie}function h(Q){let j=x(Q.getAttribute("cx")||0),O=x(Q.getAttribute("cy")||0),ee=x(Q.getAttribute("rx")||0),V=x(Q.getAttribute("ry")||0),ie=new _s;ie.absellipse(j,O,ee,V,0,Math.PI*2);let ue=new qr;return ue.subPaths.push(ie),ue}function f(Q){let j=x(Q.getAttribute("x1")||0),O=x(Q.getAttribute("y1")||0),ee=x(Q.getAttribute("x2")||0),V=x(Q.getAttribute("y2")||0),ie=new qr;return ie.moveTo(j,O),ie.lineTo(ee,V),ie.currentPath.autoClose=!1,ie}function p(Q,j){j=Object.assign({},j);let O={};if(Q.hasAttribute("class")){let ue=Q.getAttribute("class").split(/\s/).filter(Boolean).map(ye=>ye.trim());for(let ye=0;ye<ue.length;ye++)O=Object.assign(O,L["."+ue[ye]])}Q.hasAttribute("id")&&(O=Object.assign(O,L["#"+Q.getAttribute("id")]));function ee(ue,ye,pe){pe===void 0&&(pe=function(X){return X.startsWith("url")&&console.warn("SVGLoader: url access in attributes is not implemented."),X}),Q.hasAttribute(ue)&&(j[ye]=pe(Q.getAttribute(ue))),O[ue]&&(j[ye]=pe(O[ue])),Q.style&&Q.style[ue]!==""&&(j[ye]=pe(Q.style[ue]))}function V(ue){return Math.max(0,Math.min(1,x(ue)))}function ie(ue){return Math.max(0,x(ue))}return ee("fill","fill"),ee("fill-opacity","fillOpacity",V),ee("opacity","opacity",V),ee("stroke","stroke"),ee("stroke-opacity","strokeOpacity",V),ee("stroke-width","strokeWidth",ie),ee("stroke-linejoin","strokeLineJoin"),ee("stroke-linecap","strokeLineCap"),ee("stroke-miterlimit","strokeMiterLimit",ie),ee("visibility","visibility"),j}function g(Q,j){return Q-(j-Q)}function v(Q,j,O){if(typeof Q!="string")throw new TypeError("Invalid input: "+typeof Q);let ee={SEPARATOR:/[ \t\r\n\,.\-+]/,WHITESPACE:/[ \t\r\n]/,DIGIT:/[\d]/,SIGN:/[-+]/,POINT:/\./,COMMA:/,/,EXP:/e/i,FLAGS:/[01]/},V=0,ie=1,ue=2,ye=3,pe=V,xe=!0,X="",$="",J=[];function ce(W,Z,he){let me=new SyntaxError('Unexpected character "'+W+'" at index '+Z+".");throw me.partial=he,me}function H(){X!==""&&($===""?J.push(Number(X)):J.push(Number(X)*Math.pow(10,Number($)))),X="",$=""}let T,C=Q.length;for(let W=0;W<C;W++){if(T=Q[W],Array.isArray(j)&&j.includes(J.length%O)&&ee.FLAGS.test(T)){pe=ie,X=T,H();continue}if(pe===V){if(ee.WHITESPACE.test(T))continue;if(ee.DIGIT.test(T)||ee.SIGN.test(T)){pe=ie,X=T;continue}if(ee.POINT.test(T)){pe=ue,X=T;continue}ee.COMMA.test(T)&&(xe&&ce(T,W,J),xe=!0)}if(pe===ie){if(ee.DIGIT.test(T)){X+=T;continue}if(ee.POINT.test(T)){X+=T,pe=ue;continue}if(ee.EXP.test(T)){pe=ye;continue}ee.SIGN.test(T)&&X.length===1&&ee.SIGN.test(X[0])&&ce(T,W,J)}if(pe===ue){if(ee.DIGIT.test(T)){X+=T;continue}if(ee.EXP.test(T)){pe=ye;continue}ee.POINT.test(T)&&X[X.length-1]==="."&&ce(T,W,J)}if(pe===ye){if(ee.DIGIT.test(T)){$+=T;continue}if(ee.SIGN.test(T)){if($===""){$+=T;continue}$.length===1&&ee.SIGN.test($)&&ce(T,W,J)}}ee.WHITESPACE.test(T)?(H(),pe=V,xe=!1):ee.COMMA.test(T)?(H(),pe=V,xe=!0):ee.SIGN.test(T)?(H(),pe=ie,X=T):ee.POINT.test(T)?(H(),pe=ue,X=T):ce(T,W,J)}return H(),J}let y=["mm","cm","in","pt","pc","px"],m={mm:{mm:1,cm:.1,in:1/25.4,pt:72/25.4,pc:6/25.4,px:-1},cm:{mm:10,cm:1,in:1/2.54,pt:72/2.54,pc:6/2.54,px:-1},in:{mm:25.4,cm:2.54,in:1,pt:72,pc:6,px:-1},pt:{mm:25.4/72,cm:2.54/72,in:1/72,pt:1,pc:6/72,px:-1},pc:{mm:25.4/6,cm:2.54/6,in:1/6,pt:72/6,pc:1,px:-1},px:{px:1}};function x(Q){let j="px";if(typeof Q=="string"||Q instanceof String)for(let ee=0,V=y.length;ee<V;ee++){let ie=y[ee];if(Q.endsWith(ie)){j=ie,Q=Q.substring(0,Q.length-ie.length);break}}let O;return j==="px"&&t.defaultUnit!=="px"?O=m.in[t.defaultUnit]/t.defaultDPI:(O=m[j][t.defaultUnit],O<0&&(O=m[j].in*t.defaultDPI)),O*parseFloat(Q)}function _(Q){if(!(Q.hasAttribute("transform")||Q.nodeName==="use"&&(Q.hasAttribute("x")||Q.hasAttribute("y"))))return null;let j=w(Q);return B.length>0&&j.premultiply(B[B.length-1]),z.copy(j),B.push(j),j}function w(Q){let j=new vt,O=R;if(Q.nodeName==="use"&&(Q.hasAttribute("x")||Q.hasAttribute("y"))){let ee=x(Q.getAttribute("x")),V=x(Q.getAttribute("y"));j.translate(ee,V)}if(Q.hasAttribute("transform")){let ee=Q.getAttribute("transform").split(")");for(let V=ee.length-1;V>=0;V--){let ie=ee[V].trim();if(ie==="")continue;let ue=ie.indexOf("("),ye=ie.length;if(ue>0&&ue<ye){let pe=ie.substr(0,ue),xe=v(ie.substr(ue+1,ye-ue-1));switch(O.identity(),pe){case"translate":if(xe.length>=1){let X=xe[0],$=X;xe.length>=2&&($=xe[1]),O.translate(X,$)}break;case"rotate":if(xe.length>=1){let X=0,$=0,J=0;X=-xe[0]*Math.PI/180,xe.length>=3&&($=xe[1],J=xe[2]),D.identity().translate(-$,-J),P.identity().rotate(X),I.multiplyMatrices(P,D),D.identity().translate($,J),O.multiplyMatrices(D,I)}break;case"scale":if(xe.length>=1){let X=xe[0],$=X;xe.length>=2&&($=xe[1]),O.scale(X,$)}break;case"skewX":xe.length===1&&O.set(1,Math.tan(xe[0]*Math.PI/180),0,0,1,0,0,0,1);break;case"skewY":xe.length===1&&O.set(1,0,0,Math.tan(xe[0]*Math.PI/180),1,0,0,0,1);break;case"matrix":xe.length===6&&O.set(xe[0],xe[2],xe[4],xe[1],xe[3],xe[5],0,0,1);break}}j.premultiply(O)}}return j}function b(Q,j){function O(ie){G.set(ie.x,ie.y,1).applyMatrix3(j),ie.set(G.x,G.y)}let ee=M(j),V=Q.subPaths;for(let ie=0,ue=V.length;ie<ue;ie++){let pe=V[ie].curves;for(let xe=0;xe<pe.length;xe++){let X=pe[xe];X.isLineCurve?(O(X.v1),O(X.v2)):X.isCubicBezierCurve?(O(X.v0),O(X.v1),O(X.v2),O(X.v3)):X.isQuadraticBezierCurve?(O(X.v0),O(X.v1),O(X.v2)):X.isEllipseCurve&&(ee&&console.warn("SVGLoader: Elliptic arc or ellipse rotation or skewing is not implemented."),N.set(X.aX,X.aY),O(N),X.aX=N.x,X.aY=N.y,X.xRadius*=S(j),X.yRadius*=E(j))}}}function M(Q){return Q.elements[1]!==0||Q.elements[3]!==0}function S(Q){let j=Q.elements;return Math.sqrt(j[0]*j[0]+j[1]*j[1])}function E(Q){let j=Q.elements;return Math.sqrt(j[3]*j[3]+j[4]*j[4])}let A=[],L={},B=[],R=new vt,D=new vt,P=new vt,I=new vt,N=new _e,G=new U,z=new vt,se=new DOMParser().parseFromString(e,"image/svg+xml");return n(se.documentElement,{fill:"#000",fillOpacity:1,strokeOpacity:1,strokeWidth:1,strokeLineJoin:"miter",strokeLineCap:"butt",strokeMiterLimit:4}),{paths:A,xml:se.documentElement}}static createShapes(e){let t=999999999,n={ORIGIN:0,DESTINATION:1,BETWEEN:2,LEFT:3,RIGHT:4,BEHIND:5,BEYOND:6},i={loc:n.ORIGIN,t:0};function r(v,y,m,x){let _=v.x,w=y.x,b=m.x,M=x.x,S=v.y,E=y.y,A=m.y,L=x.y,B=(M-b)*(S-A)-(L-A)*(_-b),R=(w-_)*(S-A)-(E-S)*(_-b),D=(L-A)*(w-_)-(M-b)*(E-S),P=B/D,I=R/D;if(D===0&&B!==0||P<=0||P>=1||I<0||I>1)return null;if(B===0&&D===0){for(let N=0;N<2;N++)if(s(N===0?m:x,v,y),i.loc==n.ORIGIN){let G=N===0?m:x;return{x:G.x,y:G.y,t:i.t}}else if(i.loc==n.BETWEEN){let G=+(_+i.t*(w-_)).toPrecision(10),z=+(S+i.t*(E-S)).toPrecision(10);return{x:G,y:z,t:i.t}}return null}else{for(let z=0;z<2;z++)if(s(z===0?m:x,v,y),i.loc==n.ORIGIN){let se=z===0?m:x;return{x:se.x,y:se.y,t:i.t}}let N=+(_+P*(w-_)).toPrecision(10),G=+(S+P*(E-S)).toPrecision(10);return{x:N,y:G,t:P}}}function s(v,y,m){let x=m.x-y.x,_=m.y-y.y,w=v.x-y.x,b=v.y-y.y,M=x*b-w*_;if(v.x===y.x&&v.y===y.y){i.loc=n.ORIGIN,i.t=0;return}if(v.x===m.x&&v.y===m.y){i.loc=n.DESTINATION,i.t=1;return}if(M<-Number.EPSILON){i.loc=n.LEFT;return}if(M>Number.EPSILON){i.loc=n.RIGHT;return}if(x*w<0||_*b<0){i.loc=n.BEHIND;return}if(Math.sqrt(x*x+_*_)<Math.sqrt(w*w+b*b)){i.loc=n.BEYOND;return}let S;x!==0?S=w/x:S=b/_,i.loc=n.BETWEEN,i.t=S}function a(v,y){let m=[],x=[];for(let _=1;_<v.length;_++){let w=v[_-1],b=v[_];for(let M=1;M<y.length;M++){let S=y[M-1],E=y[M],A=r(w,b,S,E);A!==null&&m.find(L=>L.t<=A.t+Number.EPSILON&&L.t>=A.t-Number.EPSILON)===void 0&&(m.push(A),x.push(new _e(A.x,A.y)))}}return x}function l(v,y,m){let x=new _e;y.getCenter(x);let _=[];return m.forEach(w=>{w.boundingBox.containsPoint(x)&&a(v,w.points).forEach(M=>{_.push({identifier:w.identifier,isCW:w.isCW,point:M})})}),_.sort((w,b)=>w.point.x-b.point.x),_}function c(v,y,m,x,_){(_==null||_==="")&&(_="nonzero");let w=new _e;v.boundingBox.getCenter(w);let b=[new _e(m,w.y),new _e(x,w.y)],M=l(b,v.boundingBox,y);M.sort((R,D)=>R.point.x-D.point.x);let S=[],E=[];M.forEach(R=>{R.identifier===v.identifier?S.push(R):E.push(R)});let A=S[0].point.x,L=[],B=0;for(;B<E.length&&E[B].point.x<A;)L.length>0&&L[L.length-1]===E[B].identifier?L.pop():L.push(E[B].identifier),B++;if(L.push(v.identifier),_==="evenodd"){let R=L.length%2==0,D=L[L.length-2];return{identifier:v.identifier,isHole:R,for:D}}else if(_==="nonzero"){let R=!0,D=null,P=null;for(let I=0;I<L.length;I++){let N=L[I];R?(P=y[N].isCW,R=!1,D=N):P!==y[N].isCW&&(P=y[N].isCW,R=!0)}return{identifier:v.identifier,isHole:R,for:D}}else console.warn('fill-rule: "'+_+'" is currently not implemented.')}let u=0,d=t,h=-t,f=e.subPaths.map(v=>{let y=v.getPoints(),m=-t,x=t,_=-t,w=t;for(let b=0;b<y.length;b++){let M=y[b];M.y>m&&(m=M.y),M.y<x&&(x=M.y),M.x>_&&(_=M.x),M.x<w&&(w=M.x)}return h<=_&&(h=_+1),d>=w&&(d=w-1),{points:y,isCW:Zi.isClockWise(y),identifier:u++,boundingBox:new ho(new _e(w,x),new _e(_,m))}});f=f.filter(v=>v.points.length>1);let p=f.map(v=>c(v,f,d,h,e.userData.style.fillRule)),g=[];return f.forEach(v=>{if(!p[v.identifier].isHole){let m=new Wr(v.points);p.filter(_=>_.isHole&&_.for===v.identifier).forEach(_=>{let w=f[_.identifier];m.holes.push(new _s(w.points))}),g.push(m)}}),g}static getStrokeStyle(e,t,n,i,r){return e=e!==void 0?e:1,t=t!==void 0?t:"#000",n=n!==void 0?n:"miter",i=i!==void 0?i:"butt",r=r!==void 0?r:4,{strokeColor:t,strokeWidth:e,strokeLineJoin:n,strokeLineCap:i,strokeMiterLimit:r}}static pointsToStroke(e,t,n,i){let r=[],s=[],a=[];if(Xl.pointsToStrokeWithBuffers(e,t,n,i,r,s,a)===0)return null;let l=new Ue;return l.setAttribute("position",new Ne(r,3)),l.setAttribute("normal",new Ne(s,3)),l.setAttribute("uv",new Ne(a,2)),l}static pointsToStrokeWithBuffers(e,t,n,i,r,s,a,l){let c=new _e,u=new _e,d=new _e,h=new _e,f=new _e,p=new _e,g=new _e,v=new _e,y=new _e,m=new _e,x=new _e,_=new _e,w=new _e,b=new _e,M=new _e,S=new _e,E=new _e;n=n!==void 0?n:12,i=i!==void 0?i:.001,l=l!==void 0?l:0,e=$(e);let A=e.length;if(A<2)return 0;let L=e[0].equals(e[A-1]),B,R=e[0],D,P=t.strokeWidth/2,I=1/(A-1),N=0,G,z,se,ne,Q=!1,j=0,O=l*3,ee=l*2;V(e[0],e[1],c).multiplyScalar(P),v.copy(e[0]).sub(c),y.copy(e[0]).add(c),m.copy(v),x.copy(y);for(let J=1;J<A;J++){B=e[J],J===A-1?L?D=e[1]:D=void 0:D=e[J+1];let ce=c;if(V(R,B,ce),d.copy(ce).multiplyScalar(P),_.copy(B).sub(d),w.copy(B).add(d),G=N+I,z=!1,D!==void 0){V(B,D,u),d.copy(u).multiplyScalar(P),b.copy(B).sub(d),M.copy(B).add(d),se=!0,d.subVectors(D,R),ce.dot(d)<0&&(se=!1),J===1&&(Q=se),d.subVectors(D,B),d.normalize();let H=Math.abs(ce.dot(d));if(H!==0){let T=P/H;d.multiplyScalar(-T),h.subVectors(B,R),f.copy(h).setLength(T).add(d),S.copy(f).negate();let C=f.length(),W=h.length();h.divideScalar(W),p.subVectors(D,B);let Z=p.length();switch(p.divideScalar(Z),h.dot(S)<W&&p.dot(S)<Z&&(z=!0),E.copy(f).add(B),S.add(B),ne=!1,z?se?(M.copy(S),w.copy(S)):(b.copy(S),_.copy(S)):ye(),t.strokeLineJoin){case"bevel":pe(se,z,G);break;case"round":xe(se,z),se?ue(B,_,b,G,0):ue(B,M,w,G,1);break;case"miter":case"miter-clip":default:let he=P*t.strokeMiterLimit/C;if(he<1)if(t.strokeLineJoin!=="miter-clip"){pe(se,z,G);break}else xe(se,z),se?(p.subVectors(E,_).multiplyScalar(he).add(_),g.subVectors(E,b).multiplyScalar(he).add(b),ie(_,G,0),ie(p,G,0),ie(B,G,.5),ie(B,G,.5),ie(p,G,0),ie(g,G,0),ie(B,G,.5),ie(g,G,0),ie(b,G,0)):(p.subVectors(E,w).multiplyScalar(he).add(w),g.subVectors(E,M).multiplyScalar(he).add(M),ie(w,G,1),ie(p,G,1),ie(B,G,.5),ie(B,G,.5),ie(p,G,1),ie(g,G,1),ie(B,G,.5),ie(g,G,1),ie(M,G,1));else z?(se?(ie(y,N,1),ie(v,N,0),ie(E,G,0),ie(y,N,1),ie(E,G,0),ie(S,G,1)):(ie(y,N,1),ie(v,N,0),ie(E,G,1),ie(v,N,0),ie(S,G,0),ie(E,G,1)),se?b.copy(E):M.copy(E)):se?(ie(_,G,0),ie(E,G,0),ie(B,G,.5),ie(B,G,.5),ie(E,G,0),ie(b,G,0)):(ie(w,G,1),ie(E,G,1),ie(B,G,.5),ie(B,G,.5),ie(E,G,1),ie(M,G,1)),ne=!0;break}}else ye()}else ye();!L&&J===A-1&&X(e[0],m,x,se,!0,N),N=G,R=B,v.copy(b),y.copy(M)}if(!L)X(B,_,w,se,!1,G);else if(z&&r){let J=E,ce=S;Q!==se&&(J=S,ce=E),se?(ne||Q)&&(ce.toArray(r,0*3),ce.toArray(r,3*3),ne&&J.toArray(r,1*3)):(ne||!Q)&&(ce.toArray(r,1*3),ce.toArray(r,3*3),ne&&J.toArray(r,0*3))}return j;function V(J,ce,H){return H.subVectors(ce,J),H.set(-H.y,H.x).normalize()}function ie(J,ce,H){r&&(r[O]=J.x,r[O+1]=J.y,r[O+2]=0,s&&(s[O]=0,s[O+1]=0,s[O+2]=1),O+=3,a&&(a[ee]=ce,a[ee+1]=H,ee+=2)),j+=3}function ue(J,ce,H,T,C){c.copy(ce).sub(J).normalize(),u.copy(H).sub(J).normalize();let W=Math.PI,Z=c.dot(u);Math.abs(Z)<1&&(W=Math.abs(Math.acos(Z))),W/=n,d.copy(ce);for(let he=0,me=n-1;he<me;he++)h.copy(d).rotateAround(J,W),ie(d,T,C),ie(h,T,C),ie(J,T,.5),d.copy(h);ie(h,T,C),ie(H,T,C),ie(J,T,.5)}function ye(){ie(y,N,1),ie(v,N,0),ie(_,G,0),ie(y,N,1),ie(_,G,1),ie(w,G,0)}function pe(J,ce,H){ce?J?(ie(y,N,1),ie(v,N,0),ie(_,G,0),ie(y,N,1),ie(_,G,0),ie(S,G,1),ie(_,H,0),ie(b,H,0),ie(S,H,.5)):(ie(y,N,1),ie(v,N,0),ie(w,G,1),ie(v,N,0),ie(S,G,0),ie(w,G,1),ie(w,H,1),ie(M,H,0),ie(S,H,.5)):J?(ie(_,H,0),ie(b,H,0),ie(B,H,.5)):(ie(w,H,1),ie(M,H,0),ie(B,H,.5))}function xe(J,ce){ce&&(J?(ie(y,N,1),ie(v,N,0),ie(_,G,0),ie(y,N,1),ie(_,G,0),ie(S,G,1),ie(_,N,0),ie(B,G,.5),ie(S,G,1),ie(B,G,.5),ie(b,N,0),ie(S,G,1)):(ie(y,N,1),ie(v,N,0),ie(w,G,1),ie(v,N,0),ie(S,G,0),ie(w,G,1),ie(w,N,1),ie(S,G,0),ie(B,G,.5),ie(B,G,.5),ie(S,G,0),ie(M,N,1)))}function X(J,ce,H,T,C,W){switch(t.strokeLineCap){case"round":C?ue(J,H,ce,W,.5):ue(J,ce,H,W,.5);break;case"square":if(C)c.subVectors(ce,J),u.set(c.y,-c.x),d.addVectors(c,u).add(J),h.subVectors(u,c).add(J),T?(d.toArray(r,1*3),h.toArray(r,0*3),h.toArray(r,3*3)):(d.toArray(r,1*3),d.toArray(r,3*3),h.toArray(r,0*3));else{c.subVectors(H,J),u.set(c.y,-c.x),d.addVectors(c,u).add(J),h.subVectors(u,c).add(J);let Z=r.length;T?(d.toArray(r,Z-1*3),h.toArray(r,Z-2*3),h.toArray(r,Z-4*3)):(d.toArray(r,Z-2*3),h.toArray(r,Z-1*3),h.toArray(r,Z-4*3))}break;case"butt":default:break}}function $(J){let ce=!1;for(let T=1,C=J.length-1;T<C;T++)if(J[T].distanceTo(J[T+1])<i){ce=!0;break}if(!ce)return J;let H=[];H.push(J[0]);for(let T=1,C=J.length-1;T<C;T++)J[T].distanceTo(J[T+1])>=i&&H.push(J[T]);return H.push(J[J.length-1]),H}}};var qw=class{constructor(){this.vertices=[],this.normals=[],this.colors=[],this.uvs=[],this.uvs2=[],this.groups=[],this.morphTargets={},this.skinWeights=[],this.skinIndices=[],this.boundingBox=null,this.boundingSphere=null,this.verticesNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.uvsNeedUpdate=!1,this.groupsNeedUpdate=!1}computeGroups(e){let t=[],n,i,r,s=e.faces;for(i=0;i<s.length;i++){let a=s[i];a.materialIndex!==r&&(r=a.materialIndex,n!==void 0&&(n.count=i*3-n.start,t.push(n)),n={start:i*3,materialIndex:r})}n!==void 0&&(n.count=i*3-n.start,t.push(n)),this.groups=t}fromGeometry(e){let t=e.faces,n=e.vertices,i=e.faceVertexUvs,r=i[0]&&i[0].length>0,s=i[1]&&i[1].length>0,a=e.morphTargets,l=a.length,c;if(l>0){c=[];for(let y=0;y<l;y++)c[y]={name:a[y].name,data:[]};this.morphTargets.position=c}let u=e.morphNormals,d=u.length,h;if(d>0){h=[];for(let y=0;y<d;y++)h[y]={name:u[y].name,data:[]};this.morphTargets.normal=h}let f=e.skinIndices,p=e.skinWeights,g=f.length===n.length,v=p.length===n.length;n.length>0&&t.length===0&&console.error("THREE.DirectGeometry: Faceless geometries are not supported.");for(let y=0;y<t.length;y++){let m=t[y];this.vertices.push(n[m.a],n[m.b],n[m.c]);let x=m.vertexNormals;if(x.length===3)this.normals.push(x[0],x[1],x[2]);else{let w=m.normal;this.normals.push(w,w,w)}let _=m.vertexColors;if(_.length===3)this.colors.push(_[0],_[1],_[2]);else{let w=m.color;this.colors.push(w,w,w)}if(r===!0){let w=i[0][y];w!==void 0?this.uvs.push(w[0],w[1],w[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv ",y),this.uvs.push(new _e,new _e,new _e))}if(s===!0){let w=i[1][y];w!==void 0?this.uvs2.push(w[0],w[1],w[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv2 ",y),this.uvs2.push(new _e,new _e,new _e))}for(let w=0;w<l;w++){let b=a[w].vertices;c[w].data.push(b[m.a],b[m.b],b[m.c])}for(let w=0;w<d;w++){let b=u[w].vertexNormals[y];h[w].data.push(b.a,b.b,b.c)}g&&this.skinIndices.push(f[m.a],f[m.b],f[m.c]),v&&this.skinWeights.push(p[m.a],p[m.b],p[m.c])}return this.computeGroups(e),this.verticesNeedUpdate=e.verticesNeedUpdate,this.normalsNeedUpdate=e.normalsNeedUpdate,this.colorsNeedUpdate=e.colorsNeedUpdate,this.uvsNeedUpdate=e.uvsNeedUpdate,this.groupsNeedUpdate=e.groupsNeedUpdate,e.boundingSphere!==null&&(this.boundingSphere=e.boundingSphere.clone()),e.boundingBox!==null&&(this.boundingBox=e.boundingBox.clone()),this}};var My=(o,e)=>{let t=new qw().fromGeometry(e);return JG(o,t)},JG=(o,e)=>{var t,n;let i=new Float32Array(e.vertices.length*3);if(o.setAttribute("position",new Ye(i,3).copyVector3sArray(e.vertices)),e.normals.length>0){let r=new Float32Array(e.normals.length*3);o.setAttribute("normal",new Ye(r,3).copyVector3sArray(e.normals))}if(e.colors.length>0){let r=new Float32Array(e.colors.length*3);o.setAttribute("color",new Ye(r,3).copyColorsArray(e.colors))}if(e.uvs.length>0){let r=new Float32Array(e.uvs.length*2);o.setAttribute("uv",new Ye(r,2).copyVector2sArray(e.uvs))}if(e.uvs2.length>0){let r=new Float32Array(e.uvs2.length*2);o.setAttribute("uv2",new Ye(r,2).copyVector2sArray(e.uvs2))}o.groups=e.groups;for(let r in e.morphTargets){let s=[],a=e.morphTargets[r];for(let l=0,c=a.length;l<c;l++){let u=a[l],d=new Ne(u.data.length*3,3);d.name=u.name,s.push(d.copyVector3sArray(u.data))}o.morphAttributes[r]=s}if(e.skinIndices.length>0){let r=new Ne(e.skinIndices.length*4,4);o.setAttribute("skinIndex",r.copyVector4sArray(e.skinIndices))}if(e.skinWeights.length>0){let r=new Ne(e.skinWeights.length*4,4);o.setAttribute("skinWeight",r.copyVector4sArray(e.skinWeights))}return e.boundingSphere!==null&&(o.boundingSphere=(t=e.boundingSphere)===null||t===void 0?void 0:t.clone()),e.boundingBox!==null&&(o.boundingBox=(n=e.boundingBox)===null||n===void 0?void 0:n.clone()),o};var fo=class{constructor(e,t){this.camera=e,this.renderer=t}static geometryToBufferGeometry(e){return e.isGeometry?My(new Ue,e):e}static bufferGeometryToGeometry(e){return e.isBufferGeometry?new pr().fromBufferGeometry(e):e}fromSVGtoShape(e,t=!1,n){if(e){let i=new Xl,r=[];return i.parse(e).paths.forEach(s=>{s.toShapes(t,n).forEach(a=>{r.push(a)})}),r}return[]}from3dto2d(e){let t=new U(e.x,e.y,e.z),n=this.renderer.domElement;this.camera.updateMatrixWorld(),t.project(this.camera);let i=Math.round((t.x+1)*(n.width/2)),r=Math.round((-t.y+1)*(n.height/2));return new _e(i,r)}from2dto3d(e,t,n){var i;if(!this.tmpPlane){let l=new Bi(1e4,1e4),c=new Jt({transparent:!0,opacity:.25});this.tmpPlane=new et(l,c),this.tmpPlane.name="_tmp_raycast_plane"}this.tmpRaycaster||(this.tmpRaycaster=new Nu),this.tmpVector3||(this.tmpVector3=new U);let r;this.tmpPlane.setRotationFromEuler(this.camera.rotation);let s=this.camera.position;this.tmpPlane.position.set(s.x,s.y,s.z),this.camera.getWorldDirection(this.tmpVector3),this.tmpPlane.position.add(this.tmpVector3.clone().multiplyScalar(n)),this.tmpPlane.updateMatrix(),this.tmpPlane.updateMatrixWorld(!0),this.tmpRaycaster.setFromCamera({x:e,y:t},this.camera);let a=this.tmpRaycaster.intersectObjects([this.tmpPlane]);return((i=a[0])===null||i===void 0?void 0:i.object.name)==="_tmp_raycast_plane"&&(r=a[0].point),r}};var jw=class{static toGeometry(e,t){e.geometry=fo.bufferGeometryToGeometry(e.geometry),t.geometry=fo.bufferGeometryToGeometry(t.geometry)}static toBufferGeometry(e){e.geometry=fo.geometryToBufferGeometry(e.geometry)}static union(e,t){this.toGeometry(e,t);let n=this.doCSG(e,t,"union");return this.toBufferGeometry(n),n}static subtract(e,t){this.toGeometry(e,t);let n=this.doCSG(e,t,"subtract");return this.toBufferGeometry(n),n}static intersect(e,t){this.toGeometry(e,t);let n=this.doCSG(e,t,"intersect");return this.toBufferGeometry(n),n}static doCSG(e,t,n){e.updateMatrix(),t.updateMatrix();let i=ft.fromMesh(e),r=ft.fromMesh(t),s=i[n](r);return ft.toMesh(s,e.matrix)}};var ft=class{constructor(){this.polygons=[]}static fromPolygons(e){let t=new ft;return t.polygons=e,t}static fromGeometry(e){e.isBufferGeometry&&(e=new pr().fromBufferGeometry(e));let t=e.faces,n=e.vertices,i=[],r=["a","b","c"];for(let s=0;s<t.length;s++){let a=t[s],l=[];for(let c=0;c<3;c++){let u=e.faceVertexUvs[0][s]!==void 0&&e.faceVertexUvs[0][s][c]!==void 0?e.faceVertexUvs[0][s][c]:void 0;l.push(new Ff(n[a[r[c]]],a.vertexNormals[c],u))}i.push(new Hu(l))}return ft.fromPolygons(i)}static fromMesh(e){let t=ft.fromGeometry(e.geometry);ft._tmpm3.getNormalMatrix(e.matrix);for(let n of t.polygons)for(let i of n.vertices)i.pos.applyMatrix4(e.matrix),i.normal.applyMatrix3(ft._tmpm3);return t}static toMesh(e,t){let n=new pr,i=e.polygons,r=n.vertices,s=n.faceVertexUvs[0];for(let c of i){let u=c.vertices,d=r.length,h=u.length;for(let f of u)r.push(new U().copy(f.pos));for(let f=3;f<=h;f++){let p=new Xw(d,d+f-2,d+f-1),g=[];s.push(g);let v=p.vertexNormals;v.push(new U().copy(u[0].normal)),v.push(new U().copy(u[f-2].normal)),v.push(new U().copy(u[f-1].normal)),u[0].uv&&u[f-2].uv&&u[f-1].uv&&(g.push(new U().copy(u[0].uv)),g.push(new U().copy(u[f-2].uv)),g.push(new U().copy(u[f-1].uv))),p.normal=new U().copy(c.plane.normal),n.faces.push(p)}}let a=parseInt(Zs)>=123?new Pe().copy(t).invert():new Pe().getInverse(t);n.applyMatrix4(a),n.verticesNeedUpdate=n.elementsNeedUpdate=n.normalsNeedUpdate=!0,n.computeBoundingSphere(),n.computeBoundingBox();let l=new et(n);return l.matrix.copy(t),l.matrix.decompose(l.position,l.rotation,l.scale),l.updateMatrixWorld(),l}static iEval(e,t=0){var n;if(typeof e=="string")ft.currentOp=e;else if(e instanceof Array)for(let i of e)ft.iEval(i,0);else if(typeof e=="object"){let i=ft.currentOp;e.updateMatrix(),e.updateMatrixWorld(),ft.sourceMesh?(ft.nextPrim=ft.fromMesh(e),ft.currentPrim=ft.currentPrim[i](ft.nextPrim)):ft.currentPrim=ft.fromMesh(ft.sourceMesh=e),ft.doRemove&&((n=e==null?void 0:e.parent)===null||n===void 0||n.remove(e))}}static eval(e,t){delete ft.currentOp,delete ft.sourceMesh,ft.doRemove=t,ft.iEval(e);let n=ft.toMesh(ft.currentPrim,ft.sourceMesh.matrix);return n.material=ft.sourceMesh.material,n.castShadow=n.receiveShadow=!0,n}clone(){let e=new ft;return e.polygons=this.polygons.map(t=>t.clone()),e}toPolygons(){return this.polygons}union(e){let t=new jr(this.clone().polygons),n=new jr(e.clone().polygons);return t.clipTo(n),n.clipTo(t),n.invert(),n.clipTo(t),n.invert(),t.build(n.allPolygons()),ft.fromPolygons(t.allPolygons())}subtract(e){let t=new jr(this.clone().polygons),n=new jr(e.clone().polygons);return t.invert(),t.clipTo(n),n.clipTo(t),n.invert(),n.clipTo(t),n.invert(),t.build(n.allPolygons()),t.invert(),ft.fromPolygons(t.allPolygons())}intersect(e){let t=new jr(this.clone().polygons),n=new jr(e.clone().polygons);return t.invert(),n.clipTo(t),n.invert(),t.clipTo(n),n.clipTo(t),t.build(n.allPolygons()),t.invert(),ft.fromPolygons(t.allPolygons())}inverse(){let e=this.clone();return e.polygons.map(t=>{t.flip()}),e}};ft._tmpm3=new vt;var Uu=class extends U{constructor(e,t,n){if(arguments.length===3)super(e,t,n);else if(Array.isArray(e))super(e[0],e[1],e[2]);else if(typeof e=="object")this.copy(e);else throw new Error("Invalid constructor to vector")}clone(){return new Uu(this.x,this.y,this.z)}negated(){return this.clone().multiplyScalar(-1)}plus(e){return this.clone().add(e)}minus(e){return this.clone().sub(e)}times(e){return this.clone().multiplyScalar(e)}dividedBy(e){return this.clone().divideScalar(e)}lerp(e,t){return this.plus(e.minus(this).times(t))}unit(){return this.dividedBy(this.length())}cross(e,t){return U.prototype.cross.call(this.clone(),e)}},Ff=class{constructor(e,t,n){this.pos=new Uu(e.x,e.y,e.z),this.normal=new Uu(t.x,t.y,t.z),n&&(this.uv=new Uu(n.x,n.y,n.z))}clone(){return new Ff(this.pos.clone(),this.normal.clone(),this.uv?this.uv.clone():void 0)}flip(){this.normal=this.normal.negated()}interpolate(e,t){return new Ff(this.pos.lerp(e.pos,t),this.normal.lerp(e.normal,t),this.uv?this.uv.lerp(e.uv,t):void 0)}},xa=class{constructor(e,t){this.normal=e,this.w=t}static fromPoints(e,t,n){let i=t.minus(e).cross(n.minus(e)).unit();return new xa(i,i.dot(e))}clone(){return new xa(this.normal.clone(),this.w)}flip(){this.normal=this.normal.negated(),this.w=-this.w}splitPolygon(e,t,n,i,r){let s=0,a=1,l=2,c=3,u=0,d=[];for(let h of e.vertices){let f=this.normal.dot(h.pos)-this.w,p=f<-xa.EPSILON?l:f>xa.EPSILON?a:s;u|=p,d.push(p)}switch(u){case s:this.normal.dot(e.plane.normal)>0?t.push(e):n.push(e);break;case a:i.push(e);break;case l:r.push(e);break;case c:let h=[],f=[];for(let p=0;p<e.vertices.length;p++){let g=(p+1)%e.vertices.length,v=d[p],y=d[g],m=e.vertices[p],x=e.vertices[g];if(v!==l&&h.push(m),v!==a&&f.push(v!==l?m.clone():m),(v|y)===c){let _=(this.w-this.normal.dot(m.pos))/this.normal.dot(x.pos.minus(m.pos)),w=m.interpolate(x,_);h.push(w),f.push(w.clone())}}h.length>=3&&i.push(new Hu(h,e.shared)),f.length>=3&&r.push(new Hu(f,e.shared));break}}};xa.EPSILON=1e-5;var Hu=class{constructor(e,t=null){this.vertices=e,this.shared=t,this.plane=xa.fromPoints(e[0].pos,e[1].pos,e[2].pos)}clone(){let e=this.vertices.map(t=>t.clone());return new Hu(e,this.shared)}flip(){this.vertices.reverse().map(e=>{e.flip()}),this.plane.flip()}},jr=class{constructor(e){delete this.plane,delete this.front,delete this.back,this.polygons=[],e&&this.build(e)}clone(){let e=new jr;return e.plane=this.plane&&this.plane.clone(),e.front=this.front&&this.front.clone(),e.back=this.back&&this.back.clone(),e.polygons=this.polygons.map(t=>t.clone()),e}invert(){for(let t of this.polygons)t.flip();this.plane.flip(),this.front&&this.front.invert(),this.back&&this.back.invert();let e=this.front;this.front=this.back,this.back=e}clipPolygons(e){if(!this.plane)return e.slice();let t=[],n=[];for(let i of e)this.plane.splitPolygon(i,t,n,t,n);return this.front&&(t=this.front.clipPolygons(t)),n=this.back?this.back.clipPolygons(n):[],t.concat(n)}clipTo(e){this.polygons=e.clipPolygons(this.polygons),this.front&&this.front.clipTo(e),this.back&&this.back.clipTo(e)}allPolygons(){let e=this.polygons.slice();return this.front&&(e=e.concat(this.front.allPolygons())),this.back&&(e=e.concat(this.back.allPolygons())),e}build(e){if(!e.length)return;this.plane||(this.plane=e[0].plane.clone());let t=[],n=[];for(let i of e)this.plane.splitPolygon(i,this.polygons,this.polygons,t,n);t.length&&(this.front||(this.front=new jr),this.front.build(t)),n.length&&(this.back||(this.back=new jr),this.back.build(n))}};var yb={};NT(yb,{AsyncCompress:()=>QG,AsyncDecompress:()=>iV,AsyncDeflate:()=>V2,AsyncGunzip:()=>X2,AsyncGzip:()=>QG,AsyncInflate:()=>ab,AsyncUnzipInflate:()=>pV,AsyncUnzlib:()=>j2,AsyncZipDeflate:()=>cV,AsyncZlib:()=>tV,Compress:()=>cb,DecodeUTF8:()=>oV,Decompress:()=>Z2,Deflate:()=>As,EncodeUTF8:()=>aV,Gunzip:()=>Ry,Gzip:()=>cb,Inflate:()=>Ni,Unzip:()=>mV,UnzipInflate:()=>fV,UnzipPassThrough:()=>iL,Unzlib:()=>Iy,Zip:()=>uV,ZipDeflate:()=>lV,ZipPassThrough:()=>Vf,Zlib:()=>hb,compress:()=>eV,compressSync:()=>ub,decompress:()=>rV,decompressSync:()=>sV,deflate:()=>W2,deflateSync:()=>Hf,gunzip:()=>q2,gunzipSync:()=>Py,gzip:()=>eV,gzipSync:()=>ub,inflate:()=>lb,inflateSync:()=>$u,strFromU8:()=>mb,strToU8:()=>wa,unzip:()=>gV,unzipSync:()=>yV,unzlib:()=>Y2,unzlibSync:()=>Gf,zip:()=>hV,zipSync:()=>dV,zlib:()=>nV,zlibSync:()=>db});var b2={},Yw=function(o){return URL.createObjectURL(new Blob([o],{type:"text/javascript"}))},M2=function(o){return new Worker(o)};try{URL.revokeObjectURL(Yw(""))}catch(o){Yw=function(e){return"data:application/javascript;charset=UTF-8,"+encodeURI(e)},M2=function(e){return new Worker(e,{type:"module"})}}var KG=function(o,e,t,n,i){var r=M2(b2[e]||(b2[e]=Yw(o)));return r.onerror=function(s){return i(s.error,null)},r.onmessage=function(s){return i(null,s.data)},r.postMessage(t,n),r},pt=Uint8Array,Bn=Uint16Array,po=Uint32Array,Gu=new pt([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),Vu=new pt([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),Bf=new pt([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),S2=function(o,e){for(var t=new Bn(31),n=0;n<31;++n)t[n]=e+=1<<o[n-1];for(var i=new po(t[30]),n=1;n<30;++n)for(var r=t[n];r<t[n+1];++r)i[r]=r-t[n]<<5|n;return[t,i]},T2=S2(Gu,2),Zw=T2[0],Sy=T2[1];Zw[28]=258,Sy[258]=28;var E2=S2(Vu,0),A2=E2[0],Jw=E2[1],Nf=new Bn(32768);for(Mt=0;Mt<32768;++Mt)mo=(Mt&43690)>>>1|(Mt&21845)<<1,mo=(mo&52428)>>>2|(mo&13107)<<2,mo=(mo&61680)>>>4|(mo&3855)<<4,Nf[Mt]=((mo&65280)>>>8|(mo&255)<<8)>>>1;var mo,Mt,mr=function(o,e,t){for(var n=o.length,i=0,r=new Bn(e);i<n;++i)++r[o[i]-1];var s=new Bn(e);for(i=0;i<e;++i)s[i]=s[i-1]+r[i-1]<<1;var a;if(t){a=new Bn(1<<e);var l=15-e;for(i=0;i<n;++i)if(o[i])for(var c=i<<4|o[i],u=e-o[i],d=s[o[i]-1]++<<u,h=d|(1<<u)-1;d<=h;++d)a[Nf[d]>>>l]=c}else for(a=new Bn(n),i=0;i<n;++i)o[i]&&(a[i]=Nf[s[o[i]-1]++]>>>15-o[i]);return a},go=new pt(288);for(Mt=0;Mt<144;++Mt)go[Mt]=8;var Mt;for(Mt=144;Mt<256;++Mt)go[Mt]=9;var Mt;for(Mt=256;Mt<280;++Mt)go[Mt]=7;var Mt;for(Mt=280;Mt<288;++Mt)go[Mt]=8;var Mt,Wu=new pt(32);for(Mt=0;Mt<32;++Mt)Wu[Mt]=5;var Mt,C2=mr(go,9,0),L2=mr(go,9,1),R2=mr(Wu,5,0),P2=mr(Wu,5,1),Ty=function(o){for(var e=o[0],t=1;t<o.length;++t)o[t]>e&&(e=o[t]);return e},gr=function(o,e,t){var n=e/8|0;return(o[n]|o[n+1]<<8)>>(e&7)&t},Ey=function(o,e){var t=e/8|0;return(o[t]|o[t+1]<<8|o[t+2]<<16)>>(e&7)},Of=function(o){return(o/8|0)+(o&7&&1)},yr=function(o,e,t){(e==null||e<0)&&(e=0),(t==null||t>o.length)&&(t=o.length);var n=new(o instanceof Bn?Bn:o instanceof po?po:pt)(t-e);return n.set(o.subarray(e,t)),n},kf=function(o,e,t){var n=o.length;if(!n||t&&!t.l&&n<5)return e||new pt(0);var i=!e||t,r=!t||t.i;t||(t={}),e||(e=new pt(n*3));var s=function(V){var ie=e.length;if(V>ie){var ue=new pt(Math.max(ie*2,V));ue.set(e),e=ue}},a=t.f||0,l=t.p||0,c=t.b||0,u=t.l,d=t.d,h=t.m,f=t.n,p=n*8;do{if(!u){t.f=a=gr(o,l,1);var g=gr(o,l+1,3);if(l+=3,g)if(g==1)u=L2,d=P2,h=9,f=5;else if(g==2){var x=gr(o,l,31)+257,_=gr(o,l+10,15)+4,w=x+gr(o,l+5,31)+1;l+=14;for(var b=new pt(w),M=new pt(19),S=0;S<_;++S)M[Bf[S]]=gr(o,l+S*3,7);l+=_*3;for(var E=Ty(M),A=(1<<E)-1,L=mr(M,E,1),S=0;S<w;){var B=L[gr(o,l,A)];l+=B&15;var v=B>>>4;if(v<16)b[S++]=v;else{var R=0,D=0;for(v==16?(D=3+gr(o,l,3),l+=2,R=b[S-1]):v==17?(D=3+gr(o,l,7),l+=3):v==18&&(D=11+gr(o,l,127),l+=7);D--;)b[S++]=R}}var P=b.subarray(0,x),I=b.subarray(x);h=Ty(P),f=Ty(I),u=mr(P,h,1),d=mr(I,f,1)}else throw"invalid block type";else{var v=Of(l)+4,y=o[v-4]|o[v-3]<<8,m=v+y;if(m>n){if(r)throw"unexpected EOF";break}i&&s(c+y),e.set(o.subarray(v,m),c),t.b=c+=y,t.p=l=m*8;continue}if(l>p){if(r)throw"unexpected EOF";break}}i&&s(c+131072);for(var N=(1<<h)-1,G=(1<<f)-1,z=l;;z=l){var R=u[Ey(o,l)&N],se=R>>>4;if(l+=R&15,l>p){if(r)throw"unexpected EOF";break}if(!R)throw"invalid length/literal";if(se<256)e[c++]=se;else if(se==256){z=l,u=null;break}else{var ne=se-254;if(se>264){var S=se-257,Q=Gu[S];ne=gr(o,l,(1<<Q)-1)+Zw[S],l+=Q}var j=d[Ey(o,l)&G],O=j>>>4;if(!j)throw"invalid distance";l+=j&15;var I=A2[O];if(O>3){var Q=Vu[O];I+=Ey(o,l)&(1<<Q)-1,l+=Q}if(l>p){if(r)throw"unexpected EOF";break}i&&s(c+131072);for(var ee=c+ne;c<ee;c+=4)e[c]=e[c-I],e[c+1]=e[c+1-I],e[c+2]=e[c+2-I],e[c+3]=e[c+3-I];c=ee}}t.l=u,t.p=z,t.b=c,u&&(a=1,t.m=h,t.d=d,t.n=f)}while(!a);return c==e.length?e:yr(e,0,c)},Es=function(o,e,t){t<<=e&7;var n=e/8|0;o[n]|=t,o[n+1]|=t>>>8},Xu=function(o,e,t){t<<=e&7;var n=e/8|0;o[n]|=t,o[n+1]|=t>>>8,o[n+2]|=t>>>16},Ay=function(o,e){for(var t=[],n=0;n<o.length;++n)o[n]&&t.push({s:n,f:o[n]});var i=t.length,r=t.slice();if(!i)return[yo,0];if(i==1){var s=new pt(t[0].s+1);return s[t[0].s]=1,[s,1]}t.sort(function(w,b){return w.f-b.f}),t.push({s:-1,f:25001});var a=t[0],l=t[1],c=0,u=1,d=2;for(t[0]={s:-1,f:a.f+l.f,l:a,r:l};u!=i-1;)a=t[t[c].f<t[d].f?c++:d++],l=t[c!=u&&t[c].f<t[d].f?c++:d++],t[u++]={s:-1,f:a.f+l.f,l:a,r:l};for(var h=r[0].s,n=1;n<i;++n)r[n].s>h&&(h=r[n].s);var f=new Bn(h+1),p=Cy(t[u-1],f,0);if(p>e){var n=0,g=0,v=p-e,y=1<<v;for(r.sort(function(b,M){return f[M.s]-f[b.s]||b.f-M.f});n<i;++n){var m=r[n].s;if(f[m]>e)g+=y-(1<<p-f[m]),f[m]=e;else break}for(g>>>=v;g>0;){var x=r[n].s;f[x]<e?g-=1<<e-f[x]++-1:++n}for(;n>=0&&g;--n){var _=r[n].s;f[_]==e&&(--f[_],++g)}p=e}return[new pt(f),p]},Cy=function(o,e,t){return o.s==-1?Math.max(Cy(o.l,e,t+1),Cy(o.r,e,t+1)):e[o.s]=t},Kw=function(o){for(var e=o.length;e&&!o[--e];);for(var t=new Bn(++e),n=0,i=o[0],r=1,s=function(l){t[n++]=l},a=1;a<=e;++a)if(o[a]==i&&a!=e)++r;else{if(!i&&r>2){for(;r>138;r-=138)s(32754);r>2&&(s(r>10?r-11<<5|28690:r-3<<5|12305),r=0)}else if(r>3){for(s(i),--r;r>6;r-=6)s(8304);r>2&&(s(r-3<<5|8208),r=0)}for(;r--;)s(i);r=1,i=o[a]}return[t.subarray(0,n),e]},qu=function(o,e){for(var t=0,n=0;n<e.length;++n)t+=o[n]*e[n];return t},zf=function(o,e,t){var n=t.length,i=Of(e+2);o[i]=n&255,o[i+1]=n>>>8,o[i+2]=o[i]^255,o[i+3]=o[i+1]^255;for(var r=0;r<n;++r)o[i+r+4]=t[r];return(i+4+n)*8},$w=function(o,e,t,n,i,r,s,a,l,c,u){Es(e,u++,t),++i[256];for(var d=Ay(i,15),h=d[0],f=d[1],p=Ay(r,15),g=p[0],v=p[1],y=Kw(h),m=y[0],x=y[1],_=Kw(g),w=_[0],b=_[1],M=new Bn(19),S=0;S<m.length;++S)M[m[S]&31]++;for(var S=0;S<w.length;++S)M[w[S]&31]++;for(var E=Ay(M,7),A=E[0],L=E[1],B=19;B>4&&!A[Bf[B-1]];--B);var R=c+5<<3,D=qu(i,go)+qu(r,Wu)+s,P=qu(i,h)+qu(r,g)+s+14+3*B+qu(M,A)+(2*M[16]+3*M[17]+7*M[18]);if(R<=D&&R<=P)return zf(e,u,o.subarray(l,l+c));var I,N,G,z;if(Es(e,u,1+(P<D)),u+=2,P<D){I=mr(h,f,0),N=h,G=mr(g,v,0),z=g;var se=mr(A,L,0);Es(e,u,x-257),Es(e,u+5,b-1),Es(e,u+10,B-4),u+=14;for(var S=0;S<B;++S)Es(e,u+3*S,A[Bf[S]]);u+=3*B;for(var ne=[m,w],Q=0;Q<2;++Q)for(var j=ne[Q],S=0;S<j.length;++S){var O=j[S]&31;Es(e,u,se[O]),u+=A[O],O>15&&(Es(e,u,j[S]>>>5&127),u+=j[S]>>>12)}}else I=C2,N=go,G=R2,z=Wu;for(var S=0;S<a;++S)if(n[S]>255){var O=n[S]>>>18&31;Xu(e,u,I[O+257]),u+=N[O+257],O>7&&(Es(e,u,n[S]>>>23&31),u+=Gu[O]);var ee=n[S]&31;Xu(e,u,G[ee]),u+=z[ee],ee>3&&(Xu(e,u,n[S]>>>5&8191),u+=Vu[ee])}else Xu(e,u,I[n[S]]),u+=N[n[S]];return Xu(e,u,I[256]),u+N[256]},I2=new po([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),yo=new pt(0),D2=function(o,e,t,n,i,r){var s=o.length,a=new pt(n+s+5*(1+Math.ceil(s/7e3))+i),l=a.subarray(n,a.length-i),c=0;if(!e||s<8)for(var u=0;u<=s;u+=65535){var d=u+65535;d<s?c=zf(l,c,o.subarray(u,d)):(l[u]=r,c=zf(l,c,o.subarray(u,s)))}else{for(var h=I2[e-1],f=h>>>13,p=h&8191,g=(1<<t)-1,v=new Bn(32768),y=new Bn(g+1),m=Math.ceil(t/3),x=2*m,_=function(J){return(o[J]^o[J+1]<<m^o[J+2]<<x)&g},w=new po(25e3),b=new Bn(288),M=new Bn(32),S=0,E=0,u=0,A=0,L=0,B=0;u<s;++u){var R=_(u),D=u&32767,P=y[R];if(v[D]=P,y[R]=D,L<=u){var I=s-u;if((S>7e3||A>24576)&&I>423){c=$w(o,l,0,w,b,M,E,A,B,u-B,c),A=S=E=0,B=u;for(var N=0;N<286;++N)b[N]=0;for(var N=0;N<30;++N)M[N]=0}var G=2,z=0,se=p,ne=D-P&32767;if(I>2&&R==_(u-ne))for(var Q=Math.min(f,I)-1,j=Math.min(32767,u),O=Math.min(258,I);ne<=j&&--se&&D!=P;){if(o[u+G]==o[u+G-ne]){for(var ee=0;ee<O&&o[u+ee]==o[u+ee-ne];++ee);if(ee>G){if(G=ee,z=ne,ee>Q)break;for(var V=Math.min(ne,ee-2),ie=0,N=0;N<V;++N){var ue=u-ne+N+32768&32767,ye=v[ue],pe=ue-ye+32768&32767;pe>ie&&(ie=pe,P=ue)}}}D=P,P=v[D],ne+=D-P+32768&32767}if(z){w[A++]=268435456|Sy[G]<<18|Jw[z];var xe=Sy[G]&31,X=Jw[z]&31;E+=Gu[xe]+Vu[X],++b[257+xe],++M[X],L=u+G,++S}else w[A++]=o[u],++b[o[u]]}}c=$w(o,l,r,w,b,M,E,A,B,u-B,c),!r&&c&7&&(c=zf(l,c+1,yo))}return yr(a,0,n+Of(c)+i)},F2=function(){for(var o=new po(256),e=0;e<256;++e){for(var t=e,n=9;--n;)t=(t&1&&3988292384)^t>>>1;o[e]=t}return o}(),ju=function(){var o=-1;return{p:function(e){for(var t=o,n=0;n<e.length;++n)t=F2[t&255^e[n]]^t>>>8;o=t},d:function(){return~o}}},Qw=function(){var o=1,e=0;return{p:function(t){for(var n=o,i=e,r=t.length,s=0;s!=r;){for(var a=Math.min(s+2655,r);s<a;++s)i+=n+=t[s];n=(n&65535)+15*(n>>16),i=(i&65535)+15*(i>>16)}o=n,e=i},d:function(){return o%=65521,e%=65521,(o&255)<<24|o>>>8<<16|(e&255)<<8|e>>>8}}},ql=function(o,e,t,n,i){return D2(o,e.level==null?6:e.level,e.mem==null?Math.ceil(Math.max(8,Math.min(13,Math.log(o.length)))*1.5):12+e.mem,t,n,!i)},Uf=function(o,e){var t={};for(var n in o)t[n]=o[n];for(var n in e)t[n]=e[n];return t},B2=function(o,e,t){for(var n=o(),i=o.toString(),r=i.slice(i.indexOf("[")+1,i.lastIndexOf("]")).replace(/ /g,"").split(","),s=0;s<n.length;++s){var a=n[s],l=r[s];if(typeof a=="function"){e+=";"+l+"=";var c=a.toString();if(a.prototype)if(c.indexOf("[native code]")!=-1){var u=c.indexOf(" ",8)+1;e+=c.slice(u,c.indexOf("(",u))}else{e+=c;for(var d in a.prototype)e+=";"+l+".prototype."+d+"="+a.prototype[d].toString()}else e+=c}else t[l]=a}return[e,t]},Ly=[],$G=function(o){var e=[];for(var t in o)(o[t]instanceof pt||o[t]instanceof Bn||o[t]instanceof po)&&e.push((o[t]=new o[t].constructor(o[t])).buffer);return e},N2=function(o,e,t,n){var i;if(!Ly[t]){for(var r="",s={},a=o.length-1,l=0;l<a;++l)i=B2(o[l],r,s),r=i[0],s=i[1];Ly[t]=B2(o[a],r,s)}var c=Uf({},Ly[t][1]);return KG(Ly[t][0]+";onmessage=function(e){for(var k in e.data)self[k]=e.data[k];onmessage="+e.toString()+"}",t,c,$G(c),n)},Yu=function(){return[pt,Bn,po,Gu,Vu,Bf,Zw,A2,L2,P2,Nf,mr,Ty,gr,Ey,Of,yr,kf,$u,_a,eb]},Zu=function(){return[pt,Bn,po,Gu,Vu,Bf,Sy,Jw,C2,go,R2,Wu,Nf,I2,yo,mr,Es,Xu,Ay,Cy,Kw,qu,zf,$w,Of,yr,D2,ql,Hf,_a]},O2=function(){return[nb,rb,Pt,ju,F2]},k2=function(){return[ib,H2]},z2=function(){return[sb,Pt,Qw]},U2=function(){return[G2]},_a=function(o){return postMessage(o,[o.buffer])},eb=function(o){return o&&o.size&&new pt(o.size)},Ju=function(o,e,t,n,i,r){var s=N2(t,n,i,function(a,l){s.terminate(),r(a,l)});return s.postMessage([o,e],e.consume?[o.buffer]:[]),function(){s.terminate()}},vr=function(o){return o.ondata=function(e,t){return postMessage([e,t],[e.buffer])},function(e){return o.push(e.data[0],e.data[1])}},Ku=function(o,e,t,n,i){var r,s=N2(o,n,i,function(a,l){a?(s.terminate(),e.ondata.call(e,a)):(l[1]&&s.terminate(),e.ondata.call(e,a,l[0],l[1]))});s.postMessage(t),e.push=function(a,l){if(r)throw"stream finished";if(!e.ondata)throw"no stream handler";s.postMessage([a,r=l],[a.buffer])},e.terminate=function(){s.terminate()}},Si=function(o,e){return o[e]|o[e+1]<<8},yn=function(o,e){return(o[e]|o[e+1]<<8|o[e+2]<<16|o[e+3]<<24)>>>0},tb=function(o,e){return yn(o,e)+yn(o,e+4)*4294967296},Pt=function(o,e,t){for(;t;++e)o[e]=t,t>>>=8},nb=function(o,e){var t=e.filename;if(o[0]=31,o[1]=139,o[2]=8,o[8]=e.level<2?4:e.level==9?2:0,o[9]=3,e.mtime!=0&&Pt(o,4,Math.floor(new Date(e.mtime||Date.now())/1e3)),t){o[3]=8;for(var n=0;n<=t.length;++n)o[n+10]=t.charCodeAt(n)}},ib=function(o){if(o[0]!=31||o[1]!=139||o[2]!=8)throw"invalid gzip data";var e=o[3],t=10;e&4&&(t+=o[10]|(o[11]<<8)+2);for(var n=(e>>3&1)+(e>>4&1);n>0;n-=!o[t++]);return t+(e&2)},H2=function(o){var e=o.length;return(o[e-4]|o[e-3]<<8|o[e-2]<<16|o[e-1]<<24)>>>0},rb=function(o){return 10+(o.filename&&o.filename.length+1||0)},sb=function(o,e){var t=e.level,n=t==0?0:t<6?1:t==9?3:2;o[0]=120,o[1]=n<<6|(n?32-2*n:1)},G2=function(o){if((o[0]&15)!=8||o[0]>>>4>7||(o[0]<<8|o[1])%31)throw"invalid zlib data";if(o[1]&32)throw"invalid zlib data: preset dictionaries not supported"};function ob(o,e){return!e&&typeof o=="function"&&(e=o,o={}),this.ondata=e,o}var As=function(){function o(e,t){!t&&typeof e=="function"&&(t=e,e={}),this.ondata=t,this.o=e||{}}return o.prototype.p=function(e,t){this.ondata(ql(e,this.o,0,0,!t),t)},o.prototype.push=function(e,t){if(this.d)throw"stream finished";if(!this.ondata)throw"no stream handler";this.d=t,this.p(e,t||!1)},o}();var V2=function(){function o(e,t){Ku([Zu,function(){return[vr,As]}],this,ob.call(this,e,t),function(n){var i=new As(n.data);onmessage=vr(i)},6)}return o}();function W2(o,e,t){if(t||(t=e,e={}),typeof t!="function")throw"no callback";return Ju(o,e,[Zu],function(n){return _a(Hf(n.data[0],n.data[1]))},0,t)}function Hf(o,e){return ql(o,e||{},0,0)}var Ni=function(){function o(e){this.s={},this.p=new pt(0),this.ondata=e}return o.prototype.e=function(e){if(this.d)throw"stream finished";if(!this.ondata)throw"no stream handler";var t=this.p.length,n=new pt(t+e.length);n.set(this.p),n.set(e,t),this.p=n},o.prototype.c=function(e){this.d=this.s.i=e||!1;var t=this.s.b,n=kf(this.p,this.o,this.s);this.ondata(yr(n,t,this.s.b),this.d),this.o=yr(n,this.s.b-32768),this.s.b=this.o.length,this.p=yr(this.p,this.s.p/8|0),this.s.p&=7},o.prototype.push=function(e,t){this.e(e),this.c(t)},o}();var ab=function(){function o(e){this.ondata=e,Ku([Yu,function(){return[vr,Ni]}],this,0,function(){var t=new Ni;onmessage=vr(t)},7)}return o}();function lb(o,e,t){if(t||(t=e,e={}),typeof t!="function")throw"no callback";return Ju(o,e,[Yu],function(n){return _a($u(n.data[0],eb(n.data[1])))},1,t)}function $u(o,e){return kf(o,e)}var cb=function(){function o(e,t){this.c=ju(),this.l=0,this.v=1,As.call(this,e,t)}return o.prototype.push=function(e,t){As.prototype.push.call(this,e,t)},o.prototype.p=function(e,t){this.c.p(e),this.l+=e.length;var n=ql(e,this.o,this.v&&rb(this.o),t&&8,!t);this.v&&(nb(n,this.o),this.v=0),t&&(Pt(n,n.length-8,this.c.d()),Pt(n,n.length-4,this.l)),this.ondata(n,t)},o}();var QG=function(){function o(e,t){Ku([Zu,O2,function(){return[vr,As,cb]}],this,ob.call(this,e,t),function(n){var i=new cb(n.data);onmessage=vr(i)},8)}return o}();function eV(o,e,t){if(t||(t=e,e={}),typeof t!="function")throw"no callback";return Ju(o,e,[Zu,O2,function(){return[ub]}],function(n){return _a(ub(n.data[0],n.data[1]))},2,t)}function ub(o,e){e||(e={});var t=ju(),n=o.length;t.p(o);var i=ql(o,e,rb(e),8),r=i.length;return nb(i,e),Pt(i,r-8,t.d()),Pt(i,r-4,n),i}var Ry=function(){function o(e){this.v=1,Ni.call(this,e)}return o.prototype.push=function(e,t){if(Ni.prototype.e.call(this,e),this.v){var n=this.p.length>3?ib(this.p):4;if(n>=this.p.length&&!t)return;this.p=this.p.subarray(n),this.v=0}if(t){if(this.p.length<8)throw"invalid gzip stream";this.p=this.p.subarray(0,-8)}Ni.prototype.c.call(this,t)},o}();var X2=function(){function o(e){this.ondata=e,Ku([Yu,k2,function(){return[vr,Ni,Ry]}],this,0,function(){var t=new Ry;onmessage=vr(t)},9)}return o}();function q2(o,e,t){if(t||(t=e,e={}),typeof t!="function")throw"no callback";return Ju(o,e,[Yu,k2,function(){return[Py]}],function(n){return _a(Py(n.data[0]))},3,t)}function Py(o,e){return kf(o.subarray(ib(o),-8),e||new pt(H2(o)))}var hb=function(){function o(e,t){this.c=Qw(),this.v=1,As.call(this,e,t)}return o.prototype.push=function(e,t){As.prototype.push.call(this,e,t)},o.prototype.p=function(e,t){this.c.p(e);var n=ql(e,this.o,this.v&&2,t&&4,!t);this.v&&(sb(n,this.o),this.v=0),t&&Pt(n,n.length-4,this.c.d()),this.ondata(n,t)},o}();var tV=function(){function o(e,t){Ku([Zu,z2,function(){return[vr,As,hb]}],this,ob.call(this,e,t),function(n){var i=new hb(n.data);onmessage=vr(i)},10)}return o}();function nV(o,e,t){if(t||(t=e,e={}),typeof t!="function")throw"no callback";return Ju(o,e,[Zu,z2,function(){return[db]}],function(n){return _a(db(n.data[0],n.data[1]))},4,t)}function db(o,e){e||(e={});var t=Qw();t.p(o);var n=ql(o,e,2,4);return sb(n,e),Pt(n,n.length-4,t.d()),n}var Iy=function(){function o(e){this.v=1,Ni.call(this,e)}return o.prototype.push=function(e,t){if(Ni.prototype.e.call(this,e),this.v){if(this.p.length<2&&!t)return;this.p=this.p.subarray(2),this.v=0}if(t){if(this.p.length<4)throw"invalid zlib stream";this.p=this.p.subarray(0,-4)}Ni.prototype.c.call(this,t)},o}();var j2=function(){function o(e){this.ondata=e,Ku([Yu,U2,function(){return[vr,Ni,Iy]}],this,0,function(){var t=new Iy;onmessage=vr(t)},11)}return o}();function Y2(o,e,t){if(t||(t=e,e={}),typeof t!="function")throw"no callback";return Ju(o,e,[Yu,U2,function(){return[Gf]}],function(n){return _a(Gf(n.data[0],eb(n.data[1])))},5,t)}function Gf(o,e){return kf((G2(o),o.subarray(2,-4)),e)}var Z2=function(){function o(e){this.G=Ry,this.I=Ni,this.Z=Iy,this.ondata=e}return o.prototype.push=function(e,t){if(!this.ondata)throw"no stream handler";if(this.s)this.s.push(e,t);else{if(this.p&&this.p.length){var n=new pt(this.p.length+e.length);n.set(this.p),n.set(e,this.p.length)}else this.p=e;if(this.p.length>2){var i=this,r=function(){i.ondata.apply(i,arguments)};this.s=this.p[0]==31&&this.p[1]==139&&this.p[2]==8?new this.G(r):(this.p[0]&15)!=8||this.p[0]>>4>7||(this.p[0]<<8|this.p[1])%31?new this.I(r):new this.Z(r),this.s.push(this.p,t),this.p=null}}},o}();var iV=function(){function o(e){this.G=X2,this.I=ab,this.Z=j2,this.ondata=e}return o.prototype.push=function(e,t){Z2.prototype.push.call(this,e,t)},o}();function rV(o,e,t){if(t||(t=e,e={}),typeof t!="function")throw"no callback";return o[0]==31&&o[1]==139&&o[2]==8?q2(o,e,t):(o[0]&15)!=8||o[0]>>4>7||(o[0]<<8|o[1])%31?lb(o,e,t):Y2(o,e,t)}function sV(o,e){return o[0]==31&&o[1]==139&&o[2]==8?Py(o,e):(o[0]&15)!=8||o[0]>>4>7||(o[0]<<8|o[1])%31?$u(o,e):Gf(o,e)}var fb=function(o,e,t,n){for(var i in o){var r=o[i],s=e+i;r instanceof pt?t[s]=[r,n]:Array.isArray(r)?t[s]=[r[0],Uf(n,r[1])]:fb(r,s+"/",t,n)}},J2=typeof TextEncoder!="undefined"&&new TextEncoder,pb=typeof TextDecoder!="undefined"&&new TextDecoder,K2=0;try{pb.decode(yo,{stream:!0}),K2=1}catch(o){}var $2=function(o){for(var e="",t=0;;){var n=o[t++],i=(n>127)+(n>223)+(n>239);if(t+i>o.length)return[e,yr(o,t-1)];i?i==3?(n=((n&15)<<18|(o[t++]&63)<<12|(o[t++]&63)<<6|o[t++]&63)-65536,e+=String.fromCharCode(55296|n>>10,56320|n&1023)):i&1?e+=String.fromCharCode((n&31)<<6|o[t++]&63):e+=String.fromCharCode((n&15)<<12|(o[t++]&63)<<6|o[t++]&63):e+=String.fromCharCode(n)}},oV=function(){function o(e){this.ondata=e,K2?this.t=new TextDecoder:this.p=yo}return o.prototype.push=function(e,t){if(!this.ondata)throw"no callback";if(t=!!t,this.t){if(this.ondata(this.t.decode(e,{stream:!0}),t),t){if(this.t.decode().length)throw"invalid utf-8 data";this.t=null}return}if(!this.p)throw"stream finished";var n=new pt(this.p.length+e.length);n.set(this.p),n.set(e,this.p.length);var i=$2(n),r=i[0],s=i[1];if(t){if(s.length)throw"invalid utf-8 data";this.p=null}else this.p=s;this.ondata(r,t)},o}();var aV=function(){function o(e){this.ondata=e}return o.prototype.push=function(e,t){if(!this.ondata)throw"no callback";if(this.d)throw"stream finished";this.ondata(wa(e),this.d=t||!1)},o}();function wa(o,e){if(e){for(var t=new pt(o.length),n=0;n<o.length;++n)t[n]=o.charCodeAt(n);return t}if(J2)return J2.encode(o);for(var i=o.length,r=new pt(o.length+(o.length>>1)),s=0,a=function(u){r[s++]=u},n=0;n<i;++n){if(s+5>r.length){var l=new pt(s+8+(i-n<<1));l.set(r),r=l}var c=o.charCodeAt(n);c<128||e?a(c):c<2048?(a(192|c>>6),a(128|c&63)):c>55295&&c<57344?(c=65536+(c&1023<<10)|o.charCodeAt(++n)&1023,a(240|c>>18),a(128|c>>12&63),a(128|c>>6&63),a(128|c&63)):(a(224|c>>12),a(128|c>>6&63),a(128|c&63))}return yr(r,0,s)}function mb(o,e){if(e){for(var t="",n=0;n<o.length;n+=16384)t+=String.fromCharCode.apply(null,o.subarray(n,n+16384));return t}else{if(pb)return pb.decode(o);var i=$2(o),r=i[0],s=i[1];if(s.length)throw"invalid utf-8 data";return r}}var Q2=function(o){return o==1?3:o<6?2:o==9?1:0},eL=function(o,e){return e+30+Si(o,e+26)+Si(o,e+28)},tL=function(o,e,t){var n=Si(o,e+28),i=mb(o.subarray(e+46,e+46+n),!(Si(o,e+8)&2048)),r=e+46+n,s=yn(o,e+20),a=t&&s==4294967295?nL(o,r):[s,yn(o,e+24),yn(o,e+42)],l=a[0],c=a[1],u=a[2];return[Si(o,e+10),l,c,i,r+Si(o,e+30)+Si(o,e+32),u]},nL=function(o,e){for(;Si(o,e)!=1;e+=4+Si(o,e+2));return[tb(o,e+12),tb(o,e+4),tb(o,e+20)]},ba=function(o){var e=0;if(o)for(var t in o){var n=o[t].length;if(n>65535)throw"extra field too long";e+=n+4}return e},Qu=function(o,e,t,n,i,r,s,a){var l=n.length,c=t.extra,u=a&&a.length,d=ba(c);Pt(o,e,s!=null?33639248:67324752),e+=4,s!=null&&(o[e++]=20,o[e++]=t.os),o[e]=20,e+=2,o[e++]=t.flag<<1|(r==null&&8),o[e++]=i&&8,o[e++]=t.compression&255,o[e++]=t.compression>>8;var h=new Date(t.mtime==null?Date.now():t.mtime),f=h.getFullYear()-1980;if(f<0||f>119)throw"date not in range 1980-2099";if(Pt(o,e,f<<25|h.getMonth()+1<<21|h.getDate()<<16|h.getHours()<<11|h.getMinutes()<<5|h.getSeconds()>>>1),e+=4,r!=null&&(Pt(o,e,t.crc),Pt(o,e+4,r),Pt(o,e+8,t.size)),Pt(o,e+12,l),Pt(o,e+14,d),e+=16,s!=null&&(Pt(o,e,u),Pt(o,e+6,t.attrs),Pt(o,e+10,s),e+=14),o.set(n,e),e+=l,d)for(var p in c){var g=c[p],v=g.length;Pt(o,e,+p),Pt(o,e+2,v),o.set(g,e+4),e+=4+v}return u&&(o.set(a,e),e+=u),e},gb=function(o,e,t,n,i){Pt(o,e,101010256),Pt(o,e+8,t),Pt(o,e+10,t),Pt(o,e+12,n),Pt(o,e+16,i)},Vf=function(){function o(e){this.filename=e,this.c=ju(),this.size=0,this.compression=0}return o.prototype.process=function(e,t){this.ondata(null,e,t)},o.prototype.push=function(e,t){if(!this.ondata)throw"no callback - add to ZIP archive before pushing";this.c.p(e),this.size+=e.length,t&&(this.crc=this.c.d()),this.process(e,t||!1)},o}();var lV=function(){function o(e,t){var n=this;t||(t={}),Vf.call(this,e),this.d=new As(t,function(i,r){n.ondata(null,i,r)}),this.compression=8,this.flag=Q2(t.level)}return o.prototype.process=function(e,t){try{this.d.push(e,t)}catch(n){this.ondata(n,null,t)}},o.prototype.push=function(e,t){Vf.prototype.push.call(this,e,t)},o}();var cV=function(){function o(e,t){var n=this;t||(t={}),Vf.call(this,e),this.d=new V2(t,function(i,r,s){n.ondata(i,r,s)}),this.compression=8,this.flag=Q2(t.level),this.terminate=this.d.terminate}return o.prototype.process=function(e,t){this.d.push(e,t)},o.prototype.push=function(e,t){Vf.prototype.push.call(this,e,t)},o}();var uV=function(){function o(e){this.ondata=e,this.u=[],this.d=1}return o.prototype.add=function(e){var t=this;if(this.d&2)throw"stream finished";var n=wa(e.filename),i=n.length,r=e.comment,s=r&&wa(r),a=i!=e.filename.length||s&&r.length!=s.length,l=i+ba(e.extra)+30;if(i>65535)throw"filename too long";var c=new pt(l);Qu(c,0,e,n,a);var u=[c],d=function(){for(var v=0,y=u;v<y.length;v++){var m=y[v];t.ondata(null,m,!1)}u=[]},h=this.d;this.d=0;var f=this.u.length,p=Uf(e,{f:n,u:a,o:s,t:function(){e.terminate&&e.terminate()},r:function(){if(d(),h){var v=t.u[f+1];v?v.r():t.d=1}h=1}}),g=0;e.ondata=function(v,y,m){if(v)t.ondata(v,y,m),t.terminate();else if(g+=y.length,u.push(y),m){var x=new pt(16);Pt(x,0,134695760),Pt(x,4,e.crc),Pt(x,8,g),Pt(x,12,e.size),u.push(x),p.c=g,p.b=l+g+16,p.crc=e.crc,p.size=e.size,h&&p.r(),h=1}else h&&d()},this.u.push(p)},o.prototype.end=function(){var e=this;if(this.d&2)throw this.d&1?"stream finishing":"stream finished";this.d?this.e():this.u.push({r:function(){!(e.d&1)||(e.u.splice(-1,1),e.e())},t:function(){}}),this.d=3},o.prototype.e=function(){for(var e=0,t=0,n=0,i=0,r=this.u;i<r.length;i++){var s=r[i];n+=46+s.f.length+ba(s.extra)+(s.o?s.o.length:0)}for(var a=new pt(n+22),l=0,c=this.u;l<c.length;l++){var s=c[l];Qu(a,e,s,s.f,s.u,s.c,t,s.o),e+=46+s.f.length+ba(s.extra)+(s.o?s.o.length:0),t+=s.b}gb(a,e,this.u.length,n,t),this.ondata(null,a,!0),this.d=2},o.prototype.terminate=function(){for(var e=0,t=this.u;e<t.length;e++){var n=t[e];n.t()}this.d=2},o}();function hV(o,e,t){if(t||(t=e,e={}),typeof t!="function")throw"no callback";var n={};fb(o,"",n,e);var i=Object.keys(n),r=i.length,s=0,a=0,l=r,c=new Array(r),u=[],d=function(){for(var g=0;g<u.length;++g)u[g]()},h=function(){var g=new pt(a+22),v=s,y=a-s;a=0;for(var m=0;m<l;++m){var x=c[m];try{var _=x.c.length;Qu(g,a,x,x.f,x.u,_);var w=30+x.f.length+ba(x.extra),b=a+w;g.set(x.c,b),Qu(g,s,x,x.f,x.u,_,a,x.m),s+=16+w+(x.m?x.m.length:0),a=b+_}catch(M){return t(M,null)}}gb(g,s,c.length,y,v),t(null,g)};r||h();for(var f=function(g){var v=i[g],y=n[v],m=y[0],x=y[1],_=ju(),w=m.length;_.p(m);var b=wa(v),M=b.length,S=x.comment,E=S&&wa(S),A=E&&E.length,L=ba(x.extra),B=x.level==0?0:8,R=function(D,P){if(D)d(),t(D,null);else{var I=P.length;c[g]=Uf(x,{size:w,crc:_.d(),c:P,f:b,m:E,u:M!=v.length||E&&S.length!=A,compression:B}),s+=30+M+L+I,a+=76+2*(M+L)+(A||0)+I,--r||h()}};if(M>65535&&R("filename too long",null),!B)R(null,m);else if(w<16e4)try{R(null,Hf(m,x))}catch(D){R(D,null)}else u.push(W2(m,x,R))},p=0;p<l;++p)f(p);return d}function dV(o,e){e||(e={});var t={},n=[];fb(o,"",t,e);var i=0,r=0;for(var s in t){var a=t[s],l=a[0],c=a[1],u=c.level==0?0:8,d=wa(s),h=d.length,f=c.comment,p=f&&wa(f),g=p&&p.length,v=ba(c.extra);if(h>65535)throw"filename too long";var y=u?Hf(l,c):l,m=y.length,x=ju();x.p(l),n.push(Uf(c,{size:l.length,crc:x.d(),c:y,f:d,m:p,u:h!=s.length||p&&f.length!=g,o:i,compression:u})),i+=30+h+v+m,r+=76+2*(h+v)+(g||0)+m}for(var _=new pt(r+22),w=i,b=r-i,M=0;M<n.length;++M){var d=n[M];Qu(_,d.o,d,d.f,d.u,d.c.length);var S=30+d.f.length+ba(d.extra);_.set(d.c,d.o+S),Qu(_,i,d,d.f,d.u,d.c.length,d.o,d.m),i+=16+S+(d.m?d.m.length:0)}return gb(_,i,n.length,b,w),_}var iL=function(){function o(){}return o.prototype.push=function(e,t){this.ondata(null,e,t)},o.compression=0,o}();var fV=function(){function o(){var e=this;this.i=new Ni(function(t,n){e.ondata(null,t,n)})}return o.prototype.push=function(e,t){try{this.i.push(e,t)}catch(n){this.ondata(n,e,t)}},o.compression=8,o}();var pV=function(){function o(e,t){var n=this;t<32e4?this.i=new Ni(function(i,r){n.ondata(null,i,r)}):(this.i=new ab(function(i,r,s){n.ondata(i,r,s)}),this.terminate=this.i.terminate)}return o.prototype.push=function(e,t){this.i.terminate&&(e=yr(e,0)),this.i.push(e,t)},o.compression=8,o}();var mV=function(){function o(e){this.onfile=e,this.k=[],this.o={0:iL},this.p=yo}return o.prototype.push=function(e,t){var n=this;if(!this.onfile)throw"no callback";if(!this.p)throw"stream finished";if(this.c>0){var i=Math.min(this.c,e.length),r=e.subarray(0,i);if(this.c-=i,this.d?this.d.push(r,!this.c):this.k[0].push(r),e=e.subarray(i),e.length)return this.push(e,t)}else{var s=0,a=0,l=void 0,c=void 0;this.p.length?e.length?(c=new pt(this.p.length+e.length),c.set(this.p),c.set(e,this.p.length)):c=this.p:c=e;for(var u=c.length,d=this.c,h=d&&this.d,f=function(){var y,m=yn(c,a);if(m==67324752){s=1,l=a,p.d=null,p.c=0;var x=Si(c,a+6),_=Si(c,a+8),w=x&2048,b=x&8,M=Si(c,a+26),S=Si(c,a+28);if(u>a+30+M+S){var E=[];p.k.unshift(E),s=2;var A=yn(c,a+18),L=yn(c,a+22),B=mb(c.subarray(a+30,a+=30+M),!w);A==4294967295?(y=b?[-2]:nL(c,a),A=y[0],L=y[1]):b&&(A=-1),a+=S,p.c=A;var R,D={name:B,compression:_,start:function(){if(!D.ondata)throw"no callback";if(!A)D.ondata(null,yo,!0);else{var P=n.o[_];if(!P)throw"unknown compression type "+_;R=A<0?new P(B):new P(B,A,L),R.ondata=function(z,se,ne){D.ondata(z,se,ne)};for(var I=0,N=E;I<N.length;I++){var G=N[I];R.push(G,!1)}n.k[0]==E&&n.c?n.d=R:R.push(yo,!0)}},terminate:function(){R&&R.terminate&&R.terminate()}};A>=0&&(D.size=A,D.originalSize=L),p.onfile(D)}return"break"}else if(d){if(m==134695760)return l=a+=12+(d==-2&&8),s=3,p.c=0,"break";if(m==33639248)return l=a-=4,s=3,p.c=0,"break"}},p=this;a<u-4;++a){var g=f();if(g==="break")break}if(this.p=yo,d<0){var v=s?c.subarray(0,l-12-(d==-2&&8)-(yn(c,l-16)==134695760&&4)):c.subarray(0,a);h?h.push(v,!!s):this.k[+(s==2)].push(v)}if(s&2)return this.push(c.subarray(a),t);this.p=c.subarray(a)}if(t){if(this.c)throw"invalid zip file";this.p=null}},o.prototype.register=function(e){this.o[e.compression]=e},o}();function gV(o,e){if(typeof e!="function")throw"no callback";for(var t=[],n=function(){for(var h=0;h<t.length;++h)t[h]()},i={},r=o.length-22;yn(o,r)!=101010256;--r)if(!r||o.length-r>65558){e("invalid zip file",null);return}var s=Si(o,r+8);s||e(null,{});var a=s,l=yn(o,r+16),c=l==4294967295;if(c){if(r=yn(o,r-12),yn(o,r)!=101075792){e("invalid zip file",null);return}a=s=yn(o,r+32),l=yn(o,r+48)}for(var u=function(h){var f=tL(o,l,c),p=f[0],g=f[1],v=f[2],y=f[3],m=f[4],x=f[5],_=eL(o,x);l=m;var w=function(M,S){M?(n(),e(M,null)):(i[y]=S,--s||e(null,i))};if(!p)w(null,yr(o,_,_+g));else if(p==8){var b=o.subarray(_,_+g);if(g<32e4)try{w(null,$u(b,new pt(v)))}catch(M){w(M,null)}else t.push(lb(b,{size:v},w))}else w("unknown compression type "+p,null)},d=0;d<a;++d)u(d);return n}function yV(o){for(var e={},t=o.length-22;yn(o,t)!=101010256;--t)if(!t||o.length-t>65558)throw"invalid zip file";var n=Si(o,t+8);if(!n)return{};var i=yn(o,t+16),r=i==4294967295;if(r){if(t=yn(o,t-12),yn(o,t)!=101075792)throw"invalid zip file";n=yn(o,t+32),i=yn(o,t+48)}for(var s=0;s<n;++s){var a=tL(o,i,r),l=a[0],c=a[1],u=a[2],d=a[3],h=a[4],f=a[5],p=eL(o,f);if(i=h,!l)e[d]=yr(o,p,p+c);else if(l==8)e[d]=$u(o.subarray(p,p+c),new pt(u));else throw"unknown compression type "+l}return e}var Dy=class{static findSpan(e,t,n){let i=n.length-e-1;if(t>=n[i])return i-1;if(t<=n[e])return e;let r=e,s=i,a=Math.floor((r+s)/2);for(;t<n[a]||t>=n[a+1];)t<n[a]?s=a:r=a,a=Math.floor((r+s)/2);return a}static calcBasisFunctions(e,t,n,i){let r=[],s=[],a=[];r[0]=1;for(let l=1;l<=n;++l){s[l]=t-i[e+1-l],a[l]=i[e+l]-t;let c=0;for(let u=0;u<l;++u){let d=a[u+1],h=s[l-u],f=r[u]/(d+h);r[u]=c+d*f,c=h*f}r[l]=c}return r}static calcBSplinePoint(e,t,n,i){let r=this.findSpan(e,i,t),s=this.calcBasisFunctions(r,i,e,t),a=new tt(0,0,0,0);for(let l=0;l<=e;++l){let c=n[r-e+l],u=s[l],d=c.w*u;a.x+=c.x*d,a.y+=c.y*d,a.z+=c.z*d,a.w+=c.w*u}return a}static calcBasisFunctionDerivatives(e,t,n,i,r){let s=[];for(let h=0;h<=n;++h)s[h]=0;let a=[];for(let h=0;h<=i;++h)a[h]=s.slice(0);let l=[];for(let h=0;h<=n;++h)l[h]=s.slice(0);l[0][0]=1;let c=s.slice(0),u=s.slice(0);for(let h=1;h<=n;++h){c[h]=t-r[e+1-h],u[h]=r[e+h]-t;let f=0;for(let p=0;p<h;++p){let g=u[p+1],v=c[h-p];l[h][p]=g+v;let y=l[p][h-1]/l[h][p];l[p][h]=f+g*y,f=v*y}l[h][h]=f}for(let h=0;h<=n;++h)a[0][h]=l[h][n];for(let h=0;h<=n;++h){let f=0,p=1,g=[];for(let v=0;v<=n;++v)g[v]=s.slice(0);g[0][0]=1;for(let v=1;v<=i;++v){let y=0,m=h-v,x=n-v;h>=v&&(g[p][0]=g[f][0]/l[x+1][m],y=g[p][0]*l[m][x]);let _=m>=-1?1:-m,w=h-1<=x?v-1:n-h;for(let M=_;M<=w;++M)g[p][M]=(g[f][M]-g[f][M-1])/l[x+1][m+M],y+=g[p][M]*l[m+M][x];h<=x&&(g[p][v]=-g[f][v-1]/l[x+1][h],y+=g[p][v]*l[h][x]),a[v][h]=y;let b=f;f=p,p=b}}let d=n;for(let h=1;h<=i;++h){for(let f=0;f<=n;++f)a[h][f]*=d;d*=n-h}return a}static calcBSplineDerivatives(e,t,n,i,r){let s=r<e?r:e,a=[],l=this.findSpan(e,i,t),c=this.calcBasisFunctionDerivatives(l,i,e,s,t),u=[];for(let d=0;d<n.length;++d){let h=n[d].clone(),f=h.w;h.x*=f,h.y*=f,h.z*=f,u[d]=h}for(let d=0;d<=s;++d){let h=u[l-e].clone().multiplyScalar(c[d][0]);for(let f=1;f<=e;++f)h.add(u[l-e+f].clone().multiplyScalar(c[d][f]));a[d]=h}for(let d=s+1;d<=r+1;++d)a[d]=new tt(0,0,0);return a}static calcKoverI(e,t){let n=1;for(let r=2;r<=e;++r)n*=r;let i=1;for(let r=2;r<=t;++r)i*=r;for(let r=2;r<=e-t;++r)i*=r;return n/i}static calcRationalCurveDerivatives(e){let t=e.length,n=[],i=[];for(let s=0;s<t;++s){let a=e[s];n[s]=new U(a.x,a.y,a.z),i[s]=a.w}let r=[];for(let s=0;s<t;++s){let a=n[s].clone();for(let l=1;l<=s;++l)a.sub(r[s-l].clone().multiplyScalar(this.calcKoverI(s,l)*i[l]));r[s]=a.divideScalar(i[0])}return r}static calcNURBSDerivatives(e,t,n,i,r){let s=this.calcBSplineDerivatives(e,t,n,i,r);return this.calcRationalCurveDerivatives(s)}static calcSurfacePoint(e,t,n,i,r,s,a,l){let c=this.findSpan(e,s,n),u=this.findSpan(t,a,i),d=this.calcBasisFunctions(c,s,e,n),h=this.calcBasisFunctions(u,a,t,i),f=[];for(let g=0;g<=t;++g){f[g]=new tt(0,0,0,0);for(let v=0;v<=e;++v){let y=r[c-e+v][u-t+g].clone(),m=y.w;y.x*=m,y.y*=m,y.z*=m,f[g].add(y.multiplyScalar(d[v]))}}let p=new tt(0,0,0,0);for(let g=0;g<=t;++g)p.add(f[g].multiplyScalar(h[g]));p.divideScalar(p.w),l.set(p.x,p.y,p.z)}};var Fy=class extends li{constructor(e,t,n,i,r){super();this.degree=e,this.knots=t,this.controlPoints=[],this.startKnot=i||0,this.endKnot=r||this.knots.length-1;for(let s=0;s<n.length;++s){let a=n[s];this.controlPoints[s]=new tt(a.x,a.y,a.z,a.w)}}getPoint(e,t=new U){let n=t,i=this.knots[this.startKnot]+e*(this.knots[this.endKnot]-this.knots[this.startKnot]),r=Dy.calcBSplinePoint(this.degree,this.knots,this.controlPoints,i);return r.w!==1&&r.divideScalar(r.w),n.set(r.x,r.y,r.z)}getTangent(e,t=new U){let n=t,i=this.knots[0]+e*(this.knots[this.knots.length-1]-this.knots[0]),r=Dy.calcNURBSDerivatives(this.degree,this.knots,this.controlPoints,i,1);return n.copy(r[1]).normalize(),n}};var ct,vn,ui,vb=class extends tn{constructor(e){super(e)}load(e,t,n,i){let r=this,s=r.path===""?Mi.extractUrlBase(e):r.path,a=new mn(this.manager);a.setPath(r.path),a.setResponseType("arraybuffer"),a.setRequestHeader(r.requestHeader),a.setWithCredentials(r.withCredentials),a.load(e,function(l){try{t(r.parse(l,s))}catch(c){i?i(c):console.error(c),r.manager.itemError(e)}},n,i)}parse(e,t){if(vV(e))ct=new lL().parse(e);else{let i=dL(e);if(!xV(i))throw new Error("THREE.FBXLoader: Unknown format.");if(cL(i)<7e3)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+cL(i));ct=new aL().parse(i)}let n=new Vr(this.manager).setPath(this.resourcePath||t).setCrossOrigin(this.crossOrigin);return new rL(n,this.manager).parse(ct)}},rL=class{constructor(e,t){this.textureLoader=e,this.manager=t}parse(){vn=this.parseConnections();let e=this.parseImages(),t=this.parseTextures(e),n=this.parseMaterials(t),i=this.parseDeformers(),r=new sL().parse(i);return this.parseScene(i,r,n),ui}parseConnections(){let e=new Map;return"Connections"in ct&&ct.Connections.connections.forEach(function(n){let i=n[0],r=n[1],s=n[2];e.has(i)||e.set(i,{parents:[],children:[]});let a={ID:r,relationship:s};e.get(i).parents.push(a),e.has(r)||e.set(r,{parents:[],children:[]});let l={ID:i,relationship:s};e.get(r).children.push(l)}),e}parseImages(){let e={},t={};if("Video"in ct.Objects){let n=ct.Objects.Video;for(let i in n){let r=n[i],s=parseInt(i);if(e[s]=r.RelativeFilename||r.Filename,"Content"in r){let a=r.Content instanceof ArrayBuffer&&r.Content.byteLength>0,l=typeof r.Content=="string"&&r.Content!=="";if(a||l){let c=this.parseImage(n[i]);t[r.RelativeFilename||r.Filename]=c}}}}for(let n in e){let i=e[n];t[i]!==void 0?e[n]=t[i]:e[n]=e[n].split("\\").pop()}return e}parseImage(e){let t=e.Content,n=e.RelativeFilename||e.Filename,i=n.slice(n.lastIndexOf(".")+1).toLowerCase(),r;switch(i){case"bmp":r="image/bmp";break;case"jpg":case"jpeg":r="image/jpeg";break;case"png":r="image/png";break;case"tif":r="image/tiff";break;case"tga":this.manager.getHandler(".tga")===null&&console.warn("FBXLoader: TGA loader not found, skipping ",n),r="image/tga";break;default:console.warn('FBXLoader: Image type "'+i+'" is not supported.');return}if(typeof t=="string")return"data:"+r+";base64,"+t;{let s=new Uint8Array(t);return window.URL.createObjectURL(new Blob([s],{type:r}))}}parseTextures(e){let t=new Map;if("Texture"in ct.Objects){let n=ct.Objects.Texture;for(let i in n){let r=this.parseTexture(n[i],e);t.set(parseInt(i),r)}}return t}parseTexture(e,t){let n=this.loadTexture(e,t);n.ID=e.id,n.name=e.attrName;let i=e.WrapModeU,r=e.WrapModeV,s=i!==void 0?i.value:0,a=r!==void 0?r.value:0;if(n.wrapS=s===0?En:an,n.wrapT=a===0?En:an,"Scaling"in e){let l=e.Scaling.value;n.repeat.x=l[0],n.repeat.y=l[1]}return n}loadTexture(e,t){let n,i=this.textureLoader.path,r=vn.get(e.id).children;r!==void 0&&r.length>0&&t[r[0].ID]!==void 0&&(n=t[r[0].ID],(n.indexOf("blob:")===0||n.indexOf("data:")===0)&&this.textureLoader.setPath(void 0));let s,a=e.FileName.slice(-3).toLowerCase();if(a==="tga"){let l=this.manager.getHandler(".tga");l===null?(console.warn("FBXLoader: TGA loader not found, creating placeholder texture for",e.RelativeFilename),s=new Vt):(l.setPath(this.textureLoader.path),s=l.load(n))}else a==="psd"?(console.warn("FBXLoader: PSD textures are not supported, creating placeholder texture for",e.RelativeFilename),s=new Vt):s=this.textureLoader.load(n);return this.textureLoader.setPath(i),s}parseMaterials(e){let t=new Map;if("Material"in ct.Objects){let n=ct.Objects.Material;for(let i in n){let r=this.parseMaterial(n[i],e);r!==null&&t.set(parseInt(i),r)}}return t}parseMaterial(e,t){let n=e.id,i=e.attrName,r=e.ShadingModel;if(typeof r=="object"&&(r=r.value),!vn.has(n))return null;let s=this.parseParameters(e,t,n),a;switch(r.toLowerCase()){case"phong":a=new gs;break;case"lambert":a=new Iu;break;default:console.warn('THREE.FBXLoader: unknown material type "%s". Defaulting to MeshPhongMaterial.',r),a=new gs;break}return a.setValues(s),a.name=i,a}parseParameters(e,t,n){let i={};e.BumpFactor&&(i.bumpScale=e.BumpFactor.value),e.Diffuse?i.color=new De().fromArray(e.Diffuse.value):e.DiffuseColor&&(e.DiffuseColor.type==="Color"||e.DiffuseColor.type==="ColorRGB")&&(i.color=new De().fromArray(e.DiffuseColor.value)),e.DisplacementFactor&&(i.displacementScale=e.DisplacementFactor.value),e.Emissive?i.emissive=new De().fromArray(e.Emissive.value):e.EmissiveColor&&(e.EmissiveColor.type==="Color"||e.EmissiveColor.type==="ColorRGB")&&(i.emissive=new De().fromArray(e.EmissiveColor.value)),e.EmissiveFactor&&(i.emissiveIntensity=parseFloat(e.EmissiveFactor.value)),e.Opacity&&(i.opacity=parseFloat(e.Opacity.value)),i.opacity<1&&(i.transparent=!0),e.ReflectionFactor&&(i.reflectivity=e.ReflectionFactor.value),e.Shininess&&(i.shininess=e.Shininess.value),e.Specular?i.specular=new De().fromArray(e.Specular.value):e.SpecularColor&&e.SpecularColor.type==="Color"&&(i.specular=new De().fromArray(e.SpecularColor.value));let r=this;return vn.get(n).children.forEach(function(s){let a=s.relationship;switch(a){case"Bump":i.bumpMap=r.getTexture(t,s.ID);break;case"Maya|TEX_ao_map":i.aoMap=r.getTexture(t,s.ID);break;case"DiffuseColor":case"Maya|TEX_color_map":i.map=r.getTexture(t,s.ID),i.map.encoding=Vi;break;case"DisplacementColor":i.displacementMap=r.getTexture(t,s.ID);break;case"EmissiveColor":i.emissiveMap=r.getTexture(t,s.ID),i.emissiveMap.encoding=Vi;break;case"NormalMap":case"Maya|TEX_normal_map":i.normalMap=r.getTexture(t,s.ID);break;case"ReflectionColor":i.envMap=r.getTexture(t,s.ID),i.envMap.mapping=Gc,i.envMap.encoding=Vi;break;case"SpecularColor":i.specularMap=r.getTexture(t,s.ID),i.specularMap.encoding=Vi;break;case"TransparentColor":case"TransparencyFactor":i.alphaMap=r.getTexture(t,s.ID),i.transparent=!0;break;case"AmbientColor":case"ShininessExponent":case"SpecularFactor":case"VectorDisplacementColor":default:console.warn("THREE.FBXLoader: %s map is not supported in three.js, skipping texture.",a);break}}),i}getTexture(e,t){return"LayeredTexture"in ct.Objects&&t in ct.Objects.LayeredTexture&&(console.warn("THREE.FBXLoader: layered textures are not supported in three.js. Discarding all but first layer."),t=vn.get(t).children[0].ID),e.get(t)}parseDeformers(){let e={},t={};if("Deformer"in ct.Objects){let n=ct.Objects.Deformer;for(let i in n){let r=n[i],s=vn.get(parseInt(i));if(r.attrType==="Skin"){let a=this.parseSkeleton(s,n);a.ID=i,s.parents.length>1&&console.warn("THREE.FBXLoader: skeleton attached to more than one geometry is not supported."),a.geometryID=s.parents[0].ID,e[i]=a}else if(r.attrType==="BlendShape"){let a={id:i};a.rawTargets=this.parseMorphTargets(s,n),a.id=i,s.parents.length>1&&console.warn("THREE.FBXLoader: morph target attached to more than one geometry is not supported."),t[i]=a}}}return{skeletons:e,morphTargets:t}}parseSkeleton(e,t){let n=[];return e.children.forEach(function(i){let r=t[i.ID];if(r.attrType!=="Cluster")return;let s={ID:i.ID,indices:[],weights:[],transformLink:new Pe().fromArray(r.TransformLink.a)};"Indexes"in r&&(s.indices=r.Indexes.a,s.weights=r.Weights.a),n.push(s)}),{rawBones:n,bones:[]}}parseMorphTargets(e,t){let n=[];for(let i=0;i<e.children.length;i++){let r=e.children[i],s=t[r.ID],a={name:s.attrName,initialWeight:s.DeformPercent,id:s.id,fullWeights:s.FullWeights.a};if(s.attrType!=="BlendShapeChannel")return;a.geoID=vn.get(parseInt(r.ID)).children.filter(function(l){return l.relationship===void 0})[0].ID,n.push(a)}return n}parseScene(e,t,n){ui=new Zn;let i=this.parseModels(e.skeletons,t,n),r=ct.Objects.Model,s=this;i.forEach(function(l){let c=r[l.ID];s.setLookAtProperties(l,c),vn.get(l.ID).parents.forEach(function(d){let h=i.get(d.ID);h!==void 0&&h.add(l)}),l.parent===null&&ui.add(l)}),this.bindSkeleton(e.skeletons,t,i),this.createAmbientLight(),this.setupMorphMaterials(),ui.traverse(function(l){if(l.userData.transformData){l.parent&&(l.userData.transformData.parentMatrix=l.parent.matrix,l.userData.transformData.parentMatrixWorld=l.parent.matrixWorld);let c=uL(l.userData.transformData);l.applyMatrix4(c),l.updateWorldMatrix()}});let a=new oL().parse();ui.children.length===1&&ui.children[0].isGroup&&(ui.children[0].animations=a,ui=ui.children[0]),ui.animations=a}parseModels(e,t,n){let i=new Map,r=ct.Objects.Model;for(let s in r){let a=parseInt(s),l=r[s],c=vn.get(a),u=this.buildSkeleton(c,e,a,l.attrName);if(!u){switch(l.attrType){case"Camera":u=this.createCamera(c);break;case"Light":u=this.createLight(c);break;case"Mesh":u=this.createMesh(c,t,n);break;case"NurbsCurve":u=this.createCurve(c,t);break;case"LimbNode":case"Root":u=new fs;break;case"Null":default:u=new Zn;break}u.name=l.attrName?st.sanitizeNodeName(l.attrName):"",u.ID=a}this.getTransformData(u,l),i.set(a,u)}return i}buildSkeleton(e,t,n,i){let r=null;return e.parents.forEach(function(s){for(let a in t){let l=t[a];l.rawBones.forEach(function(c,u){if(c.ID===s.ID){let d=r;r=new fs,r.matrixWorld.copy(c.transformLink),r.name=i?st.sanitizeNodeName(i):"",r.ID=n,l.bones[u]=r,d!==null&&r.add(d)}})}}),r}createCamera(e){let t,n;if(e.children.forEach(function(i){let r=ct.Objects.NodeAttribute[i.ID];r!==void 0&&(n=r)}),n===void 0)t=new $e;else{let i=0;n.CameraProjectionType!==void 0&&n.CameraProjectionType.value===1&&(i=1);let r=1;n.NearPlane!==void 0&&(r=n.NearPlane.value/1e3);let s=1e3;n.FarPlane!==void 0&&(s=n.FarPlane.value/1e3);let a=window.innerWidth,l=window.innerHeight;n.AspectWidth!==void 0&&n.AspectHeight!==void 0&&(a=n.AspectWidth.value,l=n.AspectHeight.value);let c=a/l,u=45;n.FieldOfView!==void 0&&(u=n.FieldOfView.value);let d=n.FocalLength?n.FocalLength.value:null;switch(i){case 0:t=new It(u,c,r,s),d!==null&&t.setFocalLength(d);break;case 1:t=new ci(-a/2,a/2,l/2,-l/2,r,s);break;default:console.warn("THREE.FBXLoader: Unknown camera type "+i+"."),t=new $e;break}}return t}createLight(e){let t,n;if(e.children.forEach(function(i){let r=ct.Objects.NodeAttribute[i.ID];r!==void 0&&(n=r)}),n===void 0)t=new $e;else{let i;n.LightType===void 0?i=0:i=n.LightType.value;let r=16777215;n.Color!==void 0&&(r=new De().fromArray(n.Color.value));let s=n.Intensity===void 0?1:n.Intensity.value/100;n.CastLightOnObject!==void 0&&n.CastLightOnObject.value===0&&(s=0);let a=0;n.FarAttenuationEnd!==void 0&&(n.EnableFarAttenuation!==void 0&&n.EnableFarAttenuation.value===0?a=0:a=n.FarAttenuationEnd.value);let l=1;switch(i){case 0:t=new Xr(r,s,a,l);break;case 1:t=new bs(r,s);break;case 2:let c=Math.PI/3;n.InnerAngle!==void 0&&(c=cn.degToRad(n.InnerAngle.value));let u=0;n.OuterAngle!==void 0&&(u=cn.degToRad(n.OuterAngle.value),u=Math.max(u,1)),t=new ws(r,s,a,c,u,l);break;default:console.warn("THREE.FBXLoader: Unknown light type "+n.LightType.value+", defaulting to a PointLight."),t=new Xr(r,s);break}n.CastShadows!==void 0&&n.CastShadows.value===1&&(t.castShadow=!0)}return t}createMesh(e,t,n){let i,r=null,s=null,a=[];return e.children.forEach(function(l){t.has(l.ID)&&(r=t.get(l.ID)),n.has(l.ID)&&a.push(n.get(l.ID))}),a.length>1?s=a:a.length>0?s=a[0]:(s=new gs({color:13421772}),a.push(s)),"color"in r.attributes&&a.forEach(function(l){l.vertexColors=!0}),r.FBX_Deformer?(i=new lo(r,s),i.normalizeSkinWeights()):i=new et(r,s),i}createCurve(e,t){let n=e.children.reduce(function(r,s){return t.has(s.ID)&&(r=t.get(s.ID)),r},null),i=new zt({color:3342591,linewidth:1});return new ai(n,i)}getTransformData(e,t){let n={};"InheritType"in t&&(n.inheritType=parseInt(t.InheritType.value)),"RotationOrder"in t?n.eulerOrder=hL(t.RotationOrder.value):n.eulerOrder="ZYX","Lcl_Translation"in t&&(n.translation=t.Lcl_Translation.value),"PreRotation"in t&&(n.preRotation=t.PreRotation.value),"Lcl_Rotation"in t&&(n.rotation=t.Lcl_Rotation.value),"PostRotation"in t&&(n.postRotation=t.PostRotation.value),"Lcl_Scaling"in t&&(n.scale=t.Lcl_Scaling.value),"ScalingOffset"in t&&(n.scalingOffset=t.ScalingOffset.value),"ScalingPivot"in t&&(n.scalingPivot=t.ScalingPivot.value),"RotationOffset"in t&&(n.rotationOffset=t.RotationOffset.value),"RotationPivot"in t&&(n.rotationPivot=t.RotationPivot.value),e.userData.transformData=n}setLookAtProperties(e,t){"LookAtProperty"in t&&vn.get(e.ID).children.forEach(function(i){if(i.relationship==="LookAtProperty"){let r=ct.Objects.Model[i.ID];if("Lcl_Translation"in r){let s=r.Lcl_Translation.value;e.target!==void 0?(e.target.position.fromArray(s),ui.add(e.target)):e.lookAt(new U().fromArray(s))}}})}bindSkeleton(e,t,n){let i=this.parsePoseNodes();for(let r in e){let s=e[r];vn.get(parseInt(s.ID)).parents.forEach(function(l){if(t.has(l.ID)){let c=l.ID;vn.get(c).parents.forEach(function(d){n.has(d.ID)&&n.get(d.ID).bind(new co(s.bones),i[d.ID])})}})}}parsePoseNodes(){let e={};if("Pose"in ct.Objects){let t=ct.Objects.Pose;for(let n in t)if(t[n].attrType==="BindPose"){let i=t[n].PoseNode;Array.isArray(i)?i.forEach(function(r){e[r.Node]=new Pe().fromArray(r.Matrix.a)}):e[i.Node]=new Pe().fromArray(i.Matrix.a)}}return e}createAmbientLight(){if("GlobalSettings"in ct&&"AmbientColor"in ct.GlobalSettings){let e=ct.GlobalSettings.AmbientColor.value,t=e[0],n=e[1],i=e[2];if(t!==0||n!==0||i!==0){let r=new De(t,n,i);ui.add(new ma(r,1))}}}setupMorphMaterials(){let e=this;ui.traverse(function(t){t.isMesh&&t.geometry.morphAttributes.position&&t.geometry.morphAttributes.position.length&&(Array.isArray(t.material)?t.material.forEach(function(n,i){e.setupMorphMaterial(t,n,i)}):e.setupMorphMaterial(t,t.material))})}setupMorphMaterial(e,t,n){let i=e.uuid,r=t.uuid,s=!1;if(ui.traverse(function(a){a.isMesh&&(Array.isArray(a.material)?a.material.forEach(function(l){l.uuid===r&&a.uuid!==i&&(s=!0)}):a.material.uuid===r&&a.uuid!==i&&(s=!0))}),s===!0){let a=t.clone();a.morphTargets=!0,n===void 0?e.material=a:e.material[n]=a}else t.morphTargets=!0}},sL=class{parse(e){let t=new Map;if("Geometry"in ct.Objects){let n=ct.Objects.Geometry;for(let i in n){let r=vn.get(parseInt(i)),s=this.parseGeometry(r,n[i],e);t.set(parseInt(i),s)}}return t}parseGeometry(e,t,n){switch(t.attrType){case"Mesh":return this.parseMeshGeometry(e,t,n);case"NurbsCurve":return this.parseNurbsGeometry(t)}}parseMeshGeometry(e,t,n){let i=n.skeletons,r=[],s=e.parents.map(function(d){return ct.Objects.Model[d.ID]});if(s.length===0)return;let a=e.children.reduce(function(d,h){return i[h.ID]!==void 0&&(d=i[h.ID]),d},null);e.children.forEach(function(d){n.morphTargets[d.ID]!==void 0&&r.push(n.morphTargets[d.ID])});let l=s[0],c={};"RotationOrder"in l&&(c.eulerOrder=hL(l.RotationOrder.value)),"InheritType"in l&&(c.inheritType=parseInt(l.InheritType.value)),"GeometricTranslation"in l&&(c.translation=l.GeometricTranslation.value),"GeometricRotation"in l&&(c.rotation=l.GeometricRotation.value),"GeometricScaling"in l&&(c.scale=l.GeometricScaling.value);let u=uL(c);return this.genGeometry(t,a,r,u)}genGeometry(e,t,n,i){let r=new Ue;e.attrName&&(r.name=e.attrName);let s=this.parseGeoNode(e,t),a=this.genBuffers(s),l=new Ne(a.vertex,3);if(l.applyMatrix4(i),r.setAttribute("position",l),a.colors.length>0&&r.setAttribute("color",new Ne(a.colors,3)),t&&(r.setAttribute("skinIndex",new Pl(a.weightsIndices,4)),r.setAttribute("skinWeight",new Ne(a.vertexWeights,4)),r.FBX_Deformer=t),a.normal.length>0){let c=new vt().getNormalMatrix(i),u=new Ne(a.normal,3);u.applyNormalMatrix(c),r.setAttribute("normal",u)}if(a.uvs.forEach(function(c,u){let d="uv"+(u+1).toString();u===0&&(d="uv"),r.setAttribute(d,new Ne(a.uvs[u],2))}),s.material&&s.material.mappingType!=="AllSame"){let c=a.materialIndex[0],u=0;if(a.materialIndex.forEach(function(d,h){d!==c&&(r.addGroup(u,h-u,c),c=d,u=h)}),r.groups.length>0){let d=r.groups[r.groups.length-1],h=d.start+d.count;h!==a.materialIndex.length&&r.addGroup(h,a.materialIndex.length-h,c)}r.groups.length===0&&r.addGroup(0,a.materialIndex.length,a.materialIndex[0])}return this.addMorphTargets(r,e,n,i),r}parseGeoNode(e,t){let n={};if(n.vertexPositions=e.Vertices!==void 0?e.Vertices.a:[],n.vertexIndices=e.PolygonVertexIndex!==void 0?e.PolygonVertexIndex.a:[],e.LayerElementColor&&(n.color=this.parseVertexColors(e.LayerElementColor[0])),e.LayerElementMaterial&&(n.material=this.parseMaterialIndices(e.LayerElementMaterial[0])),e.LayerElementNormal&&(n.normal=this.parseNormals(e.LayerElementNormal[0])),e.LayerElementUV){n.uv=[];let i=0;for(;e.LayerElementUV[i];)e.LayerElementUV[i].UV&&n.uv.push(this.parseUVs(e.LayerElementUV[i])),i++}return n.weightTable={},t!==null&&(n.skeleton=t,t.rawBones.forEach(function(i,r){i.indices.forEach(function(s,a){n.weightTable[s]===void 0&&(n.weightTable[s]=[]),n.weightTable[s].push({id:r,weight:i.weights[a]})})})),n}genBuffers(e){let t={vertex:[],normal:[],colors:[],uvs:[],materialIndex:[],vertexWeights:[],weightsIndices:[]},n=0,i=0,r=!1,s=[],a=[],l=[],c=[],u=[],d=[],h=this;return e.vertexIndices.forEach(function(f,p){let g,v=!1;f<0&&(f=f^-1,v=!0);let y=[],m=[];if(s.push(f*3,f*3+1,f*3+2),e.color){let x=By(p,n,f,e.color);l.push(x[0],x[1],x[2])}if(e.skeleton){if(e.weightTable[f]!==void 0&&e.weightTable[f].forEach(function(x){m.push(x.weight),y.push(x.id)}),m.length>4){r||(console.warn("THREE.FBXLoader: Vertex has more than 4 skinning weights assigned to vertex. Deleting additional weights."),r=!0);let x=[0,0,0,0],_=[0,0,0,0];m.forEach(function(w,b){let M=w,S=y[b];_.forEach(function(E,A,L){if(M>E){L[A]=M,M=E;let B=x[A];x[A]=S,S=B}})}),y=x,m=_}for(;m.length<4;)m.push(0),y.push(0);for(let x=0;x<4;++x)u.push(m[x]),d.push(y[x])}if(e.normal){let x=By(p,n,f,e.normal);a.push(x[0],x[1],x[2])}e.material&&e.material.mappingType!=="AllSame"&&(g=By(p,n,f,e.material)[0]),e.uv&&e.uv.forEach(function(x,_){let w=By(p,n,f,x);c[_]===void 0&&(c[_]=[]),c[_].push(w[0]),c[_].push(w[1])}),i++,v&&(h.genFace(t,e,s,g,a,l,c,u,d,i),n++,i=0,s=[],a=[],l=[],c=[],u=[],d=[])}),t}genFace(e,t,n,i,r,s,a,l,c,u){for(let d=2;d<u;d++)e.vertex.push(t.vertexPositions[n[0]]),e.vertex.push(t.vertexPositions[n[1]]),e.vertex.push(t.vertexPositions[n[2]]),e.vertex.push(t.vertexPositions[n[(d-1)*3]]),e.vertex.push(t.vertexPositions[n[(d-1)*3+1]]),e.vertex.push(t.vertexPositions[n[(d-1)*3+2]]),e.vertex.push(t.vertexPositions[n[d*3]]),e.vertex.push(t.vertexPositions[n[d*3+1]]),e.vertex.push(t.vertexPositions[n[d*3+2]]),t.skeleton&&(e.vertexWeights.push(l[0]),e.vertexWeights.push(l[1]),e.vertexWeights.push(l[2]),e.vertexWeights.push(l[3]),e.vertexWeights.push(l[(d-1)*4]),e.vertexWeights.push(l[(d-1)*4+1]),e.vertexWeights.push(l[(d-1)*4+2]),e.vertexWeights.push(l[(d-1)*4+3]),e.vertexWeights.push(l[d*4]),e.vertexWeights.push(l[d*4+1]),e.vertexWeights.push(l[d*4+2]),e.vertexWeights.push(l[d*4+3]),e.weightsIndices.push(c[0]),e.weightsIndices.push(c[1]),e.weightsIndices.push(c[2]),e.weightsIndices.push(c[3]),e.weightsIndices.push(c[(d-1)*4]),e.weightsIndices.push(c[(d-1)*4+1]),e.weightsIndices.push(c[(d-1)*4+2]),e.weightsIndices.push(c[(d-1)*4+3]),e.weightsIndices.push(c[d*4]),e.weightsIndices.push(c[d*4+1]),e.weightsIndices.push(c[d*4+2]),e.weightsIndices.push(c[d*4+3])),t.color&&(e.colors.push(s[0]),e.colors.push(s[1]),e.colors.push(s[2]),e.colors.push(s[(d-1)*3]),e.colors.push(s[(d-1)*3+1]),e.colors.push(s[(d-1)*3+2]),e.colors.push(s[d*3]),e.colors.push(s[d*3+1]),e.colors.push(s[d*3+2])),t.material&&t.material.mappingType!=="AllSame"&&(e.materialIndex.push(i),e.materialIndex.push(i),e.materialIndex.push(i)),t.normal&&(e.normal.push(r[0]),e.normal.push(r[1]),e.normal.push(r[2]),e.normal.push(r[(d-1)*3]),e.normal.push(r[(d-1)*3+1]),e.normal.push(r[(d-1)*3+2]),e.normal.push(r[d*3]),e.normal.push(r[d*3+1]),e.normal.push(r[d*3+2])),t.uv&&t.uv.forEach(function(h,f){e.uvs[f]===void 0&&(e.uvs[f]=[]),e.uvs[f].push(a[f][0]),e.uvs[f].push(a[f][1]),e.uvs[f].push(a[f][(d-1)*2]),e.uvs[f].push(a[f][(d-1)*2+1]),e.uvs[f].push(a[f][d*2]),e.uvs[f].push(a[f][d*2+1])})}addMorphTargets(e,t,n,i){if(n.length===0)return;e.morphTargetsRelative=!0,e.morphAttributes.position=[];let r=this;n.forEach(function(s){s.rawTargets.forEach(function(a){let l=ct.Objects.Geometry[a.geoID];l!==void 0&&r.genMorphGeometry(e,t,l,i,a.name)})})}genMorphGeometry(e,t,n,i,r){let s=t.PolygonVertexIndex!==void 0?t.PolygonVertexIndex.a:[],a=n.Vertices!==void 0?n.Vertices.a:[],l=n.Indexes!==void 0?n.Indexes.a:[],c=e.attributes.position.count*3,u=new Float32Array(c);for(let p=0;p<l.length;p++){let g=l[p]*3;u[g]=a[p*3],u[g+1]=a[p*3+1],u[g+2]=a[p*3+2]}let d={vertexIndices:s,vertexPositions:u},h=this.genBuffers(d),f=new Ne(h.vertex,3);f.name=r||n.attrName,f.applyMatrix4(i),e.morphAttributes.position.push(f)}parseNormals(e){let t=e.MappingInformationType,n=e.ReferenceInformationType,i=e.Normals.a,r=[];return n==="IndexToDirect"&&("NormalIndex"in e?r=e.NormalIndex.a:"NormalsIndex"in e&&(r=e.NormalsIndex.a)),{dataSize:3,buffer:i,indices:r,mappingType:t,referenceType:n}}parseUVs(e){let t=e.MappingInformationType,n=e.ReferenceInformationType,i=e.UV.a,r=[];return n==="IndexToDirect"&&(r=e.UVIndex.a),{dataSize:2,buffer:i,indices:r,mappingType:t,referenceType:n}}parseVertexColors(e){let t=e.MappingInformationType,n=e.ReferenceInformationType,i=e.Colors.a,r=[];return n==="IndexToDirect"&&(r=e.ColorIndex.a),{dataSize:4,buffer:i,indices:r,mappingType:t,referenceType:n}}parseMaterialIndices(e){let t=e.MappingInformationType,n=e.ReferenceInformationType;if(t==="NoMappingInformation")return{dataSize:1,buffer:[0],indices:[0],mappingType:"AllSame",referenceType:n};let i=e.Materials.a,r=[];for(let s=0;s<i.length;++s)r.push(s);return{dataSize:1,buffer:i,indices:r,mappingType:t,referenceType:n}}parseNurbsGeometry(e){if(Fy===void 0)return console.error("THREE.FBXLoader: The loader relies on NURBSCurve for any nurbs present in the model. Nurbs will show up as empty geometry."),new Ue;let t=parseInt(e.Order);if(isNaN(t))return console.error("THREE.FBXLoader: Invalid Order %s given for geometry ID: %s",e.Order,e.id),new Ue;let n=t-1,i=e.KnotVector.a,r=[],s=e.Points.a;for(let f=0,p=s.length;f<p;f+=4)r.push(new tt().fromArray(s,f));let a,l;if(e.Form==="Closed")r.push(r[0]);else if(e.Form==="Periodic"){a=n,l=i.length-1-a;for(let f=0;f<n;++f)r.push(r[f])}let u=new Fy(n,i,r,a,l).getPoints(r.length*7),d=new Float32Array(u.length*3);u.forEach(function(f,p){f.toArray(d,p*3)});let h=new Ue;return h.setAttribute("position",new Ye(d,3)),h}},oL=class{parse(){let e=[],t=this.parseClips();if(t!==void 0)for(let n in t){let i=t[n],r=this.addClip(i);e.push(r)}return e}parseClips(){if(ct.Objects.AnimationCurve===void 0)return;let e=this.parseAnimationCurveNodes();this.parseAnimationCurves(e);let t=this.parseAnimationLayers(e);return this.parseAnimStacks(t)}parseAnimationCurveNodes(){let e=ct.Objects.AnimationCurveNode,t=new Map;for(let n in e){let i=e[n];if(i.attrName.match(/S|R|T|DeformPercent/)!==null){let r={id:i.id,attr:i.attrName,curves:{}};t.set(r.id,r)}}return t}parseAnimationCurves(e){let t=ct.Objects.AnimationCurve;for(let n in t){let i={id:t[n].id,times:t[n].KeyTime.a.map(_V),values:t[n].KeyValueFloat.a},r=vn.get(i.id);if(r!==void 0){let s=r.parents[0].ID,a=r.parents[0].relationship;a.match(/X/)?e.get(s).curves.x=i:a.match(/Y/)?e.get(s).curves.y=i:a.match(/Z/)?e.get(s).curves.z=i:a.match(/d|DeformPercent/)&&e.has(s)&&(e.get(s).curves.morph=i)}}}parseAnimationLayers(e){let t=ct.Objects.AnimationLayer,n=new Map;for(let i in t){let r=[],s=vn.get(parseInt(i));s!==void 0&&(s.children.forEach(function(l,c){if(e.has(l.ID)){let u=e.get(l.ID);if(u.curves.x!==void 0||u.curves.y!==void 0||u.curves.z!==void 0){if(r[c]===void 0){let d=vn.get(l.ID).parents.filter(function(h){return h.relationship!==void 0})[0].ID;if(d!==void 0){let h=ct.Objects.Model[d.toString()];if(h===void 0){console.warn("THREE.FBXLoader: Encountered a unused curve.",l);return}let f={modelName:h.attrName?st.sanitizeNodeName(h.attrName):"",ID:h.id,initialPosition:[0,0,0],initialRotation:[0,0,0],initialScale:[1,1,1]};ui.traverse(function(p){p.ID===h.id&&(f.transform=p.matrix,p.userData.transformData&&(f.eulerOrder=p.userData.transformData.eulerOrder))}),f.transform||(f.transform=new Pe),"PreRotation"in h&&(f.preRotation=h.PreRotation.value),"PostRotation"in h&&(f.postRotation=h.PostRotation.value),r[c]=f}}r[c]&&(r[c][u.attr]=u)}else if(u.curves.morph!==void 0){if(r[c]===void 0){let d=vn.get(l.ID).parents.filter(function(y){return y.relationship!==void 0})[0].ID,h=vn.get(d).parents[0].ID,f=vn.get(h).parents[0].ID,p=vn.get(f).parents[0].ID,g=ct.Objects.Model[p],v={modelName:g.attrName?st.sanitizeNodeName(g.attrName):"",morphName:ct.Objects.Deformer[d].attrName};r[c]=v}r[c][u.attr]=u}}}),n.set(parseInt(i),r))}return n}parseAnimStacks(e){let t=ct.Objects.AnimationStack,n={};for(let i in t){let r=vn.get(parseInt(i)).children;r.length>1&&console.warn("THREE.FBXLoader: Encountered an animation stack with multiple layers, this is currently not supported. Ignoring subsequent layers.");let s=e.get(r[0].ID);n[i]={name:t[i].attrName,layer:s}}return n}addClip(e){let t=[],n=this;return e.layer.forEach(function(i){t=t.concat(n.generateTracks(i))}),new xs(e.name,-1,t)}generateTracks(e){let t=[],n=new U,i=new gt,r=new U;if(e.transform&&e.transform.decompose(n,i,r),n=n.toArray(),i=new ri().setFromQuaternion(i,e.eulerOrder).toArray(),r=r.toArray(),e.T!==void 0&&Object.keys(e.T.curves).length>0){let s=this.generateVectorTrack(e.modelName,e.T.curves,n,"position");s!==void 0&&t.push(s)}if(e.R!==void 0&&Object.keys(e.R.curves).length>0){let s=this.generateRotationTrack(e.modelName,e.R.curves,i,e.preRotation,e.postRotation,e.eulerOrder);s!==void 0&&t.push(s)}if(e.S!==void 0&&Object.keys(e.S.curves).length>0){let s=this.generateVectorTrack(e.modelName,e.S.curves,r,"scale");s!==void 0&&t.push(s)}if(e.DeformPercent!==void 0){let s=this.generateMorphTrack(e);s!==void 0&&t.push(s)}return t}generateVectorTrack(e,t,n,i){let r=this.getTimesForAllAxes(t),s=this.getKeyframeTrackValues(r,t,n);return new vs(e+"."+i,r,s)}generateRotationTrack(e,t,n,i,r,s){t.x!==void 0&&(this.interpolateRotations(t.x),t.x.values=t.x.values.map(cn.degToRad)),t.y!==void 0&&(this.interpolateRotations(t.y),t.y.values=t.y.values.map(cn.degToRad)),t.z!==void 0&&(this.interpolateRotations(t.z),t.z.values=t.z.values.map(cn.degToRad));let a=this.getTimesForAllAxes(t),l=this.getKeyframeTrackValues(a,t,n);i!==void 0&&(i=i.map(cn.degToRad),i.push(s),i=new ri().fromArray(i),i=new gt().setFromEuler(i)),r!==void 0&&(r=r.map(cn.degToRad),r.push(s),r=new ri().fromArray(r),r=new gt().setFromEuler(r).invert());let c=new gt,u=new ri,d=[];for(let h=0;h<l.length;h+=3)u.set(l[h],l[h+1],l[h+2],s),c.setFromEuler(u),i!==void 0&&c.premultiply(i),r!==void 0&&c.multiply(r),c.toArray(d,h/3*4);return new Hr(e+".quaternion",a,d)}generateMorphTrack(e){let t=e.DeformPercent.curves.morph,n=t.values.map(function(r){return r/100}),i=ui.getObjectByName(e.modelName).morphTargetDictionary[e.morphName];return new ys(e.modelName+".morphTargetInfluences["+i+"]",t.times,n)}getTimesForAllAxes(e){let t=[];if(e.x!==void 0&&(t=t.concat(e.x.times)),e.y!==void 0&&(t=t.concat(e.y.times)),e.z!==void 0&&(t=t.concat(e.z.times)),t=t.sort(function(n,i){return n-i}),t.length>1){let n=1,i=t[0];for(let r=1;r<t.length;r++){let s=t[r];s!==i&&(t[n]=s,i=s,n++)}t=t.slice(0,n)}return t}getKeyframeTrackValues(e,t,n){let i=n,r=[],s=-1,a=-1,l=-1;return e.forEach(function(c){if(t.x&&(s=t.x.times.indexOf(c)),t.y&&(a=t.y.times.indexOf(c)),t.z&&(l=t.z.times.indexOf(c)),s!==-1){let u=t.x.values[s];r.push(u),i[0]=u}else r.push(i[0]);if(a!==-1){let u=t.y.values[a];r.push(u),i[1]=u}else r.push(i[1]);if(l!==-1){let u=t.z.values[l];r.push(u),i[2]=u}else r.push(i[2])}),r}interpolateRotations(e){for(let t=1;t<e.values.length;t++){let n=e.values[t-1],i=e.values[t]-n,r=Math.abs(i);if(r>=180){let s=r/180,a=i/s,l=n+a,c=e.times[t-1],d=(e.times[t]-c)/s,h=c+d,f=[],p=[];for(;h<e.times[t];)f.push(h),h+=d,p.push(l),l+=a;e.times=fL(e.times,t,f),e.values=fL(e.values,t,p)}}}},aL=class{getPrevNode(){return this.nodeStack[this.currentIndent-2]}getCurrentNode(){return this.nodeStack[this.currentIndent-1]}getCurrentProp(){return this.currentProp}pushStack(e){this.nodeStack.push(e),this.currentIndent+=1}popStack(){this.nodeStack.pop(),this.currentIndent-=1}setCurrentProp(e,t){this.currentProp=e,this.currentPropName=t}parse(e){this.currentIndent=0,this.allNodes=new _b,this.nodeStack=[],this.currentProp=[],this.currentPropName="";let t=this,n=e.split(/[\r\n]+/);return n.forEach(function(i,r){let s=i.match(/^[\s\t]*;/),a=i.match(/^[\s\t]*$/);if(s||a)return;let l=i.match("^\\t{"+t.currentIndent+"}(\\w+):(.*){",""),c=i.match("^\\t{"+t.currentIndent+"}(\\w+):[\\s\\t\\r\\n](.*)"),u=i.match("^\\t{"+(t.currentIndent-1)+"}}");l?t.parseNodeBegin(i,l):c?t.parseNodeProperty(i,c,n[++r]):u?t.popStack():i.match(/^[^\s\t}]/)&&t.parseNodePropertyContinued(i)}),this.allNodes}parseNodeBegin(e,t){let n=t[1].trim().replace(/^"/,"").replace(/"$/,""),i=t[2].split(",").map(function(l){return l.trim().replace(/^"/,"").replace(/"$/,"")}),r={name:n},s=this.parseNodeAttr(i),a=this.getCurrentNode();this.currentIndent===0?this.allNodes.add(n,r):n in a?(n==="PoseNode"?a.PoseNode.push(r):a[n].id!==void 0&&(a[n]={},a[n][a[n].id]=a[n]),s.id!==""&&(a[n][s.id]=r)):typeof s.id=="number"?(a[n]={},a[n][s.id]=r):n!=="Properties70"&&(n==="PoseNode"?a[n]=[r]:a[n]=r),typeof s.id=="number"&&(r.id=s.id),s.name!==""&&(r.attrName=s.name),s.type!==""&&(r.attrType=s.type),this.pushStack(r)}parseNodeAttr(e){let t=e[0];e[0]!==""&&(t=parseInt(e[0]),isNaN(t)&&(t=e[0]));let n="",i="";return e.length>1&&(n=e[1].replace(/^(\w+)::/,""),i=e[2]),{id:t,name:n,type:i}}parseNodeProperty(e,t,n){let i=t[1].replace(/^"/,"").replace(/"$/,"").trim(),r=t[2].replace(/^"/,"").replace(/"$/,"").trim();i==="Content"&&r===","&&(r=n.replace(/"/g,"").replace(/,$/,"").trim());let s=this.getCurrentNode();if(s.name==="Properties70"){this.parseNodeSpecialProperty(e,i,r);return}if(i==="C"){let l=r.split(",").slice(1),c=parseInt(l[0]),u=parseInt(l[1]),d=r.split(",").slice(3);d=d.map(function(h){return h.trim().replace(/^"/,"")}),i="connections",r=[c,u],bV(r,d),s[i]===void 0&&(s[i]=[])}i==="Node"&&(s.id=r),i in s&&Array.isArray(s[i])?s[i].push(r):i!=="a"?s[i]=r:s.a=r,this.setCurrentProp(s,i),i==="a"&&r.slice(-1)!==","&&(s.a=bb(r))}parseNodePropertyContinued(e){let t=this.getCurrentNode();t.a+=e,e.slice(-1)!==","&&(t.a=bb(t.a))}parseNodeSpecialProperty(e,t,n){let i=n.split('",').map(function(u){return u.trim().replace(/^\"/,"").replace(/\s/,"_")}),r=i[0],s=i[1],a=i[2],l=i[3],c=i[4];switch(s){case"int":case"enum":case"bool":case"ULongLong":case"double":case"Number":case"FieldOfView":c=parseFloat(c);break;case"Color":case"ColorRGB":case"Vector3D":case"Lcl_Translation":case"Lcl_Rotation":case"Lcl_Scaling":c=bb(c);break}this.getPrevNode()[r]={type:s,type2:a,flag:l,value:c},this.setCurrentProp(this.getPrevNode(),r)}},lL=class{parse(e){let t=new xb(e);t.skip(23);let n=t.getUint32();if(n<6400)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+n);let i=new _b;for(;!this.endOfContent(t);){let r=this.parseNode(t,n);r!==null&&i.add(r.name,r)}return i}endOfContent(e){return e.size()%16==0?(e.getOffset()+160+16&~15)>=e.size():e.getOffset()+160+16>=e.size()}parseNode(e,t){let n={},i=t>=7500?e.getUint64():e.getUint32(),r=t>=7500?e.getUint64():e.getUint32();t>=7500?e.getUint64():e.getUint32();let s=e.getUint8(),a=e.getString(s);if(i===0)return null;let l=[];for(let h=0;h<r;h++)l.push(this.parseProperty(e));let c=l.length>0?l[0]:"",u=l.length>1?l[1]:"",d=l.length>2?l[2]:"";for(n.singleProperty=r===1&&e.getOffset()===i;i>e.getOffset();){let h=this.parseNode(e,t);h!==null&&this.parseSubNode(a,n,h)}return n.propertyList=l,typeof c=="number"&&(n.id=c),u!==""&&(n.attrName=u),d!==""&&(n.attrType=d),a!==""&&(n.name=a),n}parseSubNode(e,t,n){if(n.singleProperty===!0){let i=n.propertyList[0];Array.isArray(i)?(t[n.name]=n,n.a=i):t[n.name]=i}else if(e==="Connections"&&n.name==="C"){let i=[];n.propertyList.forEach(function(r,s){s!==0&&i.push(r)}),t.connections===void 0&&(t.connections=[]),t.connections.push(i)}else if(n.name==="Properties70")Object.keys(n).forEach(function(r){t[r]=n[r]});else if(e==="Properties70"&&n.name==="P"){let i=n.propertyList[0],r=n.propertyList[1],s=n.propertyList[2],a=n.propertyList[3],l;i.indexOf("Lcl ")===0&&(i=i.replace("Lcl ","Lcl_")),r.indexOf("Lcl ")===0&&(r=r.replace("Lcl ","Lcl_")),r==="Color"||r==="ColorRGB"||r==="Vector"||r==="Vector3D"||r.indexOf("Lcl_")===0?l=[n.propertyList[4],n.propertyList[5],n.propertyList[6]]:l=n.propertyList[4],t[i]={type:r,type2:s,flag:a,value:l}}else t[n.name]===void 0?typeof n.id=="number"?(t[n.name]={},t[n.name][n.id]=n):t[n.name]=n:n.name==="PoseNode"?(Array.isArray(t[n.name])||(t[n.name]=[t[n.name]]),t[n.name].push(n)):t[n.name][n.id]===void 0&&(t[n.name][n.id]=n)}parseProperty(e){let t=e.getString(1),n;switch(t){case"C":return e.getBoolean();case"D":return e.getFloat64();case"F":return e.getFloat32();case"I":return e.getInt32();case"L":return e.getInt64();case"R":return n=e.getUint32(),e.getArrayBuffer(n);case"S":return n=e.getUint32(),e.getString(n);case"Y":return e.getInt16();case"b":case"c":case"d":case"f":case"i":case"l":let i=e.getUint32(),r=e.getUint32(),s=e.getUint32();if(r===0)switch(t){case"b":case"c":return e.getBooleanArray(i);case"d":return e.getFloat64Array(i);case"f":return e.getFloat32Array(i);case"i":return e.getInt32Array(i);case"l":return e.getInt64Array(i)}typeof yb=="undefined"&&console.error("THREE.FBXLoader: External library fflate.min.js required.");let a=Gf(new Uint8Array(e.getArrayBuffer(s))),l=new xb(a.buffer);switch(t){case"b":case"c":return l.getBooleanArray(i);case"d":return l.getFloat64Array(i);case"f":return l.getFloat32Array(i);case"i":return l.getInt32Array(i);case"l":return l.getInt64Array(i)}default:throw new Error("THREE.FBXLoader: Unknown property type "+t)}}},xb=class{constructor(e,t){this.dv=new DataView(e),this.offset=0,this.littleEndian=t!==void 0?t:!0}getOffset(){return this.offset}size(){return this.dv.buffer.byteLength}skip(e){this.offset+=e}getBoolean(){return(this.getUint8()&1)==1}getBooleanArray(e){let t=[];for(let n=0;n<e;n++)t.push(this.getBoolean());return t}getUint8(){let e=this.dv.getUint8(this.offset);return this.offset+=1,e}getInt16(){let e=this.dv.getInt16(this.offset,this.littleEndian);return this.offset+=2,e}getInt32(){let e=this.dv.getInt32(this.offset,this.littleEndian);return this.offset+=4,e}getInt32Array(e){let t=[];for(let n=0;n<e;n++)t.push(this.getInt32());return t}getUint32(){let e=this.dv.getUint32(this.offset,this.littleEndian);return this.offset+=4,e}getInt64(){let e,t;return this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),t&2147483648?(t=~t&4294967295,e=~e&4294967295,e===4294967295&&(t=t+1&4294967295),e=e+1&4294967295,-(t*4294967296+e)):t*4294967296+e}getInt64Array(e){let t=[];for(let n=0;n<e;n++)t.push(this.getInt64());return t}getUint64(){let e,t;return this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),t*4294967296+e}getFloat32(){let e=this.dv.getFloat32(this.offset,this.littleEndian);return this.offset+=4,e}getFloat32Array(e){let t=[];for(let n=0;n<e;n++)t.push(this.getFloat32());return t}getFloat64(){let e=this.dv.getFloat64(this.offset,this.littleEndian);return this.offset+=8,e}getFloat64Array(e){let t=[];for(let n=0;n<e;n++)t.push(this.getFloat64());return t}getArrayBuffer(e){let t=this.dv.buffer.slice(this.offset,this.offset+e);return this.offset+=e,t}getString(e){let t=[];for(let i=0;i<e;i++)t[i]=this.getUint8();let n=t.indexOf(0);return n>=0&&(t=t.slice(0,n)),Mi.decodeText(new Uint8Array(t))}},_b=class{add(e,t){this[e]=t}};function vV(o){let e="Kaydara FBX Binary  \0";return o.byteLength>=e.length&&e===dL(o,0,e.length)}function xV(o){let e=["K","a","y","d","a","r","a","\\","F","B","X","\\","B","i","n","a","r","y","\\","\\"],t=0;function n(i){let r=o[i-1];return o=o.slice(t+i),t++,r}for(let i=0;i<e.length;++i)if(n(1)===e[i])return!1;return!0}function cL(o){let e=/FBXVersion: (\d+)/,t=o.match(e);if(t)return parseInt(t[1]);throw new Error("THREE.FBXLoader: Cannot find the version number for the file given.")}function _V(o){return o/46186158e3}var wV=[];function By(o,e,t,n){let i;switch(n.mappingType){case"ByPolygonVertex":i=o;break;case"ByPolygon":i=e;break;case"ByVertice":i=t;break;case"AllSame":i=n.indices[0];break;default:console.warn("THREE.FBXLoader: unknown attribute mapping type "+n.mappingType)}n.referenceType==="IndexToDirect"&&(i=n.indices[i]);let r=i*n.dataSize,s=r+n.dataSize;return MV(wV,n.buffer,r,s)}var wb=new ri,eh=new U;function uL(o){let e=new Pe,t=new Pe,n=new Pe,i=new Pe,r=new Pe,s=new Pe,a=new Pe,l=new Pe,c=new Pe,u=new Pe,d=new Pe,h=new Pe,f=o.inheritType?o.inheritType:0;if(o.translation&&e.setPosition(eh.fromArray(o.translation)),o.preRotation){let A=o.preRotation.map(cn.degToRad);A.push(o.eulerOrder),t.makeRotationFromEuler(wb.fromArray(A))}if(o.rotation){let A=o.rotation.map(cn.degToRad);A.push(o.eulerOrder),n.makeRotationFromEuler(wb.fromArray(A))}if(o.postRotation){let A=o.postRotation.map(cn.degToRad);A.push(o.eulerOrder),i.makeRotationFromEuler(wb.fromArray(A)),i.invert()}o.scale&&r.scale(eh.fromArray(o.scale)),o.scalingOffset&&a.setPosition(eh.fromArray(o.scalingOffset)),o.scalingPivot&&s.setPosition(eh.fromArray(o.scalingPivot)),o.rotationOffset&&l.setPosition(eh.fromArray(o.rotationOffset)),o.rotationPivot&&c.setPosition(eh.fromArray(o.rotationPivot)),o.parentMatrixWorld&&(d.copy(o.parentMatrix),u.copy(o.parentMatrixWorld));let p=t.clone().multiply(n).multiply(i),g=new Pe;g.extractRotation(u);let v=new Pe;v.copyPosition(u);let y=v.clone().invert().multiply(u),m=g.clone().invert().multiply(y),x=r,_=new Pe;if(f===0)_.copy(g).multiply(p).multiply(m).multiply(x);else if(f===1)_.copy(g).multiply(m).multiply(p).multiply(x);else{let L=new Pe().scale(new U().setFromMatrixScale(d)).clone().invert(),B=m.clone().multiply(L);_.copy(g).multiply(p).multiply(B).multiply(x)}let w=c.clone().invert(),b=s.clone().invert(),M=e.clone().multiply(l).multiply(c).multiply(t).multiply(n).multiply(i).multiply(w).multiply(a).multiply(s).multiply(r).multiply(b),S=new Pe().copyPosition(M),E=u.clone().multiply(S);return h.copyPosition(E),M=h.clone().multiply(_),M.premultiply(u.invert()),M}function hL(o){o=o||0;let e=["ZYX","YZX","XZY","ZXY","YXZ","XYZ"];return o===6?(console.warn("THREE.FBXLoader: unsupported Euler Order: Spherical XYZ. Animations and rotations may be incorrect."),e[0]):e[o]}function bb(o){return o.split(",").map(function(t){return parseFloat(t)})}function dL(o,e,t){return e===void 0&&(e=0),t===void 0&&(t=o.byteLength),Mi.decodeText(new Uint8Array(o,e,t))}function bV(o,e){for(let t=0,n=o.length,i=e.length;t<i;t++,n++)o[n]=e[t]}function MV(o,e,t,n){for(let i=t,r=0;i<n;i++,r++)o[r]=e[i];return o}function fL(o,e,t){return o.slice(0,e).concat(t).concat(o.slice(e))}var Wf=class extends tn{constructor(e){super(e);this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(t){return new gL(t)}),this.register(function(t){return new vL(t)}),this.register(function(t){return new xL(t)}),this.register(function(t){return new yL(t)}),this.register(function(t){return new pL(t)}),this.register(function(t){return new _L(t)})}load(e,t,n,i){let r=this,s;this.resourcePath!==""?s=this.resourcePath:this.path!==""?s=this.path:s=Mi.extractUrlBase(e),this.manager.itemStart(e);let a=function(c){i?i(c):console.error(c),r.manager.itemError(e),r.manager.itemEnd(e)},l=new mn(this.manager);l.setPath(this.path),l.setResponseType("arraybuffer"),l.setRequestHeader(this.requestHeader),l.setWithCredentials(this.withCredentials),l.load(e,function(c){try{r.parse(c,s,function(u){t(u),r.manager.itemEnd(e)},a)}catch(u){a(u)}},n,a)}setDRACOLoader(e){return this.dracoLoader=e,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return this.pluginCallbacks.indexOf(e)===-1&&this.pluginCallbacks.push(e),this}unregister(e){return this.pluginCallbacks.indexOf(e)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,n,i){let r,s={},a={};if(typeof e=="string")r=e;else if(Mi.decodeText(new Uint8Array(e,0,4))===wL){try{s[St.KHR_BINARY_GLTF]=new ML(e)}catch(d){i&&i(d);return}r=s[St.KHR_BINARY_GLTF].content}else r=Mi.decodeText(new Uint8Array(e));let l=JSON.parse(r);if(l.asset===void 0||l.asset.version[0]<2){i&&i(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));return}let c=new DL(l,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});c.fileLoader.setRequestHeader(this.requestHeader);for(let u=0;u<this.pluginCallbacks.length;u++){let d=this.pluginCallbacks[u](c);a[d.name]=d,s[d.name]=!0}if(l.extensionsUsed)for(let u=0;u<l.extensionsUsed.length;++u){let d=l.extensionsUsed[u],h=l.extensionsRequired||[];switch(d){case St.KHR_MATERIALS_UNLIT:s[d]=new mL;break;case St.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:s[d]=new EL;break;case St.KHR_DRACO_MESH_COMPRESSION:s[d]=new SL(l,this.dracoLoader);break;case St.KHR_TEXTURE_TRANSFORM:s[d]=new TL;break;case St.KHR_MESH_QUANTIZATION:s[d]=new AL;break;default:h.indexOf(d)>=0&&a[d]===void 0&&console.warn('THREE.GLTFLoader: Unknown extension "'+d+'".')}}c.setExtensions(s),c.setPlugins(a),c.parse(n,i)}};function SV(){let o={};return{get:function(e){return o[e]},add:function(e,t){o[e]=t},remove:function(e){delete o[e]},removeAll:function(){o={}}}}var St={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:"KHR_materials_pbrSpecularGlossiness",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression"},pL=class{constructor(e){this.parser=e,this.name=St.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){let e=this.parser,t=this.parser.json.nodes||[];for(let n=0,i=t.length;n<i;n++){let r=t[n];r.extensions&&r.extensions[this.name]&&r.extensions[this.name].light!==void 0&&e._addNodeRef(this.cache,r.extensions[this.name].light)}}_loadLight(e){let t=this.parser,n="light:"+e,i=t.cache.get(n);if(i)return i;let r=t.json,l=((r.extensions&&r.extensions[this.name]||{}).lights||[])[e],c,u=new De(16777215);l.color!==void 0&&u.fromArray(l.color);let d=l.range!==void 0?l.range:0;switch(l.type){case"directional":c=new bs(u),c.target.position.set(0,0,-1),c.add(c.target);break;case"point":c=new Xr(u),c.distance=d;break;case"spot":c=new ws(u),c.distance=d,l.spot=l.spot||{},l.spot.innerConeAngle=l.spot.innerConeAngle!==void 0?l.spot.innerConeAngle:0,l.spot.outerConeAngle=l.spot.outerConeAngle!==void 0?l.spot.outerConeAngle:Math.PI/4,c.angle=l.spot.outerConeAngle,c.penumbra=1-l.spot.innerConeAngle/l.spot.outerConeAngle,c.target.position.set(0,0,-1),c.add(c.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+l.type)}return c.position.set(0,0,0),c.decay=2,l.intensity!==void 0&&(c.intensity=l.intensity),c.name=t.createUniqueName(l.name||"light_"+e),i=Promise.resolve(c),t.cache.add(n,i),i}createNodeAttachment(e){let t=this,n=this.parser,r=n.json.nodes[e],a=(r.extensions&&r.extensions[this.name]||{}).light;return a===void 0?null:this._loadLight(a).then(function(l){return n._getNodeRef(t.cache,a,l)})}},mL=class{constructor(){this.name=St.KHR_MATERIALS_UNLIT}getMaterialType(){return Jt}extendParams(e,t,n){let i=[];e.color=new De(1,1,1),e.opacity=1;let r=t.pbrMetallicRoughness;if(r){if(Array.isArray(r.baseColorFactor)){let s=r.baseColorFactor;e.color.fromArray(s),e.opacity=s[3]}r.baseColorTexture!==void 0&&i.push(n.assignTexture(e,"map",r.baseColorTexture))}return Promise.all(i)}},gL=class{constructor(e){this.parser=e,this.name=St.KHR_MATERIALS_CLEARCOAT}getMaterialType(e){let n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:Ol}extendMaterialParams(e,t){let n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();let r=[],s=i.extensions[this.name];if(s.clearcoatFactor!==void 0&&(t.clearcoat=s.clearcoatFactor),s.clearcoatTexture!==void 0&&r.push(n.assignTexture(t,"clearcoatMap",s.clearcoatTexture)),s.clearcoatRoughnessFactor!==void 0&&(t.clearcoatRoughness=s.clearcoatRoughnessFactor),s.clearcoatRoughnessTexture!==void 0&&r.push(n.assignTexture(t,"clearcoatRoughnessMap",s.clearcoatRoughnessTexture)),s.clearcoatNormalTexture!==void 0&&(r.push(n.assignTexture(t,"clearcoatNormalMap",s.clearcoatNormalTexture)),s.clearcoatNormalTexture.scale!==void 0)){let a=s.clearcoatNormalTexture.scale;t.clearcoatNormalScale=new _e(a,-a)}return Promise.all(r)}},yL=class{constructor(e){this.parser=e,this.name=St.KHR_MATERIALS_TRANSMISSION}getMaterialType(e){let n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:Ol}extendMaterialParams(e,t){let n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();let r=[],s=i.extensions[this.name];return s.transmissionFactor!==void 0&&(t.transmission=s.transmissionFactor),s.transmissionTexture!==void 0&&r.push(n.assignTexture(t,"transmissionMap",s.transmissionTexture)),Promise.all(r)}},vL=class{constructor(e){this.parser=e,this.name=St.KHR_TEXTURE_BASISU}loadTexture(e){let t=this.parser,n=t.json,i=n.textures[e];if(!i.extensions||!i.extensions[this.name])return null;let r=i.extensions[this.name],s=n.images[r.source],a=t.options.ktx2Loader;if(!a){if(n.extensionsRequired&&n.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return t.loadTextureImage(e,s,a)}},xL=class{constructor(e){this.parser=e,this.name=St.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(e){let t=this.name,n=this.parser,i=n.json,r=i.textures[e];if(!r.extensions||!r.extensions[t])return null;let s=r.extensions[t],a=i.images[s.source],l=n.textureLoader;if(a.uri){let c=n.options.manager.getHandler(a.uri);c!==null&&(l=c)}return this.detectSupport().then(function(c){if(c)return n.loadTextureImage(e,a,l);if(i.extensionsRequired&&i.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return n.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){let t=new Image;t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",t.onload=t.onerror=function(){e(t.height===1)}})),this.isSupported}},_L=class{constructor(e){this.name=St.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){let t=this.parser.json,n=t.bufferViews[e];if(n.extensions&&n.extensions[this.name]){let i=n.extensions[this.name],r=this.parser.getDependency("buffer",i.buffer),s=this.parser.options.meshoptDecoder;if(!s||!s.supported){if(t.extensionsRequired&&t.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return Promise.all([r,s.ready]).then(function(a){let l=i.byteOffset||0,c=i.byteLength||0,u=i.count,d=i.byteStride,h=new ArrayBuffer(u*d),f=new Uint8Array(a[0],l,c);return s.decodeGltfBuffer(new Uint8Array(h),u,d,f,i.mode,i.filter),h})}else return null}},wL="glTF",Xf=12,bL={JSON:1313821514,BIN:5130562},ML=class{constructor(e){this.name=St.KHR_BINARY_GLTF,this.content=null,this.body=null;let t=new DataView(e,0,Xf);if(this.header={magic:Mi.decodeText(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==wL)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");let n=this.header.length-Xf,i=new DataView(e,Xf),r=0;for(;r<n;){let s=i.getUint32(r,!0);r+=4;let a=i.getUint32(r,!0);if(r+=4,a===bL.JSON){let l=new Uint8Array(e,Xf+r,s);this.content=Mi.decodeText(l)}else if(a===bL.BIN){let l=Xf+r;this.body=e.slice(l,l+s)}r+=s}if(this.content===null)throw new Error("THREE.GLTFLoader: JSON content not found.")}},SL=class{constructor(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=St.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}decodePrimitive(e,t){let n=this.json,i=this.dracoLoader,r=e.extensions[this.name].bufferView,s=e.extensions[this.name].attributes,a={},l={},c={};for(let u in s){let d=Mb[u]||u.toLowerCase();a[d]=s[u]}for(let u in e.attributes){let d=Mb[u]||u.toLowerCase();if(s[u]!==void 0){let h=n.accessors[e.attributes[u]],f=qf[h.componentType];c[d]=f,l[d]=h.normalized===!0}}return t.getDependency("bufferView",r).then(function(u){return new Promise(function(d){i.decodeDracoFile(u,function(h){for(let f in h.attributes){let p=h.attributes[f],g=l[f];g!==void 0&&(p.normalized=g)}d(h)},a,c)})})}},TL=class{constructor(){this.name=St.KHR_TEXTURE_TRANSFORM}extendTexture(e,t){return t.texCoord!==void 0&&console.warn('THREE.GLTFLoader: Custom UV sets in "'+this.name+'" extension not yet supported.'),t.offset===void 0&&t.rotation===void 0&&t.scale===void 0||(e=e.clone(),t.offset!==void 0&&e.offset.fromArray(t.offset),t.rotation!==void 0&&(e.rotation=t.rotation),t.scale!==void 0&&e.repeat.fromArray(t.scale),e.needsUpdate=!0),e}},Ny=class extends Ur{constructor(e){super();this.isGLTFSpecularGlossinessMaterial=!0;let t=["#ifdef USE_SPECULARMAP","	uniform sampler2D specularMap;","#endif"].join(`
`),n=["#ifdef USE_GLOSSINESSMAP","	uniform sampler2D glossinessMap;","#endif"].join(`
`),i=["vec3 specularFactor = specular;","#ifdef USE_SPECULARMAP","	vec4 texelSpecular = texture2D( specularMap, vUv );","	texelSpecular = sRGBToLinear( texelSpecular );","	// reads channel RGB, compatible with a glTF Specular-Glossiness (RGBA) texture","	specularFactor *= texelSpecular.rgb;","#endif"].join(`
`),r=["float glossinessFactor = glossiness;","#ifdef USE_GLOSSINESSMAP","	vec4 texelGlossiness = texture2D( glossinessMap, vUv );","	// reads channel A, compatible with a glTF Specular-Glossiness (RGBA) texture","	glossinessFactor *= texelGlossiness.a;","#endif"].join(`
`),s=["PhysicalMaterial material;","material.diffuseColor = diffuseColor.rgb * ( 1. - max( specularFactor.r, max( specularFactor.g, specularFactor.b ) ) );","vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );","float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );","material.specularRoughness = max( 1.0 - glossinessFactor, 0.0525 ); // 0.0525 corresponds to the base mip of a 256 cubemap.","material.specularRoughness += geometryRoughness;","material.specularRoughness = min( material.specularRoughness, 1.0 );","material.specularColor = specularFactor;"].join(`
`),a={specular:{value:new De().setHex(16777215)},glossiness:{value:1},specularMap:{value:null},glossinessMap:{value:null}};this._extraUniforms=a,this.onBeforeCompile=function(l){for(let c in a)l.uniforms[c]=a[c];l.fragmentShader=l.fragmentShader.replace("uniform float roughness;","uniform vec3 specular;").replace("uniform float metalness;","uniform float glossiness;").replace("#include <roughnessmap_pars_fragment>",t).replace("#include <metalnessmap_pars_fragment>",n).replace("#include <roughnessmap_fragment>",i).replace("#include <metalnessmap_fragment>",r).replace("#include <lights_physical_fragment>",s)},Object.defineProperties(this,{specular:{get:function(){return a.specular.value},set:function(l){a.specular.value=l}},specularMap:{get:function(){return a.specularMap.value},set:function(l){a.specularMap.value=l,l?this.defines.USE_SPECULARMAP="":delete this.defines.USE_SPECULARMAP}},glossiness:{get:function(){return a.glossiness.value},set:function(l){a.glossiness.value=l}},glossinessMap:{get:function(){return a.glossinessMap.value},set:function(l){a.glossinessMap.value=l,l?(this.defines.USE_GLOSSINESSMAP="",this.defines.USE_UV=""):(delete this.defines.USE_GLOSSINESSMAP,delete this.defines.USE_UV)}}}),delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this.setValues(e)}copy(e){return super.copy(e),this.specularMap=e.specularMap,this.specular.copy(e.specular),this.glossinessMap=e.glossinessMap,this.glossiness=e.glossiness,delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this}},EL=class{constructor(){this.name=St.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS,this.specularGlossinessParams=["color","map","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissive","emissiveIntensity","emissiveMap","bumpMap","bumpScale","normalMap","normalMapType","displacementMap","displacementScale","displacementBias","specularMap","specular","glossinessMap","glossiness","alphaMap","envMap","envMapIntensity","refractionRatio"]}getMaterialType(){return Ny}extendParams(e,t,n){let i=t.extensions[this.name];e.color=new De(1,1,1),e.opacity=1;let r=[];if(Array.isArray(i.diffuseFactor)){let s=i.diffuseFactor;e.color.fromArray(s),e.opacity=s[3]}if(i.diffuseTexture!==void 0&&r.push(n.assignTexture(e,"map",i.diffuseTexture)),e.emissive=new De(0,0,0),e.glossiness=i.glossinessFactor!==void 0?i.glossinessFactor:1,e.specular=new De(1,1,1),Array.isArray(i.specularFactor)&&e.specular.fromArray(i.specularFactor),i.specularGlossinessTexture!==void 0){let s=i.specularGlossinessTexture;r.push(n.assignTexture(e,"glossinessMap",s)),r.push(n.assignTexture(e,"specularMap",s))}return Promise.all(r)}createMaterial(e){let t=new Ny(e);return t.fog=!0,t.color=e.color,t.map=e.map===void 0?null:e.map,t.lightMap=null,t.lightMapIntensity=1,t.aoMap=e.aoMap===void 0?null:e.aoMap,t.aoMapIntensity=1,t.emissive=e.emissive,t.emissiveIntensity=1,t.emissiveMap=e.emissiveMap===void 0?null:e.emissiveMap,t.bumpMap=e.bumpMap===void 0?null:e.bumpMap,t.bumpScale=1,t.normalMap=e.normalMap===void 0?null:e.normalMap,t.normalMapType=Qs,e.normalScale&&(t.normalScale=e.normalScale),t.displacementMap=null,t.displacementScale=1,t.displacementBias=0,t.specularMap=e.specularMap===void 0?null:e.specularMap,t.specular=e.specular,t.glossinessMap=e.glossinessMap===void 0?null:e.glossinessMap,t.glossiness=e.glossiness,t.alphaMap=null,t.envMap=e.envMap===void 0?null:e.envMap,t.envMapIntensity=1,t.refractionRatio=.98,t}},AL=class{constructor(){this.name=St.KHR_MESH_QUANTIZATION}},jl=class extends hr{constructor(e,t,n,i){super(e,t,n,i)}copySampleValue_(e){let t=this.resultBuffer,n=this.sampleValues,i=this.valueSize,r=e*i*3+i;for(let s=0;s!==i;s++)t[s]=n[r+s];return t}};jl.prototype.beforeStart_=jl.prototype.copySampleValue_;jl.prototype.afterEnd_=jl.prototype.copySampleValue_;jl.prototype.interpolate_=function(o,e,t,n){let i=this.resultBuffer,r=this.sampleValues,s=this.valueSize,a=s*2,l=s*3,c=n-e,u=(t-e)/c,d=u*u,h=d*u,f=o*l,p=f-l,g=-2*h+3*d,v=h-d,y=1-g,m=v-d+u;for(let x=0;x!==s;x++){let _=r[p+x+s],w=r[p+x+a]*c,b=r[f+x+s],M=r[f+x]*c;i[x]=y*_+m*w+g*b+v*M}return i};var vo={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},qf={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},CL={9728:ln,9729:Lt,9984:Wc,9985:Jd,9986:Xc,9987:hs},LL={33071:an,33648:wl,10497:En},RL={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},Mb={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv2",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},Ma={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},TV={CUBICSPLINE:void 0,LINEAR:Jo,STEP:Tl},Sb={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function PL(o,e){return typeof o!="string"||o===""?"":(/^https?:\/\//i.test(e)&&/^\//.test(o)&&(e=e.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(o)||/^data:.*,.*$/i.test(o)||/^blob:.*$/i.test(o)?o:e+o)}function EV(o){return o.DefaultMaterial===void 0&&(o.DefaultMaterial=new Ur({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:Js})),o.DefaultMaterial}function jf(o,e,t){for(let n in t.extensions)o[n]===void 0&&(e.userData.gltfExtensions=e.userData.gltfExtensions||{},e.userData.gltfExtensions[n]=t.extensions[n])}function Yl(o,e){e.extras!==void 0&&(typeof e.extras=="object"?Object.assign(o.userData,e.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+e.extras))}function AV(o,e,t){let n=!1,i=!1;for(let a=0,l=e.length;a<l;a++){let c=e[a];if(c.POSITION!==void 0&&(n=!0),c.NORMAL!==void 0&&(i=!0),n&&i)break}if(!n&&!i)return Promise.resolve(o);let r=[],s=[];for(let a=0,l=e.length;a<l;a++){let c=e[a];if(n){let u=c.POSITION!==void 0?t.getDependency("accessor",c.POSITION):o.attributes.position;r.push(u)}if(i){let u=c.NORMAL!==void 0?t.getDependency("accessor",c.NORMAL):o.attributes.normal;s.push(u)}}return Promise.all([Promise.all(r),Promise.all(s)]).then(function(a){let l=a[0],c=a[1];return n&&(o.morphAttributes.position=l),i&&(o.morphAttributes.normal=c),o.morphTargetsRelative=!0,o})}function CV(o,e){if(o.updateMorphTargets(),e.weights!==void 0)for(let t=0,n=e.weights.length;t<n;t++)o.morphTargetInfluences[t]=e.weights[t];if(e.extras&&Array.isArray(e.extras.targetNames)){let t=e.extras.targetNames;if(o.morphTargetInfluences.length===t.length){o.morphTargetDictionary={};for(let n=0,i=t.length;n<i;n++)o.morphTargetDictionary[t[n]]=n}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function LV(o){let e=o.extensions&&o.extensions[St.KHR_DRACO_MESH_COMPRESSION],t;return e?t="draco:"+e.bufferView+":"+e.indices+":"+IL(e.attributes):t=o.indices+":"+IL(o.attributes)+":"+o.mode,t}function IL(o){let e="",t=Object.keys(o).sort();for(let n=0,i=t.length;n<i;n++)e+=t[n]+":"+o[t[n]]+";";return e}function Tb(o){switch(o){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}var DL=class{constructor(e={},t={}){this.json=e,this.extensions={},this.plugins={},this.options=t,this.cache=new SV,this.associations=new Map,this.primitiveCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.textureCache={},this.nodeNamesUsed={},typeof createImageBitmap!="undefined"&&/Firefox/.test(navigator.userAgent)===!1?this.textureLoader=new Lf(this.options.manager):this.textureLoader=new Vr(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new mn(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,t){let n=this,i=this.json,r=this.extensions;this.cache.removeAll(),this._invokeAll(function(s){return s._markDefs&&s._markDefs()}),Promise.all(this._invokeAll(function(s){return s.beforeRoot&&s.beforeRoot()})).then(function(){return Promise.all([n.getDependencies("scene"),n.getDependencies("animation"),n.getDependencies("camera")])}).then(function(s){let a={scene:s[0][i.scene||0],scenes:s[0],animations:s[1],cameras:s[2],asset:i.asset,parser:n,userData:{}};jf(r,a,i),Yl(a,i),Promise.all(n._invokeAll(function(l){return l.afterRoot&&l.afterRoot(a)})).then(function(){e(a)})}).catch(t)}_markDefs(){let e=this.json.nodes||[],t=this.json.skins||[],n=this.json.meshes||[];for(let i=0,r=t.length;i<r;i++){let s=t[i].joints;for(let a=0,l=s.length;a<l;a++)e[s[a]].isBone=!0}for(let i=0,r=e.length;i<r;i++){let s=e[i];s.mesh!==void 0&&(this._addNodeRef(this.meshCache,s.mesh),s.skin!==void 0&&(n[s.mesh].isSkinnedMesh=!0)),s.camera!==void 0&&this._addNodeRef(this.cameraCache,s.camera)}}_addNodeRef(e,t){t!==void 0&&(e.refs[t]===void 0&&(e.refs[t]=e.uses[t]=0),e.refs[t]++)}_getNodeRef(e,t,n){if(e.refs[t]<=1)return n;let i=n.clone();return i.name+="_instance_"+e.uses[t]++,i}_invokeOne(e){let t=Object.values(this.plugins);t.push(this);for(let n=0;n<t.length;n++){let i=e(t[n]);if(i)return i}return null}_invokeAll(e){let t=Object.values(this.plugins);t.unshift(this);let n=[];for(let i=0;i<t.length;i++){let r=e(t[i]);r&&n.push(r)}return n}getDependency(e,t){let n=e+":"+t,i=this.cache.get(n);if(!i){switch(e){case"scene":i=this.loadScene(t);break;case"node":i=this.loadNode(t);break;case"mesh":i=this._invokeOne(function(r){return r.loadMesh&&r.loadMesh(t)});break;case"accessor":i=this.loadAccessor(t);break;case"bufferView":i=this._invokeOne(function(r){return r.loadBufferView&&r.loadBufferView(t)});break;case"buffer":i=this.loadBuffer(t);break;case"material":i=this._invokeOne(function(r){return r.loadMaterial&&r.loadMaterial(t)});break;case"texture":i=this._invokeOne(function(r){return r.loadTexture&&r.loadTexture(t)});break;case"skin":i=this.loadSkin(t);break;case"animation":i=this.loadAnimation(t);break;case"camera":i=this.loadCamera(t);break;default:throw new Error("Unknown type: "+e)}this.cache.add(n,i)}return i}getDependencies(e){let t=this.cache.get(e);if(!t){let n=this,i=this.json[e+(e==="mesh"?"es":"s")]||[];t=Promise.all(i.map(function(r,s){return n.getDependency(e,s)})),this.cache.add(e,t)}return t}loadBuffer(e){let t=this.json.buffers[e],n=this.fileLoader;if(t.type&&t.type!=="arraybuffer")throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(t.uri===void 0&&e===0)return Promise.resolve(this.extensions[St.KHR_BINARY_GLTF].body);let i=this.options;return new Promise(function(r,s){n.load(PL(t.uri,i.path),r,void 0,function(){s(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))})})}loadBufferView(e){let t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then(function(n){let i=t.byteLength||0,r=t.byteOffset||0;return n.slice(r,r+i)})}loadAccessor(e){let t=this,n=this.json,i=this.json.accessors[e];if(i.bufferView===void 0&&i.sparse===void 0)return Promise.resolve(null);let r=[];return i.bufferView!==void 0?r.push(this.getDependency("bufferView",i.bufferView)):r.push(null),i.sparse!==void 0&&(r.push(this.getDependency("bufferView",i.sparse.indices.bufferView)),r.push(this.getDependency("bufferView",i.sparse.values.bufferView))),Promise.all(r).then(function(s){let a=s[0],l=RL[i.type],c=qf[i.componentType],u=c.BYTES_PER_ELEMENT,d=u*l,h=i.byteOffset||0,f=i.bufferView!==void 0?n.bufferViews[i.bufferView].byteStride:void 0,p=i.normalized===!0,g,v;if(f&&f!==d){let y=Math.floor(h/f),m="InterleavedBuffer:"+i.bufferView+":"+i.componentType+":"+y+":"+i.count,x=t.cache.get(m);x||(g=new c(a,y*f,i.count*f/u),x=new ds(g,f/u),t.cache.add(m,x)),v=new kr(x,l,h%f/u,p)}else a===null?g=new c(i.count*l):g=new c(a,h,i.count*l),v=new Ye(g,l,p);if(i.sparse!==void 0){let y=RL.SCALAR,m=qf[i.sparse.indices.componentType],x=i.sparse.indices.byteOffset||0,_=i.sparse.values.byteOffset||0,w=new m(s[1],x,i.sparse.count*y),b=new c(s[2],_,i.sparse.count*l);a!==null&&(v=new Ye(v.array.slice(),v.itemSize,v.normalized));for(let M=0,S=w.length;M<S;M++){let E=w[M];if(v.setX(E,b[M*l]),l>=2&&v.setY(E,b[M*l+1]),l>=3&&v.setZ(E,b[M*l+2]),l>=4&&v.setW(E,b[M*l+3]),l>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return v})}loadTexture(e){let t=this.json,n=this.options,i=t.textures[e],r=t.images[i.source],s=this.textureLoader;if(r.uri){let a=n.manager.getHandler(r.uri);a!==null&&(s=a)}return this.loadTextureImage(e,r,s)}loadTextureImage(e,t,n){let i=this,r=this.json,s=this.options,a=r.textures[e],l=(t.uri||t.bufferView)+":"+a.sampler;if(this.textureCache[l])return this.textureCache[l];let c=self.URL||self.webkitURL,u=t.uri||"",d=!1,h=!0,f=u.search(/\.jpe?g($|\?)/i)>0||u.search(/^data\:image\/jpeg/)===0;if((t.mimeType==="image/jpeg"||f)&&(h=!1),t.bufferView!==void 0)u=i.getDependency("bufferView",t.bufferView).then(function(g){if(t.mimeType==="image/png"){let y=new DataView(g,25,1).getUint8(0,!1);h=y===6||y===4||y===3}d=!0;let v=new Blob([g],{type:t.mimeType});return u=c.createObjectURL(v),u});else if(t.uri===void 0)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");let p=Promise.resolve(u).then(function(g){return new Promise(function(v,y){let m=v;n.isImageBitmapLoader===!0&&(m=function(x){let _=new Vt(x);_.needsUpdate=!0,v(_)}),n.load(PL(g,s.path),m,void 0,y)})}).then(function(g){d===!0&&c.revokeObjectURL(u),g.flipY=!1,a.name&&(g.name=a.name),h||(g.format=Di);let y=(r.samplers||{})[a.sampler]||{};return g.magFilter=CL[y.magFilter]||Lt,g.minFilter=CL[y.minFilter]||hs,g.wrapS=LL[y.wrapS]||En,g.wrapT=LL[y.wrapT]||En,i.associations.set(g,{type:"textures",index:e}),g}).catch(function(){return console.error("THREE.GLTFLoader: Couldn't load texture",u),null});return this.textureCache[l]=p,p}assignTexture(e,t,n){let i=this;return this.getDependency("texture",n.index).then(function(r){if(n.texCoord!==void 0&&n.texCoord!=0&&!(t==="aoMap"&&n.texCoord==1)&&console.warn("THREE.GLTFLoader: Custom UV set "+n.texCoord+" for texture "+t+" not yet supported."),i.extensions[St.KHR_TEXTURE_TRANSFORM]){let s=n.extensions!==void 0?n.extensions[St.KHR_TEXTURE_TRANSFORM]:void 0;if(s){let a=i.associations.get(r);r=i.extensions[St.KHR_TEXTURE_TRANSFORM].extendTexture(r,s),i.associations.set(r,a)}}e[t]=r})}assignFinalMaterial(e){let t=e.geometry,n=e.material,i=t.attributes.tangent!==void 0,r=t.attributes.color!==void 0,s=t.attributes.normal===void 0,a=Object.keys(t.morphAttributes).length>0,l=a&&t.morphAttributes.normal!==void 0;if(e.isPoints){let c="PointsMaterial:"+n.uuid,u=this.cache.get(c);u||(u=new ps,un.prototype.copy.call(u,n),u.color.copy(n.color),u.map=n.map,u.sizeAttenuation=!1,this.cache.add(c,u)),n=u}else if(e.isLine){let c="LineBasicMaterial:"+n.uuid,u=this.cache.get(c);u||(u=new zt,un.prototype.copy.call(u,n),u.color.copy(n.color),this.cache.add(c,u)),n=u}if(i||r||s||a){let c="ClonedMaterial:"+n.uuid+":";n.isGLTFSpecularGlossinessMaterial&&(c+="specular-glossiness:"),i&&(c+="vertex-tangents:"),r&&(c+="vertex-colors:"),s&&(c+="flat-shading:"),a&&(c+="morph-targets:"),l&&(c+="morph-normals:");let u=this.cache.get(c);u||(u=n.clone(),r&&(u.vertexColors=!0),s&&(u.flatShading=!0),a&&(u.morphTargets=!0),l&&(u.morphNormals=!0),i&&(u.vertexTangents=!0,u.normalScale&&(u.normalScale.y*=-1),u.clearcoatNormalScale&&(u.clearcoatNormalScale.y*=-1)),this.cache.add(c,u),this.associations.set(u,this.associations.get(n))),n=u}n.aoMap&&t.attributes.uv2===void 0&&t.attributes.uv!==void 0&&t.setAttribute("uv2",t.attributes.uv),e.material=n}getMaterialType(){return Ur}loadMaterial(e){let t=this,n=this.json,i=this.extensions,r=n.materials[e],s,a={},l=r.extensions||{},c=[];if(l[St.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]){let d=i[St.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS];s=d.getMaterialType(),c.push(d.extendParams(a,r,t))}else if(l[St.KHR_MATERIALS_UNLIT]){let d=i[St.KHR_MATERIALS_UNLIT];s=d.getMaterialType(),c.push(d.extendParams(a,r,t))}else{let d=r.pbrMetallicRoughness||{};if(a.color=new De(1,1,1),a.opacity=1,Array.isArray(d.baseColorFactor)){let h=d.baseColorFactor;a.color.fromArray(h),a.opacity=h[3]}d.baseColorTexture!==void 0&&c.push(t.assignTexture(a,"map",d.baseColorTexture)),a.metalness=d.metallicFactor!==void 0?d.metallicFactor:1,a.roughness=d.roughnessFactor!==void 0?d.roughnessFactor:1,d.metallicRoughnessTexture!==void 0&&(c.push(t.assignTexture(a,"metalnessMap",d.metallicRoughnessTexture)),c.push(t.assignTexture(a,"roughnessMap",d.metallicRoughnessTexture))),s=this._invokeOne(function(h){return h.getMaterialType&&h.getMaterialType(e)}),c.push(Promise.all(this._invokeAll(function(h){return h.extendMaterialParams&&h.extendMaterialParams(e,a)})))}r.doubleSided===!0&&(a.side=Dr);let u=r.alphaMode||Sb.OPAQUE;return u===Sb.BLEND?(a.transparent=!0,a.depthWrite=!1):(a.transparent=!1,u===Sb.MASK&&(a.alphaTest=r.alphaCutoff!==void 0?r.alphaCutoff:.5)),r.normalTexture!==void 0&&s!==Jt&&(c.push(t.assignTexture(a,"normalMap",r.normalTexture)),a.normalScale=new _e(1,-1),r.normalTexture.scale!==void 0&&a.normalScale.set(r.normalTexture.scale,-r.normalTexture.scale)),r.occlusionTexture!==void 0&&s!==Jt&&(c.push(t.assignTexture(a,"aoMap",r.occlusionTexture)),r.occlusionTexture.strength!==void 0&&(a.aoMapIntensity=r.occlusionTexture.strength)),r.emissiveFactor!==void 0&&s!==Jt&&(a.emissive=new De().fromArray(r.emissiveFactor)),r.emissiveTexture!==void 0&&s!==Jt&&c.push(t.assignTexture(a,"emissiveMap",r.emissiveTexture)),Promise.all(c).then(function(){let d;return s===Ny?d=i[St.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].createMaterial(a):d=new s(a),r.name&&(d.name=r.name),d.map&&(d.map.encoding=Vi),d.emissiveMap&&(d.emissiveMap.encoding=Vi),Yl(d,r),t.associations.set(d,{type:"materials",index:e}),r.extensions&&jf(i,d,r),d})}createUniqueName(e){let t=st.sanitizeNodeName(e||""),n=t;for(let i=1;this.nodeNamesUsed[n];++i)n=t+"_"+i;return this.nodeNamesUsed[n]=!0,n}loadGeometries(e){let t=this,n=this.extensions,i=this.primitiveCache;function r(a){return n[St.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(a,t).then(function(l){return BL(l,a,t)})}let s=[];for(let a=0,l=e.length;a<l;a++){let c=e[a],u=LV(c),d=i[u];if(d)s.push(d.promise);else{let h;c.extensions&&c.extensions[St.KHR_DRACO_MESH_COMPRESSION]?h=r(c):h=BL(new Ue,c,t),i[u]={primitive:c,promise:h},s.push(h)}}return Promise.all(s)}loadMesh(e){let t=this,n=this.json,i=this.extensions,r=n.meshes[e],s=r.primitives,a=[];for(let l=0,c=s.length;l<c;l++){let u=s[l].material===void 0?EV(this.cache):this.getDependency("material",s[l].material);a.push(u)}return a.push(t.loadGeometries(s)),Promise.all(a).then(function(l){let c=l.slice(0,l.length-1),u=l[l.length-1],d=[];for(let f=0,p=u.length;f<p;f++){let g=u[f],v=s[f],y,m=c[f];if(v.mode===vo.TRIANGLES||v.mode===vo.TRIANGLE_STRIP||v.mode===vo.TRIANGLE_FAN||v.mode===void 0)y=r.isSkinnedMesh===!0?new lo(g,m):new et(g,m),y.isSkinnedMesh===!0&&!y.geometry.attributes.skinWeight.normalized&&y.normalizeSkinWeights(),v.mode===vo.TRIANGLE_STRIP?y.geometry=NL(y.geometry,s_):v.mode===vo.TRIANGLE_FAN&&(y.geometry=NL(y.geometry,Km));else if(v.mode===vo.LINES)y=new An(g,m);else if(v.mode===vo.LINE_STRIP)y=new ai(g,m);else if(v.mode===vo.LINE_LOOP)y=new xu(g,m);else if(v.mode===vo.POINTS)y=new la(g,m);else throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+v.mode);Object.keys(y.geometry.morphAttributes).length>0&&CV(y,r),y.name=t.createUniqueName(r.name||"mesh_"+e),Yl(y,r),v.extensions&&jf(i,y,v),t.assignFinalMaterial(y),d.push(y)}if(d.length===1)return d[0];let h=new Zn;for(let f=0,p=d.length;f<p;f++)h.add(d[f]);return h})}loadCamera(e){let t,n=this.json.cameras[e],i=n[n.type];if(!i){console.warn("THREE.GLTFLoader: Missing camera parameters.");return}return n.type==="perspective"?t=new It(cn.radToDeg(i.yfov),i.aspectRatio||1,i.znear||1,i.zfar||2e6):n.type==="orthographic"&&(t=new ci(-i.xmag,i.xmag,i.ymag,-i.ymag,i.znear,i.zfar)),n.name&&(t.name=this.createUniqueName(n.name)),Yl(t,n),Promise.resolve(t)}loadSkin(e){let t=this.json.skins[e],n={joints:t.joints};return t.inverseBindMatrices===void 0?Promise.resolve(n):this.getDependency("accessor",t.inverseBindMatrices).then(function(i){return n.inverseBindMatrices=i,n})}loadAnimation(e){let n=this.json.animations[e],i=[],r=[],s=[],a=[],l=[];for(let c=0,u=n.channels.length;c<u;c++){let d=n.channels[c],h=n.samplers[d.sampler],f=d.target,p=f.node!==void 0?f.node:f.id,g=n.parameters!==void 0?n.parameters[h.input]:h.input,v=n.parameters!==void 0?n.parameters[h.output]:h.output;i.push(this.getDependency("node",p)),r.push(this.getDependency("accessor",g)),s.push(this.getDependency("accessor",v)),a.push(h),l.push(f)}return Promise.all([Promise.all(i),Promise.all(r),Promise.all(s),Promise.all(a),Promise.all(l)]).then(function(c){let u=c[0],d=c[1],h=c[2],f=c[3],p=c[4],g=[];for(let y=0,m=u.length;y<m;y++){let x=u[y],_=d[y],w=h[y],b=f[y],M=p[y];if(x===void 0)continue;x.updateMatrix(),x.matrixAutoUpdate=!0;let S;switch(Ma[M.path]){case Ma.weights:S=ys;break;case Ma.rotation:S=Hr;break;case Ma.position:case Ma.scale:default:S=vs;break}let E=x.name?x.name:x.uuid,A=b.interpolation!==void 0?TV[b.interpolation]:Jo,L=[];Ma[M.path]===Ma.weights?x.traverse(function(R){R.isMesh===!0&&R.morphTargetInfluences&&L.push(R.name?R.name:R.uuid)}):L.push(E);let B=w.array;if(w.normalized){let R=Tb(B.constructor),D=new Float32Array(B.length);for(let P=0,I=B.length;P<I;P++)D[P]=B[P]*R;B=D}for(let R=0,D=L.length;R<D;R++){let P=new S(L[R]+"."+Ma[M.path],_.array,B,A);b.interpolation==="CUBICSPLINE"&&(P.createInterpolant=function(N){return new jl(this.times,this.values,this.getValueSize()/3,N)},P.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),g.push(P)}}let v=n.name?n.name:"animation_"+e;return new xs(v,void 0,g)})}createNodeMesh(e){let t=this.json,n=this,i=t.nodes[e];return i.mesh===void 0?null:n.getDependency("mesh",i.mesh).then(function(r){let s=n._getNodeRef(n.meshCache,i.mesh,r);return i.weights!==void 0&&s.traverse(function(a){if(!!a.isMesh)for(let l=0,c=i.weights.length;l<c;l++)a.morphTargetInfluences[l]=i.weights[l]}),s})}loadNode(e){let t=this.json,n=this.extensions,i=this,r=t.nodes[e],s=r.name?i.createUniqueName(r.name):"";return function(){let a=[],l=i._invokeOne(function(c){return c.createNodeMesh&&c.createNodeMesh(e)});return l&&a.push(l),r.camera!==void 0&&a.push(i.getDependency("camera",r.camera).then(function(c){return i._getNodeRef(i.cameraCache,r.camera,c)})),i._invokeAll(function(c){return c.createNodeAttachment&&c.createNodeAttachment(e)}).forEach(function(c){a.push(c)}),Promise.all(a)}().then(function(a){let l;if(r.isBone===!0?l=new fs:a.length>1?l=new Zn:a.length===1?l=a[0]:l=new $e,l!==a[0])for(let c=0,u=a.length;c<u;c++)l.add(a[c]);if(r.name&&(l.userData.name=r.name,l.name=s),Yl(l,r),r.extensions&&jf(n,l,r),r.matrix!==void 0){let c=new Pe;c.fromArray(r.matrix),l.applyMatrix4(c)}else r.translation!==void 0&&l.position.fromArray(r.translation),r.rotation!==void 0&&l.quaternion.fromArray(r.rotation),r.scale!==void 0&&l.scale.fromArray(r.scale);return i.associations.set(l,{type:"nodes",index:e}),l})}loadScene(e){let t=this.json,n=this.extensions,i=this.json.scenes[e],r=this,s=new Zn;i.name&&(s.name=r.createUniqueName(i.name)),Yl(s,i),i.extensions&&jf(n,s,i);let a=i.nodes||[],l=[];for(let c=0,u=a.length;c<u;c++)l.push(FL(a[c],s,t,r));return Promise.all(l).then(function(){return s})}};function FL(o,e,t,n){let i=t.nodes[o];return n.getDependency("node",o).then(function(r){if(i.skin===void 0)return r;let s;return n.getDependency("skin",i.skin).then(function(a){s=a;let l=[];for(let c=0,u=s.joints.length;c<u;c++)l.push(n.getDependency("node",s.joints[c]));return Promise.all(l)}).then(function(a){return r.traverse(function(l){if(!l.isMesh)return;let c=[],u=[];for(let d=0,h=a.length;d<h;d++){let f=a[d];if(f){c.push(f);let p=new Pe;s.inverseBindMatrices!==void 0&&p.fromArray(s.inverseBindMatrices.array,d*16),u.push(p)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',s.joints[d])}l.bind(new co(c,u),l.matrixWorld)}),r})}).then(function(r){e.add(r);let s=[];if(i.children){let a=i.children;for(let l=0,c=a.length;l<c;l++){let u=a[l];s.push(FL(u,r,t,n))}}return Promise.all(s)})}function RV(o,e,t){let n=e.attributes,i=new Sn;if(n.POSITION!==void 0){let a=t.json.accessors[n.POSITION],l=a.min,c=a.max;if(l!==void 0&&c!==void 0){if(i.set(new U(l[0],l[1],l[2]),new U(c[0],c[1],c[2])),a.normalized){let u=Tb(qf[a.componentType]);i.min.multiplyScalar(u),i.max.multiplyScalar(u)}}else{console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");return}}else return;let r=e.targets;if(r!==void 0){let a=new U,l=new U;for(let c=0,u=r.length;c<u;c++){let d=r[c];if(d.POSITION!==void 0){let h=t.json.accessors[d.POSITION],f=h.min,p=h.max;if(f!==void 0&&p!==void 0){if(l.setX(Math.max(Math.abs(f[0]),Math.abs(p[0]))),l.setY(Math.max(Math.abs(f[1]),Math.abs(p[1]))),l.setZ(Math.max(Math.abs(f[2]),Math.abs(p[2]))),h.normalized){let g=Tb(qf[h.componentType]);l.multiplyScalar(g)}a.max(l)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}i.expandByVector(a)}o.boundingBox=i;let s=new qi;i.getCenter(s.center),s.radius=i.min.distanceTo(i.max)/2,o.boundingSphere=s}function BL(o,e,t){let n=e.attributes,i=[];function r(s,a){return t.getDependency("accessor",s).then(function(l){o.setAttribute(a,l)})}for(let s in n){let a=Mb[s]||s.toLowerCase();a in o.attributes||i.push(r(n[s],a))}if(e.indices!==void 0&&!o.index){let s=t.getDependency("accessor",e.indices).then(function(a){o.setIndex(a)});i.push(s)}return Yl(o,e),RV(o,e,t),Promise.all(i).then(function(){return e.targets!==void 0?AV(o,e.targets,t):o})}function NL(o,e){let t=o.getIndex();if(t===null){let s=[],a=o.getAttribute("position");if(a!==void 0){for(let l=0;l<a.count;l++)s.push(l);o.setIndex(s),t=o.getIndex()}else return console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),o}let n=t.count-2,i=[];if(e===Km)for(let s=1;s<=n;s++)i.push(t.getX(0)),i.push(t.getX(s)),i.push(t.getX(s+1));else for(let s=0;s<n;s++)s%2==0?(i.push(t.getX(s)),i.push(t.getX(s+1)),i.push(t.getX(s+2))):(i.push(t.getX(s+2)),i.push(t.getX(s+1)),i.push(t.getX(s)));i.length/3!==n&&console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");let r=o.clone();return r.setIndex(i),r}var OL=function(o,e,t,n){function i(r){return r instanceof t?r:new t(function(s){s(r)})}return new(t||(t=Promise))(function(r,s){function a(u){try{c(n.next(u))}catch(d){s(d)}}function l(u){try{c(n.throw(u))}catch(d){s(d)}}function c(u){u.done?r(u.value):i(u.value).then(a,l)}c((n=n.apply(o,e||[])).next())})},Yf=class{constructor(e,t){this.cache=e,this.textureAnisotropy=t}get fileLoader(){return this._fileLoader||(this._fileLoader=new mn),this._fileLoader}get imageLoader(){return this._imgLoader||(this._imgLoader=new pa),this._imgLoader}get svgLoader(){return this._svgLoader||(this._svgLoader=new Xl),this._svgLoader}get textureLoader(){return this._textureLoader||(this._textureLoader=new Vr),this._textureLoader}get objectLoader(){return this._objectLoader||(this._objectLoader=new ly),this._objectLoader}get gltfLoader(){return this._gltfLoader||(this._gltfLoader=new Wf),this._gltfLoader}get fbxLoader(){return this._fbxLoader||(this._fbxLoader=new vb),this._fbxLoader}preload(e,t){return OL(this,void 0,void 0,function*(){return this.cache.add(e,t),new Promise(n=>{let i=/\.fbx$|\.glb$|\.gltf$/.test(t);/\.jpe?g$|\.png$/.test(t)?this.textureLoader.load(t,s=>n(s)):(i&&this.fileLoader.setResponseType("arraybuffer"),this.fileLoader.load(t,s=>n(s)))})})}textureAtlas(e,t,n="JSONHash"){return OL(this,void 0,void 0,function*(){let i=JSON.parse(yield this.file(t));if(i.textures){let a=i.textures[0].frames,l={frames:{}};a.forEach(c=>{l=Object.assign(Object.assign({},l),{frames:Object.assign(Object.assign({},l.frames),{[c.filename]:{frame:c.frame,rotated:c.rotated,sourceSize:c.sourceSize,spriteSourceSize:c.spriteSourceSize,trimmed:c.trimmed}})})}),i=l}return{texture:yield this.texture(e),json:i}})}file(e){let t=this.cache.get(e);return e=t||e,new Promise(n=>{this.fileLoader.load(e,i=>n(i))})}svg(e){let t=this.cache.get(e);return e=t||e,new Promise(n=>{this.svgLoader.load(e,i=>n(i))})}texture(e){if(!/^data:image\/[\S]+;base64,/gm.test(e)){let n=this.cache.get(e);e=n||e}return new Promise(n=>{this.textureLoader.load(e,i=>{i.anisotropy=this.textureAnisotropy,i.needsUpdate=!0,n(i)})})}object(e){let t=this.cache.get(e);return e=t||e,new Promise(n=>{this.objectLoader.load(e,i=>{n(i)})})}gltf(e){let t=this.cache.get(e);return e=t||e,new Promise(n=>{this.gltfLoader.load(e,i=>{n(i)})})}fbx(e){let t=this.cache.get(e);return e=t||e,new Promise(n=>{this.fbxLoader.load(e,i=>{n(i)})})}};var kL=class extends $e{constructor(e,t,n,i){super();this.scene=e,this.light=t,this.size=n,this.color=i,this.geo=new Ji(n||.2,16,8),this.mat=new Jt({color:i||t.color}),this.mesh=new et(this.geo,this.mat),this.add(this.mesh),t.add(this)}dispose(){this.mesh.geometry.dispose(),Array.isArray(this.mesh.material)?this.mesh.material.forEach(e=>e.dispose()):this.mesh.material.dispose(),this.remove(this.mesh)}update(){}},Zf=class{constructor(e){this.scene=e}get helper(){return{directionalLightHelper:(e,t,n)=>{let i=new gy(e,t,n);return this.scene.add(i),i},spotLightHelper:(e,t)=>{let n=new fy(e,t);return this.scene.add(n),n},pointLightHelper:(e,t,n)=>new kL(this.scene,e,t,n)}}directionalLight(e={}){let{color:t=16777215,intensity:n=1}=e,i=new bs(t,n);return i.castShadow=!0,this.scene.add(i),i}hemisphereLight(e={}){let{skyColor:t=16777215,groundColor:n=16777215,intensity:i=1}=e,r=new Du(t,n,i);return this.scene.add(r),r}ambientLight(e={}){let{color:t=16777215,intensity:n=1}=e,i=new ma(t,n);return this.scene.add(i),i}pointLight(e={}){let{color:t=16777215,intensity:n=1,distance:i=0,decay:r=1}=e,s=new Xr(t,n,i,r);return s.castShadow=!0,this.scene.add(s),s}spotLight(e={}){let{color:t=16777215,intensity:n=1,distance:i=0,angle:r=Math.PI/8,penumbra:s=0,decay:a=1}=e,l=new ws(t,n,i,r,s,a);return l.castShadow=!0,this.scene.add(l),l}rectAreaLight(e={}){let{color:t=16777215,intensity:n=1,width:i=10,height:r=10}=e,s=new Fu(t,n,i,r);return this.scene.add(s),s}};var zL="130";var PV=0,UL=1,IV=2;var HL=1,DV=2,Jf=3,Kf=0,Ln=1,Sa=2,GL=1;var $f=0,Qf=1,VL=2,WL=3,XL=4,FV=5,th=100,BV=101,NV=102,qL=103,jL=104,OV=200,kV=201,zV=202,UV=203,YL=204,ZL=205,HV=206,GV=207,VV=208,WV=209,XV=210,qV=0,jV=1,YV=2,Eb=3,ZV=4,JV=5,KV=6,$V=7,Oy=0,QV=1,e5=2,nh=0,t5=1,n5=2,i5=3,r5=4,s5=5,JL=300,Ab=301,Cb=302,KL=303,$L=304,Lb=306,Rb=307,Pb=1e3,Ki=1001,Ib=1002,hi=1003,QL=1004;var eR=1005;var xr=1006,o5=1007;var ky=1008;var zy=1009,a5=1010,l5=1011,Uy=1012,c5=1013,Hy=1014,Zl=1015,ih=1016,u5=1017,h5=1018,d5=1019,ep=1020,f5=1021,Jl=1022,Cs=1023,p5=1024,m5=1025;var rh=1026,tp=1027,g5=1028,y5=1029,v5=1030,x5=1031,_5=1032,w5=1033,tR=33776,nR=33777,iR=33778,rR=33779,sR=35840,oR=35841,aR=35842,lR=35843,b5=36196,cR=37492,uR=37496,M5=37808,S5=37809,T5=37810,E5=37811,A5=37812,C5=37813,L5=37814,R5=37815,P5=37816,I5=37817,D5=37818,F5=37819,B5=37820,N5=37821,O5=36492,k5=37840,z5=37841,U5=37842,H5=37843,G5=37844,V5=37845,W5=37846,X5=37847,q5=37848,j5=37849,Y5=37850,Z5=37851,J5=37852,K5=37853,$5=2200,Q5=2201,eW=2202,Gy=2300,Vy=2301,Db=2302,sh=2400,oh=2401,Wy=2402,Fb=2500,hR=2501,tW=0;var ah=3e3,Bb=3001,dR=3007,fR=3002,nW=3003,pR=3004,mR=3005,gR=3006,iW=3200,rW=3201,lh=0,sW=1;var Nb=7680;var oW=519,np=35044,Xy=35048;var yR="300 es",Ta=class{addEventListener(e,t){this._listeners===void 0&&(this._listeners={});let n=this._listeners;n[e]===void 0&&(n[e]=[]),n[e].indexOf(t)===-1&&n[e].push(t)}hasEventListener(e,t){if(this._listeners===void 0)return!1;let n=this._listeners;return n[e]!==void 0&&n[e].indexOf(t)!==-1}removeEventListener(e,t){if(this._listeners===void 0)return;let i=this._listeners[e];if(i!==void 0){let r=i.indexOf(t);r!==-1&&i.splice(r,1)}}dispatchEvent(e){if(this._listeners===void 0)return;let n=this._listeners[e.type];if(n!==void 0){e.target=this;let i=n.slice(0);for(let r=0,s=i.length;r<s;r++)i[r].call(this,e);e.target=null}}},Jn=[];for(let o=0;o<256;o++)Jn[o]=(o<16?"0":"")+o.toString(16);var qy=1234567,ip=Math.PI/180,rp=180/Math.PI;function _r(){let o=Math.random()*4294967295|0,e=Math.random()*4294967295|0,t=Math.random()*4294967295|0,n=Math.random()*4294967295|0;return(Jn[o&255]+Jn[o>>8&255]+Jn[o>>16&255]+Jn[o>>24&255]+"-"+Jn[e&255]+Jn[e>>8&255]+"-"+Jn[e>>16&15|64]+Jn[e>>24&255]+"-"+Jn[t&63|128]+Jn[t>>8&255]+"-"+Jn[t>>16&255]+Jn[t>>24&255]+Jn[n&255]+Jn[n>>8&255]+Jn[n>>16&255]+Jn[n>>24&255]).toUpperCase()}function Ti(o,e,t){return Math.max(e,Math.min(t,o))}function Ob(o,e){return(o%e+e)%e}function aW(o,e,t,n,i){return n+(o-e)*(i-n)/(t-e)}function lW(o,e,t){return o!==e?(t-o)/(e-o):0}function sp(o,e,t){return(1-t)*o+t*e}function cW(o,e,t,n){return sp(o,e,1-Math.exp(-t*n))}function uW(o,e=1){return e-Math.abs(Ob(o,e*2)-e)}function hW(o,e,t){return o<=e?0:o>=t?1:(o=(o-e)/(t-e),o*o*(3-2*o))}function dW(o,e,t){return o<=e?0:o>=t?1:(o=(o-e)/(t-e),o*o*o*(o*(o*6-15)+10))}function fW(o,e){return o+Math.floor(Math.random()*(e-o+1))}function pW(o,e){return o+Math.random()*(e-o)}function mW(o){return o*(.5-Math.random())}function gW(o){return o!==void 0&&(qy=o%2147483647),qy=qy*16807%2147483647,(qy-1)/2147483646}function yW(o){return o*ip}function vW(o){return o*rp}function kb(o){return(o&o-1)==0&&o!==0}function xW(o){return Math.pow(2,Math.ceil(Math.log(o)/Math.LN2))}function vR(o){return Math.pow(2,Math.floor(Math.log(o)/Math.LN2))}function _W(o,e,t,n,i){let r=Math.cos,s=Math.sin,a=r(t/2),l=s(t/2),c=r((e+n)/2),u=s((e+n)/2),d=r((e-n)/2),h=s((e-n)/2),f=r((n-e)/2),p=s((n-e)/2);switch(i){case"XYX":o.set(a*u,l*d,l*h,a*c);break;case"YZY":o.set(l*h,a*u,l*d,a*c);break;case"ZXZ":o.set(l*d,l*h,a*u,a*c);break;case"XZX":o.set(a*u,l*p,l*f,a*c);break;case"YXY":o.set(l*f,a*u,l*p,a*c);break;case"ZYZ":o.set(l*p,l*f,a*u,a*c);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+i)}}var xR=Object.freeze({__proto__:null,DEG2RAD:ip,RAD2DEG:rp,generateUUID:_r,clamp:Ti,euclideanModulo:Ob,mapLinear:aW,inverseLerp:lW,lerp:sp,damp:cW,pingpong:uW,smoothstep:hW,smootherstep:dW,randInt:fW,randFloat:pW,randFloatSpread:mW,seededRandom:gW,degToRad:yW,radToDeg:vW,isPowerOfTwo:kb,ceilPowerOfTwo:xW,floorPowerOfTwo:vR,setQuaternionFromProperEuler:_W}),ke=class{constructor(e=0,t=0){this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e,t){return t!==void 0?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this)}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e,t){return t!==void 0?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this)}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){let t=this.x,n=this.y,i=e.elements;return this.x=i[0]*t+i[3]*n+i[6],this.y=i[1]*t+i[4]*n+i[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}clampLength(e,t){let n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){let t=this.x-e.x,n=this.y-e.y;return t*t+n*n}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t,n){return n!==void 0&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){let n=Math.cos(t),i=Math.sin(t),r=this.x-e.x,s=this.y-e.y;return this.x=r*n-s*i+e.x,this.y=r*i+s*n+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}};ke.prototype.isVector2=!0;var Nn=class{constructor(){this.elements=[1,0,0,0,1,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}set(e,t,n,i,r,s,a,l,c){let u=this.elements;return u[0]=e,u[1]=i,u[2]=a,u[3]=t,u[4]=r,u[5]=l,u[6]=n,u[7]=s,u[8]=c,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){let t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],this}extractBasis(e,t,n){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this}setFromMatrix4(e){let t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){let n=e.elements,i=t.elements,r=this.elements,s=n[0],a=n[3],l=n[6],c=n[1],u=n[4],d=n[7],h=n[2],f=n[5],p=n[8],g=i[0],v=i[3],y=i[6],m=i[1],x=i[4],_=i[7],w=i[2],b=i[5],M=i[8];return r[0]=s*g+a*m+l*w,r[3]=s*v+a*x+l*b,r[6]=s*y+a*_+l*M,r[1]=c*g+u*m+d*w,r[4]=c*v+u*x+d*b,r[7]=c*y+u*_+d*M,r[2]=h*g+f*m+p*w,r[5]=h*v+f*x+p*b,r[8]=h*y+f*_+p*M,this}multiplyScalar(e){let t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){let e=this.elements,t=e[0],n=e[1],i=e[2],r=e[3],s=e[4],a=e[5],l=e[6],c=e[7],u=e[8];return t*s*u-t*a*c-n*r*u+n*a*l+i*r*c-i*s*l}invert(){let e=this.elements,t=e[0],n=e[1],i=e[2],r=e[3],s=e[4],a=e[5],l=e[6],c=e[7],u=e[8],d=u*s-a*c,h=a*l-u*r,f=c*r-s*l,p=t*d+n*h+i*f;if(p===0)return this.set(0,0,0,0,0,0,0,0,0);let g=1/p;return e[0]=d*g,e[1]=(i*c-u*n)*g,e[2]=(a*n-i*s)*g,e[3]=h*g,e[4]=(u*t-i*l)*g,e[5]=(i*r-a*t)*g,e[6]=f*g,e[7]=(n*l-c*t)*g,e[8]=(s*t-n*r)*g,this}transpose(){let e,t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){let t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,n,i,r,s,a){let l=Math.cos(r),c=Math.sin(r);return this.set(n*l,n*c,-n*(l*s+c*a)+s+e,-i*c,i*l,-i*(-c*s+l*a)+a+t,0,0,1),this}scale(e,t){let n=this.elements;return n[0]*=e,n[3]*=e,n[6]*=e,n[1]*=t,n[4]*=t,n[7]*=t,this}rotate(e){let t=Math.cos(e),n=Math.sin(e),i=this.elements,r=i[0],s=i[3],a=i[6],l=i[1],c=i[4],u=i[7];return i[0]=t*r+n*l,i[3]=t*s+n*c,i[6]=t*a+n*u,i[1]=-n*r+t*l,i[4]=-n*s+t*c,i[7]=-n*a+t*u,this}translate(e,t){let n=this.elements;return n[0]+=e*n[2],n[3]+=e*n[5],n[6]+=e*n[8],n[1]+=t*n[2],n[4]+=t*n[5],n[7]+=t*n[8],this}equals(e){let t=this.elements,n=e.elements;for(let i=0;i<9;i++)if(t[i]!==n[i])return!1;return!0}fromArray(e,t=0){for(let n=0;n<9;n++)this.elements[n]=e[n+t];return this}toArray(e=[],t=0){let n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e}clone(){return new this.constructor().fromArray(this.elements)}};Nn.prototype.isMatrix3=!0;var ch,Kl=class{static getDataURL(e){if(/^data:/i.test(e.src)||typeof HTMLCanvasElement=="undefined")return e.src;let t;if(e instanceof HTMLCanvasElement)t=e;else{ch===void 0&&(ch=document.createElementNS("http://www.w3.org/1999/xhtml","canvas")),ch.width=e.width,ch.height=e.height;let n=ch.getContext("2d");e instanceof ImageData?n.putImageData(e,0,0):n.drawImage(e,0,0,e.width,e.height),t=ch}return t.width>2048||t.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),t.toDataURL("image/jpeg",.6)):t.toDataURL("image/png")}},wW=0,On=class extends Ta{constructor(e=On.DEFAULT_IMAGE,t=On.DEFAULT_MAPPING,n=Ki,i=Ki,r=xr,s=ky,a=Cs,l=zy,c=1,u=ah){super();Object.defineProperty(this,"id",{value:wW++}),this.uuid=_r(),this.name="",this.image=e,this.mipmaps=[],this.mapping=t,this.wrapS=n,this.wrapT=i,this.magFilter=r,this.minFilter=s,this.anisotropy=c,this.format=a,this.internalFormat=null,this.type=l,this.offset=new ke(0,0),this.repeat=new ke(1,1),this.center=new ke(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Nn,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=u,this.version=0,this.onUpdate=null}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(e){return this.name=e.name,this.image=e.image,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.encoding=e.encoding,this}toJSON(e){let t=e===void 0||typeof e=="string";if(!t&&e.textures[this.uuid]!==void 0)return e.textures[this.uuid];let n={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};if(this.image!==void 0){let i=this.image;if(i.uuid===void 0&&(i.uuid=_r()),!t&&e.images[i.uuid]===void 0){let r;if(Array.isArray(i)){r=[];for(let s=0,a=i.length;s<a;s++)i[s].isDataTexture?r.push(zb(i[s].image)):r.push(zb(i[s]))}else r=zb(i);e.images[i.uuid]={uuid:i.uuid,url:r}}n.image=i.uuid}return t||(e.textures[this.uuid]=n),n}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==JL)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case Pb:e.x=e.x-Math.floor(e.x);break;case Ki:e.x=e.x<0?0:1;break;case Ib:Math.abs(Math.floor(e.x)%2)===1?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x);break}if(e.y<0||e.y>1)switch(this.wrapT){case Pb:e.y=e.y-Math.floor(e.y);break;case Ki:e.y=e.y<0?0:1;break;case Ib:Math.abs(Math.floor(e.y)%2)===1?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y);break}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){e===!0&&this.version++}};On.DEFAULT_IMAGE=void 0;On.DEFAULT_MAPPING=JL;On.prototype.isTexture=!0;function zb(o){return typeof HTMLImageElement!="undefined"&&o instanceof HTMLImageElement||typeof HTMLCanvasElement!="undefined"&&o instanceof HTMLCanvasElement||typeof ImageBitmap!="undefined"&&o instanceof ImageBitmap?Kl.getDataURL(o):o.data?{data:Array.prototype.slice.call(o.data),width:o.width,height:o.height,type:o.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}var Nt=class{constructor(e=0,t=0,n=0,i=1){this.x=e,this.y=t,this.z=n,this.w=i}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,n,i){return this.x=e,this.y=t,this.z=n,this.w=i,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w!==void 0?e.w:1,this}add(e,t){return t!==void 0?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this)}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e,t){return t!==void 0?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this)}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){let t=this.x,n=this.y,i=this.z,r=this.w,s=e.elements;return this.x=s[0]*t+s[4]*n+s[8]*i+s[12]*r,this.y=s[1]*t+s[5]*n+s[9]*i+s[13]*r,this.z=s[2]*t+s[6]*n+s[10]*i+s[14]*r,this.w=s[3]*t+s[7]*n+s[11]*i+s[15]*r,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);let t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,n,i,r,s=.01,a=.1,l=e.elements,c=l[0],u=l[4],d=l[8],h=l[1],f=l[5],p=l[9],g=l[2],v=l[6],y=l[10];if(Math.abs(u-h)<s&&Math.abs(d-g)<s&&Math.abs(p-v)<s){if(Math.abs(u+h)<a&&Math.abs(d+g)<a&&Math.abs(p+v)<a&&Math.abs(c+f+y-3)<a)return this.set(1,0,0,0),this;t=Math.PI;let x=(c+1)/2,_=(f+1)/2,w=(y+1)/2,b=(u+h)/4,M=(d+g)/4,S=(p+v)/4;return x>_&&x>w?x<s?(n=0,i=.707106781,r=.707106781):(n=Math.sqrt(x),i=b/n,r=M/n):_>w?_<s?(n=.707106781,i=0,r=.707106781):(i=Math.sqrt(_),n=b/i,r=S/i):w<s?(n=.707106781,i=.707106781,r=0):(r=Math.sqrt(w),n=M/r,i=S/r),this.set(n,i,r,t),this}let m=Math.sqrt((v-p)*(v-p)+(d-g)*(d-g)+(h-u)*(h-u));return Math.abs(m)<.001&&(m=1),this.x=(v-p)/m,this.y=(d-g)/m,this.z=(h-u)/m,this.w=Math.acos((c+f+y-1)/2),this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this}clampLength(e,t){let n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this.w=e.w+(t.w-e.w)*n,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t,n){return n!==void 0&&console.warn("THREE.Vector4: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}};Nt.prototype.isVector4=!0;var Ls=class extends Ta{constructor(e,t,n={}){super();this.width=e,this.height=t,this.depth=1,this.scissor=new Nt(0,0,e,t),this.scissorTest=!1,this.viewport=new Nt(0,0,e,t),this.texture=new On(void 0,n.mapping,n.wrapS,n.wrapT,n.magFilter,n.minFilter,n.format,n.type,n.anisotropy,n.encoding),this.texture.image={width:e,height:t,depth:1},this.texture.generateMipmaps=n.generateMipmaps!==void 0?n.generateMipmaps:!1,this.texture.minFilter=n.minFilter!==void 0?n.minFilter:xr,this.depthBuffer=n.depthBuffer!==void 0?n.depthBuffer:!0,this.stencilBuffer=n.stencilBuffer!==void 0?n.stencilBuffer:!1,this.depthTexture=n.depthTexture!==void 0?n.depthTexture:null}setTexture(e){e.image={width:this.width,height:this.height,depth:this.depth},this.texture=e}setSize(e,t,n=1){(this.width!==e||this.height!==t||this.depth!==n)&&(this.width=e,this.height=t,this.depth=n,this.texture.image.width=e,this.texture.image.height=t,this.texture.image.depth=n,this.dispose()),this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return new this.constructor().copy(this)}copy(e){return this.width=e.width,this.height=e.height,this.depth=e.depth,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.texture.image={...this.texture.image},this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.depthTexture=e.depthTexture,this}dispose(){this.dispatchEvent({type:"dispose"})}};Ls.prototype.isWebGLRenderTarget=!0;var _R=class extends Ls{constructor(e,t,n){super(e,t);let i=this.texture;this.texture=[];for(let r=0;r<n;r++)this.texture[r]=i.clone()}setSize(e,t,n=1){if(this.width!==e||this.height!==t||this.depth!==n){this.width=e,this.height=t,this.depth=n;for(let i=0,r=this.texture.length;i<r;i++)this.texture[i].image.width=e,this.texture[i].image.height=t,this.texture[i].image.depth=n;this.dispose()}return this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t),this}copy(e){this.dispose(),this.width=e.width,this.height=e.height,this.depth=e.depth,this.viewport.set(0,0,this.width,this.height),this.scissor.set(0,0,this.width,this.height),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.depthTexture=e.depthTexture,this.texture.length=0;for(let t=0,n=e.texture.length;t<n;t++)this.texture[t]=e.texture[t].clone();return this}};_R.prototype.isWebGLMultipleRenderTargets=!0;var Ub=class extends Ls{constructor(e,t,n){super(e,t,n);this.samples=4}copy(e){return super.copy.call(this,e),this.samples=e.samples,this}};Ub.prototype.isWebGLMultisampleRenderTarget=!0;var Kn=class{constructor(e=0,t=0,n=0,i=1){this._x=e,this._y=t,this._z=n,this._w=i}static slerp(e,t,n,i){return console.warn("THREE.Quaternion: Static .slerp() has been deprecated. Use qm.slerpQuaternions( qa, qb, t ) instead."),n.slerpQuaternions(e,t,i)}static slerpFlat(e,t,n,i,r,s,a){let l=n[i+0],c=n[i+1],u=n[i+2],d=n[i+3],h=r[s+0],f=r[s+1],p=r[s+2],g=r[s+3];if(a===0){e[t+0]=l,e[t+1]=c,e[t+2]=u,e[t+3]=d;return}if(a===1){e[t+0]=h,e[t+1]=f,e[t+2]=p,e[t+3]=g;return}if(d!==g||l!==h||c!==f||u!==p){let v=1-a,y=l*h+c*f+u*p+d*g,m=y>=0?1:-1,x=1-y*y;if(x>Number.EPSILON){let w=Math.sqrt(x),b=Math.atan2(w,y*m);v=Math.sin(v*b)/w,a=Math.sin(a*b)/w}let _=a*m;if(l=l*v+h*_,c=c*v+f*_,u=u*v+p*_,d=d*v+g*_,v===1-a){let w=1/Math.sqrt(l*l+c*c+u*u+d*d);l*=w,c*=w,u*=w,d*=w}}e[t]=l,e[t+1]=c,e[t+2]=u,e[t+3]=d}static multiplyQuaternionsFlat(e,t,n,i,r,s){let a=n[i],l=n[i+1],c=n[i+2],u=n[i+3],d=r[s],h=r[s+1],f=r[s+2],p=r[s+3];return e[t]=a*p+u*d+l*f-c*h,e[t+1]=l*p+u*h+c*d-a*f,e[t+2]=c*p+u*f+a*h-l*d,e[t+3]=u*p-a*d-l*h-c*f,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,n,i){return this._x=e,this._y=t,this._z=n,this._w=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t){if(!(e&&e.isEuler))throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");let n=e._x,i=e._y,r=e._z,s=e._order,a=Math.cos,l=Math.sin,c=a(n/2),u=a(i/2),d=a(r/2),h=l(n/2),f=l(i/2),p=l(r/2);switch(s){case"XYZ":this._x=h*u*d+c*f*p,this._y=c*f*d-h*u*p,this._z=c*u*p+h*f*d,this._w=c*u*d-h*f*p;break;case"YXZ":this._x=h*u*d+c*f*p,this._y=c*f*d-h*u*p,this._z=c*u*p-h*f*d,this._w=c*u*d+h*f*p;break;case"ZXY":this._x=h*u*d-c*f*p,this._y=c*f*d+h*u*p,this._z=c*u*p+h*f*d,this._w=c*u*d-h*f*p;break;case"ZYX":this._x=h*u*d-c*f*p,this._y=c*f*d+h*u*p,this._z=c*u*p-h*f*d,this._w=c*u*d+h*f*p;break;case"YZX":this._x=h*u*d+c*f*p,this._y=c*f*d+h*u*p,this._z=c*u*p-h*f*d,this._w=c*u*d-h*f*p;break;case"XZY":this._x=h*u*d-c*f*p,this._y=c*f*d-h*u*p,this._z=c*u*p+h*f*d,this._w=c*u*d+h*f*p;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+s)}return t!==!1&&this._onChangeCallback(),this}setFromAxisAngle(e,t){let n=t/2,i=Math.sin(n);return this._x=e.x*i,this._y=e.y*i,this._z=e.z*i,this._w=Math.cos(n),this._onChangeCallback(),this}setFromRotationMatrix(e){let t=e.elements,n=t[0],i=t[4],r=t[8],s=t[1],a=t[5],l=t[9],c=t[2],u=t[6],d=t[10],h=n+a+d;if(h>0){let f=.5/Math.sqrt(h+1);this._w=.25/f,this._x=(u-l)*f,this._y=(r-c)*f,this._z=(s-i)*f}else if(n>a&&n>d){let f=2*Math.sqrt(1+n-a-d);this._w=(u-l)/f,this._x=.25*f,this._y=(i+s)/f,this._z=(r+c)/f}else if(a>d){let f=2*Math.sqrt(1+a-n-d);this._w=(r-c)/f,this._x=(i+s)/f,this._y=.25*f,this._z=(l+u)/f}else{let f=2*Math.sqrt(1+d-n-a);this._w=(s-i)/f,this._x=(r+c)/f,this._y=(l+u)/f,this._z=.25*f}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let n=e.dot(t)+1;return n<Number.EPSILON?(n=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=n):(this._x=0,this._y=-e.z,this._z=e.y,this._w=n)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=n),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(Ti(this.dot(e),-1,1)))}rotateTowards(e,t){let n=this.angleTo(e);if(n===0)return this;let i=Math.min(1,t/n);return this.slerp(e,i),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return e===0?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e,t){return t!==void 0?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(e,t)):this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){let n=e._x,i=e._y,r=e._z,s=e._w,a=t._x,l=t._y,c=t._z,u=t._w;return this._x=n*u+s*a+i*c-r*l,this._y=i*u+s*l+r*a-n*c,this._z=r*u+s*c+n*l-i*a,this._w=s*u-n*a-i*l-r*c,this._onChangeCallback(),this}slerp(e,t){if(t===0)return this;if(t===1)return this.copy(e);let n=this._x,i=this._y,r=this._z,s=this._w,a=s*e._w+n*e._x+i*e._y+r*e._z;if(a<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,a=-a):this.copy(e),a>=1)return this._w=s,this._x=n,this._y=i,this._z=r,this;let l=1-a*a;if(l<=Number.EPSILON){let f=1-t;return this._w=f*s+t*this._w,this._x=f*n+t*this._x,this._y=f*i+t*this._y,this._z=f*r+t*this._z,this.normalize(),this._onChangeCallback(),this}let c=Math.sqrt(l),u=Math.atan2(c,a),d=Math.sin((1-t)*u)/c,h=Math.sin(t*u)/c;return this._w=s*d+this._w*h,this._x=n*d+this._x*h,this._y=i*d+this._y*h,this._z=r*d+this._z*h,this._onChangeCallback(),this}slerpQuaternions(e,t,n){this.copy(e).slerp(t,n)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}};Kn.prototype.isQuaternion=!0;var le=class{constructor(e=0,t=0,n=0){this.x=e,this.y=t,this.z=n}set(e,t,n){return n===void 0&&(n=this.z),this.x=e,this.y=t,this.z=n,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e,t){return t!==void 0?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this)}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e,t){return t!==void 0?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this)}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e,t){return t!==void 0?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(e,t)):(this.x*=e.x,this.y*=e.y,this.z*=e.z,this)}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return e&&e.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(wR.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(wR.setFromAxisAngle(e,t))}applyMatrix3(e){let t=this.x,n=this.y,i=this.z,r=e.elements;return this.x=r[0]*t+r[3]*n+r[6]*i,this.y=r[1]*t+r[4]*n+r[7]*i,this.z=r[2]*t+r[5]*n+r[8]*i,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){let t=this.x,n=this.y,i=this.z,r=e.elements,s=1/(r[3]*t+r[7]*n+r[11]*i+r[15]);return this.x=(r[0]*t+r[4]*n+r[8]*i+r[12])*s,this.y=(r[1]*t+r[5]*n+r[9]*i+r[13])*s,this.z=(r[2]*t+r[6]*n+r[10]*i+r[14])*s,this}applyQuaternion(e){let t=this.x,n=this.y,i=this.z,r=e.x,s=e.y,a=e.z,l=e.w,c=l*t+s*i-a*n,u=l*n+a*t-r*i,d=l*i+r*n-s*t,h=-r*t-s*n-a*i;return this.x=c*l+h*-r+u*-a-d*-s,this.y=u*l+h*-s+d*-r-c*-a,this.z=d*l+h*-a+c*-s-u*-r,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){let t=this.x,n=this.y,i=this.z,r=e.elements;return this.x=r[0]*t+r[4]*n+r[8]*i,this.y=r[1]*t+r[5]*n+r[9]*i,this.z=r[2]*t+r[6]*n+r[10]*i,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this}clampLength(e,t){let n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this}cross(e,t){return t!==void 0?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(e,t)):this.crossVectors(this,e)}crossVectors(e,t){let n=e.x,i=e.y,r=e.z,s=t.x,a=t.y,l=t.z;return this.x=i*l-r*a,this.y=r*s-n*l,this.z=n*a-i*s,this}projectOnVector(e){let t=e.lengthSq();if(t===0)return this.set(0,0,0);let n=e.dot(this)/t;return this.copy(e).multiplyScalar(n)}projectOnPlane(e){return Hb.copy(this).projectOnVector(e),this.sub(Hb)}reflect(e){return this.sub(Hb.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){let t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;let n=this.dot(e)/t;return Math.acos(Ti(n,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){let t=this.x-e.x,n=this.y-e.y,i=this.z-e.z;return t*t+n*n+i*i}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,n){let i=Math.sin(t)*e;return this.x=i*Math.sin(n),this.y=Math.cos(t)*e,this.z=i*Math.cos(n),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,n){return this.x=e*Math.sin(t),this.y=n,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){let t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){let t=this.setFromMatrixColumn(e,0).length(),n=this.setFromMatrixColumn(e,1).length(),i=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=n,this.z=i,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,t*4)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,t*3)}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t,n){return n!==void 0&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}};le.prototype.isVector3=!0;var Hb=new le,wR=new Kn,wr=class{constructor(e=new le(1/0,1/0,1/0),t=new le(-1/0,-1/0,-1/0)){this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){let t=1/0,n=1/0,i=1/0,r=-1/0,s=-1/0,a=-1/0;for(let l=0,c=e.length;l<c;l+=3){let u=e[l],d=e[l+1],h=e[l+2];u<t&&(t=u),d<n&&(n=d),h<i&&(i=h),u>r&&(r=u),d>s&&(s=d),h>a&&(a=h)}return this.min.set(t,n,i),this.max.set(r,s,a),this}setFromBufferAttribute(e){let t=1/0,n=1/0,i=1/0,r=-1/0,s=-1/0,a=-1/0;for(let l=0,c=e.count;l<c;l++){let u=e.getX(l),d=e.getY(l),h=e.getZ(l);u<t&&(t=u),d<n&&(n=d),h<i&&(i=h),u>r&&(r=u),d>s&&(s=d),h>a&&(a=h)}return this.min.set(t,n,i),this.max.set(r,s,a),this}setFromPoints(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){let n=op.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}setFromObject(e){return this.makeEmpty(),this.expandByObject(e)}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e){e.updateWorldMatrix(!1,!1);let t=e.geometry;t!==void 0&&(t.boundingBox===null&&t.computeBoundingBox(),Gb.copy(t.boundingBox),Gb.applyMatrix4(e.matrixWorld),this.union(Gb));let n=e.children;for(let i=0,r=n.length;i<r;i++)this.expandByObject(n[i]);return this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)}intersectsSphere(e){return this.clampPoint(e.center,op),op.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,n;return e.normal.x>0?(t=e.normal.x*this.min.x,n=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,n=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,n+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,n+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,n+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,n+=e.normal.z*this.min.z),t<=-e.constant&&n>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(ap),jy.subVectors(this.max,ap),uh.subVectors(e.a,ap),hh.subVectors(e.b,ap),dh.subVectors(e.c,ap),Ea.subVectors(hh,uh),Aa.subVectors(dh,hh),$l.subVectors(uh,dh);let t=[0,-Ea.z,Ea.y,0,-Aa.z,Aa.y,0,-$l.z,$l.y,Ea.z,0,-Ea.x,Aa.z,0,-Aa.x,$l.z,0,-$l.x,-Ea.y,Ea.x,0,-Aa.y,Aa.x,0,-$l.y,$l.x,0];return!Vb(t,uh,hh,dh,jy)||(t=[1,0,0,0,1,0,0,0,1],!Vb(t,uh,hh,dh,jy))?!1:(Yy.crossVectors(Ea,Aa),t=[Yy.x,Yy.y,Yy.z],Vb(t,uh,hh,dh,jy))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return op.copy(e).clamp(this.min,this.max).sub(e).length()}getBoundingSphere(e){return this.getCenter(e.center),e.radius=this.getSize(op).length()*.5,e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()?this:(xo[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),xo[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),xo[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),xo[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),xo[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),xo[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),xo[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),xo[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(xo),this)}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}};wr.prototype.isBox3=!0;var xo=[new le,new le,new le,new le,new le,new le,new le,new le],op=new le,Gb=new wr,uh=new le,hh=new le,dh=new le,Ea=new le,Aa=new le,$l=new le,ap=new le,jy=new le,Yy=new le,Ql=new le;function Vb(o,e,t,n,i){for(let r=0,s=o.length-3;r<=s;r+=3){Ql.fromArray(o,r);let a=i.x*Math.abs(Ql.x)+i.y*Math.abs(Ql.y)+i.z*Math.abs(Ql.z),l=e.dot(Ql),c=t.dot(Ql),u=n.dot(Ql);if(Math.max(-Math.max(l,c,u),Math.min(l,c,u))>a)return!1}return!0}var bW=new wr,bR=new le,Wb=new le,Xb=new le,ec=class{constructor(e=new le,t=-1){this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){let n=this.center;t!==void 0?n.copy(t):bW.setFromPoints(e).getCenter(n);let i=0;for(let r=0,s=e.length;r<s;r++)i=Math.max(i,n.distanceToSquared(e[r]));return this.radius=Math.sqrt(i),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){let t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){let n=this.center.distanceToSquared(e);return t.copy(e),n>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){Xb.subVectors(e,this.center);let t=Xb.lengthSq();if(t>this.radius*this.radius){let n=Math.sqrt(t),i=(n-this.radius)*.5;this.center.add(Xb.multiplyScalar(i/n)),this.radius+=i}return this}union(e){return Wb.subVectors(e.center,this.center).normalize().multiplyScalar(e.radius),this.expandByPoint(bR.copy(e.center).add(Wb)),this.expandByPoint(bR.copy(e.center).sub(Wb)),this}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return new this.constructor().copy(this)}},_o=new le,qb=new le,Zy=new le,Ca=new le,jb=new le,Jy=new le,Yb=new le,tc=class{constructor(e=new le,t=new le(0,0,-1)){this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.direction).multiplyScalar(e).add(this.origin)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,_o)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);let n=t.dot(this.direction);return n<0?t.copy(this.origin):t.copy(this.direction).multiplyScalar(n).add(this.origin)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){let t=_o.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(_o.copy(this.direction).multiplyScalar(t).add(this.origin),_o.distanceToSquared(e))}distanceSqToSegment(e,t,n,i){qb.copy(e).add(t).multiplyScalar(.5),Zy.copy(t).sub(e).normalize(),Ca.copy(this.origin).sub(qb);let r=e.distanceTo(t)*.5,s=-this.direction.dot(Zy),a=Ca.dot(this.direction),l=-Ca.dot(Zy),c=Ca.lengthSq(),u=Math.abs(1-s*s),d,h,f,p;if(u>0)if(d=s*l-a,h=s*a-l,p=r*u,d>=0)if(h>=-p)if(h<=p){let g=1/u;d*=g,h*=g,f=d*(d+s*h+2*a)+h*(s*d+h+2*l)+c}else h=r,d=Math.max(0,-(s*h+a)),f=-d*d+h*(h+2*l)+c;else h=-r,d=Math.max(0,-(s*h+a)),f=-d*d+h*(h+2*l)+c;else h<=-p?(d=Math.max(0,-(-s*r+a)),h=d>0?-r:Math.min(Math.max(-r,-l),r),f=-d*d+h*(h+2*l)+c):h<=p?(d=0,h=Math.min(Math.max(-r,-l),r),f=h*(h+2*l)+c):(d=Math.max(0,-(s*r+a)),h=d>0?r:Math.min(Math.max(-r,-l),r),f=-d*d+h*(h+2*l)+c);else h=s>0?-r:r,d=Math.max(0,-(s*h+a)),f=-d*d+h*(h+2*l)+c;return n&&n.copy(this.direction).multiplyScalar(d).add(this.origin),i&&i.copy(Zy).multiplyScalar(h).add(qb),f}intersectSphere(e,t){_o.subVectors(e.center,this.origin);let n=_o.dot(this.direction),i=_o.dot(_o)-n*n,r=e.radius*e.radius;if(i>r)return null;let s=Math.sqrt(r-i),a=n-s,l=n+s;return a<0&&l<0?null:a<0?this.at(l,t):this.at(a,t)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){let t=e.normal.dot(this.direction);if(t===0)return e.distanceToPoint(this.origin)===0?0:null;let n=-(this.origin.dot(e.normal)+e.constant)/t;return n>=0?n:null}intersectPlane(e,t){let n=this.distanceToPlane(e);return n===null?null:this.at(n,t)}intersectsPlane(e){let t=e.distanceToPoint(this.origin);return t===0||e.normal.dot(this.direction)*t<0}intersectBox(e,t){let n,i,r,s,a,l,c=1/this.direction.x,u=1/this.direction.y,d=1/this.direction.z,h=this.origin;return c>=0?(n=(e.min.x-h.x)*c,i=(e.max.x-h.x)*c):(n=(e.max.x-h.x)*c,i=(e.min.x-h.x)*c),u>=0?(r=(e.min.y-h.y)*u,s=(e.max.y-h.y)*u):(r=(e.max.y-h.y)*u,s=(e.min.y-h.y)*u),n>s||r>i||((r>n||n!==n)&&(n=r),(s<i||i!==i)&&(i=s),d>=0?(a=(e.min.z-h.z)*d,l=(e.max.z-h.z)*d):(a=(e.max.z-h.z)*d,l=(e.min.z-h.z)*d),n>l||a>i)||((a>n||n!==n)&&(n=a),(l<i||i!==i)&&(i=l),i<0)?null:this.at(n>=0?n:i,t)}intersectsBox(e){return this.intersectBox(e,_o)!==null}intersectTriangle(e,t,n,i,r){jb.subVectors(t,e),Jy.subVectors(n,e),Yb.crossVectors(jb,Jy);let s=this.direction.dot(Yb),a;if(s>0){if(i)return null;a=1}else if(s<0)a=-1,s=-s;else return null;Ca.subVectors(this.origin,e);let l=a*this.direction.dot(Jy.crossVectors(Ca,Jy));if(l<0)return null;let c=a*this.direction.dot(jb.cross(Ca));if(c<0||l+c>s)return null;let u=-a*Ca.dot(Yb);return u<0?null:this.at(u/s,r)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}},Qe=class{constructor(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}set(e,t,n,i,r,s,a,l,c,u,d,h,f,p,g,v){let y=this.elements;return y[0]=e,y[4]=t,y[8]=n,y[12]=i,y[1]=r,y[5]=s,y[9]=a,y[13]=l,y[2]=c,y[6]=u,y[10]=d,y[14]=h,y[3]=f,y[7]=p,y[11]=g,y[15]=v,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new Qe().fromArray(this.elements)}copy(e){let t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],this}copyPosition(e){let t=this.elements,n=e.elements;return t[12]=n[12],t[13]=n[13],t[14]=n[14],this}setFromMatrix3(e){let t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,n){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this}makeBasis(e,t,n){return this.set(e.x,t.x,n.x,0,e.y,t.y,n.y,0,e.z,t.z,n.z,0,0,0,0,1),this}extractRotation(e){let t=this.elements,n=e.elements,i=1/fh.setFromMatrixColumn(e,0).length(),r=1/fh.setFromMatrixColumn(e,1).length(),s=1/fh.setFromMatrixColumn(e,2).length();return t[0]=n[0]*i,t[1]=n[1]*i,t[2]=n[2]*i,t[3]=0,t[4]=n[4]*r,t[5]=n[5]*r,t[6]=n[6]*r,t[7]=0,t[8]=n[8]*s,t[9]=n[9]*s,t[10]=n[10]*s,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){e&&e.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");let t=this.elements,n=e.x,i=e.y,r=e.z,s=Math.cos(n),a=Math.sin(n),l=Math.cos(i),c=Math.sin(i),u=Math.cos(r),d=Math.sin(r);if(e.order==="XYZ"){let h=s*u,f=s*d,p=a*u,g=a*d;t[0]=l*u,t[4]=-l*d,t[8]=c,t[1]=f+p*c,t[5]=h-g*c,t[9]=-a*l,t[2]=g-h*c,t[6]=p+f*c,t[10]=s*l}else if(e.order==="YXZ"){let h=l*u,f=l*d,p=c*u,g=c*d;t[0]=h+g*a,t[4]=p*a-f,t[8]=s*c,t[1]=s*d,t[5]=s*u,t[9]=-a,t[2]=f*a-p,t[6]=g+h*a,t[10]=s*l}else if(e.order==="ZXY"){let h=l*u,f=l*d,p=c*u,g=c*d;t[0]=h-g*a,t[4]=-s*d,t[8]=p+f*a,t[1]=f+p*a,t[5]=s*u,t[9]=g-h*a,t[2]=-s*c,t[6]=a,t[10]=s*l}else if(e.order==="ZYX"){let h=s*u,f=s*d,p=a*u,g=a*d;t[0]=l*u,t[4]=p*c-f,t[8]=h*c+g,t[1]=l*d,t[5]=g*c+h,t[9]=f*c-p,t[2]=-c,t[6]=a*l,t[10]=s*l}else if(e.order==="YZX"){let h=s*l,f=s*c,p=a*l,g=a*c;t[0]=l*u,t[4]=g-h*d,t[8]=p*d+f,t[1]=d,t[5]=s*u,t[9]=-a*u,t[2]=-c*u,t[6]=f*d+p,t[10]=h-g*d}else if(e.order==="XZY"){let h=s*l,f=s*c,p=a*l,g=a*c;t[0]=l*u,t[4]=-d,t[8]=c*u,t[1]=h*d+g,t[5]=s*u,t[9]=f*d-p,t[2]=p*d-f,t[6]=a*u,t[10]=g*d+h}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(MW,e,SW)}lookAt(e,t,n){let i=this.elements;return $i.subVectors(e,t),$i.lengthSq()===0&&($i.z=1),$i.normalize(),La.crossVectors(n,$i),La.lengthSq()===0&&(Math.abs(n.z)===1?$i.x+=1e-4:$i.z+=1e-4,$i.normalize(),La.crossVectors(n,$i)),La.normalize(),Ky.crossVectors($i,La),i[0]=La.x,i[4]=Ky.x,i[8]=$i.x,i[1]=La.y,i[5]=Ky.y,i[9]=$i.y,i[2]=La.z,i[6]=Ky.z,i[10]=$i.z,this}multiply(e,t){return t!==void 0?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(e,t)):this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){let n=e.elements,i=t.elements,r=this.elements,s=n[0],a=n[4],l=n[8],c=n[12],u=n[1],d=n[5],h=n[9],f=n[13],p=n[2],g=n[6],v=n[10],y=n[14],m=n[3],x=n[7],_=n[11],w=n[15],b=i[0],M=i[4],S=i[8],E=i[12],A=i[1],L=i[5],B=i[9],R=i[13],D=i[2],P=i[6],I=i[10],N=i[14],G=i[3],z=i[7],se=i[11],ne=i[15];return r[0]=s*b+a*A+l*D+c*G,r[4]=s*M+a*L+l*P+c*z,r[8]=s*S+a*B+l*I+c*se,r[12]=s*E+a*R+l*N+c*ne,r[1]=u*b+d*A+h*D+f*G,r[5]=u*M+d*L+h*P+f*z,r[9]=u*S+d*B+h*I+f*se,r[13]=u*E+d*R+h*N+f*ne,r[2]=p*b+g*A+v*D+y*G,r[6]=p*M+g*L+v*P+y*z,r[10]=p*S+g*B+v*I+y*se,r[14]=p*E+g*R+v*N+y*ne,r[3]=m*b+x*A+_*D+w*G,r[7]=m*M+x*L+_*P+w*z,r[11]=m*S+x*B+_*I+w*se,r[15]=m*E+x*R+_*N+w*ne,this}multiplyScalar(e){let t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){let e=this.elements,t=e[0],n=e[4],i=e[8],r=e[12],s=e[1],a=e[5],l=e[9],c=e[13],u=e[2],d=e[6],h=e[10],f=e[14],p=e[3],g=e[7],v=e[11],y=e[15];return p*(+r*l*d-i*c*d-r*a*h+n*c*h+i*a*f-n*l*f)+g*(+t*l*f-t*c*h+r*s*h-i*s*f+i*c*u-r*l*u)+v*(+t*c*d-t*a*f-r*s*d+n*s*f+r*a*u-n*c*u)+y*(-i*a*u-t*l*d+t*a*h+i*s*d-n*s*h+n*l*u)}transpose(){let e=this.elements,t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,n){let i=this.elements;return e.isVector3?(i[12]=e.x,i[13]=e.y,i[14]=e.z):(i[12]=e,i[13]=t,i[14]=n),this}invert(){let e=this.elements,t=e[0],n=e[1],i=e[2],r=e[3],s=e[4],a=e[5],l=e[6],c=e[7],u=e[8],d=e[9],h=e[10],f=e[11],p=e[12],g=e[13],v=e[14],y=e[15],m=d*v*c-g*h*c+g*l*f-a*v*f-d*l*y+a*h*y,x=p*h*c-u*v*c-p*l*f+s*v*f+u*l*y-s*h*y,_=u*g*c-p*d*c+p*a*f-s*g*f-u*a*y+s*d*y,w=p*d*l-u*g*l-p*a*h+s*g*h+u*a*v-s*d*v,b=t*m+n*x+i*_+r*w;if(b===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);let M=1/b;return e[0]=m*M,e[1]=(g*h*r-d*v*r-g*i*f+n*v*f+d*i*y-n*h*y)*M,e[2]=(a*v*r-g*l*r+g*i*c-n*v*c-a*i*y+n*l*y)*M,e[3]=(d*l*r-a*h*r-d*i*c+n*h*c+a*i*f-n*l*f)*M,e[4]=x*M,e[5]=(u*v*r-p*h*r+p*i*f-t*v*f-u*i*y+t*h*y)*M,e[6]=(p*l*r-s*v*r-p*i*c+t*v*c+s*i*y-t*l*y)*M,e[7]=(s*h*r-u*l*r+u*i*c-t*h*c-s*i*f+t*l*f)*M,e[8]=_*M,e[9]=(p*d*r-u*g*r-p*n*f+t*g*f+u*n*y-t*d*y)*M,e[10]=(s*g*r-p*a*r+p*n*c-t*g*c-s*n*y+t*a*y)*M,e[11]=(u*a*r-s*d*r-u*n*c+t*d*c+s*n*f-t*a*f)*M,e[12]=w*M,e[13]=(u*g*i-p*d*i+p*n*h-t*g*h-u*n*v+t*d*v)*M,e[14]=(p*a*i-s*g*i-p*n*l+t*g*l+s*n*v-t*a*v)*M,e[15]=(s*d*i-u*a*i+u*n*l-t*d*l-s*n*h+t*a*h)*M,this}scale(e){let t=this.elements,n=e.x,i=e.y,r=e.z;return t[0]*=n,t[4]*=i,t[8]*=r,t[1]*=n,t[5]*=i,t[9]*=r,t[2]*=n,t[6]*=i,t[10]*=r,t[3]*=n,t[7]*=i,t[11]*=r,this}getMaxScaleOnAxis(){let e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],n=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],i=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,n,i))}makeTranslation(e,t,n){return this.set(1,0,0,e,0,1,0,t,0,0,1,n,0,0,0,1),this}makeRotationX(e){let t=Math.cos(e),n=Math.sin(e);return this.set(1,0,0,0,0,t,-n,0,0,n,t,0,0,0,0,1),this}makeRotationY(e){let t=Math.cos(e),n=Math.sin(e);return this.set(t,0,n,0,0,1,0,0,-n,0,t,0,0,0,0,1),this}makeRotationZ(e){let t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,0,n,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){let n=Math.cos(t),i=Math.sin(t),r=1-n,s=e.x,a=e.y,l=e.z,c=r*s,u=r*a;return this.set(c*s+n,c*a-i*l,c*l+i*a,0,c*a+i*l,u*a+n,u*l-i*s,0,c*l-i*a,u*l+i*s,r*l*l+n,0,0,0,0,1),this}makeScale(e,t,n){return this.set(e,0,0,0,0,t,0,0,0,0,n,0,0,0,0,1),this}makeShear(e,t,n,i,r,s){return this.set(1,n,r,0,e,1,s,0,t,i,1,0,0,0,0,1),this}compose(e,t,n){let i=this.elements,r=t._x,s=t._y,a=t._z,l=t._w,c=r+r,u=s+s,d=a+a,h=r*c,f=r*u,p=r*d,g=s*u,v=s*d,y=a*d,m=l*c,x=l*u,_=l*d,w=n.x,b=n.y,M=n.z;return i[0]=(1-(g+y))*w,i[1]=(f+_)*w,i[2]=(p-x)*w,i[3]=0,i[4]=(f-_)*b,i[5]=(1-(h+y))*b,i[6]=(v+m)*b,i[7]=0,i[8]=(p+x)*M,i[9]=(v-m)*M,i[10]=(1-(h+g))*M,i[11]=0,i[12]=e.x,i[13]=e.y,i[14]=e.z,i[15]=1,this}decompose(e,t,n){let i=this.elements,r=fh.set(i[0],i[1],i[2]).length(),s=fh.set(i[4],i[5],i[6]).length(),a=fh.set(i[8],i[9],i[10]).length();this.determinant()<0&&(r=-r),e.x=i[12],e.y=i[13],e.z=i[14],Yr.copy(this);let c=1/r,u=1/s,d=1/a;return Yr.elements[0]*=c,Yr.elements[1]*=c,Yr.elements[2]*=c,Yr.elements[4]*=u,Yr.elements[5]*=u,Yr.elements[6]*=u,Yr.elements[8]*=d,Yr.elements[9]*=d,Yr.elements[10]*=d,t.setFromRotationMatrix(Yr),n.x=r,n.y=s,n.z=a,this}makePerspective(e,t,n,i,r,s){s===void 0&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");let a=this.elements,l=2*r/(t-e),c=2*r/(n-i),u=(t+e)/(t-e),d=(n+i)/(n-i),h=-(s+r)/(s-r),f=-2*s*r/(s-r);return a[0]=l,a[4]=0,a[8]=u,a[12]=0,a[1]=0,a[5]=c,a[9]=d,a[13]=0,a[2]=0,a[6]=0,a[10]=h,a[14]=f,a[3]=0,a[7]=0,a[11]=-1,a[15]=0,this}makeOrthographic(e,t,n,i,r,s){let a=this.elements,l=1/(t-e),c=1/(n-i),u=1/(s-r),d=(t+e)*l,h=(n+i)*c,f=(s+r)*u;return a[0]=2*l,a[4]=0,a[8]=0,a[12]=-d,a[1]=0,a[5]=2*c,a[9]=0,a[13]=-h,a[2]=0,a[6]=0,a[10]=-2*u,a[14]=-f,a[3]=0,a[7]=0,a[11]=0,a[15]=1,this}equals(e){let t=this.elements,n=e.elements;for(let i=0;i<16;i++)if(t[i]!==n[i])return!1;return!0}fromArray(e,t=0){for(let n=0;n<16;n++)this.elements[n]=e[n+t];return this}toArray(e=[],t=0){let n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e[t+9]=n[9],e[t+10]=n[10],e[t+11]=n[11],e[t+12]=n[12],e[t+13]=n[13],e[t+14]=n[14],e[t+15]=n[15],e}};Qe.prototype.isMatrix4=!0;var fh=new le,Yr=new Qe,MW=new le(0,0,0),SW=new le(1,1,1),La=new le,Ky=new le,$i=new le,MR=new Qe,SR=new Kn,wo=class{constructor(e=0,t=0,n=0,i=wo.DefaultOrder){this._x=e,this._y=t,this._z=n,this._order=i}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,n,i=this._order){return this._x=e,this._y=t,this._z=n,this._order=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t=this._order,n=!0){let i=e.elements,r=i[0],s=i[4],a=i[8],l=i[1],c=i[5],u=i[9],d=i[2],h=i[6],f=i[10];switch(t){case"XYZ":this._y=Math.asin(Ti(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-u,f),this._z=Math.atan2(-s,r)):(this._x=Math.atan2(h,c),this._z=0);break;case"YXZ":this._x=Math.asin(-Ti(u,-1,1)),Math.abs(u)<.9999999?(this._y=Math.atan2(a,f),this._z=Math.atan2(l,c)):(this._y=Math.atan2(-d,r),this._z=0);break;case"ZXY":this._x=Math.asin(Ti(h,-1,1)),Math.abs(h)<.9999999?(this._y=Math.atan2(-d,f),this._z=Math.atan2(-s,c)):(this._y=0,this._z=Math.atan2(l,r));break;case"ZYX":this._y=Math.asin(-Ti(d,-1,1)),Math.abs(d)<.9999999?(this._x=Math.atan2(h,f),this._z=Math.atan2(l,r)):(this._x=0,this._z=Math.atan2(-s,c));break;case"YZX":this._z=Math.asin(Ti(l,-1,1)),Math.abs(l)<.9999999?(this._x=Math.atan2(-u,c),this._y=Math.atan2(-d,r)):(this._x=0,this._y=Math.atan2(a,f));break;case"XZY":this._z=Math.asin(-Ti(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(h,c),this._y=Math.atan2(a,r)):(this._x=Math.atan2(-u,f),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,n===!0&&this._onChangeCallback(),this}setFromQuaternion(e,t,n){return MR.makeRotationFromQuaternion(e),this.setFromRotationMatrix(MR,t,n)}setFromVector3(e,t=this._order){return this.set(e.x,e.y,e.z,t)}reorder(e){return SR.setFromEuler(this),this.setFromQuaternion(SR,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],e[3]!==void 0&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}toVector3(e){return e?e.set(this._x,this._y,this._z):new le(this._x,this._y,this._z)}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}};wo.prototype.isEuler=!0;wo.DefaultOrder="XYZ";wo.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"];var TR=class{constructor(){this.mask=1|0}set(e){this.mask=1<<e|0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=4294967295|0}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return(this.mask&e.mask)!=0}},TW=0,ER=new le,ph=new Kn,bo=new Qe,$y=new le,lp=new le,EW=new le,AW=new Kn,AR=new le(1,0,0),CR=new le(0,1,0),LR=new le(0,0,1),CW={type:"added"},RR={type:"removed"},Tt=class extends Ta{constructor(){super();Object.defineProperty(this,"id",{value:TW++}),this.uuid=_r(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Tt.DefaultUp.clone();let e=new le,t=new wo,n=new Kn,i=new le(1,1,1);function r(){n.setFromEuler(t,!1)}function s(){t.setFromQuaternion(n,void 0,!1)}t._onChange(r),n._onChange(s),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:n},scale:{configurable:!0,enumerable:!0,value:i},modelViewMatrix:{value:new Qe},normalMatrix:{value:new Nn}}),this.matrix=new Qe,this.matrixWorld=new Qe,this.matrixAutoUpdate=Tt.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new TR,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return ph.setFromAxisAngle(e,t),this.quaternion.multiply(ph),this}rotateOnWorldAxis(e,t){return ph.setFromAxisAngle(e,t),this.quaternion.premultiply(ph),this}rotateX(e){return this.rotateOnAxis(AR,e)}rotateY(e){return this.rotateOnAxis(CR,e)}rotateZ(e){return this.rotateOnAxis(LR,e)}translateOnAxis(e,t){return ER.copy(e).applyQuaternion(this.quaternion),this.position.add(ER.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(AR,e)}translateY(e){return this.translateOnAxis(CR,e)}translateZ(e){return this.translateOnAxis(LR,e)}localToWorld(e){return e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return e.applyMatrix4(bo.copy(this.matrixWorld).invert())}lookAt(e,t,n){e.isVector3?$y.copy(e):$y.set(e,t,n);let i=this.parent;this.updateWorldMatrix(!0,!1),lp.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?bo.lookAt(lp,$y,this.up):bo.lookAt($y,lp,this.up),this.quaternion.setFromRotationMatrix(bo),i&&(bo.extractRotation(i.matrixWorld),ph.setFromRotationMatrix(bo),this.quaternion.premultiply(ph.invert()))}add(e){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(e.parent!==null&&e.parent.remove(e),e.parent=this,this.children.push(e),e.dispatchEvent(CW)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let n=0;n<arguments.length;n++)this.remove(arguments[n]);return this}let t=this.children.indexOf(e);return t!==-1&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(RR)),this}removeFromParent(){let e=this.parent;return e!==null&&e.remove(this),this}clear(){for(let e=0;e<this.children.length;e++){let t=this.children[e];t.parent=null,t.dispatchEvent(RR)}return this.children.length=0,this}attach(e){return this.updateWorldMatrix(!0,!1),bo.copy(this.matrixWorld).invert(),e.parent!==null&&(e.parent.updateWorldMatrix(!0,!1),bo.multiply(e.parent.matrixWorld)),e.applyMatrix4(bo),this.add(e),e.updateWorldMatrix(!1,!0),this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let n=0,i=this.children.length;n<i;n++){let s=this.children[n].getObjectByProperty(e,t);if(s!==void 0)return s}}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(lp,e,EW),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(lp,AW,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);let t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(e){e(this);let t=this.children;for(let n=0,i=t.length;n<i;n++)t[n].traverse(e)}traverseVisible(e){if(this.visible===!1)return;e(this);let t=this.children;for(let n=0,i=t.length;n<i;n++)t[n].traverseVisible(e)}traverseAncestors(e){let t=this.parent;t!==null&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);let t=this.children;for(let n=0,i=t.length;n<i;n++)t[n].updateMatrixWorld(e)}updateWorldMatrix(e,t){let n=this.parent;if(e===!0&&n!==null&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),t===!0){let i=this.children;for(let r=0,s=i.length;r<s;r++)i[r].updateWorldMatrix(!1,!0)}}toJSON(e){let t=e===void 0||typeof e=="string",n={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{}},n.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});let i={};i.uuid=this.uuid,i.type=this.type,this.name!==""&&(i.name=this.name),this.castShadow===!0&&(i.castShadow=!0),this.receiveShadow===!0&&(i.receiveShadow=!0),this.visible===!1&&(i.visible=!1),this.frustumCulled===!1&&(i.frustumCulled=!1),this.renderOrder!==0&&(i.renderOrder=this.renderOrder),JSON.stringify(this.userData)!=="{}"&&(i.userData=this.userData),i.layers=this.layers.mask,i.matrix=this.matrix.toArray(),this.matrixAutoUpdate===!1&&(i.matrixAutoUpdate=!1),this.isInstancedMesh&&(i.type="InstancedMesh",i.count=this.count,i.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(i.instanceColor=this.instanceColor.toJSON()));function r(a,l){return a[l.uuid]===void 0&&(a[l.uuid]=l.toJSON(e)),l.uuid}if(this.isScene)this.background&&(this.background.isColor?i.background=this.background.toJSON():this.background.isTexture&&(i.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&(i.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){i.geometry=r(e.geometries,this.geometry);let a=this.geometry.parameters;if(a!==void 0&&a.shapes!==void 0){let l=a.shapes;if(Array.isArray(l))for(let c=0,u=l.length;c<u;c++){let d=l[c];r(e.shapes,d)}else r(e.shapes,l)}}if(this.isSkinnedMesh&&(i.bindMode=this.bindMode,i.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(r(e.skeletons,this.skeleton),i.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){let a=[];for(let l=0,c=this.material.length;l<c;l++)a.push(r(e.materials,this.material[l]));i.material=a}else i.material=r(e.materials,this.material);if(this.children.length>0){i.children=[];for(let a=0;a<this.children.length;a++)i.children.push(this.children[a].toJSON(e).object)}if(this.animations.length>0){i.animations=[];for(let a=0;a<this.animations.length;a++){let l=this.animations[a];i.animations.push(r(e.animations,l))}}if(t){let a=s(e.geometries),l=s(e.materials),c=s(e.textures),u=s(e.images),d=s(e.shapes),h=s(e.skeletons),f=s(e.animations);a.length>0&&(n.geometries=a),l.length>0&&(n.materials=l),c.length>0&&(n.textures=c),u.length>0&&(n.images=u),d.length>0&&(n.shapes=d),h.length>0&&(n.skeletons=h),f.length>0&&(n.animations=f)}return n.object=i,n;function s(a){let l=[];for(let c in a){let u=a[c];delete u.metadata,l.push(u)}return l}}clone(e){return new this.constructor().copy(this,e)}copy(e,t=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.userData=JSON.parse(JSON.stringify(e.userData)),t===!0)for(let n=0;n<e.children.length;n++){let i=e.children[n];this.add(i.clone())}return this}};Tt.DefaultUp=new le(0,1,0);Tt.DefaultMatrixAutoUpdate=!0;Tt.prototype.isObject3D=!0;var Zr=new le,Mo=new le,Zb=new le,So=new le,mh=new le,gh=new le,PR=new le,Jb=new le,Kb=new le,$b=new le,xn=class{constructor(e=new le,t=new le,n=new le){this.a=e,this.b=t,this.c=n}static getNormal(e,t,n,i){i.subVectors(n,t),Zr.subVectors(e,t),i.cross(Zr);let r=i.lengthSq();return r>0?i.multiplyScalar(1/Math.sqrt(r)):i.set(0,0,0)}static getBarycoord(e,t,n,i,r){Zr.subVectors(i,t),Mo.subVectors(n,t),Zb.subVectors(e,t);let s=Zr.dot(Zr),a=Zr.dot(Mo),l=Zr.dot(Zb),c=Mo.dot(Mo),u=Mo.dot(Zb),d=s*c-a*a;if(d===0)return r.set(-2,-1,-1);let h=1/d,f=(c*l-a*u)*h,p=(s*u-a*l)*h;return r.set(1-f-p,p,f)}static containsPoint(e,t,n,i){return this.getBarycoord(e,t,n,i,So),So.x>=0&&So.y>=0&&So.x+So.y<=1}static getUV(e,t,n,i,r,s,a,l){return this.getBarycoord(e,t,n,i,So),l.set(0,0),l.addScaledVector(r,So.x),l.addScaledVector(s,So.y),l.addScaledVector(a,So.z),l}static isFrontFacing(e,t,n,i){return Zr.subVectors(n,t),Mo.subVectors(e,t),Zr.cross(Mo).dot(i)<0}set(e,t,n){return this.a.copy(e),this.b.copy(t),this.c.copy(n),this}setFromPointsAndIndices(e,t,n,i){return this.a.copy(e[t]),this.b.copy(e[n]),this.c.copy(e[i]),this}clone(){return new this.constructor().copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return Zr.subVectors(this.c,this.b),Mo.subVectors(this.a,this.b),Zr.cross(Mo).length()*.5}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return xn.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return xn.getBarycoord(e,this.a,this.b,this.c,t)}getUV(e,t,n,i,r){return xn.getUV(e,this.a,this.b,this.c,t,n,i,r)}containsPoint(e){return xn.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return xn.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){let n=this.a,i=this.b,r=this.c,s,a;mh.subVectors(i,n),gh.subVectors(r,n),Jb.subVectors(e,n);let l=mh.dot(Jb),c=gh.dot(Jb);if(l<=0&&c<=0)return t.copy(n);Kb.subVectors(e,i);let u=mh.dot(Kb),d=gh.dot(Kb);if(u>=0&&d<=u)return t.copy(i);let h=l*d-u*c;if(h<=0&&l>=0&&u<=0)return s=l/(l-u),t.copy(n).addScaledVector(mh,s);$b.subVectors(e,r);let f=mh.dot($b),p=gh.dot($b);if(p>=0&&f<=p)return t.copy(r);let g=f*c-l*p;if(g<=0&&c>=0&&p<=0)return a=c/(c-p),t.copy(n).addScaledVector(gh,a);let v=u*p-f*d;if(v<=0&&d-u>=0&&f-p>=0)return PR.subVectors(r,i),a=(d-u)/(d-u+(f-p)),t.copy(i).addScaledVector(PR,a);let y=1/(v+g+h);return s=g*y,a=h*y,t.copy(n).addScaledVector(mh,s).addScaledVector(gh,a)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}},LW=0,$n=class extends Ta{constructor(){super();Object.defineProperty(this,"id",{value:LW++}),this.uuid=_r(),this.name="",this.type="Material",this.fog=!0,this.blending=Qf,this.side=Kf,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.blendSrc=YL,this.blendDst=ZL,this.blendEquation=th,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=Eb,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=oW,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=Nb,this.stencilZFail=Nb,this.stencilZPass=Nb,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaTest=0,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0}onBuild(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(e!==void 0)for(let t in e){let n=e[t];if(n===void 0){console.warn("THREE.Material: '"+t+"' parameter is undefined.");continue}if(t==="shading"){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=n===GL;continue}let i=this[t];if(i===void 0){console.warn("THREE."+this.type+": '"+t+"' is not a property of this material.");continue}i&&i.isColor?i.set(n):i&&i.isVector3&&n&&n.isVector3?i.copy(n):this[t]=n}}toJSON(e){let t=e===void 0||typeof e=="string";t&&(e={textures:{},images:{}});let n={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};n.uuid=this.uuid,n.type=this.type,this.name!==""&&(n.name=this.name),this.color&&this.color.isColor&&(n.color=this.color.getHex()),this.roughness!==void 0&&(n.roughness=this.roughness),this.metalness!==void 0&&(n.metalness=this.metalness),this.sheen&&this.sheen.isColor&&(n.sheen=this.sheen.getHex()),this.emissive&&this.emissive.isColor&&(n.emissive=this.emissive.getHex()),this.emissiveIntensity&&this.emissiveIntensity!==1&&(n.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(n.specular=this.specular.getHex()),this.shininess!==void 0&&(n.shininess=this.shininess),this.clearcoat!==void 0&&(n.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(n.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(n.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(n.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(n.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,n.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.map&&this.map.isTexture&&(n.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(n.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(n.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(n.lightMap=this.lightMap.toJSON(e).uuid,n.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(n.aoMap=this.aoMap.toJSON(e).uuid,n.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(n.bumpMap=this.bumpMap.toJSON(e).uuid,n.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(n.normalMap=this.normalMap.toJSON(e).uuid,n.normalMapType=this.normalMapType,n.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(n.displacementMap=this.displacementMap.toJSON(e).uuid,n.displacementScale=this.displacementScale,n.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(n.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(n.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(n.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(n.specularMap=this.specularMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(n.envMap=this.envMap.toJSON(e).uuid,this.combine!==void 0&&(n.combine=this.combine)),this.envMapIntensity!==void 0&&(n.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(n.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(n.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(n.gradientMap=this.gradientMap.toJSON(e).uuid),this.transmission!==void 0&&(n.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(n.transmissionMap=this.transmissionMap.toJSON(e).uuid),this.thickness!==void 0&&(n.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(n.thicknessMap=this.thicknessMap.toJSON(e).uuid),this.attenuationDistance!==void 0&&(n.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(n.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(n.size=this.size),this.shadowSide!==null&&(n.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(n.sizeAttenuation=this.sizeAttenuation),this.blending!==Qf&&(n.blending=this.blending),this.side!==Kf&&(n.side=this.side),this.vertexColors&&(n.vertexColors=!0),this.opacity<1&&(n.opacity=this.opacity),this.transparent===!0&&(n.transparent=this.transparent),n.depthFunc=this.depthFunc,n.depthTest=this.depthTest,n.depthWrite=this.depthWrite,n.colorWrite=this.colorWrite,n.stencilWrite=this.stencilWrite,n.stencilWriteMask=this.stencilWriteMask,n.stencilFunc=this.stencilFunc,n.stencilRef=this.stencilRef,n.stencilFuncMask=this.stencilFuncMask,n.stencilFail=this.stencilFail,n.stencilZFail=this.stencilZFail,n.stencilZPass=this.stencilZPass,this.rotation&&this.rotation!==0&&(n.rotation=this.rotation),this.polygonOffset===!0&&(n.polygonOffset=!0),this.polygonOffsetFactor!==0&&(n.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(n.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth&&this.linewidth!==1&&(n.linewidth=this.linewidth),this.dashSize!==void 0&&(n.dashSize=this.dashSize),this.gapSize!==void 0&&(n.gapSize=this.gapSize),this.scale!==void 0&&(n.scale=this.scale),this.dithering===!0&&(n.dithering=!0),this.alphaTest>0&&(n.alphaTest=this.alphaTest),this.alphaToCoverage===!0&&(n.alphaToCoverage=this.alphaToCoverage),this.premultipliedAlpha===!0&&(n.premultipliedAlpha=this.premultipliedAlpha),this.wireframe===!0&&(n.wireframe=this.wireframe),this.wireframeLinewidth>1&&(n.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(n.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(n.wireframeLinejoin=this.wireframeLinejoin),this.morphTargets===!0&&(n.morphTargets=!0),this.morphNormals===!0&&(n.morphNormals=!0),this.flatShading===!0&&(n.flatShading=this.flatShading),this.visible===!1&&(n.visible=!1),this.toneMapped===!1&&(n.toneMapped=!1),JSON.stringify(this.userData)!=="{}"&&(n.userData=this.userData);function i(r){let s=[];for(let a in r){let l=r[a];delete l.metadata,s.push(l)}return s}if(t){let r=i(e.textures),s=i(e.images);r.length>0&&(n.textures=r),s.length>0&&(n.images=s)}return n}clone(){return new this.constructor().copy(this)}copy(e){this.name=e.name,this.fog=e.fog,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;let t=e.clippingPlanes,n=null;if(t!==null){let i=t.length;n=new Array(i);for(let r=0;r!==i;++r)n[r]=t[r].clone()}return this.clippingPlanes=n,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){e===!0&&this.version++}};$n.prototype.isMaterial=!0;var IR={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Jr={h:0,s:0,l:0},Qy={h:0,s:0,l:0};function Qb(o,e,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?o+(e-o)*6*t:t<1/2?e:t<2/3?o+(e-o)*6*(2/3-t):o}function eM(o){return o<.04045?o*.0773993808:Math.pow(o*.9478672986+.0521327014,2.4)}function tM(o){return o<.0031308?o*12.92:1.055*Math.pow(o,.41666)-.055}var Je=class{constructor(e,t,n){return t===void 0&&n===void 0?this.set(e):this.setRGB(e,t,n)}set(e){return e&&e.isColor?this.copy(e):typeof e=="number"?this.setHex(e):typeof e=="string"&&this.setStyle(e),this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(e&255)/255,this}setRGB(e,t,n){return this.r=e,this.g=t,this.b=n,this}setHSL(e,t,n){if(e=Ob(e,1),t=Ti(t,0,1),n=Ti(n,0,1),t===0)this.r=this.g=this.b=n;else{let i=n<=.5?n*(1+t):n+t-n*t,r=2*n-i;this.r=Qb(r,i,e+1/3),this.g=Qb(r,i,e),this.b=Qb(r,i,e-1/3)}return this}setStyle(e){function t(i){i!==void 0&&parseFloat(i)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let n;if(n=/^((?:rgb|hsl)a?)\(([^\)]*)\)/.exec(e)){let i,r=n[1],s=n[2];switch(r){case"rgb":case"rgba":if(i=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(s))return this.r=Math.min(255,parseInt(i[1],10))/255,this.g=Math.min(255,parseInt(i[2],10))/255,this.b=Math.min(255,parseInt(i[3],10))/255,t(i[4]),this;if(i=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(s))return this.r=Math.min(100,parseInt(i[1],10))/100,this.g=Math.min(100,parseInt(i[2],10))/100,this.b=Math.min(100,parseInt(i[3],10))/100,t(i[4]),this;break;case"hsl":case"hsla":if(i=/^\s*(\d*\.?\d+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(s)){let a=parseFloat(i[1])/360,l=parseInt(i[2],10)/100,c=parseInt(i[3],10)/100;return t(i[4]),this.setHSL(a,l,c)}break}}else if(n=/^\#([A-Fa-f\d]+)$/.exec(e)){let i=n[1],r=i.length;if(r===3)return this.r=parseInt(i.charAt(0)+i.charAt(0),16)/255,this.g=parseInt(i.charAt(1)+i.charAt(1),16)/255,this.b=parseInt(i.charAt(2)+i.charAt(2),16)/255,this;if(r===6)return this.r=parseInt(i.charAt(0)+i.charAt(1),16)/255,this.g=parseInt(i.charAt(2)+i.charAt(3),16)/255,this.b=parseInt(i.charAt(4)+i.charAt(5),16)/255,this}return e&&e.length>0?this.setColorName(e):this}setColorName(e){let t=IR[e.toLowerCase()];return t!==void 0?this.setHex(t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copyGammaToLinear(e,t=2){return this.r=Math.pow(e.r,t),this.g=Math.pow(e.g,t),this.b=Math.pow(e.b,t),this}copyLinearToGamma(e,t=2){let n=t>0?1/t:1;return this.r=Math.pow(e.r,n),this.g=Math.pow(e.g,n),this.b=Math.pow(e.b,n),this}convertGammaToLinear(e){return this.copyGammaToLinear(this,e),this}convertLinearToGamma(e){return this.copyLinearToGamma(this,e),this}copySRGBToLinear(e){return this.r=eM(e.r),this.g=eM(e.g),this.b=eM(e.b),this}copyLinearToSRGB(e){return this.r=tM(e.r),this.g=tM(e.g),this.b=tM(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(){return this.r*255<<16^this.g*255<<8^this.b*255<<0}getHexString(){return("000000"+this.getHex().toString(16)).slice(-6)}getHSL(e){let t=this.r,n=this.g,i=this.b,r=Math.max(t,n,i),s=Math.min(t,n,i),a,l,c=(s+r)/2;if(s===r)a=0,l=0;else{let u=r-s;switch(l=c<=.5?u/(r+s):u/(2-r-s),r){case t:a=(n-i)/u+(n<i?6:0);break;case n:a=(i-t)/u+2;break;case i:a=(t-n)/u+4;break}a/=6}return e.h=a,e.s=l,e.l=c,e}getStyle(){return"rgb("+(this.r*255|0)+","+(this.g*255|0)+","+(this.b*255|0)+")"}offsetHSL(e,t,n){return this.getHSL(Jr),Jr.h+=e,Jr.s+=t,Jr.l+=n,this.setHSL(Jr.h,Jr.s,Jr.l),this}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,n){return this.r=e.r+(t.r-e.r)*n,this.g=e.g+(t.g-e.g)*n,this.b=e.b+(t.b-e.b)*n,this}lerpHSL(e,t){this.getHSL(Jr),e.getHSL(Qy);let n=sp(Jr.h,Qy.h,t),i=sp(Jr.s,Qy.s,t),r=sp(Jr.l,Qy.l,t);return this.setHSL(n,i,r),this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),e.normalized===!0&&(this.r/=255,this.g/=255,this.b/=255),this}toJSON(){return this.getHex()}};Je.NAMES=IR;Je.prototype.isColor=!0;Je.prototype.r=1;Je.prototype.g=1;Je.prototype.b=1;var yh=class extends $n{constructor(e){super();this.type="MeshBasicMaterial",this.color=new Je(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Oy,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.morphTargets=!1,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.morphTargets=e.morphTargets,this}};yh.prototype.isMeshBasicMaterial=!0;var Xt=new le,e0=new ke,Rn=class{constructor(e,t,n){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.name="",this.array=e,this.itemSize=t,this.count=e!==void 0?e.length/t:0,this.normalized=n===!0,this.usage=np,this.updateRange={offset:0,count:-1},this.version=0}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this}copyAt(e,t,n){e*=this.itemSize,n*=t.itemSize;for(let i=0,r=this.itemSize;i<r;i++)this.array[e+i]=t.array[n+i];return this}copyArray(e){return this.array.set(e),this}copyColorsArray(e){let t=this.array,n=0;for(let i=0,r=e.length;i<r;i++){let s=e[i];s===void 0&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",i),s=new Je),t[n++]=s.r,t[n++]=s.g,t[n++]=s.b}return this}copyVector2sArray(e){let t=this.array,n=0;for(let i=0,r=e.length;i<r;i++){let s=e[i];s===void 0&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",i),s=new ke),t[n++]=s.x,t[n++]=s.y}return this}copyVector3sArray(e){let t=this.array,n=0;for(let i=0,r=e.length;i<r;i++){let s=e[i];s===void 0&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",i),s=new le),t[n++]=s.x,t[n++]=s.y,t[n++]=s.z}return this}copyVector4sArray(e){let t=this.array,n=0;for(let i=0,r=e.length;i<r;i++){let s=e[i];s===void 0&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",i),s=new Nt),t[n++]=s.x,t[n++]=s.y,t[n++]=s.z,t[n++]=s.w}return this}applyMatrix3(e){if(this.itemSize===2)for(let t=0,n=this.count;t<n;t++)e0.fromBufferAttribute(this,t),e0.applyMatrix3(e),this.setXY(t,e0.x,e0.y);else if(this.itemSize===3)for(let t=0,n=this.count;t<n;t++)Xt.fromBufferAttribute(this,t),Xt.applyMatrix3(e),this.setXYZ(t,Xt.x,Xt.y,Xt.z);return this}applyMatrix4(e){for(let t=0,n=this.count;t<n;t++)Xt.x=this.getX(t),Xt.y=this.getY(t),Xt.z=this.getZ(t),Xt.applyMatrix4(e),this.setXYZ(t,Xt.x,Xt.y,Xt.z);return this}applyNormalMatrix(e){for(let t=0,n=this.count;t<n;t++)Xt.x=this.getX(t),Xt.y=this.getY(t),Xt.z=this.getZ(t),Xt.applyNormalMatrix(e),this.setXYZ(t,Xt.x,Xt.y,Xt.z);return this}transformDirection(e){for(let t=0,n=this.count;t<n;t++)Xt.x=this.getX(t),Xt.y=this.getY(t),Xt.z=this.getZ(t),Xt.transformDirection(e),this.setXYZ(t,Xt.x,Xt.y,Xt.z);return this}set(e,t=0){return this.array.set(e,t),this}getX(e){return this.array[e*this.itemSize]}setX(e,t){return this.array[e*this.itemSize]=t,this}getY(e){return this.array[e*this.itemSize+1]}setY(e,t){return this.array[e*this.itemSize+1]=t,this}getZ(e){return this.array[e*this.itemSize+2]}setZ(e,t){return this.array[e*this.itemSize+2]=t,this}getW(e){return this.array[e*this.itemSize+3]}setW(e,t){return this.array[e*this.itemSize+3]=t,this}setXY(e,t,n){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=n,this}setXYZ(e,t,n,i){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=i,this}setXYZW(e,t,n,i,r){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=i,this.array[e+3]=r,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){let e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.prototype.slice.call(this.array),normalized:this.normalized};return this.name!==""&&(e.name=this.name),this.usage!==np&&(e.usage=this.usage),(this.updateRange.offset!==0||this.updateRange.count!==-1)&&(e.updateRange=this.updateRange),e}};Rn.prototype.isBufferAttribute=!0;var nM=class extends Rn{constructor(e,t,n){super(new Uint16Array(e),t,n)}};var iM=class extends Rn{constructor(e,t,n){super(new Uint32Array(e),t,n)}},DR=class extends Rn{constructor(e,t,n){super(new Uint16Array(e),t,n)}};DR.prototype.isFloat16BufferAttribute=!0;var Ot=class extends Rn{constructor(e,t,n){super(new Float32Array(e),t,n)}};function FR(o){if(o.length===0)return-1/0;let e=o[0];for(let t=1,n=o.length;t<n;++t)o[t]>e&&(e=o[t]);return e}var RW=0,br=new Qe,rM=new Tt,vh=new le,Qi=new wr,cp=new wr,kn=new le,kt=class extends Ta{constructor(){super();Object.defineProperty(this,"id",{value:RW++}),this.uuid=_r(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(FR(e)>65535?iM:nM)(e,1):this.index=e,this}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return this.attributes[e]!==void 0}addGroup(e,t,n=0){this.groups.push({start:e,count:t,materialIndex:n})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){let t=this.attributes.position;t!==void 0&&(t.applyMatrix4(e),t.needsUpdate=!0);let n=this.attributes.normal;if(n!==void 0){let r=new Nn().getNormalMatrix(e);n.applyNormalMatrix(r),n.needsUpdate=!0}let i=this.attributes.tangent;return i!==void 0&&(i.transformDirection(e),i.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(e){return br.makeRotationFromQuaternion(e),this.applyMatrix4(br),this}rotateX(e){return br.makeRotationX(e),this.applyMatrix4(br),this}rotateY(e){return br.makeRotationY(e),this.applyMatrix4(br),this}rotateZ(e){return br.makeRotationZ(e),this.applyMatrix4(br),this}translate(e,t,n){return br.makeTranslation(e,t,n),this.applyMatrix4(br),this}scale(e,t,n){return br.makeScale(e,t,n),this.applyMatrix4(br),this}lookAt(e){return rM.lookAt(e),rM.updateMatrix(),this.applyMatrix4(rM.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(vh).negate(),this.translate(vh.x,vh.y,vh.z),this}setFromPoints(e){let t=[];for(let n=0,i=e.length;n<i;n++){let r=e[n];t.push(r.x,r.y,r.z||0)}return this.setAttribute("position",new Ot(t,3)),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new wr);let e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingBox.set(new le(-1/0,-1/0,-1/0),new le(1/0,1/0,1/0));return}if(e!==void 0){if(this.boundingBox.setFromBufferAttribute(e),t)for(let n=0,i=t.length;n<i;n++){let r=t[n];Qi.setFromBufferAttribute(r),this.morphTargetsRelative?(kn.addVectors(this.boundingBox.min,Qi.min),this.boundingBox.expandByPoint(kn),kn.addVectors(this.boundingBox.max,Qi.max),this.boundingBox.expandByPoint(kn)):(this.boundingBox.expandByPoint(Qi.min),this.boundingBox.expandByPoint(Qi.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new ec);let e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingSphere.set(new le,1/0);return}if(e){let n=this.boundingSphere.center;if(Qi.setFromBufferAttribute(e),t)for(let r=0,s=t.length;r<s;r++){let a=t[r];cp.setFromBufferAttribute(a),this.morphTargetsRelative?(kn.addVectors(Qi.min,cp.min),Qi.expandByPoint(kn),kn.addVectors(Qi.max,cp.max),Qi.expandByPoint(kn)):(Qi.expandByPoint(cp.min),Qi.expandByPoint(cp.max))}Qi.getCenter(n);let i=0;for(let r=0,s=e.count;r<s;r++)kn.fromBufferAttribute(e,r),i=Math.max(i,n.distanceToSquared(kn));if(t)for(let r=0,s=t.length;r<s;r++){let a=t[r],l=this.morphTargetsRelative;for(let c=0,u=a.count;c<u;c++)kn.fromBufferAttribute(a,c),l&&(vh.fromBufferAttribute(e,c),kn.add(vh)),i=Math.max(i,n.distanceToSquared(kn))}this.boundingSphere.radius=Math.sqrt(i),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeFaceNormals(){}computeTangents(){let e=this.index,t=this.attributes;if(e===null||t.position===void 0||t.normal===void 0||t.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}let n=e.array,i=t.position.array,r=t.normal.array,s=t.uv.array,a=i.length/3;t.tangent===void 0&&this.setAttribute("tangent",new Rn(new Float32Array(4*a),4));let l=t.tangent.array,c=[],u=[];for(let A=0;A<a;A++)c[A]=new le,u[A]=new le;let d=new le,h=new le,f=new le,p=new ke,g=new ke,v=new ke,y=new le,m=new le;function x(A,L,B){d.fromArray(i,A*3),h.fromArray(i,L*3),f.fromArray(i,B*3),p.fromArray(s,A*2),g.fromArray(s,L*2),v.fromArray(s,B*2),h.sub(d),f.sub(d),g.sub(p),v.sub(p);let R=1/(g.x*v.y-v.x*g.y);!isFinite(R)||(y.copy(h).multiplyScalar(v.y).addScaledVector(f,-g.y).multiplyScalar(R),m.copy(f).multiplyScalar(g.x).addScaledVector(h,-v.x).multiplyScalar(R),c[A].add(y),c[L].add(y),c[B].add(y),u[A].add(m),u[L].add(m),u[B].add(m))}let _=this.groups;_.length===0&&(_=[{start:0,count:n.length}]);for(let A=0,L=_.length;A<L;++A){let B=_[A],R=B.start,D=B.count;for(let P=R,I=R+D;P<I;P+=3)x(n[P+0],n[P+1],n[P+2])}let w=new le,b=new le,M=new le,S=new le;function E(A){M.fromArray(r,A*3),S.copy(M);let L=c[A];w.copy(L),w.sub(M.multiplyScalar(M.dot(L))).normalize(),b.crossVectors(S,L);let R=b.dot(u[A])<0?-1:1;l[A*4]=w.x,l[A*4+1]=w.y,l[A*4+2]=w.z,l[A*4+3]=R}for(let A=0,L=_.length;A<L;++A){let B=_[A],R=B.start,D=B.count;for(let P=R,I=R+D;P<I;P+=3)E(n[P+0]),E(n[P+1]),E(n[P+2])}}computeVertexNormals(){let e=this.index,t=this.getAttribute("position");if(t!==void 0){let n=this.getAttribute("normal");if(n===void 0)n=new Rn(new Float32Array(t.count*3),3),this.setAttribute("normal",n);else for(let h=0,f=n.count;h<f;h++)n.setXYZ(h,0,0,0);let i=new le,r=new le,s=new le,a=new le,l=new le,c=new le,u=new le,d=new le;if(e)for(let h=0,f=e.count;h<f;h+=3){let p=e.getX(h+0),g=e.getX(h+1),v=e.getX(h+2);i.fromBufferAttribute(t,p),r.fromBufferAttribute(t,g),s.fromBufferAttribute(t,v),u.subVectors(s,r),d.subVectors(i,r),u.cross(d),a.fromBufferAttribute(n,p),l.fromBufferAttribute(n,g),c.fromBufferAttribute(n,v),a.add(u),l.add(u),c.add(u),n.setXYZ(p,a.x,a.y,a.z),n.setXYZ(g,l.x,l.y,l.z),n.setXYZ(v,c.x,c.y,c.z)}else for(let h=0,f=t.count;h<f;h+=3)i.fromBufferAttribute(t,h+0),r.fromBufferAttribute(t,h+1),s.fromBufferAttribute(t,h+2),u.subVectors(s,r),d.subVectors(i,r),u.cross(d),n.setXYZ(h+0,u.x,u.y,u.z),n.setXYZ(h+1,u.x,u.y,u.z),n.setXYZ(h+2,u.x,u.y,u.z);this.normalizeNormals(),n.needsUpdate=!0}}merge(e,t){if(!(e&&e.isBufferGeometry)){console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",e);return}t===void 0&&(t=0,console.warn("THREE.BufferGeometry.merge(): Overwriting original geometry, starting at offset=0. Use BufferGeometryUtils.mergeBufferGeometries() for lossless merge."));let n=this.attributes;for(let i in n){if(e.attributes[i]===void 0)continue;let s=n[i].array,a=e.attributes[i],l=a.array,c=a.itemSize*t,u=Math.min(l.length,s.length-c);for(let d=0,h=c;d<u;d++,h++)s[h]=l[d]}return this}normalizeNormals(){let e=this.attributes.normal;for(let t=0,n=e.count;t<n;t++)kn.fromBufferAttribute(e,t),kn.normalize(),e.setXYZ(t,kn.x,kn.y,kn.z)}toNonIndexed(){function e(a,l){let c=a.array,u=a.itemSize,d=a.normalized,h=new c.constructor(l.length*u),f=0,p=0;for(let g=0,v=l.length;g<v;g++){a.isInterleavedBufferAttribute?f=l[g]*a.data.stride+a.offset:f=l[g]*u;for(let y=0;y<u;y++)h[p++]=c[f++]}return new Rn(h,u,d)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;let t=new kt,n=this.index.array,i=this.attributes;for(let a in i){let l=i[a],c=e(l,n);t.setAttribute(a,c)}let r=this.morphAttributes;for(let a in r){let l=[],c=r[a];for(let u=0,d=c.length;u<d;u++){let h=c[u],f=e(h,n);l.push(f)}t.morphAttributes[a]=l}t.morphTargetsRelative=this.morphTargetsRelative;let s=this.groups;for(let a=0,l=s.length;a<l;a++){let c=s[a];t.addGroup(c.start,c.count,c.materialIndex)}return t}toJSON(){let e={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,this.name!==""&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),this.parameters!==void 0){let l=this.parameters;for(let c in l)l[c]!==void 0&&(e[c]=l[c]);return e}e.data={attributes:{}};let t=this.index;t!==null&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});let n=this.attributes;for(let l in n){let c=n[l];e.data.attributes[l]=c.toJSON(e.data)}let i={},r=!1;for(let l in this.morphAttributes){let c=this.morphAttributes[l],u=[];for(let d=0,h=c.length;d<h;d++){let f=c[d];u.push(f.toJSON(e.data))}u.length>0&&(i[l]=u,r=!0)}r&&(e.data.morphAttributes=i,e.data.morphTargetsRelative=this.morphTargetsRelative);let s=this.groups;s.length>0&&(e.data.groups=JSON.parse(JSON.stringify(s)));let a=this.boundingSphere;return a!==null&&(e.data.boundingSphere={center:a.center.toArray(),radius:a.radius}),e}clone(){return new kt().copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;let t={};this.name=e.name;let n=e.index;n!==null&&this.setIndex(n.clone(t));let i=e.attributes;for(let c in i){let u=i[c];this.setAttribute(c,u.clone(t))}let r=e.morphAttributes;for(let c in r){let u=[],d=r[c];for(let h=0,f=d.length;h<f;h++)u.push(d[h].clone(t));this.morphAttributes[c]=u}this.morphTargetsRelative=e.morphTargetsRelative;let s=e.groups;for(let c=0,u=s.length;c<u;c++){let d=s[c];this.addGroup(d.start,d.count,d.materialIndex)}let a=e.boundingBox;a!==null&&(this.boundingBox=a.clone());let l=e.boundingSphere;return l!==null&&(this.boundingSphere=l.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}};kt.prototype.isBufferGeometry=!0;var BR=new Qe,xh=new tc,sM=new ec,Ra=new le,Pa=new le,Ia=new le,oM=new le,aM=new le,lM=new le,t0=new le,n0=new le,i0=new le,r0=new ke,s0=new ke,o0=new ke,cM=new le,a0=new le,Oi=class extends Tt{constructor(e=new kt,t=new yh){super();this.type="Mesh",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e){return super.copy(e),e.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),e.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=e.material,this.geometry=e.geometry,this}updateMorphTargets(){let e=this.geometry;if(e.isBufferGeometry){let t=e.morphAttributes,n=Object.keys(t);if(n.length>0){let i=t[n[0]];if(i!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let r=0,s=i.length;r<s;r++){let a=i[r].name||String(r);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=r}}}}else{let t=e.morphTargets;t!==void 0&&t.length>0&&console.error("THREE.Mesh.updateMorphTargets() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}}raycast(e,t){let n=this.geometry,i=this.material,r=this.matrixWorld;if(i===void 0||(n.boundingSphere===null&&n.computeBoundingSphere(),sM.copy(n.boundingSphere),sM.applyMatrix4(r),e.ray.intersectsSphere(sM)===!1)||(BR.copy(r).invert(),xh.copy(e.ray).applyMatrix4(BR),n.boundingBox!==null&&xh.intersectsBox(n.boundingBox)===!1))return;let s;if(n.isBufferGeometry){let a=n.index,l=n.attributes.position,c=n.morphAttributes.position,u=n.morphTargetsRelative,d=n.attributes.uv,h=n.attributes.uv2,f=n.groups,p=n.drawRange;if(a!==null)if(Array.isArray(i))for(let g=0,v=f.length;g<v;g++){let y=f[g],m=i[y.materialIndex],x=Math.max(y.start,p.start),_=Math.min(y.start+y.count,p.start+p.count);for(let w=x,b=_;w<b;w+=3){let M=a.getX(w),S=a.getX(w+1),E=a.getX(w+2);s=l0(this,m,e,xh,l,c,u,d,h,M,S,E),s&&(s.faceIndex=Math.floor(w/3),s.face.materialIndex=y.materialIndex,t.push(s))}}else{let g=Math.max(0,p.start),v=Math.min(a.count,p.start+p.count);for(let y=g,m=v;y<m;y+=3){let x=a.getX(y),_=a.getX(y+1),w=a.getX(y+2);s=l0(this,i,e,xh,l,c,u,d,h,x,_,w),s&&(s.faceIndex=Math.floor(y/3),t.push(s))}}else if(l!==void 0)if(Array.isArray(i))for(let g=0,v=f.length;g<v;g++){let y=f[g],m=i[y.materialIndex],x=Math.max(y.start,p.start),_=Math.min(y.start+y.count,p.start+p.count);for(let w=x,b=_;w<b;w+=3){let M=w,S=w+1,E=w+2;s=l0(this,m,e,xh,l,c,u,d,h,M,S,E),s&&(s.faceIndex=Math.floor(w/3),s.face.materialIndex=y.materialIndex,t.push(s))}}else{let g=Math.max(0,p.start),v=Math.min(l.count,p.start+p.count);for(let y=g,m=v;y<m;y+=3){let x=y,_=y+1,w=y+2;s=l0(this,i,e,xh,l,c,u,d,h,x,_,w),s&&(s.faceIndex=Math.floor(y/3),t.push(s))}}}else n.isGeometry&&console.error("THREE.Mesh.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}};Oi.prototype.isMesh=!0;function PW(o,e,t,n,i,r,s,a){let l;if(e.side===Ln?l=n.intersectTriangle(s,r,i,!0,a):l=n.intersectTriangle(i,r,s,e.side!==Sa,a),l===null)return null;a0.copy(a),a0.applyMatrix4(o.matrixWorld);let c=t.ray.origin.distanceTo(a0);return c<t.near||c>t.far?null:{distance:c,point:a0.clone(),object:o}}function l0(o,e,t,n,i,r,s,a,l,c,u,d){Ra.fromBufferAttribute(i,c),Pa.fromBufferAttribute(i,u),Ia.fromBufferAttribute(i,d);let h=o.morphTargetInfluences;if(e.morphTargets&&r&&h){t0.set(0,0,0),n0.set(0,0,0),i0.set(0,0,0);for(let p=0,g=r.length;p<g;p++){let v=h[p],y=r[p];v!==0&&(oM.fromBufferAttribute(y,c),aM.fromBufferAttribute(y,u),lM.fromBufferAttribute(y,d),s?(t0.addScaledVector(oM,v),n0.addScaledVector(aM,v),i0.addScaledVector(lM,v)):(t0.addScaledVector(oM.sub(Ra),v),n0.addScaledVector(aM.sub(Pa),v),i0.addScaledVector(lM.sub(Ia),v)))}Ra.add(t0),Pa.add(n0),Ia.add(i0)}o.isSkinnedMesh&&(o.boneTransform(c,Ra),o.boneTransform(u,Pa),o.boneTransform(d,Ia));let f=PW(o,e,t,n,Ra,Pa,Ia,cM);if(f){a&&(r0.fromBufferAttribute(a,c),s0.fromBufferAttribute(a,u),o0.fromBufferAttribute(a,d),f.uv=xn.getUV(cM,Ra,Pa,Ia,r0,s0,o0,new ke)),l&&(r0.fromBufferAttribute(l,c),s0.fromBufferAttribute(l,u),o0.fromBufferAttribute(l,d),f.uv2=xn.getUV(cM,Ra,Pa,Ia,r0,s0,o0,new ke));let p={a:c,b:u,c:d,normal:new le,materialIndex:0};xn.getNormal(Ra,Pa,Ia,p.normal),f.face=p}return f}var Da=class extends kt{constructor(e=1,t=1,n=1,i=1,r=1,s=1){super();this.type="BoxGeometry",this.parameters={width:e,height:t,depth:n,widthSegments:i,heightSegments:r,depthSegments:s};let a=this;i=Math.floor(i),r=Math.floor(r),s=Math.floor(s);let l=[],c=[],u=[],d=[],h=0,f=0;p("z","y","x",-1,-1,n,t,e,s,r,0),p("z","y","x",1,-1,n,t,-e,s,r,1),p("x","z","y",1,1,e,n,t,i,s,2),p("x","z","y",1,-1,e,n,-t,i,s,3),p("x","y","z",1,-1,e,t,n,i,r,4),p("x","y","z",-1,-1,e,t,-n,i,r,5),this.setIndex(l),this.setAttribute("position",new Ot(c,3)),this.setAttribute("normal",new Ot(u,3)),this.setAttribute("uv",new Ot(d,2));function p(g,v,y,m,x,_,w,b,M,S,E){let A=_/M,L=w/S,B=_/2,R=w/2,D=b/2,P=M+1,I=S+1,N=0,G=0,z=new le;for(let se=0;se<I;se++){let ne=se*L-R;for(let Q=0;Q<P;Q++){let j=Q*A-B;z[g]=j*m,z[v]=ne*x,z[y]=D,c.push(z.x,z.y,z.z),z[g]=0,z[v]=0,z[y]=b>0?1:-1,u.push(z.x,z.y,z.z),d.push(Q/M),d.push(1-se/S),N+=1}}for(let se=0;se<S;se++)for(let ne=0;ne<M;ne++){let Q=h+ne+P*se,j=h+ne+P*(se+1),O=h+(ne+1)+P*(se+1),ee=h+(ne+1)+P*se;l.push(Q,j,ee),l.push(j,O,ee),G+=6}a.addGroup(f,G,E),f+=G,h+=N}}static fromJSON(e){return new Da(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}};function _h(o){let e={};for(let t in o){e[t]={};for(let n in o[t]){let i=o[t][n];i&&(i.isColor||i.isMatrix3||i.isMatrix4||i.isVector2||i.isVector3||i.isVector4||i.isTexture||i.isQuaternion)?e[t][n]=i.clone():Array.isArray(i)?e[t][n]=i.slice():e[t][n]=i}}return e}function di(o){let e={};for(let t=0;t<o.length;t++){let n=_h(o[t]);for(let i in n)e[i]=n[i]}return e}var IW={clone:_h,merge:di},DW=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,FW=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`,Fa=class extends $n{constructor(e){super();this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader=DW,this.fragmentShader=FW,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.morphTargets=!1,this.morphNormals=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,e!==void 0&&(e.attributes!==void 0&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(e))}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=_h(e.uniforms),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.lights=e.lights,this.clipping=e.clipping,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){let t=super.toJSON(e);t.glslVersion=this.glslVersion,t.uniforms={};for(let i in this.uniforms){let s=this.uniforms[i].value;s&&s.isTexture?t.uniforms[i]={type:"t",value:s.toJSON(e).uuid}:s&&s.isColor?t.uniforms[i]={type:"c",value:s.getHex()}:s&&s.isVector2?t.uniforms[i]={type:"v2",value:s.toArray()}:s&&s.isVector3?t.uniforms[i]={type:"v3",value:s.toArray()}:s&&s.isVector4?t.uniforms[i]={type:"v4",value:s.toArray()}:s&&s.isMatrix3?t.uniforms[i]={type:"m3",value:s.toArray()}:s&&s.isMatrix4?t.uniforms[i]={type:"m4",value:s.toArray()}:t.uniforms[i]={value:s}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader;let n={};for(let i in this.extensions)this.extensions[i]===!0&&(n[i]=!0);return Object.keys(n).length>0&&(t.extensions=n),t}};Fa.prototype.isShaderMaterial=!0;var c0=class extends Tt{constructor(){super();this.type="Camera",this.matrixWorldInverse=new Qe,this.projectionMatrix=new Qe,this.projectionMatrixInverse=new Qe}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this}getWorldDirection(e){this.updateWorldMatrix(!0,!1);let t=this.matrixWorld.elements;return e.set(-t[8],-t[9],-t[10]).normalize()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}};c0.prototype.isCamera=!0;var ki=class extends c0{constructor(e=50,t=1,n=.1,i=2e3){super();this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=n,this.far=i,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=e.view===null?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){let t=.5*this.getFilmHeight()/e;this.fov=rp*2*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){let e=Math.tan(ip*.5*this.fov);return .5*this.getFilmHeight()/e}getEffectiveFOV(){return rp*2*Math.atan(Math.tan(ip*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(e,t,n,i,r,s){this.aspect=e/t,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=i,this.view.width=r,this.view.height=s,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){let e=this.near,t=e*Math.tan(ip*.5*this.fov)/this.zoom,n=2*t,i=this.aspect*n,r=-.5*i,s=this.view;if(this.view!==null&&this.view.enabled){let l=s.fullWidth,c=s.fullHeight;r+=s.offsetX*i/l,t-=s.offsetY*n/c,i*=s.width/l,n*=s.height/c}let a=this.filmOffset;a!==0&&(r+=e*a/this.getFilmWidth()),this.projectionMatrix.makePerspective(r,r+i,t,t-n,e,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){let t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,this.view!==null&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}};ki.prototype.isPerspectiveCamera=!0;var wh=90,bh=1,u0=class extends Tt{constructor(e,t,n){super();if(this.type="CubeCamera",n.isWebGLCubeRenderTarget!==!0){console.error("THREE.CubeCamera: The constructor now expects an instance of WebGLCubeRenderTarget as third parameter.");return}this.renderTarget=n;let i=new ki(wh,bh,e,t);i.layers=this.layers,i.up.set(0,-1,0),i.lookAt(new le(1,0,0)),this.add(i);let r=new ki(wh,bh,e,t);r.layers=this.layers,r.up.set(0,-1,0),r.lookAt(new le(-1,0,0)),this.add(r);let s=new ki(wh,bh,e,t);s.layers=this.layers,s.up.set(0,0,1),s.lookAt(new le(0,1,0)),this.add(s);let a=new ki(wh,bh,e,t);a.layers=this.layers,a.up.set(0,0,-1),a.lookAt(new le(0,-1,0)),this.add(a);let l=new ki(wh,bh,e,t);l.layers=this.layers,l.up.set(0,-1,0),l.lookAt(new le(0,0,1)),this.add(l);let c=new ki(wh,bh,e,t);c.layers=this.layers,c.up.set(0,-1,0),c.lookAt(new le(0,0,-1)),this.add(c)}update(e,t){this.parent===null&&this.updateMatrixWorld();let n=this.renderTarget,[i,r,s,a,l,c]=this.children,u=e.xr.enabled,d=e.getRenderTarget();e.xr.enabled=!1;let h=n.texture.generateMipmaps;n.texture.generateMipmaps=!1,e.setRenderTarget(n,0),e.render(t,i),e.setRenderTarget(n,1),e.render(t,r),e.setRenderTarget(n,2),e.render(t,s),e.setRenderTarget(n,3),e.render(t,a),e.setRenderTarget(n,4),e.render(t,l),n.texture.generateMipmaps=h,e.setRenderTarget(n,5),e.render(t,c),e.setRenderTarget(d),e.xr.enabled=u}},up=class extends On{constructor(e,t,n,i,r,s,a,l,c,u){e=e!==void 0?e:[],t=t!==void 0?t:Ab,a=a!==void 0?a:Jl;super(e,t,n,i,r,s,a,l,c,u);this._needsFlipEnvMap=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}};up.prototype.isCubeTexture=!0;var uM=class extends Ls{constructor(e,t,n){Number.isInteger(t)&&(console.warn("THREE.WebGLCubeRenderTarget: constructor signature is now WebGLCubeRenderTarget( size, options )"),t=n);super(e,e,t);t=t||{},this.texture=new up(void 0,t.mapping,t.wrapS,t.wrapT,t.magFilter,t.minFilter,t.format,t.type,t.anisotropy,t.encoding),this.texture.generateMipmaps=t.generateMipmaps!==void 0?t.generateMipmaps:!1,this.texture.minFilter=t.minFilter!==void 0?t.minFilter:xr,this.texture._needsFlipEnvMap=!1}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.format=Cs,this.texture.encoding=t.encoding,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;let n={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},i=new Da(5,5,5),r=new Fa({name:"CubemapFromEquirect",uniforms:_h(n.uniforms),vertexShader:n.vertexShader,fragmentShader:n.fragmentShader,side:Ln,blending:$f});r.uniforms.tEquirect.value=t;let s=new Oi(i,r),a=t.minFilter;return t.minFilter===ky&&(t.minFilter=xr),new u0(1,10,this).update(e,s),t.minFilter=a,s.geometry.dispose(),s.material.dispose(),this}clear(e,t,n,i){let r=e.getRenderTarget();for(let s=0;s<6;s++)e.setRenderTarget(this,s),e.clear(t,n,i);e.setRenderTarget(r)}};uM.prototype.isWebGLCubeRenderTarget=!0;var hM=new le,BW=new le,NW=new Nn,Rs=class{constructor(e=new le(1,0,0),t=0){this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,n,i){return this.normal.set(e,t,n),this.constant=i,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,n){let i=hM.subVectors(n,t).cross(BW.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(i,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){let e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t.copy(this.normal).multiplyScalar(-this.distanceToPoint(e)).add(e)}intersectLine(e,t){let n=e.delta(hM),i=this.normal.dot(n);if(i===0)return this.distanceToPoint(e.start)===0?t.copy(e.start):null;let r=-(e.start.dot(this.normal)+this.constant)/i;return r<0||r>1?null:t.copy(n).multiplyScalar(r).add(e.start)}intersectsLine(e){let t=this.distanceToPoint(e.start),n=this.distanceToPoint(e.end);return t<0&&n>0||n<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){let n=t||NW.getNormalMatrix(e),i=this.coplanarPoint(hM).applyMatrix4(e),r=this.normal.applyMatrix3(n).normalize();return this.constant=-i.dot(r),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return new this.constructor().copy(this)}};Rs.prototype.isPlane=!0;var Mh=new ec,h0=new le,hp=class{constructor(e=new Rs,t=new Rs,n=new Rs,i=new Rs,r=new Rs,s=new Rs){this.planes=[e,t,n,i,r,s]}set(e,t,n,i,r,s){let a=this.planes;return a[0].copy(e),a[1].copy(t),a[2].copy(n),a[3].copy(i),a[4].copy(r),a[5].copy(s),this}copy(e){let t=this.planes;for(let n=0;n<6;n++)t[n].copy(e.planes[n]);return this}setFromProjectionMatrix(e){let t=this.planes,n=e.elements,i=n[0],r=n[1],s=n[2],a=n[3],l=n[4],c=n[5],u=n[6],d=n[7],h=n[8],f=n[9],p=n[10],g=n[11],v=n[12],y=n[13],m=n[14],x=n[15];return t[0].setComponents(a-i,d-l,g-h,x-v).normalize(),t[1].setComponents(a+i,d+l,g+h,x+v).normalize(),t[2].setComponents(a+r,d+c,g+f,x+y).normalize(),t[3].setComponents(a-r,d-c,g-f,x-y).normalize(),t[4].setComponents(a-s,d-u,g-p,x-m).normalize(),t[5].setComponents(a+s,d+u,g+p,x+m).normalize(),this}intersectsObject(e){let t=e.geometry;return t.boundingSphere===null&&t.computeBoundingSphere(),Mh.copy(t.boundingSphere).applyMatrix4(e.matrixWorld),this.intersectsSphere(Mh)}intersectsSprite(e){return Mh.center.set(0,0,0),Mh.radius=.7071067811865476,Mh.applyMatrix4(e.matrixWorld),this.intersectsSphere(Mh)}intersectsSphere(e){let t=this.planes,n=e.center,i=-e.radius;for(let r=0;r<6;r++)if(t[r].distanceToPoint(n)<i)return!1;return!0}intersectsBox(e){let t=this.planes;for(let n=0;n<6;n++){let i=t[n];if(h0.x=i.normal.x>0?e.max.x:e.min.x,h0.y=i.normal.y>0?e.max.y:e.min.y,h0.z=i.normal.z>0?e.max.z:e.min.z,i.distanceToPoint(h0)<0)return!1}return!0}containsPoint(e){let t=this.planes;for(let n=0;n<6;n++)if(t[n].distanceToPoint(e)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}};function NR(){let o=null,e=!1,t=null,n=null;function i(r,s){t(r,s),n=o.requestAnimationFrame(i)}return{start:function(){e!==!0&&t!==null&&(n=o.requestAnimationFrame(i),e=!0)},stop:function(){o.cancelAnimationFrame(n),e=!1},setAnimationLoop:function(r){t=r},setContext:function(r){o=r}}}function OW(o,e){let t=e.isWebGL2,n=new WeakMap;function i(c,u){let d=c.array,h=c.usage,f=o.createBuffer();o.bindBuffer(u,f),o.bufferData(u,d,h),c.onUploadCallback();let p=5126;return d instanceof Float32Array?p=5126:d instanceof Float64Array?console.warn("THREE.WebGLAttributes: Unsupported data buffer format: Float64Array."):d instanceof Uint16Array?c.isFloat16BufferAttribute?t?p=5131:console.warn("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2."):p=5123:d instanceof Int16Array?p=5122:d instanceof Uint32Array?p=5125:d instanceof Int32Array?p=5124:d instanceof Int8Array?p=5120:(d instanceof Uint8Array||d instanceof Uint8ClampedArray)&&(p=5121),{buffer:f,type:p,bytesPerElement:d.BYTES_PER_ELEMENT,version:c.version}}function r(c,u,d){let h=u.array,f=u.updateRange;o.bindBuffer(d,c),f.count===-1?o.bufferSubData(d,0,h):(t?o.bufferSubData(d,f.offset*h.BYTES_PER_ELEMENT,h,f.offset,f.count):o.bufferSubData(d,f.offset*h.BYTES_PER_ELEMENT,h.subarray(f.offset,f.offset+f.count)),f.count=-1)}function s(c){return c.isInterleavedBufferAttribute&&(c=c.data),n.get(c)}function a(c){c.isInterleavedBufferAttribute&&(c=c.data);let u=n.get(c);u&&(o.deleteBuffer(u.buffer),n.delete(c))}function l(c,u){if(c.isGLBufferAttribute){let h=n.get(c);(!h||h.version<c.version)&&n.set(c,{buffer:c.buffer,type:c.type,bytesPerElement:c.elementSize,version:c.version});return}c.isInterleavedBufferAttribute&&(c=c.data);let d=n.get(c);d===void 0?n.set(c,i(c,u)):d.version<c.version&&(r(d.buffer,c,u),d.version=c.version)}return{get:s,remove:a,update:l}}var Sh=class extends kt{constructor(e=1,t=1,n=1,i=1){super();this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:n,heightSegments:i};let r=e/2,s=t/2,a=Math.floor(n),l=Math.floor(i),c=a+1,u=l+1,d=e/a,h=t/l,f=[],p=[],g=[],v=[];for(let y=0;y<u;y++){let m=y*h-s;for(let x=0;x<c;x++){let _=x*d-r;p.push(_,-m,0),g.push(0,0,1),v.push(x/a),v.push(1-y/l)}}for(let y=0;y<l;y++)for(let m=0;m<a;m++){let x=m+c*y,_=m+c*(y+1),w=m+1+c*(y+1),b=m+1+c*y;f.push(x,_,b),f.push(_,w,b)}this.setIndex(f),this.setAttribute("position",new Ot(p,3)),this.setAttribute("normal",new Ot(g,3)),this.setAttribute("uv",new Ot(v,2))}static fromJSON(e){return new Sh(e.width,e.height,e.widthSegments,e.heightSegments)}},kW=`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vUv ).g;
#endif`,zW=`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,UW=`#ifdef ALPHATEST
	if ( diffuseColor.a < ALPHATEST ) discard;
#endif`,HW=`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.specularRoughness );
	#endif
#endif`,GW=`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,VW="vec3 transformed = vec3( position );",WW=`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,XW=`vec2 integrateSpecularBRDF( const in float dotNV, const in float roughness ) {
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	return vec2( -1.04, 1.04 ) * a004 + r.zw;
}
float punctualLightIntensityToIrradianceFactor( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
#if defined ( PHYSICALLY_CORRECT_LIGHTS )
	float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
	if( cutoffDistance > 0.0 ) {
		distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
	}
	return distanceFalloff;
#else
	if( cutoffDistance > 0.0 && decayExponent > 0.0 ) {
		return pow( saturate( -lightDistance / cutoffDistance + 1.0 ), decayExponent );
	}
	return 1.0;
#endif
}
vec3 BRDF_Diffuse_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 specularColor, const in float dotVH ) {
	float fresnel = exp2( ( -5.55473 * dotVH - 6.98316 ) * dotVH );
	return ( 1.0 - specularColor ) * fresnel + specularColor;
}
vec3 F_Schlick_RoughnessDependent( const in vec3 F0, const in float dotNV, const in float roughness ) {
	float fresnel = exp2( ( -5.55473 * dotNV - 6.98316 ) * dotNV );
	vec3 Fr = max( vec3( 1.0 - roughness ), F0 ) - F0;
	return Fr * fresnel + F0;
}
float G_GGX_Smith( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gl = dotNL + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	float gv = dotNV + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	return 1.0 / ( gl * gv );
}
float G_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
vec3 BRDF_Specular_GGX( const in IncidentLight incidentLight, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float roughness ) {
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( incidentLight.direction + viewDir );
	float dotNL = saturate( dot( normal, incidentLight.direction ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotLH = saturate( dot( incidentLight.direction, halfDir ) );
	vec3 F = F_Schlick( specularColor, dotLH );
	float G = G_GGX_SmithCorrelated( alpha, dotNL, dotNV );
	float D = D_GGX( alpha, dotNH );
	return F * ( G * D );
}
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
vec3 BRDF_Specular_GGX_Environment( const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	vec2 brdf = integrateSpecularBRDF( dotNV, roughness );
	return specularColor * brdf.x + brdf.y;
}
void BRDF_Specular_Multiscattering_Environment( const in GeometricContext geometry, const in vec3 specularColor, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
	float dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );
	vec3 F = F_Schlick_RoughnessDependent( specularColor, dotNV, roughness );
	vec2 brdf = integrateSpecularBRDF( dotNV, roughness );
	vec3 FssEss = F * brdf.x + brdf.y;
	float Ess = brdf.x + brdf.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = specularColor + ( 1.0 - specularColor ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_Specular_BlinnPhong( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );
	float dotNH = saturate( dot( geometry.normal, halfDir ) );
	float dotLH = saturate( dot( incidentLight.direction, halfDir ) );
	vec3 F = F_Schlick( specularColor, dotLH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
}
float GGXRoughnessToBlinnExponent( const in float ggxRoughness ) {
	return ( 2.0 / pow2( ggxRoughness + 0.0001 ) - 2.0 );
}
float BlinnExponentToGGXRoughness( const in float blinnExponent ) {
	return sqrt( 2.0 / ( blinnExponent + 2.0 ) );
}
#if defined( USE_SHEEN )
float D_Charlie(float roughness, float NoH) {
	float invAlpha = 1.0 / roughness;
	float cos2h = NoH * NoH;
	float sin2h = max(1.0 - cos2h, 0.0078125);	return (2.0 + invAlpha) * pow(sin2h, invAlpha * 0.5) / (2.0 * PI);
}
float V_Neubelt(float NoV, float NoL) {
	return saturate(1.0 / (4.0 * (NoL + NoV - NoL * NoV)));
}
vec3 BRDF_Specular_Sheen( const in float roughness, const in vec3 L, const in GeometricContext geometry, vec3 specularColor ) {
	vec3 N = geometry.normal;
	vec3 V = geometry.viewDir;
	vec3 H = normalize( V + L );
	float dotNH = saturate( dot( N, H ) );
	return specularColor * D_Charlie( roughness, dotNH ) * V_Neubelt( dot(N, V), dot(N, L) );
}
#endif`,qW=`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vUv );
		vec2 dSTdy = dFdy( vUv );
		float Hll = bumpScale * texture2D( bumpMap, vUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );
		vec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,jW=`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#pragma unroll_loop_start
	for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
		plane = clippingPlanes[ i ];
		if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
	}
	#pragma unroll_loop_end
	#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
		bool clipped = true;
		#pragma unroll_loop_start
		for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
		}
		#pragma unroll_loop_end
		if ( clipped ) discard;
	#endif
#endif`,YW=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,ZW=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,JW=`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,KW=`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,$W=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,QW=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	varying vec3 vColor;
#endif`,e6=`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif`,t6=`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate(a) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement(a) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract(sin(sn) * c);
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float max3( vec3 v ) { return max( max( v.x, v.y ), v.z ); }
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
struct GeometricContext {
	vec3 position;
	vec3 normal;
	vec3 viewDir;
#ifdef CLEARCOAT
	vec3 clearcoatNormal;
#endif
};
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
vec3 projectOnPlane(in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {
	float distance = dot( planeNormal, point - pointOnPlane );
	return - distance * planeNormal + point;
}
float sideOfPlane( in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {
	return sign( dot( point - pointOnPlane, planeNormal ) );
}
vec3 linePlaneIntersect( in vec3 pointOnLine, in vec3 lineDirection, in vec3 pointOnPlane, in vec3 planeNormal ) {
	return lineDirection * ( dot( planeNormal, pointOnPlane - pointOnLine ) / dot( planeNormal, lineDirection ) ) + pointOnLine;
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
float linearToRelativeLuminance( const in vec3 color ) {
	vec3 weights = vec3( 0.2126, 0.7152, 0.0722 );
	return dot( weights, color.rgb );
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}`,n6=`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_maxMipLevel 8.0
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_maxTileSize 256.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		float texelSize = 1.0 / ( 3.0 * cubeUV_maxTileSize );
		vec2 uv = getUV( direction, face ) * ( faceSize - 1.0 );
		vec2 f = fract( uv );
		uv += 0.5 - f;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		if ( mipInt < cubeUV_maxMipLevel ) {
			uv.y += 2.0 * cubeUV_maxTileSize;
		}
		uv.y += filterInt * 2.0 * cubeUV_minTileSize;
		uv.x += 3.0 * max( 0.0, cubeUV_maxTileSize - 2.0 * faceSize );
		uv *= texelSize;
		vec3 tl = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;
		uv.x += texelSize;
		vec3 tr = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;
		uv.y += texelSize;
		vec3 br = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;
		uv.x -= texelSize;
		vec3 bl = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;
		vec3 tm = mix( tl, tr, f.x );
		vec3 bm = mix( bl, br, f.x );
		return mix( tm, bm, f.y );
	}
	#define r0 1.0
	#define v0 0.339
	#define m0 - 2.0
	#define r1 0.8
	#define v1 0.276
	#define m1 - 1.0
	#define r4 0.4
	#define v4 0.046
	#define m4 2.0
	#define r5 0.305
	#define v5 0.016
	#define m5 3.0
	#define r6 0.21
	#define v6 0.0038
	#define m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= r1 ) {
			mip = ( r0 - roughness ) * ( m1 - m0 ) / ( r0 - r1 ) + m0;
		} else if ( roughness >= r4 ) {
			mip = ( r1 - roughness ) * ( m4 - m1 ) / ( r1 - r4 ) + m1;
		} else if ( roughness >= r5 ) {
			mip = ( r4 - roughness ) * ( m5 - m4 ) / ( r4 - r5 ) + m4;
		} else if ( roughness >= r6 ) {
			mip = ( r5 - roughness ) * ( m6 - m5 ) / ( r5 - r6 ) + m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), m0, cubeUV_maxMipLevel );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,i6=`vec3 transformedNormal = objectNormal;
#ifdef USE_INSTANCING
	mat3 m = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );
	transformedNormal = m * transformedNormal;
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	vec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,r6=`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,s6=`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );
#endif`,o6=`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vUv );
	emissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,a6=`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,l6="gl_FragColor = linearToOutputTexel( gl_FragColor );",c6=`
vec4 LinearToLinear( in vec4 value ) {
	return value;
}
vec4 GammaToLinear( in vec4 value, in float gammaFactor ) {
	return vec4( pow( value.rgb, vec3( gammaFactor ) ), value.a );
}
vec4 LinearToGamma( in vec4 value, in float gammaFactor ) {
	return vec4( pow( value.rgb, vec3( 1.0 / gammaFactor ) ), value.a );
}
vec4 sRGBToLinear( in vec4 value ) {
	return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );
}
vec4 LinearTosRGB( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}
vec4 RGBEToLinear( in vec4 value ) {
	return vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );
}
vec4 LinearToRGBE( in vec4 value ) {
	float maxComponent = max( max( value.r, value.g ), value.b );
	float fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );
	return vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );
}
vec4 RGBMToLinear( in vec4 value, in float maxRange ) {
	return vec4( value.rgb * value.a * maxRange, 1.0 );
}
vec4 LinearToRGBM( in vec4 value, in float maxRange ) {
	float maxRGB = max( value.r, max( value.g, value.b ) );
	float M = clamp( maxRGB / maxRange, 0.0, 1.0 );
	M = ceil( M * 255.0 ) / 255.0;
	return vec4( value.rgb / ( M * maxRange ), M );
}
vec4 RGBDToLinear( in vec4 value, in float maxRange ) {
	return vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );
}
vec4 LinearToRGBD( in vec4 value, in float maxRange ) {
	float maxRGB = max( value.r, max( value.g, value.b ) );
	float D = max( maxRange / maxRGB, 1.0 );
	D = clamp( floor( D ) / 255.0, 0.0, 1.0 );
	return vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );
}
const mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );
vec4 LinearToLogLuv( in vec4 value ) {
	vec3 Xp_Y_XYZp = cLogLuvM * value.rgb;
	Xp_Y_XYZp = max( Xp_Y_XYZp, vec3( 1e-6, 1e-6, 1e-6 ) );
	vec4 vResult;
	vResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;
	float Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;
	vResult.w = fract( Le );
	vResult.z = ( Le - ( floor( vResult.w * 255.0 ) ) / 255.0 ) / 255.0;
	return vResult;
}
const mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );
vec4 LogLuvToLinear( in vec4 value ) {
	float Le = value.z * 255.0 + value.w;
	vec3 Xp_Y_XYZp;
	Xp_Y_XYZp.y = exp2( ( Le - 127.0 ) / 2.0 );
	Xp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;
	Xp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;
	vec3 vRGB = cLogLuvInverseM * Xp_Y_XYZp.rgb;
	return vec4( max( vRGB, 0.0 ), 1.0 );
}`,u6=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 envColor = textureCubeUV( envMap, reflectVec, 0.0 );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifndef ENVMAP_TYPE_CUBE_UV
		envColor = envMapTexelToLinear( envColor );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,h6=`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	uniform int maxMipLevel;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
	
#endif`,d6=`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,f6=`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) ||defined( PHONG )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,p6=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,m6=`#ifdef USE_FOG
	fogDepth = - mvPosition.z;
#endif`,g6=`#ifdef USE_FOG
	varying float fogDepth;
#endif`,y6=`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * fogDepth * fogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, fogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,v6=`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float fogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,x6=`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return texture2D( gradientMap, coord ).rgb;
	#else
		return ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );
	#endif
}`,_6=`#ifdef USE_LIGHTMAP
	vec4 lightMapTexel= texture2D( lightMap, vUv2 );
	reflectedLight.indirectDiffuse += PI * lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;
#endif`,w6=`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,b6=`vec3 diffuse = vec3( 1.0 );
GeometricContext geometry;
geometry.position = mvPosition.xyz;
geometry.normal = normalize( transformedNormal );
geometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( -mvPosition.xyz );
GeometricContext backGeometry;
backGeometry.position = geometry.position;
backGeometry.normal = -geometry.normal;
backGeometry.viewDir = geometry.viewDir;
vLightFront = vec3( 0.0 );
vIndirectFront = vec3( 0.0 );
#ifdef DOUBLE_SIDED
	vLightBack = vec3( 0.0 );
	vIndirectBack = vec3( 0.0 );
#endif
IncidentLight directLight;
float dotNL;
vec3 directLightColor_Diffuse;
vIndirectFront += getAmbientLightIrradiance( ambientLightColor );
vIndirectFront += getLightProbeIrradiance( lightProbe, geometry );
#ifdef DOUBLE_SIDED
	vIndirectBack += getAmbientLightIrradiance( ambientLightColor );
	vIndirectBack += getLightProbeIrradiance( lightProbe, backGeometry );
#endif
#if NUM_POINT_LIGHTS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		getPointDirectLightIrradiance( pointLights[ i ], geometry, directLight );
		dotNL = dot( geometry.normal, directLight.direction );
		directLightColor_Diffuse = PI * directLight.color;
		vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
		#ifdef DOUBLE_SIDED
			vLightBack += saturate( -dotNL ) * directLightColor_Diffuse;
		#endif
	}
	#pragma unroll_loop_end
#endif
#if NUM_SPOT_LIGHTS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		getSpotDirectLightIrradiance( spotLights[ i ], geometry, directLight );
		dotNL = dot( geometry.normal, directLight.direction );
		directLightColor_Diffuse = PI * directLight.color;
		vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
		#ifdef DOUBLE_SIDED
			vLightBack += saturate( -dotNL ) * directLightColor_Diffuse;
		#endif
	}
	#pragma unroll_loop_end
#endif
#if NUM_DIR_LIGHTS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		getDirectionalDirectLightIrradiance( directionalLights[ i ], geometry, directLight );
		dotNL = dot( geometry.normal, directLight.direction );
		directLightColor_Diffuse = PI * directLight.color;
		vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
		#ifdef DOUBLE_SIDED
			vLightBack += saturate( -dotNL ) * directLightColor_Diffuse;
		#endif
	}
	#pragma unroll_loop_end
#endif
#if NUM_HEMI_LIGHTS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
		vIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );
		#ifdef DOUBLE_SIDED
			vIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry );
		#endif
	}
	#pragma unroll_loop_end
#endif`,M6=`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
uniform vec3 lightProbe[ 9 ];
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in GeometricContext geometry ) {
	vec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	#ifndef PHYSICALLY_CORRECT_LIGHTS
		irradiance *= PI;
	#endif
	return irradiance;
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalDirectLightIrradiance( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight directLight ) {
		directLight.color = directionalLight.color;
		directLight.direction = directionalLight.direction;
		directLight.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointDirectLightIrradiance( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight directLight ) {
		vec3 lVector = pointLight.position - geometry.position;
		directLight.direction = normalize( lVector );
		float lightDistance = length( lVector );
		directLight.color = pointLight.color;
		directLight.color *= punctualLightIntensityToIrradianceFactor( lightDistance, pointLight.distance, pointLight.decay );
		directLight.visible = ( directLight.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotDirectLightIrradiance( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight directLight ) {
		vec3 lVector = spotLight.position - geometry.position;
		directLight.direction = normalize( lVector );
		float lightDistance = length( lVector );
		float angleCos = dot( directLight.direction, spotLight.direction );
		if ( angleCos > spotLight.coneCos ) {
			float spotEffect = smoothstep( spotLight.coneCos, spotLight.penumbraCos, angleCos );
			directLight.color = spotLight.color;
			directLight.color *= spotEffect * punctualLightIntensityToIrradianceFactor( lightDistance, spotLight.distance, spotLight.decay );
			directLight.visible = true;
		} else {
			directLight.color = vec3( 0.0 );
			directLight.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in GeometricContext geometry ) {
		float dotNL = dot( geometry.normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		#ifndef PHYSICALLY_CORRECT_LIGHTS
			irradiance *= PI;
		#endif
		return irradiance;
	}
#endif`,S6=`#if defined( USE_ENVMAP )
	#ifdef ENVMAP_MODE_REFRACTION
		uniform float refractionRatio;
	#endif
	vec3 getLightProbeIndirectIrradiance( const in GeometricContext geometry, const in int maxMIPLevel ) {
		vec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );
		#ifdef ENVMAP_TYPE_CUBE
			vec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );
			#ifdef TEXTURE_LOD_EXT
				vec4 envMapColor = textureCubeLodEXT( envMap, queryVec, float( maxMIPLevel ) );
			#else
				vec4 envMapColor = textureCube( envMap, queryVec, float( maxMIPLevel ) );
			#endif
			envMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;
		#elif defined( ENVMAP_TYPE_CUBE_UV )
			vec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );
		#else
			vec4 envMapColor = vec4( 0.0 );
		#endif
		return PI * envMapColor.rgb * envMapIntensity;
	}
	float getSpecularMIPLevel( const in float roughness, const in int maxMIPLevel ) {
		float maxMIPLevelScalar = float( maxMIPLevel );
		float sigma = PI * roughness * roughness / ( 1.0 + roughness );
		float desiredMIPLevel = maxMIPLevelScalar + log2( sigma );
		return clamp( desiredMIPLevel, 0.0, maxMIPLevelScalar );
	}
	vec3 getLightProbeIndirectRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in int maxMIPLevel ) {
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( -viewDir, normal );
			reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
		#else
			vec3 reflectVec = refract( -viewDir, normal, refractionRatio );
		#endif
		reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
		float specularMIPLevel = getSpecularMIPLevel( roughness, maxMIPLevel );
		#ifdef ENVMAP_TYPE_CUBE
			vec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );
			#ifdef TEXTURE_LOD_EXT
				vec4 envMapColor = textureCubeLodEXT( envMap, queryReflectVec, specularMIPLevel );
			#else
				vec4 envMapColor = textureCube( envMap, queryReflectVec, specularMIPLevel );
			#endif
			envMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;
		#elif defined( ENVMAP_TYPE_CUBE_UV )
			vec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );
		#endif
		return envMapColor.rgb * envMapIntensity;
	}
#endif`,T6=`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,E6=`varying vec3 vViewPosition;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;
	#ifndef PHYSICALLY_CORRECT_LIGHTS
		irradiance *= PI;
	#endif
	reflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon
#define Material_LightProbeLOD( material )	(0)`,A6=`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,C6=`varying vec3 vViewPosition;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifndef PHYSICALLY_CORRECT_LIGHTS
		irradiance *= PI;
	#endif
	reflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_Specular_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong
#define Material_LightProbeLOD( material )	(0)`,L6=`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.specularRoughness = max( roughnessFactor, 0.0525 );material.specularRoughness += geometryRoughness;
material.specularRoughness = min( material.specularRoughness, 1.0 );
#ifdef REFLECTIVITY
	material.specularColor = mix( vec3( MAXIMUM_SPECULAR_COEFFICIENT * pow2( reflectivity ) ), diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( DEFAULT_SPECULAR_COEFFICIENT ), diffuseColor.rgb, metalnessFactor );
#endif
#ifdef CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheen;
#endif`,R6=`struct PhysicalMaterial {
	vec3 diffuseColor;
	float specularRoughness;
	vec3 specularColor;
#ifdef CLEARCOAT
	float clearcoat;
	float clearcoatRoughness;
#endif
#ifdef USE_SHEEN
	vec3 sheenColor;
#endif
};
#define MAXIMUM_SPECULAR_COEFFICIENT 0.16
#define DEFAULT_SPECULAR_COEFFICIENT 0.04
float clearcoatDHRApprox( const in float roughness, const in float dotNL ) {
	return DEFAULT_SPECULAR_COEFFICIENT + ( 1.0 - DEFAULT_SPECULAR_COEFFICIENT ) * ( pow( 1.0 - dotNL, 5.0 ) * pow( 1.0 - roughness, 2.0 ) );
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometry.normal;
		vec3 viewDir = geometry.viewDir;
		vec3 position = geometry.position;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.specularRoughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifndef PHYSICALLY_CORRECT_LIGHTS
		irradiance *= PI;
	#endif
	#ifdef CLEARCOAT
		float ccDotNL = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = ccDotNL * directLight.color;
		#ifndef PHYSICALLY_CORRECT_LIGHTS
			ccIrradiance *= PI;
		#endif
		float clearcoatDHR = material.clearcoat * clearcoatDHRApprox( material.clearcoatRoughness, ccDotNL );
		reflectedLight.directSpecular += ccIrradiance * material.clearcoat * BRDF_Specular_GGX( directLight, geometry.viewDir, geometry.clearcoatNormal, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearcoatRoughness );
	#else
		float clearcoatDHR = 0.0;
	#endif
	#ifdef USE_SHEEN
		reflectedLight.directSpecular += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Specular_Sheen(
			material.specularRoughness,
			directLight.direction,
			geometry,
			material.sheenColor
		);
	#else
		reflectedLight.directSpecular += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Specular_GGX( directLight, geometry.viewDir, geometry.normal, material.specularColor, material.specularRoughness);
	#endif
	reflectedLight.directDiffuse += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef CLEARCOAT
		float ccDotNV = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );
		reflectedLight.indirectSpecular += clearcoatRadiance * material.clearcoat * BRDF_Specular_GGX_Environment( geometry.viewDir, geometry.clearcoatNormal, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearcoatRoughness );
		float ccDotNL = ccDotNV;
		float clearcoatDHR = material.clearcoat * clearcoatDHRApprox( material.clearcoatRoughness, ccDotNL );
	#else
		float clearcoatDHR = 0.0;
	#endif
	float clearcoatInv = 1.0 - clearcoatDHR;
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	BRDF_Specular_Multiscattering_Environment( geometry, material.specularColor, material.specularRoughness, singleScattering, multiScattering );
	vec3 diffuse = material.diffuseColor * ( 1.0 - ( singleScattering + multiScattering ) );
	reflectedLight.indirectSpecular += clearcoatInv * radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,P6=`
GeometricContext geometry;
geometry.position = - vViewPosition;
geometry.normal = normal;
geometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
#ifdef CLEARCOAT
	geometry.clearcoatNormal = clearcoatNormal;
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointDirectLightIrradiance( pointLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotDirectLightIrradiance( spotLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalDirectLightIrradiance( directionalLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	irradiance += getLightProbeIrradiance( lightProbe, geometry );
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,I6=`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel= texture2D( lightMap, vUv2 );
		vec3 lightMapIrradiance = lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;
		#ifndef PHYSICALLY_CORRECT_LIGHTS
			lightMapIrradiance *= PI;
		#endif
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getLightProbeIndirectIrradiance( geometry, maxMipLevel );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	radiance += getLightProbeIndirectRadiance( geometry.viewDir, geometry.normal, material.specularRoughness, maxMipLevel );
	#ifdef CLEARCOAT
		clearcoatRadiance += getLightProbeIndirectRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness, maxMipLevel );
	#endif
#endif`,D6=`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );
#endif`,F6=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	gl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,B6=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,N6=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		varying float vFragDepth;
		varying float vIsPerspective;
	#else
		uniform float logDepthBufFC;
	#endif
#endif`,O6=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		vFragDepth = 1.0 + gl_Position.w;
		vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
	#else
		if ( isPerspectiveMatrix( projectionMatrix ) ) {
			gl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;
			gl_Position.z *= gl_Position.w;
		}
	#endif
#endif`,k6=`#ifdef USE_MAP
	vec4 texelColor = texture2D( map, vUv );
	texelColor = mapTexelToLinear( texelColor );
	diffuseColor *= texelColor;
#endif`,z6=`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,U6=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
#endif
#ifdef USE_MAP
	vec4 mapTexel = texture2D( map, uv );
	diffuseColor *= mapTexelToLinear( mapTexel );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,H6=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	uniform mat3 uvTransform;
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,G6=`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vUv );
	metalnessFactor *= texelMetalness.b;
#endif`,V6=`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,W6=`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	objectNormal += morphNormal0 * morphTargetInfluences[ 0 ];
	objectNormal += morphNormal1 * morphTargetInfluences[ 1 ];
	objectNormal += morphNormal2 * morphTargetInfluences[ 2 ];
	objectNormal += morphNormal3 * morphTargetInfluences[ 3 ];
#endif`,X6=`#ifdef USE_MORPHTARGETS
	uniform float morphTargetBaseInfluence;
	#ifndef USE_MORPHNORMALS
		uniform float morphTargetInfluences[ 8 ];
	#else
		uniform float morphTargetInfluences[ 4 ];
	#endif
#endif`,q6=`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	transformed += morphTarget0 * morphTargetInfluences[ 0 ];
	transformed += morphTarget1 * morphTargetInfluences[ 1 ];
	transformed += morphTarget2 * morphTargetInfluences[ 2 ];
	transformed += morphTarget3 * morphTargetInfluences[ 3 ];
	#ifndef USE_MORPHNORMALS
		transformed += morphTarget4 * morphTargetInfluences[ 4 ];
		transformed += morphTarget5 * morphTargetInfluences[ 5 ];
		transformed += morphTarget6 * morphTargetInfluences[ 6 ];
		transformed += morphTarget7 * morphTargetInfluences[ 7 ];
	#endif
#endif`,j6=`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );
	vec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	#ifdef USE_TANGENT
		vec3 tangent = normalize( vTangent );
		vec3 bitangent = normalize( vBitangent );
		#ifdef DOUBLE_SIDED
			tangent = tangent * faceDirection;
			bitangent = bitangent * faceDirection;
		#endif
		#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )
			mat3 vTBN = mat3( tangent, bitangent, normal );
		#endif
	#endif
#endif
vec3 geometryNormal = normal;`,Y6=`#ifdef OBJECTSPACE_NORMALMAP
	normal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( TANGENTSPACE_NORMALMAP )
	vec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	#ifdef USE_TANGENT
		normal = normalize( vTBN * mapN );
	#else
		normal = perturbNormal2Arb( -vViewPosition, normal, mapN, faceDirection );
	#endif
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,Z6=`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef OBJECTSPACE_NORMALMAP
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )
	vec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN, float faceDirection ) {
		vec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );
		vec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );
		vec2 st0 = dFdx( vUv.st );
		vec2 st1 = dFdy( vUv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : faceDirection * inversesqrt( det );
		return normalize( T * ( mapN.x * scale ) + B * ( mapN.y * scale ) + N * mapN.z );
	}
#endif`,J6=`#ifdef CLEARCOAT
	vec3 clearcoatNormal = geometryNormal;
#endif`,K6=`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	#ifdef USE_TANGENT
		clearcoatNormal = normalize( vTBN * clearcoatMapN );
	#else
		clearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN, faceDirection );
	#endif
#endif`,$6=`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif`,Q6=`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;
const vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );
const vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );
const float ShiftRight8 = 1. / 256.;
vec4 packDepthToRGBA( const in float v ) {
	vec4 r = vec4( fract( v * PackFactors ), v );
	r.yzw -= r.xyz * ShiftRight8;	return r * PackUpscale;
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors );
}
vec4 pack2HalfToRGBA( vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ));
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w);
}
vec2 unpackRGBATo2Half( vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {
	return linearClipZ * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return (( near + viewZ ) * far ) / (( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * invClipZ - far );
}`,e8=`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,t8=`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,n8=`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,i8=`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,r8=`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vUv );
	roughnessFactor *= texelRoughness.g;
#endif`,s8=`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,o8=`#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		varying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		float hard_shadow = step( compare , distribution.x );
		if (hard_shadow != 1.0 ) {
			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );
		bool inFrustum = all( inFrustumVec );
		bvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );
		bool frustumTest = all( frustumTestVec );
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ), 
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ), 
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ), 
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ), 
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ), 
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ), 
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return shadow;
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
		vec3 lightToPosition = shadowCoord.xyz;
		float dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );		dp += shadowBias;
		vec3 bd3D = normalize( lightToPosition );
		#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
			vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
			return (
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
			) * ( 1.0 / 9.0 );
		#else
			return texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
		#endif
	}
#endif`,a8=`#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHT_SHADOWS ];
		varying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,l8=`#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0 || NUM_SPOT_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0
		vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		vec4 shadowWorldPosition;
	#endif
	#if NUM_DIR_LIGHT_SHADOWS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
		vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias, 0 );
		vSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
		vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
	#endif
#endif`,c8=`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,u8=`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,h8=`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	#ifdef BONE_TEXTURE
		uniform highp sampler2D boneTexture;
		uniform int boneTextureSize;
		mat4 getBoneMatrix( const in float i ) {
			float j = i * 4.0;
			float x = mod( j, float( boneTextureSize ) );
			float y = floor( j / float( boneTextureSize ) );
			float dx = 1.0 / float( boneTextureSize );
			float dy = 1.0 / float( boneTextureSize );
			y = dy * ( y + 0.5 );
			vec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );
			vec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );
			vec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );
			vec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );
			mat4 bone = mat4( v1, v2, v3, v4 );
			return bone;
		}
	#else
		uniform mat4 boneMatrices[ MAX_BONES ];
		mat4 getBoneMatrix( const in float i ) {
			mat4 bone = boneMatrices[ int(i) ];
			return bone;
		}
	#endif
#endif`,d8=`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,f8=`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,p8=`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,m8=`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,g8=`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,y8=`#ifndef saturate
#define saturate(a) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return toneMappingExposure * color;
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 OptimizedCineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,v8=`#ifdef USE_TRANSMISSION
	float transmissionFactor = transmission;
	float thicknessFactor = thickness;
	#ifdef USE_TRANSMISSIONMAP
		transmissionFactor *= texture2D( transmissionMap, vUv ).r;
	#endif
	#ifdef USE_THICKNESSNMAP
		thicknessFactor *= texture2D( thicknessMap, vUv ).g;
	#endif
	vec3 pos = vWorldPosition.xyz / vWorldPosition.w;
	vec3 v = normalize( cameraPosition - pos );
	float ior = ( 1.0 + 0.4 * reflectivity ) / ( 1.0 - 0.4 * reflectivity );
	vec3 transmission = transmissionFactor * getIBLVolumeRefraction(
		normal, v, roughnessFactor, material.diffuseColor, totalSpecular,
		pos, modelMatrix, viewMatrix, projectionMatrix, ior, thicknessFactor,
		attenuationColor, attenuationDistance );
	totalDiffuse = mix( totalDiffuse, transmission, transmissionFactor );
#endif`,x8=`#ifdef USE_TRANSMISSION
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec4 vWorldPosition;
	vec3 getVolumeTransmissionRay(vec3 n, vec3 v, float thickness, float ior, mat4 modelMatrix) {
		vec3 refractionVector = refract(-v, normalize(n), 1.0 / ior);
		vec3 modelScale;
		modelScale.x = length(vec3(modelMatrix[0].xyz));
		modelScale.y = length(vec3(modelMatrix[1].xyz));
		modelScale.z = length(vec3(modelMatrix[2].xyz));
		return normalize(refractionVector) * thickness * modelScale;
	}
	float applyIorToRoughness(float roughness, float ior) {
		return roughness * clamp(ior * 2.0 - 2.0, 0.0, 1.0);
	}
	vec3 getTransmissionSample(vec2 fragCoord, float roughness, float ior) {
		float framebufferLod = log2(transmissionSamplerSize.x) * applyIorToRoughness(roughness, ior);
		return texture2DLodEXT(transmissionSamplerMap, fragCoord.xy, framebufferLod).rgb;
	}
	vec3 applyVolumeAttenuation(vec3 radiance, float transmissionDistance, vec3 attenuationColor, float attenuationDistance) {
		if (attenuationDistance == 0.0) {
			return radiance;
		} else {
			vec3 attenuationCoefficient = -log(attenuationColor) / attenuationDistance;
			vec3 transmittance = exp(-attenuationCoefficient * transmissionDistance);			return transmittance * radiance;
		}
	}
	vec3 getIBLVolumeRefraction(vec3 n, vec3 v, float perceptualRoughness, vec3 baseColor, vec3 specularColor,
		vec3 position, mat4 modelMatrix, mat4 viewMatrix, mat4 projMatrix, float ior, float thickness,
		vec3 attenuationColor, float attenuationDistance) {
		vec3 transmissionRay = getVolumeTransmissionRay(n, v, thickness, ior, modelMatrix);
		vec3 refractedRayExit = position + transmissionRay;
		vec4 ndcPos = projMatrix * viewMatrix * vec4(refractedRayExit, 1.0);
		vec2 refractionCoords = ndcPos.xy / ndcPos.w;
		refractionCoords += 1.0;
		refractionCoords /= 2.0;
		vec3 transmittedLight = getTransmissionSample(refractionCoords, perceptualRoughness, ior);
		vec3 attenuatedColor = applyVolumeAttenuation(transmittedLight, length(transmissionRay), attenuationColor, attenuationDistance);
		return (1.0 - specularColor) * attenuatedColor * baseColor;
	}
#endif`,_8=`#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )
	varying vec2 vUv;
#endif`,w8=`#ifdef USE_UV
	#ifdef UVS_VERTEX_ONLY
		vec2 vUv;
	#else
		varying vec2 vUv;
	#endif
	uniform mat3 uvTransform;
#endif`,b8=`#ifdef USE_UV
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
#endif`,M8=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	varying vec2 vUv2;
#endif`,S8=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	attribute vec2 uv2;
	varying vec2 vUv2;
	uniform mat3 uv2Transform;
#endif`,T8=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	vUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;
#endif`,E8=`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION )
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`,A8=`uniform sampler2D t2D;
varying vec2 vUv;
void main() {
	vec4 texColor = texture2D( t2D, vUv );
	gl_FragColor = mapTexelToLinear( texColor );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,C8=`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,L8=`#include <envmap_common_pars_fragment>
uniform float opacity;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	vec3 vReflect = vWorldDirection;
	#include <envmap_fragment>
	gl_FragColor = envColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,R8=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,P8=`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <logdepthbuf_fragment>
	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#endif
}`,I8=`#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,D8=`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,F8=`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,B8=`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	vec4 texColor = texture2D( tEquirect, sampleUV );
	gl_FragColor = mapTexelToLinear( texColor );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,N8=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,O8=`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,k8=`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <color_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,z8=`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <cube_uv_reflection_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
	
		vec4 lightMapTexel= texture2D( lightMap, vUv2 );
		reflectedLight.indirectDiffuse += lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,U8=`#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <skinbase_vertex>
	#ifdef USE_ENVMAP
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,H8=`uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
varying vec3 vLightFront;
varying vec3 vIndirectFront;
#ifdef DOUBLE_SIDED
	varying vec3 vLightBack;
	varying vec3 vIndirectBack;
#endif
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <cube_uv_reflection_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <fog_pars_fragment>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <emissivemap_fragment>
	#ifdef DOUBLE_SIDED
		reflectedLight.indirectDiffuse += ( gl_FrontFacing ) ? vIndirectFront : vIndirectBack;
	#else
		reflectedLight.indirectDiffuse += vIndirectFront;
	#endif
	#include <lightmap_fragment>
	reflectedLight.indirectDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb );
	#ifdef DOUBLE_SIDED
		reflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;
	#else
		reflectedLight.directDiffuse = vLightFront;
	#endif
	reflectedLight.directDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb ) * getShadowMask();
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,G8=`#define LAMBERT
varying vec3 vLightFront;
varying vec3 vIndirectFront;
#ifdef DOUBLE_SIDED
	varying vec3 vLightBack;
	varying vec3 vIndirectBack;
#endif
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <envmap_pars_vertex>
#include <bsdfs>
#include <lights_pars_begin>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <lights_lambert_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,V8=`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <fog_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
		matcapColor = matcapTexelToLinear( matcapColor );
	#else
		vec4 matcapColor = vec4( 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,W8=`#define MATCAP
varying vec3 vViewPosition;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#ifndef FLAT_SHADED
		vNormal = normalize( transformedNormal );
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,X8=`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,q8=`#define TOON
varying vec3 vViewPosition;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,j8=`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <cube_uv_reflection_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,Y8=`#define PHONG
varying vec3 vViewPosition;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,Z8=`#define STANDARD
#ifdef PHYSICAL
	#define REFLECTIVITY
	#define CLEARCOAT
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform vec3 attenuationColor;
	uniform float attenuationDistance;
#endif
#ifdef REFLECTIVITY
	uniform float reflectivity;
#endif
#ifdef CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheen;
#endif
varying vec3 vViewPosition;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <bsdfs>
#include <transmission_pars_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <lights_physical_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,J8=`#define STANDARD
varying vec3 vViewPosition;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif
#ifdef USE_TRANSMISSION
	varying vec4 vWorldPosition;
#endif
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition;
#endif
}`,K8=`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	varying vec3 vViewPosition;
#endif
#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif
#include <packing>
#include <uv_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), opacity );
}`,$8=`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	varying vec3 vViewPosition;
#endif
#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	vViewPosition = - mvPosition.xyz;
#endif
}`,Q8=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,e7=`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <color_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,t7=`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`,n7=`#include <common>
#include <fog_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <begin_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,i7=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`,r7=`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
	vec2 scale;
	scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
	scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,ut={alphamap_fragment:kW,alphamap_pars_fragment:zW,alphatest_fragment:UW,aomap_fragment:HW,aomap_pars_fragment:GW,begin_vertex:VW,beginnormal_vertex:WW,bsdfs:XW,bumpmap_pars_fragment:qW,clipping_planes_fragment:jW,clipping_planes_pars_fragment:YW,clipping_planes_pars_vertex:ZW,clipping_planes_vertex:JW,color_fragment:KW,color_pars_fragment:$W,color_pars_vertex:QW,color_vertex:e6,common:t6,cube_uv_reflection_fragment:n6,defaultnormal_vertex:i6,displacementmap_pars_vertex:r6,displacementmap_vertex:s6,emissivemap_fragment:o6,emissivemap_pars_fragment:a6,encodings_fragment:l6,encodings_pars_fragment:c6,envmap_fragment:u6,envmap_common_pars_fragment:h6,envmap_pars_fragment:d6,envmap_pars_vertex:f6,envmap_physical_pars_fragment:S6,envmap_vertex:p6,fog_vertex:m6,fog_pars_vertex:g6,fog_fragment:y6,fog_pars_fragment:v6,gradientmap_pars_fragment:x6,lightmap_fragment:_6,lightmap_pars_fragment:w6,lights_lambert_vertex:b6,lights_pars_begin:M6,lights_toon_fragment:T6,lights_toon_pars_fragment:E6,lights_phong_fragment:A6,lights_phong_pars_fragment:C6,lights_physical_fragment:L6,lights_physical_pars_fragment:R6,lights_fragment_begin:P6,lights_fragment_maps:I6,lights_fragment_end:D6,logdepthbuf_fragment:F6,logdepthbuf_pars_fragment:B6,logdepthbuf_pars_vertex:N6,logdepthbuf_vertex:O6,map_fragment:k6,map_pars_fragment:z6,map_particle_fragment:U6,map_particle_pars_fragment:H6,metalnessmap_fragment:G6,metalnessmap_pars_fragment:V6,morphnormal_vertex:W6,morphtarget_pars_vertex:X6,morphtarget_vertex:q6,normal_fragment_begin:j6,normal_fragment_maps:Y6,normalmap_pars_fragment:Z6,clearcoat_normal_fragment_begin:J6,clearcoat_normal_fragment_maps:K6,clearcoat_pars_fragment:$6,packing:Q6,premultiplied_alpha_fragment:e8,project_vertex:t8,dithering_fragment:n8,dithering_pars_fragment:i8,roughnessmap_fragment:r8,roughnessmap_pars_fragment:s8,shadowmap_pars_fragment:o8,shadowmap_pars_vertex:a8,shadowmap_vertex:l8,shadowmask_pars_fragment:c8,skinbase_vertex:u8,skinning_pars_vertex:h8,skinning_vertex:d8,skinnormal_vertex:f8,specularmap_fragment:p8,specularmap_pars_fragment:m8,tonemapping_fragment:g8,tonemapping_pars_fragment:y8,transmission_fragment:v8,transmission_pars_fragment:x8,uv_pars_fragment:_8,uv_pars_vertex:w8,uv_vertex:b8,uv2_pars_fragment:M8,uv2_pars_vertex:S8,uv2_vertex:T8,worldpos_vertex:E8,background_frag:A8,background_vert:C8,cube_frag:L8,cube_vert:R8,depth_frag:P8,depth_vert:I8,distanceRGBA_frag:D8,distanceRGBA_vert:F8,equirect_frag:B8,equirect_vert:N8,linedashed_frag:O8,linedashed_vert:k8,meshbasic_frag:z8,meshbasic_vert:U8,meshlambert_frag:H8,meshlambert_vert:G8,meshmatcap_frag:V8,meshmatcap_vert:W8,meshtoon_frag:X8,meshtoon_vert:q8,meshphong_frag:j8,meshphong_vert:Y8,meshphysical_frag:Z8,meshphysical_vert:J8,normal_frag:K8,normal_vert:$8,points_frag:Q8,points_vert:e7,shadow_frag:t7,shadow_vert:n7,sprite_frag:i7,sprite_vert:r7},Ge={common:{diffuse:{value:new Je(16777215)},opacity:{value:1},map:{value:null},uvTransform:{value:new Nn},uv2Transform:{value:new Nn},alphaMap:{value:null}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},refractionRatio:{value:.98},maxMipLevel:{value:0}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new ke(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Je(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new Je(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},uvTransform:{value:new Nn}},sprite:{diffuse:{value:new Je(16777215)},opacity:{value:1},center:{value:new ke(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},uvTransform:{value:new Nn}}},Ps={basic:{uniforms:di([Ge.common,Ge.specularmap,Ge.envmap,Ge.aomap,Ge.lightmap,Ge.fog]),vertexShader:ut.meshbasic_vert,fragmentShader:ut.meshbasic_frag},lambert:{uniforms:di([Ge.common,Ge.specularmap,Ge.envmap,Ge.aomap,Ge.lightmap,Ge.emissivemap,Ge.fog,Ge.lights,{emissive:{value:new Je(0)}}]),vertexShader:ut.meshlambert_vert,fragmentShader:ut.meshlambert_frag},phong:{uniforms:di([Ge.common,Ge.specularmap,Ge.envmap,Ge.aomap,Ge.lightmap,Ge.emissivemap,Ge.bumpmap,Ge.normalmap,Ge.displacementmap,Ge.fog,Ge.lights,{emissive:{value:new Je(0)},specular:{value:new Je(1118481)},shininess:{value:30}}]),vertexShader:ut.meshphong_vert,fragmentShader:ut.meshphong_frag},standard:{uniforms:di([Ge.common,Ge.envmap,Ge.aomap,Ge.lightmap,Ge.emissivemap,Ge.bumpmap,Ge.normalmap,Ge.displacementmap,Ge.roughnessmap,Ge.metalnessmap,Ge.fog,Ge.lights,{emissive:{value:new Je(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:ut.meshphysical_vert,fragmentShader:ut.meshphysical_frag},toon:{uniforms:di([Ge.common,Ge.aomap,Ge.lightmap,Ge.emissivemap,Ge.bumpmap,Ge.normalmap,Ge.displacementmap,Ge.gradientmap,Ge.fog,Ge.lights,{emissive:{value:new Je(0)}}]),vertexShader:ut.meshtoon_vert,fragmentShader:ut.meshtoon_frag},matcap:{uniforms:di([Ge.common,Ge.bumpmap,Ge.normalmap,Ge.displacementmap,Ge.fog,{matcap:{value:null}}]),vertexShader:ut.meshmatcap_vert,fragmentShader:ut.meshmatcap_frag},points:{uniforms:di([Ge.points,Ge.fog]),vertexShader:ut.points_vert,fragmentShader:ut.points_frag},dashed:{uniforms:di([Ge.common,Ge.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:ut.linedashed_vert,fragmentShader:ut.linedashed_frag},depth:{uniforms:di([Ge.common,Ge.displacementmap]),vertexShader:ut.depth_vert,fragmentShader:ut.depth_frag},normal:{uniforms:di([Ge.common,Ge.bumpmap,Ge.normalmap,Ge.displacementmap,{opacity:{value:1}}]),vertexShader:ut.normal_vert,fragmentShader:ut.normal_frag},sprite:{uniforms:di([Ge.sprite,Ge.fog]),vertexShader:ut.sprite_vert,fragmentShader:ut.sprite_frag},background:{uniforms:{uvTransform:{value:new Nn},t2D:{value:null}},vertexShader:ut.background_vert,fragmentShader:ut.background_frag},cube:{uniforms:di([Ge.envmap,{opacity:{value:1}}]),vertexShader:ut.cube_vert,fragmentShader:ut.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:ut.equirect_vert,fragmentShader:ut.equirect_frag},distanceRGBA:{uniforms:di([Ge.common,Ge.displacementmap,{referencePosition:{value:new le},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:ut.distanceRGBA_vert,fragmentShader:ut.distanceRGBA_frag},shadow:{uniforms:di([Ge.lights,Ge.fog,{color:{value:new Je(0)},opacity:{value:1}}]),vertexShader:ut.shadow_vert,fragmentShader:ut.shadow_frag}};Ps.physical={uniforms:di([Ps.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new ke(1,1)},clearcoatNormalMap:{value:null},sheen:{value:new Je(0)},transmission:{value:0},transmissionMap:{value:null},transmissionSamplerSize:{value:new ke},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},attenuationDistance:{value:0},attenuationColor:{value:new Je(0)}}]),vertexShader:ut.meshphysical_vert,fragmentShader:ut.meshphysical_frag};function s7(o,e,t,n,i){let r=new Je(0),s=0,a,l,c=null,u=0,d=null;function h(p,g){let v=!1,y=g.isScene===!0?g.background:null;y&&y.isTexture&&(y=e.get(y));let m=o.xr,x=m.getSession&&m.getSession();x&&x.environmentBlendMode==="additive"&&(y=null),y===null?f(r,s):y&&y.isColor&&(f(y,1),v=!0),(o.autoClear||v)&&o.clear(o.autoClearColor,o.autoClearDepth,o.autoClearStencil),y&&(y.isCubeTexture||y.mapping===Lb)?(l===void 0&&(l=new Oi(new Da(1,1,1),new Fa({name:"BackgroundCubeMaterial",uniforms:_h(Ps.cube.uniforms),vertexShader:Ps.cube.vertexShader,fragmentShader:Ps.cube.fragmentShader,side:Ln,depthTest:!1,depthWrite:!1,fog:!1})),l.geometry.deleteAttribute("normal"),l.geometry.deleteAttribute("uv"),l.onBeforeRender=function(_,w,b){this.matrixWorld.copyPosition(b.matrixWorld)},Object.defineProperty(l.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),n.update(l)),l.material.uniforms.envMap.value=y,l.material.uniforms.flipEnvMap.value=y.isCubeTexture&&y._needsFlipEnvMap?-1:1,(c!==y||u!==y.version||d!==o.toneMapping)&&(l.material.needsUpdate=!0,c=y,u=y.version,d=o.toneMapping),p.unshift(l,l.geometry,l.material,0,0,null)):y&&y.isTexture&&(a===void 0&&(a=new Oi(new Sh(2,2),new Fa({name:"BackgroundMaterial",uniforms:_h(Ps.background.uniforms),vertexShader:Ps.background.vertexShader,fragmentShader:Ps.background.fragmentShader,side:Kf,depthTest:!1,depthWrite:!1,fog:!1})),a.geometry.deleteAttribute("normal"),Object.defineProperty(a.material,"map",{get:function(){return this.uniforms.t2D.value}}),n.update(a)),a.material.uniforms.t2D.value=y,y.matrixAutoUpdate===!0&&y.updateMatrix(),a.material.uniforms.uvTransform.value.copy(y.matrix),(c!==y||u!==y.version||d!==o.toneMapping)&&(a.material.needsUpdate=!0,c=y,u=y.version,d=o.toneMapping),p.unshift(a,a.geometry,a.material,0,0,null))}function f(p,g){t.buffers.color.setClear(p.r,p.g,p.b,g,i)}return{getClearColor:function(){return r},setClearColor:function(p,g=1){r.set(p),s=g,f(r,s)},getClearAlpha:function(){return s},setClearAlpha:function(p){s=p,f(r,s)},render:h}}function o7(o,e,t,n){let i=o.getParameter(34921),r=n.isWebGL2?null:e.get("OES_vertex_array_object"),s=n.isWebGL2||r!==null,a={},l=g(null),c=l;function u(R,D,P,I,N){let G=!1;if(s){let z=p(I,P,D);c!==z&&(c=z,h(c.object)),G=v(I,N),G&&y(I,N)}else{let z=D.wireframe===!0;(c.geometry!==I.id||c.program!==P.id||c.wireframe!==z)&&(c.geometry=I.id,c.program=P.id,c.wireframe=z,G=!0)}R.isInstancedMesh===!0&&(G=!0),N!==null&&t.update(N,34963),G&&(M(R,D,P,I),N!==null&&o.bindBuffer(34963,t.get(N).buffer))}function d(){return n.isWebGL2?o.createVertexArray():r.createVertexArrayOES()}function h(R){return n.isWebGL2?o.bindVertexArray(R):r.bindVertexArrayOES(R)}function f(R){return n.isWebGL2?o.deleteVertexArray(R):r.deleteVertexArrayOES(R)}function p(R,D,P){let I=P.wireframe===!0,N=a[R.id];N===void 0&&(N={},a[R.id]=N);let G=N[D.id];G===void 0&&(G={},N[D.id]=G);let z=G[I];return z===void 0&&(z=g(d()),G[I]=z),z}function g(R){let D=[],P=[],I=[];for(let N=0;N<i;N++)D[N]=0,P[N]=0,I[N]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:D,enabledAttributes:P,attributeDivisors:I,object:R,attributes:{},index:null}}function v(R,D){let P=c.attributes,I=R.attributes,N=0;for(let G in I){let z=P[G],se=I[G];if(z===void 0||z.attribute!==se||z.data!==se.data)return!0;N++}return c.attributesNum!==N||c.index!==D}function y(R,D){let P={},I=R.attributes,N=0;for(let G in I){let z=I[G],se={};se.attribute=z,z.data&&(se.data=z.data),P[G]=se,N++}c.attributes=P,c.attributesNum=N,c.index=D}function m(){let R=c.newAttributes;for(let D=0,P=R.length;D<P;D++)R[D]=0}function x(R){_(R,0)}function _(R,D){let P=c.newAttributes,I=c.enabledAttributes,N=c.attributeDivisors;P[R]=1,I[R]===0&&(o.enableVertexAttribArray(R),I[R]=1),N[R]!==D&&((n.isWebGL2?o:e.get("ANGLE_instanced_arrays"))[n.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](R,D),N[R]=D)}function w(){let R=c.newAttributes,D=c.enabledAttributes;for(let P=0,I=D.length;P<I;P++)D[P]!==R[P]&&(o.disableVertexAttribArray(P),D[P]=0)}function b(R,D,P,I,N,G){n.isWebGL2===!0&&(P===5124||P===5125)?o.vertexAttribIPointer(R,D,P,N,G):o.vertexAttribPointer(R,D,P,I,N,G)}function M(R,D,P,I){if(n.isWebGL2===!1&&(R.isInstancedMesh||I.isInstancedBufferGeometry)&&e.get("ANGLE_instanced_arrays")===null)return;m();let N=I.attributes,G=P.getAttributes(),z=D.defaultAttributeValues;for(let se in G){let ne=G[se];if(ne>=0){let Q=N[se];if(Q!==void 0){let j=Q.normalized,O=Q.itemSize,ee=t.get(Q);if(ee===void 0)continue;let V=ee.buffer,ie=ee.type,ue=ee.bytesPerElement;if(Q.isInterleavedBufferAttribute){let ye=Q.data,pe=ye.stride,xe=Q.offset;ye&&ye.isInstancedInterleavedBuffer?(_(ne,ye.meshPerAttribute),I._maxInstanceCount===void 0&&(I._maxInstanceCount=ye.meshPerAttribute*ye.count)):x(ne),o.bindBuffer(34962,V),b(ne,O,ie,j,pe*ue,xe*ue)}else Q.isInstancedBufferAttribute?(_(ne,Q.meshPerAttribute),I._maxInstanceCount===void 0&&(I._maxInstanceCount=Q.meshPerAttribute*Q.count)):x(ne),o.bindBuffer(34962,V),b(ne,O,ie,j,0,0)}else if(se==="instanceMatrix"){let j=t.get(R.instanceMatrix);if(j===void 0)continue;let O=j.buffer,ee=j.type;_(ne+0,1),_(ne+1,1),_(ne+2,1),_(ne+3,1),o.bindBuffer(34962,O),o.vertexAttribPointer(ne+0,4,ee,!1,64,0),o.vertexAttribPointer(ne+1,4,ee,!1,64,16),o.vertexAttribPointer(ne+2,4,ee,!1,64,32),o.vertexAttribPointer(ne+3,4,ee,!1,64,48)}else if(se==="instanceColor"){let j=t.get(R.instanceColor);if(j===void 0)continue;let O=j.buffer,ee=j.type;_(ne,1),o.bindBuffer(34962,O),o.vertexAttribPointer(ne,3,ee,!1,12,0)}else if(z!==void 0){let j=z[se];if(j!==void 0)switch(j.length){case 2:o.vertexAttrib2fv(ne,j);break;case 3:o.vertexAttrib3fv(ne,j);break;case 4:o.vertexAttrib4fv(ne,j);break;default:o.vertexAttrib1fv(ne,j)}}}}w()}function S(){L();for(let R in a){let D=a[R];for(let P in D){let I=D[P];for(let N in I)f(I[N].object),delete I[N];delete D[P]}delete a[R]}}function E(R){if(a[R.id]===void 0)return;let D=a[R.id];for(let P in D){let I=D[P];for(let N in I)f(I[N].object),delete I[N];delete D[P]}delete a[R.id]}function A(R){for(let D in a){let P=a[D];if(P[R.id]===void 0)continue;let I=P[R.id];for(let N in I)f(I[N].object),delete I[N];delete P[R.id]}}function L(){B(),c!==l&&(c=l,h(c.object))}function B(){l.geometry=null,l.program=null,l.wireframe=!1}return{setup:u,reset:L,resetDefaultState:B,dispose:S,releaseStatesOfGeometry:E,releaseStatesOfProgram:A,initAttributes:m,enableAttribute:x,disableUnusedAttributes:w}}function a7(o,e,t,n){let i=n.isWebGL2,r;function s(c){r=c}function a(c,u){o.drawArrays(r,c,u),t.update(u,r,1)}function l(c,u,d){if(d===0)return;let h,f;if(i)h=o,f="drawArraysInstanced";else if(h=e.get("ANGLE_instanced_arrays"),f="drawArraysInstancedANGLE",h===null){console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}h[f](r,c,u,d),t.update(u,r,d)}this.setMode=s,this.render=a,this.renderInstances=l}function l7(o,e,t){let n;function i(){if(n!==void 0)return n;if(e.has("EXT_texture_filter_anisotropic")===!0){let M=e.get("EXT_texture_filter_anisotropic");n=o.getParameter(M.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else n=0;return n}function r(M){if(M==="highp"){if(o.getShaderPrecisionFormat(35633,36338).precision>0&&o.getShaderPrecisionFormat(35632,36338).precision>0)return"highp";M="mediump"}return M==="mediump"&&o.getShaderPrecisionFormat(35633,36337).precision>0&&o.getShaderPrecisionFormat(35632,36337).precision>0?"mediump":"lowp"}let s=typeof WebGL2RenderingContext!="undefined"&&o instanceof WebGL2RenderingContext||typeof WebGL2ComputeRenderingContext!="undefined"&&o instanceof WebGL2ComputeRenderingContext,a=t.precision!==void 0?t.precision:"highp",l=r(a);l!==a&&(console.warn("THREE.WebGLRenderer:",a,"not supported, using",l,"instead."),a=l);let c=s||e.has("WEBGL_draw_buffers"),u=t.logarithmicDepthBuffer===!0,d=o.getParameter(34930),h=o.getParameter(35660),f=o.getParameter(3379),p=o.getParameter(34076),g=o.getParameter(34921),v=o.getParameter(36347),y=o.getParameter(36348),m=o.getParameter(36349),x=h>0,_=s||e.has("OES_texture_float"),w=x&&_,b=s?o.getParameter(36183):0;return{isWebGL2:s,drawBuffers:c,getMaxAnisotropy:i,getMaxPrecision:r,precision:a,logarithmicDepthBuffer:u,maxTextures:d,maxVertexTextures:h,maxTextureSize:f,maxCubemapSize:p,maxAttributes:g,maxVertexUniforms:v,maxVaryings:y,maxFragmentUniforms:m,vertexTextures:x,floatFragmentTextures:_,floatVertexTextures:w,maxSamples:b}}function c7(o){let e=this,t=null,n=0,i=!1,r=!1,s=new Rs,a=new Nn,l={value:null,needsUpdate:!1};this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(d,h,f){let p=d.length!==0||h||n!==0||i;return i=h,t=u(d,f,0),n=d.length,p},this.beginShadows=function(){r=!0,u(null)},this.endShadows=function(){r=!1,c()},this.setState=function(d,h,f){let p=d.clippingPlanes,g=d.clipIntersection,v=d.clipShadows,y=o.get(d);if(!i||p===null||p.length===0||r&&!v)r?u(null):c();else{let m=r?0:n,x=m*4,_=y.clippingState||null;l.value=_,_=u(p,h,x,f);for(let w=0;w!==x;++w)_[w]=t[w];y.clippingState=_,this.numIntersection=g?this.numPlanes:0,this.numPlanes+=m}};function c(){l.value!==t&&(l.value=t,l.needsUpdate=n>0),e.numPlanes=n,e.numIntersection=0}function u(d,h,f,p){let g=d!==null?d.length:0,v=null;if(g!==0){if(v=l.value,p!==!0||v===null){let y=f+g*4,m=h.matrixWorldInverse;a.getNormalMatrix(m),(v===null||v.length<y)&&(v=new Float32Array(y));for(let x=0,_=f;x!==g;++x,_+=4)s.copy(d[x]).applyMatrix4(m,a),s.normal.toArray(v,_),v[_+3]=s.constant}l.value=v,l.needsUpdate=!0}return e.numPlanes=g,e.numIntersection=0,v}}function u7(o){let e=new WeakMap;function t(s,a){return a===KL?s.mapping=Ab:a===$L&&(s.mapping=Cb),s}function n(s){if(s&&s.isTexture){let a=s.mapping;if(a===KL||a===$L)if(e.has(s)){let l=e.get(s).texture;return t(l,s.mapping)}else{let l=s.image;if(l&&l.height>0){let c=o.getRenderTarget(),u=new uM(l.height/2);return u.fromEquirectangularTexture(o,s),e.set(s,u),o.setRenderTarget(c),s.addEventListener("dispose",i),t(u.texture,s.mapping)}else return null}}return s}function i(s){let a=s.target;a.removeEventListener("dispose",i);let l=e.get(a);l!==void 0&&(e.delete(a),l.dispose())}function r(){e=new WeakMap}return{get:n,dispose:r}}function h7(o){let e={};function t(n){if(e[n]!==void 0)return e[n];let i;switch(n){case"WEBGL_depth_texture":i=o.getExtension("WEBGL_depth_texture")||o.getExtension("MOZ_WEBGL_depth_texture")||o.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":i=o.getExtension("EXT_texture_filter_anisotropic")||o.getExtension("MOZ_EXT_texture_filter_anisotropic")||o.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":i=o.getExtension("WEBGL_compressed_texture_s3tc")||o.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||o.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":i=o.getExtension("WEBGL_compressed_texture_pvrtc")||o.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:i=o.getExtension(n)}return e[n]=i,i}return{has:function(n){return t(n)!==null},init:function(n){n.isWebGL2?t("EXT_color_buffer_float"):(t("WEBGL_depth_texture"),t("OES_texture_float"),t("OES_texture_half_float"),t("OES_texture_half_float_linear"),t("OES_standard_derivatives"),t("OES_element_index_uint"),t("OES_vertex_array_object"),t("ANGLE_instanced_arrays")),t("OES_texture_float_linear"),t("EXT_color_buffer_half_float")},get:function(n){let i=t(n);return i===null&&console.warn("THREE.WebGLRenderer: "+n+" extension not supported."),i}}}function d7(o,e,t,n){let i={},r=new WeakMap;function s(d){let h=d.target;h.index!==null&&e.remove(h.index);for(let p in h.attributes)e.remove(h.attributes[p]);h.removeEventListener("dispose",s),delete i[h.id];let f=r.get(h);f&&(e.remove(f),r.delete(h)),n.releaseStatesOfGeometry(h),h.isInstancedBufferGeometry===!0&&delete h._maxInstanceCount,t.memory.geometries--}function a(d,h){return i[h.id]===!0||(h.addEventListener("dispose",s),i[h.id]=!0,t.memory.geometries++),h}function l(d){let h=d.attributes;for(let p in h)e.update(h[p],34962);let f=d.morphAttributes;for(let p in f){let g=f[p];for(let v=0,y=g.length;v<y;v++)e.update(g[v],34962)}}function c(d){let h=[],f=d.index,p=d.attributes.position,g=0;if(f!==null){let m=f.array;g=f.version;for(let x=0,_=m.length;x<_;x+=3){let w=m[x+0],b=m[x+1],M=m[x+2];h.push(w,b,b,M,M,w)}}else{let m=p.array;g=p.version;for(let x=0,_=m.length/3-1;x<_;x+=3){let w=x+0,b=x+1,M=x+2;h.push(w,b,b,M,M,w)}}let v=new(FR(h)>65535?iM:nM)(h,1);v.version=g;let y=r.get(d);y&&e.remove(y),r.set(d,v)}function u(d){let h=r.get(d);if(h){let f=d.index;f!==null&&h.version<f.version&&c(d)}else c(d);return r.get(d)}return{get:a,update:l,getWireframeAttribute:u}}function f7(o,e,t,n){let i=n.isWebGL2,r;function s(h){r=h}let a,l;function c(h){a=h.type,l=h.bytesPerElement}function u(h,f){o.drawElements(r,f,a,h*l),t.update(f,r,1)}function d(h,f,p){if(p===0)return;let g,v;if(i)g=o,v="drawElementsInstanced";else if(g=e.get("ANGLE_instanced_arrays"),v="drawElementsInstancedANGLE",g===null){console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}g[v](r,f,a,h*l,p),t.update(f,r,p)}this.setMode=s,this.setIndex=c,this.render=u,this.renderInstances=d}function p7(o){let e={geometries:0,textures:0},t={frame:0,calls:0,triangles:0,points:0,lines:0};function n(r,s,a){switch(t.calls++,s){case 4:t.triangles+=a*(r/3);break;case 1:t.lines+=a*(r/2);break;case 3:t.lines+=a*(r-1);break;case 2:t.lines+=a*r;break;case 0:t.points+=a*r;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",s);break}}function i(){t.frame++,t.calls=0,t.triangles=0,t.points=0,t.lines=0}return{memory:e,render:t,programs:null,autoReset:!0,reset:i,update:n}}function m7(o,e){return o[0]-e[0]}function g7(o,e){return Math.abs(e[1])-Math.abs(o[1])}function y7(o){let e={},t=new Float32Array(8),n=[];for(let r=0;r<8;r++)n[r]=[r,0];function i(r,s,a,l){let c=r.morphTargetInfluences,u=c===void 0?0:c.length,d=e[s.id];if(d===void 0||d.length!==u){d=[];for(let v=0;v<u;v++)d[v]=[v,0];e[s.id]=d}for(let v=0;v<u;v++){let y=d[v];y[0]=v,y[1]=c[v]}d.sort(g7);for(let v=0;v<8;v++)v<u&&d[v][1]?(n[v][0]=d[v][0],n[v][1]=d[v][1]):(n[v][0]=Number.MAX_SAFE_INTEGER,n[v][1]=0);n.sort(m7);let h=a.morphTargets&&s.morphAttributes.position,f=a.morphNormals&&s.morphAttributes.normal,p=0;for(let v=0;v<8;v++){let y=n[v],m=y[0],x=y[1];m!==Number.MAX_SAFE_INTEGER&&x?(h&&s.getAttribute("morphTarget"+v)!==h[m]&&s.setAttribute("morphTarget"+v,h[m]),f&&s.getAttribute("morphNormal"+v)!==f[m]&&s.setAttribute("morphNormal"+v,f[m]),t[v]=x,p+=x):(h&&s.hasAttribute("morphTarget"+v)===!0&&s.deleteAttribute("morphTarget"+v),f&&s.hasAttribute("morphNormal"+v)===!0&&s.deleteAttribute("morphNormal"+v),t[v]=0)}let g=s.morphTargetsRelative?1:1-p;l.getUniforms().setValue(o,"morphTargetBaseInfluence",g),l.getUniforms().setValue(o,"morphTargetInfluences",t)}return{update:i}}function v7(o,e,t,n){let i=new WeakMap;function r(l){let c=n.render.frame,u=l.geometry,d=e.get(l,u);return i.get(d)!==c&&(e.update(d),i.set(d,c)),l.isInstancedMesh&&(l.hasEventListener("dispose",a)===!1&&l.addEventListener("dispose",a),t.update(l.instanceMatrix,34962),l.instanceColor!==null&&t.update(l.instanceColor,34962)),d}function s(){i=new WeakMap}function a(l){let c=l.target;c.removeEventListener("dispose",a),t.remove(c.instanceMatrix),c.instanceColor!==null&&t.remove(c.instanceColor)}return{update:r,dispose:s}}var dM=class extends On{constructor(e=null,t=1,n=1,i=1){super(null);this.image={data:e,width:t,height:n,depth:i},this.magFilter=hi,this.minFilter=hi,this.wrapR=Ki,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.needsUpdate=!0}};dM.prototype.isDataTexture2DArray=!0;var fM=class extends On{constructor(e=null,t=1,n=1,i=1){super(null);this.image={data:e,width:t,height:n,depth:i},this.magFilter=hi,this.minFilter=hi,this.wrapR=Ki,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.needsUpdate=!0}};fM.prototype.isDataTexture3D=!0;var OR=new On,x7=new dM,_7=new fM,kR=new up,zR=[],UR=[],HR=new Float32Array(16),GR=new Float32Array(9),VR=new Float32Array(4);function Th(o,e,t){let n=o[0];if(n<=0||n>0)return o;let i=e*t,r=zR[i];if(r===void 0&&(r=new Float32Array(i),zR[i]=r),e!==0){n.toArray(r,0);for(let s=1,a=0;s!==e;++s)a+=t,o[s].toArray(r,a)}return r}function Ei(o,e){if(o.length!==e.length)return!1;for(let t=0,n=o.length;t<n;t++)if(o[t]!==e[t])return!1;return!0}function fi(o,e){for(let t=0,n=e.length;t<n;t++)o[t]=e[t]}function WR(o,e){let t=UR[e];t===void 0&&(t=new Int32Array(e),UR[e]=t);for(let n=0;n!==e;++n)t[n]=o.allocateTextureUnit();return t}function w7(o,e){let t=this.cache;t[0]!==e&&(o.uniform1f(this.addr,e),t[0]=e)}function b7(o,e){let t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(o.uniform2f(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(Ei(t,e))return;o.uniform2fv(this.addr,e),fi(t,e)}}function M7(o,e){let t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(o.uniform3f(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else if(e.r!==void 0)(t[0]!==e.r||t[1]!==e.g||t[2]!==e.b)&&(o.uniform3f(this.addr,e.r,e.g,e.b),t[0]=e.r,t[1]=e.g,t[2]=e.b);else{if(Ei(t,e))return;o.uniform3fv(this.addr,e),fi(t,e)}}function S7(o,e){let t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(o.uniform4f(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(Ei(t,e))return;o.uniform4fv(this.addr,e),fi(t,e)}}function T7(o,e){let t=this.cache,n=e.elements;if(n===void 0){if(Ei(t,e))return;o.uniformMatrix2fv(this.addr,!1,e),fi(t,e)}else{if(Ei(t,n))return;VR.set(n),o.uniformMatrix2fv(this.addr,!1,VR),fi(t,n)}}function E7(o,e){let t=this.cache,n=e.elements;if(n===void 0){if(Ei(t,e))return;o.uniformMatrix3fv(this.addr,!1,e),fi(t,e)}else{if(Ei(t,n))return;GR.set(n),o.uniformMatrix3fv(this.addr,!1,GR),fi(t,n)}}function A7(o,e){let t=this.cache,n=e.elements;if(n===void 0){if(Ei(t,e))return;o.uniformMatrix4fv(this.addr,!1,e),fi(t,e)}else{if(Ei(t,n))return;HR.set(n),o.uniformMatrix4fv(this.addr,!1,HR),fi(t,n)}}function C7(o,e){let t=this.cache;t[0]!==e&&(o.uniform1i(this.addr,e),t[0]=e)}function L7(o,e){let t=this.cache;Ei(t,e)||(o.uniform2iv(this.addr,e),fi(t,e))}function R7(o,e){let t=this.cache;Ei(t,e)||(o.uniform3iv(this.addr,e),fi(t,e))}function P7(o,e){let t=this.cache;Ei(t,e)||(o.uniform4iv(this.addr,e),fi(t,e))}function I7(o,e){let t=this.cache;t[0]!==e&&(o.uniform1ui(this.addr,e),t[0]=e)}function D7(o,e){let t=this.cache;Ei(t,e)||(o.uniform2uiv(this.addr,e),fi(t,e))}function F7(o,e){let t=this.cache;Ei(t,e)||(o.uniform3uiv(this.addr,e),fi(t,e))}function B7(o,e){let t=this.cache;Ei(t,e)||(o.uniform4uiv(this.addr,e),fi(t,e))}function N7(o,e,t){let n=this.cache,i=t.allocateTextureUnit();n[0]!==i&&(o.uniform1i(this.addr,i),n[0]=i),t.safeSetTexture2D(e||OR,i)}function O7(o,e,t){let n=this.cache,i=t.allocateTextureUnit();n[0]!==i&&(o.uniform1i(this.addr,i),n[0]=i),t.setTexture3D(e||_7,i)}function k7(o,e,t){let n=this.cache,i=t.allocateTextureUnit();n[0]!==i&&(o.uniform1i(this.addr,i),n[0]=i),t.safeSetTextureCube(e||kR,i)}function z7(o,e,t){let n=this.cache,i=t.allocateTextureUnit();n[0]!==i&&(o.uniform1i(this.addr,i),n[0]=i),t.setTexture2DArray(e||x7,i)}function U7(o){switch(o){case 5126:return w7;case 35664:return b7;case 35665:return M7;case 35666:return S7;case 35674:return T7;case 35675:return E7;case 35676:return A7;case 5124:case 35670:return C7;case 35667:case 35671:return L7;case 35668:case 35672:return R7;case 35669:case 35673:return P7;case 5125:return I7;case 36294:return D7;case 36295:return F7;case 36296:return B7;case 35678:case 36198:case 36298:case 36306:case 35682:return N7;case 35679:case 36299:case 36307:return O7;case 35680:case 36300:case 36308:case 36293:return k7;case 36289:case 36303:case 36311:case 36292:return z7}}function H7(o,e){o.uniform1fv(this.addr,e)}function G7(o,e){let t=Th(e,this.size,2);o.uniform2fv(this.addr,t)}function V7(o,e){let t=Th(e,this.size,3);o.uniform3fv(this.addr,t)}function W7(o,e){let t=Th(e,this.size,4);o.uniform4fv(this.addr,t)}function X7(o,e){let t=Th(e,this.size,4);o.uniformMatrix2fv(this.addr,!1,t)}function q7(o,e){let t=Th(e,this.size,9);o.uniformMatrix3fv(this.addr,!1,t)}function j7(o,e){let t=Th(e,this.size,16);o.uniformMatrix4fv(this.addr,!1,t)}function Y7(o,e){o.uniform1iv(this.addr,e)}function Z7(o,e){o.uniform2iv(this.addr,e)}function J7(o,e){o.uniform3iv(this.addr,e)}function K7(o,e){o.uniform4iv(this.addr,e)}function $7(o,e){o.uniform1uiv(this.addr,e)}function Q7(o,e){o.uniform2uiv(this.addr,e)}function e9(o,e){o.uniform3uiv(this.addr,e)}function t9(o,e){o.uniform4uiv(this.addr,e)}function n9(o,e,t){let n=e.length,i=WR(t,n);o.uniform1iv(this.addr,i);for(let r=0;r!==n;++r)t.safeSetTexture2D(e[r]||OR,i[r])}function i9(o,e,t){let n=e.length,i=WR(t,n);o.uniform1iv(this.addr,i);for(let r=0;r!==n;++r)t.safeSetTextureCube(e[r]||kR,i[r])}function r9(o){switch(o){case 5126:return H7;case 35664:return G7;case 35665:return V7;case 35666:return W7;case 35674:return X7;case 35675:return q7;case 35676:return j7;case 5124:case 35670:return Y7;case 35667:case 35671:return Z7;case 35668:case 35672:return J7;case 35669:case 35673:return K7;case 5125:return $7;case 36294:return Q7;case 36295:return e9;case 36296:return t9;case 35678:case 36198:case 36298:case 36306:case 35682:return n9;case 35680:case 36300:case 36308:case 36293:return i9}}function s9(o,e,t){this.id=o,this.addr=t,this.cache=[],this.setValue=U7(e.type)}function XR(o,e,t){this.id=o,this.addr=t,this.cache=[],this.size=e.size,this.setValue=r9(e.type)}XR.prototype.updateCache=function(o){let e=this.cache;o instanceof Float32Array&&e.length!==o.length&&(this.cache=new Float32Array(o.length)),fi(e,o)};function qR(o){this.id=o,this.seq=[],this.map={}}qR.prototype.setValue=function(o,e,t){let n=this.seq;for(let i=0,r=n.length;i!==r;++i){let s=n[i];s.setValue(o,e[s.id],t)}};var pM=/(\w+)(\])?(\[|\.)?/g;function jR(o,e){o.seq.push(e),o.map[e.id]=e}function o9(o,e,t){let n=o.name,i=n.length;for(pM.lastIndex=0;;){let r=pM.exec(n),s=pM.lastIndex,a=r[1],l=r[2]==="]",c=r[3];if(l&&(a=a|0),c===void 0||c==="["&&s+2===i){jR(t,c===void 0?new s9(a,o,e):new XR(a,o,e));break}else{let d=t.map[a];d===void 0&&(d=new qR(a),jR(t,d)),t=d}}}function Ba(o,e){this.seq=[],this.map={};let t=o.getProgramParameter(e,35718);for(let n=0;n<t;++n){let i=o.getActiveUniform(e,n),r=o.getUniformLocation(e,i.name);o9(i,r,this)}}Ba.prototype.setValue=function(o,e,t,n){let i=this.map[e];i!==void 0&&i.setValue(o,t,n)};Ba.prototype.setOptional=function(o,e,t){let n=e[t];n!==void 0&&this.setValue(o,t,n)};Ba.upload=function(o,e,t,n){for(let i=0,r=e.length;i!==r;++i){let s=e[i],a=t[s.id];a.needsUpdate!==!1&&s.setValue(o,a.value,n)}};Ba.seqWithValue=function(o,e){let t=[];for(let n=0,i=o.length;n!==i;++n){let r=o[n];r.id in e&&t.push(r)}return t};function YR(o,e,t){let n=o.createShader(e);return o.shaderSource(n,t),o.compileShader(n),n}var a9=0;function l9(o){let e=o.split(`
`);for(let t=0;t<e.length;t++)e[t]=t+1+": "+e[t];return e.join(`
`)}function ZR(o){switch(o){case ah:return["Linear","( value )"];case Bb:return["sRGB","( value )"];case fR:return["RGBE","( value )"];case pR:return["RGBM","( value, 7.0 )"];case mR:return["RGBM","( value, 16.0 )"];case gR:return["RGBD","( value, 256.0 )"];case dR:return["Gamma","( value, float( GAMMA_FACTOR ) )"];case nW:return["LogLuv","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported encoding:",o),["Linear","( value )"]}}function JR(o,e,t){let n=o.getShaderParameter(e,35713),i=o.getShaderInfoLog(e).trim();if(n&&i==="")return"";let r=o.getShaderSource(e);return"THREE.WebGLShader: gl.getShaderInfoLog() "+t+`
`+i+l9(r)}function dp(o,e){let t=ZR(e);return"vec4 "+o+"( vec4 value ) { return "+t[0]+"ToLinear"+t[1]+"; }"}function c9(o,e){let t=ZR(e);return"vec4 "+o+"( vec4 value ) { return LinearTo"+t[0]+t[1]+"; }"}function u9(o,e){let t;switch(e){case t5:t="Linear";break;case n5:t="Reinhard";break;case i5:t="OptimizedCineon";break;case r5:t="ACESFilmic";break;case s5:t="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",e),t="Linear"}return"vec3 "+o+"( vec3 color ) { return "+t+"ToneMapping( color ); }"}function h9(o){return[o.extensionDerivatives||o.envMapCubeUV||o.bumpMap||o.tangentSpaceNormalMap||o.clearcoatNormalMap||o.flatShading||o.shaderID==="physical"?"#extension GL_OES_standard_derivatives : enable":"",(o.extensionFragDepth||o.logarithmicDepthBuffer)&&o.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",o.extensionDrawBuffers&&o.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(o.extensionShaderTextureLOD||o.envMap||o.transmission>0)&&o.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(fp).join(`
`)}function d9(o){let e=[];for(let t in o){let n=o[t];n!==!1&&e.push("#define "+t+" "+n)}return e.join(`
`)}function f9(o,e){let t={},n=o.getProgramParameter(e,35721);for(let i=0;i<n;i++){let s=o.getActiveAttrib(e,i).name;t[s]=o.getAttribLocation(e,s)}return t}function fp(o){return o!==""}function KR(o,e){return o.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function $R(o,e){return o.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}var p9=/^[ \t]*#include +<([\w\d./]+)>/gm;function mM(o){return o.replace(p9,m9)}function m9(o,e){let t=ut[e];if(t===void 0)throw new Error("Can not resolve #include <"+e+">");return mM(t)}var g9=/#pragma unroll_loop[\s]+?for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g,y9=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function QR(o){return o.replace(y9,eP).replace(g9,v9)}function v9(o,e,t,n){return console.warn("WebGLProgram: #pragma unroll_loop shader syntax is deprecated. Please use #pragma unroll_loop_start syntax instead."),eP(o,e,t,n)}function eP(o,e,t,n){let i="";for(let r=parseInt(e);r<parseInt(t);r++)i+=n.replace(/\[\s*i\s*\]/g,"[ "+r+" ]").replace(/UNROLLED_LOOP_INDEX/g,r);return i}function tP(o){let e="precision "+o.precision+` float;
precision `+o.precision+" int;";return o.precision==="highp"?e+=`
#define HIGH_PRECISION`:o.precision==="mediump"?e+=`
#define MEDIUM_PRECISION`:o.precision==="lowp"&&(e+=`
#define LOW_PRECISION`),e}function x9(o){let e="SHADOWMAP_TYPE_BASIC";return o.shadowMapType===HL?e="SHADOWMAP_TYPE_PCF":o.shadowMapType===DV?e="SHADOWMAP_TYPE_PCF_SOFT":o.shadowMapType===Jf&&(e="SHADOWMAP_TYPE_VSM"),e}function _9(o){let e="ENVMAP_TYPE_CUBE";if(o.envMap)switch(o.envMapMode){case Ab:case Cb:e="ENVMAP_TYPE_CUBE";break;case Lb:case Rb:e="ENVMAP_TYPE_CUBE_UV";break}return e}function w9(o){let e="ENVMAP_MODE_REFLECTION";if(o.envMap)switch(o.envMapMode){case Cb:case Rb:e="ENVMAP_MODE_REFRACTION";break}return e}function b9(o){let e="ENVMAP_BLENDING_NONE";if(o.envMap)switch(o.combine){case Oy:e="ENVMAP_BLENDING_MULTIPLY";break;case QV:e="ENVMAP_BLENDING_MIX";break;case e5:e="ENVMAP_BLENDING_ADD";break}return e}function M9(o,e,t,n){let i=o.getContext(),r=t.defines,s=t.vertexShader,a=t.fragmentShader,l=x9(t),c=_9(t),u=w9(t),d=b9(t),h=o.gammaFactor>0?o.gammaFactor:1,f=t.isWebGL2?"":h9(t),p=d9(r),g=i.createProgram(),v,y,m=t.glslVersion?"#version "+t.glslVersion+`
`:"";t.isRawShaderMaterial?(v=[p].filter(fp).join(`
`),v.length>0&&(v+=`
`),y=[f,p].filter(fp).join(`
`),y.length>0&&(y+=`
`)):(v=[tP(t),"#define SHADER_NAME "+t.shaderName,p,t.instancing?"#define USE_INSTANCING":"",t.instancingColor?"#define USE_INSTANCING_COLOR":"",t.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define GAMMA_FACTOR "+h,"#define MAX_BONES "+t.maxBones,t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.map?"#define USE_MAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+u:"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMap&&t.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",t.normalMap&&t.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.displacementMap&&t.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.vertexTangents?"#define USE_TANGENT":"",t.vertexColors?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUvs?"#define USE_UV":"",t.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",t.flatShading?"#define FLAT_SHADED":"",t.skinning?"#define USE_SKINNING":"",t.useVertexTexture?"#define BONE_TEXTURE":"",t.morphTargets?"#define USE_MORPHTARGETS":"",t.morphNormals&&t.flatShading===!1?"#define USE_MORPHNORMALS":"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+l:"",t.sizeAttenuation?"#define USE_SIZEATTENUATION":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",t.logarithmicDepthBuffer&&t.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","	attribute vec3 morphTarget0;","	attribute vec3 morphTarget1;","	attribute vec3 morphTarget2;","	attribute vec3 morphTarget3;","	#ifdef USE_MORPHNORMALS","		attribute vec3 morphNormal0;","		attribute vec3 morphNormal1;","		attribute vec3 morphNormal2;","		attribute vec3 morphNormal3;","	#else","		attribute vec3 morphTarget4;","		attribute vec3 morphTarget5;","		attribute vec3 morphTarget6;","		attribute vec3 morphTarget7;","	#endif","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(fp).join(`
`),y=[f,tP(t),"#define SHADER_NAME "+t.shaderName,p,t.alphaTest?"#define ALPHATEST "+t.alphaTest+(t.alphaTest%1?"":".0"):"","#define GAMMA_FACTOR "+h,t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.map?"#define USE_MAP":"",t.matcap?"#define USE_MATCAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+c:"",t.envMap?"#define "+u:"",t.envMap?"#define "+d:"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMap&&t.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",t.normalMap&&t.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.sheen?"#define USE_SHEEN":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.vertexTangents?"#define USE_TANGENT":"",t.vertexColors||t.instancingColor?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUvs?"#define USE_UV":"",t.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",t.gradientMap?"#define USE_GRADIENTMAP":"",t.flatShading?"#define FLAT_SHADED":"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+l:"",t.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",t.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",t.logarithmicDepthBuffer&&t.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"",(t.extensionShaderTextureLOD||t.envMap)&&t.rendererExtensionShaderTextureLod?"#define TEXTURE_LOD_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",t.toneMapping!==nh?"#define TONE_MAPPING":"",t.toneMapping!==nh?ut.tonemapping_pars_fragment:"",t.toneMapping!==nh?u9("toneMapping",t.toneMapping):"",t.dithering?"#define DITHERING":"",ut.encodings_pars_fragment,t.map?dp("mapTexelToLinear",t.mapEncoding):"",t.matcap?dp("matcapTexelToLinear",t.matcapEncoding):"",t.envMap?dp("envMapTexelToLinear",t.envMapEncoding):"",t.emissiveMap?dp("emissiveMapTexelToLinear",t.emissiveMapEncoding):"",t.lightMap?dp("lightMapTexelToLinear",t.lightMapEncoding):"",c9("linearToOutputTexel",t.outputEncoding),t.depthPacking?"#define DEPTH_PACKING "+t.depthPacking:"",`
`].filter(fp).join(`
`)),s=mM(s),s=KR(s,t),s=$R(s,t),a=mM(a),a=KR(a,t),a=$R(a,t),s=QR(s),a=QR(a),t.isWebGL2&&t.isRawShaderMaterial!==!0&&(m=`#version 300 es
`,v=["#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+v,y=["#define varying in",t.glslVersion===yR?"":"out highp vec4 pc_fragColor;",t.glslVersion===yR?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+y);let x=m+v+s,_=m+y+a,w=YR(i,35633,x),b=YR(i,35632,_);if(i.attachShader(g,w),i.attachShader(g,b),t.index0AttributeName!==void 0?i.bindAttribLocation(g,0,t.index0AttributeName):t.morphTargets===!0&&i.bindAttribLocation(g,0,"position"),i.linkProgram(g),o.debug.checkShaderErrors){let E=i.getProgramInfoLog(g).trim(),A=i.getShaderInfoLog(w).trim(),L=i.getShaderInfoLog(b).trim(),B=!0,R=!0;if(i.getProgramParameter(g,35714)===!1){B=!1;let D=JR(i,w,"vertex"),P=JR(i,b,"fragment");console.error("THREE.WebGLProgram: shader error: ",i.getError(),"35715",i.getProgramParameter(g,35715),"gl.getProgramInfoLog",E,D,P)}else E!==""?console.warn("THREE.WebGLProgram: gl.getProgramInfoLog()",E):(A===""||L==="")&&(R=!1);R&&(this.diagnostics={runnable:B,programLog:E,vertexShader:{log:A,prefix:v},fragmentShader:{log:L,prefix:y}})}i.deleteShader(w),i.deleteShader(b);let M;this.getUniforms=function(){return M===void 0&&(M=new Ba(i,g)),M};let S;return this.getAttributes=function(){return S===void 0&&(S=f9(i,g)),S},this.destroy=function(){n.releaseStatesOfProgram(this),i.deleteProgram(g),this.program=void 0},this.name=t.shaderName,this.id=a9++,this.cacheKey=e,this.usedTimes=1,this.program=g,this.vertexShader=w,this.fragmentShader=b,this}function S9(o,e,t,n,i,r){let s=[],a=n.isWebGL2,l=n.logarithmicDepthBuffer,c=n.floatVertexTextures,u=n.maxVertexUniforms,d=n.vertexTextures,h=n.precision,f={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"},p=["precision","isWebGL2","supportsVertexTextures","outputEncoding","instancing","instancingColor","map","mapEncoding","matcap","matcapEncoding","envMap","envMapMode","envMapEncoding","envMapCubeUV","lightMap","lightMapEncoding","aoMap","emissiveMap","emissiveMapEncoding","bumpMap","normalMap","objectSpaceNormalMap","tangentSpaceNormalMap","clearcoatMap","clearcoatRoughnessMap","clearcoatNormalMap","displacementMap","specularMap","roughnessMap","metalnessMap","gradientMap","alphaMap","combine","vertexColors","vertexAlphas","vertexTangents","vertexUvs","uvsVertexOnly","fog","useFog","fogExp2","flatShading","sizeAttenuation","logarithmicDepthBuffer","skinning","maxBones","useVertexTexture","morphTargets","morphNormals","premultipliedAlpha","numDirLights","numPointLights","numSpotLights","numHemiLights","numRectAreaLights","numDirLightShadows","numPointLightShadows","numSpotLightShadows","shadowMapEnabled","shadowMapType","toneMapping","physicallyCorrectLights","alphaTest","doubleSided","flipSided","numClippingPlanes","numClipIntersection","depthPacking","dithering","sheen","transmission","transmissionMap","thicknessMap"];function g(b){let S=b.skeleton.bones;if(c)return 1024;{let A=Math.floor((u-20)/4),L=Math.min(A,S.length);return L<S.length?(console.warn("THREE.WebGLRenderer: Skeleton has "+S.length+" bones. This GPU supports "+L+"."),0):L}}function v(b){let M;return b&&b.isTexture?M=b.encoding:b&&b.isWebGLRenderTarget?(console.warn("THREE.WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead."),M=b.texture.encoding):M=ah,M}function y(b,M,S,E,A){let L=E.fog,B=b.isMeshStandardMaterial?E.environment:null,R=e.get(b.envMap||B),D=f[b.type],P=A.isSkinnedMesh?g(A):0;b.precision!==null&&(h=n.getMaxPrecision(b.precision),h!==b.precision&&console.warn("THREE.WebGLProgram.getParameters:",b.precision,"not supported, using",h,"instead."));let I,N;if(D){let se=Ps[D];I=se.vertexShader,N=se.fragmentShader}else I=b.vertexShader,N=b.fragmentShader;let G=o.getRenderTarget();return{isWebGL2:a,shaderID:D,shaderName:b.type,vertexShader:I,fragmentShader:N,defines:b.defines,isRawShaderMaterial:b.isRawShaderMaterial===!0,glslVersion:b.glslVersion,precision:h,instancing:A.isInstancedMesh===!0,instancingColor:A.isInstancedMesh===!0&&A.instanceColor!==null,supportsVertexTextures:d,outputEncoding:G!==null?v(G.texture):o.outputEncoding,map:!!b.map,mapEncoding:v(b.map),matcap:!!b.matcap,matcapEncoding:v(b.matcap),envMap:!!R,envMapMode:R&&R.mapping,envMapEncoding:v(R),envMapCubeUV:!!R&&(R.mapping===Lb||R.mapping===Rb),lightMap:!!b.lightMap,lightMapEncoding:v(b.lightMap),aoMap:!!b.aoMap,emissiveMap:!!b.emissiveMap,emissiveMapEncoding:v(b.emissiveMap),bumpMap:!!b.bumpMap,normalMap:!!b.normalMap,objectSpaceNormalMap:b.normalMapType===sW,tangentSpaceNormalMap:b.normalMapType===lh,clearcoatMap:!!b.clearcoatMap,clearcoatRoughnessMap:!!b.clearcoatRoughnessMap,clearcoatNormalMap:!!b.clearcoatNormalMap,displacementMap:!!b.displacementMap,roughnessMap:!!b.roughnessMap,metalnessMap:!!b.metalnessMap,specularMap:!!b.specularMap,alphaMap:!!b.alphaMap,gradientMap:!!b.gradientMap,sheen:!!b.sheen,transmission:!!b.transmission,transmissionMap:!!b.transmissionMap,thicknessMap:!!b.thicknessMap,combine:b.combine,vertexTangents:b.normalMap&&b.vertexTangents,vertexColors:b.vertexColors,vertexAlphas:b.vertexColors===!0&&A.geometry&&A.geometry.attributes.color&&A.geometry.attributes.color.itemSize===4,vertexUvs:!!b.map||!!b.bumpMap||!!b.normalMap||!!b.specularMap||!!b.alphaMap||!!b.emissiveMap||!!b.roughnessMap||!!b.metalnessMap||!!b.clearcoatMap||!!b.clearcoatRoughnessMap||!!b.clearcoatNormalMap||!!b.displacementMap||!!b.transmissionMap||!!b.thicknessMap,uvsVertexOnly:!(!!b.map||!!b.bumpMap||!!b.normalMap||!!b.specularMap||!!b.alphaMap||!!b.emissiveMap||!!b.roughnessMap||!!b.metalnessMap||!!b.clearcoatNormalMap||!!b.transmission||!!b.transmissionMap||!!b.thicknessMap)&&!!b.displacementMap,fog:!!L,useFog:b.fog,fogExp2:L&&L.isFogExp2,flatShading:!!b.flatShading,sizeAttenuation:b.sizeAttenuation,logarithmicDepthBuffer:l,skinning:A.isSkinnedMesh===!0&&P>0,maxBones:P,useVertexTexture:c,morphTargets:b.morphTargets,morphNormals:b.morphNormals,numDirLights:M.directional.length,numPointLights:M.point.length,numSpotLights:M.spot.length,numRectAreaLights:M.rectArea.length,numHemiLights:M.hemi.length,numDirLightShadows:M.directionalShadowMap.length,numPointLightShadows:M.pointShadowMap.length,numSpotLightShadows:M.spotShadowMap.length,numClippingPlanes:r.numPlanes,numClipIntersection:r.numIntersection,dithering:b.dithering,shadowMapEnabled:o.shadowMap.enabled&&S.length>0,shadowMapType:o.shadowMap.type,toneMapping:b.toneMapped?o.toneMapping:nh,physicallyCorrectLights:o.physicallyCorrectLights,premultipliedAlpha:b.premultipliedAlpha,alphaTest:b.alphaTest,doubleSided:b.side===Sa,flipSided:b.side===Ln,depthPacking:b.depthPacking!==void 0?b.depthPacking:!1,index0AttributeName:b.index0AttributeName,extensionDerivatives:b.extensions&&b.extensions.derivatives,extensionFragDepth:b.extensions&&b.extensions.fragDepth,extensionDrawBuffers:b.extensions&&b.extensions.drawBuffers,extensionShaderTextureLOD:b.extensions&&b.extensions.shaderTextureLOD,rendererExtensionFragDepth:a||t.has("EXT_frag_depth"),rendererExtensionDrawBuffers:a||t.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:a||t.has("EXT_shader_texture_lod"),customProgramCacheKey:b.customProgramCacheKey()}}function m(b){let M=[];if(b.shaderID?M.push(b.shaderID):(M.push(b.fragmentShader),M.push(b.vertexShader)),b.defines!==void 0)for(let S in b.defines)M.push(S),M.push(b.defines[S]);if(b.isRawShaderMaterial===!1){for(let S=0;S<p.length;S++)M.push(b[p[S]]);M.push(o.outputEncoding),M.push(o.gammaFactor)}return M.push(b.customProgramCacheKey),M.join()}function x(b){let M=f[b.type],S;if(M){let E=Ps[M];S=IW.clone(E.uniforms)}else S=b.uniforms;return S}function _(b,M){let S;for(let E=0,A=s.length;E<A;E++){let L=s[E];if(L.cacheKey===M){S=L,++S.usedTimes;break}}return S===void 0&&(S=new M9(o,M,b,i),s.push(S)),S}function w(b){if(--b.usedTimes==0){let M=s.indexOf(b);s[M]=s[s.length-1],s.pop(),b.destroy()}}return{getParameters:y,getProgramCacheKey:m,getUniforms:x,acquireProgram:_,releaseProgram:w,programs:s}}function T9(){let o=new WeakMap;function e(r){let s=o.get(r);return s===void 0&&(s={},o.set(r,s)),s}function t(r){o.delete(r)}function n(r,s,a){o.get(r)[s]=a}function i(){o=new WeakMap}return{get:e,remove:t,update:n,dispose:i}}function E9(o,e){return o.groupOrder!==e.groupOrder?o.groupOrder-e.groupOrder:o.renderOrder!==e.renderOrder?o.renderOrder-e.renderOrder:o.program!==e.program?o.program.id-e.program.id:o.material.id!==e.material.id?o.material.id-e.material.id:o.z!==e.z?o.z-e.z:o.id-e.id}function nP(o,e){return o.groupOrder!==e.groupOrder?o.groupOrder-e.groupOrder:o.renderOrder!==e.renderOrder?o.renderOrder-e.renderOrder:o.z!==e.z?e.z-o.z:o.id-e.id}function iP(o){let e=[],t=0,n=[],i=[],r=[],s={id:-1};function a(){t=0,n.length=0,i.length=0,r.length=0}function l(f,p,g,v,y,m){let x=e[t],_=o.get(g);return x===void 0?(x={id:f.id,object:f,geometry:p,material:g,program:_.program||s,groupOrder:v,renderOrder:f.renderOrder,z:y,group:m},e[t]=x):(x.id=f.id,x.object=f,x.geometry=p,x.material=g,x.program=_.program||s,x.groupOrder=v,x.renderOrder=f.renderOrder,x.z=y,x.group=m),t++,x}function c(f,p,g,v,y,m){let x=l(f,p,g,v,y,m);g.transmission>0?i.push(x):g.transparent===!0?r.push(x):n.push(x)}function u(f,p,g,v,y,m){let x=l(f,p,g,v,y,m);g.transmission>0?i.unshift(x):g.transparent===!0?r.unshift(x):n.unshift(x)}function d(f,p){n.length>1&&n.sort(f||E9),i.length>1&&i.sort(p||nP),r.length>1&&r.sort(p||nP)}function h(){for(let f=t,p=e.length;f<p;f++){let g=e[f];if(g.id===null)break;g.id=null,g.object=null,g.geometry=null,g.material=null,g.program=null,g.group=null}}return{opaque:n,transmissive:i,transparent:r,init:a,push:c,unshift:u,finish:h,sort:d}}function A9(o){let e=new WeakMap;function t(i,r){let s;return e.has(i)===!1?(s=new iP(o),e.set(i,[s])):r>=e.get(i).length?(s=new iP(o),e.get(i).push(s)):s=e.get(i)[r],s}function n(){e=new WeakMap}return{get:t,dispose:n}}function C9(){let o={};return{get:function(e){if(o[e.id]!==void 0)return o[e.id];let t;switch(e.type){case"DirectionalLight":t={direction:new le,color:new Je};break;case"SpotLight":t={position:new le,direction:new le,color:new Je,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":t={position:new le,color:new Je,distance:0,decay:0};break;case"HemisphereLight":t={direction:new le,skyColor:new Je,groundColor:new Je};break;case"RectAreaLight":t={color:new Je,position:new le,halfWidth:new le,halfHeight:new le};break}return o[e.id]=t,t}}}function L9(){let o={};return{get:function(e){if(o[e.id]!==void 0)return o[e.id];let t;switch(e.type){case"DirectionalLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new ke};break;case"SpotLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new ke};break;case"PointLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new ke,shadowCameraNear:1,shadowCameraFar:1e3};break}return o[e.id]=t,t}}}var R9=0;function P9(o,e){return(e.castShadow?1:0)-(o.castShadow?1:0)}function I9(o,e){let t=new C9,n=L9(),i={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadow:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[]};for(let u=0;u<9;u++)i.probe.push(new le);let r=new le,s=new Qe,a=new Qe;function l(u){let d=0,h=0,f=0;for(let M=0;M<9;M++)i.probe[M].set(0,0,0);let p=0,g=0,v=0,y=0,m=0,x=0,_=0,w=0;u.sort(P9);for(let M=0,S=u.length;M<S;M++){let E=u[M],A=E.color,L=E.intensity,B=E.distance,R=E.shadow&&E.shadow.map?E.shadow.map.texture:null;if(E.isAmbientLight)d+=A.r*L,h+=A.g*L,f+=A.b*L;else if(E.isLightProbe)for(let D=0;D<9;D++)i.probe[D].addScaledVector(E.sh.coefficients[D],L);else if(E.isDirectionalLight){let D=t.get(E);if(D.color.copy(E.color).multiplyScalar(E.intensity),E.castShadow){let P=E.shadow,I=n.get(E);I.shadowBias=P.bias,I.shadowNormalBias=P.normalBias,I.shadowRadius=P.radius,I.shadowMapSize=P.mapSize,i.directionalShadow[p]=I,i.directionalShadowMap[p]=R,i.directionalShadowMatrix[p]=E.shadow.matrix,x++}i.directional[p]=D,p++}else if(E.isSpotLight){let D=t.get(E);if(D.position.setFromMatrixPosition(E.matrixWorld),D.color.copy(A).multiplyScalar(L),D.distance=B,D.coneCos=Math.cos(E.angle),D.penumbraCos=Math.cos(E.angle*(1-E.penumbra)),D.decay=E.decay,E.castShadow){let P=E.shadow,I=n.get(E);I.shadowBias=P.bias,I.shadowNormalBias=P.normalBias,I.shadowRadius=P.radius,I.shadowMapSize=P.mapSize,i.spotShadow[v]=I,i.spotShadowMap[v]=R,i.spotShadowMatrix[v]=E.shadow.matrix,w++}i.spot[v]=D,v++}else if(E.isRectAreaLight){let D=t.get(E);D.color.copy(A).multiplyScalar(L),D.halfWidth.set(E.width*.5,0,0),D.halfHeight.set(0,E.height*.5,0),i.rectArea[y]=D,y++}else if(E.isPointLight){let D=t.get(E);if(D.color.copy(E.color).multiplyScalar(E.intensity),D.distance=E.distance,D.decay=E.decay,E.castShadow){let P=E.shadow,I=n.get(E);I.shadowBias=P.bias,I.shadowNormalBias=P.normalBias,I.shadowRadius=P.radius,I.shadowMapSize=P.mapSize,I.shadowCameraNear=P.camera.near,I.shadowCameraFar=P.camera.far,i.pointShadow[g]=I,i.pointShadowMap[g]=R,i.pointShadowMatrix[g]=E.shadow.matrix,_++}i.point[g]=D,g++}else if(E.isHemisphereLight){let D=t.get(E);D.skyColor.copy(E.color).multiplyScalar(L),D.groundColor.copy(E.groundColor).multiplyScalar(L),i.hemi[m]=D,m++}}y>0&&(e.isWebGL2||o.has("OES_texture_float_linear")===!0?(i.rectAreaLTC1=Ge.LTC_FLOAT_1,i.rectAreaLTC2=Ge.LTC_FLOAT_2):o.has("OES_texture_half_float_linear")===!0?(i.rectAreaLTC1=Ge.LTC_HALF_1,i.rectAreaLTC2=Ge.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),i.ambient[0]=d,i.ambient[1]=h,i.ambient[2]=f;let b=i.hash;(b.directionalLength!==p||b.pointLength!==g||b.spotLength!==v||b.rectAreaLength!==y||b.hemiLength!==m||b.numDirectionalShadows!==x||b.numPointShadows!==_||b.numSpotShadows!==w)&&(i.directional.length=p,i.spot.length=v,i.rectArea.length=y,i.point.length=g,i.hemi.length=m,i.directionalShadow.length=x,i.directionalShadowMap.length=x,i.pointShadow.length=_,i.pointShadowMap.length=_,i.spotShadow.length=w,i.spotShadowMap.length=w,i.directionalShadowMatrix.length=x,i.pointShadowMatrix.length=_,i.spotShadowMatrix.length=w,b.directionalLength=p,b.pointLength=g,b.spotLength=v,b.rectAreaLength=y,b.hemiLength=m,b.numDirectionalShadows=x,b.numPointShadows=_,b.numSpotShadows=w,i.version=R9++)}function c(u,d){let h=0,f=0,p=0,g=0,v=0,y=d.matrixWorldInverse;for(let m=0,x=u.length;m<x;m++){let _=u[m];if(_.isDirectionalLight){let w=i.directional[h];w.direction.setFromMatrixPosition(_.matrixWorld),r.setFromMatrixPosition(_.target.matrixWorld),w.direction.sub(r),w.direction.transformDirection(y),h++}else if(_.isSpotLight){let w=i.spot[p];w.position.setFromMatrixPosition(_.matrixWorld),w.position.applyMatrix4(y),w.direction.setFromMatrixPosition(_.matrixWorld),r.setFromMatrixPosition(_.target.matrixWorld),w.direction.sub(r),w.direction.transformDirection(y),p++}else if(_.isRectAreaLight){let w=i.rectArea[g];w.position.setFromMatrixPosition(_.matrixWorld),w.position.applyMatrix4(y),a.identity(),s.copy(_.matrixWorld),s.premultiply(y),a.extractRotation(s),w.halfWidth.set(_.width*.5,0,0),w.halfHeight.set(0,_.height*.5,0),w.halfWidth.applyMatrix4(a),w.halfHeight.applyMatrix4(a),g++}else if(_.isPointLight){let w=i.point[f];w.position.setFromMatrixPosition(_.matrixWorld),w.position.applyMatrix4(y),f++}else if(_.isHemisphereLight){let w=i.hemi[v];w.direction.setFromMatrixPosition(_.matrixWorld),w.direction.transformDirection(y),w.direction.normalize(),v++}}}return{setup:l,setupView:c,state:i}}function rP(o,e){let t=new I9(o,e),n=[],i=[];function r(){n.length=0,i.length=0}function s(d){n.push(d)}function a(d){i.push(d)}function l(){t.setup(n)}function c(d){t.setupView(n,d)}return{init:r,state:{lightsArray:n,shadowsArray:i,lights:t},setupLights:l,setupLightsView:c,pushLight:s,pushShadow:a}}function D9(o,e){let t=new WeakMap;function n(r,s=0){let a;return t.has(r)===!1?(a=new rP(o,e),t.set(r,[a])):s>=t.get(r).length?(a=new rP(o,e),t.get(r).push(a)):a=t.get(r)[s],a}function i(){t=new WeakMap}return{get:n,dispose:i}}var gM=class extends $n{constructor(e){super();this.type="MeshDepthMaterial",this.depthPacking=iW,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.morphTargets=e.morphTargets,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}};gM.prototype.isMeshDepthMaterial=!0;var yM=class extends $n{constructor(e){super();this.type="MeshDistanceMaterial",this.referencePosition=new le,this.nearDistance=1,this.farDistance=1e3,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.fog=!1,this.setValues(e)}copy(e){return super.copy(e),this.referencePosition.copy(e.referencePosition),this.nearDistance=e.nearDistance,this.farDistance=e.farDistance,this.morphTargets=e.morphTargets,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}};yM.prototype.isMeshDistanceMaterial=!0;var F9=`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
	float mean = 0.0;
	float squared_mean = 0.0;
	float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy ) / resolution ) );
	for ( float i = -1.0; i < 1.0 ; i += SAMPLE_RATE) {
		#ifdef HORIZONTAL_PASS
			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( i, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, i ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean * HALF_SAMPLE_RATE;
	squared_mean = squared_mean * HALF_SAMPLE_RATE;
	float std_dev = sqrt( squared_mean - mean * mean );
	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`,B9=`void main() {
	gl_Position = vec4( position, 1.0 );
}`;function sP(o,e,t){let n=new hp,i=new ke,r=new ke,s=new Nt,a=[],l=[],c={},u=t.maxTextureSize,d={0:Ln,1:Kf,2:Sa},h=new Fa({defines:{SAMPLE_RATE:2/8,HALF_SAMPLE_RATE:1/8},uniforms:{shadow_pass:{value:null},resolution:{value:new ke},radius:{value:4}},vertexShader:B9,fragmentShader:F9}),f=h.clone();f.defines.HORIZONTAL_PASS=1;let p=new kt;p.setAttribute("position",new Rn(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));let g=new Oi(p,h),v=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=HL,this.render=function(b,M,S){if(v.enabled===!1||v.autoUpdate===!1&&v.needsUpdate===!1||b.length===0)return;let E=o.getRenderTarget(),A=o.getActiveCubeFace(),L=o.getActiveMipmapLevel(),B=o.state;B.setBlending($f),B.buffers.color.setClear(1,1,1,1),B.buffers.depth.setTest(!0),B.setScissorTest(!1);for(let R=0,D=b.length;R<D;R++){let P=b[R],I=P.shadow;if(I===void 0){console.warn("THREE.WebGLShadowMap:",P,"has no shadow.");continue}if(I.autoUpdate===!1&&I.needsUpdate===!1)continue;i.copy(I.mapSize);let N=I.getFrameExtents();if(i.multiply(N),r.copy(I.mapSize),(i.x>u||i.y>u)&&(i.x>u&&(r.x=Math.floor(u/N.x),i.x=r.x*N.x,I.mapSize.x=r.x),i.y>u&&(r.y=Math.floor(u/N.y),i.y=r.y*N.y,I.mapSize.y=r.y)),I.map===null&&!I.isPointLightShadow&&this.type===Jf){let z={minFilter:xr,magFilter:xr,format:Cs};I.map=new Ls(i.x,i.y,z),I.map.texture.name=P.name+".shadowMap",I.mapPass=new Ls(i.x,i.y,z),I.camera.updateProjectionMatrix()}if(I.map===null){let z={minFilter:hi,magFilter:hi,format:Cs};I.map=new Ls(i.x,i.y,z),I.map.texture.name=P.name+".shadowMap",I.camera.updateProjectionMatrix()}o.setRenderTarget(I.map),o.clear();let G=I.getViewportCount();for(let z=0;z<G;z++){let se=I.getViewport(z);s.set(r.x*se.x,r.y*se.y,r.x*se.z,r.y*se.w),B.viewport(s),I.updateMatrices(P,z),n=I.getFrustum(),w(M,S,I.camera,P,this.type)}!I.isPointLightShadow&&this.type===Jf&&y(I,S),I.needsUpdate=!1}v.needsUpdate=!1,o.setRenderTarget(E,A,L)};function y(b,M){let S=e.update(g);h.uniforms.shadow_pass.value=b.map.texture,h.uniforms.resolution.value=b.mapSize,h.uniforms.radius.value=b.radius,o.setRenderTarget(b.mapPass),o.clear(),o.renderBufferDirect(M,null,S,h,g,null),f.uniforms.shadow_pass.value=b.mapPass.texture,f.uniforms.resolution.value=b.mapSize,f.uniforms.radius.value=b.radius,o.setRenderTarget(b.map),o.clear(),o.renderBufferDirect(M,null,S,f,g,null)}function m(b){let M=b<<0,S=a[M];return S===void 0&&(S=new gM({depthPacking:rW,morphTargets:b}),a[M]=S),S}function x(b){let M=b<<0,S=l[M];return S===void 0&&(S=new yM({morphTargets:b}),l[M]=S),S}function _(b,M,S,E,A,L,B){let R=null,D=m,P=b.customDepthMaterial;if(E.isPointLight===!0&&(D=x,P=b.customDistanceMaterial),P===void 0){let I=!1;S.morphTargets===!0&&(I=M.morphAttributes&&M.morphAttributes.position&&M.morphAttributes.position.length>0),R=D(I)}else R=P;if(o.localClippingEnabled&&S.clipShadows===!0&&S.clippingPlanes.length!==0){let I=R.uuid,N=S.uuid,G=c[I];G===void 0&&(G={},c[I]=G);let z=G[N];z===void 0&&(z=R.clone(),G[N]=z),R=z}return R.visible=S.visible,R.wireframe=S.wireframe,B===Jf?R.side=S.shadowSide!==null?S.shadowSide:S.side:R.side=S.shadowSide!==null?S.shadowSide:d[S.side],R.clipShadows=S.clipShadows,R.clippingPlanes=S.clippingPlanes,R.clipIntersection=S.clipIntersection,R.wireframeLinewidth=S.wireframeLinewidth,R.linewidth=S.linewidth,E.isPointLight===!0&&R.isMeshDistanceMaterial===!0&&(R.referencePosition.setFromMatrixPosition(E.matrixWorld),R.nearDistance=A,R.farDistance=L),R}function w(b,M,S,E,A){if(b.visible===!1)return;if(b.layers.test(M.layers)&&(b.isMesh||b.isLine||b.isPoints)&&(b.castShadow||b.receiveShadow&&A===Jf)&&(!b.frustumCulled||n.intersectsObject(b))){b.modelViewMatrix.multiplyMatrices(S.matrixWorldInverse,b.matrixWorld);let R=e.update(b),D=b.material;if(Array.isArray(D)){let P=R.groups;for(let I=0,N=P.length;I<N;I++){let G=P[I],z=D[G.materialIndex];if(z&&z.visible){let se=_(b,R,z,E,S.near,S.far,A);o.renderBufferDirect(S,null,R,se,b,G)}}}else if(D.visible){let P=_(b,R,D,E,S.near,S.far,A);o.renderBufferDirect(S,null,R,P,b,null)}}let B=b.children;for(let R=0,D=B.length;R<D;R++)w(B[R],M,S,E,A)}}function N9(o,e,t){let n=t.isWebGL2;function i(){let k=!1,de=new Nt,K=null,be=new Nt(0,0,0,0);return{setMask:function(we){K!==we&&!k&&(o.colorMask(we,we,we,we),K=we)},setLocked:function(we){k=we},setClear:function(we,We,ve,Be,nt){nt===!0&&(we*=Be,We*=Be,ve*=Be),de.set(we,We,ve,Be),be.equals(de)===!1&&(o.clearColor(we,We,ve,Be),be.copy(de))},reset:function(){k=!1,K=null,be.set(-1,0,0,0)}}}function r(){let k=!1,de=null,K=null,be=null;return{setTest:function(we){we?O(2929):ee(2929)},setMask:function(we){de!==we&&!k&&(o.depthMask(we),de=we)},setFunc:function(we){if(K!==we){if(we)switch(we){case qV:o.depthFunc(512);break;case jV:o.depthFunc(519);break;case YV:o.depthFunc(513);break;case Eb:o.depthFunc(515);break;case ZV:o.depthFunc(514);break;case JV:o.depthFunc(518);break;case KV:o.depthFunc(516);break;case $V:o.depthFunc(517);break;default:o.depthFunc(515)}else o.depthFunc(515);K=we}},setLocked:function(we){k=we},setClear:function(we){be!==we&&(o.clearDepth(we),be=we)},reset:function(){k=!1,de=null,K=null,be=null}}}function s(){let k=!1,de=null,K=null,be=null,we=null,We=null,ve=null,Be=null,nt=null;return{setTest:function(Xe){k||(Xe?O(2960):ee(2960))},setMask:function(Xe){de!==Xe&&!k&&(o.stencilMask(Xe),de=Xe)},setFunc:function(Xe,_t,wt){(K!==Xe||be!==_t||we!==wt)&&(o.stencilFunc(Xe,_t,wt),K=Xe,be=_t,we=wt)},setOp:function(Xe,_t,wt){(We!==Xe||ve!==_t||Be!==wt)&&(o.stencilOp(Xe,_t,wt),We=Xe,ve=_t,Be=wt)},setLocked:function(Xe){k=Xe},setClear:function(Xe){nt!==Xe&&(o.clearStencil(Xe),nt=Xe)},reset:function(){k=!1,de=null,K=null,be=null,we=null,We=null,ve=null,Be=null,nt=null}}}let a=new i,l=new r,c=new s,u={},d=null,h={},f=null,p=!1,g=null,v=null,y=null,m=null,x=null,_=null,w=null,b=!1,M=null,S=null,E=null,A=null,L=null,B=o.getParameter(35661),R=!1,D=0,P=o.getParameter(7938);P.indexOf("WebGL")!==-1?(D=parseFloat(/^WebGL (\d)/.exec(P)[1]),R=D>=1):P.indexOf("OpenGL ES")!==-1&&(D=parseFloat(/^OpenGL ES (\d)/.exec(P)[1]),R=D>=2);let I=null,N={},G=o.getParameter(3088),z=o.getParameter(2978),se=new Nt().fromArray(G),ne=new Nt().fromArray(z);function Q(k,de,K){let be=new Uint8Array(4),we=o.createTexture();o.bindTexture(k,we),o.texParameteri(k,10241,9728),o.texParameteri(k,10240,9728);for(let We=0;We<K;We++)o.texImage2D(de+We,0,6408,1,1,0,6408,5121,be);return we}let j={};j[3553]=Q(3553,3553,1),j[34067]=Q(34067,34069,6),a.setClear(0,0,0,1),l.setClear(1),c.setClear(0),O(2929),l.setFunc(Eb),$(!1),J(UL),O(2884),xe($f);function O(k){u[k]!==!0&&(o.enable(k),u[k]=!0)}function ee(k){u[k]!==!1&&(o.disable(k),u[k]=!1)}function V(k){k!==d&&(o.bindFramebuffer(36160,k),d=k)}function ie(k,de){return de===null&&d!==null&&(de=d),h[k]!==de?(o.bindFramebuffer(k,de),h[k]=de,n&&(k===36009&&(h[36160]=de),k===36160&&(h[36009]=de)),!0):!1}function ue(k){return f!==k?(o.useProgram(k),f=k,!0):!1}let ye={[th]:32774,[BV]:32778,[NV]:32779};if(n)ye[qL]=32775,ye[jL]=32776;else{let k=e.get("EXT_blend_minmax");k!==null&&(ye[qL]=k.MIN_EXT,ye[jL]=k.MAX_EXT)}let pe={[OV]:0,[kV]:1,[zV]:768,[YL]:770,[XV]:776,[VV]:774,[HV]:772,[UV]:769,[ZL]:771,[WV]:775,[GV]:773};function xe(k,de,K,be,we,We,ve,Be){if(k===$f){p===!0&&(ee(3042),p=!1);return}if(p===!1&&(O(3042),p=!0),k!==FV){if(k!==g||Be!==b){if((v!==th||x!==th)&&(o.blendEquation(32774),v=th,x=th),Be)switch(k){case Qf:o.blendFuncSeparate(1,771,1,771);break;case VL:o.blendFunc(1,1);break;case WL:o.blendFuncSeparate(0,0,769,771);break;case XL:o.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",k);break}else switch(k){case Qf:o.blendFuncSeparate(770,771,1,771);break;case VL:o.blendFunc(770,1);break;case WL:o.blendFunc(0,769);break;case XL:o.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",k);break}y=null,m=null,_=null,w=null,g=k,b=Be}return}we=we||de,We=We||K,ve=ve||be,(de!==v||we!==x)&&(o.blendEquationSeparate(ye[de],ye[we]),v=de,x=we),(K!==y||be!==m||We!==_||ve!==w)&&(o.blendFuncSeparate(pe[K],pe[be],pe[We],pe[ve]),y=K,m=be,_=We,w=ve),g=k,b=null}function X(k,de){k.side===Sa?ee(2884):O(2884);let K=k.side===Ln;de&&(K=!K),$(K),k.blending===Qf&&k.transparent===!1?xe($f):xe(k.blending,k.blendEquation,k.blendSrc,k.blendDst,k.blendEquationAlpha,k.blendSrcAlpha,k.blendDstAlpha,k.premultipliedAlpha),l.setFunc(k.depthFunc),l.setTest(k.depthTest),l.setMask(k.depthWrite),a.setMask(k.colorWrite);let be=k.stencilWrite;c.setTest(be),be&&(c.setMask(k.stencilWriteMask),c.setFunc(k.stencilFunc,k.stencilRef,k.stencilFuncMask),c.setOp(k.stencilFail,k.stencilZFail,k.stencilZPass)),H(k.polygonOffset,k.polygonOffsetFactor,k.polygonOffsetUnits),k.alphaToCoverage===!0?O(32926):ee(32926)}function $(k){M!==k&&(k?o.frontFace(2304):o.frontFace(2305),M=k)}function J(k){k!==PV?(O(2884),k!==S&&(k===UL?o.cullFace(1029):k===IV?o.cullFace(1028):o.cullFace(1032))):ee(2884),S=k}function ce(k){k!==E&&(R&&o.lineWidth(k),E=k)}function H(k,de,K){k?(O(32823),(A!==de||L!==K)&&(o.polygonOffset(de,K),A=de,L=K)):ee(32823)}function T(k){k?O(3089):ee(3089)}function C(k){k===void 0&&(k=33984+B-1),I!==k&&(o.activeTexture(k),I=k)}function W(k,de){I===null&&C();let K=N[I];K===void 0&&(K={type:void 0,texture:void 0},N[I]=K),(K.type!==k||K.texture!==de)&&(o.bindTexture(k,de||j[k]),K.type=k,K.texture=de)}function Z(){let k=N[I];k!==void 0&&k.type!==void 0&&(o.bindTexture(k.type,null),k.type=void 0,k.texture=void 0)}function he(){try{o.compressedTexImage2D.apply(o,arguments)}catch(k){console.error("THREE.WebGLState:",k)}}function me(){try{o.texImage2D.apply(o,arguments)}catch(k){console.error("THREE.WebGLState:",k)}}function Ee(){try{o.texImage3D.apply(o,arguments)}catch(k){console.error("THREE.WebGLState:",k)}}function Se(k){se.equals(k)===!1&&(o.scissor(k.x,k.y,k.z,k.w),se.copy(k))}function oe(k){ne.equals(k)===!1&&(o.viewport(k.x,k.y,k.z,k.w),ne.copy(k))}function ge(){o.disable(3042),o.disable(2884),o.disable(2929),o.disable(32823),o.disable(3089),o.disable(2960),o.disable(32926),o.blendEquation(32774),o.blendFunc(1,0),o.blendFuncSeparate(1,0,1,0),o.colorMask(!0,!0,!0,!0),o.clearColor(0,0,0,0),o.depthMask(!0),o.depthFunc(513),o.clearDepth(1),o.stencilMask(4294967295),o.stencilFunc(519,0,4294967295),o.stencilOp(7680,7680,7680),o.clearStencil(0),o.cullFace(1029),o.frontFace(2305),o.polygonOffset(0,0),o.activeTexture(33984),o.bindFramebuffer(36160,null),n===!0&&(o.bindFramebuffer(36009,null),o.bindFramebuffer(36008,null)),o.useProgram(null),o.lineWidth(1),o.scissor(0,0,o.canvas.width,o.canvas.height),o.viewport(0,0,o.canvas.width,o.canvas.height),u={},I=null,N={},d=null,h={},f=null,p=!1,g=null,v=null,y=null,m=null,x=null,_=null,w=null,b=!1,M=null,S=null,E=null,A=null,L=null,se.set(0,0,o.canvas.width,o.canvas.height),ne.set(0,0,o.canvas.width,o.canvas.height),a.reset(),l.reset(),c.reset()}return{buffers:{color:a,depth:l,stencil:c},enable:O,disable:ee,bindFramebuffer:ie,bindXRFramebuffer:V,useProgram:ue,setBlending:xe,setMaterial:X,setFlipSided:$,setCullFace:J,setLineWidth:ce,setPolygonOffset:H,setScissorTest:T,activeTexture:C,bindTexture:W,unbindTexture:Z,compressedTexImage2D:he,texImage2D:me,texImage3D:Ee,scissor:Se,viewport:oe,reset:ge}}function O9(o,e,t,n,i,r,s){let a=i.isWebGL2,l=i.maxTextures,c=i.maxCubemapSize,u=i.maxTextureSize,d=i.maxSamples,h=new WeakMap,f,p=!1;try{p=typeof OffscreenCanvas!="undefined"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch(T){}function g(T,C){return p?new OffscreenCanvas(T,C):document.createElementNS("http://www.w3.org/1999/xhtml","canvas")}function v(T,C,W,Z){let he=1;if((T.width>Z||T.height>Z)&&(he=Z/Math.max(T.width,T.height)),he<1||C===!0)if(typeof HTMLImageElement!="undefined"&&T instanceof HTMLImageElement||typeof HTMLCanvasElement!="undefined"&&T instanceof HTMLCanvasElement||typeof ImageBitmap!="undefined"&&T instanceof ImageBitmap){let me=C?vR:Math.floor,Ee=me(he*T.width),Se=me(he*T.height);f===void 0&&(f=g(Ee,Se));let oe=W?g(Ee,Se):f;return oe.width=Ee,oe.height=Se,oe.getContext("2d").drawImage(T,0,0,Ee,Se),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+T.width+"x"+T.height+") to ("+Ee+"x"+Se+")."),oe}else return"data"in T&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+T.width+"x"+T.height+")."),T;return T}function y(T){return kb(T.width)&&kb(T.height)}function m(T){return a?!1:T.wrapS!==Ki||T.wrapT!==Ki||T.minFilter!==hi&&T.minFilter!==xr}function x(T,C){return T.generateMipmaps&&C&&T.minFilter!==hi&&T.minFilter!==xr}function _(T,C,W,Z,he=1){o.generateMipmap(T);let me=n.get(C);me.__maxMipLevel=Math.log2(Math.max(W,Z,he))}function w(T,C,W){if(a===!1)return C;if(T!==null){if(o[T]!==void 0)return o[T];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+T+"'")}let Z=C;return C===6403&&(W===5126&&(Z=33326),W===5131&&(Z=33325),W===5121&&(Z=33321)),C===6407&&(W===5126&&(Z=34837),W===5131&&(Z=34843),W===5121&&(Z=32849)),C===6408&&(W===5126&&(Z=34836),W===5131&&(Z=34842),W===5121&&(Z=32856)),(Z===33325||Z===33326||Z===34842||Z===34836)&&e.get("EXT_color_buffer_float"),Z}function b(T){return T===hi||T===QL||T===eR?9728:9729}function M(T){let C=T.target;C.removeEventListener("dispose",M),E(C),C.isVideoTexture&&h.delete(C),s.memory.textures--}function S(T){let C=T.target;C.removeEventListener("dispose",S),A(C)}function E(T){let C=n.get(T);C.__webglInit!==void 0&&(o.deleteTexture(C.__webglTexture),n.remove(T))}function A(T){let C=T.texture,W=n.get(T),Z=n.get(C);if(!!T){if(Z.__webglTexture!==void 0&&(o.deleteTexture(Z.__webglTexture),s.memory.textures--),T.depthTexture&&T.depthTexture.dispose(),T.isWebGLCubeRenderTarget)for(let he=0;he<6;he++)o.deleteFramebuffer(W.__webglFramebuffer[he]),W.__webglDepthbuffer&&o.deleteRenderbuffer(W.__webglDepthbuffer[he]);else o.deleteFramebuffer(W.__webglFramebuffer),W.__webglDepthbuffer&&o.deleteRenderbuffer(W.__webglDepthbuffer),W.__webglMultisampledFramebuffer&&o.deleteFramebuffer(W.__webglMultisampledFramebuffer),W.__webglColorRenderbuffer&&o.deleteRenderbuffer(W.__webglColorRenderbuffer),W.__webglDepthRenderbuffer&&o.deleteRenderbuffer(W.__webglDepthRenderbuffer);if(T.isWebGLMultipleRenderTargets)for(let he=0,me=C.length;he<me;he++){let Ee=n.get(C[he]);Ee.__webglTexture&&(o.deleteTexture(Ee.__webglTexture),s.memory.textures--),n.remove(C[he])}n.remove(C),n.remove(T)}}let L=0;function B(){L=0}function R(){let T=L;return T>=l&&console.warn("THREE.WebGLTextures: Trying to use "+T+" texture units while this GPU supports only "+l),L+=1,T}function D(T,C){let W=n.get(T);if(T.isVideoTexture&&X(T),T.version>0&&W.__version!==T.version){let Z=T.image;if(Z===void 0)console.warn("THREE.WebGLRenderer: Texture marked for update but image is undefined");else if(Z.complete===!1)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete");else{Q(W,T,C);return}}t.activeTexture(33984+C),t.bindTexture(3553,W.__webglTexture)}function P(T,C){let W=n.get(T);if(T.version>0&&W.__version!==T.version){Q(W,T,C);return}t.activeTexture(33984+C),t.bindTexture(35866,W.__webglTexture)}function I(T,C){let W=n.get(T);if(T.version>0&&W.__version!==T.version){Q(W,T,C);return}t.activeTexture(33984+C),t.bindTexture(32879,W.__webglTexture)}function N(T,C){let W=n.get(T);if(T.version>0&&W.__version!==T.version){j(W,T,C);return}t.activeTexture(33984+C),t.bindTexture(34067,W.__webglTexture)}let G={[Pb]:10497,[Ki]:33071,[Ib]:33648},z={[hi]:9728,[QL]:9984,[eR]:9986,[xr]:9729,[o5]:9985,[ky]:9987};function se(T,C,W){if(W?(o.texParameteri(T,10242,G[C.wrapS]),o.texParameteri(T,10243,G[C.wrapT]),(T===32879||T===35866)&&o.texParameteri(T,32882,G[C.wrapR]),o.texParameteri(T,10240,z[C.magFilter]),o.texParameteri(T,10241,z[C.minFilter])):(o.texParameteri(T,10242,33071),o.texParameteri(T,10243,33071),(T===32879||T===35866)&&o.texParameteri(T,32882,33071),(C.wrapS!==Ki||C.wrapT!==Ki)&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),o.texParameteri(T,10240,b(C.magFilter)),o.texParameteri(T,10241,b(C.minFilter)),C.minFilter!==hi&&C.minFilter!==xr&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),e.has("EXT_texture_filter_anisotropic")===!0){let Z=e.get("EXT_texture_filter_anisotropic");if(C.type===Zl&&e.has("OES_texture_float_linear")===!1||a===!1&&C.type===ih&&e.has("OES_texture_half_float_linear")===!1)return;(C.anisotropy>1||n.get(C).__currentAnisotropy)&&(o.texParameterf(T,Z.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(C.anisotropy,i.getMaxAnisotropy())),n.get(C).__currentAnisotropy=C.anisotropy)}}function ne(T,C){T.__webglInit===void 0&&(T.__webglInit=!0,C.addEventListener("dispose",M),T.__webglTexture=o.createTexture(),s.memory.textures++)}function Q(T,C,W){let Z=3553;C.isDataTexture2DArray&&(Z=35866),C.isDataTexture3D&&(Z=32879),ne(T,C),t.activeTexture(33984+W),t.bindTexture(Z,T.__webglTexture),o.pixelStorei(37440,C.flipY),o.pixelStorei(37441,C.premultiplyAlpha),o.pixelStorei(3317,C.unpackAlignment),o.pixelStorei(37443,0);let he=m(C)&&y(C.image)===!1,me=v(C.image,he,!1,u),Ee=y(me)||a,Se=r.convert(C.format),oe=r.convert(C.type),ge=w(C.internalFormat,Se,oe);se(Z,C,Ee);let k,de=C.mipmaps;if(C.isDepthTexture)ge=6402,a?C.type===Zl?ge=36012:C.type===Hy?ge=33190:C.type===ep?ge=35056:ge=33189:C.type===Zl&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),C.format===rh&&ge===6402&&C.type!==Uy&&C.type!==Hy&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),C.type=Uy,oe=r.convert(C.type)),C.format===tp&&ge===6402&&(ge=34041,C.type!==ep&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),C.type=ep,oe=r.convert(C.type))),t.texImage2D(3553,0,ge,me.width,me.height,0,Se,oe,null);else if(C.isDataTexture)if(de.length>0&&Ee){for(let K=0,be=de.length;K<be;K++)k=de[K],t.texImage2D(3553,K,ge,k.width,k.height,0,Se,oe,k.data);C.generateMipmaps=!1,T.__maxMipLevel=de.length-1}else t.texImage2D(3553,0,ge,me.width,me.height,0,Se,oe,me.data),T.__maxMipLevel=0;else if(C.isCompressedTexture){for(let K=0,be=de.length;K<be;K++)k=de[K],C.format!==Cs&&C.format!==Jl?Se!==null?t.compressedTexImage2D(3553,K,ge,k.width,k.height,0,k.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):t.texImage2D(3553,K,ge,k.width,k.height,0,Se,oe,k.data);T.__maxMipLevel=de.length-1}else if(C.isDataTexture2DArray)t.texImage3D(35866,0,ge,me.width,me.height,me.depth,0,Se,oe,me.data),T.__maxMipLevel=0;else if(C.isDataTexture3D)t.texImage3D(32879,0,ge,me.width,me.height,me.depth,0,Se,oe,me.data),T.__maxMipLevel=0;else if(de.length>0&&Ee){for(let K=0,be=de.length;K<be;K++)k=de[K],t.texImage2D(3553,K,ge,Se,oe,k);C.generateMipmaps=!1,T.__maxMipLevel=de.length-1}else t.texImage2D(3553,0,ge,Se,oe,me),T.__maxMipLevel=0;x(C,Ee)&&_(Z,C,me.width,me.height),T.__version=C.version,C.onUpdate&&C.onUpdate(C)}function j(T,C,W){if(C.image.length!==6)return;ne(T,C),t.activeTexture(33984+W),t.bindTexture(34067,T.__webglTexture),o.pixelStorei(37440,C.flipY),o.pixelStorei(37441,C.premultiplyAlpha),o.pixelStorei(3317,C.unpackAlignment),o.pixelStorei(37443,0);let Z=C&&(C.isCompressedTexture||C.image[0].isCompressedTexture),he=C.image[0]&&C.image[0].isDataTexture,me=[];for(let K=0;K<6;K++)!Z&&!he?me[K]=v(C.image[K],!1,!0,c):me[K]=he?C.image[K].image:C.image[K];let Ee=me[0],Se=y(Ee)||a,oe=r.convert(C.format),ge=r.convert(C.type),k=w(C.internalFormat,oe,ge);se(34067,C,Se);let de;if(Z){for(let K=0;K<6;K++){de=me[K].mipmaps;for(let be=0;be<de.length;be++){let we=de[be];C.format!==Cs&&C.format!==Jl?oe!==null?t.compressedTexImage2D(34069+K,be,k,we.width,we.height,0,we.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):t.texImage2D(34069+K,be,k,we.width,we.height,0,oe,ge,we.data)}}T.__maxMipLevel=de.length-1}else{de=C.mipmaps;for(let K=0;K<6;K++)if(he){t.texImage2D(34069+K,0,k,me[K].width,me[K].height,0,oe,ge,me[K].data);for(let be=0;be<de.length;be++){let We=de[be].image[K].image;t.texImage2D(34069+K,be+1,k,We.width,We.height,0,oe,ge,We.data)}}else{t.texImage2D(34069+K,0,k,oe,ge,me[K]);for(let be=0;be<de.length;be++){let we=de[be];t.texImage2D(34069+K,be+1,k,oe,ge,we.image[K])}}T.__maxMipLevel=de.length}x(C,Se)&&_(34067,C,Ee.width,Ee.height),T.__version=C.version,C.onUpdate&&C.onUpdate(C)}function O(T,C,W,Z,he){let me=r.convert(W.format),Ee=r.convert(W.type),Se=w(W.internalFormat,me,Ee);he===32879||he===35866?t.texImage3D(he,0,Se,C.width,C.height,C.depth,0,me,Ee,null):t.texImage2D(he,0,Se,C.width,C.height,0,me,Ee,null),t.bindFramebuffer(36160,T),o.framebufferTexture2D(36160,Z,he,n.get(W).__webglTexture,0),t.bindFramebuffer(36160,null)}function ee(T,C,W){if(o.bindRenderbuffer(36161,T),C.depthBuffer&&!C.stencilBuffer){let Z=33189;if(W){let he=C.depthTexture;he&&he.isDepthTexture&&(he.type===Zl?Z=36012:he.type===Hy&&(Z=33190));let me=xe(C);o.renderbufferStorageMultisample(36161,me,Z,C.width,C.height)}else o.renderbufferStorage(36161,Z,C.width,C.height);o.framebufferRenderbuffer(36160,36096,36161,T)}else if(C.depthBuffer&&C.stencilBuffer){if(W){let Z=xe(C);o.renderbufferStorageMultisample(36161,Z,35056,C.width,C.height)}else o.renderbufferStorage(36161,34041,C.width,C.height);o.framebufferRenderbuffer(36160,33306,36161,T)}else{let Z=C.isWebGLMultipleRenderTargets===!0?C.texture[0]:C.texture,he=r.convert(Z.format),me=r.convert(Z.type),Ee=w(Z.internalFormat,he,me);if(W){let Se=xe(C);o.renderbufferStorageMultisample(36161,Se,Ee,C.width,C.height)}else o.renderbufferStorage(36161,Ee,C.width,C.height)}o.bindRenderbuffer(36161,null)}function V(T,C){if(C&&C.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(t.bindFramebuffer(36160,T),!(C.depthTexture&&C.depthTexture.isDepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");(!n.get(C.depthTexture).__webglTexture||C.depthTexture.image.width!==C.width||C.depthTexture.image.height!==C.height)&&(C.depthTexture.image.width=C.width,C.depthTexture.image.height=C.height,C.depthTexture.needsUpdate=!0),D(C.depthTexture,0);let Z=n.get(C.depthTexture).__webglTexture;if(C.depthTexture.format===rh)o.framebufferTexture2D(36160,36096,3553,Z,0);else if(C.depthTexture.format===tp)o.framebufferTexture2D(36160,33306,3553,Z,0);else throw new Error("Unknown depthTexture format")}function ie(T){let C=n.get(T),W=T.isWebGLCubeRenderTarget===!0;if(T.depthTexture){if(W)throw new Error("target.depthTexture not supported in Cube render targets");V(C.__webglFramebuffer,T)}else if(W){C.__webglDepthbuffer=[];for(let Z=0;Z<6;Z++)t.bindFramebuffer(36160,C.__webglFramebuffer[Z]),C.__webglDepthbuffer[Z]=o.createRenderbuffer(),ee(C.__webglDepthbuffer[Z],T,!1)}else t.bindFramebuffer(36160,C.__webglFramebuffer),C.__webglDepthbuffer=o.createRenderbuffer(),ee(C.__webglDepthbuffer,T,!1);t.bindFramebuffer(36160,null)}function ue(T){let C=T.texture,W=n.get(T),Z=n.get(C);T.addEventListener("dispose",S),T.isWebGLMultipleRenderTargets!==!0&&(Z.__webglTexture=o.createTexture(),Z.__version=C.version,s.memory.textures++);let he=T.isWebGLCubeRenderTarget===!0,me=T.isWebGLMultipleRenderTargets===!0,Ee=T.isWebGLMultisampleRenderTarget===!0,Se=C.isDataTexture3D||C.isDataTexture2DArray,oe=y(T)||a;if(a&&C.format===Jl&&(C.type===Zl||C.type===ih)&&(C.format=Cs,console.warn("THREE.WebGLRenderer: Rendering to textures with RGB format is not supported. Using RGBA format instead.")),he){W.__webglFramebuffer=[];for(let ge=0;ge<6;ge++)W.__webglFramebuffer[ge]=o.createFramebuffer()}else if(W.__webglFramebuffer=o.createFramebuffer(),me)if(i.drawBuffers){let ge=T.texture;for(let k=0,de=ge.length;k<de;k++){let K=n.get(ge[k]);K.__webglTexture===void 0&&(K.__webglTexture=o.createTexture(),s.memory.textures++)}}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");else if(Ee)if(a){W.__webglMultisampledFramebuffer=o.createFramebuffer(),W.__webglColorRenderbuffer=o.createRenderbuffer(),o.bindRenderbuffer(36161,W.__webglColorRenderbuffer);let ge=r.convert(C.format),k=r.convert(C.type),de=w(C.internalFormat,ge,k),K=xe(T);o.renderbufferStorageMultisample(36161,K,de,T.width,T.height),t.bindFramebuffer(36160,W.__webglMultisampledFramebuffer),o.framebufferRenderbuffer(36160,36064,36161,W.__webglColorRenderbuffer),o.bindRenderbuffer(36161,null),T.depthBuffer&&(W.__webglDepthRenderbuffer=o.createRenderbuffer(),ee(W.__webglDepthRenderbuffer,T,!0)),t.bindFramebuffer(36160,null)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.");if(he){t.bindTexture(34067,Z.__webglTexture),se(34067,C,oe);for(let ge=0;ge<6;ge++)O(W.__webglFramebuffer[ge],T,C,36064,34069+ge);x(C,oe)&&_(34067,C,T.width,T.height),t.bindTexture(34067,null)}else if(me){let ge=T.texture;for(let k=0,de=ge.length;k<de;k++){let K=ge[k],be=n.get(K);t.bindTexture(3553,be.__webglTexture),se(3553,K,oe),O(W.__webglFramebuffer,T,K,36064+k,3553),x(K,oe)&&_(3553,K,T.width,T.height)}t.bindTexture(3553,null)}else{let ge=3553;Se&&(a?ge=C.isDataTexture3D?32879:35866:console.warn("THREE.DataTexture3D and THREE.DataTexture2DArray only supported with WebGL2.")),t.bindTexture(ge,Z.__webglTexture),se(ge,C,oe),O(W.__webglFramebuffer,T,C,36064,ge),x(C,oe)&&_(ge,C,T.width,T.height,T.depth),t.bindTexture(ge,null)}T.depthBuffer&&ie(T)}function ye(T){let C=y(T)||a,W=T.isWebGLMultipleRenderTargets===!0?T.texture:[T.texture];for(let Z=0,he=W.length;Z<he;Z++){let me=W[Z];if(x(me,C)){let Ee=T.isWebGLCubeRenderTarget?34067:3553,Se=n.get(me).__webglTexture;t.bindTexture(Ee,Se),_(Ee,me,T.width,T.height),t.bindTexture(Ee,null)}}}function pe(T){if(T.isWebGLMultisampleRenderTarget)if(a){let C=T.width,W=T.height,Z=16384;T.depthBuffer&&(Z|=256),T.stencilBuffer&&(Z|=1024);let he=n.get(T);t.bindFramebuffer(36008,he.__webglMultisampledFramebuffer),t.bindFramebuffer(36009,he.__webglFramebuffer),o.blitFramebuffer(0,0,C,W,0,0,C,W,Z,9728),t.bindFramebuffer(36008,null),t.bindFramebuffer(36009,he.__webglMultisampledFramebuffer)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.")}function xe(T){return a&&T.isWebGLMultisampleRenderTarget?Math.min(d,T.samples):0}function X(T){let C=s.render.frame;h.get(T)!==C&&(h.set(T,C),T.update())}let $=!1,J=!1;function ce(T,C){T&&T.isWebGLRenderTarget&&($===!1&&(console.warn("THREE.WebGLTextures.safeSetTexture2D: don't use render targets as textures. Use their .texture property instead."),$=!0),T=T.texture),D(T,C)}function H(T,C){T&&T.isWebGLCubeRenderTarget&&(J===!1&&(console.warn("THREE.WebGLTextures.safeSetTextureCube: don't use cube render targets as textures. Use their .texture property instead."),J=!0),T=T.texture),N(T,C)}this.allocateTextureUnit=R,this.resetTextureUnits=B,this.setTexture2D=D,this.setTexture2DArray=P,this.setTexture3D=I,this.setTextureCube=N,this.setupRenderTarget=ue,this.updateRenderTargetMipmap=ye,this.updateMultisampleRenderTarget=pe,this.safeSetTexture2D=ce,this.safeSetTextureCube=H}function k9(o,e,t){let n=t.isWebGL2;function i(r){let s;if(r===zy)return 5121;if(r===u5)return 32819;if(r===h5)return 32820;if(r===d5)return 33635;if(r===a5)return 5120;if(r===l5)return 5122;if(r===Uy)return 5123;if(r===c5)return 5124;if(r===Hy)return 5125;if(r===Zl)return 5126;if(r===ih)return n?5131:(s=e.get("OES_texture_half_float"),s!==null?s.HALF_FLOAT_OES:null);if(r===f5)return 6406;if(r===Jl)return 6407;if(r===Cs)return 6408;if(r===p5)return 6409;if(r===m5)return 6410;if(r===rh)return 6402;if(r===tp)return 34041;if(r===g5)return 6403;if(r===y5)return 36244;if(r===v5)return 33319;if(r===x5)return 33320;if(r===_5)return 36248;if(r===w5)return 36249;if(r===tR||r===nR||r===iR||r===rR)if(s=e.get("WEBGL_compressed_texture_s3tc"),s!==null){if(r===tR)return s.COMPRESSED_RGB_S3TC_DXT1_EXT;if(r===nR)return s.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(r===iR)return s.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(r===rR)return s.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(r===sR||r===oR||r===aR||r===lR)if(s=e.get("WEBGL_compressed_texture_pvrtc"),s!==null){if(r===sR)return s.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(r===oR)return s.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(r===aR)return s.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(r===lR)return s.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(r===b5)return s=e.get("WEBGL_compressed_texture_etc1"),s!==null?s.COMPRESSED_RGB_ETC1_WEBGL:null;if((r===cR||r===uR)&&(s=e.get("WEBGL_compressed_texture_etc"),s!==null)){if(r===cR)return s.COMPRESSED_RGB8_ETC2;if(r===uR)return s.COMPRESSED_RGBA8_ETC2_EAC}if(r===M5||r===S5||r===T5||r===E5||r===A5||r===C5||r===L5||r===R5||r===P5||r===I5||r===D5||r===F5||r===B5||r===N5||r===k5||r===z5||r===U5||r===H5||r===G5||r===V5||r===W5||r===X5||r===q5||r===j5||r===Y5||r===Z5||r===J5||r===K5)return s=e.get("WEBGL_compressed_texture_astc"),s!==null?r:null;if(r===O5)return s=e.get("EXT_texture_compression_bptc"),s!==null?r:null;if(r===ep)return n?34042:(s=e.get("WEBGL_depth_texture"),s!==null?s.UNSIGNED_INT_24_8_WEBGL:null)}return{convert:i}}var vM=class extends ki{constructor(e=[]){super();this.cameras=e}};vM.prototype.isArrayCamera=!0;var Eh=class extends Tt{constructor(){super();this.type="Group"}};Eh.prototype.isGroup=!0;var z9={type:"move"},d0=class{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new Eh,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new Eh,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new le,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new le),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new Eh,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new le,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new le),this._grip}dispatchEvent(e){return this._targetRay!==null&&this._targetRay.dispatchEvent(e),this._grip!==null&&this._grip.dispatchEvent(e),this._hand!==null&&this._hand.dispatchEvent(e),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(e,t,n){let i=null,r=null,s=null,a=this._targetRay,l=this._grip,c=this._hand;if(e&&t.session.visibilityState!=="visible-blurred")if(a!==null&&(i=t.getPose(e.targetRaySpace,n),i!==null&&(a.matrix.fromArray(i.transform.matrix),a.matrix.decompose(a.position,a.rotation,a.scale),i.linearVelocity?(a.hasLinearVelocity=!0,a.linearVelocity.copy(i.linearVelocity)):a.hasLinearVelocity=!1,i.angularVelocity?(a.hasAngularVelocity=!0,a.angularVelocity.copy(i.angularVelocity)):a.hasAngularVelocity=!1,this.dispatchEvent(z9))),c&&e.hand){s=!0;for(let g of e.hand.values()){let v=t.getJointPose(g,n);if(c.joints[g.jointName]===void 0){let m=new Eh;m.matrixAutoUpdate=!1,m.visible=!1,c.joints[g.jointName]=m,c.add(m)}let y=c.joints[g.jointName];v!==null&&(y.matrix.fromArray(v.transform.matrix),y.matrix.decompose(y.position,y.rotation,y.scale),y.jointRadius=v.radius),y.visible=v!==null}let u=c.joints["index-finger-tip"],d=c.joints["thumb-tip"],h=u.position.distanceTo(d.position),f=.02,p=.005;c.inputState.pinching&&h>f+p?(c.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!c.inputState.pinching&&h<=f-p&&(c.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else l!==null&&e.gripSpace&&(r=t.getPose(e.gripSpace,n),r!==null&&(l.matrix.fromArray(r.transform.matrix),l.matrix.decompose(l.position,l.rotation,l.scale),r.linearVelocity?(l.hasLinearVelocity=!0,l.linearVelocity.copy(r.linearVelocity)):l.hasLinearVelocity=!1,r.angularVelocity?(l.hasAngularVelocity=!0,l.angularVelocity.copy(r.angularVelocity)):l.hasAngularVelocity=!1));return a!==null&&(a.visible=i!==null),l!==null&&(l.visible=r!==null),c!==null&&(c.visible=s!==null),this}},oP=class extends Ta{constructor(e,t){super();let n=this,i=e.state,r=null,s=1,a=null,l="local-floor",c=null,u=null,d=null,h=null,f=[],p=new Map,g=new ki;g.layers.enable(1),g.viewport=new Nt;let v=new ki;v.layers.enable(2),v.viewport=new Nt;let y=[g,v],m=new vM;m.layers.enable(1),m.layers.enable(2);let x=null,_=null;this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(P){let I=f[P];return I===void 0&&(I=new d0,f[P]=I),I.getTargetRaySpace()},this.getControllerGrip=function(P){let I=f[P];return I===void 0&&(I=new d0,f[P]=I),I.getGripSpace()},this.getHand=function(P){let I=f[P];return I===void 0&&(I=new d0,f[P]=I),I.getHandSpace()};function w(P){let I=p.get(P.inputSource);I&&I.dispatchEvent({type:P.type,data:P.inputSource})}function b(){p.forEach(function(P,I){P.disconnect(I)}),p.clear(),x=null,_=null,i.bindXRFramebuffer(null),e.setRenderTarget(e.getRenderTarget()),D.stop(),n.isPresenting=!1,n.dispatchEvent({type:"sessionend"})}this.setFramebufferScaleFactor=function(P){s=P,n.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(P){l=P,n.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return a},this.getSession=function(){return r},this.setSession=async function(P){if(r=P,r!==null){r.addEventListener("select",w),r.addEventListener("selectstart",w),r.addEventListener("selectend",w),r.addEventListener("squeeze",w),r.addEventListener("squeezestart",w),r.addEventListener("squeezeend",w),r.addEventListener("end",b),r.addEventListener("inputsourceschange",M);let I=t.getContextAttributes();if(I.xrCompatible!==!0&&await t.makeXRCompatible(),r.renderState.layers===void 0){let N={antialias:I.antialias,alpha:I.alpha,depth:I.depth,stencil:I.stencil,framebufferScaleFactor:s},G=new XRWebGLLayer(r,t,N);r.updateRenderState({baseLayer:G})}else{let N=0;I.depth&&(N=I.stencil?34041:6402);let G={colorFormat:I.alpha?6408:6407,depthFormat:N,scaleFactor:s};u=new XRWebGLBinding(r,t),h=u.createProjectionLayer(G),d=t.createFramebuffer(),r.updateRenderState({layers:[h]})}a=await r.requestReferenceSpace(l),D.setContext(r),D.start(),n.isPresenting=!0,n.dispatchEvent({type:"sessionstart"})}};function M(P){let I=r.inputSources;for(let N=0;N<f.length;N++)p.set(I[N],f[N]);for(let N=0;N<P.removed.length;N++){let G=P.removed[N],z=p.get(G);z&&(z.dispatchEvent({type:"disconnected",data:G}),p.delete(G))}for(let N=0;N<P.added.length;N++){let G=P.added[N],z=p.get(G);z&&z.dispatchEvent({type:"connected",data:G})}}let S=new le,E=new le;function A(P,I,N){S.setFromMatrixPosition(I.matrixWorld),E.setFromMatrixPosition(N.matrixWorld);let G=S.distanceTo(E),z=I.projectionMatrix.elements,se=N.projectionMatrix.elements,ne=z[14]/(z[10]-1),Q=z[14]/(z[10]+1),j=(z[9]+1)/z[5],O=(z[9]-1)/z[5],ee=(z[8]-1)/z[0],V=(se[8]+1)/se[0],ie=ne*ee,ue=ne*V,ye=G/(-ee+V),pe=ye*-ee;I.matrixWorld.decompose(P.position,P.quaternion,P.scale),P.translateX(pe),P.translateZ(ye),P.matrixWorld.compose(P.position,P.quaternion,P.scale),P.matrixWorldInverse.copy(P.matrixWorld).invert();let xe=ne+ye,X=Q+ye,$=ie-pe,J=ue+(G-pe),ce=j*Q/X*xe,H=O*Q/X*xe;P.projectionMatrix.makePerspective($,J,ce,H,xe,X)}function L(P,I){I===null?P.matrixWorld.copy(P.matrix):P.matrixWorld.multiplyMatrices(I.matrixWorld,P.matrix),P.matrixWorldInverse.copy(P.matrixWorld).invert()}this.updateCamera=function(P){if(r===null)return;m.near=v.near=g.near=P.near,m.far=v.far=g.far=P.far,(x!==m.near||_!==m.far)&&(r.updateRenderState({depthNear:m.near,depthFar:m.far}),x=m.near,_=m.far);let I=P.parent,N=m.cameras;L(m,I);for(let z=0;z<N.length;z++)L(N[z],I);m.matrixWorld.decompose(m.position,m.quaternion,m.scale),P.position.copy(m.position),P.quaternion.copy(m.quaternion),P.scale.copy(m.scale),P.matrix.copy(m.matrix),P.matrixWorld.copy(m.matrixWorld);let G=P.children;for(let z=0,se=G.length;z<se;z++)G[z].updateMatrixWorld(!0);N.length===2?A(m,g,v):m.projectionMatrix.copy(g.projectionMatrix)},this.getCamera=function(){return m};let B=null;function R(P,I){if(c=I.getViewerPose(a),c!==null){let G=c.views,z=r.renderState.baseLayer;r.renderState.layers===void 0&&i.bindXRFramebuffer(z.framebuffer);let se=!1;G.length!==m.cameras.length&&(m.cameras.length=0,se=!0);for(let ne=0;ne<G.length;ne++){let Q=G[ne],j=null;if(r.renderState.layers===void 0)j=z.getViewport(Q);else{let ee=u.getViewSubImage(h,Q);i.bindXRFramebuffer(d),t.framebufferTexture2D(36160,36064,3553,ee.colorTexture,0),ee.depthStencilTexture!==void 0&&t.framebufferTexture2D(36160,36096,3553,ee.depthStencilTexture,0),j=ee.viewport}let O=y[ne];O.matrix.fromArray(Q.transform.matrix),O.projectionMatrix.fromArray(Q.projectionMatrix),O.viewport.set(j.x,j.y,j.width,j.height),ne===0&&m.matrix.copy(O.matrix),se===!0&&m.cameras.push(O)}}let N=r.inputSources;for(let G=0;G<f.length;G++){let z=f[G],se=N[G];z.update(se,I,a)}B&&B(P,I)}let D=new NR;D.setAnimationLoop(R),this.setAnimationLoop=function(P){B=P},this.dispose=function(){}}};function U9(o){function e(y,m){y.fogColor.value.copy(m.color),m.isFog?(y.fogNear.value=m.near,y.fogFar.value=m.far):m.isFogExp2&&(y.fogDensity.value=m.density)}function t(y,m,x,_,w){m.isMeshBasicMaterial?n(y,m):m.isMeshLambertMaterial?(n(y,m),l(y,m)):m.isMeshToonMaterial?(n(y,m),u(y,m)):m.isMeshPhongMaterial?(n(y,m),c(y,m)):m.isMeshStandardMaterial?(n(y,m),m.isMeshPhysicalMaterial?h(y,m,w):d(y,m)):m.isMeshMatcapMaterial?(n(y,m),f(y,m)):m.isMeshDepthMaterial?(n(y,m),p(y,m)):m.isMeshDistanceMaterial?(n(y,m),g(y,m)):m.isMeshNormalMaterial?(n(y,m),v(y,m)):m.isLineBasicMaterial?(i(y,m),m.isLineDashedMaterial&&r(y,m)):m.isPointsMaterial?s(y,m,x,_):m.isSpriteMaterial?a(y,m):m.isShadowMaterial?(y.color.value.copy(m.color),y.opacity.value=m.opacity):m.isShaderMaterial&&(m.uniformsNeedUpdate=!1)}function n(y,m){y.opacity.value=m.opacity,m.color&&y.diffuse.value.copy(m.color),m.emissive&&y.emissive.value.copy(m.emissive).multiplyScalar(m.emissiveIntensity),m.map&&(y.map.value=m.map),m.alphaMap&&(y.alphaMap.value=m.alphaMap),m.specularMap&&(y.specularMap.value=m.specularMap);let x=o.get(m).envMap;if(x){y.envMap.value=x,y.flipEnvMap.value=x.isCubeTexture&&x._needsFlipEnvMap?-1:1,y.reflectivity.value=m.reflectivity,y.refractionRatio.value=m.refractionRatio;let b=o.get(x).__maxMipLevel;b!==void 0&&(y.maxMipLevel.value=b)}m.lightMap&&(y.lightMap.value=m.lightMap,y.lightMapIntensity.value=m.lightMapIntensity),m.aoMap&&(y.aoMap.value=m.aoMap,y.aoMapIntensity.value=m.aoMapIntensity);let _;m.map?_=m.map:m.specularMap?_=m.specularMap:m.displacementMap?_=m.displacementMap:m.normalMap?_=m.normalMap:m.bumpMap?_=m.bumpMap:m.roughnessMap?_=m.roughnessMap:m.metalnessMap?_=m.metalnessMap:m.alphaMap?_=m.alphaMap:m.emissiveMap?_=m.emissiveMap:m.clearcoatMap?_=m.clearcoatMap:m.clearcoatNormalMap?_=m.clearcoatNormalMap:m.clearcoatRoughnessMap&&(_=m.clearcoatRoughnessMap),_!==void 0&&(_.isWebGLRenderTarget&&(_=_.texture),_.matrixAutoUpdate===!0&&_.updateMatrix(),y.uvTransform.value.copy(_.matrix));let w;m.aoMap?w=m.aoMap:m.lightMap&&(w=m.lightMap),w!==void 0&&(w.isWebGLRenderTarget&&(w=w.texture),w.matrixAutoUpdate===!0&&w.updateMatrix(),y.uv2Transform.value.copy(w.matrix))}function i(y,m){y.diffuse.value.copy(m.color),y.opacity.value=m.opacity}function r(y,m){y.dashSize.value=m.dashSize,y.totalSize.value=m.dashSize+m.gapSize,y.scale.value=m.scale}function s(y,m,x,_){y.diffuse.value.copy(m.color),y.opacity.value=m.opacity,y.size.value=m.size*x,y.scale.value=_*.5,m.map&&(y.map.value=m.map),m.alphaMap&&(y.alphaMap.value=m.alphaMap);let w;m.map?w=m.map:m.alphaMap&&(w=m.alphaMap),w!==void 0&&(w.matrixAutoUpdate===!0&&w.updateMatrix(),y.uvTransform.value.copy(w.matrix))}function a(y,m){y.diffuse.value.copy(m.color),y.opacity.value=m.opacity,y.rotation.value=m.rotation,m.map&&(y.map.value=m.map),m.alphaMap&&(y.alphaMap.value=m.alphaMap);let x;m.map?x=m.map:m.alphaMap&&(x=m.alphaMap),x!==void 0&&(x.matrixAutoUpdate===!0&&x.updateMatrix(),y.uvTransform.value.copy(x.matrix))}function l(y,m){m.emissiveMap&&(y.emissiveMap.value=m.emissiveMap)}function c(y,m){y.specular.value.copy(m.specular),y.shininess.value=Math.max(m.shininess,1e-4),m.emissiveMap&&(y.emissiveMap.value=m.emissiveMap),m.bumpMap&&(y.bumpMap.value=m.bumpMap,y.bumpScale.value=m.bumpScale,m.side===Ln&&(y.bumpScale.value*=-1)),m.normalMap&&(y.normalMap.value=m.normalMap,y.normalScale.value.copy(m.normalScale),m.side===Ln&&y.normalScale.value.negate()),m.displacementMap&&(y.displacementMap.value=m.displacementMap,y.displacementScale.value=m.displacementScale,y.displacementBias.value=m.displacementBias)}function u(y,m){m.gradientMap&&(y.gradientMap.value=m.gradientMap),m.emissiveMap&&(y.emissiveMap.value=m.emissiveMap),m.bumpMap&&(y.bumpMap.value=m.bumpMap,y.bumpScale.value=m.bumpScale,m.side===Ln&&(y.bumpScale.value*=-1)),m.normalMap&&(y.normalMap.value=m.normalMap,y.normalScale.value.copy(m.normalScale),m.side===Ln&&y.normalScale.value.negate()),m.displacementMap&&(y.displacementMap.value=m.displacementMap,y.displacementScale.value=m.displacementScale,y.displacementBias.value=m.displacementBias)}function d(y,m){y.roughness.value=m.roughness,y.metalness.value=m.metalness,m.roughnessMap&&(y.roughnessMap.value=m.roughnessMap),m.metalnessMap&&(y.metalnessMap.value=m.metalnessMap),m.emissiveMap&&(y.emissiveMap.value=m.emissiveMap),m.bumpMap&&(y.bumpMap.value=m.bumpMap,y.bumpScale.value=m.bumpScale,m.side===Ln&&(y.bumpScale.value*=-1)),m.normalMap&&(y.normalMap.value=m.normalMap,y.normalScale.value.copy(m.normalScale),m.side===Ln&&y.normalScale.value.negate()),m.displacementMap&&(y.displacementMap.value=m.displacementMap,y.displacementScale.value=m.displacementScale,y.displacementBias.value=m.displacementBias),o.get(m).envMap&&(y.envMapIntensity.value=m.envMapIntensity)}function h(y,m,x){d(y,m),y.reflectivity.value=m.reflectivity,y.clearcoat.value=m.clearcoat,y.clearcoatRoughness.value=m.clearcoatRoughness,m.sheen&&y.sheen.value.copy(m.sheen),m.clearcoatMap&&(y.clearcoatMap.value=m.clearcoatMap),m.clearcoatRoughnessMap&&(y.clearcoatRoughnessMap.value=m.clearcoatRoughnessMap),m.clearcoatNormalMap&&(y.clearcoatNormalScale.value.copy(m.clearcoatNormalScale),y.clearcoatNormalMap.value=m.clearcoatNormalMap,m.side===Ln&&y.clearcoatNormalScale.value.negate()),y.transmission.value=m.transmission,m.transmissionMap&&(y.transmissionMap.value=m.transmissionMap),m.transmission>0&&(y.transmissionSamplerMap.value=x.texture,y.transmissionSamplerSize.value.set(x.width,x.height)),y.thickness.value=m.thickness,m.thicknessMap&&(y.thicknessMap.value=m.thicknessMap),y.attenuationDistance.value=m.attenuationDistance,y.attenuationColor.value.copy(m.attenuationColor)}function f(y,m){m.matcap&&(y.matcap.value=m.matcap),m.bumpMap&&(y.bumpMap.value=m.bumpMap,y.bumpScale.value=m.bumpScale,m.side===Ln&&(y.bumpScale.value*=-1)),m.normalMap&&(y.normalMap.value=m.normalMap,y.normalScale.value.copy(m.normalScale),m.side===Ln&&y.normalScale.value.negate()),m.displacementMap&&(y.displacementMap.value=m.displacementMap,y.displacementScale.value=m.displacementScale,y.displacementBias.value=m.displacementBias)}function p(y,m){m.displacementMap&&(y.displacementMap.value=m.displacementMap,y.displacementScale.value=m.displacementScale,y.displacementBias.value=m.displacementBias)}function g(y,m){m.displacementMap&&(y.displacementMap.value=m.displacementMap,y.displacementScale.value=m.displacementScale,y.displacementBias.value=m.displacementBias),y.referencePosition.value.copy(m.referencePosition),y.nearDistance.value=m.nearDistance,y.farDistance.value=m.farDistance}function v(y,m){m.bumpMap&&(y.bumpMap.value=m.bumpMap,y.bumpScale.value=m.bumpScale,m.side===Ln&&(y.bumpScale.value*=-1)),m.normalMap&&(y.normalMap.value=m.normalMap,y.normalScale.value.copy(m.normalScale),m.side===Ln&&y.normalScale.value.negate()),m.displacementMap&&(y.displacementMap.value=m.displacementMap,y.displacementScale.value=m.displacementScale,y.displacementBias.value=m.displacementBias)}return{refreshFogUniforms:e,refreshMaterialUniforms:t}}function H9(){let o=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");return o.style.display="block",o}function Ut(o={}){let e=o.canvas!==void 0?o.canvas:H9(),t=o.context!==void 0?o.context:null,n=o.alpha!==void 0?o.alpha:!1,i=o.depth!==void 0?o.depth:!0,r=o.stencil!==void 0?o.stencil:!0,s=o.antialias!==void 0?o.antialias:!1,a=o.premultipliedAlpha!==void 0?o.premultipliedAlpha:!0,l=o.preserveDrawingBuffer!==void 0?o.preserveDrawingBuffer:!1,c=o.powerPreference!==void 0?o.powerPreference:"default",u=o.failIfMajorPerformanceCaveat!==void 0?o.failIfMajorPerformanceCaveat:!1,d=null,h=null,f=[],p=[];this.domElement=e,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.gammaFactor=2,this.outputEncoding=ah,this.physicallyCorrectLights=!1,this.toneMapping=nh,this.toneMappingExposure=1;let g=this,v=!1,y=0,m=0,x=null,_=-1,w=null,b=new Nt,M=new Nt,S=null,E=e.width,A=e.height,L=1,B=null,R=null,D=new Nt(0,0,E,A),P=new Nt(0,0,E,A),I=!1,N=[],G=new hp,z=!1,se=!1,ne=null,Q=new Qe,j=new le,O={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function ee(){return x===null?L:1}let V=t;function ie(F,q){for(let Y=0;Y<F.length;Y++){let te=F[Y],fe=e.getContext(te,q);if(fe!==null)return fe}return null}try{let F={alpha:n,depth:i,stencil:r,antialias:s,premultipliedAlpha:a,preserveDrawingBuffer:l,powerPreference:c,failIfMajorPerformanceCaveat:u};if(e.addEventListener("webglcontextlost",We,!1),e.addEventListener("webglcontextrestored",ve,!1),V===null){let q=["webgl2","webgl","experimental-webgl"];if(g.isWebGL1Renderer===!0&&q.shift(),V=ie(q,F),V===null)throw ie(q)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}V.getShaderPrecisionFormat===void 0&&(V.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(F){throw console.error("THREE.WebGLRenderer: "+F.message),F}let ue,ye,pe,xe,X,$,J,ce,H,T,C,W,Z,he,me,Ee,Se,oe,ge,k,de,K;function be(){ue=new h7(V),ye=new l7(V,ue,o),ue.init(ye),de=new k9(V,ue,ye),pe=new N9(V,ue,ye),N[0]=1029,xe=new p7(V),X=new T9,$=new O9(V,ue,pe,X,ye,de,xe),J=new u7(g),ce=new OW(V,ye),K=new o7(V,ue,ce,ye),H=new d7(V,ce,xe,K),T=new v7(V,H,ce,xe),oe=new y7(V),me=new c7(X),C=new S9(g,J,ue,ye,K,me),W=new U9(X),Z=new A9(X),he=new D9(ue,ye),Se=new s7(g,J,pe,T,a),Ee=new sP(g,T,ye),ge=new a7(V,ue,xe,ye),k=new f7(V,ue,xe,ye),xe.programs=C.programs,g.capabilities=ye,g.extensions=ue,g.properties=X,g.renderLists=Z,g.shadowMap=Ee,g.state=pe,g.info=xe}be();let we=new oP(g,V);this.xr=we,this.getContext=function(){return V},this.getContextAttributes=function(){return V.getContextAttributes()},this.forceContextLoss=function(){let F=ue.get("WEBGL_lose_context");F&&F.loseContext()},this.forceContextRestore=function(){let F=ue.get("WEBGL_lose_context");F&&F.restoreContext()},this.getPixelRatio=function(){return L},this.setPixelRatio=function(F){F!==void 0&&(L=F,this.setSize(E,A,!1))},this.getSize=function(F){return F.set(E,A)},this.setSize=function(F,q,Y){if(we.isPresenting){console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting.");return}E=F,A=q,e.width=Math.floor(F*L),e.height=Math.floor(q*L),Y!==!1&&(e.style.width=F+"px",e.style.height=q+"px"),this.setViewport(0,0,F,q)},this.getDrawingBufferSize=function(F){return F.set(E*L,A*L).floor()},this.setDrawingBufferSize=function(F,q,Y){E=F,A=q,L=Y,e.width=Math.floor(F*Y),e.height=Math.floor(q*Y),this.setViewport(0,0,F,q)},this.getCurrentViewport=function(F){return F.copy(b)},this.getViewport=function(F){return F.copy(D)},this.setViewport=function(F,q,Y,te){F.isVector4?D.set(F.x,F.y,F.z,F.w):D.set(F,q,Y,te),pe.viewport(b.copy(D).multiplyScalar(L).floor())},this.getScissor=function(F){return F.copy(P)},this.setScissor=function(F,q,Y,te){F.isVector4?P.set(F.x,F.y,F.z,F.w):P.set(F,q,Y,te),pe.scissor(M.copy(P).multiplyScalar(L).floor())},this.getScissorTest=function(){return I},this.setScissorTest=function(F){pe.setScissorTest(I=F)},this.setOpaqueSort=function(F){B=F},this.setTransparentSort=function(F){R=F},this.getClearColor=function(F){return F.copy(Se.getClearColor())},this.setClearColor=function(){Se.setClearColor.apply(Se,arguments)},this.getClearAlpha=function(){return Se.getClearAlpha()},this.setClearAlpha=function(){Se.setClearAlpha.apply(Se,arguments)},this.clear=function(F,q,Y){let te=0;(F===void 0||F)&&(te|=16384),(q===void 0||q)&&(te|=256),(Y===void 0||Y)&&(te|=1024),V.clear(te)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){e.removeEventListener("webglcontextlost",We,!1),e.removeEventListener("webglcontextrestored",ve,!1),Z.dispose(),he.dispose(),X.dispose(),J.dispose(),T.dispose(),K.dispose(),we.dispose(),we.removeEventListener("sessionstart",ii),we.removeEventListener("sessionend",In),ne&&(ne.dispose(),ne=null),Bt.stop()};function We(F){F.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),v=!0}function ve(){console.log("THREE.WebGLRenderer: Context Restored."),v=!1;let F=xe.autoReset,q=Ee.enabled,Y=Ee.autoUpdate,te=Ee.needsUpdate,fe=Ee.type;be(),xe.autoReset=F,Ee.enabled=q,Ee.autoUpdate=Y,Ee.needsUpdate=te,Ee.type=fe}function Be(F){let q=F.target;q.removeEventListener("dispose",Be),nt(q)}function nt(F){Xe(F),X.remove(F)}function Xe(F){let q=X.get(F).programs;q!==void 0&&q.forEach(function(Y){C.releaseProgram(Y)})}function _t(F,q){F.render(function(Y){g.renderBufferImmediate(Y,q)})}this.renderBufferImmediate=function(F,q){K.initAttributes();let Y=X.get(F);F.hasPositions&&!Y.position&&(Y.position=V.createBuffer()),F.hasNormals&&!Y.normal&&(Y.normal=V.createBuffer()),F.hasUvs&&!Y.uv&&(Y.uv=V.createBuffer()),F.hasColors&&!Y.color&&(Y.color=V.createBuffer());let te=q.getAttributes();F.hasPositions&&(V.bindBuffer(34962,Y.position),V.bufferData(34962,F.positionArray,35048),K.enableAttribute(te.position),V.vertexAttribPointer(te.position,3,5126,!1,0,0)),F.hasNormals&&(V.bindBuffer(34962,Y.normal),V.bufferData(34962,F.normalArray,35048),K.enableAttribute(te.normal),V.vertexAttribPointer(te.normal,3,5126,!1,0,0)),F.hasUvs&&(V.bindBuffer(34962,Y.uv),V.bufferData(34962,F.uvArray,35048),K.enableAttribute(te.uv),V.vertexAttribPointer(te.uv,2,5126,!1,0,0)),F.hasColors&&(V.bindBuffer(34962,Y.color),V.bufferData(34962,F.colorArray,35048),K.enableAttribute(te.color),V.vertexAttribPointer(te.color,3,5126,!1,0,0)),K.disableUnusedAttributes(),V.drawArrays(4,0,F.count),F.count=0},this.renderBufferDirect=function(F,q,Y,te,fe,Fe){q===null&&(q=O);let Le=fe.isMesh&&fe.matrixWorld.determinant()<0,Te=re(F,q,te,fe);pe.setMaterial(te,Le);let Re=Y.index,Ae=Y.attributes.position;if(Re===null){if(Ae===void 0||Ae.count===0)return}else if(Re.count===0)return;let ze=1;te.wireframe===!0&&(Re=H.getWireframeAttribute(Y),ze=2),(te.morphTargets||te.morphNormals)&&oe.update(fe,Y,te,Te),K.setup(fe,te,Te,Y,Re);let Ie,je=ge;Re!==null&&(Ie=ce.get(Re),je=k,je.setIndex(Ie));let rt=Re!==null?Re.count:Ae.count,at=Y.drawRange.start*ze,dt=Y.drawRange.count*ze,Ke=Fe!==null?Fe.start*ze:0,Ct=Fe!==null?Fe.count*ze:1/0,it=Math.max(at,Ke),Wd=Math.min(rt,at+dt,Ke+Ct)-1,Ys=Math.max(0,Wd-it+1);if(Ys!==0){if(fe.isMesh)te.wireframe===!0?(pe.setLineWidth(te.wireframeLinewidth*ee()),je.setMode(1)):je.setMode(4);else if(fe.isLine){let Ir=te.linewidth;Ir===void 0&&(Ir=1),pe.setLineWidth(Ir*ee()),fe.isLineSegments?je.setMode(1):fe.isLineLoop?je.setMode(2):je.setMode(3)}else fe.isPoints?je.setMode(0):fe.isSprite&&je.setMode(4);if(fe.isInstancedMesh)je.renderInstances(it,Ys,fe.count);else if(Y.isInstancedBufferGeometry){let Ir=Math.min(Y.instanceCount,Y._maxInstanceCount);je.renderInstances(it,Ys,Ir)}else je.render(it,Ys)}},this.compile=function(F,q){h=he.get(F),h.init(),F.traverseVisible(function(Y){Y.isLight&&Y.layers.test(q.layers)&&(h.pushLight(Y),Y.castShadow&&h.pushShadow(Y))}),h.setupLights(),F.traverse(function(Y){let te=Y.material;if(te)if(Array.isArray(te))for(let fe=0;fe<te.length;fe++){let Fe=te[fe];js(Fe,F,Y)}else js(te,F,Y)})};let wt=null;function Pr(F){wt&&wt(F)}function ii(){Bt.stop()}function In(){Bt.start()}let Bt=new NR;Bt.setAnimationLoop(Pr),typeof window!="undefined"&&Bt.setContext(window),this.setAnimationLoop=function(F){wt=F,we.setAnimationLoop(F),F===null?Bt.stop():Bt.start()},we.addEventListener("sessionstart",ii),we.addEventListener("sessionend",In),this.render=function(F,q){if(q!==void 0&&q.isCamera!==!0){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(v===!0)return;F.autoUpdate===!0&&F.updateMatrixWorld(),q.parent===null&&q.updateMatrixWorld(),we.enabled===!0&&we.isPresenting===!0&&(we.cameraAutoUpdate===!0&&we.updateCamera(q),q=we.getCamera()),F.isScene===!0&&F.onBeforeRender(g,F,q,x),h=he.get(F,p.length),h.init(),p.push(h),Q.multiplyMatrices(q.projectionMatrix,q.matrixWorldInverse),G.setFromProjectionMatrix(Q),se=this.localClippingEnabled,z=me.init(this.clippingPlanes,se,q),d=Z.get(F,f.length),d.init(),f.push(d),Wo(F,q,0,g.sortObjects),d.finish(),g.sortObjects===!0&&d.sort(B,R),z===!0&&me.beginShadows();let Y=h.state.shadowsArray;Ee.render(Y,F,q),h.setupLights(),h.setupLightsView(q),z===!0&&me.endShadows(),this.info.autoReset===!0&&this.info.reset(),Se.render(d,F);let te=d.opaque,fe=d.transmissive,Fe=d.transparent;te.length>0&&cr(te,F,q),fe.length>0&&vl(te,fe,F,q),Fe.length>0&&cr(Fe,F,q),x!==null&&($.updateMultisampleRenderTarget(x),$.updateRenderTargetMipmap(x)),F.isScene===!0&&F.onAfterRender(g,F,q),pe.buffers.depth.setTest(!0),pe.buffers.depth.setMask(!0),pe.buffers.color.setMask(!0),pe.setPolygonOffset(!1),K.resetDefaultState(),_=-1,w=null,p.pop(),p.length>0?h=p[p.length-1]:h=null,f.pop(),f.length>0?d=f[f.length-1]:d=null};function Wo(F,q,Y,te){if(F.visible===!1)return;if(F.layers.test(q.layers)){if(F.isGroup)Y=F.renderOrder;else if(F.isLOD)F.autoUpdate===!0&&F.update(q);else if(F.isLight)h.pushLight(F),F.castShadow&&h.pushShadow(F);else if(F.isSprite){if(!F.frustumCulled||G.intersectsSprite(F)){te&&j.setFromMatrixPosition(F.matrixWorld).applyMatrix4(Q);let Le=T.update(F),Te=F.material;Te.visible&&d.push(F,Le,Te,Y,j.z,null)}}else if(F.isImmediateRenderObject)te&&j.setFromMatrixPosition(F.matrixWorld).applyMatrix4(Q),d.push(F,null,F.material,Y,j.z,null);else if((F.isMesh||F.isLine||F.isPoints)&&(F.isSkinnedMesh&&F.skeleton.frame!==xe.render.frame&&(F.skeleton.update(),F.skeleton.frame=xe.render.frame),!F.frustumCulled||G.intersectsObject(F))){te&&j.setFromMatrixPosition(F.matrixWorld).applyMatrix4(Q);let Le=T.update(F),Te=F.material;if(Array.isArray(Te)){let Re=Le.groups;for(let Ae=0,ze=Re.length;Ae<ze;Ae++){let Ie=Re[Ae],je=Te[Ie.materialIndex];je&&je.visible&&d.push(F,Le,je,Y,j.z,Ie)}}else Te.visible&&d.push(F,Le,Te,Y,j.z,null)}}let Fe=F.children;for(let Le=0,Te=Fe.length;Le<Te;Le++)Wo(Fe[Le],q,Y,te)}function vl(F,q,Y,te){if(ne===null){let Te=s===!0&&ye.isWebGL2===!0?Ub:Ls;ne=new Te(1024,1024,{generateMipmaps:!0,type:de.convert(ih)!==null?ih:zy,minFilter:ky,magFilter:hi,wrapS:Ki,wrapT:Ki})}let fe=g.getRenderTarget();g.setRenderTarget(ne),g.clear();let Fe=g.toneMapping;g.toneMapping=nh,cr(F,Y,te),g.toneMapping=Fe,$.updateMultisampleRenderTarget(ne),$.updateRenderTargetMipmap(ne),g.setRenderTarget(fe),cr(q,Y,te)}function cr(F,q,Y){let te=q.isScene===!0?q.overrideMaterial:null;for(let fe=0,Fe=F.length;fe<Fe;fe++){let Le=F[fe],Te=Le.object,Re=Le.geometry,Ae=te===null?Le.material:te,ze=Le.group;if(Y.isArrayCamera){let Ie=Y.cameras;for(let je=0,rt=Ie.length;je<rt;je++){let at=Ie[je];Te.layers.test(at.layers)&&(pe.viewport(b.copy(at.viewport)),h.setupLightsView(at),Xo(Te,q,at,Re,Ae,ze))}}else Xo(Te,q,Y,Re,Ae,ze)}}function Xo(F,q,Y,te,fe,Fe){if(F.onBeforeRender(g,q,Y,te,fe,Fe),F.modelViewMatrix.multiplyMatrices(Y.matrixWorldInverse,F.matrixWorld),F.normalMatrix.getNormalMatrix(F.modelViewMatrix),F.isImmediateRenderObject){let Le=re(Y,q,fe,F);pe.setMaterial(fe),K.reset(),_t(F,Le)}else fe.transparent===!0&&fe.side===Sa?(fe.side=Ln,fe.needsUpdate=!0,g.renderBufferDirect(Y,q,te,fe,F,Fe),fe.side=Kf,fe.needsUpdate=!0,g.renderBufferDirect(Y,q,te,fe,F,Fe),fe.side=Sa):g.renderBufferDirect(Y,q,te,fe,F,Fe);F.onAfterRender(g,q,Y,te,fe,Fe)}function js(F,q,Y){q.isScene!==!0&&(q=O);let te=X.get(F),fe=h.state.lights,Fe=h.state.shadowsArray,Le=fe.state.version,Te=C.getParameters(F,fe.state,Fe,q,Y),Re=C.getProgramCacheKey(Te),Ae=te.programs;te.environment=F.isMeshStandardMaterial?q.environment:null,te.fog=q.fog,te.envMap=J.get(F.envMap||te.environment),Ae===void 0&&(F.addEventListener("dispose",Be),Ae=new Map,te.programs=Ae);let ze=Ae.get(Re);if(ze!==void 0){if(te.currentProgram===ze&&te.lightsStateVersion===Le)return xl(F,Te),ze}else Te.uniforms=C.getUniforms(F),F.onBuild(Te,g),F.onBeforeCompile(Te,g),ze=C.acquireProgram(Te,Re),Ae.set(Re,ze),te.uniforms=Te.uniforms;let Ie=te.uniforms;(!F.isShaderMaterial&&!F.isRawShaderMaterial||F.clipping===!0)&&(Ie.clippingPlanes=me.uniform),xl(F,Te),te.needsLights=Me(F),te.lightsStateVersion=Le,te.needsLights&&(Ie.ambientLightColor.value=fe.state.ambient,Ie.lightProbe.value=fe.state.probe,Ie.directionalLights.value=fe.state.directional,Ie.directionalLightShadows.value=fe.state.directionalShadow,Ie.spotLights.value=fe.state.spot,Ie.spotLightShadows.value=fe.state.spotShadow,Ie.rectAreaLights.value=fe.state.rectArea,Ie.ltc_1.value=fe.state.rectAreaLTC1,Ie.ltc_2.value=fe.state.rectAreaLTC2,Ie.pointLights.value=fe.state.point,Ie.pointLightShadows.value=fe.state.pointShadow,Ie.hemisphereLights.value=fe.state.hemi,Ie.directionalShadowMap.value=fe.state.directionalShadowMap,Ie.directionalShadowMatrix.value=fe.state.directionalShadowMatrix,Ie.spotShadowMap.value=fe.state.spotShadowMap,Ie.spotShadowMatrix.value=fe.state.spotShadowMatrix,Ie.pointShadowMap.value=fe.state.pointShadowMap,Ie.pointShadowMatrix.value=fe.state.pointShadowMatrix);let je=ze.getUniforms(),rt=Ba.seqWithValue(je.seq,Ie);return te.currentProgram=ze,te.uniformsList=rt,ze}function xl(F,q){let Y=X.get(F);Y.outputEncoding=q.outputEncoding,Y.instancing=q.instancing,Y.skinning=q.skinning,Y.numClippingPlanes=q.numClippingPlanes,Y.numIntersection=q.numClipIntersection,Y.vertexAlphas=q.vertexAlphas}function re(F,q,Y,te){q.isScene!==!0&&(q=O),$.resetTextureUnits();let fe=q.fog,Fe=Y.isMeshStandardMaterial?q.environment:null,Le=x===null?g.outputEncoding:x.texture.encoding,Te=J.get(Y.envMap||Fe),Re=Y.vertexColors===!0&&te.geometry&&te.geometry.attributes.color&&te.geometry.attributes.color.itemSize===4,Ae=X.get(Y),ze=h.state.lights;if(z===!0&&(se===!0||F!==w)){let it=F===w&&Y.id===_;me.setState(Y,F,it)}let Ie=!1;Y.version===Ae.__version?(Ae.needsLights&&Ae.lightsStateVersion!==ze.state.version||Ae.outputEncoding!==Le||te.isInstancedMesh&&Ae.instancing===!1||!te.isInstancedMesh&&Ae.instancing===!0||te.isSkinnedMesh&&Ae.skinning===!1||!te.isSkinnedMesh&&Ae.skinning===!0||Ae.envMap!==Te||Y.fog&&Ae.fog!==fe||Ae.numClippingPlanes!==void 0&&(Ae.numClippingPlanes!==me.numPlanes||Ae.numIntersection!==me.numIntersection)||Ae.vertexAlphas!==Re)&&(Ie=!0):(Ie=!0,Ae.__version=Y.version);let je=Ae.currentProgram;Ie===!0&&(je=js(Y,q,te));let rt=!1,at=!1,dt=!1,Ke=je.getUniforms(),Ct=Ae.uniforms;if(pe.useProgram(je.program)&&(rt=!0,at=!0,dt=!0),Y.id!==_&&(_=Y.id,at=!0),rt||w!==F){if(Ke.setValue(V,"projectionMatrix",F.projectionMatrix),ye.logarithmicDepthBuffer&&Ke.setValue(V,"logDepthBufFC",2/(Math.log(F.far+1)/Math.LN2)),w!==F&&(w=F,at=!0,dt=!0),Y.isShaderMaterial||Y.isMeshPhongMaterial||Y.isMeshToonMaterial||Y.isMeshStandardMaterial||Y.envMap){let it=Ke.map.cameraPosition;it!==void 0&&it.setValue(V,j.setFromMatrixPosition(F.matrixWorld))}(Y.isMeshPhongMaterial||Y.isMeshToonMaterial||Y.isMeshLambertMaterial||Y.isMeshBasicMaterial||Y.isMeshStandardMaterial||Y.isShaderMaterial)&&Ke.setValue(V,"isOrthographic",F.isOrthographicCamera===!0),(Y.isMeshPhongMaterial||Y.isMeshToonMaterial||Y.isMeshLambertMaterial||Y.isMeshBasicMaterial||Y.isMeshStandardMaterial||Y.isShaderMaterial||Y.isShadowMaterial||te.isSkinnedMesh)&&Ke.setValue(V,"viewMatrix",F.matrixWorldInverse)}if(te.isSkinnedMesh){Ke.setOptional(V,te,"bindMatrix"),Ke.setOptional(V,te,"bindMatrixInverse");let it=te.skeleton;it&&(ye.floatVertexTextures?(it.boneTexture===null&&it.computeBoneTexture(),Ke.setValue(V,"boneTexture",it.boneTexture,$),Ke.setValue(V,"boneTextureSize",it.boneTextureSize)):Ke.setOptional(V,it,"boneMatrices"))}return(at||Ae.receiveShadow!==te.receiveShadow)&&(Ae.receiveShadow=te.receiveShadow,Ke.setValue(V,"receiveShadow",te.receiveShadow)),at&&(Ke.setValue(V,"toneMappingExposure",g.toneMappingExposure),Ae.needsLights&&Ce(Ct,dt),fe&&Y.fog&&W.refreshFogUniforms(Ct,fe),W.refreshMaterialUniforms(Ct,Y,L,A,ne),Ba.upload(V,Ae.uniformsList,Ct,$)),Y.isShaderMaterial&&Y.uniformsNeedUpdate===!0&&(Ba.upload(V,Ae.uniformsList,Ct,$),Y.uniformsNeedUpdate=!1),Y.isSpriteMaterial&&Ke.setValue(V,"center",te.center),Ke.setValue(V,"modelViewMatrix",te.modelViewMatrix),Ke.setValue(V,"normalMatrix",te.normalMatrix),Ke.setValue(V,"modelMatrix",te.matrixWorld),je}function Ce(F,q){F.ambientLightColor.needsUpdate=q,F.lightProbe.needsUpdate=q,F.directionalLights.needsUpdate=q,F.directionalLightShadows.needsUpdate=q,F.pointLights.needsUpdate=q,F.pointLightShadows.needsUpdate=q,F.spotLights.needsUpdate=q,F.spotLightShadows.needsUpdate=q,F.rectAreaLights.needsUpdate=q,F.hemisphereLights.needsUpdate=q}function Me(F){return F.isMeshLambertMaterial||F.isMeshToonMaterial||F.isMeshPhongMaterial||F.isMeshStandardMaterial||F.isShadowMaterial||F.isShaderMaterial&&F.lights===!0}this.getActiveCubeFace=function(){return y},this.getActiveMipmapLevel=function(){return m},this.getRenderTarget=function(){return x},this.setRenderTarget=function(F,q=0,Y=0){x=F,y=q,m=Y,F&&X.get(F).__webglFramebuffer===void 0&&$.setupRenderTarget(F);let te=null,fe=!1,Fe=!1;if(F){let Te=F.texture;(Te.isDataTexture3D||Te.isDataTexture2DArray)&&(Fe=!0);let Re=X.get(F).__webglFramebuffer;F.isWebGLCubeRenderTarget?(te=Re[q],fe=!0):F.isWebGLMultisampleRenderTarget?te=X.get(F).__webglMultisampledFramebuffer:te=Re,b.copy(F.viewport),M.copy(F.scissor),S=F.scissorTest}else b.copy(D).multiplyScalar(L).floor(),M.copy(P).multiplyScalar(L).floor(),S=I;if(pe.bindFramebuffer(36160,te)&&ye.drawBuffers){let Te=!1;if(F)if(F.isWebGLMultipleRenderTargets){let Re=F.texture;if(N.length!==Re.length||N[0]!==36064){for(let Ae=0,ze=Re.length;Ae<ze;Ae++)N[Ae]=36064+Ae;N.length=Re.length,Te=!0}}else(N.length!==1||N[0]!==36064)&&(N[0]=36064,N.length=1,Te=!0);else(N.length!==1||N[0]!==1029)&&(N[0]=1029,N.length=1,Te=!0);Te&&(ye.isWebGL2?V.drawBuffers(N):ue.get("WEBGL_draw_buffers").drawBuffersWEBGL(N))}if(pe.viewport(b),pe.scissor(M),pe.setScissorTest(S),fe){let Te=X.get(F.texture);V.framebufferTexture2D(36160,36064,34069+q,Te.__webglTexture,Y)}else if(Fe){let Te=X.get(F.texture),Re=q||0;V.framebufferTextureLayer(36160,36064,Te.__webglTexture,Y||0,Re)}},this.readRenderTargetPixels=function(F,q,Y,te,fe,Fe,Le){if(!(F&&F.isWebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}let Te=X.get(F).__webglFramebuffer;if(F.isWebGLCubeRenderTarget&&Le!==void 0&&(Te=Te[Le]),Te){pe.bindFramebuffer(36160,Te);try{let Re=F.texture,Ae=Re.format,ze=Re.type;if(Ae!==Cs&&de.convert(Ae)!==V.getParameter(35739)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}let Ie=ze===ih&&(ue.has("EXT_color_buffer_half_float")||ye.isWebGL2&&ue.has("EXT_color_buffer_float"));if(ze!==zy&&de.convert(ze)!==V.getParameter(35738)&&!(ze===Zl&&(ye.isWebGL2||ue.has("OES_texture_float")||ue.has("WEBGL_color_buffer_float")))&&!Ie){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}V.checkFramebufferStatus(36160)===36053?q>=0&&q<=F.width-te&&Y>=0&&Y<=F.height-fe&&V.readPixels(q,Y,te,fe,de.convert(Ae),de.convert(ze),Fe):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.")}finally{let Re=x!==null?X.get(x).__webglFramebuffer:null;pe.bindFramebuffer(36160,Re)}}},this.copyFramebufferToTexture=function(F,q,Y=0){let te=Math.pow(2,-Y),fe=Math.floor(q.image.width*te),Fe=Math.floor(q.image.height*te),Le=de.convert(q.format);ye.isWebGL2&&(Le===6407&&(Le=32849),Le===6408&&(Le=32856)),$.setTexture2D(q,0),V.copyTexImage2D(3553,Y,Le,F.x,F.y,fe,Fe,0),pe.unbindTexture()},this.copyTextureToTexture=function(F,q,Y,te=0){let fe=q.image.width,Fe=q.image.height,Le=de.convert(Y.format),Te=de.convert(Y.type);$.setTexture2D(Y,0),V.pixelStorei(37440,Y.flipY),V.pixelStorei(37441,Y.premultiplyAlpha),V.pixelStorei(3317,Y.unpackAlignment),q.isDataTexture?V.texSubImage2D(3553,te,F.x,F.y,fe,Fe,Le,Te,q.image.data):q.isCompressedTexture?V.compressedTexSubImage2D(3553,te,F.x,F.y,q.mipmaps[0].width,q.mipmaps[0].height,Le,q.mipmaps[0].data):V.texSubImage2D(3553,te,F.x,F.y,Le,Te,q.image),te===0&&Y.generateMipmaps&&V.generateMipmap(3553),pe.unbindTexture()},this.copyTextureToTexture3D=function(F,q,Y,te,fe=0){if(g.isWebGL1Renderer){console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");return}let Fe=F.max.x-F.min.x+1,Le=F.max.y-F.min.y+1,Te=F.max.z-F.min.z+1,Re=de.convert(te.format),Ae=de.convert(te.type),ze;if(te.isDataTexture3D)$.setTexture3D(te,0),ze=32879;else if(te.isDataTexture2DArray)$.setTexture2DArray(te,0),ze=35866;else{console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");return}V.pixelStorei(37440,te.flipY),V.pixelStorei(37441,te.premultiplyAlpha),V.pixelStorei(3317,te.unpackAlignment);let Ie=V.getParameter(3314),je=V.getParameter(32878),rt=V.getParameter(3316),at=V.getParameter(3315),dt=V.getParameter(32877),Ke=Y.isCompressedTexture?Y.mipmaps[0]:Y.image;V.pixelStorei(3314,Ke.width),V.pixelStorei(32878,Ke.height),V.pixelStorei(3316,F.min.x),V.pixelStorei(3315,F.min.y),V.pixelStorei(32877,F.min.z),Y.isDataTexture||Y.isDataTexture3D?V.texSubImage3D(ze,fe,q.x,q.y,q.z,Fe,Le,Te,Re,Ae,Ke.data):Y.isCompressedTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),V.compressedTexSubImage3D(ze,fe,q.x,q.y,q.z,Fe,Le,Te,Re,Ke.data)):V.texSubImage3D(ze,fe,q.x,q.y,q.z,Fe,Le,Te,Re,Ae,Ke),V.pixelStorei(3314,Ie),V.pixelStorei(32878,je),V.pixelStorei(3316,rt),V.pixelStorei(3315,at),V.pixelStorei(32877,dt),fe===0&&te.generateMipmaps&&V.generateMipmap(ze),pe.unbindTexture()},this.initTexture=function(F){$.setTexture2D(F,0),pe.unbindTexture()},this.resetState=function(){y=0,m=0,x=null,pe.reset(),K.reset()},typeof __THREE_DEVTOOLS__!="undefined"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}var aP=class extends Ut{};aP.prototype.isWebGL1Renderer=!0;var f0=class{constructor(e,t=25e-5){this.name="",this.color=new Je(e),this.density=t}clone(){return new f0(this.color,this.density)}toJSON(){return{type:"FogExp2",color:this.color.getHex(),density:this.density}}};f0.prototype.isFogExp2=!0;var p0=class{constructor(e,t=1,n=1e3){this.name="",this.color=new Je(e),this.near=t,this.far=n}clone(){return new p0(this.color,this.near,this.far)}toJSON(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}}};p0.prototype.isFog=!0;var xM=class extends Tt{constructor(){super();this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0,typeof __THREE_DEVTOOLS__!="undefined"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),e.background!==null&&(this.background=e.background.clone()),e.environment!==null&&(this.environment=e.environment.clone()),e.fog!==null&&(this.fog=e.fog.clone()),e.overrideMaterial!==null&&(this.overrideMaterial=e.overrideMaterial.clone()),this.autoUpdate=e.autoUpdate,this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){let t=super.toJSON(e);return this.fog!==null&&(t.object.fog=this.fog.toJSON()),t}};xM.prototype.isScene=!0;var Ah=class{constructor(e,t){this.array=e,this.stride=t,this.count=e!==void 0?e.length/t:0,this.usage=np,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=_r()}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}copyAt(e,t,n){e*=this.stride,n*=t.stride;for(let i=0,r=this.stride;i<r;i++)this.array[e+i]=t.array[n+i];return this}set(e,t=0){return this.array.set(e,t),this}clone(e){e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=_r()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);let t=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),n=new this.constructor(t,this.stride);return n.setUsage(this.usage),n}onUpload(e){return this.onUploadCallback=e,this}toJSON(e){return e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=_r()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=Array.prototype.slice.call(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}};Ah.prototype.isInterleavedBuffer=!0;var _n=new le,Ch=class{constructor(e,t,n,i=!1){this.name="",this.data=e,this.itemSize=t,this.offset=n,this.normalized=i===!0}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){this.data.needsUpdate=e}applyMatrix4(e){for(let t=0,n=this.data.count;t<n;t++)_n.x=this.getX(t),_n.y=this.getY(t),_n.z=this.getZ(t),_n.applyMatrix4(e),this.setXYZ(t,_n.x,_n.y,_n.z);return this}applyNormalMatrix(e){for(let t=0,n=this.count;t<n;t++)_n.x=this.getX(t),_n.y=this.getY(t),_n.z=this.getZ(t),_n.applyNormalMatrix(e),this.setXYZ(t,_n.x,_n.y,_n.z);return this}transformDirection(e){for(let t=0,n=this.count;t<n;t++)_n.x=this.getX(t),_n.y=this.getY(t),_n.z=this.getZ(t),_n.transformDirection(e),this.setXYZ(t,_n.x,_n.y,_n.z);return this}setX(e,t){return this.data.array[e*this.data.stride+this.offset]=t,this}setY(e,t){return this.data.array[e*this.data.stride+this.offset+1]=t,this}setZ(e,t){return this.data.array[e*this.data.stride+this.offset+2]=t,this}setW(e,t){return this.data.array[e*this.data.stride+this.offset+3]=t,this}getX(e){return this.data.array[e*this.data.stride+this.offset]}getY(e){return this.data.array[e*this.data.stride+this.offset+1]}getZ(e){return this.data.array[e*this.data.stride+this.offset+2]}getW(e){return this.data.array[e*this.data.stride+this.offset+3]}setXY(e,t,n){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=n,this}setXYZ(e,t,n,i){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=i,this}setXYZW(e,t,n,i,r){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=i,this.data.array[e+3]=r,this}clone(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interlaved buffer attribute will deinterleave buffer data.");let t=[];for(let n=0;n<this.count;n++){let i=n*this.data.stride+this.offset;for(let r=0;r<this.itemSize;r++)t.push(this.data.array[i+r])}return new Rn(new this.array.constructor(t),this.itemSize,this.normalized)}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new Ch(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interlaved buffer attribute will deinterleave buffer data.");let t=[];for(let n=0;n<this.count;n++){let i=n*this.data.stride+this.offset;for(let r=0;r<this.itemSize;r++)t.push(this.data.array[i+r])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:t,normalized:this.normalized}}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}};Ch.prototype.isInterleavedBufferAttribute=!0;var _M=class extends $n{constructor(e){super();this.type="SpriteMaterial",this.color=new Je(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this}};_M.prototype.isSpriteMaterial=!0;var Lh,pp=new le,Rh=new le,Ph=new le,Ih=new ke,mp=new ke,lP=new Qe,m0=new le,gp=new le,g0=new le,cP=new ke,wM=new ke,uP=new ke,hP=class extends Tt{constructor(e){super();if(this.type="Sprite",Lh===void 0){Lh=new kt;let t=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),n=new Ah(t,5);Lh.setIndex([0,1,2,0,2,3]),Lh.setAttribute("position",new Ch(n,3,0,!1)),Lh.setAttribute("uv",new Ch(n,2,3,!1))}this.geometry=Lh,this.material=e!==void 0?e:new _M,this.center=new ke(.5,.5)}raycast(e,t){e.camera===null&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),Rh.setFromMatrixScale(this.matrixWorld),lP.copy(e.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(e.camera.matrixWorldInverse,this.matrixWorld),Ph.setFromMatrixPosition(this.modelViewMatrix),e.camera.isPerspectiveCamera&&this.material.sizeAttenuation===!1&&Rh.multiplyScalar(-Ph.z);let n=this.material.rotation,i,r;n!==0&&(r=Math.cos(n),i=Math.sin(n));let s=this.center;y0(m0.set(-.5,-.5,0),Ph,s,Rh,i,r),y0(gp.set(.5,-.5,0),Ph,s,Rh,i,r),y0(g0.set(.5,.5,0),Ph,s,Rh,i,r),cP.set(0,0),wM.set(1,0),uP.set(1,1);let a=e.ray.intersectTriangle(m0,gp,g0,!1,pp);if(a===null&&(y0(gp.set(-.5,.5,0),Ph,s,Rh,i,r),wM.set(0,1),a=e.ray.intersectTriangle(m0,g0,gp,!1,pp),a===null))return;let l=e.ray.origin.distanceTo(pp);l<e.near||l>e.far||t.push({distance:l,point:pp.clone(),uv:xn.getUV(pp,m0,gp,g0,cP,wM,uP,new ke),face:null,object:this})}copy(e){return super.copy(e),e.center!==void 0&&this.center.copy(e.center),this.material=e.material,this}};hP.prototype.isSprite=!0;function y0(o,e,t,n,i,r){Ih.subVectors(o,t).addScalar(.5).multiply(n),i!==void 0?(mp.x=r*Ih.x-i*Ih.y,mp.y=i*Ih.x+r*Ih.y):mp.copy(Ih),o.copy(e),o.x+=mp.x,o.y+=mp.y,o.applyMatrix4(lP)}var dP=new le,fP=new Nt,pP=new Nt,G9=new le,mP=new Qe,bM=class extends Oi{constructor(e,t){super(e,t);this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new Qe,this.bindMatrixInverse=new Qe}copy(e){return super.copy(e),this.bindMode=e.bindMode,this.bindMatrix.copy(e.bindMatrix),this.bindMatrixInverse.copy(e.bindMatrixInverse),this.skeleton=e.skeleton,this}bind(e,t){this.skeleton=e,t===void 0&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.copy(t).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){let e=new Nt,t=this.geometry.attributes.skinWeight;for(let n=0,i=t.count;n<i;n++){e.x=t.getX(n),e.y=t.getY(n),e.z=t.getZ(n),e.w=t.getW(n);let r=1/e.manhattanLength();r!==1/0?e.multiplyScalar(r):e.set(1,0,0,0),t.setXYZW(n,e.x,e.y,e.z,e.w)}}updateMatrixWorld(e){super.updateMatrixWorld(e),this.bindMode==="attached"?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode==="detached"?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}boneTransform(e,t){let n=this.skeleton,i=this.geometry;fP.fromBufferAttribute(i.attributes.skinIndex,e),pP.fromBufferAttribute(i.attributes.skinWeight,e),dP.fromBufferAttribute(i.attributes.position,e).applyMatrix4(this.bindMatrix),t.set(0,0,0);for(let r=0;r<4;r++){let s=pP.getComponent(r);if(s!==0){let a=fP.getComponent(r);mP.multiplyMatrices(n.bones[a].matrixWorld,n.boneInverses[a]),t.addScaledVector(G9.copy(dP).applyMatrix4(mP),s)}}return t.applyMatrix4(this.bindMatrixInverse)}};bM.prototype.isSkinnedMesh=!0;var gP=class extends Tt{constructor(){super();this.type="Bone"}};gP.prototype.isBone=!0;var yP=class extends On{constructor(e=null,t=1,n=1,i,r,s,a,l,c=hi,u=hi,d,h){super(null,s,a,l,c,u,i,r,d,h);this.image={data:e,width:t,height:n},this.magFilter=c,this.minFilter=u,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.needsUpdate=!0}};yP.prototype.isDataTexture=!0;var vP=new Qe,xP=new Qe,v0=[],yp=new Oi,_P=class extends Oi{constructor(e,t,n){super(e,t);this.instanceMatrix=new Rn(new Float32Array(n*16),16),this.instanceColor=null,this.count=n,this.frustumCulled=!1}copy(e){return super.copy(e),this.instanceMatrix.copy(e.instanceMatrix),e.instanceColor!==null&&(this.instanceColor=e.instanceColor.clone()),this.count=e.count,this}getColorAt(e,t){t.fromArray(this.instanceColor.array,e*3)}getMatrixAt(e,t){t.fromArray(this.instanceMatrix.array,e*16)}raycast(e,t){let n=this.matrixWorld,i=this.count;if(yp.geometry=this.geometry,yp.material=this.material,yp.material!==void 0)for(let r=0;r<i;r++){this.getMatrixAt(r,vP),xP.multiplyMatrices(n,vP),yp.matrixWorld=xP,yp.raycast(e,v0);for(let s=0,a=v0.length;s<a;s++){let l=v0[s];l.instanceId=r,l.object=this,t.push(l)}v0.length=0}}setColorAt(e,t){this.instanceColor===null&&(this.instanceColor=new Rn(new Float32Array(this.count*3),3)),t.toArray(this.instanceColor.array,e*3)}setMatrixAt(e,t){t.toArray(this.instanceMatrix.array,e*16)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"})}};_P.prototype.isInstancedMesh=!0;var Na=class extends $n{constructor(e){super();this.type="LineBasicMaterial",this.color=new Je(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.morphTargets=!1,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.morphTargets=e.morphTargets,this}};Na.prototype.isLineBasicMaterial=!0;var wP=new le,bP=new le,MP=new Qe,MM=new tc,x0=new ec,Dh=class extends Tt{constructor(e=new kt,t=new Na){super();this.type="Line",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e){return super.copy(e),this.material=e.material,this.geometry=e.geometry,this}computeLineDistances(){let e=this.geometry;if(e.isBufferGeometry)if(e.index===null){let t=e.attributes.position,n=[0];for(let i=1,r=t.count;i<r;i++)wP.fromBufferAttribute(t,i-1),bP.fromBufferAttribute(t,i),n[i]=n[i-1],n[i]+=wP.distanceTo(bP);e.setAttribute("lineDistance",new Ot(n,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else e.isGeometry&&console.error("THREE.Line.computeLineDistances() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");return this}raycast(e,t){let n=this.geometry,i=this.matrixWorld,r=e.params.Line.threshold,s=n.drawRange;if(n.boundingSphere===null&&n.computeBoundingSphere(),x0.copy(n.boundingSphere),x0.applyMatrix4(i),x0.radius+=r,e.ray.intersectsSphere(x0)===!1)return;MP.copy(i).invert(),MM.copy(e.ray).applyMatrix4(MP);let a=r/((this.scale.x+this.scale.y+this.scale.z)/3),l=a*a,c=new le,u=new le,d=new le,h=new le,f=this.isLineSegments?2:1;if(n.isBufferGeometry){let p=n.index,v=n.attributes.position;if(p!==null){let y=Math.max(0,s.start),m=Math.min(p.count,s.start+s.count);for(let x=y,_=m-1;x<_;x+=f){let w=p.getX(x),b=p.getX(x+1);if(c.fromBufferAttribute(v,w),u.fromBufferAttribute(v,b),MM.distanceSqToSegment(c,u,h,d)>l)continue;h.applyMatrix4(this.matrixWorld);let S=e.ray.origin.distanceTo(h);S<e.near||S>e.far||t.push({distance:S,point:d.clone().applyMatrix4(this.matrixWorld),index:x,face:null,faceIndex:null,object:this})}}else{let y=Math.max(0,s.start),m=Math.min(v.count,s.start+s.count);for(let x=y,_=m-1;x<_;x+=f){if(c.fromBufferAttribute(v,x),u.fromBufferAttribute(v,x+1),MM.distanceSqToSegment(c,u,h,d)>l)continue;h.applyMatrix4(this.matrixWorld);let b=e.ray.origin.distanceTo(h);b<e.near||b>e.far||t.push({distance:b,point:d.clone().applyMatrix4(this.matrixWorld),index:x,face:null,faceIndex:null,object:this})}}}else n.isGeometry&&console.error("THREE.Line.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}updateMorphTargets(){let e=this.geometry;if(e.isBufferGeometry){let t=e.morphAttributes,n=Object.keys(t);if(n.length>0){let i=t[n[0]];if(i!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let r=0,s=i.length;r<s;r++){let a=i[r].name||String(r);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=r}}}}else{let t=e.morphTargets;t!==void 0&&t.length>0&&console.error("THREE.Line.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}};Dh.prototype.isLine=!0;var SP=new le,TP=new le,_0=class extends Dh{constructor(e,t){super(e,t);this.type="LineSegments"}computeLineDistances(){let e=this.geometry;if(e.isBufferGeometry)if(e.index===null){let t=e.attributes.position,n=[];for(let i=0,r=t.count;i<r;i+=2)SP.fromBufferAttribute(t,i),TP.fromBufferAttribute(t,i+1),n[i]=i===0?0:n[i-1],n[i+1]=n[i]+SP.distanceTo(TP);e.setAttribute("lineDistance",new Ot(n,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else e.isGeometry&&console.error("THREE.LineSegments.computeLineDistances() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");return this}};_0.prototype.isLineSegments=!0;var EP=class extends Dh{constructor(e,t){super(e,t);this.type="LineLoop"}};EP.prototype.isLineLoop=!0;var vp=class extends $n{constructor(e){super();this.type="PointsMaterial",this.color=new Je(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.morphTargets=!1,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.morphTargets=e.morphTargets,this}};vp.prototype.isPointsMaterial=!0;var AP=new Qe,SM=new tc,w0=new ec,b0=new le,M0=class extends Tt{constructor(e=new kt,t=new vp){super();this.type="Points",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e){return super.copy(e),this.material=e.material,this.geometry=e.geometry,this}raycast(e,t){let n=this.geometry,i=this.matrixWorld,r=e.params.Points.threshold,s=n.drawRange;if(n.boundingSphere===null&&n.computeBoundingSphere(),w0.copy(n.boundingSphere),w0.applyMatrix4(i),w0.radius+=r,e.ray.intersectsSphere(w0)===!1)return;AP.copy(i).invert(),SM.copy(e.ray).applyMatrix4(AP);let a=r/((this.scale.x+this.scale.y+this.scale.z)/3),l=a*a;if(n.isBufferGeometry){let c=n.index,d=n.attributes.position;if(c!==null){let h=Math.max(0,s.start),f=Math.min(c.count,s.start+s.count);for(let p=h,g=f;p<g;p++){let v=c.getX(p);b0.fromBufferAttribute(d,v),CP(b0,v,l,i,e,t,this)}}else{let h=Math.max(0,s.start),f=Math.min(d.count,s.start+s.count);for(let p=h,g=f;p<g;p++)b0.fromBufferAttribute(d,p),CP(b0,p,l,i,e,t,this)}}else console.error("THREE.Points.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}updateMorphTargets(){let e=this.geometry;if(e.isBufferGeometry){let t=e.morphAttributes,n=Object.keys(t);if(n.length>0){let i=t[n[0]];if(i!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let r=0,s=i.length;r<s;r++){let a=i[r].name||String(r);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=r}}}}else{let t=e.morphTargets;t!==void 0&&t.length>0&&console.error("THREE.Points.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}};M0.prototype.isPoints=!0;function CP(o,e,t,n,i,r,s){let a=SM.distanceSqToPoint(o);if(a<t){let l=new le;SM.closestPointToPoint(o,l),l.applyMatrix4(n);let c=i.ray.origin.distanceTo(l);if(c<i.near||c>i.far)return;r.push({distance:c,distanceToRay:Math.sqrt(a),point:l,index:e,face:null,object:s})}}var LP=class extends On{constructor(e,t,n,i,r,s,a,l,c){super(e,t,n,i,r,s,a,l,c);this.format=a!==void 0?a:Jl,this.minFilter=s!==void 0?s:xr,this.magFilter=r!==void 0?r:xr,this.generateMipmaps=!1;let u=this;function d(){u.needsUpdate=!0,e.requestVideoFrameCallback(d)}"requestVideoFrameCallback"in e&&e.requestVideoFrameCallback(d)}clone(){return new this.constructor(this.image).copy(this)}update(){let e=this.image;"requestVideoFrameCallback"in e===!1&&e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}};LP.prototype.isVideoTexture=!0;var RP=class extends On{constructor(e,t,n,i,r,s,a,l,c,u,d,h){super(null,s,a,l,c,u,i,r,d,h);this.image={width:t,height:n},this.mipmaps=e,this.flipY=!1,this.generateMipmaps=!1}};RP.prototype.isCompressedTexture=!0;var PP=class extends On{constructor(e,t,n,i,r,s,a,l,c){super(e,t,n,i,r,s,a,l,c);this.needsUpdate=!0}};PP.prototype.isCanvasTexture=!0;var IP=class extends On{constructor(e,t,n,i,r,s,a,l,c,u){if(u=u!==void 0?u:rh,u!==rh&&u!==tp)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");n===void 0&&u===rh&&(n=Uy),n===void 0&&u===tp&&(n=ep);super(null,i,r,s,a,l,u,n,c);this.image={width:e,height:t},this.magFilter=a!==void 0?a:hi,this.minFilter=l!==void 0?l:hi,this.flipY=!1,this.generateMipmaps=!1}};IP.prototype.isDepthTexture=!0;var Fh=class extends kt{constructor(e=1,t=1,n=1,i=8,r=1,s=!1,a=0,l=Math.PI*2){super();this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:n,radialSegments:i,heightSegments:r,openEnded:s,thetaStart:a,thetaLength:l};let c=this;i=Math.floor(i),r=Math.floor(r);let u=[],d=[],h=[],f=[],p=0,g=[],v=n/2,y=0;m(),s===!1&&(e>0&&x(!0),t>0&&x(!1)),this.setIndex(u),this.setAttribute("position",new Ot(d,3)),this.setAttribute("normal",new Ot(h,3)),this.setAttribute("uv",new Ot(f,2));function m(){let _=new le,w=new le,b=0,M=(t-e)/n;for(let S=0;S<=r;S++){let E=[],A=S/r,L=A*(t-e)+e;for(let B=0;B<=i;B++){let R=B/i,D=R*l+a,P=Math.sin(D),I=Math.cos(D);w.x=L*P,w.y=-A*n+v,w.z=L*I,d.push(w.x,w.y,w.z),_.set(P,M,I).normalize(),h.push(_.x,_.y,_.z),f.push(R,1-A),E.push(p++)}g.push(E)}for(let S=0;S<i;S++)for(let E=0;E<r;E++){let A=g[E][S],L=g[E+1][S],B=g[E+1][S+1],R=g[E][S+1];u.push(A,L,R),u.push(L,B,R),b+=6}c.addGroup(y,b,0),y+=b}function x(_){let w=p,b=new ke,M=new le,S=0,E=_===!0?e:t,A=_===!0?1:-1;for(let B=1;B<=i;B++)d.push(0,v*A,0),h.push(0,A,0),f.push(.5,.5),p++;let L=p;for(let B=0;B<=i;B++){let D=B/i*l+a,P=Math.cos(D),I=Math.sin(D);M.x=E*I,M.y=v*A,M.z=E*P,d.push(M.x,M.y,M.z),h.push(0,A,0),b.x=P*.5+.5,b.y=I*.5*A+.5,f.push(b.x,b.y),p++}for(let B=0;B<i;B++){let R=w+B,D=L+B;_===!0?u.push(D,D+1,R):u.push(D+1,D,R),S+=3}c.addGroup(y,S,_===!0?1:2),y+=S}}static fromJSON(e){return new Fh(e.radiusTop,e.radiusBottom,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}},xp=class extends Fh{constructor(e=1,t=1,n=8,i=1,r=!1,s=0,a=Math.PI*2){super(0,e,t,n,i,r,s,a);this.type="ConeGeometry",this.parameters={radius:e,height:t,radialSegments:n,heightSegments:i,openEnded:r,thetaStart:s,thetaLength:a}}static fromJSON(e){return new xp(e.radius,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}};var fne=new le,pne=new le,mne=new le,gne=new xn;var er=class{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(e,t){let n=this.getUtoTmapping(e);return this.getPoint(n,t)}getPoints(e=5){let t=[];for(let n=0;n<=e;n++)t.push(this.getPoint(n/e));return t}getSpacedPoints(e=5){let t=[];for(let n=0;n<=e;n++)t.push(this.getPointAt(n/e));return t}getLength(){let e=this.getLengths();return e[e.length-1]}getLengths(e=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;let t=[],n,i=this.getPoint(0),r=0;t.push(0);for(let s=1;s<=e;s++)n=this.getPoint(s/e),r+=n.distanceTo(i),t.push(r),i=n;return this.cacheArcLengths=t,t}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(e,t){let n=this.getLengths(),i=0,r=n.length,s;t?s=t:s=e*n[r-1];let a=0,l=r-1,c;for(;a<=l;)if(i=Math.floor(a+(l-a)/2),c=n[i]-s,c<0)a=i+1;else if(c>0)l=i-1;else{l=i;break}if(i=l,n[i]===s)return i/(r-1);let u=n[i],h=n[i+1]-u,f=(s-u)/h;return(i+f)/(r-1)}getTangent(e,t){let n=1e-4,i=e-n,r=e+n;i<0&&(i=0),r>1&&(r=1);let s=this.getPoint(i),a=this.getPoint(r),l=t||(s.isVector2?new ke:new le);return l.copy(a).sub(s).normalize(),l}getTangentAt(e,t){let n=this.getUtoTmapping(e);return this.getTangent(n,t)}computeFrenetFrames(e,t){let n=new le,i=[],r=[],s=[],a=new le,l=new Qe;for(let f=0;f<=e;f++){let p=f/e;i[f]=this.getTangentAt(p,new le),i[f].normalize()}r[0]=new le,s[0]=new le;let c=Number.MAX_VALUE,u=Math.abs(i[0].x),d=Math.abs(i[0].y),h=Math.abs(i[0].z);u<=c&&(c=u,n.set(1,0,0)),d<=c&&(c=d,n.set(0,1,0)),h<=c&&n.set(0,0,1),a.crossVectors(i[0],n).normalize(),r[0].crossVectors(i[0],a),s[0].crossVectors(i[0],r[0]);for(let f=1;f<=e;f++){if(r[f]=r[f-1].clone(),s[f]=s[f-1].clone(),a.crossVectors(i[f-1],i[f]),a.length()>Number.EPSILON){a.normalize();let p=Math.acos(Ti(i[f-1].dot(i[f]),-1,1));r[f].applyMatrix4(l.makeRotationAxis(a,p))}s[f].crossVectors(i[f],r[f])}if(t===!0){let f=Math.acos(Ti(r[0].dot(r[e]),-1,1));f/=e,i[0].dot(a.crossVectors(r[0],r[e]))>0&&(f=-f);for(let p=1;p<=e;p++)r[p].applyMatrix4(l.makeRotationAxis(i[p],f*p)),s[p].crossVectors(i[p],r[p])}return{tangents:i,normals:r,binormals:s}}clone(){return new this.constructor().copy(this)}copy(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}toJSON(){let e={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e}fromJSON(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}},_p=class extends er{constructor(e=0,t=0,n=1,i=1,r=0,s=Math.PI*2,a=!1,l=0){super();this.type="EllipseCurve",this.aX=e,this.aY=t,this.xRadius=n,this.yRadius=i,this.aStartAngle=r,this.aEndAngle=s,this.aClockwise=a,this.aRotation=l}getPoint(e,t){let n=t||new ke,i=Math.PI*2,r=this.aEndAngle-this.aStartAngle,s=Math.abs(r)<Number.EPSILON;for(;r<0;)r+=i;for(;r>i;)r-=i;r<Number.EPSILON&&(s?r=0:r=i),this.aClockwise===!0&&!s&&(r===i?r=-i:r=r-i);let a=this.aStartAngle+e*r,l=this.aX+this.xRadius*Math.cos(a),c=this.aY+this.yRadius*Math.sin(a);if(this.aRotation!==0){let u=Math.cos(this.aRotation),d=Math.sin(this.aRotation),h=l-this.aX,f=c-this.aY;l=h*u-f*d+this.aX,c=h*d+f*u+this.aY}return n.set(l,c)}copy(e){return super.copy(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}toJSON(){let e=super.toJSON();return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e}fromJSON(e){return super.fromJSON(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}};_p.prototype.isEllipseCurve=!0;var TM=class extends _p{constructor(e,t,n,i,r,s){super(e,t,n,n,i,r,s);this.type="ArcCurve"}};TM.prototype.isArcCurve=!0;function EM(){let o=0,e=0,t=0,n=0;function i(r,s,a,l){o=r,e=a,t=-3*r+3*s-2*a-l,n=2*r-2*s+a+l}return{initCatmullRom:function(r,s,a,l,c){i(s,a,c*(a-r),c*(l-s))},initNonuniformCatmullRom:function(r,s,a,l,c,u,d){let h=(s-r)/c-(a-r)/(c+u)+(a-s)/u,f=(a-s)/u-(l-s)/(u+d)+(l-a)/d;h*=u,f*=u,i(s,a,h,f)},calc:function(r){let s=r*r,a=s*r;return o+e*r+t*s+n*a}}}var S0=new le,AM=new EM,CM=new EM,LM=new EM,RM=class extends er{constructor(e=[],t=!1,n="centripetal",i=.5){super();this.type="CatmullRomCurve3",this.points=e,this.closed=t,this.curveType=n,this.tension=i}getPoint(e,t=new le){let n=t,i=this.points,r=i.length,s=(r-(this.closed?0:1))*e,a=Math.floor(s),l=s-a;this.closed?a+=a>0?0:(Math.floor(Math.abs(a)/r)+1)*r:l===0&&a===r-1&&(a=r-2,l=1);let c,u;this.closed||a>0?c=i[(a-1)%r]:(S0.subVectors(i[0],i[1]).add(i[0]),c=S0);let d=i[a%r],h=i[(a+1)%r];if(this.closed||a+2<r?u=i[(a+2)%r]:(S0.subVectors(i[r-1],i[r-2]).add(i[r-1]),u=S0),this.curveType==="centripetal"||this.curveType==="chordal"){let f=this.curveType==="chordal"?.5:.25,p=Math.pow(c.distanceToSquared(d),f),g=Math.pow(d.distanceToSquared(h),f),v=Math.pow(h.distanceToSquared(u),f);g<1e-4&&(g=1),p<1e-4&&(p=g),v<1e-4&&(v=g),AM.initNonuniformCatmullRom(c.x,d.x,h.x,u.x,p,g,v),CM.initNonuniformCatmullRom(c.y,d.y,h.y,u.y,p,g,v),LM.initNonuniformCatmullRom(c.z,d.z,h.z,u.z,p,g,v)}else this.curveType==="catmullrom"&&(AM.initCatmullRom(c.x,d.x,h.x,u.x,this.tension),CM.initCatmullRom(c.y,d.y,h.y,u.y,this.tension),LM.initCatmullRom(c.z,d.z,h.z,u.z,this.tension));return n.set(AM.calc(l),CM.calc(l),LM.calc(l)),n}copy(e){super.copy(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){let i=e.points[t];this.points.push(i.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}toJSON(){let e=super.toJSON();e.points=[];for(let t=0,n=this.points.length;t<n;t++){let i=this.points[t];e.points.push(i.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){let i=e.points[t];this.points.push(new le().fromArray(i))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}};RM.prototype.isCatmullRomCurve3=!0;function DP(o,e,t,n,i){let r=(n-e)*.5,s=(i-t)*.5,a=o*o,l=o*a;return(2*t-2*n+r+s)*l+(-3*t+3*n-2*r-s)*a+r*o+t}function V9(o,e){let t=1-o;return t*t*e}function W9(o,e){return 2*(1-o)*o*e}function X9(o,e){return o*o*e}function wp(o,e,t,n){return V9(o,e)+W9(o,t)+X9(o,n)}function q9(o,e){let t=1-o;return t*t*t*e}function j9(o,e){let t=1-o;return 3*t*t*o*e}function Y9(o,e){return 3*(1-o)*o*o*e}function Z9(o,e){return o*o*o*e}function bp(o,e,t,n,i){return q9(o,e)+j9(o,t)+Y9(o,n)+Z9(o,i)}var T0=class extends er{constructor(e=new ke,t=new ke,n=new ke,i=new ke){super();this.type="CubicBezierCurve",this.v0=e,this.v1=t,this.v2=n,this.v3=i}getPoint(e,t=new ke){let n=t,i=this.v0,r=this.v1,s=this.v2,a=this.v3;return n.set(bp(e,i.x,r.x,s.x,a.x),bp(e,i.y,r.y,s.y,a.y)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){let e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}};T0.prototype.isCubicBezierCurve=!0;var PM=class extends er{constructor(e=new le,t=new le,n=new le,i=new le){super();this.type="CubicBezierCurve3",this.v0=e,this.v1=t,this.v2=n,this.v3=i}getPoint(e,t=new le){let n=t,i=this.v0,r=this.v1,s=this.v2,a=this.v3;return n.set(bp(e,i.x,r.x,s.x,a.x),bp(e,i.y,r.y,s.y,a.y),bp(e,i.z,r.z,s.z,a.z)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){let e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}};PM.prototype.isCubicBezierCurve3=!0;var Mp=class extends er{constructor(e=new ke,t=new ke){super();this.type="LineCurve",this.v1=e,this.v2=t}getPoint(e,t=new ke){let n=t;return e===1?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(e).add(this.v1)),n}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e,t){let n=t||new ke;return n.copy(this.v2).sub(this.v1).normalize(),n}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){let e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}};Mp.prototype.isLineCurve=!0;var FP=class extends er{constructor(e=new le,t=new le){super();this.type="LineCurve3",this.isLineCurve3=!0,this.v1=e,this.v2=t}getPoint(e,t=new le){let n=t;return e===1?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(e).add(this.v1)),n}getPointAt(e,t){return this.getPoint(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){let e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}},E0=class extends er{constructor(e=new ke,t=new ke,n=new ke){super();this.type="QuadraticBezierCurve",this.v0=e,this.v1=t,this.v2=n}getPoint(e,t=new ke){let n=t,i=this.v0,r=this.v1,s=this.v2;return n.set(wp(e,i.x,r.x,s.x),wp(e,i.y,r.y,s.y)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){let e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}};E0.prototype.isQuadraticBezierCurve=!0;var IM=class extends er{constructor(e=new le,t=new le,n=new le){super();this.type="QuadraticBezierCurve3",this.v0=e,this.v1=t,this.v2=n}getPoint(e,t=new le){let n=t,i=this.v0,r=this.v1,s=this.v2;return n.set(wp(e,i.x,r.x,s.x),wp(e,i.y,r.y,s.y),wp(e,i.z,r.z,s.z)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){let e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}};IM.prototype.isQuadraticBezierCurve3=!0;var A0=class extends er{constructor(e=[]){super();this.type="SplineCurve",this.points=e}getPoint(e,t=new ke){let n=t,i=this.points,r=(i.length-1)*e,s=Math.floor(r),a=r-s,l=i[s===0?s:s-1],c=i[s],u=i[s>i.length-2?i.length-1:s+1],d=i[s>i.length-3?i.length-1:s+2];return n.set(DP(a,l.x,c.x,u.x,d.x),DP(a,l.y,c.y,u.y,d.y)),n}copy(e){super.copy(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){let i=e.points[t];this.points.push(i.clone())}return this}toJSON(){let e=super.toJSON();e.points=[];for(let t=0,n=this.points.length;t<n;t++){let i=this.points[t];e.points.push(i.toArray())}return e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){let i=e.points[t];this.points.push(new ke().fromArray(i))}return this}};A0.prototype.isSplineCurve=!0;var BP=Object.freeze({__proto__:null,ArcCurve:TM,CatmullRomCurve3:RM,CubicBezierCurve:T0,CubicBezierCurve3:PM,EllipseCurve:_p,LineCurve:Mp,LineCurve3:FP,QuadraticBezierCurve:E0,QuadraticBezierCurve3:IM,SplineCurve:A0}),J9={triangulate:function(o,e,t=2){let n=e&&e.length,i=n?e[0]*t:o.length,r=NP(o,0,i,t,!0),s=[];if(!r||r.next===r.prev)return s;let a,l,c,u,d,h,f;if(n&&(r=tX(o,e,r,t)),o.length>80*t){a=c=o[0],l=u=o[1];for(let p=t;p<i;p+=t)d=o[p],h=o[p+1],d<a&&(a=d),h<l&&(l=h),d>c&&(c=d),h>u&&(u=h);f=Math.max(c-a,u-l),f=f!==0?1/f:0}return Sp(r,s,t,a,l,f),s}};function NP(o,e,t,n,i){let r,s;if(i===dX(o,e,t,n)>0)for(r=e;r<t;r+=n)s=zP(r,o[r],o[r+1],s);else for(r=t-n;r>=e;r-=n)s=zP(r,o[r],o[r+1],s);return s&&C0(s,s.next)&&(Ep(s),s=s.next),s}function Oa(o,e){if(!o)return o;e||(e=o);let t=o,n;do if(n=!1,!t.steiner&&(C0(t,t.next)||nn(t.prev,t,t.next)===0)){if(Ep(t),t=e=t.prev,t===t.next)break;n=!0}else t=t.next;while(n||t!==e);return e}function Sp(o,e,t,n,i,r,s){if(!o)return;!s&&r&&oX(o,n,i,r);let a=o,l,c;for(;o.prev!==o.next;){if(l=o.prev,c=o.next,r?$9(o,n,i,r):K9(o)){e.push(l.i/t),e.push(o.i/t),e.push(c.i/t),Ep(o),o=c.next,a=c.next;continue}if(o=c,o===a){s?s===1?(o=Q9(Oa(o),e,t),Sp(o,e,t,n,i,r,2)):s===2&&eX(o,e,t,n,i,r):Sp(Oa(o),e,t,n,i,r,1);break}}}function K9(o){let e=o.prev,t=o,n=o.next;if(nn(e,t,n)>=0)return!1;let i=o.next.next;for(;i!==o.prev;){if(Bh(e.x,e.y,t.x,t.y,n.x,n.y,i.x,i.y)&&nn(i.prev,i,i.next)>=0)return!1;i=i.next}return!0}function $9(o,e,t,n){let i=o.prev,r=o,s=o.next;if(nn(i,r,s)>=0)return!1;let a=i.x<r.x?i.x<s.x?i.x:s.x:r.x<s.x?r.x:s.x,l=i.y<r.y?i.y<s.y?i.y:s.y:r.y<s.y?r.y:s.y,c=i.x>r.x?i.x>s.x?i.x:s.x:r.x>s.x?r.x:s.x,u=i.y>r.y?i.y>s.y?i.y:s.y:r.y>s.y?r.y:s.y,d=DM(a,l,e,t,n),h=DM(c,u,e,t,n),f=o.prevZ,p=o.nextZ;for(;f&&f.z>=d&&p&&p.z<=h;){if(f!==o.prev&&f!==o.next&&Bh(i.x,i.y,r.x,r.y,s.x,s.y,f.x,f.y)&&nn(f.prev,f,f.next)>=0||(f=f.prevZ,p!==o.prev&&p!==o.next&&Bh(i.x,i.y,r.x,r.y,s.x,s.y,p.x,p.y)&&nn(p.prev,p,p.next)>=0))return!1;p=p.nextZ}for(;f&&f.z>=d;){if(f!==o.prev&&f!==o.next&&Bh(i.x,i.y,r.x,r.y,s.x,s.y,f.x,f.y)&&nn(f.prev,f,f.next)>=0)return!1;f=f.prevZ}for(;p&&p.z<=h;){if(p!==o.prev&&p!==o.next&&Bh(i.x,i.y,r.x,r.y,s.x,s.y,p.x,p.y)&&nn(p.prev,p,p.next)>=0)return!1;p=p.nextZ}return!0}function Q9(o,e,t){let n=o;do{let i=n.prev,r=n.next.next;!C0(i,r)&&OP(i,n,n.next,r)&&Tp(i,r)&&Tp(r,i)&&(e.push(i.i/t),e.push(n.i/t),e.push(r.i/t),Ep(n),Ep(n.next),n=o=r),n=n.next}while(n!==o);return Oa(n)}function eX(o,e,t,n,i,r){let s=o;do{let a=s.next.next;for(;a!==s.prev;){if(s.i!==a.i&&cX(s,a)){let l=kP(s,a);s=Oa(s,s.next),l=Oa(l,l.next),Sp(s,e,t,n,i,r),Sp(l,e,t,n,i,r);return}a=a.next}s=s.next}while(s!==o)}function tX(o,e,t,n){let i=[],r,s,a,l,c;for(r=0,s=e.length;r<s;r++)a=e[r]*n,l=r<s-1?e[r+1]*n:o.length,c=NP(o,a,l,n,!1),c===c.next&&(c.steiner=!0),i.push(lX(c));for(i.sort(nX),r=0;r<i.length;r++)iX(i[r],t),t=Oa(t,t.next);return t}function nX(o,e){return o.x-e.x}function iX(o,e){if(e=rX(o,e),e){let t=kP(e,o);Oa(e,e.next),Oa(t,t.next)}}function rX(o,e){let t=e,n=o.x,i=o.y,r=-1/0,s;do{if(i<=t.y&&i>=t.next.y&&t.next.y!==t.y){let h=t.x+(i-t.y)*(t.next.x-t.x)/(t.next.y-t.y);if(h<=n&&h>r){if(r=h,h===n){if(i===t.y)return t;if(i===t.next.y)return t.next}s=t.x<t.next.x?t:t.next}}t=t.next}while(t!==e);if(!s)return null;if(n===r)return s;let a=s,l=s.x,c=s.y,u=1/0,d;t=s;do n>=t.x&&t.x>=l&&n!==t.x&&Bh(i<c?n:r,i,l,c,i<c?r:n,i,t.x,t.y)&&(d=Math.abs(i-t.y)/(n-t.x),Tp(t,o)&&(d<u||d===u&&(t.x>s.x||t.x===s.x&&sX(s,t)))&&(s=t,u=d)),t=t.next;while(t!==a);return s}function sX(o,e){return nn(o.prev,o,e.prev)<0&&nn(e.next,o,o.next)<0}function oX(o,e,t,n){let i=o;do i.z===null&&(i.z=DM(i.x,i.y,e,t,n)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next;while(i!==o);i.prevZ.nextZ=null,i.prevZ=null,aX(i)}function aX(o){let e,t,n,i,r,s,a,l,c=1;do{for(t=o,o=null,r=null,s=0;t;){for(s++,n=t,a=0,e=0;e<c&&(a++,n=n.nextZ,!!n);e++);for(l=c;a>0||l>0&&n;)a!==0&&(l===0||!n||t.z<=n.z)?(i=t,t=t.nextZ,a--):(i=n,n=n.nextZ,l--),r?r.nextZ=i:o=i,i.prevZ=r,r=i;t=n}r.nextZ=null,c*=2}while(s>1);return o}function DM(o,e,t,n,i){return o=32767*(o-t)*i,e=32767*(e-n)*i,o=(o|o<<8)&16711935,o=(o|o<<4)&252645135,o=(o|o<<2)&858993459,o=(o|o<<1)&1431655765,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,o|e<<1}function lX(o){let e=o,t=o;do(e.x<t.x||e.x===t.x&&e.y<t.y)&&(t=e),e=e.next;while(e!==o);return t}function Bh(o,e,t,n,i,r,s,a){return(i-s)*(e-a)-(o-s)*(r-a)>=0&&(o-s)*(n-a)-(t-s)*(e-a)>=0&&(t-s)*(r-a)-(i-s)*(n-a)>=0}function cX(o,e){return o.next.i!==e.i&&o.prev.i!==e.i&&!uX(o,e)&&(Tp(o,e)&&Tp(e,o)&&hX(o,e)&&(nn(o.prev,o,e.prev)||nn(o,e.prev,e))||C0(o,e)&&nn(o.prev,o,o.next)>0&&nn(e.prev,e,e.next)>0)}function nn(o,e,t){return(e.y-o.y)*(t.x-e.x)-(e.x-o.x)*(t.y-e.y)}function C0(o,e){return o.x===e.x&&o.y===e.y}function OP(o,e,t,n){let i=R0(nn(o,e,t)),r=R0(nn(o,e,n)),s=R0(nn(t,n,o)),a=R0(nn(t,n,e));return!!(i!==r&&s!==a||i===0&&L0(o,t,e)||r===0&&L0(o,n,e)||s===0&&L0(t,o,n)||a===0&&L0(t,e,n))}function L0(o,e,t){return e.x<=Math.max(o.x,t.x)&&e.x>=Math.min(o.x,t.x)&&e.y<=Math.max(o.y,t.y)&&e.y>=Math.min(o.y,t.y)}function R0(o){return o>0?1:o<0?-1:0}function uX(o,e){let t=o;do{if(t.i!==o.i&&t.next.i!==o.i&&t.i!==e.i&&t.next.i!==e.i&&OP(t,t.next,o,e))return!0;t=t.next}while(t!==o);return!1}function Tp(o,e){return nn(o.prev,o,o.next)<0?nn(o,e,o.next)>=0&&nn(o,o.prev,e)>=0:nn(o,e,o.prev)<0||nn(o,o.next,e)<0}function hX(o,e){let t=o,n=!1,i=(o.x+e.x)/2,r=(o.y+e.y)/2;do t.y>r!=t.next.y>r&&t.next.y!==t.y&&i<(t.next.x-t.x)*(r-t.y)/(t.next.y-t.y)+t.x&&(n=!n),t=t.next;while(t!==o);return n}function kP(o,e){let t=new FM(o.i,o.x,o.y),n=new FM(e.i,e.x,e.y),i=o.next,r=e.prev;return o.next=e,e.prev=o,t.next=i,i.prev=t,n.next=t,t.prev=n,r.next=n,n.prev=r,n}function zP(o,e,t,n){let i=new FM(o,e,t);return n?(i.next=n.next,i.prev=n,n.next.prev=i,n.next=i):(i.prev=i,i.next=i),i}function Ep(o){o.next.prev=o.prev,o.prev.next=o.next,o.prevZ&&(o.prevZ.nextZ=o.nextZ),o.nextZ&&(o.nextZ.prevZ=o.prevZ)}function FM(o,e,t){this.i=o,this.x=e,this.y=t,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function dX(o,e,t,n){let i=0;for(let r=e,s=t-n;r<t;r+=n)i+=(o[s]-o[r])*(o[r+1]+o[s+1]),s=r;return i}var Is=class{static area(e){let t=e.length,n=0;for(let i=t-1,r=0;r<t;i=r++)n+=e[i].x*e[r].y-e[r].x*e[i].y;return n*.5}static isClockWise(e){return Is.area(e)<0}static triangulateShape(e,t){let n=[],i=[],r=[];UP(e),HP(n,e);let s=e.length;t.forEach(UP);for(let l=0;l<t.length;l++)i.push(s),s+=t[l].length,HP(n,t[l]);let a=J9.triangulate(n,i);for(let l=0;l<a.length;l+=3)r.push(a.slice(l,l+3));return r}};function UP(o){let e=o.length;e>2&&o[e-1].equals(o[0])&&o.pop()}function HP(o,e){for(let t=0;t<e.length;t++)o.push(e[t].x),o.push(e[t].y)}var To=class extends kt{constructor(e,t){super();this.type="ExtrudeGeometry",this.parameters={shapes:e,options:t},e=Array.isArray(e)?e:[e];let n=this,i=[],r=[];for(let a=0,l=e.length;a<l;a++){let c=e[a];s(c)}this.setAttribute("position",new Ot(i,3)),this.setAttribute("uv",new Ot(r,2)),this.computeVertexNormals();function s(a){let l=[],c=t.curveSegments!==void 0?t.curveSegments:12,u=t.steps!==void 0?t.steps:1,d=t.depth!==void 0?t.depth:100,h=t.bevelEnabled!==void 0?t.bevelEnabled:!0,f=t.bevelThickness!==void 0?t.bevelThickness:6,p=t.bevelSize!==void 0?t.bevelSize:f-2,g=t.bevelOffset!==void 0?t.bevelOffset:0,v=t.bevelSegments!==void 0?t.bevelSegments:3,y=t.extrudePath,m=t.UVGenerator!==void 0?t.UVGenerator:fX;t.amount!==void 0&&(console.warn("THREE.ExtrudeBufferGeometry: amount has been renamed to depth."),d=t.amount);let x,_=!1,w,b,M,S;y&&(x=y.getSpacedPoints(u),_=!0,h=!1,w=y.computeFrenetFrames(u,!1),b=new le,M=new le,S=new le),h||(v=0,f=0,p=0,g=0);let E=a.extractPoints(c),A=E.shape,L=E.holes;if(!Is.isClockWise(A)){A=A.reverse();for(let X=0,$=L.length;X<$;X++){let J=L[X];Is.isClockWise(J)&&(L[X]=J.reverse())}}let R=Is.triangulateShape(A,L),D=A;for(let X=0,$=L.length;X<$;X++){let J=L[X];A=A.concat(J)}function P(X,$,J){return $||console.error("THREE.ExtrudeGeometry: vec does not exist"),$.clone().multiplyScalar(J).add(X)}let I=A.length,N=R.length;function G(X,$,J){let ce,H,T,C=X.x-$.x,W=X.y-$.y,Z=J.x-X.x,he=J.y-X.y,me=C*C+W*W,Ee=C*he-W*Z;if(Math.abs(Ee)>Number.EPSILON){let Se=Math.sqrt(me),oe=Math.sqrt(Z*Z+he*he),ge=$.x-W/Se,k=$.y+C/Se,de=J.x-he/oe,K=J.y+Z/oe,be=((de-ge)*he-(K-k)*Z)/(C*he-W*Z);ce=ge+C*be-X.x,H=k+W*be-X.y;let we=ce*ce+H*H;if(we<=2)return new ke(ce,H);T=Math.sqrt(we/2)}else{let Se=!1;C>Number.EPSILON?Z>Number.EPSILON&&(Se=!0):C<-Number.EPSILON?Z<-Number.EPSILON&&(Se=!0):Math.sign(W)===Math.sign(he)&&(Se=!0),Se?(ce=-W,H=C,T=Math.sqrt(me)):(ce=C,H=W,T=Math.sqrt(me/2))}return new ke(ce/T,H/T)}let z=[];for(let X=0,$=D.length,J=$-1,ce=X+1;X<$;X++,J++,ce++)J===$&&(J=0),ce===$&&(ce=0),z[X]=G(D[X],D[J],D[ce]);let se=[],ne,Q=z.concat();for(let X=0,$=L.length;X<$;X++){let J=L[X];ne=[];for(let ce=0,H=J.length,T=H-1,C=ce+1;ce<H;ce++,T++,C++)T===H&&(T=0),C===H&&(C=0),ne[ce]=G(J[ce],J[T],J[C]);se.push(ne),Q=Q.concat(ne)}for(let X=0;X<v;X++){let $=X/v,J=f*Math.cos($*Math.PI/2),ce=p*Math.sin($*Math.PI/2)+g;for(let H=0,T=D.length;H<T;H++){let C=P(D[H],z[H],ce);ie(C.x,C.y,-J)}for(let H=0,T=L.length;H<T;H++){let C=L[H];ne=se[H];for(let W=0,Z=C.length;W<Z;W++){let he=P(C[W],ne[W],ce);ie(he.x,he.y,-J)}}}let j=p+g;for(let X=0;X<I;X++){let $=h?P(A[X],Q[X],j):A[X];_?(M.copy(w.normals[0]).multiplyScalar($.x),b.copy(w.binormals[0]).multiplyScalar($.y),S.copy(x[0]).add(M).add(b),ie(S.x,S.y,S.z)):ie($.x,$.y,0)}for(let X=1;X<=u;X++)for(let $=0;$<I;$++){let J=h?P(A[$],Q[$],j):A[$];_?(M.copy(w.normals[X]).multiplyScalar(J.x),b.copy(w.binormals[X]).multiplyScalar(J.y),S.copy(x[X]).add(M).add(b),ie(S.x,S.y,S.z)):ie(J.x,J.y,d/u*X)}for(let X=v-1;X>=0;X--){let $=X/v,J=f*Math.cos($*Math.PI/2),ce=p*Math.sin($*Math.PI/2)+g;for(let H=0,T=D.length;H<T;H++){let C=P(D[H],z[H],ce);ie(C.x,C.y,d+J)}for(let H=0,T=L.length;H<T;H++){let C=L[H];ne=se[H];for(let W=0,Z=C.length;W<Z;W++){let he=P(C[W],ne[W],ce);_?ie(he.x,he.y+x[u-1].y,x[u-1].x+J):ie(he.x,he.y,d+J)}}}O(),ee();function O(){let X=i.length/3;if(h){let $=0,J=I*$;for(let ce=0;ce<N;ce++){let H=R[ce];ue(H[2]+J,H[1]+J,H[0]+J)}$=u+v*2,J=I*$;for(let ce=0;ce<N;ce++){let H=R[ce];ue(H[0]+J,H[1]+J,H[2]+J)}}else{for(let $=0;$<N;$++){let J=R[$];ue(J[2],J[1],J[0])}for(let $=0;$<N;$++){let J=R[$];ue(J[0]+I*u,J[1]+I*u,J[2]+I*u)}}n.addGroup(X,i.length/3-X,0)}function ee(){let X=i.length/3,$=0;V(D,$),$+=D.length;for(let J=0,ce=L.length;J<ce;J++){let H=L[J];V(H,$),$+=H.length}n.addGroup(X,i.length/3-X,1)}function V(X,$){let J=X.length;for(;--J>=0;){let ce=J,H=J-1;H<0&&(H=X.length-1);for(let T=0,C=u+v*2;T<C;T++){let W=I*T,Z=I*(T+1),he=$+ce+W,me=$+H+W,Ee=$+H+Z,Se=$+ce+Z;ye(he,me,Ee,Se)}}}function ie(X,$,J){l.push(X),l.push($),l.push(J)}function ue(X,$,J){pe(X),pe($),pe(J);let ce=i.length/3,H=m.generateTopUV(n,i,ce-3,ce-2,ce-1);xe(H[0]),xe(H[1]),xe(H[2])}function ye(X,$,J,ce){pe(X),pe($),pe(ce),pe($),pe(J),pe(ce);let H=i.length/3,T=m.generateSideWallUV(n,i,H-6,H-3,H-2,H-1);xe(T[0]),xe(T[1]),xe(T[3]),xe(T[1]),xe(T[2]),xe(T[3])}function pe(X){i.push(l[X*3+0]),i.push(l[X*3+1]),i.push(l[X*3+2])}function xe(X){r.push(X.x),r.push(X.y)}}}toJSON(){let e=super.toJSON(),t=this.parameters.shapes,n=this.parameters.options;return pX(t,n,e)}static fromJSON(e,t){let n=[];for(let r=0,s=e.shapes.length;r<s;r++){let a=t[e.shapes[r]];n.push(a)}let i=e.options.extrudePath;return i!==void 0&&(e.options.extrudePath=new BP[i.type]().fromJSON(i)),new To(n,e.options)}},fX={generateTopUV:function(o,e,t,n,i){let r=e[t*3],s=e[t*3+1],a=e[n*3],l=e[n*3+1],c=e[i*3],u=e[i*3+1];return[new ke(r,s),new ke(a,l),new ke(c,u)]},generateSideWallUV:function(o,e,t,n,i,r){let s=e[t*3],a=e[t*3+1],l=e[t*3+2],c=e[n*3],u=e[n*3+1],d=e[n*3+2],h=e[i*3],f=e[i*3+1],p=e[i*3+2],g=e[r*3],v=e[r*3+1],y=e[r*3+2];return Math.abs(a-u)<Math.abs(s-c)?[new ke(s,1-l),new ke(c,1-d),new ke(h,1-p),new ke(g,1-y)]:[new ke(a,1-l),new ke(u,1-d),new ke(f,1-p),new ke(v,1-y)]}};function pX(o,e,t){if(t.shapes=[],Array.isArray(o))for(let n=0,i=o.length;n<i;n++){let r=o[n];t.shapes.push(r.uuid)}else t.shapes.push(o.uuid);return e.extrudePath!==void 0&&(t.options.extrudePath=e.extrudePath.toJSON()),t}var P0=class extends kt{constructor(e,t=12){super();this.type="ShapeGeometry",this.parameters={shapes:e,curveSegments:t};let n=[],i=[],r=[],s=[],a=0,l=0;if(Array.isArray(e)===!1)c(e);else for(let u=0;u<e.length;u++)c(e[u]),this.addGroup(a,l,u),a+=l,l=0;this.setIndex(n),this.setAttribute("position",new Ot(i,3)),this.setAttribute("normal",new Ot(r,3)),this.setAttribute("uv",new Ot(s,2));function c(u){let d=i.length/3,h=u.extractPoints(t),f=h.shape,p=h.holes;Is.isClockWise(f)===!1&&(f=f.reverse());for(let v=0,y=p.length;v<y;v++){let m=p[v];Is.isClockWise(m)===!0&&(p[v]=m.reverse())}let g=Is.triangulateShape(f,p);for(let v=0,y=p.length;v<y;v++){let m=p[v];f=f.concat(m)}for(let v=0,y=f.length;v<y;v++){let m=f[v];i.push(m.x,m.y,0),r.push(0,0,1),s.push(m.x,m.y)}for(let v=0,y=g.length;v<y;v++){let m=g[v],x=m[0]+d,_=m[1]+d,w=m[2]+d;n.push(x,_,w),l+=3}}}toJSON(){let e=super.toJSON(),t=this.parameters.shapes;return mX(t,e)}static fromJSON(e,t){let n=[];for(let i=0,r=e.shapes.length;i<r;i++){let s=t[e.shapes[i]];n.push(s)}return new P0(n,e.curveSegments)}};function mX(o,e){if(e.shapes=[],Array.isArray(o))for(let t=0,n=o.length;t<n;t++){let i=o[t];e.shapes.push(i.uuid)}else e.shapes.push(o.uuid);return e}var Ap=class extends kt{constructor(e=1,t=8,n=6,i=0,r=Math.PI*2,s=0,a=Math.PI){super();this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:n,phiStart:i,phiLength:r,thetaStart:s,thetaLength:a},t=Math.max(3,Math.floor(t)),n=Math.max(2,Math.floor(n));let l=Math.min(s+a,Math.PI),c=0,u=[],d=new le,h=new le,f=[],p=[],g=[],v=[];for(let y=0;y<=n;y++){let m=[],x=y/n,_=0;y==0&&s==0?_=.5/t:y==n&&l==Math.PI&&(_=-.5/t);for(let w=0;w<=t;w++){let b=w/t;d.x=-e*Math.cos(i+b*r)*Math.sin(s+x*a),d.y=e*Math.cos(s+x*a),d.z=e*Math.sin(i+b*r)*Math.sin(s+x*a),p.push(d.x,d.y,d.z),h.copy(d).normalize(),g.push(h.x,h.y,h.z),v.push(b+_,1-x),m.push(c++)}u.push(m)}for(let y=0;y<n;y++)for(let m=0;m<t;m++){let x=u[y][m+1],_=u[y][m],w=u[y+1][m],b=u[y+1][m+1];(y!==0||s>0)&&f.push(x,_,b),(y!==n-1||l<Math.PI)&&f.push(_,w,b)}this.setIndex(f),this.setAttribute("position",new Ot(p,3)),this.setAttribute("normal",new Ot(g,3)),this.setAttribute("uv",new Ot(v,2))}static fromJSON(e){return new Ap(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength)}};var Cp=class extends kt{constructor(e=1,t=.4,n=8,i=6,r=Math.PI*2){super();this.type="TorusGeometry",this.parameters={radius:e,tube:t,radialSegments:n,tubularSegments:i,arc:r},n=Math.floor(n),i=Math.floor(i);let s=[],a=[],l=[],c=[],u=new le,d=new le,h=new le;for(let f=0;f<=n;f++)for(let p=0;p<=i;p++){let g=p/i*r,v=f/n*Math.PI*2;d.x=(e+t*Math.cos(v))*Math.cos(g),d.y=(e+t*Math.cos(v))*Math.sin(g),d.z=t*Math.sin(v),a.push(d.x,d.y,d.z),u.x=e*Math.cos(g),u.y=e*Math.sin(g),h.subVectors(d,u).normalize(),l.push(h.x,h.y,h.z),c.push(p/i),c.push(f/n)}for(let f=1;f<=n;f++)for(let p=1;p<=i;p++){let g=(i+1)*f+p-1,v=(i+1)*(f-1)+p-1,y=(i+1)*(f-1)+p,m=(i+1)*f+p;s.push(g,v,m),s.push(v,y,m)}this.setIndex(s),this.setAttribute("position",new Ot(a,3)),this.setAttribute("normal",new Ot(l,3)),this.setAttribute("uv",new Ot(c,2))}static fromJSON(e){return new Cp(e.radius,e.tube,e.radialSegments,e.tubularSegments,e.arc)}};var GP=class extends $n{constructor(e){super();this.type="ShadowMaterial",this.color=new Je(0),this.transparent=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this}};GP.prototype.isShadowMaterial=!0;var VP=class extends Fa{constructor(e){super(e);this.type="RawShaderMaterial"}};VP.prototype.isRawShaderMaterial=!0;var Lp=class extends $n{constructor(e){super();this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new Je(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Je(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=lh,this.normalScale=new ke(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.morphTargets=!1,this.morphNormals=!1,this.flatShading=!1,this.vertexTangents=!1,this.setValues(e)}copy(e){return super.copy(e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapIntensity=e.envMapIntensity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this.flatShading=e.flatShading,this.vertexTangents=e.vertexTangents,this}};Lp.prototype.isMeshStandardMaterial=!0;var I0=class extends Lp{constructor(e){super();this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.clearcoat=0,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new ke(1,1),this.clearcoatNormalMap=null,this.reflectivity=.5,Object.defineProperty(this,"ior",{get:function(){return(1+.4*this.reflectivity)/(1-.4*this.reflectivity)},set:function(t){this.reflectivity=Ti(2.5*(t-1)/(t+1),0,1)}}),this.sheen=null,this.transmission=0,this.transmissionMap=null,this.thickness=.01,this.thicknessMap=null,this.attenuationDistance=0,this.attenuationColor=new Je(1,1,1),this.setValues(e)}copy(e){return super.copy(e),this.defines={STANDARD:"",PHYSICAL:""},this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.reflectivity=e.reflectivity,e.sheen?this.sheen=(this.sheen||new Je).copy(e.sheen):this.sheen=null,this.transmission=e.transmission,this.transmissionMap=e.transmissionMap,this.thickness=e.thickness,this.thicknessMap=e.thicknessMap,this.attenuationDistance=e.attenuationDistance,this.attenuationColor.copy(e.attenuationColor),this}};I0.prototype.isMeshPhysicalMaterial=!0;var D0=class extends $n{constructor(e){super();this.type="MeshPhongMaterial",this.color=new Je(16777215),this.specular=new Je(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Je(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=lh,this.normalScale=new ke(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Oy,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.morphTargets=!1,this.morphNormals=!1,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this.flatShading=e.flatShading,this}};D0.prototype.isMeshPhongMaterial=!0;var F0=class extends $n{constructor(e){super();this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new Je(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Je(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=lh,this.normalScale=new ke(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.gradientMap=e.gradientMap,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this}};F0.prototype.isMeshToonMaterial=!0;var B0=class extends $n{constructor(e){super();this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=lh,this.normalScale=new ke(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.morphTargets=!1,this.morphNormals=!1,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this.flatShading=e.flatShading,this}};B0.prototype.isMeshNormalMaterial=!0;var Nh=class extends $n{constructor(e){super();this.type="MeshLambertMaterial",this.color=new Je(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Je(0),this.emissiveIntensity=1,this.emissiveMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Oy,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this}};Nh.prototype.isMeshLambertMaterial=!0;var WP=class extends $n{constructor(e){super();this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new Je(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=lh,this.normalScale=new ke(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.morphTargets=!1,this.morphNormals=!1,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.defines={MATCAP:""},this.color.copy(e.color),this.matcap=e.matcap,this.map=e.map,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this.flatShading=e.flatShading,this}};WP.prototype.isMeshMatcapMaterial=!0;var XP=class extends Na{constructor(e){super();this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}copy(e){return super.copy(e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this}};XP.prototype.isLineDashedMaterial=!0;var Kt={arraySlice:function(o,e,t){return Kt.isTypedArray(o)?new o.constructor(o.subarray(e,t!==void 0?t:o.length)):o.slice(e,t)},convertArray:function(o,e,t){return!o||!t&&o.constructor===e?o:typeof e.BYTES_PER_ELEMENT=="number"?new e(o):Array.prototype.slice.call(o)},isTypedArray:function(o){return ArrayBuffer.isView(o)&&!(o instanceof DataView)},getKeyframeOrder:function(o){function e(i,r){return o[i]-o[r]}let t=o.length,n=new Array(t);for(let i=0;i!==t;++i)n[i]=i;return n.sort(e),n},sortedArray:function(o,e,t){let n=o.length,i=new o.constructor(n);for(let r=0,s=0;s!==n;++r){let a=t[r]*e;for(let l=0;l!==e;++l)i[s++]=o[a+l]}return i},flattenJSON:function(o,e,t,n){let i=1,r=o[0];for(;r!==void 0&&r[n]===void 0;)r=o[i++];if(r===void 0)return;let s=r[n];if(s!==void 0)if(Array.isArray(s))do s=r[n],s!==void 0&&(e.push(r.time),t.push.apply(t,s)),r=o[i++];while(r!==void 0);else if(s.toArray!==void 0)do s=r[n],s!==void 0&&(e.push(r.time),s.toArray(t,t.length)),r=o[i++];while(r!==void 0);else do s=r[n],s!==void 0&&(e.push(r.time),t.push(s)),r=o[i++];while(r!==void 0)},subclip:function(o,e,t,n,i=30){let r=o.clone();r.name=e;let s=[];for(let l=0;l<r.tracks.length;++l){let c=r.tracks[l],u=c.getValueSize(),d=[],h=[];for(let f=0;f<c.times.length;++f){let p=c.times[f]*i;if(!(p<t||p>=n)){d.push(c.times[f]);for(let g=0;g<u;++g)h.push(c.values[f*u+g])}}d.length!==0&&(c.times=Kt.convertArray(d,c.times.constructor),c.values=Kt.convertArray(h,c.values.constructor),s.push(c))}r.tracks=s;let a=1/0;for(let l=0;l<r.tracks.length;++l)a>r.tracks[l].times[0]&&(a=r.tracks[l].times[0]);for(let l=0;l<r.tracks.length;++l)r.tracks[l].shift(-1*a);return r.resetDuration(),r},makeClipAdditive:function(o,e=0,t=o,n=30){n<=0&&(n=30);let i=t.tracks.length,r=e/n;for(let s=0;s<i;++s){let a=t.tracks[s],l=a.ValueTypeName;if(l==="bool"||l==="string")continue;let c=o.tracks.find(function(y){return y.name===a.name&&y.ValueTypeName===l});if(c===void 0)continue;let u=0,d=a.getValueSize();a.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(u=d/3);let h=0,f=c.getValueSize();c.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(h=f/3);let p=a.times.length-1,g;if(r<=a.times[0]){let y=u,m=d-u;g=Kt.arraySlice(a.values,y,m)}else if(r>=a.times[p]){let y=p*d+u,m=y+d-u;g=Kt.arraySlice(a.values,y,m)}else{let y=a.createInterpolant(),m=u,x=d-u;y.evaluate(r),g=Kt.arraySlice(y.resultBuffer,m,x)}l==="quaternion"&&new Kn().fromArray(g).normalize().conjugate().toArray(g);let v=c.times.length;for(let y=0;y<v;++y){let m=y*f+h;if(l==="quaternion")Kn.multiplyQuaternionsFlat(c.values,m,g,0,c.values,m);else{let x=f-h*2;for(let _=0;_<x;++_)c.values[m+_]-=g[_]}}}return o.blendMode=hR,o}},Eo=class{constructor(e,t,n,i){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=i!==void 0?i:new t.constructor(n),this.sampleValues=t,this.valueSize=n,this.settings=null,this.DefaultSettings_={}}evaluate(e){let t=this.parameterPositions,n=this._cachedIndex,i=t[n],r=t[n-1];e:{t:{let s;n:{i:if(!(e<i)){for(let a=n+2;;){if(i===void 0){if(e<r)break i;return n=t.length,this._cachedIndex=n,this.afterEnd_(n-1,e,r)}if(n===a)break;if(r=i,i=t[++n],e<i)break t}s=t.length;break n}if(!(e>=r)){let a=t[1];e<a&&(n=2,r=a);for(let l=n-2;;){if(r===void 0)return this._cachedIndex=0,this.beforeStart_(0,e,i);if(n===l)break;if(i=r,r=t[--n-1],e>=r)break t}s=n,n=0;break n}break e}for(;n<s;){let a=n+s>>>1;e<t[a]?s=a:n=a+1}if(i=t[n],r=t[n-1],r===void 0)return this._cachedIndex=0,this.beforeStart_(0,e,i);if(i===void 0)return n=t.length,this._cachedIndex=n,this.afterEnd_(n-1,r,e)}this._cachedIndex=n,this.intervalChanged_(n,r,i)}return this.interpolate_(n,r,e,i)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(e){let t=this.resultBuffer,n=this.sampleValues,i=this.valueSize,r=e*i;for(let s=0;s!==i;++s)t[s]=n[r+s];return t}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}};Eo.prototype.beforeStart_=Eo.prototype.copySampleValue_;Eo.prototype.afterEnd_=Eo.prototype.copySampleValue_;var qP=class extends Eo{constructor(e,t,n,i){super(e,t,n,i);this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:sh,endingEnd:sh}}intervalChanged_(e,t,n){let i=this.parameterPositions,r=e-2,s=e+1,a=i[r],l=i[s];if(a===void 0)switch(this.getSettings_().endingStart){case oh:r=e,a=2*t-n;break;case Wy:r=i.length-2,a=t+i[r]-i[r+1];break;default:r=e,a=n}if(l===void 0)switch(this.getSettings_().endingEnd){case oh:s=e,l=2*n-t;break;case Wy:s=1,l=n+i[1]-i[0];break;default:s=e-1,l=t}let c=(n-t)*.5,u=this.valueSize;this._weightPrev=c/(t-a),this._weightNext=c/(l-n),this._offsetPrev=r*u,this._offsetNext=s*u}interpolate_(e,t,n,i){let r=this.resultBuffer,s=this.sampleValues,a=this.valueSize,l=e*a,c=l-a,u=this._offsetPrev,d=this._offsetNext,h=this._weightPrev,f=this._weightNext,p=(n-t)/(i-t),g=p*p,v=g*p,y=-h*v+2*h*g-h*p,m=(1+h)*v+(-1.5-2*h)*g+(-.5+h)*p+1,x=(-1-f)*v+(1.5+f)*g+.5*p,_=f*v-f*g;for(let w=0;w!==a;++w)r[w]=y*s[u+w]+m*s[c+w]+x*s[l+w]+_*s[d+w];return r}},BM=class extends Eo{constructor(e,t,n,i){super(e,t,n,i)}interpolate_(e,t,n,i){let r=this.resultBuffer,s=this.sampleValues,a=this.valueSize,l=e*a,c=l-a,u=(n-t)/(i-t),d=1-u;for(let h=0;h!==a;++h)r[h]=s[c+h]*d+s[l+h]*u;return r}},jP=class extends Eo{constructor(e,t,n,i){super(e,t,n,i)}interpolate_(e){return this.copySampleValue_(e-1)}},Kr=class{constructor(e,t,n,i){if(e===void 0)throw new Error("THREE.KeyframeTrack: track name is undefined");if(t===void 0||t.length===0)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=Kt.convertArray(t,this.TimeBufferType),this.values=Kt.convertArray(n,this.ValueBufferType),this.setInterpolation(i||this.DefaultInterpolation)}static toJSON(e){let t=e.constructor,n;if(t.toJSON!==this.toJSON)n=t.toJSON(e);else{n={name:e.name,times:Kt.convertArray(e.times,Array),values:Kt.convertArray(e.values,Array)};let i=e.getInterpolation();i!==e.DefaultInterpolation&&(n.interpolation=i)}return n.type=e.ValueTypeName,n}InterpolantFactoryMethodDiscrete(e){return new jP(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodLinear(e){return new BM(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodSmooth(e){return new qP(this.times,this.values,this.getValueSize(),e)}setInterpolation(e){let t;switch(e){case Gy:t=this.InterpolantFactoryMethodDiscrete;break;case Vy:t=this.InterpolantFactoryMethodLinear;break;case Db:t=this.InterpolantFactoryMethodSmooth;break}if(t===void 0){let n="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(this.createInterpolant===void 0)if(e!==this.DefaultInterpolation)this.setInterpolation(this.DefaultInterpolation);else throw new Error(n);return console.warn("THREE.KeyframeTrack:",n),this}return this.createInterpolant=t,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return Gy;case this.InterpolantFactoryMethodLinear:return Vy;case this.InterpolantFactoryMethodSmooth:return Db}}getValueSize(){return this.values.length/this.times.length}shift(e){if(e!==0){let t=this.times;for(let n=0,i=t.length;n!==i;++n)t[n]+=e}return this}scale(e){if(e!==1){let t=this.times;for(let n=0,i=t.length;n!==i;++n)t[n]*=e}return this}trim(e,t){let n=this.times,i=n.length,r=0,s=i-1;for(;r!==i&&n[r]<e;)++r;for(;s!==-1&&n[s]>t;)--s;if(++s,r!==0||s!==i){r>=s&&(s=Math.max(s,1),r=s-1);let a=this.getValueSize();this.times=Kt.arraySlice(n,r,s),this.values=Kt.arraySlice(this.values,r*a,s*a)}return this}validate(){let e=!0,t=this.getValueSize();t-Math.floor(t)!=0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);let n=this.times,i=this.values,r=n.length;r===0&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);let s=null;for(let a=0;a!==r;a++){let l=n[a];if(typeof l=="number"&&isNaN(l)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,a,l),e=!1;break}if(s!==null&&s>l){console.error("THREE.KeyframeTrack: Out of order keys.",this,a,l,s),e=!1;break}s=l}if(i!==void 0&&Kt.isTypedArray(i))for(let a=0,l=i.length;a!==l;++a){let c=i[a];if(isNaN(c)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,a,c),e=!1;break}}return e}optimize(){let e=Kt.arraySlice(this.times),t=Kt.arraySlice(this.values),n=this.getValueSize(),i=this.getInterpolation()===Db,r=e.length-1,s=1;for(let a=1;a<r;++a){let l=!1,c=e[a],u=e[a+1];if(c!==u&&(a!==1||c!==e[0]))if(i)l=!0;else{let d=a*n,h=d-n,f=d+n;for(let p=0;p!==n;++p){let g=t[d+p];if(g!==t[h+p]||g!==t[f+p]){l=!0;break}}}if(l){if(a!==s){e[s]=e[a];let d=a*n,h=s*n;for(let f=0;f!==n;++f)t[h+f]=t[d+f]}++s}}if(r>0){e[s]=e[r];for(let a=r*n,l=s*n,c=0;c!==n;++c)t[l+c]=t[a+c];++s}return s!==e.length?(this.times=Kt.arraySlice(e,0,s),this.values=Kt.arraySlice(t,0,s*n)):(this.times=e,this.values=t),this}clone(){let e=Kt.arraySlice(this.times,0),t=Kt.arraySlice(this.values,0),n=this.constructor,i=new n(this.name,e,t);return i.createInterpolant=this.createInterpolant,i}};Kr.prototype.TimeBufferType=Float32Array;Kr.prototype.ValueBufferType=Float32Array;Kr.prototype.DefaultInterpolation=Vy;var nc=class extends Kr{};nc.prototype.ValueTypeName="bool";nc.prototype.ValueBufferType=Array;nc.prototype.DefaultInterpolation=Gy;nc.prototype.InterpolantFactoryMethodLinear=void 0;nc.prototype.InterpolantFactoryMethodSmooth=void 0;var NM=class extends Kr{};NM.prototype.ValueTypeName="color";var Rp=class extends Kr{};Rp.prototype.ValueTypeName="number";var YP=class extends Eo{constructor(e,t,n,i){super(e,t,n,i)}interpolate_(e,t,n,i){let r=this.resultBuffer,s=this.sampleValues,a=this.valueSize,l=(n-t)/(i-t),c=e*a;for(let u=c+a;c!==u;c+=4)Kn.slerpFlat(r,0,s,c-a,s,c,l);return r}},Oh=class extends Kr{InterpolantFactoryMethodLinear(e){return new YP(this.times,this.values,this.getValueSize(),e)}};Oh.prototype.ValueTypeName="quaternion";Oh.prototype.DefaultInterpolation=Vy;Oh.prototype.InterpolantFactoryMethodSmooth=void 0;var ic=class extends Kr{};ic.prototype.ValueTypeName="string";ic.prototype.ValueBufferType=Array;ic.prototype.DefaultInterpolation=Gy;ic.prototype.InterpolantFactoryMethodLinear=void 0;ic.prototype.InterpolantFactoryMethodSmooth=void 0;var Pp=class extends Kr{};Pp.prototype.ValueTypeName="vector";var OM=class{constructor(e,t=-1,n,i=Fb){this.name=e,this.tracks=n,this.duration=t,this.blendMode=i,this.uuid=_r(),this.duration<0&&this.resetDuration()}static parse(e){let t=[],n=e.tracks,i=1/(e.fps||1);for(let s=0,a=n.length;s!==a;++s)t.push(yX(n[s]).scale(i));let r=new this(e.name,e.duration,t,e.blendMode);return r.uuid=e.uuid,r}static toJSON(e){let t=[],n=e.tracks,i={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid,blendMode:e.blendMode};for(let r=0,s=n.length;r!==s;++r)t.push(Kr.toJSON(n[r]));return i}static CreateFromMorphTargetSequence(e,t,n,i){let r=t.length,s=[];for(let a=0;a<r;a++){let l=[],c=[];l.push((a+r-1)%r,a,(a+1)%r),c.push(0,1,0);let u=Kt.getKeyframeOrder(l);l=Kt.sortedArray(l,1,u),c=Kt.sortedArray(c,1,u),!i&&l[0]===0&&(l.push(r),c.push(c[0])),s.push(new Rp(".morphTargetInfluences["+t[a].name+"]",l,c).scale(1/n))}return new this(e,-1,s)}static findByName(e,t){let n=e;if(!Array.isArray(e)){let i=e;n=i.geometry&&i.geometry.animations||i.animations}for(let i=0;i<n.length;i++)if(n[i].name===t)return n[i];return null}static CreateClipsFromMorphTargetSequences(e,t,n){let i={},r=/^([\w-]*?)([\d]+)$/;for(let a=0,l=e.length;a<l;a++){let c=e[a],u=c.name.match(r);if(u&&u.length>1){let d=u[1],h=i[d];h||(i[d]=h=[]),h.push(c)}}let s=[];for(let a in i)s.push(this.CreateFromMorphTargetSequence(a,i[a],t,n));return s}static parseAnimation(e,t){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;let n=function(d,h,f,p,g){if(f.length!==0){let v=[],y=[];Kt.flattenJSON(f,v,y,p),v.length!==0&&g.push(new d(h,v,y))}},i=[],r=e.name||"default",s=e.fps||30,a=e.blendMode,l=e.length||-1,c=e.hierarchy||[];for(let d=0;d<c.length;d++){let h=c[d].keys;if(!(!h||h.length===0))if(h[0].morphTargets){let f={},p;for(p=0;p<h.length;p++)if(h[p].morphTargets)for(let g=0;g<h[p].morphTargets.length;g++)f[h[p].morphTargets[g]]=-1;for(let g in f){let v=[],y=[];for(let m=0;m!==h[p].morphTargets.length;++m){let x=h[p];v.push(x.time),y.push(x.morphTarget===g?1:0)}i.push(new Rp(".morphTargetInfluence["+g+"]",v,y))}l=f.length*(s||1)}else{let f=".bones["+t[d].name+"]";n(Pp,f+".position",h,"pos",i),n(Oh,f+".quaternion",h,"rot",i),n(Pp,f+".scale",h,"scl",i)}}return i.length===0?null:new this(r,l,i,a)}resetDuration(){let e=this.tracks,t=0;for(let n=0,i=e.length;n!==i;++n){let r=this.tracks[n];t=Math.max(t,r.times[r.times.length-1])}return this.duration=t,this}trim(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this}validate(){let e=!0;for(let t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e}optimize(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}clone(){let e=[];for(let t=0;t<this.tracks.length;t++)e.push(this.tracks[t].clone());return new this.constructor(this.name,this.duration,e,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}};function gX(o){switch(o.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return Rp;case"vector":case"vector2":case"vector3":case"vector4":return Pp;case"color":return NM;case"quaternion":return Oh;case"bool":case"boolean":return nc;case"string":return ic}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+o)}function yX(o){if(o.type===void 0)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");let e=gX(o.type);if(o.times===void 0){let t=[],n=[];Kt.flattenJSON(o.keys,t,n,"value"),o.times=t,o.values=n}return e.parse!==void 0?e.parse(o):new e(o.name,o.times,o.values,o.interpolation)}var kh={enabled:!1,files:{},add:function(o,e){this.enabled!==!1&&(this.files[o]=e)},get:function(o){if(this.enabled!==!1)return this.files[o]},remove:function(o){delete this.files[o]},clear:function(){this.files={}}},ZP=class{constructor(e,t,n){let i=this,r=!1,s=0,a=0,l,c=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=n,this.itemStart=function(u){a++,r===!1&&i.onStart!==void 0&&i.onStart(u,s,a),r=!0},this.itemEnd=function(u){s++,i.onProgress!==void 0&&i.onProgress(u,s,a),s===a&&(r=!1,i.onLoad!==void 0&&i.onLoad())},this.itemError=function(u){i.onError!==void 0&&i.onError(u)},this.resolveURL=function(u){return l?l(u):u},this.setURLModifier=function(u){return l=u,this},this.addHandler=function(u,d){return c.push(u,d),this},this.removeHandler=function(u){let d=c.indexOf(u);return d!==-1&&c.splice(d,2),this},this.getHandler=function(u){for(let d=0,h=c.length;d<h;d+=2){let f=c[d],p=c[d+1];if(f.global&&(f.lastIndex=0),f.test(u))return p}return null}}},vX=new ZP,Ao=class{constructor(e){this.manager=e!==void 0?e:vX,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,t){let n=this;return new Promise(function(i,r){n.load(e,i,t,r)})}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}},$r={},JP=class extends Ao{constructor(e){super(e)}load(e,t,n,i){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);let r=this,s=kh.get(e);if(s!==void 0)return r.manager.itemStart(e),setTimeout(function(){t&&t(s),r.manager.itemEnd(e)},0),s;if($r[e]!==void 0){$r[e].push({onLoad:t,onProgress:n,onError:i});return}let a=/^data:(.*?)(;base64)?,(.*)$/,l=e.match(a),c;if(l){let u=l[1],d=!!l[2],h=l[3];h=decodeURIComponent(h),d&&(h=atob(h));try{let f,p=(this.responseType||"").toLowerCase();switch(p){case"arraybuffer":case"blob":let g=new Uint8Array(h.length);for(let y=0;y<h.length;y++)g[y]=h.charCodeAt(y);p==="blob"?f=new Blob([g.buffer],{type:u}):f=g.buffer;break;case"document":f=new DOMParser().parseFromString(h,u);break;case"json":f=JSON.parse(h);break;default:f=h;break}setTimeout(function(){t&&t(f),r.manager.itemEnd(e)},0)}catch(f){setTimeout(function(){i&&i(f),r.manager.itemError(e),r.manager.itemEnd(e)},0)}}else{$r[e]=[],$r[e].push({onLoad:t,onProgress:n,onError:i}),c=new XMLHttpRequest,c.open("GET",e,!0),c.addEventListener("load",function(u){let d=this.response,h=$r[e];if(delete $r[e],this.status===200||this.status===0){this.status===0&&console.warn("THREE.FileLoader: HTTP Status 0 received."),kh.add(e,d);for(let f=0,p=h.length;f<p;f++){let g=h[f];g.onLoad&&g.onLoad(d)}r.manager.itemEnd(e)}else{for(let f=0,p=h.length;f<p;f++){let g=h[f];g.onError&&g.onError(u)}r.manager.itemError(e),r.manager.itemEnd(e)}},!1),c.addEventListener("progress",function(u){let d=$r[e];for(let h=0,f=d.length;h<f;h++){let p=d[h];p.onProgress&&p.onProgress(u)}},!1),c.addEventListener("error",function(u){let d=$r[e];delete $r[e];for(let h=0,f=d.length;h<f;h++){let p=d[h];p.onError&&p.onError(u)}r.manager.itemError(e),r.manager.itemEnd(e)},!1),c.addEventListener("abort",function(u){let d=$r[e];delete $r[e];for(let h=0,f=d.length;h<f;h++){let p=d[h];p.onError&&p.onError(u)}r.manager.itemError(e),r.manager.itemEnd(e)},!1),this.responseType!==void 0&&(c.responseType=this.responseType),this.withCredentials!==void 0&&(c.withCredentials=this.withCredentials),c.overrideMimeType&&c.overrideMimeType(this.mimeType!==void 0?this.mimeType:"text/plain");for(let u in this.requestHeader)c.setRequestHeader(u,this.requestHeader[u]);c.send(null)}return r.manager.itemStart(e),c}setResponseType(e){return this.responseType=e,this}setMimeType(e){return this.mimeType=e,this}};var kM=class extends Ao{constructor(e){super(e)}load(e,t,n,i){this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);let r=this,s=kh.get(e);if(s!==void 0)return r.manager.itemStart(e),setTimeout(function(){t&&t(s),r.manager.itemEnd(e)},0),s;let a=document.createElementNS("http://www.w3.org/1999/xhtml","img");function l(){a.removeEventListener("load",l,!1),a.removeEventListener("error",c,!1),kh.add(e,this),t&&t(this),r.manager.itemEnd(e)}function c(u){a.removeEventListener("load",l,!1),a.removeEventListener("error",c,!1),i&&i(u),r.manager.itemError(e),r.manager.itemEnd(e)}return a.addEventListener("load",l,!1),a.addEventListener("error",c,!1),e.substr(0,5)!=="data:"&&this.crossOrigin!==void 0&&(a.crossOrigin=this.crossOrigin),r.manager.itemStart(e),a.src=e,a}},KP=class extends Ao{constructor(e){super(e)}load(e,t,n,i){let r=new up,s=new kM(this.manager);s.setCrossOrigin(this.crossOrigin),s.setPath(this.path);let a=0;function l(c){s.load(e[c],function(u){r.images[c]=u,a++,a===6&&(r.needsUpdate=!0,t&&t(r))},void 0,i)}for(let c=0;c<e.length;++c)l(c);return r}};var $P=class extends Ao{constructor(e){super(e)}load(e,t,n,i){let r=new On,s=new kM(this.manager);return s.setCrossOrigin(this.crossOrigin),s.setPath(this.path),s.load(e,function(a){r.image=a;let l=e.search(/\.jpe?g($|\?)/i)>0||e.search(/^data\:image\/jpeg/)===0;r.format=l?Jl:Cs,r.needsUpdate=!0,t!==void 0&&t(r)},n,i),r}},QP=class extends er{constructor(){super();this.type="CurvePath",this.curves=[],this.autoClose=!1}add(e){this.curves.push(e)}closePath(){let e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);e.equals(t)||this.curves.push(new Mp(t,e))}getPoint(e){let t=e*this.getLength(),n=this.getCurveLengths(),i=0;for(;i<n.length;){if(n[i]>=t){let r=n[i]-t,s=this.curves[i],a=s.getLength(),l=a===0?0:1-r/a;return s.getPointAt(l)}i++}return null}getLength(){let e=this.getCurveLengths();return e[e.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;let e=[],t=0;for(let n=0,i=this.curves.length;n<i;n++)t+=this.curves[n].getLength(),e.push(t);return this.cacheLengths=e,e}getSpacedPoints(e=40){let t=[];for(let n=0;n<=e;n++)t.push(this.getPoint(n/e));return this.autoClose&&t.push(t[0]),t}getPoints(e=12){let t=[],n;for(let i=0,r=this.curves;i<r.length;i++){let s=r[i],a=s&&s.isEllipseCurve?e*2:s&&(s.isLineCurve||s.isLineCurve3)?1:s&&s.isSplineCurve?e*s.points.length:e,l=s.getPoints(a);for(let c=0;c<l.length;c++){let u=l[c];n&&n.equals(u)||(t.push(u),n=u)}}return this.autoClose&&t.length>1&&!t[t.length-1].equals(t[0])&&t.push(t[0]),t}copy(e){super.copy(e),this.curves=[];for(let t=0,n=e.curves.length;t<n;t++){let i=e.curves[t];this.curves.push(i.clone())}return this.autoClose=e.autoClose,this}toJSON(){let e=super.toJSON();e.autoClose=this.autoClose,e.curves=[];for(let t=0,n=this.curves.length;t<n;t++){let i=this.curves[t];e.curves.push(i.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.autoClose=e.autoClose,this.curves=[];for(let t=0,n=e.curves.length;t<n;t++){let i=e.curves[t];this.curves.push(new BP[i.type]().fromJSON(i))}return this}},Ip=class extends QP{constructor(e){super();this.type="Path",this.currentPoint=new ke,e&&this.setFromPoints(e)}setFromPoints(e){this.moveTo(e[0].x,e[0].y);for(let t=1,n=e.length;t<n;t++)this.lineTo(e[t].x,e[t].y);return this}moveTo(e,t){return this.currentPoint.set(e,t),this}lineTo(e,t){let n=new Mp(this.currentPoint.clone(),new ke(e,t));return this.curves.push(n),this.currentPoint.set(e,t),this}quadraticCurveTo(e,t,n,i){let r=new E0(this.currentPoint.clone(),new ke(e,t),new ke(n,i));return this.curves.push(r),this.currentPoint.set(n,i),this}bezierCurveTo(e,t,n,i,r,s){let a=new T0(this.currentPoint.clone(),new ke(e,t),new ke(n,i),new ke(r,s));return this.curves.push(a),this.currentPoint.set(r,s),this}splineThru(e){let t=[this.currentPoint.clone()].concat(e),n=new A0(t);return this.curves.push(n),this.currentPoint.copy(e[e.length-1]),this}arc(e,t,n,i,r,s){let a=this.currentPoint.x,l=this.currentPoint.y;return this.absarc(e+a,t+l,n,i,r,s),this}absarc(e,t,n,i,r,s){return this.absellipse(e,t,n,n,i,r,s),this}ellipse(e,t,n,i,r,s,a,l){let c=this.currentPoint.x,u=this.currentPoint.y;return this.absellipse(e+c,t+u,n,i,r,s,a,l),this}absellipse(e,t,n,i,r,s,a,l){let c=new _p(e,t,n,i,r,s,a,l);if(this.curves.length>0){let d=c.getPoint(0);d.equals(this.currentPoint)||this.lineTo(d.x,d.y)}this.curves.push(c);let u=c.getPoint(1);return this.currentPoint.copy(u),this}copy(e){return super.copy(e),this.currentPoint.copy(e.currentPoint),this}toJSON(){let e=super.toJSON();return e.currentPoint=this.currentPoint.toArray(),e}fromJSON(e){return super.fromJSON(e),this.currentPoint.fromArray(e.currentPoint),this}},rc=class extends Ip{constructor(e){super(e);this.uuid=_r(),this.type="Shape",this.holes=[]}getPointsHoles(e){let t=[];for(let n=0,i=this.holes.length;n<i;n++)t[n]=this.holes[n].getPoints(e);return t}extractPoints(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}}copy(e){super.copy(e),this.holes=[];for(let t=0,n=e.holes.length;t<n;t++){let i=e.holes[t];this.holes.push(i.clone())}return this}toJSON(){let e=super.toJSON();e.uuid=this.uuid,e.holes=[];for(let t=0,n=this.holes.length;t<n;t++){let i=this.holes[t];e.holes.push(i.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.uuid=e.uuid,this.holes=[];for(let t=0,n=e.holes.length;t<n;t++){let i=e.holes[t];this.holes.push(new Ip().fromJSON(i))}return this}},Qr=class extends Tt{constructor(e,t=1){super();this.type="Light",this.color=new Je(e),this.intensity=t}dispose(){}copy(e){return super.copy(e),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){let t=super.toJSON(e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,this.groundColor!==void 0&&(t.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(t.object.distance=this.distance),this.angle!==void 0&&(t.object.angle=this.angle),this.decay!==void 0&&(t.object.decay=this.decay),this.penumbra!==void 0&&(t.object.penumbra=this.penumbra),this.shadow!==void 0&&(t.object.shadow=this.shadow.toJSON()),t}};Qr.prototype.isLight=!0;var e3=class extends Qr{constructor(e,t,n){super(e,n);this.type="HemisphereLight",this.position.copy(Tt.DefaultUp),this.updateMatrix(),this.groundColor=new Je(t)}copy(e){return Qr.prototype.copy.call(this,e),this.groundColor.copy(e.groundColor),this}};e3.prototype.isHemisphereLight=!0;var t3=new Qe,n3=new le,i3=new le,N0=class{constructor(e){this.camera=e,this.bias=0,this.normalBias=0,this.radius=1,this.mapSize=new ke(512,512),this.map=null,this.mapPass=null,this.matrix=new Qe,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new hp,this._frameExtents=new ke(1,1),this._viewportCount=1,this._viewports=[new Nt(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){let t=this.camera,n=this.matrix;n3.setFromMatrixPosition(e.matrixWorld),t.position.copy(n3),i3.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(i3),t.updateMatrixWorld(),t3.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(t3),n.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),n.multiply(t.projectionMatrix),n.multiply(t.matrixWorldInverse)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){let e={};return this.bias!==0&&(e.bias=this.bias),this.normalBias!==0&&(e.normalBias=this.normalBias),this.radius!==1&&(e.radius=this.radius),(this.mapSize.x!==512||this.mapSize.y!==512)&&(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}},zM=class extends N0{constructor(){super(new ki(50,1,.5,500));this.focus=1}updateMatrices(e){let t=this.camera,n=rp*2*e.angle*this.focus,i=this.mapSize.width/this.mapSize.height,r=e.distance||t.far;(n!==t.fov||i!==t.aspect||r!==t.far)&&(t.fov=n,t.aspect=i,t.far=r,t.updateProjectionMatrix()),super.updateMatrices(e)}copy(e){return super.copy(e),this.focus=e.focus,this}};zM.prototype.isSpotLightShadow=!0;var r3=class extends Qr{constructor(e,t,n=0,i=Math.PI/3,r=0,s=1){super(e,t);this.type="SpotLight",this.position.copy(Tt.DefaultUp),this.updateMatrix(),this.target=new Tt,this.distance=n,this.angle=i,this.penumbra=r,this.decay=s,this.shadow=new zM}get power(){return this.intensity*Math.PI}set power(e){this.intensity=e/Math.PI}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}};r3.prototype.isSpotLight=!0;var s3=new Qe,Dp=new le,UM=new le,HM=class extends N0{constructor(){super(new ki(90,1,.5,500));this._frameExtents=new ke(4,2),this._viewportCount=6,this._viewports=[new Nt(2,1,1,1),new Nt(0,1,1,1),new Nt(3,1,1,1),new Nt(1,1,1,1),new Nt(3,0,1,1),new Nt(1,0,1,1)],this._cubeDirections=[new le(1,0,0),new le(-1,0,0),new le(0,0,1),new le(0,0,-1),new le(0,1,0),new le(0,-1,0)],this._cubeUps=[new le(0,1,0),new le(0,1,0),new le(0,1,0),new le(0,1,0),new le(0,0,1),new le(0,0,-1)]}updateMatrices(e,t=0){let n=this.camera,i=this.matrix,r=e.distance||n.far;r!==n.far&&(n.far=r,n.updateProjectionMatrix()),Dp.setFromMatrixPosition(e.matrixWorld),n.position.copy(Dp),UM.copy(n.position),UM.add(this._cubeDirections[t]),n.up.copy(this._cubeUps[t]),n.lookAt(UM),n.updateMatrixWorld(),i.makeTranslation(-Dp.x,-Dp.y,-Dp.z),s3.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),this._frustum.setFromProjectionMatrix(s3)}};HM.prototype.isPointLightShadow=!0;var o3=class extends Qr{constructor(e,t,n=0,i=1){super(e,t);this.type="PointLight",this.distance=n,this.decay=i,this.shadow=new HM}get power(){return this.intensity*4*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}};o3.prototype.isPointLight=!0;var GM=class extends c0{constructor(e=-1,t=1,n=1,i=-1,r=.1,s=2e3){super();this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=n,this.bottom=i,this.near=r,this.far=s,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=e.view===null?null:Object.assign({},e.view),this}setViewOffset(e,t,n,i,r,s){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=i,this.view.width=r,this.view.height=s,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){let e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,i=(this.top+this.bottom)/2,r=n-e,s=n+e,a=i+t,l=i-t;if(this.view!==null&&this.view.enabled){let c=(this.right-this.left)/this.view.fullWidth/this.zoom,u=(this.top-this.bottom)/this.view.fullHeight/this.zoom;r+=c*this.view.offsetX,s=r+c*this.view.width,a-=u*this.view.offsetY,l=a-u*this.view.height}this.projectionMatrix.makeOrthographic(r,s,a,l,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){let t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,this.view!==null&&(t.object.view=Object.assign({},this.view)),t}};GM.prototype.isOrthographicCamera=!0;var VM=class extends N0{constructor(){super(new GM(-5,5,5,-5,.5,500))}};VM.prototype.isDirectionalLightShadow=!0;var a3=class extends Qr{constructor(e,t){super(e,t);this.type="DirectionalLight",this.position.copy(Tt.DefaultUp),this.updateMatrix(),this.target=new Tt,this.shadow=new VM}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}};a3.prototype.isDirectionalLight=!0;var l3=class extends Qr{constructor(e,t){super(e,t);this.type="AmbientLight"}};l3.prototype.isAmbientLight=!0;var c3=class extends Qr{constructor(e,t,n=10,i=10){super(e,t);this.type="RectAreaLight",this.width=n,this.height=i}copy(e){return super.copy(e),this.width=e.width,this.height=e.height,this}toJSON(e){let t=super.toJSON(e);return t.object.width=this.width,t.object.height=this.height,t}};c3.prototype.isRectAreaLight=!0;var WM=class{constructor(){this.coefficients=[];for(let e=0;e<9;e++)this.coefficients.push(new le)}set(e){for(let t=0;t<9;t++)this.coefficients[t].copy(e[t]);return this}zero(){for(let e=0;e<9;e++)this.coefficients[e].set(0,0,0);return this}getAt(e,t){let n=e.x,i=e.y,r=e.z,s=this.coefficients;return t.copy(s[0]).multiplyScalar(.282095),t.addScaledVector(s[1],.488603*i),t.addScaledVector(s[2],.488603*r),t.addScaledVector(s[3],.488603*n),t.addScaledVector(s[4],1.092548*(n*i)),t.addScaledVector(s[5],1.092548*(i*r)),t.addScaledVector(s[6],.315392*(3*r*r-1)),t.addScaledVector(s[7],1.092548*(n*r)),t.addScaledVector(s[8],.546274*(n*n-i*i)),t}getIrradianceAt(e,t){let n=e.x,i=e.y,r=e.z,s=this.coefficients;return t.copy(s[0]).multiplyScalar(.886227),t.addScaledVector(s[1],2*.511664*i),t.addScaledVector(s[2],2*.511664*r),t.addScaledVector(s[3],2*.511664*n),t.addScaledVector(s[4],2*.429043*n*i),t.addScaledVector(s[5],2*.429043*i*r),t.addScaledVector(s[6],.743125*r*r-.247708),t.addScaledVector(s[7],2*.429043*n*r),t.addScaledVector(s[8],.429043*(n*n-i*i)),t}add(e){for(let t=0;t<9;t++)this.coefficients[t].add(e.coefficients[t]);return this}addScaledSH(e,t){for(let n=0;n<9;n++)this.coefficients[n].addScaledVector(e.coefficients[n],t);return this}scale(e){for(let t=0;t<9;t++)this.coefficients[t].multiplyScalar(e);return this}lerp(e,t){for(let n=0;n<9;n++)this.coefficients[n].lerp(e.coefficients[n],t);return this}equals(e){for(let t=0;t<9;t++)if(!this.coefficients[t].equals(e.coefficients[t]))return!1;return!0}copy(e){return this.set(e.coefficients)}clone(){return new this.constructor().copy(this)}fromArray(e,t=0){let n=this.coefficients;for(let i=0;i<9;i++)n[i].fromArray(e,t+i*3);return this}toArray(e=[],t=0){let n=this.coefficients;for(let i=0;i<9;i++)n[i].toArray(e,t+i*3);return e}static getBasisAt(e,t){let n=e.x,i=e.y,r=e.z;t[0]=.282095,t[1]=.488603*i,t[2]=.488603*r,t[3]=.488603*n,t[4]=1.092548*n*i,t[5]=1.092548*i*r,t[6]=.315392*(3*r*r-1),t[7]=1.092548*n*r,t[8]=.546274*(n*n-i*i)}};WM.prototype.isSphericalHarmonics3=!0;var O0=class extends Qr{constructor(e=new WM,t=1){super(void 0,t);this.sh=e}copy(e){return super.copy(e),this.sh.copy(e.sh),this}fromJSON(e){return this.intensity=e.intensity,this.sh.fromArray(e.sh),this}toJSON(e){let t=super.toJSON(e);return t.object.sh=this.sh.toArray(),t}};O0.prototype.isLightProbe=!0;var u3=class{static decodeText(e){if(typeof TextDecoder!="undefined")return new TextDecoder().decode(e);let t="";for(let n=0,i=e.length;n<i;n++)t+=String.fromCharCode(e[n]);try{return decodeURIComponent(escape(t))}catch(n){return t}}static extractUrlBase(e){let t=e.lastIndexOf("/");return t===-1?"./":e.substr(0,t+1)}},h3=class extends kt{constructor(){super();this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(e){return super.copy(e),this.instanceCount=e.instanceCount,this}clone(){return new this.constructor().copy(this)}toJSON(){let e=super.toJSON(this);return e.instanceCount=this.instanceCount,e.isInstancedBufferGeometry=!0,e}};h3.prototype.isInstancedBufferGeometry=!0;var d3=class extends Rn{constructor(e,t,n,i=1){typeof n=="number"&&(i=n,n=!1,console.error("THREE.InstancedBufferAttribute: The constructor now expects normalized as the third argument."));super(e,t,n);this.meshPerAttribute=i}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}toJSON(){let e=super.toJSON();return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}};d3.prototype.isInstancedBufferAttribute=!0;var f3=class extends Ao{constructor(e){super(e);typeof createImageBitmap=="undefined"&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),typeof fetch=="undefined"&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(e){return this.options=e,this}load(e,t,n,i){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);let r=this,s=kh.get(e);if(s!==void 0)return r.manager.itemStart(e),setTimeout(function(){t&&t(s),r.manager.itemEnd(e)},0),s;let a={};a.credentials=this.crossOrigin==="anonymous"?"same-origin":"include",a.headers=this.requestHeader,fetch(e,a).then(function(l){return l.blob()}).then(function(l){return createImageBitmap(l,Object.assign(r.options,{colorSpaceConversion:"none"}))}).then(function(l){kh.add(e,l),t&&t(l),r.manager.itemEnd(e)}).catch(function(l){i&&i(l),r.manager.itemError(e),r.manager.itemEnd(e)}),r.manager.itemStart(e)}};f3.prototype.isImageBitmapLoader=!0;var p3=class{constructor(){this.type="ShapePath",this.color=new Je,this.subPaths=[],this.currentPath=null}moveTo(e,t){return this.currentPath=new Ip,this.subPaths.push(this.currentPath),this.currentPath.moveTo(e,t),this}lineTo(e,t){return this.currentPath.lineTo(e,t),this}quadraticCurveTo(e,t,n,i){return this.currentPath.quadraticCurveTo(e,t,n,i),this}bezierCurveTo(e,t,n,i,r,s){return this.currentPath.bezierCurveTo(e,t,n,i,r,s),this}splineThru(e){return this.currentPath.splineThru(e),this}toShapes(e,t){function n(m){let x=[];for(let _=0,w=m.length;_<w;_++){let b=m[_],M=new rc;M.curves=b.curves,x.push(M)}return x}function i(m,x){let _=x.length,w=!1;for(let b=_-1,M=0;M<_;b=M++){let S=x[b],E=x[M],A=E.x-S.x,L=E.y-S.y;if(Math.abs(L)>Number.EPSILON){if(L<0&&(S=x[M],A=-A,E=x[b],L=-L),m.y<S.y||m.y>E.y)continue;if(m.y===S.y){if(m.x===S.x)return!0}else{let B=L*(m.x-S.x)-A*(m.y-S.y);if(B===0)return!0;if(B<0)continue;w=!w}}else{if(m.y!==S.y)continue;if(E.x<=m.x&&m.x<=S.x||S.x<=m.x&&m.x<=E.x)return!0}}return w}let r=Is.isClockWise,s=this.subPaths;if(s.length===0)return[];if(t===!0)return n(s);let a,l,c,u=[];if(s.length===1)return l=s[0],c=new rc,c.curves=l.curves,u.push(c),u;let d=!r(s[0].getPoints());d=e?!d:d;let h=[],f=[],p=[],g=0,v;f[g]=void 0,p[g]=[];for(let m=0,x=s.length;m<x;m++)l=s[m],v=l.getPoints(),a=r(v),a=e?!a:a,a?(!d&&f[g]&&g++,f[g]={s:new rc,p:v},f[g].s.curves=l.curves,d&&g++,p[g]=[]):p[g].push({h:l,p:v[0]});if(!f[0])return n(s);if(f.length>1){let m=!1,x=[];for(let _=0,w=f.length;_<w;_++)h[_]=[];for(let _=0,w=f.length;_<w;_++){let b=p[_];for(let M=0;M<b.length;M++){let S=b[M],E=!0;for(let A=0;A<f.length;A++)i(S.p,f[A].p)&&(_!==A&&x.push({froms:_,tos:A,hole:M}),E?(E=!1,h[A].push(S)):m=!0);E&&h[_].push(S)}}x.length>0&&(m||(p=h))}let y;for(let m=0,x=f.length;m<x;m++){c=f[m].s,u.push(c),y=p[m];for(let _=0,w=y.length;_<w;_++)c.holes.push(y[_].h)}return u}},m3=class{constructor(e){this.type="Font",this.data=e}generateShapes(e,t=100){let n=[],i=xX(e,t,this.data);for(let r=0,s=i.length;r<s;r++)Array.prototype.push.apply(n,i[r].toShapes());return n}};function xX(o,e,t){let n=Array.from(o),i=e/t.resolution,r=(t.boundingBox.yMax-t.boundingBox.yMin+t.underlineThickness)*i,s=[],a=0,l=0;for(let c=0;c<n.length;c++){let u=n[c];if(u===`
`)a=0,l-=r;else{let d=_X(u,i,a,l,t);a+=d.offsetX,s.push(d.path)}}return s}function _X(o,e,t,n,i){let r=i.glyphs[o]||i.glyphs["?"];if(!r){console.error('THREE.Font: character "'+o+'" does not exists in font family '+i.familyName+".");return}let s=new p3,a,l,c,u,d,h,f,p;if(r.o){let g=r._cachedOutline||(r._cachedOutline=r.o.split(" "));for(let v=0,y=g.length;v<y;)switch(g[v++]){case"m":a=g[v++]*e+t,l=g[v++]*e+n,s.moveTo(a,l);break;case"l":a=g[v++]*e+t,l=g[v++]*e+n,s.lineTo(a,l);break;case"q":c=g[v++]*e+t,u=g[v++]*e+n,d=g[v++]*e+t,h=g[v++]*e+n,s.quadraticCurveTo(d,h,c,u);break;case"b":c=g[v++]*e+t,u=g[v++]*e+n,d=g[v++]*e+t,h=g[v++]*e+n,f=g[v++]*e+t,p=g[v++]*e+n,s.bezierCurveTo(d,h,f,p,c,u);break}}return{offsetX:r.ha*e,path:s}}m3.prototype.isFont=!0;var k0,wX={getContext:function(){return k0===void 0&&(k0=new(window.AudioContext||window.webkitAudioContext)),k0},setContext:function(o){k0=o}},g3=class extends Ao{constructor(e){super(e)}load(e,t,n,i){let r=this,s=new JP(this.manager);s.setResponseType("arraybuffer"),s.setPath(this.path),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials),s.load(e,function(a){try{let l=a.slice(0);wX.getContext().decodeAudioData(l,function(u){t(u)})}catch(l){i?i(l):console.error(l),r.manager.itemError(e)}},n,i)}},y3=class extends O0{constructor(e,t,n=1){super(void 0,n);let i=new Je().set(e),r=new Je().set(t),s=new le(i.r,i.g,i.b),a=new le(r.r,r.g,r.b),l=Math.sqrt(Math.PI),c=l*Math.sqrt(.75);this.sh.coefficients[0].copy(s).add(a).multiplyScalar(l),this.sh.coefficients[1].copy(s).sub(a).multiplyScalar(c)}};y3.prototype.isHemisphereLightProbe=!0;var v3=class extends O0{constructor(e,t=1){super(void 0,t);let n=new Je().set(e);this.sh.coefficients[0].set(n.r,n.g,n.b).multiplyScalar(2*Math.sqrt(Math.PI))}};v3.prototype.isAmbientLightProbe=!0;var x3=class extends Tt{constructor(e){super();this.type="Audio",this.listener=e,this.context=e.context,this.gain=this.context.createGain(),this.gain.connect(e.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(e){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=e,this.connect(),this}setMediaElementSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(e),this.connect(),this}setMediaStreamSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(e),this.connect(),this}setBuffer(e){return this.buffer=e,this.sourceType="buffer",this.autoplay&&this.play(),this}play(e=0){if(this.isPlaying===!0){console.warn("THREE.Audio: Audio is already playing.");return}if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}this._startedAt=this.context.currentTime+e;let t=this.context.createBufferSource();return t.buffer=this.buffer,t.loop=this.loop,t.loopStart=this.loopStart,t.loopEnd=this.loopEnd,t.onended=this.onEnded.bind(this),t.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=t,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.isPlaying===!0&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,this.loop===!0&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this}stop(){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this._progress=0,this.source.stop(),this.source.onended=null,this.isPlaying=!1,this}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].connect(this.filters[e]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].disconnect(this.filters[e]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}getFilters(){return this.filters}setFilters(e){return e||(e=[]),this._connected===!0?(this.disconnect(),this.filters=e.slice(),this.connect()):this.filters=e.slice(),this}setDetune(e){if(this.detune=e,this.source.detune!==void 0)return this.isPlaying===!0&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(e){return this.setFilters(e?[e]:[])}setPlaybackRate(e){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.playbackRate=e,this.isPlaying===!0&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1}getLoop(){return this.hasPlaybackControl===!1?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}setLoop(e){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.loop=e,this.isPlaying===!0&&(this.source.loop=this.loop),this}setLoopStart(e){return this.loopStart=e,this}setLoopEnd(e){return this.loopEnd=e,this}getVolume(){return this.gain.gain.value}setVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}};var _3=class{constructor(e,t=2048){this.analyser=e.context.createAnalyser(),this.analyser.fftSize=t,this.data=new Uint8Array(this.analyser.frequencyBinCount),e.getOutput().connect(this.analyser)}getFrequencyData(){return this.analyser.getByteFrequencyData(this.data),this.data}getAverageFrequency(){let e=0,t=this.getFrequencyData();for(let n=0;n<t.length;n++)e+=t[n];return e/t.length}},w3=class{constructor(e,t,n){this.binding=e,this.valueSize=n;let i,r,s;switch(t){case"quaternion":i=this._slerp,r=this._slerpAdditive,s=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(n*6),this._workIndex=5;break;case"string":case"bool":i=this._select,r=this._select,s=this._setAdditiveIdentityOther,this.buffer=new Array(n*5);break;default:i=this._lerp,r=this._lerpAdditive,s=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(n*5)}this._mixBufferRegion=i,this._mixBufferRegionAdditive=r,this._setIdentity=s,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(e,t){let n=this.buffer,i=this.valueSize,r=e*i+i,s=this.cumulativeWeight;if(s===0){for(let a=0;a!==i;++a)n[r+a]=n[a];s=t}else{s+=t;let a=t/s;this._mixBufferRegion(n,r,0,a,i)}this.cumulativeWeight=s}accumulateAdditive(e){let t=this.buffer,n=this.valueSize,i=n*this._addIndex;this.cumulativeWeightAdditive===0&&this._setIdentity(),this._mixBufferRegionAdditive(t,i,0,e,n),this.cumulativeWeightAdditive+=e}apply(e){let t=this.valueSize,n=this.buffer,i=e*t+t,r=this.cumulativeWeight,s=this.cumulativeWeightAdditive,a=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,r<1){let l=t*this._origIndex;this._mixBufferRegion(n,i,l,1-r,t)}s>0&&this._mixBufferRegionAdditive(n,i,this._addIndex*t,1,t);for(let l=t,c=t+t;l!==c;++l)if(n[l]!==n[l+t]){a.setValue(n,i);break}}saveOriginalState(){let e=this.binding,t=this.buffer,n=this.valueSize,i=n*this._origIndex;e.getValue(t,i);for(let r=n,s=i;r!==s;++r)t[r]=t[i+r%n];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){let e=this.valueSize*3;this.binding.setValue(this.buffer,e)}_setAdditiveIdentityNumeric(){let e=this._addIndex*this.valueSize,t=e+this.valueSize;for(let n=e;n<t;n++)this.buffer[n]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){let e=this._origIndex*this.valueSize,t=this._addIndex*this.valueSize;for(let n=0;n<this.valueSize;n++)this.buffer[t+n]=this.buffer[e+n]}_select(e,t,n,i,r){if(i>=.5)for(let s=0;s!==r;++s)e[t+s]=e[n+s]}_slerp(e,t,n,i){Kn.slerpFlat(e,t,e,t,e,n,i)}_slerpAdditive(e,t,n,i,r){let s=this._workIndex*r;Kn.multiplyQuaternionsFlat(e,s,e,t,e,n),Kn.slerpFlat(e,t,e,t,e,s,i)}_lerp(e,t,n,i,r){let s=1-i;for(let a=0;a!==r;++a){let l=t+a;e[l]=e[l]*s+e[n+a]*i}}_lerpAdditive(e,t,n,i,r){for(let s=0;s!==r;++s){let a=t+s;e[a]=e[a]+e[n+s]*i}}},XM="\\[\\]\\.:\\/",bX=new RegExp("["+XM+"]","g"),qM="[^"+XM+"]",MX="[^"+XM.replace("\\.","")+"]",SX=/((?:WC+[\/:])*)/.source.replace("WC",qM),TX=/(WCOD+)?/.source.replace("WCOD",MX),EX=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",qM),AX=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",qM),CX=new RegExp("^"+SX+TX+EX+AX+"$"),LX=["material","materials","bones"],b3=class{constructor(e,t,n){let i=n||bt.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,i)}getValue(e,t){this.bind();let n=this._targetGroup.nCachedObjects_,i=this._bindings[n];i!==void 0&&i.getValue(e,t)}setValue(e,t){let n=this._bindings;for(let i=this._targetGroup.nCachedObjects_,r=n.length;i!==r;++i)n[i].setValue(e,t)}bind(){let e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].bind()}unbind(){let e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].unbind()}},bt=class{constructor(e,t,n){this.path=t,this.parsedPath=n||bt.parseTrackName(t),this.node=bt.findNode(e,this.parsedPath.nodeName)||e,this.rootNode=e,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(e,t,n){return e&&e.isAnimationObjectGroup?new bt.Composite(e,t,n):new bt(e,t,n)}static sanitizeNodeName(e){return e.replace(/\s/g,"_").replace(bX,"")}static parseTrackName(e){let t=CX.exec(e);if(!t)throw new Error("PropertyBinding: Cannot parse trackName: "+e);let n={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},i=n.nodeName&&n.nodeName.lastIndexOf(".");if(i!==void 0&&i!==-1){let r=n.nodeName.substring(i+1);LX.indexOf(r)!==-1&&(n.nodeName=n.nodeName.substring(0,i),n.objectName=r)}if(n.propertyName===null||n.propertyName.length===0)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return n}static findNode(e,t){if(!t||t===""||t==="."||t===-1||t===e.name||t===e.uuid)return e;if(e.skeleton){let n=e.skeleton.getBoneByName(t);if(n!==void 0)return n}if(e.children){let n=function(r){for(let s=0;s<r.length;s++){let a=r[s];if(a.name===t||a.uuid===t)return a;let l=n(a.children);if(l)return l}return null},i=n(e.children);if(i)return i}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(e,t){e[t]=this.node[this.propertyName]}_getValue_array(e,t){let n=this.resolvedProperty;for(let i=0,r=n.length;i!==r;++i)e[t++]=n[i]}_getValue_arrayElement(e,t){e[t]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(e,t){this.resolvedProperty.toArray(e,t)}_setValue_direct(e,t){this.targetObject[this.propertyName]=e[t]}_setValue_direct_setNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(e,t){let n=this.resolvedProperty;for(let i=0,r=n.length;i!==r;++i)n[i]=e[t++]}_setValue_array_setNeedsUpdate(e,t){let n=this.resolvedProperty;for(let i=0,r=n.length;i!==r;++i)n[i]=e[t++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(e,t){let n=this.resolvedProperty;for(let i=0,r=n.length;i!==r;++i)n[i]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(e,t){this.resolvedProperty[this.propertyIndex]=e[t]}_setValue_arrayElement_setNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(e,t){this.resolvedProperty.fromArray(e,t)}_setValue_fromArray_setNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(e,t){this.bind(),this.getValue(e,t)}_setValue_unbound(e,t){this.bind(),this.setValue(e,t)}bind(){let e=this.node,t=this.parsedPath,n=t.objectName,i=t.propertyName,r=t.propertyIndex;if(e||(e=bt.findNode(this.rootNode,t.nodeName)||this.rootNode,this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!e){console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.");return}if(n){let c=t.objectIndex;switch(n){case"materials":if(!e.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.materials){console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);return}e=e.material.materials;break;case"bones":if(!e.skeleton){console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);return}e=e.skeleton.bones;for(let u=0;u<e.length;u++)if(e[u].name===c){c=u;break}break;default:if(e[n]===void 0){console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);return}e=e[n]}if(c!==void 0){if(e[c]===void 0){console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);return}e=e[c]}}let s=e[i];if(s===void 0){let c=t.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+c+"."+i+" but it wasn't found.",e);return}let a=this.Versioning.None;this.targetObject=e,e.needsUpdate!==void 0?a=this.Versioning.NeedsUpdate:e.matrixWorldNeedsUpdate!==void 0&&(a=this.Versioning.MatrixWorldNeedsUpdate);let l=this.BindingType.Direct;if(r!==void 0){if(i==="morphTargetInfluences"){if(!e.geometry){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);return}if(e.geometry.isBufferGeometry){if(!e.geometry.morphAttributes){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);return}e.morphTargetDictionary[r]!==void 0&&(r=e.morphTargetDictionary[r])}else{console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences on THREE.Geometry. Use THREE.BufferGeometry instead.",this);return}}l=this.BindingType.ArrayElement,this.resolvedProperty=s,this.propertyIndex=r}else s.fromArray!==void 0&&s.toArray!==void 0?(l=this.BindingType.HasFromToArray,this.resolvedProperty=s):Array.isArray(s)?(l=this.BindingType.EntireArray,this.resolvedProperty=s):this.propertyName=i;this.getValue=this.GetterByBindingType[l],this.setValue=this.SetterByBindingTypeAndVersioning[l][a]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}};bt.Composite=b3;bt.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3};bt.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2};bt.prototype.GetterByBindingType=[bt.prototype._getValue_direct,bt.prototype._getValue_array,bt.prototype._getValue_arrayElement,bt.prototype._getValue_toArray];bt.prototype.SetterByBindingTypeAndVersioning=[[bt.prototype._setValue_direct,bt.prototype._setValue_direct_setNeedsUpdate,bt.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[bt.prototype._setValue_array,bt.prototype._setValue_array_setNeedsUpdate,bt.prototype._setValue_array_setMatrixWorldNeedsUpdate],[bt.prototype._setValue_arrayElement,bt.prototype._setValue_arrayElement_setNeedsUpdate,bt.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[bt.prototype._setValue_fromArray,bt.prototype._setValue_fromArray_setNeedsUpdate,bt.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];var M3=class{constructor(){this.uuid=_r(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;let e={};this._indicesByUUID=e;for(let n=0,i=arguments.length;n!==i;++n)e[arguments[n].uuid]=n;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};let t=this;this.stats={objects:{get total(){return t._objects.length},get inUse(){return this.total-t.nCachedObjects_}},get bindingsPerObject(){return t._bindings.length}}}add(){let e=this._objects,t=this._indicesByUUID,n=this._paths,i=this._parsedPaths,r=this._bindings,s=r.length,a,l=e.length,c=this.nCachedObjects_;for(let u=0,d=arguments.length;u!==d;++u){let h=arguments[u],f=h.uuid,p=t[f];if(p===void 0){p=l++,t[f]=p,e.push(h);for(let g=0,v=s;g!==v;++g)r[g].push(new bt(h,n[g],i[g]))}else if(p<c){a=e[p];let g=--c,v=e[g];t[v.uuid]=p,e[p]=v,t[f]=g,e[g]=h;for(let y=0,m=s;y!==m;++y){let x=r[y],_=x[g],w=x[p];x[p]=_,w===void 0&&(w=new bt(h,n[y],i[y])),x[g]=w}}else e[p]!==a&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=c}remove(){let e=this._objects,t=this._indicesByUUID,n=this._bindings,i=n.length,r=this.nCachedObjects_;for(let s=0,a=arguments.length;s!==a;++s){let l=arguments[s],c=l.uuid,u=t[c];if(u!==void 0&&u>=r){let d=r++,h=e[d];t[h.uuid]=u,e[u]=h,t[c]=d,e[d]=l;for(let f=0,p=i;f!==p;++f){let g=n[f],v=g[d],y=g[u];g[u]=v,g[d]=y}}}this.nCachedObjects_=r}uncache(){let e=this._objects,t=this._indicesByUUID,n=this._bindings,i=n.length,r=this.nCachedObjects_,s=e.length;for(let a=0,l=arguments.length;a!==l;++a){let c=arguments[a],u=c.uuid,d=t[u];if(d!==void 0)if(delete t[u],d<r){let h=--r,f=e[h],p=--s,g=e[p];t[f.uuid]=d,e[d]=f,t[g.uuid]=h,e[h]=g,e.pop();for(let v=0,y=i;v!==y;++v){let m=n[v],x=m[h],_=m[p];m[d]=x,m[h]=_,m.pop()}}else{let h=--s,f=e[h];h>0&&(t[f.uuid]=d),e[d]=f,e.pop();for(let p=0,g=i;p!==g;++p){let v=n[p];v[d]=v[h],v.pop()}}}this.nCachedObjects_=r}subscribe_(e,t){let n=this._bindingsIndicesByPath,i=n[e],r=this._bindings;if(i!==void 0)return r[i];let s=this._paths,a=this._parsedPaths,l=this._objects,c=l.length,u=this.nCachedObjects_,d=new Array(c);i=r.length,n[e]=i,s.push(e),a.push(t),r.push(d);for(let h=u,f=l.length;h!==f;++h){let p=l[h];d[h]=new bt(p,e,t)}return d}unsubscribe_(e){let t=this._bindingsIndicesByPath,n=t[e];if(n!==void 0){let i=this._paths,r=this._parsedPaths,s=this._bindings,a=s.length-1,l=s[a],c=e[a];t[c]=n,s[n]=l,s.pop(),r[n]=r[a],r.pop(),i[n]=i[a],i.pop()}}};M3.prototype.isAnimationObjectGroup=!0;var S3=class{constructor(e,t,n=null,i=t.blendMode){this._mixer=e,this._clip=t,this._localRoot=n,this.blendMode=i;let r=t.tracks,s=r.length,a=new Array(s),l={endingStart:sh,endingEnd:sh};for(let c=0;c!==s;++c){let u=r[c].createInterpolant(null);a[c]=u,u.settings=l}this._interpolantSettings=l,this._interpolants=a,this._propertyBindings=new Array(s),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=Q5,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&this.timeScale!==0&&this._startTime===null&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(e){return this._startTime=e,this}setLoop(e,t){return this.loop=e,this.repetitions=t,this}setEffectiveWeight(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(e){return this._scheduleFading(e,0,1)}fadeOut(e){return this._scheduleFading(e,1,0)}crossFadeFrom(e,t,n){if(e.fadeOut(t),this.fadeIn(t),n){let i=this._clip.duration,r=e._clip.duration,s=r/i,a=i/r;e.warp(1,s,t),this.warp(a,1,t)}return this}crossFadeTo(e,t,n){return e.crossFadeFrom(this,t,n)}stopFading(){let e=this._weightInterpolant;return e!==null&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}setEffectiveTimeScale(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(e){return this.timeScale=this._clip.duration/e,this.stopWarping()}syncWith(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()}halt(e){return this.warp(this._effectiveTimeScale,0,e)}warp(e,t,n){let i=this._mixer,r=i.time,s=this.timeScale,a=this._timeScaleInterpolant;a===null&&(a=i._lendControlInterpolant(),this._timeScaleInterpolant=a);let l=a.parameterPositions,c=a.sampleValues;return l[0]=r,l[1]=r+n,c[0]=e/s,c[1]=t/s,this}stopWarping(){let e=this._timeScaleInterpolant;return e!==null&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(e,t,n,i){if(!this.enabled){this._updateWeight(e);return}let r=this._startTime;if(r!==null){let l=(e-r)*n;if(l<0||n===0)return;this._startTime=null,t=n*l}t*=this._updateTimeScale(e);let s=this._updateTime(t),a=this._updateWeight(e);if(a>0){let l=this._interpolants,c=this._propertyBindings;switch(this.blendMode){case hR:for(let u=0,d=l.length;u!==d;++u)l[u].evaluate(s),c[u].accumulateAdditive(a);break;case Fb:default:for(let u=0,d=l.length;u!==d;++u)l[u].evaluate(s),c[u].accumulate(i,a)}}}_updateWeight(e){let t=0;if(this.enabled){t=this.weight;let n=this._weightInterpolant;if(n!==null){let i=n.evaluate(e)[0];t*=i,e>n.parameterPositions[1]&&(this.stopFading(),i===0&&(this.enabled=!1))}}return this._effectiveWeight=t,t}_updateTimeScale(e){let t=0;if(!this.paused){t=this.timeScale;let n=this._timeScaleInterpolant;n!==null&&(t*=n.evaluate(e)[0],e>n.parameterPositions[1]&&(this.stopWarping(),t===0?this.paused=!0:this.timeScale=t))}return this._effectiveTimeScale=t,t}_updateTime(e){let t=this._clip.duration,n=this.loop,i=this.time+e,r=this._loopCount,s=n===eW;if(e===0)return r===-1?i:s&&(r&1)==1?t-i:i;if(n===$5){r===-1&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(i>=t)i=t;else if(i<0)i=0;else{this.time=i;break e}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=i,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(r===-1&&(e>=0?(r=0,this._setEndings(!0,this.repetitions===0,s)):this._setEndings(this.repetitions===0,!0,s)),i>=t||i<0){let a=Math.floor(i/t);i-=t*a,r+=Math.abs(a);let l=this.repetitions-r;if(l<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,i=e>0?t:0,this.time=i,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(l===1){let c=e<0;this._setEndings(c,!c,s)}else this._setEndings(!1,!1,s);this._loopCount=r,this.time=i,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:a})}}else this.time=i;if(s&&(r&1)==1)return t-i}return i}_setEndings(e,t,n){let i=this._interpolantSettings;n?(i.endingStart=oh,i.endingEnd=oh):(e?i.endingStart=this.zeroSlopeAtStart?oh:sh:i.endingStart=Wy,t?i.endingEnd=this.zeroSlopeAtEnd?oh:sh:i.endingEnd=Wy)}_scheduleFading(e,t,n){let i=this._mixer,r=i.time,s=this._weightInterpolant;s===null&&(s=i._lendControlInterpolant(),this._weightInterpolant=s);let a=s.parameterPositions,l=s.sampleValues;return a[0]=r,l[0]=t,a[1]=r+e,l[1]=n,this}},T3=class extends Ta{constructor(e){super();this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(e,t){let n=e._localRoot||this._root,i=e._clip.tracks,r=i.length,s=e._propertyBindings,a=e._interpolants,l=n.uuid,c=this._bindingsByRootAndName,u=c[l];u===void 0&&(u={},c[l]=u);for(let d=0;d!==r;++d){let h=i[d],f=h.name,p=u[f];if(p!==void 0)s[d]=p;else{if(p=s[d],p!==void 0){p._cacheIndex===null&&(++p.referenceCount,this._addInactiveBinding(p,l,f));continue}let g=t&&t._propertyBindings[d].binding.parsedPath;p=new w3(bt.create(n,f,g),h.ValueTypeName,h.getValueSize()),++p.referenceCount,this._addInactiveBinding(p,l,f),s[d]=p}a[d].resultBuffer=p.buffer}}_activateAction(e){if(!this._isActiveAction(e)){if(e._cacheIndex===null){let n=(e._localRoot||this._root).uuid,i=e._clip.uuid,r=this._actionsByClip[i];this._bindAction(e,r&&r.knownActions[0]),this._addInactiveAction(e,i,n)}let t=e._propertyBindings;for(let n=0,i=t.length;n!==i;++n){let r=t[n];r.useCount++==0&&(this._lendBinding(r),r.saveOriginalState())}this._lendAction(e)}}_deactivateAction(e){if(this._isActiveAction(e)){let t=e._propertyBindings;for(let n=0,i=t.length;n!==i;++n){let r=t[n];--r.useCount==0&&(r.restoreOriginalState(),this._takeBackBinding(r))}this._takeBackAction(e)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;let e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}}_isActiveAction(e){let t=e._cacheIndex;return t!==null&&t<this._nActiveActions}_addInactiveAction(e,t,n){let i=this._actions,r=this._actionsByClip,s=r[t];if(s===void 0)s={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,r[t]=s;else{let a=s.knownActions;e._byClipCacheIndex=a.length,a.push(e)}e._cacheIndex=i.length,i.push(e),s.actionByRoot[n]=e}_removeInactiveAction(e){let t=this._actions,n=t[t.length-1],i=e._cacheIndex;n._cacheIndex=i,t[i]=n,t.pop(),e._cacheIndex=null;let r=e._clip.uuid,s=this._actionsByClip,a=s[r],l=a.knownActions,c=l[l.length-1],u=e._byClipCacheIndex;c._byClipCacheIndex=u,l[u]=c,l.pop(),e._byClipCacheIndex=null;let d=a.actionByRoot,h=(e._localRoot||this._root).uuid;delete d[h],l.length===0&&delete s[r],this._removeInactiveBindingsForAction(e)}_removeInactiveBindingsForAction(e){let t=e._propertyBindings;for(let n=0,i=t.length;n!==i;++n){let r=t[n];--r.referenceCount==0&&this._removeInactiveBinding(r)}}_lendAction(e){let t=this._actions,n=e._cacheIndex,i=this._nActiveActions++,r=t[i];e._cacheIndex=i,t[i]=e,r._cacheIndex=n,t[n]=r}_takeBackAction(e){let t=this._actions,n=e._cacheIndex,i=--this._nActiveActions,r=t[i];e._cacheIndex=i,t[i]=e,r._cacheIndex=n,t[n]=r}_addInactiveBinding(e,t,n){let i=this._bindingsByRootAndName,r=this._bindings,s=i[t];s===void 0&&(s={},i[t]=s),s[n]=e,e._cacheIndex=r.length,r.push(e)}_removeInactiveBinding(e){let t=this._bindings,n=e.binding,i=n.rootNode.uuid,r=n.path,s=this._bindingsByRootAndName,a=s[i],l=t[t.length-1],c=e._cacheIndex;l._cacheIndex=c,t[c]=l,t.pop(),delete a[r],Object.keys(a).length===0&&delete s[i]}_lendBinding(e){let t=this._bindings,n=e._cacheIndex,i=this._nActiveBindings++,r=t[i];e._cacheIndex=i,t[i]=e,r._cacheIndex=n,t[n]=r}_takeBackBinding(e){let t=this._bindings,n=e._cacheIndex,i=--this._nActiveBindings,r=t[i];e._cacheIndex=i,t[i]=e,r._cacheIndex=n,t[n]=r}_lendControlInterpolant(){let e=this._controlInterpolants,t=this._nActiveControlInterpolants++,n=e[t];return n===void 0&&(n=new BM(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer),n.__cacheIndex=t,e[t]=n),n}_takeBackControlInterpolant(e){let t=this._controlInterpolants,n=e.__cacheIndex,i=--this._nActiveControlInterpolants,r=t[i];e.__cacheIndex=i,t[i]=e,r.__cacheIndex=n,t[n]=r}clipAction(e,t,n){let i=t||this._root,r=i.uuid,s=typeof e=="string"?OM.findByName(i,e):e,a=s!==null?s.uuid:e,l=this._actionsByClip[a],c=null;if(n===void 0&&(s!==null?n=s.blendMode:n=Fb),l!==void 0){let d=l.actionByRoot[r];if(d!==void 0&&d.blendMode===n)return d;c=l.knownActions[0],s===null&&(s=c._clip)}if(s===null)return null;let u=new S3(this,s,t,n);return this._bindAction(u,c),this._addInactiveAction(u,a,r),u}existingAction(e,t){let n=t||this._root,i=n.uuid,r=typeof e=="string"?OM.findByName(n,e):e,s=r?r.uuid:e,a=this._actionsByClip[s];return a!==void 0&&a.actionByRoot[i]||null}stopAllAction(){let e=this._actions,t=this._nActiveActions;for(let n=t-1;n>=0;--n)e[n].stop();return this}update(e){e*=this.timeScale;let t=this._actions,n=this._nActiveActions,i=this.time+=e,r=Math.sign(e),s=this._accuIndex^=1;for(let c=0;c!==n;++c)t[c]._update(i,e,r,s);let a=this._bindings,l=this._nActiveBindings;for(let c=0;c!==l;++c)a[c].apply(s);return this}setTime(e){this.time=0;for(let t=0;t<this._actions.length;t++)this._actions[t].time=0;return this.update(e)}getRoot(){return this._root}uncacheClip(e){let t=this._actions,n=e.uuid,i=this._actionsByClip,r=i[n];if(r!==void 0){let s=r.knownActions;for(let a=0,l=s.length;a!==l;++a){let c=s[a];this._deactivateAction(c);let u=c._cacheIndex,d=t[t.length-1];c._cacheIndex=null,c._byClipCacheIndex=null,d._cacheIndex=u,t[u]=d,t.pop(),this._removeInactiveBindingsForAction(c)}delete i[n]}}uncacheRoot(e){let t=e.uuid,n=this._actionsByClip;for(let s in n){let a=n[s].actionByRoot,l=a[t];l!==void 0&&(this._deactivateAction(l),this._removeInactiveAction(l))}let i=this._bindingsByRootAndName,r=i[t];if(r!==void 0)for(let s in r){let a=r[s];a.restoreOriginalState(),this._removeInactiveBinding(a)}}uncacheAction(e,t){let n=this.existingAction(e,t);n!==null&&(this._deactivateAction(n),this._removeInactiveAction(n))}};T3.prototype._controlInterpolantsResultBuffer=new Float32Array(1);var z0=class{constructor(e){typeof e=="string"&&(console.warn("THREE.Uniform: Type parameter is no longer needed."),e=arguments[1]),this.value=e}clone(){return new z0(this.value.clone===void 0?this.value:this.value.clone())}},E3=class extends Ah{constructor(e,t,n=1){super(e,t);this.meshPerAttribute=n}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}clone(e){let t=super.clone(e);return t.meshPerAttribute=this.meshPerAttribute,t}toJSON(e){let t=super.toJSON(e);return t.isInstancedInterleavedBuffer=!0,t.meshPerAttribute=this.meshPerAttribute,t}};E3.prototype.isInstancedInterleavedBuffer=!0;var A3=class{constructor(e,t,n,i,r){this.buffer=e,this.type=t,this.itemSize=n,this.elementSize=i,this.count=r,this.version=0}set needsUpdate(e){e===!0&&this.version++}setBuffer(e){return this.buffer=e,this}setType(e,t){return this.type=e,this.elementSize=t,this}setItemSize(e){return this.itemSize=e,this}setCount(e){return this.count=e,this}};A3.prototype.isGLBufferAttribute=!0;var C3=new ke,zh=class{constructor(e=new ke(1/0,1/0),t=new ke(-1/0,-1/0)){this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromPoints(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){let n=C3.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(e){return this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y)}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return C3.copy(e).clamp(this.min,this.max).sub(e).length()}intersect(e){return this.min.max(e.min),this.max.min(e.max),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}};zh.prototype.isBox2=!0;var L3=new le,U0=new le,R3=class{constructor(e=new le,t=new le){this.start=e,this.end=t}set(e,t){return this.start.copy(e),this.end.copy(t),this}copy(e){return this.start.copy(e.start),this.end.copy(e.end),this}getCenter(e){return e.addVectors(this.start,this.end).multiplyScalar(.5)}delta(e){return e.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(e,t){return this.delta(t).multiplyScalar(e).add(this.start)}closestPointToPointParameter(e,t){L3.subVectors(e,this.start),U0.subVectors(this.end,this.start);let n=U0.dot(U0),r=U0.dot(L3)/n;return t&&(r=Ti(r,0,1)),r}closestPointToPoint(e,t,n){let i=this.closestPointToPointParameter(e,t);return this.delta(n).multiplyScalar(i).add(this.start)}applyMatrix4(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this}equals(e){return e.start.equals(this.start)&&e.end.equals(this.end)}clone(){return new this.constructor().copy(this)}},P3=class extends Tt{constructor(e){super();this.material=e,this.render=function(){},this.hasPositions=!1,this.hasNormals=!1,this.hasColors=!1,this.hasUvs=!1,this.positionArray=null,this.normalArray=null,this.colorArray=null,this.uvArray=null,this.count=0}};P3.prototype.isImmediateRenderObject=!0;var ka=new le,H0=new Qe,jM=new Qe,I3=class extends _0{constructor(e){let t=D3(e),n=new kt,i=[],r=[],s=new Je(0,0,1),a=new Je(0,1,0);for(let c=0;c<t.length;c++){let u=t[c];u.parent&&u.parent.isBone&&(i.push(0,0,0),i.push(0,0,0),r.push(s.r,s.g,s.b),r.push(a.r,a.g,a.b))}n.setAttribute("position",new Ot(i,3)),n.setAttribute("color",new Ot(r,3));let l=new Na({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0});super(n,l);this.type="SkeletonHelper",this.isSkeletonHelper=!0,this.root=e,this.bones=t,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1}updateMatrixWorld(e){let t=this.bones,n=this.geometry,i=n.getAttribute("position");jM.copy(this.root.matrixWorld).invert();for(let r=0,s=0;r<t.length;r++){let a=t[r];a.parent&&a.parent.isBone&&(H0.multiplyMatrices(jM,a.matrixWorld),ka.setFromMatrixPosition(H0),i.setXYZ(s,ka.x,ka.y,ka.z),H0.multiplyMatrices(jM,a.parent.matrixWorld),ka.setFromMatrixPosition(H0),i.setXYZ(s+1,ka.x,ka.y,ka.z),s+=2)}n.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(e)}};function D3(o){let e=[];o&&o.isBone&&e.push(o);for(let t=0;t<o.children.length;t++)e.push.apply(e,D3(o.children[t]));return e}var F3=class extends _0{constructor(e=10,t=10,n=4473924,i=8947848){n=new Je(n),i=new Je(i);let r=t/2,s=e/t,a=e/2,l=[],c=[];for(let h=0,f=0,p=-a;h<=t;h++,p+=s){l.push(-a,0,p,a,0,p),l.push(p,0,-a,p,0,a);let g=h===r?n:i;g.toArray(c,f),f+=3,g.toArray(c,f),f+=3,g.toArray(c,f),f+=3,g.toArray(c,f),f+=3}let u=new kt;u.setAttribute("position",new Ot(l,3)),u.setAttribute("color",new Ot(c,3));let d=new Na({vertexColors:!0,toneMapped:!1});super(u,d);this.type="GridHelper"}};var RX=new Float32Array(1),yne=new Int32Array(RX.buffer);var PX=4,B3=8,vne=Math.pow(2,B3),IX=[.125,.215,.35,.446,.526,.582],xne=B3-PX+1+IX.length;var _ne={[ah]:0,[Bb]:1,[fR]:2,[pR]:3,[mR]:4,[gR]:5,[dR]:6},DX=new yh({side:Ln,depthWrite:!1,depthTest:!1}),wne=new Oi(new Da,DX);var sc=(1+Math.sqrt(5))/2,Uh=1/sc,bne=[new le(1,1,1),new le(-1,1,1),new le(1,1,-1),new le(-1,1,-1),new le(0,sc,Uh),new le(0,sc,-Uh),new le(Uh,0,sc),new le(-Uh,0,sc),new le(sc,Uh,0),new le(-sc,Uh,0)];er.create=function(o,e){return console.log("THREE.Curve.create() has been deprecated"),o.prototype=Object.create(er.prototype),o.prototype.constructor=o,o.prototype.getPoint=e,o};Ip.prototype.fromPoints=function(o){return console.warn("THREE.Path: .fromPoints() has been renamed to .setFromPoints()."),this.setFromPoints(o)};F3.prototype.setColors=function(){console.error("THREE.GridHelper: setColors() has been deprecated, pass them in the constructor instead.")};I3.prototype.update=function(){console.error("THREE.SkeletonHelper: update() no longer needs to be called.")};Ao.prototype.extractUrlBase=function(o){return console.warn("THREE.Loader: .extractUrlBase() has been deprecated. Use THREE.LoaderUtils.extractUrlBase() instead."),u3.extractUrlBase(o)};Ao.Handlers={add:function(){console.error("THREE.Loader: Handlers.add() has been removed. Use LoadingManager.addHandler() instead.")},get:function(){console.error("THREE.Loader: Handlers.get() has been removed. Use LoadingManager.getHandler() instead.")}};zh.prototype.center=function(o){return console.warn("THREE.Box2: .center() has been renamed to .getCenter()."),this.getCenter(o)};zh.prototype.empty=function(){return console.warn("THREE.Box2: .empty() has been renamed to .isEmpty()."),this.isEmpty()};zh.prototype.isIntersectionBox=function(o){return console.warn("THREE.Box2: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(o)};zh.prototype.size=function(o){return console.warn("THREE.Box2: .size() has been renamed to .getSize()."),this.getSize(o)};wr.prototype.center=function(o){return console.warn("THREE.Box3: .center() has been renamed to .getCenter()."),this.getCenter(o)};wr.prototype.empty=function(){return console.warn("THREE.Box3: .empty() has been renamed to .isEmpty()."),this.isEmpty()};wr.prototype.isIntersectionBox=function(o){return console.warn("THREE.Box3: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(o)};wr.prototype.isIntersectionSphere=function(o){return console.warn("THREE.Box3: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(o)};wr.prototype.size=function(o){return console.warn("THREE.Box3: .size() has been renamed to .getSize()."),this.getSize(o)};ec.prototype.empty=function(){return console.warn("THREE.Sphere: .empty() has been renamed to .isEmpty()."),this.isEmpty()};hp.prototype.setFromMatrix=function(o){return console.warn("THREE.Frustum: .setFromMatrix() has been renamed to .setFromProjectionMatrix()."),this.setFromProjectionMatrix(o)};R3.prototype.center=function(o){return console.warn("THREE.Line3: .center() has been renamed to .getCenter()."),this.getCenter(o)};Nn.prototype.flattenToArrayOffset=function(o,e){return console.warn("THREE.Matrix3: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(o,e)};Nn.prototype.multiplyVector3=function(o){return console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),o.applyMatrix3(this)};Nn.prototype.multiplyVector3Array=function(){console.error("THREE.Matrix3: .multiplyVector3Array() has been removed.")};Nn.prototype.applyToBufferAttribute=function(o){return console.warn("THREE.Matrix3: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix3( matrix ) instead."),o.applyMatrix3(this)};Nn.prototype.applyToVector3Array=function(){console.error("THREE.Matrix3: .applyToVector3Array() has been removed.")};Nn.prototype.getInverse=function(o){return console.warn("THREE.Matrix3: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead."),this.copy(o).invert()};Qe.prototype.extractPosition=function(o){return console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(o)};Qe.prototype.flattenToArrayOffset=function(o,e){return console.warn("THREE.Matrix4: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(o,e)};Qe.prototype.getPosition=function(){return console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead."),new le().setFromMatrixColumn(this,3)};Qe.prototype.setRotationFromQuaternion=function(o){return console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion()."),this.makeRotationFromQuaternion(o)};Qe.prototype.multiplyToArray=function(){console.warn("THREE.Matrix4: .multiplyToArray() has been removed.")};Qe.prototype.multiplyVector3=function(o){return console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) instead."),o.applyMatrix4(this)};Qe.prototype.multiplyVector4=function(o){return console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),o.applyMatrix4(this)};Qe.prototype.multiplyVector3Array=function(){console.error("THREE.Matrix4: .multiplyVector3Array() has been removed.")};Qe.prototype.rotateAxis=function(o){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),o.transformDirection(this)};Qe.prototype.crossVector=function(o){return console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),o.applyMatrix4(this)};Qe.prototype.translate=function(){console.error("THREE.Matrix4: .translate() has been removed.")};Qe.prototype.rotateX=function(){console.error("THREE.Matrix4: .rotateX() has been removed.")};Qe.prototype.rotateY=function(){console.error("THREE.Matrix4: .rotateY() has been removed.")};Qe.prototype.rotateZ=function(){console.error("THREE.Matrix4: .rotateZ() has been removed.")};Qe.prototype.rotateByAxis=function(){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")};Qe.prototype.applyToBufferAttribute=function(o){return console.warn("THREE.Matrix4: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix4( matrix ) instead."),o.applyMatrix4(this)};Qe.prototype.applyToVector3Array=function(){console.error("THREE.Matrix4: .applyToVector3Array() has been removed.")};Qe.prototype.makeFrustum=function(o,e,t,n,i,r){return console.warn("THREE.Matrix4: .makeFrustum() has been removed. Use .makePerspective( left, right, top, bottom, near, far ) instead."),this.makePerspective(o,e,n,t,i,r)};Qe.prototype.getInverse=function(o){return console.warn("THREE.Matrix4: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead."),this.copy(o).invert()};Rs.prototype.isIntersectionLine=function(o){return console.warn("THREE.Plane: .isIntersectionLine() has been renamed to .intersectsLine()."),this.intersectsLine(o)};Kn.prototype.multiplyVector3=function(o){return console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),o.applyQuaternion(this)};Kn.prototype.inverse=function(){return console.warn("THREE.Quaternion: .inverse() has been renamed to invert()."),this.invert()};tc.prototype.isIntersectionBox=function(o){return console.warn("THREE.Ray: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(o)};tc.prototype.isIntersectionPlane=function(o){return console.warn("THREE.Ray: .isIntersectionPlane() has been renamed to .intersectsPlane()."),this.intersectsPlane(o)};tc.prototype.isIntersectionSphere=function(o){return console.warn("THREE.Ray: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(o)};xn.prototype.area=function(){return console.warn("THREE.Triangle: .area() has been renamed to .getArea()."),this.getArea()};xn.prototype.barycoordFromPoint=function(o,e){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),this.getBarycoord(o,e)};xn.prototype.midpoint=function(o){return console.warn("THREE.Triangle: .midpoint() has been renamed to .getMidpoint()."),this.getMidpoint(o)};xn.prototypenormal=function(o){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),this.getNormal(o)};xn.prototype.plane=function(o){return console.warn("THREE.Triangle: .plane() has been renamed to .getPlane()."),this.getPlane(o)};xn.barycoordFromPoint=function(o,e,t,n,i){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),xn.getBarycoord(o,e,t,n,i)};xn.normal=function(o,e,t,n){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),xn.getNormal(o,e,t,n)};rc.prototype.extractAllPoints=function(o){return console.warn("THREE.Shape: .extractAllPoints() has been removed. Use .extractPoints() instead."),this.extractPoints(o)};rc.prototype.extrude=function(o){return console.warn("THREE.Shape: .extrude() has been removed. Use ExtrudeGeometry() instead."),new To(this,o)};rc.prototype.makeGeometry=function(o){return console.warn("THREE.Shape: .makeGeometry() has been removed. Use ShapeGeometry() instead."),new P0(this,o)};ke.prototype.fromAttribute=function(o,e,t){return console.warn("THREE.Vector2: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(o,e,t)};ke.prototype.distanceToManhattan=function(o){return console.warn("THREE.Vector2: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(o)};ke.prototype.lengthManhattan=function(){return console.warn("THREE.Vector2: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()};le.prototype.setEulerFromRotationMatrix=function(){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")};le.prototype.setEulerFromQuaternion=function(){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")};le.prototype.getPositionFromMatrix=function(o){return console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(o)};le.prototype.getScaleFromMatrix=function(o){return console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(o)};le.prototype.getColumnFromMatrix=function(o,e){return console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(e,o)};le.prototype.applyProjection=function(o){return console.warn("THREE.Vector3: .applyProjection() has been removed. Use .applyMatrix4( m ) instead."),this.applyMatrix4(o)};le.prototype.fromAttribute=function(o,e,t){return console.warn("THREE.Vector3: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(o,e,t)};le.prototype.distanceToManhattan=function(o){return console.warn("THREE.Vector3: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(o)};le.prototype.lengthManhattan=function(){return console.warn("THREE.Vector3: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()};Nt.prototype.fromAttribute=function(o,e,t){return console.warn("THREE.Vector4: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(o,e,t)};Nt.prototype.lengthManhattan=function(){return console.warn("THREE.Vector4: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()};Tt.prototype.getChildByName=function(o){return console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(o)};Tt.prototype.renderDepth=function(){console.warn("THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")};Tt.prototype.translate=function(o,e){return console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead."),this.translateOnAxis(e,o)};Tt.prototype.getWorldRotation=function(){console.error("THREE.Object3D: .getWorldRotation() has been removed. Use THREE.Object3D.getWorldQuaternion( target ) instead.")};Tt.prototype.applyMatrix=function(o){return console.warn("THREE.Object3D: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(o)};Object.defineProperties(Tt.prototype,{eulerOrder:{get:function(){return console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order},set:function(o){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order=o}},useQuaternion:{get:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")}}});Oi.prototype.setDrawMode=function(){console.error("THREE.Mesh: .setDrawMode() has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")};Object.defineProperties(Oi.prototype,{drawMode:{get:function(){return console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode."),tW},set:function(){console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")}}});bM.prototype.initBones=function(){console.error("THREE.SkinnedMesh: initBones() has been removed.")};ki.prototype.setLens=function(o,e){console.warn("THREE.PerspectiveCamera.setLens is deprecated. Use .setFocalLength and .filmGauge for a photographic setup."),e!==void 0&&(this.filmGauge=e),this.setFocalLength(o)};Object.defineProperties(Qr.prototype,{onlyShadow:{set:function(){console.warn("THREE.Light: .onlyShadow has been removed.")}},shadowCameraFov:{set:function(o){console.warn("THREE.Light: .shadowCameraFov is now .shadow.camera.fov."),this.shadow.camera.fov=o}},shadowCameraLeft:{set:function(o){console.warn("THREE.Light: .shadowCameraLeft is now .shadow.camera.left."),this.shadow.camera.left=o}},shadowCameraRight:{set:function(o){console.warn("THREE.Light: .shadowCameraRight is now .shadow.camera.right."),this.shadow.camera.right=o}},shadowCameraTop:{set:function(o){console.warn("THREE.Light: .shadowCameraTop is now .shadow.camera.top."),this.shadow.camera.top=o}},shadowCameraBottom:{set:function(o){console.warn("THREE.Light: .shadowCameraBottom is now .shadow.camera.bottom."),this.shadow.camera.bottom=o}},shadowCameraNear:{set:function(o){console.warn("THREE.Light: .shadowCameraNear is now .shadow.camera.near."),this.shadow.camera.near=o}},shadowCameraFar:{set:function(o){console.warn("THREE.Light: .shadowCameraFar is now .shadow.camera.far."),this.shadow.camera.far=o}},shadowCameraVisible:{set:function(){console.warn("THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow.camera ) instead.")}},shadowBias:{set:function(o){console.warn("THREE.Light: .shadowBias is now .shadow.bias."),this.shadow.bias=o}},shadowDarkness:{set:function(){console.warn("THREE.Light: .shadowDarkness has been removed.")}},shadowMapWidth:{set:function(o){console.warn("THREE.Light: .shadowMapWidth is now .shadow.mapSize.width."),this.shadow.mapSize.width=o}},shadowMapHeight:{set:function(o){console.warn("THREE.Light: .shadowMapHeight is now .shadow.mapSize.height."),this.shadow.mapSize.height=o}}});Object.defineProperties(Rn.prototype,{length:{get:function(){return console.warn("THREE.BufferAttribute: .length has been deprecated. Use .count instead."),this.array.length}},dynamic:{get:function(){return console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.usage===Xy},set:function(){console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.setUsage(Xy)}}});Rn.prototype.setDynamic=function(o){return console.warn("THREE.BufferAttribute: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(o===!0?Xy:np),this};Rn.prototype.copyIndicesArray=function(){console.error("THREE.BufferAttribute: .copyIndicesArray() has been removed.")},Rn.prototype.setArray=function(){console.error("THREE.BufferAttribute: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")};kt.prototype.addIndex=function(o){console.warn("THREE.BufferGeometry: .addIndex() has been renamed to .setIndex()."),this.setIndex(o)};kt.prototype.addAttribute=function(o,e){return console.warn("THREE.BufferGeometry: .addAttribute() has been renamed to .setAttribute()."),!(e&&e.isBufferAttribute)&&!(e&&e.isInterleavedBufferAttribute)?(console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),this.setAttribute(o,new Rn(arguments[1],arguments[2]))):o==="index"?(console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute."),this.setIndex(e),this):this.setAttribute(o,e)};kt.prototype.addDrawCall=function(o,e,t){t!==void 0&&console.warn("THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset."),console.warn("THREE.BufferGeometry: .addDrawCall() is now .addGroup()."),this.addGroup(o,e)};kt.prototype.clearDrawCalls=function(){console.warn("THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups()."),this.clearGroups()};kt.prototype.computeOffsets=function(){console.warn("THREE.BufferGeometry: .computeOffsets() has been removed.")};kt.prototype.removeAttribute=function(o){return console.warn("THREE.BufferGeometry: .removeAttribute() has been renamed to .deleteAttribute()."),this.deleteAttribute(o)};kt.prototype.applyMatrix=function(o){return console.warn("THREE.BufferGeometry: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(o)};Object.defineProperties(kt.prototype,{drawcalls:{get:function(){return console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups."),this.groups}},offsets:{get:function(){return console.warn("THREE.BufferGeometry: .offsets has been renamed to .groups."),this.groups}}});Ah.prototype.setDynamic=function(o){return console.warn("THREE.InterleavedBuffer: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(o===!0?Xy:np),this};Ah.prototype.setArray=function(){console.error("THREE.InterleavedBuffer: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")};To.prototype.getArrays=function(){console.error("THREE.ExtrudeGeometry: .getArrays() has been removed.")};To.prototype.addShapeList=function(){console.error("THREE.ExtrudeGeometry: .addShapeList() has been removed.")};To.prototype.addShape=function(){console.error("THREE.ExtrudeGeometry: .addShape() has been removed.")};xM.prototype.dispose=function(){console.error("THREE.Scene: .dispose() has been removed.")};z0.prototype.onUpdate=function(){return console.warn("THREE.Uniform: .onUpdate() has been removed. Use object.onBeforeRender() instead."),this};Object.defineProperties($n.prototype,{wrapAround:{get:function(){console.warn("THREE.Material: .wrapAround has been removed.")},set:function(){console.warn("THREE.Material: .wrapAround has been removed.")}},overdraw:{get:function(){console.warn("THREE.Material: .overdraw has been removed.")},set:function(){console.warn("THREE.Material: .overdraw has been removed.")}},wrapRGB:{get:function(){return console.warn("THREE.Material: .wrapRGB has been removed."),new Je}},shading:{get:function(){console.error("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead.")},set:function(o){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=o===GL}},stencilMask:{get:function(){return console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask},set:function(o){console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask=o}}});Object.defineProperties(Fa.prototype,{derivatives:{get:function(){return console.warn("THREE.ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives},set:function(o){console.warn("THREE. ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives=o}}});Ut.prototype.clearTarget=function(o,e,t,n){console.warn("THREE.WebGLRenderer: .clearTarget() has been deprecated. Use .setRenderTarget() and .clear() instead."),this.setRenderTarget(o),this.clear(e,t,n)};Ut.prototype.animate=function(o){console.warn("THREE.WebGLRenderer: .animate() is now .setAnimationLoop()."),this.setAnimationLoop(o)};Ut.prototype.getCurrentRenderTarget=function(){return console.warn("THREE.WebGLRenderer: .getCurrentRenderTarget() is now .getRenderTarget()."),this.getRenderTarget()};Ut.prototype.getMaxAnisotropy=function(){return console.warn("THREE.WebGLRenderer: .getMaxAnisotropy() is now .capabilities.getMaxAnisotropy()."),this.capabilities.getMaxAnisotropy()};Ut.prototype.getPrecision=function(){return console.warn("THREE.WebGLRenderer: .getPrecision() is now .capabilities.precision."),this.capabilities.precision};Ut.prototype.resetGLState=function(){return console.warn("THREE.WebGLRenderer: .resetGLState() is now .state.reset()."),this.state.reset()};Ut.prototype.supportsFloatTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' )."),this.extensions.get("OES_texture_float")};Ut.prototype.supportsHalfFloatTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' )."),this.extensions.get("OES_texture_half_float")};Ut.prototype.supportsStandardDerivatives=function(){return console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' )."),this.extensions.get("OES_standard_derivatives")};Ut.prototype.supportsCompressedTextureS3TC=function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' )."),this.extensions.get("WEBGL_compressed_texture_s3tc")};Ut.prototype.supportsCompressedTexturePVRTC=function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' )."),this.extensions.get("WEBGL_compressed_texture_pvrtc")};Ut.prototype.supportsBlendMinMax=function(){return console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' )."),this.extensions.get("EXT_blend_minmax")};Ut.prototype.supportsVertexTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsVertexTextures() is now .capabilities.vertexTextures."),this.capabilities.vertexTextures};Ut.prototype.supportsInstancedArrays=function(){return console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' )."),this.extensions.get("ANGLE_instanced_arrays")};Ut.prototype.enableScissorTest=function(o){console.warn("THREE.WebGLRenderer: .enableScissorTest() is now .setScissorTest()."),this.setScissorTest(o)};Ut.prototype.initMaterial=function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")};Ut.prototype.addPrePlugin=function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")};Ut.prototype.addPostPlugin=function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")};Ut.prototype.updateShadowMap=function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")};Ut.prototype.setFaceCulling=function(){console.warn("THREE.WebGLRenderer: .setFaceCulling() has been removed.")};Ut.prototype.allocTextureUnit=function(){console.warn("THREE.WebGLRenderer: .allocTextureUnit() has been removed.")};Ut.prototype.setTexture=function(){console.warn("THREE.WebGLRenderer: .setTexture() has been removed.")};Ut.prototype.setTexture2D=function(){console.warn("THREE.WebGLRenderer: .setTexture2D() has been removed.")};Ut.prototype.setTextureCube=function(){console.warn("THREE.WebGLRenderer: .setTextureCube() has been removed.")};Ut.prototype.getActiveMipMapLevel=function(){return console.warn("THREE.WebGLRenderer: .getActiveMipMapLevel() is now .getActiveMipmapLevel()."),this.getActiveMipmapLevel()};Object.defineProperties(Ut.prototype,{shadowMapEnabled:{get:function(){return this.shadowMap.enabled},set:function(o){console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled."),this.shadowMap.enabled=o}},shadowMapType:{get:function(){return this.shadowMap.type},set:function(o){console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type."),this.shadowMap.type=o}},shadowMapCullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")}},context:{get:function(){return console.warn("THREE.WebGLRenderer: .context has been removed. Use .getContext() instead."),this.getContext()}},vr:{get:function(){return console.warn("THREE.WebGLRenderer: .vr has been renamed to .xr"),this.xr}},gammaInput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead."),!1},set:function(){console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead.")}},gammaOutput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),!1},set:function(o){console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),this.outputEncoding=o===!0?Bb:ah}},toneMappingWhitePoint:{get:function(){return console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed."),1},set:function(){console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed.")}}});Object.defineProperties(sP.prototype,{cullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")}},renderReverseSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")}},renderSingleSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")}}});Object.defineProperties(Ls.prototype,{wrapS:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS},set:function(o){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS=o}},wrapT:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT},set:function(o){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT=o}},magFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter},set:function(o){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter=o}},minFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter},set:function(o){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter=o}},anisotropy:{get:function(){return console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy},set:function(o){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy=o}},offset:{get:function(){return console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset},set:function(o){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset=o}},repeat:{get:function(){return console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat},set:function(o){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat=o}},format:{get:function(){return console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format},set:function(o){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format=o}},type:{get:function(){return console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type},set:function(o){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type=o}},generateMipmaps:{get:function(){return console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps},set:function(o){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps=o}}});x3.prototype.load=function(o){console.warn("THREE.Audio: .load has been deprecated. Use THREE.AudioLoader instead.");let e=this;return new g3().load(o,function(n){e.setBuffer(n)}),this};_3.prototype.getData=function(){return console.warn("THREE.AudioAnalyser: .getData() is now .getFrequencyData()."),this.getFrequencyData()};u0.prototype.updateCubeMap=function(o,e){return console.warn("THREE.CubeCamera: .updateCubeMap() is now .update()."),this.update(o,e)};u0.prototype.clear=function(o,e,t,n){return console.warn("THREE.CubeCamera: .clear() is now .renderTarget.clear()."),this.renderTarget.clear(o,e,t,n)};Kl.crossOrigin=void 0;Kl.loadTexture=function(o,e,t,n){console.warn("THREE.ImageUtils.loadTexture has been deprecated. Use THREE.TextureLoader() instead.");let i=new $P;i.setCrossOrigin(this.crossOrigin);let r=i.load(o,t,void 0,n);return e&&(r.mapping=e),r};Kl.loadTextureCube=function(o,e,t,n){console.warn("THREE.ImageUtils.loadTextureCube has been deprecated. Use THREE.CubeTextureLoader() instead.");let i=new KP;i.setCrossOrigin(this.crossOrigin);let r=i.load(o,t,void 0,n);return e&&(r.mapping=e),r};Kl.loadCompressedTexture=function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")};Kl.loadCompressedTextureCube=function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")};typeof __THREE_DEVTOOLS__!="undefined"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:zL}}));typeof window!="undefined"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=zL);var oc=class extends Oi{constructor(e,t){super(e,t);this.isExtendedMesh=!0,this.isGroup=!1,this.vector3=new le,this.hasBody=!1,this.fragmentDepth=0,this.breakable=!1,this.fractureImpulse=1,this.name=`object-${this.id}`}get world(){return{theta:this.worldTheta,phi:this.worldPhi}}get worldTheta(){return this.getWorldDirection(this.vector3),Math.atan2(this.vector3.x,this.vector3.z)}get worldPhi(){return this.getWorldDirection(this.vector3),Math.acos(this.vector3.y)}};var G0=new Map,FX=5,Tn=(o,e=!1)=>{if(!G0.has(o))G0.set(o,1);else{let t=G0.get(o);if(typeof t=="undefined"||t>=FX)return;G0.set(o,t+1)}e?console.error(`%c [enable3d] ${o} `,"background: #222; color: #bada55"):console.warn(`%c [enable3d] ${o} `,"background: #222; color: #bada55")};var N3=class{constructor(){this._defaultMaterial=new Nh({color:13421772})}get(){return this._defaultMaterial}},V0=N3;var ac=function(o,e){var t={};for(var n in o)Object.prototype.hasOwnProperty.call(o,n)&&e.indexOf(n)<0&&(t[n]=o[n]);if(o!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,n=Object.getOwnPropertySymbols(o);i<n.length;i++)e.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(o,n[i])&&(t[n[i]]=o[n[i]]);return t},lc=class{constructor(e){this.scene=e,this.isHeadless=e==="headless",this.defaultMaterial=new V0}get make(){return{plane:(e={},t={})=>this.makePlane(e,t),box:(e={},t={})=>this.makeBox(e,t),sphere:(e={},t={})=>this.makeSphere(e,t),cylinder:(e={},t={})=>this.makeCylinder(e,t),cone:(e={},t={})=>this.makeCone(e,t),torus:(e={},t={})=>this.makeTorus(e,t),extrude:(e,t={})=>this.makeExtrude(e,t)}}get add(){return{mesh:e=>this.addMesh(e),existing:e=>this.addExisting(e),plane:(e={},t={})=>this.addPlane(e,t),box:(e={},t={})=>this.addBox(e,t),ground:(e,t={})=>this.addGround(e,t),sphere:(e={},t={})=>this.addSphere(e,t),cylinder:(e={},t={})=>this.addCylinder(e,t),cone:(e={},t={})=>this.addCone(e,t),torus:(e={},t={})=>this.addTorus(e,t),extrude:(e,t={})=>this.addExtrude(e,t),material:(e={})=>this.addMaterial(e)}}addExisting(...e){this.scene!=="headless"&&this.scene.add(...e)}addMesh(e){if(Array.isArray(e))for(let t=0;t<e.length;t++)this.addExisting(e[t]);else this.addExisting(e);return this}createMesh(e,t,n){let{x:i=0,y:r=0,z:s=0}=n,a;switch(!Array.isArray(t)&&t.type){case"LineBasicMaterial":a=new Dh(e,t);break;case"PointsMaterial":a=new M0(e,t);break;default:a=new oc(e,t);break}return a.position.set(i,r,s),a.castShadow=a.receiveShadow=!0,a}makeExtrude(e,t){let{x:n,y:i,z:r,name:s,shape:a,autoCenter:l=!0,breakable:c=!1}=e,u=ac(e,["x","y","z","name","shape","autoCenter","breakable"]),{depth:d=1,bevelEnabled:h=!1}=u,f=new To(a,Object.assign({depth:d,bevelEnabled:h},u)),p=this.addMaterial(t),g=this.createMesh(f,p,{x:n,y:i,z:r});return l&&g.geometry.center(),g.name=s||`body_id_${g.id}`,g.shape="extrude",g}addExtrude(e,t={}){let n=this.makeExtrude(e,t);return this.addExisting(n),n}makePlane(e,t){let{x:n,y:i,z:r,name:s,breakable:a=!1}=e,l=ac(e,["x","y","z","name","breakable"]),c=new Sh(l.width||1,l.height||1,l.widthSegments||1,l.heightSegments||1),u=this.addMaterial(t);u.side=Sa;let d=this.createMesh(c,u,{x:n,y:i,z:r});return d.name=s||`body_id_${d.id}`,d.shape="plane",d}addPlane(e,t){let n=this.makePlane(e,t);return this.addExisting(n),n}makeSphere(e,t){let{x:n,y:i,z:r,name:s,breakable:a=!1}=e,l=ac(e,["x","y","z","name","breakable"]),c=new Ap(l.radius||1,l.widthSegments||16,l.heightSegments||12,l.phiStart||void 0,l.phiLength||void 0,l.thetaStart||void 0,l.thetaLength||void 0),u=this.addMaterial(t),d=this.createMesh(c,u,{x:n,y:i,z:r});return d.name=s||`body_id_${d.id}`,d.shape="sphere",d}addSphere(e={},t={}){let n=this.makeSphere(e,t);return this.addExisting(n),n}makeBox(e,t){let{x:n,y:i,z:r,name:s,breakable:a=!1}=e,l=ac(e,["x","y","z","name","breakable"]),c=new Da(l.width||1,l.height||1,l.depth||1,l.widthSegments||void 0,l.heightSegments||void 0,l.depthSegments||void 0),u=this.addMaterial(t),d=this.createMesh(c,u,{x:n,y:i,z:r});return d.name=s||`body_id_${d.id}`,d.shape="box",d}addBox(e={},t={}){let n=this.makeBox(e,t);return this.addExisting(n),n}addGround(e,t={}){let n=this.makeBox(e,t);return n.rotateX(xR.degToRad(90)),this.addExisting(n),n}makeCylinder(e={},t={}){let{x:n,y:i,z:r,name:s,breakable:a=!1}=e,l=ac(e,["x","y","z","name","breakable"]),c=new Fh(l.radiusTop||1,l.radiusBottom||1,l.height||1,l.radiusSegments||void 0,l.heightSegments||void 0,l.openEnded||void 0,l.thetaStart||void 0,l.thetaLength||void 0),u=this.addMaterial(t),d=this.createMesh(c,u,{x:n,y:i,z:r});return d.name=s||`body_id_${d.id}`,d.shape="cylinder",d}addCylinder(e={},t={}){let n=this.makeCylinder(e,t);return this.addExisting(n),n}makeCone(e={},t={}){let{x:n,y:i,z:r,name:s,breakable:a=!1}=e,l=ac(e,["x","y","z","name","breakable"]),c=new xp(l.radius||1,l.height||1,l.radiusSegments||8,l.heightSegments||1,l.openEnded||!1,l.thetaStart||0,l.thetaLength||2*Math.PI),u=this.addMaterial(t),d=this.createMesh(c,u,{x:n,y:i,z:r});return d.name=s||`body_id_${d.id}`,d.shape="cone",d}addCone(e={},t={}){let n=this.makeCone(e,t);return this.addExisting(n),n}makeTorus(e={},t={}){let{x:n,y:i,z:r,name:s,breakable:a=!1}=e,l=ac(e,["x","y","z","name","breakable"]),c=new Cp(l.radius||void 0,l.tube||void 0,l.radialSegments||void 0,l.tubularSegments||void 0,l.arc||void 0),u=this.addMaterial(t),d=this.createMesh(c,u,{x:n,y:i,z:r});return d.name=s||`body_id_${d.id}`,d.shape="torus",d}addTorus(e={},t={}){let n=this.makeTorus(e,t);return this.addExisting(n),n}addMaterial(e={}){let t=Object.keys(e)[0],n;if(this.scene==="headless")return this.defaultMaterial.get();switch(t){case"basic":n=new yh(e.basic);break;case"normal":n=new B0(e.normal);break;case"standard":n=new Lp(e.standard);break;case"lambert":n=new Nh(e.lambert);break;case"phong":n=new D0(e.phong);break;case"physical":typeof e.physical!="undefined"?n=new I0(e.physical):(Tn("You need to pass parameters to the physical material. (Fallback to default material)"),n=this.defaultMaterial.get());break;case"toon":n=new F0(e.toon);break;case"line":n=new Na(e.line);break;case"points":n=new vp(e.points);break;case"custom":n=e.custom||this.defaultMaterial.get();break;default:n=this.defaultMaterial.get();break}return n}};var Fp=class{constructor(e){this.scene=e}add(e,t={}){let n=this.make(e,t);return n?this.scene.add(n):console.warn("Could not make heightmap"),n}make(e,t={}){let{image:n}=e,{width:i,height:r}=n,{colorScale:s}=t,a=document.createElement("canvas");a.width=i,a.height=r;let l=a.getContext("2d");if(!l)return;l.drawImage(e.image,0,0);let c=l.getImageData(0,0,i,r),u=new pr().fromBufferGeometry(new Bi(10,10,i-1,r-1)),d={color:13421772,side:Dr};s&&(d=Object.assign(Object.assign({},d),{vertexColors:!0}));let h=new gs(d),f=new oc(u,h);f.receiveShadow=f.castShadow=!0,f.shape="concave";let p=f.geometry;for(let v=0;v<p.vertices.length;v++)p.vertices[v].z=c.data[v*4]/120;let g=(v,y)=>{var m=v.vertices[y.a].z,x=v.vertices[y.b].z,_=v.vertices[y.c].z;return Math.max(m,x,_)};return s&&p.faces.forEach(v=>v.color=new De(s(g(p,v)).hex())),f.rotateX(-Math.PI/2),f.updateMatrix(),u.computeFaceNormals(),u.computeVertexNormals(),f.name="heightmap",f.geometry=My(new Ue,f.geometry),f}};var O3={type:"change"},YM={type:"start"},ZM={type:"end"},JM=class extends Wi{constructor(e,t){super();t===void 0&&console.warn('THREE.OrbitControls: The second parameter "domElement" is now mandatory.'),t===document&&console.error('THREE.OrbitControls: "document" should not be used as the target "domElement". Please use "renderer.domElement" instead.'),this.object=e,this.domElement=t,this.domElement.style.touchAction="none",this.enabled=!0,this.target=new U,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:jo.ROTATE,MIDDLE:jo.DOLLY,RIGHT:jo.PAN},this.touches={ONE:Yo.ROTATE,TWO:Yo.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this.getPolarAngle=function(){return a.phi},this.getAzimuthalAngle=function(){return a.theta},this.listenToKeyEvents=function(ve){ve.addEventListener("keydown",Se),this._domElementKeyEvents=ve},this.saveState=function(){n.target0.copy(n.target),n.position0.copy(n.object.position),n.zoom0=n.object.zoom},this.reset=function(){n.target.copy(n.target0),n.object.position.copy(n.position0),n.object.zoom=n.zoom0,n.object.updateProjectionMatrix(),n.dispatchEvent(O3),n.update(),r=i.NONE},this.update=function(){let ve=new U,Be=new gt().setFromUnitVectors(e.up,new U(0,1,0)),nt=Be.clone().invert(),Xe=new U,_t=new gt,wt=2*Math.PI;return function(){let ii=n.object.position;ve.copy(ii).sub(n.target),ve.applyQuaternion(Be),a.setFromVector3(ve),n.autoRotate&&r===i.NONE&&E(M()),n.enableDamping?(a.theta+=l.theta*n.dampingFactor,a.phi+=l.phi*n.dampingFactor):(a.theta+=l.theta,a.phi+=l.phi);let In=n.minAzimuthAngle,Bt=n.maxAzimuthAngle;return isFinite(In)&&isFinite(Bt)&&(In<-Math.PI?In+=wt:In>Math.PI&&(In-=wt),Bt<-Math.PI?Bt+=wt:Bt>Math.PI&&(Bt-=wt),In<=Bt?a.theta=Math.max(In,Math.min(Bt,a.theta)):a.theta=a.theta>(In+Bt)/2?Math.max(In,a.theta):Math.min(Bt,a.theta)),a.phi=Math.max(n.minPolarAngle,Math.min(n.maxPolarAngle,a.phi)),a.makeSafe(),a.radius*=c,a.radius=Math.max(n.minDistance,Math.min(n.maxDistance,a.radius)),n.enableDamping===!0?n.target.addScaledVector(u,n.dampingFactor):n.target.add(u),ve.setFromSpherical(a),ve.applyQuaternion(nt),ii.copy(n.target).add(ve),n.object.lookAt(n.target),n.enableDamping===!0?(l.theta*=1-n.dampingFactor,l.phi*=1-n.dampingFactor,u.multiplyScalar(1-n.dampingFactor)):(l.set(0,0,0),u.set(0,0,0)),c=1,d||Xe.distanceToSquared(n.object.position)>s||8*(1-_t.dot(n.object.quaternion))>s?(n.dispatchEvent(O3),Xe.copy(n.object.position),_t.copy(n.object.quaternion),d=!1,!0):!1}}(),this.dispose=function(){n.domElement.removeEventListener("contextmenu",de),n.domElement.removeEventListener("pointerdown",H),n.domElement.removeEventListener("pointercancel",W),n.domElement.removeEventListener("wheel",Ee),n.domElement.ownerDocument.removeEventListener("pointermove",T),n.domElement.ownerDocument.removeEventListener("pointerup",C),n._domElementKeyEvents!==null&&n._domElementKeyEvents.removeEventListener("keydown",Se)};let n=this,i={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6},r=i.NONE,s=1e-6,a=new If,l=new If,c=1,u=new U,d=!1,h=new _e,f=new _e,p=new _e,g=new _e,v=new _e,y=new _e,m=new _e,x=new _e,_=new _e,w=[],b={};function M(){return 2*Math.PI/60/60*n.autoRotateSpeed}function S(){return Math.pow(.95,n.zoomSpeed)}function E(ve){l.theta-=ve}function A(ve){l.phi-=ve}let L=function(){let ve=new U;return function(nt,Xe){ve.setFromMatrixColumn(Xe,0),ve.multiplyScalar(-nt),u.add(ve)}}(),B=function(){let ve=new U;return function(nt,Xe){n.screenSpacePanning===!0?ve.setFromMatrixColumn(Xe,1):(ve.setFromMatrixColumn(Xe,0),ve.crossVectors(n.object.up,ve)),ve.multiplyScalar(nt),u.add(ve)}}(),R=function(){let ve=new U;return function(nt,Xe){let _t=n.domElement;if(n.object.isPerspectiveCamera){let wt=n.object.position;ve.copy(wt).sub(n.target);let Pr=ve.length();Pr*=Math.tan(n.object.fov/2*Math.PI/180),L(2*nt*Pr/_t.clientHeight,n.object.matrix),B(2*Xe*Pr/_t.clientHeight,n.object.matrix)}else n.object.isOrthographicCamera?(L(nt*(n.object.right-n.object.left)/n.object.zoom/_t.clientWidth,n.object.matrix),B(Xe*(n.object.top-n.object.bottom)/n.object.zoom/_t.clientHeight,n.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),n.enablePan=!1)}}();function D(ve){n.object.isPerspectiveCamera?c/=ve:n.object.isOrthographicCamera?(n.object.zoom=Math.max(n.minZoom,Math.min(n.maxZoom,n.object.zoom*ve)),n.object.updateProjectionMatrix(),d=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),n.enableZoom=!1)}function P(ve){n.object.isPerspectiveCamera?c*=ve:n.object.isOrthographicCamera?(n.object.zoom=Math.max(n.minZoom,Math.min(n.maxZoom,n.object.zoom/ve)),n.object.updateProjectionMatrix(),d=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),n.enableZoom=!1)}function I(ve){h.set(ve.clientX,ve.clientY)}function N(ve){m.set(ve.clientX,ve.clientY)}function G(ve){g.set(ve.clientX,ve.clientY)}function z(ve){f.set(ve.clientX,ve.clientY),p.subVectors(f,h).multiplyScalar(n.rotateSpeed);let Be=n.domElement;E(2*Math.PI*p.x/Be.clientHeight),A(2*Math.PI*p.y/Be.clientHeight),h.copy(f),n.update()}function se(ve){x.set(ve.clientX,ve.clientY),_.subVectors(x,m),_.y>0?D(S()):_.y<0&&P(S()),m.copy(x),n.update()}function ne(ve){v.set(ve.clientX,ve.clientY),y.subVectors(v,g).multiplyScalar(n.panSpeed),R(y.x,y.y),g.copy(v),n.update()}function Q(){}function j(ve){ve.deltaY<0?P(S()):ve.deltaY>0&&D(S()),n.update()}function O(ve){let Be=!1;switch(ve.code){case n.keys.UP:R(0,n.keyPanSpeed),Be=!0;break;case n.keys.BOTTOM:R(0,-n.keyPanSpeed),Be=!0;break;case n.keys.LEFT:R(n.keyPanSpeed,0),Be=!0;break;case n.keys.RIGHT:R(-n.keyPanSpeed,0),Be=!0;break}Be&&(ve.preventDefault(),n.update())}function ee(){if(w.length===1)h.set(w[0].pageX,w[0].pageY);else{let ve=.5*(w[0].pageX+w[1].pageX),Be=.5*(w[0].pageY+w[1].pageY);h.set(ve,Be)}}function V(){if(w.length===1)g.set(w[0].pageX,w[0].pageY);else{let ve=.5*(w[0].pageX+w[1].pageX),Be=.5*(w[0].pageY+w[1].pageY);g.set(ve,Be)}}function ie(){let ve=w[0].pageX-w[1].pageX,Be=w[0].pageY-w[1].pageY,nt=Math.sqrt(ve*ve+Be*Be);m.set(0,nt)}function ue(){n.enableZoom&&ie(),n.enablePan&&V()}function ye(){n.enableZoom&&ie(),n.enableRotate&&ee()}function pe(ve){if(w.length==1)f.set(ve.pageX,ve.pageY);else{let nt=We(ve),Xe=.5*(ve.pageX+nt.x),_t=.5*(ve.pageY+nt.y);f.set(Xe,_t)}p.subVectors(f,h).multiplyScalar(n.rotateSpeed);let Be=n.domElement;E(2*Math.PI*p.x/Be.clientHeight),A(2*Math.PI*p.y/Be.clientHeight),h.copy(f)}function xe(ve){if(w.length===1)v.set(ve.pageX,ve.pageY);else{let Be=We(ve),nt=.5*(ve.pageX+Be.x),Xe=.5*(ve.pageY+Be.y);v.set(nt,Xe)}y.subVectors(v,g).multiplyScalar(n.panSpeed),R(y.x,y.y),g.copy(v)}function X(ve){let Be=We(ve),nt=ve.pageX-Be.x,Xe=ve.pageY-Be.y,_t=Math.sqrt(nt*nt+Xe*Xe);x.set(0,_t),_.set(0,Math.pow(x.y/m.y,n.zoomSpeed)),D(_.y),m.copy(x)}function $(ve){n.enableZoom&&X(ve),n.enablePan&&xe(ve)}function J(ve){n.enableZoom&&X(ve),n.enableRotate&&pe(ve)}function ce(){}function H(ve){n.enabled!==!1&&(w.length===0&&(n.domElement.ownerDocument.addEventListener("pointermove",T),n.domElement.ownerDocument.addEventListener("pointerup",C)),K(ve),ve.pointerType==="touch"?oe(ve):Z(ve))}function T(ve){n.enabled!==!1&&(ve.pointerType==="touch"?ge(ve):he(ve))}function C(ve){n.enabled!==!1&&(ve.pointerType==="touch"?k():me(ve),be(ve),w.length===0&&(n.domElement.ownerDocument.removeEventListener("pointermove",T),n.domElement.ownerDocument.removeEventListener("pointerup",C)))}function W(ve){be(ve)}function Z(ve){let Be;switch(ve.button){case 0:Be=n.mouseButtons.LEFT;break;case 1:Be=n.mouseButtons.MIDDLE;break;case 2:Be=n.mouseButtons.RIGHT;break;default:Be=-1}switch(Be){case jo.DOLLY:if(n.enableZoom===!1)return;N(ve),r=i.DOLLY;break;case jo.ROTATE:if(ve.ctrlKey||ve.metaKey||ve.shiftKey){if(n.enablePan===!1)return;G(ve),r=i.PAN}else{if(n.enableRotate===!1)return;I(ve),r=i.ROTATE}break;case jo.PAN:if(ve.ctrlKey||ve.metaKey||ve.shiftKey){if(n.enableRotate===!1)return;I(ve),r=i.ROTATE}else{if(n.enablePan===!1)return;G(ve),r=i.PAN}break;default:r=i.NONE}r!==i.NONE&&n.dispatchEvent(YM)}function he(ve){if(n.enabled!==!1)switch(r){case i.ROTATE:if(n.enableRotate===!1)return;z(ve);break;case i.DOLLY:if(n.enableZoom===!1)return;se(ve);break;case i.PAN:if(n.enablePan===!1)return;ne(ve);break}}function me(ve){Q(ve),n.dispatchEvent(ZM),r=i.NONE}function Ee(ve){n.enabled===!1||n.enableZoom===!1||r!==i.NONE&&r!==i.ROTATE||(ve.preventDefault(),n.dispatchEvent(YM),j(ve),n.dispatchEvent(ZM))}function Se(ve){n.enabled===!1||n.enablePan===!1||O(ve)}function oe(ve){switch(we(ve),w.length){case 1:switch(n.touches.ONE){case Yo.ROTATE:if(n.enableRotate===!1)return;ee(),r=i.TOUCH_ROTATE;break;case Yo.PAN:if(n.enablePan===!1)return;V(),r=i.TOUCH_PAN;break;default:r=i.NONE}break;case 2:switch(n.touches.TWO){case Yo.DOLLY_PAN:if(n.enableZoom===!1&&n.enablePan===!1)return;ue(),r=i.TOUCH_DOLLY_PAN;break;case Yo.DOLLY_ROTATE:if(n.enableZoom===!1&&n.enableRotate===!1)return;ye(),r=i.TOUCH_DOLLY_ROTATE;break;default:r=i.NONE}break;default:r=i.NONE}r!==i.NONE&&n.dispatchEvent(YM)}function ge(ve){switch(we(ve),r){case i.TOUCH_ROTATE:if(n.enableRotate===!1)return;pe(ve),n.update();break;case i.TOUCH_PAN:if(n.enablePan===!1)return;xe(ve),n.update();break;case i.TOUCH_DOLLY_PAN:if(n.enableZoom===!1&&n.enablePan===!1)return;$(ve),n.update();break;case i.TOUCH_DOLLY_ROTATE:if(n.enableZoom===!1&&n.enableRotate===!1)return;J(ve),n.update();break;default:r=i.NONE}}function k(ve){ce(ve),n.dispatchEvent(ZM),r=i.NONE}function de(ve){n.enabled!==!1&&ve.preventDefault()}function K(ve){w.push(ve)}function be(ve){delete b[ve.pointerId];for(let Be=0;Be<w.length;Be++)if(w[Be].pointerId==ve.pointerId){w.splice(Be,1);return}}function we(ve){let Be=b[ve.pointerId];Be===void 0&&(Be=new _e,b[ve.pointerId]=Be),Be.set(ve.pageX,ve.pageY)}function We(ve){let Be=ve.pointerId===w[0].pointerId?w[1]:w[0];return b[Be.pointerId]}n.domElement.addEventListener("contextmenu",de),n.domElement.addEventListener("pointerdown",H),n.domElement.addEventListener("pointercancel",W),n.domElement.addEventListener("wheel",Ee,{passive:!1}),this.update()}};var BX=function(o,e,t,n){function i(r){return r instanceof t?r:new t(function(s){s(r)})}return new(t||(t=Promise))(function(r,s){function a(u){try{c(n.next(u))}catch(d){s(d)}}function l(u){try{c(n.throw(u))}catch(d){s(d)}}function c(u){u.done?r(u.value):i(u.value).then(a,l)}c((n=n.apply(o,e||[])).next())})},Bp=class{constructor(e,t,n,i,r,s,a){this.scene=e,this.renderer=t,this.camera=n,this.lights=i,this.physics=r,this.load=s,this.factories=a}warpSpeed(...e){return BX(this,void 0,void 0,function*(){let t={},n=e.filter(l=>/^-\w+/.test(l)),i=n.length>0;if((e.length===0||i)&&(e=["light","camera","lookAtCenter","ground","grid","orbitControls","fog","sky"]),i&&n.map(c=>c.substr(1)).forEach(c=>{let u=e.indexOf(c);e.splice(u,1)}),e.includes("sky")){let l=["varying vec3 vWorldPosition;","","void main() {","","vec4 worldPosition = modelMatrix * vec4( position, 1.0 );","vWorldPosition = worldPosition.xyz;","","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","","}"].join(`
`),c=["uniform vec3 topColor;","uniform vec3 bottomColor;","uniform float offset;","uniform float exponent;","","varying vec3 vWorldPosition;","","void main() {","","float h = normalize( vWorldPosition + offset ).y;","gl_FragColor = vec4( mix( bottomColor, topColor, max( pow( max( h , 0.0), exponent ), 0.0 ) ), 1.0 );","","}"].join(`
`),u={topColor:{value:new De(30719)},bottomColor:{value:new De(15595007)},offset:{value:33},exponent:{value:.6}};var r=new Ji(500,32,15),s=new Fn({uniforms:u,vertexShader:l,fragmentShader:c,side:Qt}),a=new et(r,s);this.scene.add(a)}if(e.includes("camera")&&(this.camera.position.set(0,6,12),t=Object.assign({camera:this.camera},t)),e.includes("light")){let l=.4,c=this.lights.hemisphereLight({skyColor:16777215,groundColor:0,intensity:l}),u=this.lights.ambientLight({color:16777215,intensity:l}),d=this.lights.directionalLight({color:16777215,intensity:l});d.position.set(100,200,50);let h=20;d.shadow.camera.top=h,d.shadow.camera.bottom=-h,d.shadow.camera.left=-h,d.shadow.camera.right=h,d.shadow.mapSize.set(1024,1024),t=Object.assign({lights:{ambientLight:u,directionalLight:d,hemisphereLight:c}},t)}if(e.includes("lookAtCenter")&&this.camera.lookAt(this.scene.position),e.includes("ground")){let l=e.includes("grid"),c="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAOnAAADusBZ+q87AAAAJtJREFUeJzt0EENwDAAxLDbNP6UOxh+NEYQ5dl2drFv286598GrA7QG6ACtATpAa4AO0BqgA7QG6ACtATpAa4AO0BqgA7QG6ACtATpAa4AO0BqgA7QG6ACtATpAa4AO0BqgA7QG6ACtATpAa4AO0BqgA7QG6ACtATpAa4AO0BqgA7QG6ACtATpAa4AO0BqgA7QG6ACtATpAu37AD8eaBH5JQdVbAAAAAElFTkSuQmCC",u=yield this.load.texture(c);u.wrapS=u.wrapT=En,u.repeat.set(21,21);let d={name:"ground",width:21,height:21,depth:1,y:-.5},h={phong:{map:l?u:null,color:16777215}},f;window.__loadPhysics?(f=this.physics.add.ground(d,h),f.body.setRestitution(1)):f=this.factories.add.ground(d,h),f.receiveShadow=!0,t=Object.assign({ground:f},t)}if(e.includes("orbitControls")){let l=new JM(this.camera,document.getElementById("enable3d-phaser-canvas")||this.renderer.domElement);t=Object.assign({orbitControls:l},t)}return t})}};var k3=class{constructor(){this._mixers=[]}animationMixer(e){let t=new Rf(e);return this.mixers.add(t),t}get mixers(){return{create:e=>this.animationMixer(e),add:e=>this._mixers.push(e),get:()=>this._mixers,update:e=>{var t;return(t=this._mixers)===null||t===void 0?void 0:t.forEach(n=>n.update(e/1e3))}}}},KM=k3;var za=class extends et{constructor(e,t={}){super(e);this.type="Reflector";let n=this,i=t.color!==void 0?new De(t.color):new De(8355711),r=t.textureWidth||512,s=t.textureHeight||512,a=t.clipBias||0,l=t.shader||za.ReflectorShader,c=new hn,u=new U,d=new U,h=new U,f=new Pe,p=new U(0,0,-1),g=new tt,v=new U,y=new U,m=new tt,x=new Pe,_=new It,w={minFilter:Lt,magFilter:Lt,format:Di},b=new Yn(r,s,w);(!cn.isPowerOfTwo(r)||!cn.isPowerOfTwo(s))&&(b.texture.generateMipmaps=!1);let M=new Fn({uniforms:sa.clone(l.uniforms),fragmentShader:l.fragmentShader,vertexShader:l.vertexShader});M.uniforms.tDiffuse.value=b.texture,M.uniforms.color.value=i,M.uniforms.textureMatrix.value=x,this.material=M,this.onBeforeRender=function(S,E,A){if(d.setFromMatrixPosition(n.matrixWorld),h.setFromMatrixPosition(A.matrixWorld),f.extractRotation(n.matrixWorld),u.set(0,0,1),u.applyMatrix4(f),v.subVectors(d,h),v.dot(u)>0)return;v.reflect(u).negate(),v.add(d),f.extractRotation(A.matrixWorld),p.set(0,0,-1),p.applyMatrix4(f),p.add(h),y.subVectors(d,p),y.reflect(u).negate(),y.add(d),_.position.copy(v),_.up.set(0,1,0),_.up.applyMatrix4(f),_.up.reflect(u),_.lookAt(y),_.far=A.far,_.updateMatrixWorld(),_.projectionMatrix.copy(A.projectionMatrix),x.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),x.multiply(_.projectionMatrix),x.multiply(_.matrixWorldInverse),x.multiply(n.matrixWorld),c.setFromNormalAndCoplanarPoint(u,d),c.applyMatrix4(_.matrixWorldInverse),g.set(c.normal.x,c.normal.y,c.normal.z,c.constant);let L=_.projectionMatrix;m.x=(Math.sign(g.x)+L.elements[8])/L.elements[0],m.y=(Math.sign(g.y)+L.elements[9])/L.elements[5],m.z=-1,m.w=(1+L.elements[10])/L.elements[14],g.multiplyScalar(2/g.dot(m)),L.elements[2]=g.x,L.elements[6]=g.y,L.elements[10]=g.z+1-a,L.elements[14]=g.w,b.texture.encoding=S.outputEncoding,n.visible=!1;let B=S.getRenderTarget(),R=S.xr.enabled,D=S.shadowMap.autoUpdate;S.xr.enabled=!1,S.shadowMap.autoUpdate=!1,S.setRenderTarget(b),S.state.buffers.depth.setMask(!0),S.autoClear===!1&&S.clear(),S.render(E,_),S.xr.enabled=R,S.shadowMap.autoUpdate=D,S.setRenderTarget(B);let P=A.viewport;P!==void 0&&S.state.viewport(P),n.visible=!0},this.getRenderTarget=function(){return b}}};za.prototype.isReflector=!0;za.ReflectorShader={uniforms:{color:{value:null},tDiffuse:{value:null},textureMatrix:{value:null}},vertexShader:`
		uniform mat4 textureMatrix;
		varying vec4 vUv;

		#include <common>
		#include <logdepthbuf_pars_vertex>

		void main() {

			vUv = textureMatrix * vec4( position, 1.0 );

			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

			#include <logdepthbuf_vertex>

		}`,fragmentShader:`
		uniform vec3 color;
		uniform sampler2D tDiffuse;
		varying vec4 vUv;

		#include <logdepthbuf_pars_fragment>

		float blendOverlay( float base, float blend ) {

			return( base < 0.5 ? ( 2.0 * base * blend ) : ( 1.0 - 2.0 * ( 1.0 - base ) * ( 1.0 - blend ) ) );

		}

		vec3 blendOverlay( vec3 base, vec3 blend ) {

			return vec3( blendOverlay( base.r, blend.r ), blendOverlay( base.g, blend.g ), blendOverlay( base.b, blend.b ) );

		}

		void main() {

			#include <logdepthbuf_fragment>

			vec4 base = texture2DProj( tDiffuse, vUv );
			gl_FragColor = vec4( blendOverlay( base.rgb, color ), 1.0 );

		}`};var Ua=class extends et{constructor(e,t={}){super(e);this.type="Refractor";let n=this,i=t.color!==void 0?new De(t.color):new De(8355711),r=t.textureWidth||512,s=t.textureHeight||512,a=t.clipBias||0,l=t.shader||Ua.RefractorShader,c=new It;c.matrixAutoUpdate=!1,c.userData.refractor=!0;let u=new hn,d=new Pe,h={minFilter:Lt,magFilter:Lt,format:Di},f=new Yn(r,s,h);(!cn.isPowerOfTwo(r)||!cn.isPowerOfTwo(s))&&(f.texture.generateMipmaps=!1),this.material=new Fn({uniforms:sa.clone(l.uniforms),vertexShader:l.vertexShader,fragmentShader:l.fragmentShader,transparent:!0}),this.material.uniforms.color.value=i,this.material.uniforms.tDiffuse.value=f.texture,this.material.uniforms.textureMatrix.value=d;let p=function(){let x=new U,_=new U,w=new Pe,b=new U,M=new U;return function(E){return x.setFromMatrixPosition(n.matrixWorld),_.setFromMatrixPosition(E.matrixWorld),b.subVectors(x,_),w.extractRotation(n.matrixWorld),M.set(0,0,1),M.applyMatrix4(w),b.dot(M)<0}}(),g=function(){let x=new U,_=new U,w=new gt,b=new U;return function(){n.matrixWorld.decompose(_,w,b),x.set(0,0,1).applyQuaternion(w).normalize(),x.negate(),u.setFromNormalAndCoplanarPoint(x,_)}}(),v=function(){let x=new hn,_=new tt,w=new tt;return function(M){c.matrixWorld.copy(M.matrixWorld),c.matrixWorldInverse.copy(c.matrixWorld).invert(),c.projectionMatrix.copy(M.projectionMatrix),c.far=M.far,x.copy(u),x.applyMatrix4(c.matrixWorldInverse),_.set(x.normal.x,x.normal.y,x.normal.z,x.constant);let S=c.projectionMatrix;w.x=(Math.sign(_.x)+S.elements[8])/S.elements[0],w.y=(Math.sign(_.y)+S.elements[9])/S.elements[5],w.z=-1,w.w=(1+S.elements[10])/S.elements[14],_.multiplyScalar(2/_.dot(w)),S.elements[2]=_.x,S.elements[6]=_.y,S.elements[10]=_.z+1-a,S.elements[14]=_.w}}();function y(x){d.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),d.multiply(x.projectionMatrix),d.multiply(x.matrixWorldInverse),d.multiply(n.matrixWorld)}function m(x,_,w){n.visible=!1;let b=x.getRenderTarget(),M=x.xr.enabled,S=x.shadowMap.autoUpdate;x.xr.enabled=!1,x.shadowMap.autoUpdate=!1,x.setRenderTarget(f),x.autoClear===!1&&x.clear(),x.render(_,c),x.xr.enabled=M,x.shadowMap.autoUpdate=S,x.setRenderTarget(b);let E=w.viewport;E!==void 0&&x.state.viewport(E),n.visible=!0}this.onBeforeRender=function(x,_,w){f.texture.encoding=x.outputEncoding,w.userData.refractor!==!0&&(!p(w)||(g(),y(w),v(w),m(x,_,w)))},this.getRenderTarget=function(){return f}}};Ua.prototype.isRefractor=!0;Ua.RefractorShader={uniforms:{color:{value:null},tDiffuse:{value:null},textureMatrix:{value:null}},vertexShader:`

		uniform mat4 textureMatrix;

		varying vec4 vUv;

		void main() {

			vUv = textureMatrix * vec4( position, 1.0 );
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform vec3 color;
		uniform sampler2D tDiffuse;

		varying vec4 vUv;

		float blendOverlay( float base, float blend ) {

			return( base < 0.5 ? ( 2.0 * base * blend ) : ( 1.0 - 2.0 * ( 1.0 - base ) * ( 1.0 - blend ) ) );

		}

		vec3 blendOverlay( vec3 base, vec3 blend ) {

			return vec3( blendOverlay( base.r, blend.r ), blendOverlay( base.g, blend.g ), blendOverlay( base.b, blend.b ) );

		}

		void main() {

			vec4 base = texture2DProj( tDiffuse, vUv );
			gl_FragColor = vec4( blendOverlay( base.rgb, color ), 1.0 );

		}`};var cc=class extends et{constructor(e,t={}){super(e);this.type="Water";let n=this,i=t.color!==void 0?new De(t.color):new De(16777215),r=t.textureWidth||512,s=t.textureHeight||512,a=t.clipBias||0,l=t.flowDirection||new _e(1,0),c=t.flowSpeed||.03,u=t.reflectivity||.02,d=t.scale||1,h=t.shader||cc.WaterShader,f=t.encoding!==void 0?t.encoding:Xn,p=new Vr,g=t.flowMap||void 0,v=t.normalMap0||p.load("textures/water/Water_1_M_Normal.jpg"),y=t.normalMap1||p.load("textures/water/Water_2_M_Normal.jpg"),m=.15,x=m*.5,_=new Pe,w=new ga;if(za===void 0){console.error("THREE.Water: Required component Reflector not found.");return}if(Ua===void 0){console.error("THREE.Water: Required component Refractor not found.");return}let b=new za(e,{textureWidth:r,textureHeight:s,clipBias:a,encoding:f}),M=new Ua(e,{textureWidth:r,textureHeight:s,clipBias:a,encoding:f});b.matrixAutoUpdate=!1,M.matrixAutoUpdate=!1,this.material=new Fn({uniforms:sa.merge([He.fog,h.uniforms]),vertexShader:h.vertexShader,fragmentShader:h.fragmentShader,transparent:!0,fog:!0}),g!==void 0?(this.material.defines.USE_FLOWMAP="",this.material.uniforms.tFlowMap={type:"t",value:g}):this.material.uniforms.flowDirection={type:"v2",value:l},v.wrapS=v.wrapT=En,y.wrapS=y.wrapT=En,this.material.uniforms.tReflectionMap.value=b.getRenderTarget().texture,this.material.uniforms.tRefractionMap.value=M.getRenderTarget().texture,this.material.uniforms.tNormalMap0.value=v,this.material.uniforms.tNormalMap1.value=y,this.material.uniforms.color.value=i,this.material.uniforms.reflectivity.value=u,this.material.uniforms.textureMatrix.value=_,this.material.uniforms.config.value.x=0,this.material.uniforms.config.value.y=x,this.material.uniforms.config.value.z=x,this.material.uniforms.config.value.w=d;function S(A){_.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),_.multiply(A.projectionMatrix),_.multiply(A.matrixWorldInverse),_.multiply(n.matrixWorld)}function E(){let A=w.getDelta(),L=n.material.uniforms.config;L.value.x+=c*A,L.value.y=L.value.x+x,L.value.x>=m?(L.value.x=0,L.value.y=x):L.value.y>=m&&(L.value.y=L.value.y-m)}this.onBeforeRender=function(A,L,B){S(B),E(),n.visible=!1,b.matrixWorld.copy(n.matrixWorld),M.matrixWorld.copy(n.matrixWorld),b.onBeforeRender(A,L,B),M.onBeforeRender(A,L,B),n.visible=!0}}};cc.prototype.isWater=!0;cc.WaterShader={uniforms:{color:{type:"c",value:null},reflectivity:{type:"f",value:0},tReflectionMap:{type:"t",value:null},tRefractionMap:{type:"t",value:null},tNormalMap0:{type:"t",value:null},tNormalMap1:{type:"t",value:null},textureMatrix:{type:"m4",value:null},config:{type:"v4",value:new tt}},vertexShader:`

		#include <common>
		#include <fog_pars_vertex>
		#include <logdepthbuf_pars_vertex>

		uniform mat4 textureMatrix;

		varying vec4 vCoord;
		varying vec2 vUv;
		varying vec3 vToEye;

		void main() {

			vUv = uv;
			vCoord = textureMatrix * vec4( position, 1.0 );

			vec4 worldPosition = modelMatrix * vec4( position, 1.0 );
			vToEye = cameraPosition - worldPosition.xyz;

			vec4 mvPosition =  viewMatrix * worldPosition; // used in fog_vertex
			gl_Position = projectionMatrix * mvPosition;

			#include <logdepthbuf_vertex>
			#include <fog_vertex>

		}`,fragmentShader:`

		#include <common>
		#include <fog_pars_fragment>
		#include <logdepthbuf_pars_fragment>

		uniform sampler2D tReflectionMap;
		uniform sampler2D tRefractionMap;
		uniform sampler2D tNormalMap0;
		uniform sampler2D tNormalMap1;

		#ifdef USE_FLOWMAP
			uniform sampler2D tFlowMap;
		#else
			uniform vec2 flowDirection;
		#endif

		uniform vec3 color;
		uniform float reflectivity;
		uniform vec4 config;

		varying vec4 vCoord;
		varying vec2 vUv;
		varying vec3 vToEye;

		void main() {

			#include <logdepthbuf_fragment>

			float flowMapOffset0 = config.x;
			float flowMapOffset1 = config.y;
			float halfCycle = config.z;
			float scale = config.w;

			vec3 toEye = normalize( vToEye );

			// determine flow direction
			vec2 flow;
			#ifdef USE_FLOWMAP
				flow = texture2D( tFlowMap, vUv ).rg * 2.0 - 1.0;
			#else
				flow = flowDirection;
			#endif
			flow.x *= - 1.0;

			// sample normal maps (distort uvs with flowdata)
			vec4 normalColor0 = texture2D( tNormalMap0, ( vUv * scale ) + flow * flowMapOffset0 );
			vec4 normalColor1 = texture2D( tNormalMap1, ( vUv * scale ) + flow * flowMapOffset1 );

			// linear interpolate to get the final normal color
			float flowLerp = abs( halfCycle - flowMapOffset0 ) / halfCycle;
			vec4 normalColor = mix( normalColor0, normalColor1, flowLerp );

			// calculate normal vector
			vec3 normal = normalize( vec3( normalColor.r * 2.0 - 1.0, normalColor.b,  normalColor.g * 2.0 - 1.0 ) );

			// calculate the fresnel term to blend reflection and refraction maps
			float theta = max( dot( toEye, normal ), 0.0 );
			float reflectance = reflectivity + ( 1.0 - reflectivity ) * pow( ( 1.0 - theta ), 5.0 );

			// calculate final uv coords
			vec3 coord = vCoord.xyz / vCoord.w;
			vec2 uv = coord.xy + coord.z * normal.xz * 0.05;

			vec4 reflectColor = texture2D( tReflectionMap, vec2( 1.0 - uv.x, uv.y ) );
			vec4 refractColor = texture2D( tRefractionMap, uv );

			// multiply water color with the mix of both textures
			gl_FragColor = vec4( color, 1.0 ) * mix( refractColor, reflectColor, reflectance );

			#include <tonemapping_fragment>
			#include <encodings_fragment>
			#include <fog_fragment>

		}`};var z3=(o,e,t={})=>{let{width:n=20,height:i=20,x:r=0,y:s=0,z:a=0,color:l="#ffffff",scale:c=4,flowX:u=1,flowY:d=1,normalMap0:h=void 0,normalMap1:f=void 0}=t,p=new Bi(n,i),g=new Ur({color:30654,transparent:!0,opacity:.8}),v=new et(p,g);v.position.set(r,s,a),v.rotation.x=Math.PI*-.5,o.add(v);let y=new Bi(n,i),m=new cc(y,{color:l,scale:c,flowDirection:new _e(u,d),textureWidth:1024,textureHeight:1024,normalMap0:h,normalMap1:f,encoding:e.outputEncoding});return m.position.set(r,s+.1,a),m.rotation.x=Math.PI*-.5,o.add(m),{ground:v,water:m}};var Np=class{constructor(e,t,n){this.scene=e,this.renderer=t,this.factories=n}water(e={}){z3(this.scene,this.renderer,e)}textureCube(e){e.length!==6&&Tn("You need to pass 6 urls to textureCube()");let t=new $M;return e.forEach((n,i)=>{n.wrapS=n.wrapT=En;let r=this.factories.add.material({phong:{map:n}});t.materials[i]=r}),t}},$M=class{constructor(){this.materials=new Array(6)}get texture(){return{left:this.getTexture(0),right:this.getTexture(1),up:this.getTexture(2),down:this.getTexture(3),front:this.getTexture(4),back:this.getTexture(5)}}getTexture(e){return this.materials[e].map}};var QM=class{static createButton(e,t){t&&console.error('THREE.VRButton: The "options" parameter has been removed. Please set the reference space type via renderer.xr.setReferenceSpaceType() instead.');let n=document.createElement("button");function i(){let l=null;async function c(d){d.addEventListener("end",u),await e.xr.setSession(d),n.textContent="EXIT VR",l=d}function u(){l.removeEventListener("end",u),n.textContent="ENTER VR",l=null}n.style.display="",n.style.cursor="pointer",n.style.left="calc(50% - 50px)",n.style.width="100px",n.textContent="ENTER VR",n.onmouseenter=function(){n.style.opacity="1.0"},n.onmouseleave=function(){n.style.opacity="0.5"},n.onclick=function(){if(l===null){let d={optionalFeatures:["local-floor","bounded-floor","hand-tracking","layers"]};navigator.xr.requestSession("immersive-vr",d).then(c)}else l.end()}}function r(){n.style.display="",n.style.cursor="auto",n.style.left="calc(50% - 75px)",n.style.width="150px",n.onmouseenter=null,n.onmouseleave=null,n.onclick=null}function s(){r(),n.textContent="VR NOT SUPPORTED"}function a(l){l.style.position="absolute",l.style.bottom="20px",l.style.padding="12px 6px",l.style.border="1px solid #fff",l.style.borderRadius="4px",l.style.background="rgba(0,0,0,0.1)",l.style.color="#fff",l.style.font="normal 13px sans-serif",l.style.textAlign="center",l.style.opacity="0.5",l.style.outline="none",l.style.zIndex="999"}if("xr"in navigator)return n.id="VRButton",n.style.display="none",a(n),navigator.xr.isSessionSupported("immersive-vr").then(function(l){l?i():s()}),n;{let l=document.createElement("a");return window.isSecureContext===!1?(l.href=document.location.href.replace(/^http:/,"https:"),l.innerHTML="WEBXR NEEDS HTTPS"):(l.href="https://immersiveweb.dev/",l.innerHTML="WEBXR NOT AVAILABLE"),l.style.left="calc(50% - 90px)",l.style.width="180px",l.style.textDecoration="none",a(l),l}}};var rn={Handedness:Object.freeze({NONE:"none",LEFT:"left",RIGHT:"right"}),ComponentState:Object.freeze({DEFAULT:"default",TOUCHED:"touched",PRESSED:"pressed"}),ComponentProperty:Object.freeze({BUTTON:"button",X_AXIS:"xAxis",Y_AXIS:"yAxis",STATE:"state"}),ComponentType:Object.freeze({TRIGGER:"trigger",SQUEEZE:"squeeze",TOUCHPAD:"touchpad",THUMBSTICK:"thumbstick",BUTTON:"button"}),ButtonTouchThreshold:.05,AxisTouchThreshold:.1,VisualResponseProperty:Object.freeze({TRANSFORM:"transform",VISIBILITY:"visibility"})};async function U3(o){let e=await fetch(o);if(e.ok)return e.json();throw new Error(e.statusText)}async function NX(o){if(!o)throw new Error("No basePath supplied");return await U3(`${o}/profilesList.json`)}async function H3(o,e,t=null,n=!0){if(!o)throw new Error("No xrInputSource supplied");if(!e)throw new Error("No basePath supplied");let i=await NX(e),r;if(o.profiles.some(l=>{let c=i[l];return c&&(r={profileId:l,profilePath:`${e}/${c.path}`,deprecated:!!c.deprecated}),!!r}),!r){if(!t)throw new Error("No matching profile name found");let l=i[t];if(!l)throw new Error(`No matching profile name found and default profile "${t}" missing.`);r={profileId:t,profilePath:`${e}/${l.path}`,deprecated:!!l.deprecated}}let s=await U3(r.profilePath),a;if(n){let l;if(o.handedness==="any"?l=s.layouts[Object.keys(s.layouts)[0]]:l=s.layouts[o.handedness],!l)throw new Error(`No matching handedness, ${o.handedness}, in profile ${r.profileId}`);l.assetPath&&(a=r.profilePath.replace("profile.json",l.assetPath))}return{profile:s,assetPath:a}}var OX={xAxis:0,yAxis:0,button:0,state:rn.ComponentState.DEFAULT};function kX(o=0,e=0){let t=o,n=e;if(Math.sqrt(o*o+e*e)>1){let s=Math.atan2(e,o);t=Math.cos(s),n=Math.sin(s)}return{normalizedXAxis:t*.5+.5,normalizedYAxis:n*.5+.5}}var G3=class{constructor(e){this.componentProperty=e.componentProperty,this.states=e.states,this.valueNodeName=e.valueNodeName,this.valueNodeProperty=e.valueNodeProperty,this.valueNodeProperty===rn.VisualResponseProperty.TRANSFORM&&(this.minNodeName=e.minNodeName,this.maxNodeName=e.maxNodeName),this.value=0,this.updateFromComponent(OX)}updateFromComponent({xAxis:e,yAxis:t,button:n,state:i}){let{normalizedXAxis:r,normalizedYAxis:s}=kX(e,t);switch(this.componentProperty){case rn.ComponentProperty.X_AXIS:this.value=this.states.includes(i)?r:.5;break;case rn.ComponentProperty.Y_AXIS:this.value=this.states.includes(i)?s:.5;break;case rn.ComponentProperty.BUTTON:this.value=this.states.includes(i)?n:0;break;case rn.ComponentProperty.STATE:this.valueNodeProperty===rn.VisualResponseProperty.VISIBILITY?this.value=this.states.includes(i):this.value=this.states.includes(i)?1:0;break;default:throw new Error(`Unexpected visualResponse componentProperty ${this.componentProperty}`)}}},V3=class{constructor(e,t){if(!e||!t||!t.visualResponses||!t.gamepadIndices||Object.keys(t.gamepadIndices).length===0)throw new Error("Invalid arguments supplied");this.id=e,this.type=t.type,this.rootNodeName=t.rootNodeName,this.touchPointNodeName=t.touchPointNodeName,this.visualResponses={},Object.keys(t.visualResponses).forEach(n=>{let i=new G3(t.visualResponses[n]);this.visualResponses[n]=i}),this.gamepadIndices=Object.assign({},t.gamepadIndices),this.values={state:rn.ComponentState.DEFAULT,button:this.gamepadIndices.button!==void 0?0:void 0,xAxis:this.gamepadIndices.xAxis!==void 0?0:void 0,yAxis:this.gamepadIndices.yAxis!==void 0?0:void 0}}get data(){return{id:this.id,...this.values}}updateFromGamepad(e){if(this.values.state=rn.ComponentState.DEFAULT,this.gamepadIndices.button!==void 0&&e.buttons.length>this.gamepadIndices.button){let t=e.buttons[this.gamepadIndices.button];this.values.button=t.value,this.values.button=this.values.button<0?0:this.values.button,this.values.button=this.values.button>1?1:this.values.button,t.pressed||this.values.button===1?this.values.state=rn.ComponentState.PRESSED:(t.touched||this.values.button>rn.ButtonTouchThreshold)&&(this.values.state=rn.ComponentState.TOUCHED)}this.gamepadIndices.xAxis!==void 0&&e.axes.length>this.gamepadIndices.xAxis&&(this.values.xAxis=e.axes[this.gamepadIndices.xAxis],this.values.xAxis=this.values.xAxis<-1?-1:this.values.xAxis,this.values.xAxis=this.values.xAxis>1?1:this.values.xAxis,this.values.state===rn.ComponentState.DEFAULT&&Math.abs(this.values.xAxis)>rn.AxisTouchThreshold&&(this.values.state=rn.ComponentState.TOUCHED)),this.gamepadIndices.yAxis!==void 0&&e.axes.length>this.gamepadIndices.yAxis&&(this.values.yAxis=e.axes[this.gamepadIndices.yAxis],this.values.yAxis=this.values.yAxis<-1?-1:this.values.yAxis,this.values.yAxis=this.values.yAxis>1?1:this.values.yAxis,this.values.state===rn.ComponentState.DEFAULT&&Math.abs(this.values.yAxis)>rn.AxisTouchThreshold&&(this.values.state=rn.ComponentState.TOUCHED)),Object.values(this.visualResponses).forEach(t=>{t.updateFromComponent(this.values)})}},e1=class{constructor(e,t,n){if(!e)throw new Error("No xrInputSource supplied");if(!t)throw new Error("No profile supplied");this.xrInputSource=e,this.assetUrl=n,this.id=t.profileId,this.layoutDescription=t.layouts[e.handedness],this.components={},Object.keys(this.layoutDescription.components).forEach(i=>{let r=this.layoutDescription.components[i];this.components[i]=new V3(i,r)}),this.updateFromGamepad()}get gripSpace(){return this.xrInputSource.gripSpace}get targetRaySpace(){return this.xrInputSource.targetRaySpace}get data(){let e=[];return Object.values(this.components).forEach(t=>{e.push(t.data)}),e}updateFromGamepad(){Object.values(this.components).forEach(e=>{e.updateFromGamepad(this.xrInputSource.gamepad)})}};var zX="https://cdn.jsdelivr.net/npm/@webxr-input-profiles/assets@1.0/dist/profiles",UX="generic-trigger",W3=class extends $e{constructor(){super();this.motionController=null,this.envMap=null}setEnvironmentMap(e){return this.envMap==e?this:(this.envMap=e,this.traverse(t=>{t.isMesh&&(t.material.envMap=this.envMap,t.material.needsUpdate=!0)}),this)}updateMatrixWorld(e){super.updateMatrixWorld(e),!!this.motionController&&(this.motionController.updateFromGamepad(),Object.values(this.motionController.components).forEach(t=>{Object.values(t.visualResponses).forEach(n=>{let{valueNode:i,minNode:r,maxNode:s,value:a,valueNodeProperty:l}=n;!i||(l===rn.VisualResponseProperty.VISIBILITY?i.visible=a:l===rn.VisualResponseProperty.TRANSFORM&&(i.quaternion.slerpQuaternions(r.quaternion,s.quaternion,a),i.position.lerpVectors(r.position,s.position,a)))})}))}};function HX(o,e){Object.values(o.components).forEach(t=>{let{type:n,touchPointNodeName:i,visualResponses:r}=t;if(n===rn.ComponentType.TOUCHPAD)if(t.touchPointNode=e.getObjectByName(i),t.touchPointNode){let s=new Ji(.001),a=new Jt({color:255}),l=new et(s,a);t.touchPointNode.add(l)}else console.warn(`Could not find touch dot, ${t.touchPointNodeName}, in touchpad component ${t.id}`);Object.values(r).forEach(s=>{let{valueNodeName:a,minNodeName:l,maxNodeName:c,valueNodeProperty:u}=s;if(u===rn.VisualResponseProperty.TRANSFORM){if(s.minNode=e.getObjectByName(l),s.maxNode=e.getObjectByName(c),!s.minNode){console.warn(`Could not find ${l} in the model`);return}if(!s.maxNode){console.warn(`Could not find ${c} in the model`);return}}s.valueNode=e.getObjectByName(a),s.valueNode||console.warn(`Could not find ${a} in the model`)})})}function X3(o,e){HX(o.motionController,e),o.envMap&&e.traverse(t=>{t.isMesh&&(t.material.envMap=o.envMap,t.material.needsUpdate=!0)}),o.add(e)}var t1=class{constructor(e=null){this.gltfLoader=e,this.path=zX,this._assetCache={},this.gltfLoader||(this.gltfLoader=new Wf)}createControllerModel(e){let t=new W3,n=null;return e.addEventListener("connected",i=>{let r=i.data;r.targetRayMode!=="tracked-pointer"||!r.gamepad||H3(r,this.path,UX).then(({profile:s,assetPath:a})=>{t.motionController=new e1(r,s,a);let l=this._assetCache[t.motionController.assetUrl];if(l)n=l.scene.clone(),X3(t,n);else{if(!this.gltfLoader)throw new Error("GLTFLoader not set.");this.gltfLoader.setPath(""),this.gltfLoader.load(t.motionController.assetUrl,c=>{this._assetCache[t.motionController.assetUrl]=c,n=c.scene.clone(),X3(t,n)},null,()=>{throw new Error(`Asset ${t.motionController.assetUrl} missing or malformed.`)})}}).catch(s=>{console.warn(s)})}),e.addEventListener("disconnected",()=>{t.motionController=null,t.remove(n),n=null}),t}};var Op=class{constructor(e,t,n){this._renderer=e,this._scene=t,this._camera=n,this.controllerModelFactory=new t1,this.cameraGroup=new Zn,this.cameraGroup.add(n),t.add(this.cameraGroup),e.xr.enabled=!0;let i=QM.createButton(e);i.style.cssText+="background: rgba(0, 0, 0, 0.8); ",document.body.appendChild(i)}get isPresenting(){var e,t;return!!((t=(e=this._renderer)===null||e===void 0?void 0:e.xr)===null||t===void 0?void 0:t.isPresenting)}getController(e){let t=this._renderer.xr.getController(e);return this.cameraGroup.add(t),t}getControllerGrip(e){let t=this._renderer.xr.getControllerGrip(e),n=this.controllerModelFactory.createControllerModel(t);return t.add(n),this.cameraGroup.add(t),t}getControllerRay(e){let{targetRayMode:t}=e;if(t==="tracked-pointer"){let n=new Ue;n.setAttribute("position",new Ne([0,0,0,0,0,-1],3)),n.setAttribute("color",new Ne([1,0,0,1,1,1],3));let i=new zt({vertexColors:!0});return new ai(n,i)}if(t==="gaze"){let n=new ha(.02,.04,32).translate(0,0,-1),i=new Jt({color:"red",opacity:.5,transparent:!0});return new et(n,i)}}get camera(){return this.WebXRCamera}get WebXRCamera(){var e;return{group:this.cameraGroup,position:(e=this.cameraGroup)===null||e===void 0?void 0:e.position,rotation:this.isPresenting?this._renderer.xr.getCamera(this._camera).rotation:void 0,getWorldDirection:t=>this.isPresenting?this._renderer.xr.getCamera(this._camera).getWorldDirection(t):void 0}}};var GX=(o=20,e)=>{if(!window.__loadPhysics){console.log("There is not much fun without physics enabled!");return}for(let t=0;t<o;t++){let n=["standard","basic","normal","phong","line","points"],i=(s,a)=>Math.floor(Math.random()*(a-s+1)+s),r=s=>s[Math.floor(Math.random()*s.length)];Math.random()>.5?e.add.box({x:i(-10,10),y:i(10,20),z:i(-10,10),width:i(1,2)/10,height:i(1,2)/10,depth:i(1,2)/10,mass:1},{[r(n)]:{color:Math.floor(Math.random()*16777215)}}).body.setRestitution(Math.floor(Math.random()*10)/20):e.add.sphere({x:i(-10,10),y:i(10,20),z:i(-10,10),radius:i(1,2)/10,mass:1},{[r(n)]:{color:Math.floor(Math.random()*16777215)}}).body.setRestitution(Math.floor(Math.random()*10)/20)}},n1=GX;var Ds=class{perspectiveCamera(e={}){return Ds.Perspective(e)}orthographicCamera(e={}){return Ds.Orthographic(e)}static Perspective(e={}){let{fov:t=50,aspect:n=window.innerWidth/window.innerHeight,near:i=.1,far:r=2e3,x:s=0,y:a=5,z:l=25}=e,c=new It(t,n,i,r);return c.position.set(s,a,l),c}static Orthographic(e={}){let t=window.innerWidth,n=window.innerHeight,{left:i=t/-2,right:r=t/2,top:s=n/2,bottom:a=n/-2,near:l=1,far:c=1e3,x:u=0,y:d=0,z:h=10}=e,f=new ci(i,r,s,a,l,c);return f.position.set(u,d,h),f}};var uc=function(o,e,t,n){function i(r){return r instanceof t?r:new t(function(s){s(r)})}return new(t||(t=Promise))(function(r,s){function a(u){try{c(n.next(u))}catch(d){s(d)}}function l(u){try{c(n.throw(u))}catch(d){s(d)}}function c(u){u.done?r(u.value):i(u.value).then(a,l)}c((n=n.apply(o,e||[])).next())})},W0=class{constructor(e={}){this.sceneConfig=e,this.scenes=new Map,this.__config={},this._isRunning=!1,this._deconstructor=[];let{key:t=Math.random().toString(),enableXR:n=!1}=e;this.__config.sceneKey=t,this.__config.enableXR=n}get deconstructor(){return{add:(...e)=>{e.forEach(t=>{this._deconstructor.push(t)})}}}initializeScene(e){let{renderer:t,parent:n,canvas:i,scene:r,scenes:s,camera:a,cache:l,physics:c,sceneConfig:u}=e;this.scene=r,this.scenes=s,this.camera=a,this.cache=l,this.physics=c,this.renderer=t,this.parent=n,this.canvas=i;let{autoStart:d,textureAnisotropy:h}=u;this.load=new Yf(this.cache,h),this.lights=new Zf(this.scene),this.transform=new fo(this.camera,this.renderer),this.csg=jw,this.heightMap=new Fp(this.scene),this.factories=new lc(this.scene),this.misc=new Np(this.scene,this.renderer,this.factories),this.ws=new Bp(r,t,a,this.lights,this.physics,this.load,this.factories),this.mixers=new KM,this.cameras=new Ds,this.clock=new ga,this.__config.enableXR&&(this.webXR=new Op(this.renderer,this.scene,this.camera)),d&&this.start(this.__config.sceneKey)}get sceneKey(){return this.__config.sceneKey}destroy(e){var t;(t=this.physics)===null||t===void 0||t.destroy(e.body),this.scene.remove(e),e=null}warpSpeed(...e){return uc(this,void 0,void 0,function*(){return yield this.ws.warpSpeed(...e)})}get animationMixers(){return this.mixers.mixers}get make(){return this.factories.make}get add(){return this.factories.add}haveSomeFun(e=20){n1(e,this.physics)}isRunning(){return this._isRunning}start(e,t){var n;return uc(this,void 0,void 0,function*(){e&&e!==this.__config.sceneKey?(this.stop(),(n=this.scenes.get(e))===null||n===void 0||n._start(t)):this._start(t)})}_start(e){var t;return uc(this,void 0,void 0,function*(){yield(t=this.init)===null||t===void 0?void 0:t.call(this,e),yield this._preload(),yield this._create(),this.renderer.setAnimationLoop(()=>{this._update()}),this._isRunning=!0})}restart(e){return uc(this,void 0,void 0,function*(){yield this.stop(),yield this.start(this.__config.sceneKey,e)})}stop(){var e,t,n;return uc(this,void 0,void 0,function*(){this._isRunning=!1,this.renderer.setAnimationLoop(null),this.clock.start();for(let i of this._deconstructor)yield(e=i.dispose)===null||e===void 0?void 0:e.call(i),yield(t=i.destroy)===null||t===void 0?void 0:t.call(i),typeof i=="function"&&(yield i==null?void 0:i()),i=null;if(this._deconstructor=[],(n=this.physics)===null||n===void 0?void 0:n.rigidBodies)for(let i=this.physics.rigidBodies.length-1;i>=0;i--)this.physics.destroy(this.physics.rigidBodies[i]);for(let i=this.scene.children.length-1;i>=0;i--)this.scene.remove(this.scene.children[i])})}setSize(e,t){this.renderer.setSize(e,t),typeof this.camera.aspect!="undefined"&&(this.camera.aspect=e/t),this.camera.updateProjectionMatrix()}setPixelRatio(e){this.renderer.setPixelRatio(e)}init(e={}){}preload(){}create(){}update(e,t){}preRender(){}postRender(){}_preload(){var e;return uc(this,void 0,void 0,function*(){yield(e=this.preload)===null||e===void 0?void 0:e.call(this)})}_create(){var e;return uc(this,void 0,void 0,function*(){yield(e=this.create)===null||e===void 0?void 0:e.call(this)})}_update(){var e,t,n;let i=this.clock.getDelta()*1e3,r=this.clock.getElapsedTime();(e=this.update)===null||e===void 0||e.call(this,parseFloat(r.toFixed(3)),parseInt(i.toString())),(t=this.physics)===null||t===void 0||t.update(i),(n=this.physics)===null||n===void 0||n.updateDebugger(),this.animationMixers.update(i),this.preRender(),this.composer?this.composer.render():this.renderer.render(this.scene,this.camera),this.postRender()}};"use strict";"use strict";var i1=qo(hc());var Z3=class{constructor(e,t){this.physics=e,this.ammo=t,this.ignoreScale=!1,this.isSoftBody=!1,this.offset={x:0,y:0,z:0},this.errors=[],this.checkCollisions=!1,this.breakable=!1,this.fractureImpulse=1,this.didUpdate=!1,this.skipUpdate=!1,this._emitUpdateEvents=!1,this._needUpdate=!1,this.tmpEuler=new wo,this.tmpQuaternion=new Kn,this.tmpBtVector3=new Ammo.btVector3,this.tmpBtVector3_1=new Ammo.btVector3,this.tmpBtQuaternion=new Ammo.btQuaternion(0,0,0,1),this.eventEmitter=new i1.Events,this.name=t.name}destructor(){this.eventEmitter&&this.eventEmitter.removeAllListeners(),Ammo.destroy(this.tmpBtVector3),Ammo.destroy(this.tmpBtVector3_1),Ammo.destroy(this.tmpBtQuaternion),Ammo.destroy(this.ammo.getCollisionShape()),Ammo.destroy(this.ammo)}setupEventEmitter(){typeof this.eventEmitter=="undefined"&&(this.eventEmitter=new i1.Events)}get needUpdate(){return this._needUpdate}set needUpdate(e){!e&&this._needUpdate&&(this.didUpdate=!0),this._needUpdate=e}onUpdateEvent(e,t=!1){this.setupEventEmitter(),this._emitUpdateEvents=!0,t?this.eventEmitter.once("update",()=>{e()}):this.eventEmitter.on("update",()=>{e()})}get on(){return{update:e=>this.onUpdateEvent(e),collision:e=>this.onCollision(e)}}get once(){return{update:e=>this.onUpdateEvent(e,!0)}}onCollision(e){this.checkCollisions=!0,this.physics.collisionEvents.on("collision",t=>{let{bodies:n,event:i}=t;n[0].name===this.name?e(n[1],i):n[1].name===this.name&&e(n[0],i)})}transform(){let e=this.physics.worldTransform;this.ammo.getMotionState().getWorldTransform(e)}refresh(){let e=this.physics.worldTransform;this.ammo.getMotionState().setWorldTransform(e)}setRotation(e,t,n){let i=this.tmpEuler.set(e,t,n),r=this.tmpQuaternion.set(0,0,0,1);r.setFromEuler(i),this.tmpBtQuaternion.setValue(0,0,0,1);let s=this.tmpBtQuaternion;s.setValue(r.x,r.y,r.z,r.w),this.physics.worldTransform.setRotation(s)}get rotation(){let e,t,n,r=this.physics.worldTransform.getRotation(),s=this.tmpQuaternion.set(r.x(),r.y(),r.z(),r.w());s.w>1&&(s=s.normalize());let a=2*Math.acos(s.w),l=Math.sqrt(1-s.w*s.w);return l<.001?(e=s.x,t=s.y,n=s.z):(e=s.x/l,t=s.y/l,n=s.z/l),{x:e*a,y:t*a,z:n*a}}get quaternion(){let t=this.physics.worldTransform.getRotation();return{x:t.x(),y:t.y(),z:t.z(),w:t.w()}}setPosition(e,t,n){this.physics.worldTransform.getOrigin().setValue(e,t,n)}get position(){let e=this.physics.worldTransform;return{x:e.getOrigin().x(),y:e.getOrigin().y(),z:e.getOrigin().z()}}get velocity(){return{x:this.ammo.getLinearVelocity().x(),y:this.ammo.getLinearVelocity().y(),z:this.ammo.getLinearVelocity().z()}}get angularVelocity(){return{x:this.ammo.getAngularVelocity().x(),y:this.ammo.getAngularVelocity().y(),z:this.ammo.getAngularVelocity().z()}}setVelocity(e,t,n){this.tmpBtVector3.setValue(e,t,n),this.ammo.setLinearVelocity(this.tmpBtVector3)}setVelocityX(e){this.tmpBtVector3.setValue(e,this.velocity.y,this.velocity.z),this.ammo.setLinearVelocity(this.tmpBtVector3)}setVelocityY(e){this.tmpBtVector3.setValue(this.velocity.x,e,this.velocity.z),this.ammo.setLinearVelocity(this.tmpBtVector3)}setVelocityZ(e){this.tmpBtVector3.setValue(this.velocity.x,this.velocity.y,e),this.ammo.setLinearVelocity(this.tmpBtVector3)}setAngularVelocity(e,t,n){this.tmpBtVector3.setValue(e,t,n),this.ammo.setAngularVelocity(this.tmpBtVector3)}setAngularVelocityX(e){this.tmpBtVector3.setValue(e,this.angularVelocity.y,this.angularVelocity.z),this.ammo.setAngularVelocity(this.tmpBtVector3)}setAngularVelocityY(e){this.tmpBtVector3.setValue(this.angularVelocity.x,e,this.angularVelocity.z),this.ammo.setAngularVelocity(this.tmpBtVector3)}setAngularVelocityZ(e){this.tmpBtVector3.setValue(this.angularVelocity.x,this.angularVelocity.y,e),this.ammo.setAngularVelocity(this.tmpBtVector3)}applyForce(e,t,n){this.tmpBtVector3.setValue(e,t,n),this.ammo.applyCentralImpulse(this.tmpBtVector3)}applyForceX(e){this.tmpBtVector3.setValue(e,0,0),this.ammo.applyCentralImpulse(this.tmpBtVector3)}applyForceY(e){this.tmpBtVector3.setValue(0,e,0),this.ammo.applyCentralImpulse(this.tmpBtVector3)}applyForceZ(e){this.tmpBtVector3.setValue(0,0,e),this.ammo.applyCentralImpulse(this.tmpBtVector3)}applyCentralForce(e,t,n){this.tmpBtVector3.setValue(e,t,n),this.ammo.applyCentralForce(this.tmpBtVector3)}applyCentralImpulse(e,t,n){this.tmpBtVector3.setValue(e,t,n),this.ammo.applyCentralImpulse(this.tmpBtVector3)}applyCentralLocalForce(e,t,n){this.tmpBtVector3.setValue(e,t,n),this.ammo.applyCentralLocalForce(this.tmpBtVector3)}applyImpulse(e,t){this.tmpBtVector3.setValue(e.x||0,e.y||0,e.z||0),this.tmpBtVector3_1.setValue(t.x||0,t.y||0,t.z||0),this.ammo.applyImpulse(this.tmpBtVector3,this.tmpBtVector3_1)}applyLocalTorque(e,t,n){this.tmpBtVector3.setValue(e,t,n),this.ammo.applyLocalTorque(this.tmpBtVector3)}applyTorque(e,t,n){this.tmpBtVector3.setValue(e,t,n),this.ammo.applyTorque(this.tmpBtVector3)}applyTorqueImpulse(e,t,n){this.tmpBtVector3.setValue(e,t,n),this.ammo.applyTorqueImpulse(this.tmpBtVector3)}setCollisionFlags(e){this.ammo.setCollisionFlags(e)}getCollisionFlags(){return this.ammo.getCollisionFlags()}setRestitution(e){this.ammo.setRestitution(e)}setBounciness(e){this.setRestitution(e)}setFriction(e){this.ammo.setFriction(e)}setDamping(e,t){this.ammo.setDamping(e,t)}setGravity(e,t,n){this.tmpBtVector3.setValue(e,t,n),this.ammo.setGravity(this.tmpBtVector3)}setLinearFactor(e,t,n){this.tmpBtVector3.setValue(e,t,n),this.ammo.setLinearFactor(this.tmpBtVector3)}setAngularFactor(e,t,n){this.tmpBtVector3.setValue(e,t,n),this.ammo.setAngularFactor(this.tmpBtVector3)}setCcdMotionThreshold(e){this.ammo.setCcdMotionThreshold(e)}setCcdSweptSphereRadius(e){this.ammo.setCcdSweptSphereRadius(e)}},J3=Z3;var K3=class{constructor(e,t){this.factory=e,this.addExisting=t}addPlane(e={},t={}){let n=this.factory.add.plane(e,t);return this.addExisting(n,e),n}addSphere(e={},t={}){let n=this.factory.add.sphere(e,t);return this.addExisting(n,e),n}addBox(e={},t={}){let n=this.factory.add.box(e,t);return this.addExisting(n,e),n}addGround(e,t={}){let n=this.factory.add.ground(e,t),i=Object.assign(Object.assign({},e),{mass:0,collisionFlags:1});return this.addExisting(n,i),n}addCylinder(e={},t={}){let n=this.factory.add.cylinder(e,t);return this.addExisting(n,e),n}addCone(e={},t={}){let n=this.factory.add.cone(e,t);return this.addExisting(n,e),n}addTorus(e={},t={}){let n=this.factory.add.torus(e,t);return this.addExisting(n,e),n}addExtrude(e,t={}){let n=this.factory.add.extrude(e,t);return n.translateX(1),this.addExisting(n),n}},$3=K3;var j0=class{constructor(e,t){this.worldTransform=e,this.physicsWorld=t,this.tmpBtVector3=new Ammo.btVector3}toAmmoV3(e,t=0){return new Ammo.btVector3(typeof(e==null?void 0:e.x)!="undefined"?e.x:t,typeof(e==null?void 0:e.y)!="undefined"?e.y:t,typeof(e==null?void 0:e.z)!="undefined"?e.z:t)}get addConstraints(){return{lock:(e,t,n)=>this.lock(e,t,n),fixed:(e,t,n)=>this.fixed(e,t,n),pointToPoint:(e,t,n,i)=>this.pointToPoint(e,t,n,i),hinge:(e,t,n,i)=>this.hinge(e,t,n,i),slider:(e,t,n={},i)=>this.slider(e,t,n,i),spring:(e,t,n={},i)=>this.spring(e,t,n,i),coneTwist:(e,t,n={frameA:{},frameB:{}},i)=>this.coneTwist(e,t,n,i),dof:(e,t,n,i)=>this.dof(e,t,n,i)}}getTransform(e,t,n={x:0,y:0,z:0},i=!1){n=Object.assign({x:0,y:0,z:0},n);let r=(a,l)=>{var c=(a.x()-l.x())/2+n.x,u=(a.y()-l.y())/2+n.y,d=(a.z()-l.z())/2+n.z;return new Ammo.btVector3(c,u,d)},s=new Ammo.btTransform;if(s.setIdentity(),i){let a=r(e.getWorldTransform().getOrigin(),t.getWorldTransform().getOrigin()),l=new Ammo.btTransform;l.setIdentity(),l.setOrigin(a);let c=e.getCenterOfMassTransform().inverse().op_mul(t.getWorldTransform());return c.op_mul(l),{transformA:c,transformB:l}}else return s.setOrigin(new Ammo.btVector3(n.x,n.y,n.z)),{transformA:e.getCenterOfMassTransform().inverse().op_mul(t.getWorldTransform()).op_mul(s),transformB:s}}lock(e,t,n=!0){let i={x:0,y:0,z:0};return this.dof(e,t,{angularLowerLimit:i,angularUpperLimit:i},n)}fixed(e,t,n=!0){let i=this.getTransform(e.ammo,t.ammo);i.transformA.setRotation(e.ammo.getWorldTransform().getRotation()),i.transformB.setRotation(t.ammo.getWorldTransform().getRotation());let r=new Ammo.btFixedConstraint(e.ammo,t.ammo,i.transformA,i.transformB);return this.physicsWorld.addConstraint(r,n),r}pointToPoint(e,t,n={},i=!0){let{pivotA:r,pivotB:s}=n,a=new Ammo.btVector3((r==null?void 0:r.x)||0,(r==null?void 0:r.y)||0,(r==null?void 0:r.z)||0),l=new Ammo.btVector3((s==null?void 0:s.x)||0,(s==null?void 0:s.y)||0,(s==null?void 0:s.z)||0),c=new Ammo.btPoint2PointConstraint(e.ammo,t.ammo,a,l);return this.physicsWorld.addConstraint(c,i),c}hinge(e,t,n={},i=!0){let{pivotA:r,pivotB:s,axisA:a,axisB:l}=n,c=new Ammo.btVector3((r==null?void 0:r.x)||0,(r==null?void 0:r.y)||0,(r==null?void 0:r.z)||0),u=new Ammo.btVector3((s==null?void 0:s.x)||0,(s==null?void 0:s.y)||0,(s==null?void 0:s.z)||0),d=new Ammo.btVector3((a==null?void 0:a.x)||0,(a==null?void 0:a.y)||0,(a==null?void 0:a.z)||0),h=new Ammo.btVector3((l==null?void 0:l.x)||0,(l==null?void 0:l.y)||0,(l==null?void 0:l.z)||0),f=new Ammo.btHingeConstraint(e.ammo,t.ammo,c,u,d,h,!0);return this.physicsWorld.addConstraint(f,i),f}slider(e,t,n={},i=!0){let r=this.getTransform(e.ammo,t.ammo),{frameA:s={},frameB:a={},linearLowerLimit:l=0,linearUpperLimit:c=0,angularLowerLimit:u=0,angularUpperLimit:d=0}=n,h=r.transformA.getRotation();h.setEulerZYX(s.x||0,s.y||0,s.z||0),r.transformA.setRotation(h);let f=r.transformB.getRotation();f.setEulerZYX(a.x||0,a.y||0,a.z||0),r.transformB.setRotation(f);let p=new Ammo.btSliderConstraint(e.ammo,t.ammo,r.transformA,r.transformB,!0);return p.setLowerLinLimit(l),p.setUpperLinLimit(c),p.setLowerAngLimit(u),p.setUpperAngLimit(d),this.physicsWorld.addConstraint(p,i),p}spring(e,t,n={},i=!0){let{stiffness:r=50,damping:s=.01,angularLock:a=!1,linearLowerLimit:l={},linearUpperLimit:c={},angularLowerLimit:u={},angularUpperLimit:d={},offset:h={},center:f=!1,enableSpring:p=!0}=n,g=Object.assign({x:0,y:0,z:0},h),v=this.getTransform(e.ammo,t.ammo,g,f),y=new Ammo.btGeneric6DofSpringConstraint(e.ammo,t.ammo,v.transformA,v.transformB,!0);this.tmpBtVector3.setValue(l.x||0,l.y||0,l.z||0),y.setLinearLowerLimit(this.tmpBtVector3),this.tmpBtVector3.setValue(c.x||0,c.y||0,c.z||0),y.setLinearUpperLimit(this.tmpBtVector3),a?(this.tmpBtVector3.setValue(0,0,0),y.setAngularLowerLimit(this.tmpBtVector3),y.setAngularUpperLimit(this.tmpBtVector3)):(console.log(u,d),y.setAngularLowerLimit(this.toAmmoV3(u,-Math.PI)),y.setAngularUpperLimit(this.toAmmoV3(d,Math.PI)));for(let m=0;m<3;m++)y.enableSpring(m,p),y.setStiffness(m,r),y.setDamping(m,s);return this.physicsWorld.addConstraint(y,i),y}coneTwist(e,t,n,i=!0){let{frameA:r,frameB:s}=n,a=new Ammo.btTransform;a.setIdentity(),a.getOrigin().setValue((r==null?void 0:r.x)||0,(r==null?void 0:r.y)||0,(r==null?void 0:r.z)||0);let l=new Ammo.btTransform;l.setIdentity(),l.getOrigin().setValue((s==null?void 0:s.x)||0,(s==null?void 0:s.y)||0,(s==null?void 0:s.z)||0);let c=this.getTransform(e.ammo,t.ammo),u=new Ammo.btConeTwistConstraint(t.ammo,e.ammo,a,l);return u.setAngularOnly(!0),this.physicsWorld.addConstraint(u,i),u}dof(e,t,n={},i=!0){let{offset:r,center:s=!1}=n,a=Object.assign({x:0,y:0,z:0},r),l=this.getTransform(e.ammo,t.ammo,a,s),c=new Ammo.btGeneric6DofConstraint(e.ammo,t.ammo,l.transformA,l.transformB,!0),{linearLowerLimit:u,linearUpperLimit:d,angularLowerLimit:h,angularUpperLimit:f}=n,p=this.toAmmoV3(u),g=this.toAmmoV3(d),v=this.toAmmoV3(h,-Math.PI),y=this.toAmmoV3(f,Math.PI);return c.setLinearLowerLimit(p),c.setLinearUpperLimit(g),c.setAngularLowerLimit(v),c.setAngularUpperLimit(y),Ammo.destroy(p),Ammo.destroy(g),Ammo.destroy(v),Ammo.destroy(y),this.physicsWorld.addConstraint(c,i),c}};var mI=qo(hc());var Gh={BOX:"box",CYLINDER:"cylinder",SPHERE:"sphere",CAPSULE:"capsule",CONE:"cone",HULL:"hull",HACD:"hacd",VHACD:"vhacd",MESH:"mesh",HEIGHTFIELD:"heightfield"},Vh={ALL:"all",MANUAL:"manual"};var Q3=function(){let o=new U,e=new U,t=new Pe;return function(n,i,r,s={}){if(s.type=Gh.HULL,Z0(s),s.fit===Vh.MANUAL)return console.warn("cannot use fit: manual with type: hull"),null;let a=r1(n,i),l=new Ammo.btVector3,c=new Ammo.btConvexHullShape;c.setMargin(s.margin),e.addVectors(a.max,a.min).multiplyScalar(.5);let u=0;for(let p=0;p<n.length;p++)u+=n[p].length/3;let d=s.hullMaxVertices||1e5;u>d&&console.warn(`too many vertices for hull shape; sampling ~${d} from ~${u} vertices`);let h=Math.min(1,d/u);for(let p=0;p<n.length;p++){let g=n[p];t.fromArray(i[p]);for(let v=0;v<g.length;v+=3){let y=p===n.length-1&&v===g.length-3;(Math.random()<=h||y)&&(o.set(g[v],g[v+1],g[v+2]).applyMatrix4(t).sub(e),l.setValue(o.x,o.y,o.z),c.addPoint(l,y))}}let f=c;if(c.getNumVertices()>=100){let p=new Ammo.btShapeHull(c);p.buildHull(s.margin),Ammo.destroy(c),f=new Ammo.btConvexHullShape(Ammo.getPointer(p.getVertexPointer()),p.numVertices()),Ammo.destroy(p)}return Ammo.destroy(l),J0(f,s,K0(r,s)),f}}(),eI=function(){let o=new U,e=new U,t=new Pe;return function(n,i,r,s,a={}){if(a.type=Gh.HACD,Z0(a),a.fit===Vh.MANUAL)return console.warn("cannot use fit: manual with type: hacd"),[];if(!Ammo.hasOwnProperty("HACD"))return console.warn("HACD unavailable in included build of Ammo.js. Visit https://github.com/mozillareality/ammo.js for the latest version."),[];let l=r1(n,i),c=K0(s,a),u=0,d=0;e.addVectors(l.max,l.min).multiplyScalar(.5);for(let x=0;x<n.length;x++)u+=n[x].length/3,r&&r[x]?d+=r[x].length/3:d+=n[x].length/9;let h=new Ammo.HACD;a.hasOwnProperty("compacityWeight")&&h.SetCompacityWeight(a.compacityWeight),a.hasOwnProperty("volumeWeight")&&h.SetVolumeWeight(a.volumeWeight),a.hasOwnProperty("nClusters")&&h.SetNClusters(a.nClusters),a.hasOwnProperty("nVerticesPerCH")&&h.SetNVerticesPerCH(a.nVerticesPerCH),a.hasOwnProperty("concavity")&&h.SetConcavity(a.concavity);let f=Ammo._malloc(u*3*8),p=Ammo._malloc(d*3*4);h.SetPoints(f),h.SetTriangles(p),h.SetNPoints(u),h.SetNTriangles(d);let g=f/8,v=p/4;for(let x=0;x<n.length;x++){let _=n[x];t.fromArray(i[x]);for(let w=0;w<_.length;w+=3)o.set(_[w+0],_[w+1],_[w+2]).applyMatrix4(t).sub(e),Ammo.HEAPF64[g+0]=o.x,Ammo.HEAPF64[g+1]=o.y,Ammo.HEAPF64[g+2]=o.z,g+=3;if(r[x]){let w=r[x];for(let b=0;b<w.length;b++)Ammo.HEAP32[v]=w[b],v++}else for(let w=0;w<_.length/3;w++)Ammo.HEAP32[v]=w,v++}h.Compute(),Ammo._free(f),Ammo._free(p);let y=h.GetNClusters(),m=[];for(let x=0;x<y;x++){let _=new Ammo.btConvexHullShape;_.setMargin(a.margin);let w=h.GetNPointsCH(x),b=h.GetNTrianglesCH(x),M=Ammo._malloc(w*3*8),S=Ammo._malloc(b*3*4);h.GetCH(x,M,S);let E=M/8;for(let A=0;A<w;A++){let L=new Ammo.btVector3,B=Ammo.HEAPF64[E+A*3+0],R=Ammo.HEAPF64[E+A*3+1],D=Ammo.HEAPF64[E+A*3+2];L.setValue(B,R,D),_.addPoint(L,A===w-1),Ammo.destroy(L)}J0(_,a,c),m.push(_)}return m}}(),tI=function(){let o=new U,e=new U,t=new Pe;return function(n,i,r,s,a={}){if(a.type=Gh.VHACD,Z0(a),a.fit===Vh.MANUAL)return console.warn("cannot use fit: manual with type: vhacd"),[];if(!Ammo.hasOwnProperty("VHACD"))return console.warn("VHACD unavailable in included build of Ammo.js. Visit https://github.com/mozillareality/ammo.js for the latest version."),[];let l=r1(n,i),c=K0(s,a),u=0,d=0;e.addVectors(l.max,l.min).multiplyScalar(.5);for(let w=0;w<n.length;w++)u+=n[w].length/3,r&&r[w]?d+=r[w].length/3:d+=n[w].length/9;let h=new Ammo.VHACD,f=new Ammo.Parameters;a.hasOwnProperty("resolution")&&f.set_m_resolution(a.resolution),a.hasOwnProperty("depth")&&f.set_m_depth(a.depth),a.hasOwnProperty("concavity")&&f.set_m_concavity(a.concavity),a.hasOwnProperty("planeDownsampling")&&f.set_m_planeDownsampling(a.planeDownsampling),a.hasOwnProperty("convexhullDownsampling")&&f.set_m_convexhullDownsampling(a.convexhullDownsampling),a.hasOwnProperty("alpha")&&f.set_m_alpha(a.alpha),a.hasOwnProperty("beta")&&f.set_m_beta(a.beta),a.hasOwnProperty("gamma")&&f.set_m_gamma(a.gamma),a.hasOwnProperty("pca")&&f.set_m_pca(a.pca),a.hasOwnProperty("mode")&&f.set_m_mode(a.mode),a.hasOwnProperty("maxNumVerticesPerCH")&&f.set_m_maxNumVerticesPerCH(a.maxNumVerticesPerCH),a.hasOwnProperty("minVolumePerCH")&&f.set_m_minVolumePerCH(a.minVolumePerCH),a.hasOwnProperty("convexhullApproximation")&&f.set_m_convexhullApproximation(a.convexhullApproximation),a.hasOwnProperty("oclAcceleration")&&f.set_m_oclAcceleration(a.oclAcceleration);let p=Ammo._malloc(u*3*8+3),g=Ammo._malloc(d*3*4),v=p/8,y=g/4;for(let w=0;w<n.length;w++){let b=n[w];t.fromArray(i[w]);for(let M=0;M<b.length;M+=3)o.set(b[M+0],b[M+1],b[M+2]).applyMatrix4(t).sub(e),Ammo.HEAPF64[v+0]=o.x,Ammo.HEAPF64[v+1]=o.y,Ammo.HEAPF64[v+2]=o.z,v+=3;if(r[w]){let M=r[w];for(let S=0;S<M.length;S++)Ammo.HEAP32[y]=M[S],y++}else for(let M=0;M<b.length/3;M++)Ammo.HEAP32[y]=M,y++}h.Compute(p,3,u,g,3,d,f),Ammo._free(p),Ammo._free(g);let m=h.GetNConvexHulls(),x=[],_=new Ammo.ConvexHull;for(let w=0;w<m;w++){h.GetConvexHull(w,_);let b=_.get_m_nPoints(),M=_.get_m_points(),S=new Ammo.btConvexHullShape;S.setMargin(a.margin);for(let E=0;E<b;E++){let A=new Ammo.btVector3,L=_.get_m_points(E*3+0),B=_.get_m_points(E*3+1),R=_.get_m_points(E*3+2);A.setValue(L,B,R),S.addPoint(A,E===b-1),Ammo.destroy(A)}J0(S,a,c),x.push(S)}return Ammo.destroy(_),Ammo.destroy(h),x}}(),Y0=function(){let o=new U,e=new U,t=new U,n=new Pe;return function(i,r,s,a,l={}){if(l.type=Gh.MESH,Z0(l),l.fit===Vh.MANUAL)return console.warn("cannot use fit: manual with type: mesh"),null;let c=K0(a,l),u=new Ammo.btVector3,d=new Ammo.btVector3,h=new Ammo.btVector3,f=new Ammo.btTriangleMesh(!0,!1);for(let v=0;v<i.length;v++){let y=i[v],m=s[v]?s[v]:null;if(n.fromArray(r[v]),m)for(let x=0;x<m.length;x+=3){let _=m[x]*3,w=m[x+1]*3,b=m[x+2]*3;o.set(y[_],y[_+1],y[_+2]).applyMatrix4(n),e.set(y[w],y[w+1],y[w+2]).applyMatrix4(n),t.set(y[b],y[b+1],y[b+2]).applyMatrix4(n),u.setValue(o.x,o.y,o.z),d.setValue(e.x,e.y,e.z),h.setValue(t.x,t.y,t.z),f.addTriangle(u,d,h,!1)}else for(let x=0;x<y.length;x+=9)o.set(y[x+0],y[x+1],y[x+2]).applyMatrix4(n),e.set(y[x+3],y[x+4],y[x+5]).applyMatrix4(n),t.set(y[x+6],y[x+7],y[x+8]).applyMatrix4(n),u.setValue(o.x,o.y,o.z),d.setValue(e.x,e.y,e.z),h.setValue(t.x,t.y,t.z),f.addTriangle(u,d,h,!1)}let p=new Ammo.btVector3(c.x,c.y,c.z);f.setScaling(p),Ammo.destroy(p);let g;return l.concave?g=new Ammo.btBvhTriangleMeshShape(f,!0,!0):g=new Ammo.btConvexTriangleMeshShape(f,!0),g.resources=[f],Ammo.destroy(u),Ammo.destroy(d),Ammo.destroy(h),J0(g,l),g}}();function Z0(o){o.type=o.type||Gh.HULL,o.margin=o.hasOwnProperty("margin")?o.margin:.01}var J0=function(o,e,t){},nI=function(){let o=new Pe;return function(e,t,n){parseInt(Zs)>=123?o.copy(e.matrixWorld).invert():o.getInverse(e.matrixWorld),new U().setFromMatrixScale(e.matrixWorld),e.traverse(r=>{let s=new Pe;r.isMesh&&(t.includeInvisible||r.el&&r.el.object3D.visible||r.visible)&&(r===e?s.identity():(r.updateWorldMatrix(!0),s.multiplyMatrices(o,r.matrixWorld)),n(r.geometry.isBufferGeometry?r.geometry.attributes.position.array:r.geometry.vertices,s.elements,r.geometry.index?r.geometry.index.array:null))})}}(),K0=function(){let o=new Pe;return function(e,t={}){let n=new U(1,1,1);return t.fit===Vh.ALL&&(o.fromArray(e),n.setFromMatrixScale(o)),n}}(),Yie=function(){let o=new U;return function(e,t,n){let i=0,{x:r,y:s,z:a}=n.getCenter(o);return iI(e,t,l=>{let c=r-l.x,u=s-l.y,d=a-l.z;i=Math.max(i,c*c+u*u+d*d)}),Math.sqrt(i)}}();var r1=function(o,e){let t=new Sn,n=1/0,i=1/0,r=1/0,s=-1/0,a=-1/0,l=-1/0;return t.min.set(0,0,0),t.max.set(0,0,0),iI(o,e,c=>{c.x<n&&(n=c.x),c.y<i&&(i=c.y),c.z<r&&(r=c.z),c.x>s&&(s=c.x),c.y>a&&(a=c.y),c.z>l&&(l=c.z)}),t.min.set(n,i,r),t.max.set(s,a,l),t},iI=function(){let o=new U,e=new Pe;return function(t,n,i){for(let r=0;r<t.length;r++){e.fromArray(n[r]);for(let s=0;s<t[r].length;s+=3)o.set(t[r][s],t[r][s+1],t[r][s+2]).applyMatrix4(e),i(o)}}}();var rI=(o,e)=>{let{radius:t=1,tube:n=.4,tubularSegments:i=8}=o,r=Math.PI,s=i,a=Math.sqrt(2*n*n-2*n*n*Math.cos(2*r/s)),l=new Ammo.btVector3(n,r/s+.5*a,n),c=new Ammo.btCylinderShape(l);c.setMargin(.05);let u=new Ammo.btCompoundShape,d=new Ammo.btVector3(0,0,1),h=new Ammo.btVector3(0,t,0),f=new Ammo.btQuaternion(e.x,e.y,e.z,e.w);for(let p=0;p<s;p++){let g=p*2*r/s,v=h.rotate(d,g),y=new Ammo.btTransform;f.setRotation(d,g+Math.PI/2),y.setIdentity(),y.setOrigin(v),y.setRotation(f),u.addChildShape(y,c)}return u};var sI=qo(hc());var s1=class extends sI.Events{addCollider(e,t,n){!e.body||!t.body||(e.body.checkCollisions=!0,t.body.checkCollisions=!0,this.on("collision",i=>{var r,s;let{bodies:a,event:l}=i;((r=a[0])===null||r===void 0?void 0:r.name)&&((s=a[1])===null||s===void 0?void 0:s.name)&&(e==null?void 0:e.name)&&(t==null?void 0:t.name)&&(a[0].name===e.name&&a[1].name===t.name||a[1].name===e.name&&a[0].name===t.name)&&n(l)}))}};var oI={NoDebug:0,DrawWireframe:1,DrawAabb:2,DrawFeaturesText:4,DrawContactPoints:8,NoDeactivation:16,NoHelpText:32,DrawText:64,ProfileTimings:128,EnableSatComparison:256,DisableBulletLCP:512,EnableCCD:1024,DrawConstraints:1<<11,DrawConstraintLimits:1<<12,FastWireframe:1<<13,DrawNormals:1<<14,DrawOnTop:1<<15,MAX_DEBUG_DRAW_MODE:4294967295},aI=class{constructor(e,t,n={}){this.scene=e,this.world=t,this.options=n,this.debugDrawMode=n.debugDrawMode||oI.DrawWireframe;let i=this.debugDrawMode&oI.DrawOnTop||!1,r=n.maxBufferSize||1e6;this.geometry=new Ue;let s=new Float32Array(r*3),a=new Float32Array(r*3);this.geometry.setAttribute("position",new Ye(s,3).setUsage(eo)),this.geometry.setAttribute("color",new Ye(a,3).setUsage(eo)),this.index=0;let l=new zt({vertexColors:!0,depthTest:!i});this.mesh=new An(this.geometry,l),i&&(this.mesh.renderOrder=999),this.mesh.frustumCulled=!1,this.enabled=!1,this.debugDrawer=new Ammo.DebugDrawer,this.debugDrawer.drawLine=this.drawLine.bind(this),this.debugDrawer.drawContactPoint=this.drawContactPoint.bind(this),this.debugDrawer.reportErrorWarning=this.reportErrorWarning.bind(this),this.debugDrawer.draw3dText=this.draw3dText.bind(this),this.debugDrawer.setDebugMode=this.setDebugMode.bind(this),this.debugDrawer.getDebugMode=this.getDebugMode.bind(this),this.world.setDebugDrawer(this.debugDrawer)}enable(){this.enabled=!0,this.scene.add(this.mesh)}disable(){this.enabled=!1,this.scene.remove(this.mesh)}update(){!this.enabled||(this.index!=0&&(this.geometry.attributes.position.needsUpdate=!0,this.geometry.attributes.color.needsUpdate=!0),this.index=0,this.world.debugDrawWorld(),this.geometry.setDrawRange(0,this.index))}drawLine(e,t,n){let i=Ammo.HEAPF32,r=i[(n+0)/4],s=i[(n+4)/4],a=i[(n+8)/4],l=i[(e+0)/4],c=i[(e+4)/4],u=i[(e+8)/4];this.geometry.attributes.position.setXYZ(this.index,l,c,u),this.geometry.attributes.color.setXYZ(this.index++,r,s,a);let d=i[(t+0)/4],h=i[(t+4)/4],f=i[(t+8)/4];this.geometry.attributes.position.setXYZ(this.index,d,h,f),this.geometry.attributes.color.setXYZ(this.index++,r,s,a)}drawContactPoint(e,t,n,i,r){let s=Ammo.HEAPF32,a=s[(r+0)/4],l=s[(r+4)/4],c=s[(r+8)/4],u=s[(e+0)/4],d=s[(e+4)/4],h=s[(e+8)/4];this.geometry.attributes.position.setXYZ(this.index,u,d,h),this.geometry.attributes.color.setXYZ(this.index++,a,l,c);let f=s[(t+0)/4]*n,p=s[(t+4)/4]*n,g=s[(t+8)/4]*n;this.geometry.attributes.position.setXYZ(this.index,u+f,d+p,h+g),this.geometry.attributes.color.setXYZ(this.index++,a,l,c)}reportErrorWarning(e){Ammo.hasOwnProperty("Pointer_stringify")?console.warn(Ammo.Pointer_stringify(e)):this.warnedOnce||(this.warnedOnce=!0,console.warn("Cannot print warningString, please rebuild Ammo.js using 'debug' flag"))}draw3dText(e,t){console.warn("TODO: draw3dText")}setDebugMode(e){this.debugDrawMode=e}getDebugMode(){return this.debugDrawMode}},lI=aI;var $0=0,qX=1,jX=new U,cI=new Gl,o1=new hn,uI=new U,Q0=new Zt,ev=class{constructor(){this.tolerance=-1,this.faces=[],this.newFaces=[],this.assigned=new a1,this.unassigned=new a1,this.vertices=[]}setFromPoints(e){Array.isArray(e)!==!0&&console.error("THREE.ConvexHull: Points parameter is not an array."),e.length<4&&console.error("THREE.ConvexHull: The algorithm needs at least four points."),this.makeEmpty();for(let t=0,n=e.length;t<n;t++)this.vertices.push(new hI(e[t]));return this.compute(),this}setFromObject(e){let t=[];return e.updateMatrixWorld(!0),e.traverse(function(n){let i=n.geometry;if(i!==void 0){if(i.isGeometry){console.error("THREE.ConvexHull no longer supports Geometry. Use THREE.BufferGeometry instead.");return}else if(i.isBufferGeometry){let r=i.attributes.position;if(r!==void 0)for(let s=0,a=r.count;s<a;s++){let l=new U;l.fromBufferAttribute(r,s).applyMatrix4(n.matrixWorld),t.push(l)}}}}),this.setFromPoints(t)}containsPoint(e){let t=this.faces;for(let n=0,i=t.length;n<i;n++)if(t[n].distanceToPoint(e)>this.tolerance)return!1;return!0}intersectRay(e,t){let n=this.faces,i=-1/0,r=1/0;for(let s=0,a=n.length;s<a;s++){let l=n[s],c=l.distanceToPoint(e.origin),u=l.normal.dot(e.direction);if(c>0&&u>=0)return null;let d=u!==0?-c/u:0;if(!(d<=0)&&(u>0?r=Math.min(d,r):i=Math.max(d,i),i>r))return null}return i!==-1/0?e.at(i,t):e.at(r,t),t}intersectsRay(e){return this.intersectRay(e,jX)!==null}makeEmpty(){return this.faces=[],this.vertices=[],this}addVertexToFace(e,t){return e.face=t,t.outside===null?this.assigned.append(e):this.assigned.insertBefore(t.outside,e),t.outside=e,this}removeVertexFromFace(e,t){return e===t.outside&&(e.next!==null&&e.next.face===t?t.outside=e.next:t.outside=null),this.assigned.remove(e),this}removeAllVerticesFromFace(e){if(e.outside!==null){let t=e.outside,n=e.outside;for(;n.next!==null&&n.next.face===e;)n=n.next;return this.assigned.removeSubList(t,n),t.prev=n.next=null,e.outside=null,t}}deleteFaceVertices(e,t){let n=this.removeAllVerticesFromFace(e);if(n!==void 0)if(t===void 0)this.unassigned.appendChain(n);else{let i=n;do{let r=i.next;t.distanceToPoint(i.point)>this.tolerance?this.addVertexToFace(i,t):this.unassigned.append(i),i=r}while(i!==null)}return this}resolveUnassignedPoints(e){if(this.unassigned.isEmpty()===!1){let t=this.unassigned.first();do{let n=t.next,i=this.tolerance,r=null;for(let s=0;s<e.length;s++){let a=e[s];if(a.mark===$0){let l=a.distanceToPoint(t.point);if(l>i&&(i=l,r=a),i>1e3*this.tolerance)break}}r!==null&&this.addVertexToFace(t,r),t=n}while(t!==null)}return this}computeExtremes(){let e=new U,t=new U,n=[],i=[];for(let r=0;r<3;r++)n[r]=i[r]=this.vertices[0];e.copy(this.vertices[0].point),t.copy(this.vertices[0].point);for(let r=0,s=this.vertices.length;r<s;r++){let a=this.vertices[r],l=a.point;for(let c=0;c<3;c++)l.getComponent(c)<e.getComponent(c)&&(e.setComponent(c,l.getComponent(c)),n[c]=a);for(let c=0;c<3;c++)l.getComponent(c)>t.getComponent(c)&&(t.setComponent(c,l.getComponent(c)),i[c]=a)}return this.tolerance=3*Number.EPSILON*(Math.max(Math.abs(e.x),Math.abs(t.x))+Math.max(Math.abs(e.y),Math.abs(t.y))+Math.max(Math.abs(e.z),Math.abs(t.z))),{min:n,max:i}}computeInitialHull(){let e=this.vertices,t=this.computeExtremes(),n=t.min,i=t.max,r=0,s=0;for(let h=0;h<3;h++){let f=i[h].point.getComponent(h)-n[h].point.getComponent(h);f>r&&(r=f,s=h)}let a=n[s],l=i[s],c,u;r=0,cI.set(a.point,l.point);for(let h=0,f=this.vertices.length;h<f;h++){let p=e[h];if(p!==a&&p!==l){cI.closestPointToPoint(p.point,!0,uI);let g=uI.distanceToSquared(p.point);g>r&&(r=g,c=p)}}r=-1,o1.setFromCoplanarPoints(a.point,l.point,c.point);for(let h=0,f=this.vertices.length;h<f;h++){let p=e[h];if(p!==a&&p!==l&&p!==c){let g=Math.abs(o1.distanceToPoint(p.point));g>r&&(r=g,u=p)}}let d=[];if(o1.distanceToPoint(u.point)<0){d.push(Mr.create(a,l,c),Mr.create(u,l,a),Mr.create(u,c,l),Mr.create(u,a,c));for(let h=0;h<3;h++){let f=(h+1)%3;d[h+1].getEdge(2).setTwin(d[0].getEdge(f)),d[h+1].getEdge(1).setTwin(d[f+1].getEdge(0))}}else{d.push(Mr.create(a,c,l),Mr.create(u,a,l),Mr.create(u,l,c),Mr.create(u,c,a));for(let h=0;h<3;h++){let f=(h+1)%3;d[h+1].getEdge(2).setTwin(d[0].getEdge((3-h)%3)),d[h+1].getEdge(0).setTwin(d[f+1].getEdge(1))}}for(let h=0;h<4;h++)this.faces.push(d[h]);for(let h=0,f=e.length;h<f;h++){let p=e[h];if(p!==a&&p!==l&&p!==c&&p!==u){r=this.tolerance;let g=null;for(let v=0;v<4;v++){let y=this.faces[v].distanceToPoint(p.point);y>r&&(r=y,g=this.faces[v])}g!==null&&this.addVertexToFace(p,g)}}return this}reindexFaces(){let e=[];for(let t=0;t<this.faces.length;t++){let n=this.faces[t];n.mark===$0&&e.push(n)}return this.faces=e,this}nextVertexToAdd(){if(this.assigned.isEmpty()===!1){let e,t=0,n=this.assigned.first().face,i=n.outside;do{let r=n.distanceToPoint(i.point);r>t&&(t=r,e=i),i=i.next}while(i!==null&&i.face===n);return e}}computeHorizon(e,t,n,i){this.deleteFaceVertices(n),n.mark=qX;let r;t===null?r=t=n.getEdge(0):r=t.next;do{let s=r.twin,a=s.face;a.mark===$0&&(a.distanceToPoint(e)>this.tolerance?this.computeHorizon(e,s,a,i):i.push(r)),r=r.next}while(r!==t);return this}addAdjoiningFace(e,t){let n=Mr.create(e,t.tail(),t.head());return this.faces.push(n),n.getEdge(-1).setTwin(t.twin),n.getEdge(0)}addNewFaces(e,t){this.newFaces=[];let n=null,i=null;for(let r=0;r<t.length;r++){let s=t[r],a=this.addAdjoiningFace(e,s);n===null?n=a:a.next.setTwin(i),this.newFaces.push(a.face),i=a}return n.next.setTwin(i),this}addVertexToHull(e){let t=[];return this.unassigned.clear(),this.removeVertexFromFace(e,e.face),this.computeHorizon(e.point,null,e.face,t),this.addNewFaces(e,t),this.resolveUnassignedPoints(this.newFaces),this}cleanup(){return this.assigned.clear(),this.unassigned.clear(),this.newFaces=[],this}compute(){let e;for(this.computeInitialHull();(e=this.nextVertexToAdd())!==void 0;)this.addVertexToHull(e);return this.reindexFaces(),this.cleanup(),this}},Mr=class{constructor(){this.normal=new U,this.midpoint=new U,this.area=0,this.constant=0,this.outside=null,this.mark=$0,this.edge=null}static create(e,t,n){let i=new Mr,r=new tv(e,i),s=new tv(t,i),a=new tv(n,i);return r.next=a.prev=s,s.next=r.prev=a,a.next=s.prev=r,i.edge=r,i.compute()}getEdge(e){let t=this.edge;for(;e>0;)t=t.next,e--;for(;e<0;)t=t.prev,e++;return t}compute(){let e=this.edge.tail(),t=this.edge.head(),n=this.edge.next.head();return Q0.set(e.point,t.point,n.point),Q0.getNormal(this.normal),Q0.getMidpoint(this.midpoint),this.area=Q0.getArea(),this.constant=this.normal.dot(this.midpoint),this}distanceToPoint(e){return this.normal.dot(e)-this.constant}},tv=class{constructor(e,t){this.vertex=e,this.prev=null,this.next=null,this.twin=null,this.face=t}head(){return this.vertex}tail(){return this.prev?this.prev.vertex:null}length(){let e=this.head(),t=this.tail();return t!==null?t.point.distanceTo(e.point):-1}lengthSquared(){let e=this.head(),t=this.tail();return t!==null?t.point.distanceToSquared(e.point):-1}setTwin(e){return this.twin=e,e.twin=this,this}},hI=class{constructor(e){this.point=e,this.prev=null,this.next=null,this.face=null}},a1=class{constructor(){this.head=null,this.tail=null}first(){return this.head}last(){return this.tail}clear(){return this.head=this.tail=null,this}insertBefore(e,t){return t.prev=e.prev,t.next=e,t.prev===null?this.head=t:t.prev.next=t,e.prev=t,this}insertAfter(e,t){return t.prev=e,t.next=e.next,t.next===null?this.tail=t:t.next.prev=t,e.next=t,this}append(e){return this.head===null?this.head=e:this.tail.next=e,e.prev=this.tail,e.next=null,this.tail=e,this}appendChain(e){for(this.head===null?this.head=e:this.tail.next=e,e.prev=this.tail;e.next!==null;)e=e.next;return this.tail=e,this}remove(e){return e.prev===null?this.head=e.next:e.prev.next=e.next,e.next===null?this.tail=e.prev:e.next.prev=e.prev,this}removeSubList(e,t){return e.prev===null?this.head=t.next:e.prev.next=t.next,t.next===null?this.tail=e.prev:t.next.prev=e.prev,this}isEmpty(){return this.head===null}};var nv=class extends Ue{constructor(e){super();let t=[],n=[];ev===void 0&&console.error("THREE.ConvexBufferGeometry: ConvexBufferGeometry relies on ConvexHull");let r=new ev().setFromPoints(e).faces;for(let s=0;s<r.length;s++){let a=r[s],l=a.edge;do{let c=l.head().point;t.push(c.x,c.y,c.z),n.push(a.normal.x,a.normal.y,a.normal.z),l=l.next}while(l!==a.edge)}this.setAttribute("position",new Ne(t,3)),this.setAttribute("normal",new Ne(n,3))}};var dI=o=>{let e=window.THREE&&window.THREE.ConvexGeometry?window.THREE.ConvexGeometry:nv;return new e(o)},es=function(o,e){this.minSizeForBreak=o||1.4,this.smallDelta=e||1e-4,this.tempLine1=new Gl,this.tempPlane1=new hn,this.tempPlane2=new hn,this.tempPlane_Cut=new hn,this.tempCM1=new U,this.tempCM2=new U,this.tempVector3=new U,this.tempVector3_2=new U,this.tempVector3_3=new U,this.tempVector3_P0=new U,this.tempVector3_P1=new U,this.tempVector3_P2=new U,this.tempVector3_N0=new U,this.tempVector3_N1=new U,this.tempVector3_AB=new U,this.tempVector3_CB=new U,this.tempResultObjects={object1:null,object2:null},this.segments=[];for(var t=30*30,n=0;n<t;n++)this.segments[n]=!1};es.prototype={constructor:es,prepareBreakableObject:function(o,e,t,n,i){o.geometry.isBufferGeometry||console.error("THREE.ConvexObjectBreaker.prepareBreakableObject(): Parameter object must have a BufferGeometry."),o.userData.ammoPhysicsData={};var r=o.userData.ammoPhysicsData;r.mass=e,r.velocity=t.clone(),r.angularVelocity=n.clone(),r.breakable=i},subdivideByImpact:function(o,e,t,n,i){var r=[],s=this.tempPlane1,a=this.tempPlane2;this.tempVector3.addVectors(e,t),s.setFromCoplanarPoints(e,o.position,this.tempVector3);var l=i+n,c=this;function u(d,h,f,p){if(Math.random()<p*.05||p>l){r.push(d);return}var g=Math.PI;p===0?(a.normal.copy(s.normal),a.constant=s.constant):p<=n?(g=(f-h)*(.2+.6*Math.random())+h,c.tempVector3_2.copy(o.position).sub(e).applyAxisAngle(t,g).add(e),a.setFromCoplanarPoints(e,c.tempVector3,c.tempVector3_2)):(g=(.5*(p&1)+.2*(2-Math.random()))*Math.PI,c.tempVector3_2.copy(e).sub(d.position).applyAxisAngle(t,g).add(d.position),c.tempVector3_3.copy(t).add(d.position),a.setFromCoplanarPoints(d.position,c.tempVector3_3,c.tempVector3_2)),c.cutByPlane(d,a,c.tempResultObjects);var v=c.tempResultObjects.object1,y=c.tempResultObjects.object2;v&&u(v,h,g,p+1),y&&u(y,g,f,p+1)}return u(o,0,2*Math.PI,0),r},cutByPlane:function(o,e,t){var n=o.geometry,i=n.attributes.position.array,r=n.attributes.normal.array,s=i.length/3,a=s/3,l=n.getIndex();l&&(l=l.array,a=l.length/3);function c(X,$){var J=X*3+$;return l?l[J]:J}for(var u=[],d=[],h=this.smallDelta,f=s*s,p=0;p<f;p++)this.segments[p]=!1;for(var g=this.tempVector3_P0,v=this.tempVector3_P1,y=this.tempVector3_N0,m=this.tempVector3_N1,p=0;p<a-1;p++){var x=c(p,0),_=c(p,1),w=c(p,2);y.set(r[x],r[x]+1,r[x]+2);for(var b=p+1;b<a;b++){var M=c(b,0),S=c(b,1),E=c(b,2);m.set(r[M],r[M]+1,r[M]+2);var A=1-y.dot(m)<h;A&&(x===M||x===S||x===E?_===M||_===S||_===E?(this.segments[x*s+_]=!0,this.segments[_*s+x]=!0):(this.segments[w*s+x]=!0,this.segments[x*s+w]=!0):(_===M||_===S||_===E)&&(this.segments[w*s+_]=!0,this.segments[_*s+w]=!0))}}var L=this.tempPlane_Cut;o.updateMatrix(),es.transformPlaneToLocalSpace(e,o.matrix,L);for(var p=0;p<a;p++)for(var B=c(p,0),R=c(p,1),D=c(p,2),P=0;P<3;P++){var I=P===0?B:P===1?R:D,N=P===0?R:P===1?D:B,G=this.segments[I*s+N];if(!G){this.segments[I*s+N]=!0,this.segments[N*s+I]=!0,g.set(i[3*I],i[3*I+1],i[3*I+2]),v.set(i[3*N],i[3*N+1],i[3*N+2]);var z=0,se=L.distanceToPoint(g);se>h?(z=2,d.push(g.clone())):se<-h?(z=1,u.push(g.clone())):(z=3,u.push(g.clone()),d.push(g.clone()));var ne=0,se=L.distanceToPoint(v);if(se>h?(ne=2,d.push(v.clone())):se<-h?(ne=1,u.push(v.clone())):(ne=3,u.push(v.clone()),d.push(v.clone())),z===1&&ne===2||z===2&&ne===1){this.tempLine1.start.copy(g),this.tempLine1.end.copy(v);var Q=new U;if(Q=L.intersectLine(this.tempLine1,Q),Q===void 0)return console.error("Internal error: segment does not intersect plane."),t.segmentedObject1=null,t.segmentedObject2=null,0;u.push(Q),d.push(Q.clone())}}}var j=o.userData.ammoPhysicsData.mass*.5;this.tempCM1.set(0,0,0);var O=0,ee=u.length;if(ee>0){for(var p=0;p<ee;p++)this.tempCM1.add(u[p]);this.tempCM1.divideScalar(ee);for(var p=0;p<ee;p++){var V=u[p];V.sub(this.tempCM1),O=Math.max(O,V.x,V.y,V.z)}this.tempCM1.add(o.position)}this.tempCM2.set(0,0,0);var ie=0,ue=d.length;if(ue>0){for(var p=0;p<ue;p++)this.tempCM2.add(d[p]);this.tempCM2.divideScalar(ue);for(var p=0;p<ue;p++){var V=d[p];V.sub(this.tempCM2),ie=Math.max(ie,V.x,V.y,V.z)}this.tempCM2.add(o.position)}var ye=null,pe=null,xe=0;if(ee>4)try{ye=new et(dI(u),o.material),ye.position.copy(this.tempCM1),ye.quaternion.copy(o.quaternion),ye.userData=o.userData,this.prepareBreakableObject(ye,j,o.userData.ammoPhysicsData.velocity,o.userData.ammoPhysicsData.angularVelocity,2*O>this.minSizeForBreak),xe++}catch(X){Tn("Error in ConvexObjectBreaker.ts",!0),Tn(X,!0)}if(ue>4)try{pe=new et(dI(d),o.material),pe.position.copy(this.tempCM2),pe.quaternion.copy(o.quaternion),pe.userData=o.userData,this.prepareBreakableObject(pe,j,o.userData.ammoPhysicsData.velocity,o.userData.ammoPhysicsData.angularVelocity,2*ie>this.minSizeForBreak),xe++}catch(X){Tn("Error in ConvexObjectBreaker.ts",!0),Tn(X,!0)}return t.object1=ye,t.object2=pe,xe}};es.transformFreeVector=function(o,e){var t=o.x,n=o.y,i=o.z,r=e.elements;return o.x=r[0]*t+r[4]*n+r[8]*i,o.y=r[1]*t+r[5]*n+r[9]*i,o.z=r[2]*t+r[6]*n+r[10]*i,o};es.transformFreeVectorInverse=function(o,e){var t=o.x,n=o.y,i=o.z,r=e.elements;return o.x=r[0]*t+r[1]*n+r[2]*i,o.y=r[4]*t+r[5]*n+r[6]*i,o.z=r[8]*t+r[9]*n+r[10]*i,o};es.transformTiedVectorInverse=function(o,e){var t=o.x,n=o.y,i=o.z,r=e.elements;return o.x=r[0]*t+r[1]*n+r[2]*i-r[12],o.y=r[4]*t+r[5]*n+r[6]*i-r[13],o.z=r[8]*t+r[9]*n+r[10]*i-r[14],o};es.transformPlaneToLocalSpace=function(){var o=new U;return function(t,n,i){i.normal.copy(t.normal),i.constant=t.constant;var r=es.transformTiedVectorInverse(t.coplanarPoint(o),n);es.transformFreeVectorInverse(i.normal,n),i.constant=-r.dot(i.normal)}}();var YX=(()=>{try{if(typeof WebAssembly=="object"&&typeof WebAssembly.instantiate=="function"){let o=new WebAssembly.Module(Uint8Array.of(0,97,115,109,1,0,0,0));if(o instanceof WebAssembly.Module)return new WebAssembly.Instance(o)instanceof WebAssembly.Instance}}catch(o){console.error(o.message)}return!1})(),fI=(o,e)=>{var t=document.createElement("script");t.onload=()=>{e()},t.onerror=()=>{throw new Error(`failed to load ${o}`)},t.async=!0,t.src=o,document.head.appendChild(t)},ZX=(o,e)=>{YX?fI(`${o}/ammo.wasm.js`,()=>e()):fI(`${o}/ammo.js`,()=>e())},pI=ZX;var kp=(o,e)=>{typeof window!="undefined"&&(window.__loadPhysics=!0),pI(o,()=>{Ammo().then(()=>{e()})})};var JX=(o,e)=>{e.forEach(t=>{Object.getOwnPropertyNames(t.prototype).forEach(n=>{Object.defineProperty(o.prototype,n,Object.getOwnPropertyDescriptor(t.prototype,n))})})},c1=JX;var iv=class{constructor(e){this.physics=e}getHitPointWorld(){let e=this._btRayCallback.get_m_hitPointWorld();return{x:e.x(),y:e.y(),z:e.z()}}getHitNormalWorld(){let e=this._btRayCallback.get_m_hitNormalWorld();return{x:e.x(),y:e.y(),z:e.z()}}getCollisionObject(){return Ammo.castObject(this._btRayCallback.get_m_collisionObject(),Ammo.btRigidBody).threeObject}};var rv=class{constructor(e){this.physics=e}getHitPointsWorld(){let e=this._btRayCallback.get_m_hitPointWorld(),t=[];for(let n=e.size()-1;n>=0;n--){let i=e.at(n);t.push({x:i.x(),y:i.y(),z:i.z()})}return t}getHitPointWorld(){return Tn("Use getHitPointsWorld() instead of getHitPointWorld() for the AllHitsRayCaster!"),this.getHitPointsWorld()}getHitNormalsWorld(){let e=this._btRayCallback.get_m_hitNormalWorld(),t=[];for(let n=e.size()-1;n>=0;n--){let i=e.at(n);t.push({x:i.x(),y:i.y(),z:i.z()})}return t}getCollisionObjects(){let e=[],t=this._btRayCallback.get_m_collisionObjects();for(let n=t.size()-1;n>=0;n--){let i=Ammo.castObject(t.at(n),Ammo.btRigidBody);e.push(i.threeObject)}return e}};var u1=class{constructor(e){this.physics=e}setRayFromWorld(e=0,t=0,n=0){this._btRayFrom.setValue(e,t,n)}setRayToWorld(e=0,t=0,n=0){this._btRayTo.setValue(e,t,n)}hasHit(){return this._btRayCallback.hasHit()}rayTest(){typeof this._btRayCallback!="undefined"&&Ammo.destroy(this._btRayCallback),this._btRayCallback=this.type==="closest"?new Ammo.ClosestRayResultCallback(this._btRayFrom,this._btRayTo):new Ammo.AllHitsRayResultCallback(this._btRayFrom,this._btRayTo),this.physics.physicsWorld.rayTest(this._btRayFrom,this._btRayTo,this._btRayCallback)}destroy(){typeof this._btRayFrom!="undefined"&&Ammo.destroy(this._btRayFrom),typeof this._btRayTo!="undefined"&&Ammo.destroy(this._btRayTo),typeof this._btRayCallback!="undefined"&&Ammo.destroy(this._btRayCallback)}},sv=class{constructor(e){this.physics=e,this.type="closest",this._btRayFrom=new Ammo.btVector3(0,0,0),this._btRayTo=new Ammo.btVector3(0,0,0)}},ov=class{constructor(e){this.physics=e,this.type="allHits",this._btRayFrom=new Ammo.btVector3(0,0,0),this._btRayTo=new Ammo.btVector3(0,0,0)}};c1(sv,[u1,iv]);c1(ov,[u1,rv]);var h1=class extends mI.Events{constructor(e,t={}){super();this.scene=e,this.config=t,this.rigidBodies=[],this.earlierDetectedCollisions=[],this.complexShapes=["plane","hull","hacd","vhacd","convexMesh","concaveMesh"],this.gravity=t.gravity||{x:0,y:-9.81,z:0},this.isHeadless=e==="headless",this.tmpEuler=new ri,this.tmpQuaternion=new gt,this.tmpVector3=new U,this.tmpVector3a=new U,this.tmpMatrix4=new Pe,this.tmpMatrix4a=new Pe,this.tmpBtVector3=new Ammo.btVector3,this.tmpBtQuaternion=new Ammo.btQuaternion(0,0,0,1),this.emptyV3=new U,this.impactPoint=new U,this.impactNormal=new U,e!=="headless"&&(this.defaultMaterial=new V0),this.start()}get tmpTrans(){return console.warn("Use worldTransform instead of tmpTrans."),this.worldTransform}set tmpTrans(e){console.warn("Use worldTransform instead of tmpTrans."),this.worldTransform=e}destroy(e){var t;let n=Object.keys(e).includes("body")?e.body:e;if(typeof(n==null?void 0:n.ammo)=="undefined")return;let i=n.ammo.threeObject,r=i.name;if(r&&i&&((t=i==null?void 0:i.body)===null||t===void 0?void 0:t.ammo)){i.body.isSoftBody?this.physicsWorld.removeSoftBody(i.body.ammo):this.physicsWorld.removeRigidBody(i.body.ammo),i.body.destructor(),i.body=void 0,i.hasBody=!1,delete n.ammo.threeObject;for(let s=0;s<this.rigidBodies.length;s++)this.rigidBodies[s].name===r&&(this.rigidBodies.splice(s,1),s--)}this.scene==="headless"&&i&&(i=null)}setup(){if(this.worldTransform=new Ammo.btTransform,typeof this.config.setupPhysicsWorld=="function"?this.physicsWorld=this.config.setupPhysicsWorld():this.physicsWorld=this.setupPhysicsWorld(),this.scene!=="headless"){this.convexBreaker=new es,this.objectsToRemove=[],this.numObjectsToRemove=0;for(let e=0;e<500;e++)this.objectsToRemove[e]=null}this.collisionEvents=new s1,this.factory=new lc(this.scene),this.shapes=new $3(this.factory,(e,t)=>this.addExisting(e,t)),this.constraints=new j0(this.worldTransform,this.physicsWorld),this.scene!=="headless"&&(this.debugDrawer=new lI(this.scene,this.physicsWorld,{}))}updateDebugger(){this.scene!=="headless"&&this.debugDrawer&&this.debugDrawer.enabled&&this.debugDrawer.update()}setupPhysicsWorld(){let e=this.gravity,{softBodies:t=!1}=this.config,n;if(!t){let i=new Ammo.btDefaultCollisionConfiguration,r=new Ammo.btCollisionDispatcher(i),s=new Ammo.btDbvtBroadphase,a=new Ammo.btSequentialImpulseConstraintSolver;n=new Ammo.btDiscreteDynamicsWorld(r,s,a,i)}if(t){let i=new Ammo.btSoftBodyRigidBodyCollisionConfiguration,r=new Ammo.btCollisionDispatcher(i),s=new Ammo.btDbvtBroadphase,a=new Ammo.btSequentialImpulseConstraintSolver,l=new Ammo.btDefaultSoftBodySolver;n=new Ammo.btSoftRigidDynamicsWorld(r,s,a,i,l)}return n.setGravity(new Ammo.btVector3(e.x,e.y,e.z)),n}createDebrisFromBreakableObject(e,t){this.scene!=="headless"&&(e.material=t.material,e.shape="hull",e.fragmentDepth=t.fragmentDepth+1,e.name=`${t.name}__DEBRIS_${e.id}`,this.scene.add(e),this.addExisting(e,{autoCenter:!0}),e.body.fractureImpulse=t.body.fractureImpulse,e.body.breakable=!1,setTimeout(()=>{e.body.breakable=!0},2500))}removeDebris(e){this.scene!=="headless"&&(this.scene.remove(e),this.destroy(e))}update(e){this.updatePhysics(e),this.detectCollisions()}updatePhysics(e){let t=e/1e3;this.physicsWorld.stepSimulation(t,this.config.maxSubSteps||4,this.config.fixedTimeStep||1/60);for(let n=0;n<this.rigidBodies.length;n++){let i=this.rigidBodies[n],s=i.body.ammo.getMotionState();if(s){if(s.getWorldTransform(this.worldTransform),i.body.didUpdate&&(i.body._emitUpdateEvents&&i.body.eventEmitter.emit("update"),i.body.didUpdate=!1),i.body.ammo.isKinematicObject()&&i.body.needUpdate)i.getWorldQuaternion(this.tmpQuaternion),i.getWorldPosition(this.tmpVector3),this.tmpBtVector3.setValue(this.tmpVector3.x,this.tmpVector3.y,this.tmpVector3.z),this.tmpBtQuaternion.setValue(this.tmpQuaternion.x,this.tmpQuaternion.y,this.tmpQuaternion.z,this.tmpQuaternion.w),this.worldTransform.setOrigin(this.tmpBtVector3),this.worldTransform.setRotation(this.tmpBtQuaternion),s.setWorldTransform(this.worldTransform),i.body.needUpdate=!1;else if(!i.body.skipUpdate){if(!i.body.ammo.isStaticObject()){let a=this.worldTransform.getOrigin(),l=this.worldTransform.getRotation(),c=i.body.offset;if(i.body.ignoreScale)this.tmpVector3a.set(i.scale.x,i.scale.y,i.scale.z);else{let u=i.body.ammo.getCollisionShape().getLocalScaling();this.tmpVector3a.set(u.x(),u.y(),u.z())}this.tmpVector3.set(a.x()+c.x,a.y()+c.y,a.z()+c.z),this.tmpQuaternion.set(l.x(),l.y(),l.z(),l.w()),this.tmpMatrix4.compose(this.tmpVector3,this.tmpQuaternion,this.tmpVector3a),i.parent?parseInt(Zs)>=123?this.tmpMatrix4a.copy(i.parent.matrixWorld).invert():this.tmpMatrix4a.getInverse(i.parent.matrixWorld):this.tmpMatrix4a.identity(),this.tmpMatrix4a.multiply(this.tmpMatrix4),this.tmpMatrix4a.decompose(i.position,i.quaternion,i.scale)}}}}}detectCollisions(){var e,t;let n=[];this.impactPoint.set(0,0,0),this.impactNormal.set(0,0,0);let i=this.physicsWorld.getDispatcher(),r=i.getNumManifolds();for(let s=0;s<r;s++){let a=i.getManifoldByIndexInternal(s),l=a.getNumContacts(),c=Ammo.castObject(a.getBody0(),Ammo.btRigidBody),u=Ammo.castObject(a.getBody1(),Ammo.btRigidBody),d=c.threeObject,h=u.threeObject;if(!d||!h||c.name===""&&u.name==="")continue;let f=(e=d.body)===null||e===void 0?void 0:e.checkCollisions,p=(t=h.body)===null||t===void 0?void 0:t.checkCollisions,g=d.body.breakable,v=h.body.breakable,y=d.body.fractureImpulse,m=h.body.fractureImpulse,x=f||p,_=g||v;if(typeof d.fragmentDepth=="undefined"&&(d.fragmentDepth=0),typeof h.fragmentDepth=="undefined"&&(h.fragmentDepth=0),!x&&!_)continue;let w=!1,b=0,M="start";for(let E=0;E<l;E++){let A=a.getContactPoint(E);if(A.getDistance()<=0){w=!0;let B=A.getAppliedImpulse(),R=A.get_m_positionWorldOnB(),D=A.get_m_normalWorldOnB();if(f||p){let P=[d.name,h.name].sort(),I=`${P[0]}__${P[1]}`;this.earlierDetectedCollisions.find(N=>N.combinedName===I)&&(M="collision"),n.find(N=>N.combinedName===I)||(n.push({combinedName:I,collision:!0}),this.collisionEvents.emit("collision",{bodies:[d,h],event:M}))}B>=b&&(b=B,(g||v)&&(this.impactPoint.set(R.x(),R.y(),R.z()),this.impactNormal.set(D.x(),D.y(),D.z())));break}}if(!w||!_)continue;let S=2;if(this.emptyV3.set(0,0,0),d.userData.ammoPhysicsData={mass:1,velocity:this.emptyV3,angularVelocity:this.emptyV3,breakable:g,physicsBody:c},h.userData.ammoPhysicsData={mass:1,velocity:this.emptyV3,angularVelocity:this.emptyV3,breakable:v,physicsBody:u},g&&b>y&&d.fragmentDepth<S){let E=this.convexBreaker.subdivideByImpact(d,this.impactPoint,this.impactNormal,1,2),A=E.length;for(let L=0;L<A;L++){let B=c.getLinearVelocity(),R=c.getAngularVelocity(),D=E[L];D.userData.ammoPhysicsData.velocity.set(B.x(),B.y(),B.z()),D.userData.ammoPhysicsData.angularVelocity.set(R.x(),R.y(),R.z()),this.createDebrisFromBreakableObject(D,d)}this.objectsToRemove[this.numObjectsToRemove++]=d}if(v&&b>m&&h.fragmentDepth<S){let E=this.convexBreaker.subdivideByImpact(h,this.impactPoint,this.impactNormal,1,2),A=E.length;for(let L=0;L<A;L++){let B=u.getLinearVelocity(),R=u.getAngularVelocity(),D=E[L];D.userData.ammoPhysicsData.velocity.set(B.x(),B.y(),B.z()),D.userData.ammoPhysicsData.angularVelocity.set(R.x(),R.y(),R.z()),this.createDebrisFromBreakableObject(D,h)}this.objectsToRemove[this.numObjectsToRemove++]=h}}for(let s=0;s<this.numObjectsToRemove;s++)this.removeDebris(this.objectsToRemove[s]);this.numObjectsToRemove=0,this.earlierDetectedCollisions.forEach(s=>{let{combinedName:a}=s;if(!n.find(l=>l.combinedName===a)){let l=a.split("__"),c=this.rigidBodies.find(h=>h.name===l[0]),u=this.rigidBodies.find(h=>h.name===l[1]),d="end";c&&u&&this.collisionEvents.emit("collision",{bodies:[c,u],event:d})}}),this.earlierDetectedCollisions=[...n]}setGravity(e=0,t=-9.8,n=0){this.tmpBtVector3.setValue(e,t,n),this.physicsWorld.setGravity(this.tmpBtVector3)}get debug(){return this.isHeadless?null:{enable:()=>{this.debugDrawer.enable()},mode:(e=1)=>{this.debugDrawer.setDebugMode(e)},disable:()=>{this.debugDrawer.disable()}}}start(){if(typeof Ammo=="undefined"){Tn("Are you sure you included ammo.js?");return}typeof Ammo=="function"?Ammo().then(()=>{this.setup()}):this.setup()}get add(){return{collider:(e,t,n)=>this.collisionEvents.addCollider(e,t,n),constraints:this.constraints.addConstraints,existing:(e,t)=>this.addExisting(e,t),plane:(e={},t={})=>this.shapes.addPlane(e,t),sphere:(e={},t={})=>this.shapes.addSphere(e,t),ground:(e={},t={})=>this.shapes.addGround(e,t),box:(e={},t={})=>this.shapes.addBox(e,t),cylinder:(e={},t={})=>this.shapes.addCylinder(e,t),cone:(e={},t={})=>this.shapes.addCone(e,t),torus:(e={},t={})=>this.shapes.addTorus(e,t),extrude:(e,t={})=>this.shapes.addExtrude(e,t),raycaster:(e="closest")=>e==="closest"?new sv(this):new ov(this)}}prepareThreeObjectForCollisionShape(e,t={}){var n,i;let{autoCenter:r=!1}=t,s={width:1,height:1,depth:1,radius:1,radiusTop:1,radiusBottom:1,tube:.4,tubularSegments:6},a="unknown",l=((n=e.geometry)===null||n===void 0?void 0:n.type)||"unknown";/box/i.test(l)?a="box":/cone/i.test(l)?a="cone":/cylinder/i.test(l)?a="cylinder":/extrude/i.test(l)?a="extrude":/plane/i.test(l)?a="plane":/sphere/i.test(l)?a="sphere":/torus/i.test(l)&&(a="torus");let c=Object.assign(Object.assign({},s),(i=e==null?void 0:e.geometry)===null||i===void 0?void 0:i.parameters);return t.shape?(c=Object.assign(Object.assign({},s),t),a=t.shape):e.shape&&(a=e.shape),Object.keys(c).forEach(u=>{typeof c[u]=="undefined"&&s[u]&&(c[u]=s[u])}),r&&e.geometry.center(),a==="cylinder"&&(c.radius=t.radius||c.radiusTop),a==="extrude"&&(a="hacd"),(a==="mesh"||a==="convex")&&(a="convexMesh"),a==="concave"&&(a="concaveMesh"),a==="unknown"&&(Tn(`Shape for ${e==null?void 0:e.name} not recognized! Will fallback to box.`),a="box"),{shape:a,params:c,object:e}}createCollisionShape(e,t,n){let i=(n==null?void 0:n.quaternion)?n==null?void 0:n.quaternion:new gt(0,0,0,1),{axis:r="y"}=t,s=new Ammo.btVector3,a=n==null?void 0:n.geometry;n&&(a==null?void 0:a.isGeometry)&&(n.geometry=new Ue().fromGeometry(a));let l=p=>{let g=new Pe().elements,v=[],y=[],m=[];return nI(p,{},(x,_,w)=>{v.push(x),y.push(_),m.push(w)}),{vertices:v,matrices:y,indexes:m,matrixWorld:g}},c={};this.complexShapes.indexOf(e)!==-1&&(c=l(n));let u;switch(e){case"box":s.setValue(t.width/2,t.height/2,t.depth/2),u=new Ammo.btBoxShape(s);break;case"sphere":u=new Ammo.btSphereShape(t.radius);break;case"cylinder":switch(r){case"y":s.setValue(t.radius,t.height/2,t.radius),u=new Ammo.btCylinderShape(s);break;case"x":s.setValue(t.height/2,t.radius,t.radius),u=new Ammo.btCylinderShapeX(s);break;case"z":s.setValue(t.radius,t.radius,t.height/2),u=new Ammo.btCylinderShapeZ(s);break}break;case"cone":switch(r){case"y":u=new Ammo.btConeShape(t.radius,t.height);break;case"x":u=new Ammo.btConeShapeX(t.radius,t.height);break;case"z":u=new Ammo.btConeShapeZ(t.radius,t.height);break}break;case"capsule":switch(r){case"y":u=new Ammo.btCapsuleShape(t.radius,t.height);break;case"x":u=new Ammo.btCapsuleShapeX(t.radius,t.height);break;case"z":u=new Ammo.btCapsuleShapeZ(t.radius,t.height);break}break;case"torus":u=rI(t,i);break;case"plane":u=Y0(c.vertices,c.matrices,c.indexes,c.matrixWorld,Object.assign(Object.assign({},t),{concave:!1}));break;case"hull":u=Q3(c.vertices,c.matrices,c.matrixWorld,t);break;case"hacd":u=eI(c.vertices,c.matrices,c.indexes,c.matrixWorld,t);break;case"vhacd":u=tI(c.vertices,c.matrices,c.indexes,c.matrixWorld,t);break;case"convexMesh":u=Y0(c.vertices,c.matrices,c.indexes,c.matrixWorld,Object.assign(Object.assign({},t),{concave:!1}));break;case"concaveMesh":u=Y0(c.vertices,c.matrices,c.indexes,c.matrixWorld,Object.assign(Object.assign({},t),{concave:!0}));break}Ammo.destroy(s);let{x:d,y:h,z:f}=t;return(d||h||f)&&(u.offset={x:d||0,y:h||0,z:f||0}),Array.isArray(u)&&(u=this.mergeCollisionShapesToCompoundShape(u)),u}mergeCollisionShapesToCompoundShape(e){let t=new Ammo.btCompoundShape;return e.forEach(n=>{let i=n._tmp;if(i){let{pos:r,quat:s,scale:a,margin:l}=i,c=this.applyPosQuatScaleMargin(n,r,s,a,l);t.addChildShape(c,n)}else{let r=new Ammo.btTransform;r.setIdentity(),t.addChildShape(r,n)}}),t}addExisting(e,t={}){let{hasBody:n}=e;if(n){Tn(`Object "${e.name}" already has a physical body!`);return}let i=new U,r=new gt,s=new U;e.getWorldPosition(i),e.getWorldQuaternion(r),e.getWorldScale(s);let a=(t.collisionFlags||0).toString(2).slice(-1)==="1",l=(t.collisionFlags||0).toString(2).slice(-2,-1)==="1",{shape:c="unknown",compound:u=[],mass:d=a||l?0:1,collisionFlags:h=0,collisionGroup:f=1,collisionMask:p=-1,offset:g=void 0,breakable:v=!1,addChildren:y=!0,margin:m=.01,ignoreScale:x=!1,fractureImpulse:_=1}=t;if(x&&s.set(1,1,1),u.length>=1){let E=u.map(R=>this.createCollisionShape(R.shape,R)),A=this.mergeCollisionShapesToCompoundShape(E),L=this.applyPosQuatScaleMargin(A,i,r,s,m),B=this.collisionShapeToRigidBody(A,L,d,l);this.addRigidBodyToWorld(e,B,h,f,p,g),e.body.breakable=v,e.body.fractureImpulse=_,e.body.ignoreScale=x;return}let w=[];if(c!=="unknown"||e.isMesh){let E=this.prepareThreeObjectForCollisionShape(e,t),A=this.createCollisionShape(E.shape,E.params,E.object);w.push(A)}if(c==="unknown"&&y&&e.children.length>=1&&e.children.forEach(E=>{if(E.isMesh){let A=this.prepareThreeObjectForCollisionShape(E),L=this.createCollisionShape(A.shape,A.params,A.object);L._tmp={pos:E.position.clone(),quat:E.quaternion.clone(),scale:E.scale.clone(),margin:m},w.push(L)}}),w.length===0){let E=this.prepareThreeObjectForCollisionShape(e,t),A=this.createCollisionShape(E.shape,E.params,E.object);w.push(A)}let b=w.length===1?w[0]:this.mergeCollisionShapesToCompoundShape(w),M=this.applyPosQuatScaleMargin(b,i,r,s,m),S=this.collisionShapeToRigidBody(b,M,d,l);this.addRigidBodyToWorld(e,S,h,f,p,g),e.body.breakable=v,e.body.fractureImpulse=_,e.body.ignoreScale=x}addRigidBodyToWorld(e,t,n,i,r,s){this.rigidBodies.push(e),this.physicsWorld.addRigidBody(t,i,r);let a=Object.values(t)[0];e.name||(e.name=`object-${e.id}`),t.name=e.name,e.body=new J3(this,t),e.hasBody=!0,e.ptr=a,t.threeObject=e,s&&(e.body.offset=Object.assign({x:0,y:0,z:0},s)),e.body.setCollisionFlags(n)}applyPosQuatScaleMargin(e,t=new U,n=new gt,i=new U,r=.01){e.setMargin(r);let s=new Ammo.btQuaternion(0,0,0,1);s.setValue(n.x,n.y,n.z,n.w);let a=new Ammo.btTransform;a.setIdentity(),a.getOrigin().setValue(t.x,t.y,t.z),a.setRotation(s),Ammo.destroy(s);let l=new Ammo.btVector3(i.x,i.y,i.z);return e.setLocalScaling(l),Ammo.destroy(l),a}collisionShapeToRigidBody(e,t,n,i){let r=new Ammo.btDefaultMotionState(t),s=new Ammo.btVector3(0,0,0);n>0&&e.calculateLocalInertia(n,s);let a=new Ammo.btRigidBodyConstructionInfo(n,r,e,s),l=new Ammo.btRigidBody(a);return(n>0||i)&&l.setActivationState(4),l}};var av=class{constructor(e={}){this.threeGraphicsConfig=e;let{alpha:t=!1,anisotropy:n=1,camera:i=Ds.Perspective({z:25,y:5}),antialias:r=!1,usePhysics:s=!0,renderer:a}=e;this.textureAnisotropy=n,this.camera=i,this.scene=new Dl,this.renderer=a||new Rt({antialias:r,alpha:t}),this.renderer.shadowMap.enabled=!0,this.renderer.shadowMap.type=Xm,this.cache=uo,this.cache.enabled=!0,s&&(typeof Ammo!="undefined"?this.physics=new h1(this.scene,e):Tn("Are you sure you included ammo.js?"))}};var gI="0.23.0";var QX=`Powered by enable3d v${gI}`;console.log(`%c %c %c %c %c ${QX} %c https://enable3d.io/`,"background: #ff0000","background: #ffff00","background: #00ff00","background: #00ffff","color: #fff; background: #000000;","background: none");var lv=class extends av{constructor(e){var t;super(e);this.projectConfig=e,this.scenes=new Map,this.renderer.setSize(window.innerWidth,window.innerHeight),this.projectConfig.parent?this.parent=document.getElementById(this.projectConfig.parent):this.parent=document.body,this.parent||(Tn(`Parent "${this.projectConfig.parent}" not found! Will add it to the body.`),this.parent=document.body),this.parent.appendChild(this.renderer.domElement),this.canvas=this.renderer.domElement;let n="";this.projectConfig.scenes.forEach((i,r)=>{let s=new i;r===0&&(n=s.sceneKey);let a={sceneConfig:{textureAnisotropy:this.textureAnisotropy,autoStart:!1},renderer:this.renderer,parent:this.parent,canvas:this.canvas,scene:this.scene,scenes:this.scenes,camera:this.camera,cache:this.cache,physics:this.physics};s.initializeScene(a),r===0&&(s.setSize(this.parent.clientWidth,this.parent.clientHeight),s.setPixelRatio(Math.max(1,window.devicePixelRatio/2))),this.scenes.set(s.sceneKey,s)}),(t=this.scenes.get(n))===null||t===void 0||t.start(n)}};var tq=qo(hc());var eq=[{name:"pointer",enabled:!0,test:"onpointerdown"in window,events:{down:"pointerdown",move:"pointermove",up:"pointerup"}},{name:"touch",enabled:!0,test:"ontouchstart"in window&&window.navigator.maxTouchPoints>=1,events:{down:"touchstart",move:"touchmove",up:"touchend"}},{name:"mouse",enabled:!0,test:"onmousedown"in window,events:{down:"mousedown",move:"mousemove",up:"mouseup"}}];var mse=new Map;var yI=document.createElement("canvas");var gse=new Nu,yse=new _e,vse=new _e,xse=new _e;var nq=qo(hc());var Co=qo(xI());var oq=qo(hc());var voe=new ci(-1,1,1,-1,0,1),_I=new Ue;_I.setAttribute("position",new Ne([-1,3,0,-1,-1,0,3,-1,0],3));_I.setAttribute("uv",new Ne([0,2,0,0,2,0],2));var Ioe=new ci(-1,1,1,-1,0,1),wI=new Ue;wI.setAttribute("position",new Ne([-1,3,0,-1,-1,0,3,-1,0],3));wI.setAttribute("uv",new Ne([0,2,0,0,2,0],2));var cq={uniforms:{tDiffuse:{value:null},tSize:{value:new _e(256,256)},center:{value:new _e(.5,.5)},angle:{value:1.57},scale:{value:1}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform vec2 center;
		uniform float angle;
		uniform float scale;
		uniform vec2 tSize;

		uniform sampler2D tDiffuse;

		varying vec2 vUv;

		float pattern() {

			float s = sin( angle ), c = cos( angle );

			vec2 tex = vUv * tSize - center;
			vec2 point = vec2( c * tex.x - s * tex.y, s * tex.x + c * tex.y ) * scale;

			return ( sin( point.x ) * sin( point.y ) ) * 4.0;

		}

		void main() {

			vec4 color = texture2D( tDiffuse, vUv );

			float average = ( color.r + color.g + color.b ) / 3.0;

			gl_FragColor = vec4( vec3( average * 10.0 - 5.0 + pattern() ), color.a );

		}`};window.global=window;window.THREE=Cn;window.alert=()=>{};var bI="128";var uq=0,MI=1,hq=2;var SI=1,dq=2,Up=3,Wh=0,zn=1,Xh=2,TI=1;var Hp=0,Gp=1,EI=2,AI=3,CI=4,fq=5,qh=100,pq=101,mq=102,LI=103,RI=104,gq=200,yq=201,vq=202,xq=203,PI=204,II=205,_q=206,wq=207,bq=208,Mq=209,Sq=210,Tq=0,Eq=1,Aq=2,p1=3,Cq=4,Lq=5,Rq=6,Pq=7,cv=0,Iq=1,Dq=2,Vp=0,Fq=1,Bq=2,Nq=3,Oq=4,kq=5,DI=300,m1=301,g1=302,FI=303,BI=304,y1=306,v1=307,dc=1e3,tr=1001,Wp=1002,Qn=1003,uv=1004;var hv=1005;var Ai=1006,x1=1007;var jh=1008;var _1=1009,zq=1010,Uq=1011,dv=1012,Hq=1013,fv=1014,Ha=1015,pv=1016,Gq=1017,Vq=1018,Wq=1019,Xp=1020,Xq=1021,Lo=1022,ts=1023,qq=1024,jq=1025;var Yh=1026,qp=1027,Yq=1028,Zq=1029,Jq=1030,Kq=1031,$q=1032,Qq=1033,NI=33776,OI=33777,kI=33778,zI=33779,UI=35840,HI=35841,GI=35842,VI=35843,ej=36196,WI=37492,XI=37496,tj=37808,nj=37809,ij=37810,rj=37811,sj=37812,oj=37813,aj=37814,lj=37815,cj=37816,uj=37817,hj=37818,dj=37819,fj=37820,pj=37821,mj=36492,gj=37840,yj=37841,vj=37842,xj=37843,_j=37844,wj=37845,bj=37846,Mj=37847,Sj=37848,Tj=37849,Ej=37850,Aj=37851,Cj=37852,Lj=37853,Rj=2200,Pj=2201,Ij=2202,Zh=2300,fc=2301,w1=2302,Jh=2400,Kh=2401,mv=2402,b1=2500,qI=2501,M1=0,gv=1,$h=2,Qh=3e3,ed=3001,jI=3007,YI=3002,Dj=3003,ZI=3004,JI=3005,KI=3006,Fj=3200,Bj=3201,Ga=0,Nj=1;var S1=7680;var Oj=519,jp=35044,yv=35048;var $I="300 es",Va=class{addEventListener(e,t){this._listeners===void 0&&(this._listeners={});let n=this._listeners;n[e]===void 0&&(n[e]=[]),n[e].indexOf(t)===-1&&n[e].push(t)}hasEventListener(e,t){if(this._listeners===void 0)return!1;let n=this._listeners;return n[e]!==void 0&&n[e].indexOf(t)!==-1}removeEventListener(e,t){if(this._listeners===void 0)return;let i=this._listeners[e];if(i!==void 0){let r=i.indexOf(t);r!==-1&&i.splice(r,1)}}dispatchEvent(e){if(this._listeners===void 0)return;let n=this._listeners[e.type];if(n!==void 0){e.target=this;let i=n.slice(0);for(let r=0,s=i.length;r<s;r++)i[r].call(this,e);e.target=null}}},ei=[];for(let o=0;o<256;o++)ei[o]=(o<16?"0":"")+o.toString(16);var vv=1234567,Yp=Math.PI/180,Zp=180/Math.PI;function nr(){let o=Math.random()*4294967295|0,e=Math.random()*4294967295|0,t=Math.random()*4294967295|0,n=Math.random()*4294967295|0;return(ei[o&255]+ei[o>>8&255]+ei[o>>16&255]+ei[o>>24&255]+"-"+ei[e&255]+ei[e>>8&255]+"-"+ei[e>>16&15|64]+ei[e>>24&255]+"-"+ei[t&63|128]+ei[t>>8&255]+"-"+ei[t>>16&255]+ei[t>>24&255]+ei[n&255]+ei[n>>8&255]+ei[n>>16&255]+ei[n>>24&255]).toUpperCase()}function Ci(o,e,t){return Math.max(e,Math.min(t,o))}function T1(o,e){return(o%e+e)%e}function kj(o,e,t,n,i){return n+(o-e)*(i-n)/(t-e)}function zj(o,e,t){return o!==e?(t-o)/(e-o):0}function Jp(o,e,t){return(1-t)*o+t*e}function Uj(o,e,t,n){return Jp(o,e,1-Math.exp(-t*n))}function Hj(o,e=1){return e-Math.abs(T1(o,e*2)-e)}function Gj(o,e,t){return o<=e?0:o>=t?1:(o=(o-e)/(t-e),o*o*(3-2*o))}function Vj(o,e,t){return o<=e?0:o>=t?1:(o=(o-e)/(t-e),o*o*o*(o*(o*6-15)+10))}function Wj(o,e){return o+Math.floor(Math.random()*(e-o+1))}function Xj(o,e){return o+Math.random()*(e-o)}function qj(o){return o*(.5-Math.random())}function jj(o){return o!==void 0&&(vv=o%2147483647),vv=vv*16807%2147483647,(vv-1)/2147483646}function Yj(o){return o*Yp}function Zj(o){return o*Zp}function E1(o){return(o&o-1)==0&&o!==0}function QI(o){return Math.pow(2,Math.ceil(Math.log(o)/Math.LN2))}function eD(o){return Math.pow(2,Math.floor(Math.log(o)/Math.LN2))}function Jj(o,e,t,n,i){let r=Math.cos,s=Math.sin,a=r(t/2),l=s(t/2),c=r((e+n)/2),u=s((e+n)/2),d=r((e-n)/2),h=s((e-n)/2),f=r((n-e)/2),p=s((n-e)/2);switch(i){case"XYX":o.set(a*u,l*d,l*h,a*c);break;case"YZY":o.set(l*h,a*u,l*d,a*c);break;case"ZXZ":o.set(l*d,l*h,a*u,a*c);break;case"XZX":o.set(a*u,l*p,l*f,a*c);break;case"YXY":o.set(l*f,a*u,l*p,a*c);break;case"ZYZ":o.set(l*p,l*f,a*u,a*c);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+i)}}var tD=Object.freeze({__proto__:null,DEG2RAD:Yp,RAD2DEG:Zp,generateUUID:nr,clamp:Ci,euclideanModulo:T1,mapLinear:kj,inverseLerp:zj,lerp:Jp,damp:Uj,pingpong:Hj,smoothstep:Gj,smootherstep:Vj,randInt:Wj,randFloat:Xj,randFloatSpread:qj,seededRandom:jj,degToRad:Yj,radToDeg:Zj,isPowerOfTwo:E1,ceilPowerOfTwo:QI,floorPowerOfTwo:eD,setQuaternionFromProperEuler:Jj}),Oe=class{constructor(e=0,t=0){this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e,t){return t!==void 0?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this)}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e,t){return t!==void 0?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this)}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){let t=this.x,n=this.y,i=e.elements;return this.x=i[0]*t+i[3]*n+i[6],this.y=i[1]*t+i[4]*n+i[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}clampLength(e,t){let n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){let t=this.x-e.x,n=this.y-e.y;return t*t+n*n}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t,n){return n!==void 0&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){let n=Math.cos(t),i=Math.sin(t),r=this.x-e.x,s=this.y-e.y;return this.x=r*n-s*i+e.x,this.y=r*i+s*n+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}};Oe.prototype.isVector2=!0;var Un=class{constructor(){this.elements=[1,0,0,0,1,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}set(e,t,n,i,r,s,a,l,c){let u=this.elements;return u[0]=e,u[1]=i,u[2]=a,u[3]=t,u[4]=r,u[5]=l,u[6]=n,u[7]=s,u[8]=c,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){let t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],this}extractBasis(e,t,n){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this}setFromMatrix4(e){let t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){let n=e.elements,i=t.elements,r=this.elements,s=n[0],a=n[3],l=n[6],c=n[1],u=n[4],d=n[7],h=n[2],f=n[5],p=n[8],g=i[0],v=i[3],y=i[6],m=i[1],x=i[4],_=i[7],w=i[2],b=i[5],M=i[8];return r[0]=s*g+a*m+l*w,r[3]=s*v+a*x+l*b,r[6]=s*y+a*_+l*M,r[1]=c*g+u*m+d*w,r[4]=c*v+u*x+d*b,r[7]=c*y+u*_+d*M,r[2]=h*g+f*m+p*w,r[5]=h*v+f*x+p*b,r[8]=h*y+f*_+p*M,this}multiplyScalar(e){let t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){let e=this.elements,t=e[0],n=e[1],i=e[2],r=e[3],s=e[4],a=e[5],l=e[6],c=e[7],u=e[8];return t*s*u-t*a*c-n*r*u+n*a*l+i*r*c-i*s*l}invert(){let e=this.elements,t=e[0],n=e[1],i=e[2],r=e[3],s=e[4],a=e[5],l=e[6],c=e[7],u=e[8],d=u*s-a*c,h=a*l-u*r,f=c*r-s*l,p=t*d+n*h+i*f;if(p===0)return this.set(0,0,0,0,0,0,0,0,0);let g=1/p;return e[0]=d*g,e[1]=(i*c-u*n)*g,e[2]=(a*n-i*s)*g,e[3]=h*g,e[4]=(u*t-i*l)*g,e[5]=(i*r-a*t)*g,e[6]=f*g,e[7]=(n*l-c*t)*g,e[8]=(s*t-n*r)*g,this}transpose(){let e,t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){let t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,n,i,r,s,a){let l=Math.cos(r),c=Math.sin(r);return this.set(n*l,n*c,-n*(l*s+c*a)+s+e,-i*c,i*l,-i*(-c*s+l*a)+a+t,0,0,1),this}scale(e,t){let n=this.elements;return n[0]*=e,n[3]*=e,n[6]*=e,n[1]*=t,n[4]*=t,n[7]*=t,this}rotate(e){let t=Math.cos(e),n=Math.sin(e),i=this.elements,r=i[0],s=i[3],a=i[6],l=i[1],c=i[4],u=i[7];return i[0]=t*r+n*l,i[3]=t*s+n*c,i[6]=t*a+n*u,i[1]=-n*r+t*l,i[4]=-n*s+t*c,i[7]=-n*a+t*u,this}translate(e,t){let n=this.elements;return n[0]+=e*n[2],n[3]+=e*n[5],n[6]+=e*n[8],n[1]+=t*n[2],n[4]+=t*n[5],n[7]+=t*n[8],this}equals(e){let t=this.elements,n=e.elements;for(let i=0;i<9;i++)if(t[i]!==n[i])return!1;return!0}fromArray(e,t=0){for(let n=0;n<9;n++)this.elements[n]=e[n+t];return this}toArray(e=[],t=0){let n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e}clone(){return new this.constructor().fromArray(this.elements)}};Un.prototype.isMatrix3=!0;var td,pc=class{static getDataURL(e){if(/^data:/i.test(e.src)||typeof HTMLCanvasElement=="undefined")return e.src;let t;if(e instanceof HTMLCanvasElement)t=e;else{td===void 0&&(td=document.createElementNS("http://www.w3.org/1999/xhtml","canvas")),td.width=e.width,td.height=e.height;let n=td.getContext("2d");e instanceof ImageData?n.putImageData(e,0,0):n.drawImage(e,0,0,e.width,e.height),t=td}return t.width>2048||t.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),t.toDataURL("image/jpeg",.6)):t.toDataURL("image/png")}},Kj=0,Hn=class extends Va{constructor(e=Hn.DEFAULT_IMAGE,t=Hn.DEFAULT_MAPPING,n=tr,i=tr,r=Ai,s=jh,a=ts,l=_1,c=1,u=Qh){super();Object.defineProperty(this,"id",{value:Kj++}),this.uuid=nr(),this.name="",this.image=e,this.mipmaps=[],this.mapping=t,this.wrapS=n,this.wrapT=i,this.magFilter=r,this.minFilter=s,this.anisotropy=c,this.format=a,this.internalFormat=null,this.type=l,this.offset=new Oe(0,0),this.repeat=new Oe(1,1),this.center=new Oe(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Un,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=u,this.version=0,this.onUpdate=null}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(e){return this.name=e.name,this.image=e.image,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.encoding=e.encoding,this}toJSON(e){let t=e===void 0||typeof e=="string";if(!t&&e.textures[this.uuid]!==void 0)return e.textures[this.uuid];let n={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};if(this.image!==void 0){let i=this.image;if(i.uuid===void 0&&(i.uuid=nr()),!t&&e.images[i.uuid]===void 0){let r;if(Array.isArray(i)){r=[];for(let s=0,a=i.length;s<a;s++)i[s].isDataTexture?r.push(A1(i[s].image)):r.push(A1(i[s]))}else r=A1(i);e.images[i.uuid]={uuid:i.uuid,url:r}}n.image=i.uuid}return t||(e.textures[this.uuid]=n),n}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==DI)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case dc:e.x=e.x-Math.floor(e.x);break;case tr:e.x=e.x<0?0:1;break;case Wp:Math.abs(Math.floor(e.x)%2)===1?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x);break}if(e.y<0||e.y>1)switch(this.wrapT){case dc:e.y=e.y-Math.floor(e.y);break;case tr:e.y=e.y<0?0:1;break;case Wp:Math.abs(Math.floor(e.y)%2)===1?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y);break}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){e===!0&&this.version++}};Hn.DEFAULT_IMAGE=void 0;Hn.DEFAULT_MAPPING=DI;Hn.prototype.isTexture=!0;function A1(o){return typeof HTMLImageElement!="undefined"&&o instanceof HTMLImageElement||typeof HTMLCanvasElement!="undefined"&&o instanceof HTMLCanvasElement||typeof ImageBitmap!="undefined"&&o instanceof ImageBitmap?pc.getDataURL(o):o.data?{data:Array.prototype.slice.call(o.data),width:o.width,height:o.height,type:o.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}var Dt=class{constructor(e=0,t=0,n=0,i=1){this.x=e,this.y=t,this.z=n,this.w=i}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,n,i){return this.x=e,this.y=t,this.z=n,this.w=i,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w!==void 0?e.w:1,this}add(e,t){return t!==void 0?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this)}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e,t){return t!==void 0?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this)}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){let t=this.x,n=this.y,i=this.z,r=this.w,s=e.elements;return this.x=s[0]*t+s[4]*n+s[8]*i+s[12]*r,this.y=s[1]*t+s[5]*n+s[9]*i+s[13]*r,this.z=s[2]*t+s[6]*n+s[10]*i+s[14]*r,this.w=s[3]*t+s[7]*n+s[11]*i+s[15]*r,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);let t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,n,i,r,s=.01,a=.1,l=e.elements,c=l[0],u=l[4],d=l[8],h=l[1],f=l[5],p=l[9],g=l[2],v=l[6],y=l[10];if(Math.abs(u-h)<s&&Math.abs(d-g)<s&&Math.abs(p-v)<s){if(Math.abs(u+h)<a&&Math.abs(d+g)<a&&Math.abs(p+v)<a&&Math.abs(c+f+y-3)<a)return this.set(1,0,0,0),this;t=Math.PI;let x=(c+1)/2,_=(f+1)/2,w=(y+1)/2,b=(u+h)/4,M=(d+g)/4,S=(p+v)/4;return x>_&&x>w?x<s?(n=0,i=.707106781,r=.707106781):(n=Math.sqrt(x),i=b/n,r=M/n):_>w?_<s?(n=.707106781,i=0,r=.707106781):(i=Math.sqrt(_),n=b/i,r=S/i):w<s?(n=.707106781,i=.707106781,r=0):(r=Math.sqrt(w),n=M/r,i=S/r),this.set(n,i,r,t),this}let m=Math.sqrt((v-p)*(v-p)+(d-g)*(d-g)+(h-u)*(h-u));return Math.abs(m)<.001&&(m=1),this.x=(v-p)/m,this.y=(d-g)/m,this.z=(h-u)/m,this.w=Math.acos((c+f+y-1)/2),this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this}clampLength(e,t){let n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this.w=e.w+(t.w-e.w)*n,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t,n){return n!==void 0&&console.warn("THREE.Vector4: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}};Dt.prototype.isVector4=!0;var Wa=class extends Va{constructor(e,t,n){super();this.width=e,this.height=t,this.depth=1,this.scissor=new Dt(0,0,e,t),this.scissorTest=!1,this.viewport=new Dt(0,0,e,t),n=n||{},this.texture=new Hn(void 0,n.mapping,n.wrapS,n.wrapT,n.magFilter,n.minFilter,n.format,n.type,n.anisotropy,n.encoding),this.texture.image={},this.texture.image.width=e,this.texture.image.height=t,this.texture.image.depth=1,this.texture.generateMipmaps=n.generateMipmaps!==void 0?n.generateMipmaps:!1,this.texture.minFilter=n.minFilter!==void 0?n.minFilter:Ai,this.depthBuffer=n.depthBuffer!==void 0?n.depthBuffer:!0,this.stencilBuffer=n.stencilBuffer!==void 0?n.stencilBuffer:!1,this.depthTexture=n.depthTexture!==void 0?n.depthTexture:null}setTexture(e){e.image={width:this.width,height:this.height,depth:this.depth},this.texture=e}setSize(e,t,n=1){(this.width!==e||this.height!==t||this.depth!==n)&&(this.width=e,this.height=t,this.depth=n,this.texture.image.width=e,this.texture.image.height=t,this.texture.image.depth=n,this.dispose()),this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return new this.constructor().copy(this)}copy(e){return this.width=e.width,this.height=e.height,this.depth=e.depth,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.depthTexture=e.depthTexture,this}dispose(){this.dispatchEvent({type:"dispose"})}};Wa.prototype.isWebGLRenderTarget=!0;var nD=class extends Wa{constructor(e,t,n){super(e,t,n);this.samples=4}copy(e){return super.copy.call(this,e),this.samples=e.samples,this}};nD.prototype.isWebGLMultisampleRenderTarget=!0;var pi=class{constructor(e=0,t=0,n=0,i=1){this._x=e,this._y=t,this._z=n,this._w=i}static slerp(e,t,n,i){return console.warn("THREE.Quaternion: Static .slerp() has been deprecated. Use qm.slerpQuaternions( qa, qb, t ) instead."),n.slerpQuaternions(e,t,i)}static slerpFlat(e,t,n,i,r,s,a){let l=n[i+0],c=n[i+1],u=n[i+2],d=n[i+3],h=r[s+0],f=r[s+1],p=r[s+2],g=r[s+3];if(a===0){e[t+0]=l,e[t+1]=c,e[t+2]=u,e[t+3]=d;return}if(a===1){e[t+0]=h,e[t+1]=f,e[t+2]=p,e[t+3]=g;return}if(d!==g||l!==h||c!==f||u!==p){let v=1-a,y=l*h+c*f+u*p+d*g,m=y>=0?1:-1,x=1-y*y;if(x>Number.EPSILON){let w=Math.sqrt(x),b=Math.atan2(w,y*m);v=Math.sin(v*b)/w,a=Math.sin(a*b)/w}let _=a*m;if(l=l*v+h*_,c=c*v+f*_,u=u*v+p*_,d=d*v+g*_,v===1-a){let w=1/Math.sqrt(l*l+c*c+u*u+d*d);l*=w,c*=w,u*=w,d*=w}}e[t]=l,e[t+1]=c,e[t+2]=u,e[t+3]=d}static multiplyQuaternionsFlat(e,t,n,i,r,s){let a=n[i],l=n[i+1],c=n[i+2],u=n[i+3],d=r[s],h=r[s+1],f=r[s+2],p=r[s+3];return e[t]=a*p+u*d+l*f-c*h,e[t+1]=l*p+u*h+c*d-a*f,e[t+2]=c*p+u*f+a*h-l*d,e[t+3]=u*p-a*d-l*h-c*f,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,n,i){return this._x=e,this._y=t,this._z=n,this._w=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t){if(!(e&&e.isEuler))throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");let n=e._x,i=e._y,r=e._z,s=e._order,a=Math.cos,l=Math.sin,c=a(n/2),u=a(i/2),d=a(r/2),h=l(n/2),f=l(i/2),p=l(r/2);switch(s){case"XYZ":this._x=h*u*d+c*f*p,this._y=c*f*d-h*u*p,this._z=c*u*p+h*f*d,this._w=c*u*d-h*f*p;break;case"YXZ":this._x=h*u*d+c*f*p,this._y=c*f*d-h*u*p,this._z=c*u*p-h*f*d,this._w=c*u*d+h*f*p;break;case"ZXY":this._x=h*u*d-c*f*p,this._y=c*f*d+h*u*p,this._z=c*u*p+h*f*d,this._w=c*u*d-h*f*p;break;case"ZYX":this._x=h*u*d-c*f*p,this._y=c*f*d+h*u*p,this._z=c*u*p-h*f*d,this._w=c*u*d+h*f*p;break;case"YZX":this._x=h*u*d+c*f*p,this._y=c*f*d+h*u*p,this._z=c*u*p-h*f*d,this._w=c*u*d-h*f*p;break;case"XZY":this._x=h*u*d-c*f*p,this._y=c*f*d-h*u*p,this._z=c*u*p+h*f*d,this._w=c*u*d+h*f*p;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+s)}return t!==!1&&this._onChangeCallback(),this}setFromAxisAngle(e,t){let n=t/2,i=Math.sin(n);return this._x=e.x*i,this._y=e.y*i,this._z=e.z*i,this._w=Math.cos(n),this._onChangeCallback(),this}setFromRotationMatrix(e){let t=e.elements,n=t[0],i=t[4],r=t[8],s=t[1],a=t[5],l=t[9],c=t[2],u=t[6],d=t[10],h=n+a+d;if(h>0){let f=.5/Math.sqrt(h+1);this._w=.25/f,this._x=(u-l)*f,this._y=(r-c)*f,this._z=(s-i)*f}else if(n>a&&n>d){let f=2*Math.sqrt(1+n-a-d);this._w=(u-l)/f,this._x=.25*f,this._y=(i+s)/f,this._z=(r+c)/f}else if(a>d){let f=2*Math.sqrt(1+a-n-d);this._w=(r-c)/f,this._x=(i+s)/f,this._y=.25*f,this._z=(l+u)/f}else{let f=2*Math.sqrt(1+d-n-a);this._w=(s-i)/f,this._x=(r+c)/f,this._y=(l+u)/f,this._z=.25*f}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let n=e.dot(t)+1;return n<Number.EPSILON?(n=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=n):(this._x=0,this._y=-e.z,this._z=e.y,this._w=n)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=n),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(Ci(this.dot(e),-1,1)))}rotateTowards(e,t){let n=this.angleTo(e);if(n===0)return this;let i=Math.min(1,t/n);return this.slerp(e,i),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return e===0?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e,t){return t!==void 0?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(e,t)):this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){let n=e._x,i=e._y,r=e._z,s=e._w,a=t._x,l=t._y,c=t._z,u=t._w;return this._x=n*u+s*a+i*c-r*l,this._y=i*u+s*l+r*a-n*c,this._z=r*u+s*c+n*l-i*a,this._w=s*u-n*a-i*l-r*c,this._onChangeCallback(),this}slerp(e,t){if(t===0)return this;if(t===1)return this.copy(e);let n=this._x,i=this._y,r=this._z,s=this._w,a=s*e._w+n*e._x+i*e._y+r*e._z;if(a<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,a=-a):this.copy(e),a>=1)return this._w=s,this._x=n,this._y=i,this._z=r,this;let l=1-a*a;if(l<=Number.EPSILON){let f=1-t;return this._w=f*s+t*this._w,this._x=f*n+t*this._x,this._y=f*i+t*this._y,this._z=f*r+t*this._z,this.normalize(),this._onChangeCallback(),this}let c=Math.sqrt(l),u=Math.atan2(c,a),d=Math.sin((1-t)*u)/c,h=Math.sin(t*u)/c;return this._w=s*d+this._w*h,this._x=n*d+this._x*h,this._y=i*d+this._y*h,this._z=r*d+this._z*h,this._onChangeCallback(),this}slerpQuaternions(e,t,n){this.copy(e).slerp(t,n)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}};pi.prototype.isQuaternion=!0;var ae=class{constructor(e=0,t=0,n=0){this.x=e,this.y=t,this.z=n}set(e,t,n){return n===void 0&&(n=this.z),this.x=e,this.y=t,this.z=n,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e,t){return t!==void 0?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this)}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e,t){return t!==void 0?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this)}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e,t){return t!==void 0?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(e,t)):(this.x*=e.x,this.y*=e.y,this.z*=e.z,this)}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return e&&e.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(iD.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(iD.setFromAxisAngle(e,t))}applyMatrix3(e){let t=this.x,n=this.y,i=this.z,r=e.elements;return this.x=r[0]*t+r[3]*n+r[6]*i,this.y=r[1]*t+r[4]*n+r[7]*i,this.z=r[2]*t+r[5]*n+r[8]*i,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){let t=this.x,n=this.y,i=this.z,r=e.elements,s=1/(r[3]*t+r[7]*n+r[11]*i+r[15]);return this.x=(r[0]*t+r[4]*n+r[8]*i+r[12])*s,this.y=(r[1]*t+r[5]*n+r[9]*i+r[13])*s,this.z=(r[2]*t+r[6]*n+r[10]*i+r[14])*s,this}applyQuaternion(e){let t=this.x,n=this.y,i=this.z,r=e.x,s=e.y,a=e.z,l=e.w,c=l*t+s*i-a*n,u=l*n+a*t-r*i,d=l*i+r*n-s*t,h=-r*t-s*n-a*i;return this.x=c*l+h*-r+u*-a-d*-s,this.y=u*l+h*-s+d*-r-c*-a,this.z=d*l+h*-a+c*-s-u*-r,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){let t=this.x,n=this.y,i=this.z,r=e.elements;return this.x=r[0]*t+r[4]*n+r[8]*i,this.y=r[1]*t+r[5]*n+r[9]*i,this.z=r[2]*t+r[6]*n+r[10]*i,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this}clampLength(e,t){let n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this}cross(e,t){return t!==void 0?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(e,t)):this.crossVectors(this,e)}crossVectors(e,t){let n=e.x,i=e.y,r=e.z,s=t.x,a=t.y,l=t.z;return this.x=i*l-r*a,this.y=r*s-n*l,this.z=n*a-i*s,this}projectOnVector(e){let t=e.lengthSq();if(t===0)return this.set(0,0,0);let n=e.dot(this)/t;return this.copy(e).multiplyScalar(n)}projectOnPlane(e){return C1.copy(this).projectOnVector(e),this.sub(C1)}reflect(e){return this.sub(C1.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){let t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;let n=this.dot(e)/t;return Math.acos(Ci(n,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){let t=this.x-e.x,n=this.y-e.y,i=this.z-e.z;return t*t+n*n+i*i}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,n){let i=Math.sin(t)*e;return this.x=i*Math.sin(n),this.y=Math.cos(t)*e,this.z=i*Math.cos(n),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,n){return this.x=e*Math.sin(t),this.y=n,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){let t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){let t=this.setFromMatrixColumn(e,0).length(),n=this.setFromMatrixColumn(e,1).length(),i=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=n,this.z=i,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,t*4)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,t*3)}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t,n){return n!==void 0&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}};ae.prototype.isVector3=!0;var C1=new ae,iD=new pi,Li=class{constructor(e=new ae(1/0,1/0,1/0),t=new ae(-1/0,-1/0,-1/0)){this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){let t=1/0,n=1/0,i=1/0,r=-1/0,s=-1/0,a=-1/0;for(let l=0,c=e.length;l<c;l+=3){let u=e[l],d=e[l+1],h=e[l+2];u<t&&(t=u),d<n&&(n=d),h<i&&(i=h),u>r&&(r=u),d>s&&(s=d),h>a&&(a=h)}return this.min.set(t,n,i),this.max.set(r,s,a),this}setFromBufferAttribute(e){let t=1/0,n=1/0,i=1/0,r=-1/0,s=-1/0,a=-1/0;for(let l=0,c=e.count;l<c;l++){let u=e.getX(l),d=e.getY(l),h=e.getZ(l);u<t&&(t=u),d<n&&(n=d),h<i&&(i=h),u>r&&(r=u),d>s&&(s=d),h>a&&(a=h)}return this.min.set(t,n,i),this.max.set(r,s,a),this}setFromPoints(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){let n=Kp.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}setFromObject(e){return this.makeEmpty(),this.expandByObject(e)}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return e===void 0&&(console.warn("THREE.Box3: .getCenter() target is now required"),e=new ae),this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return e===void 0&&(console.warn("THREE.Box3: .getSize() target is now required"),e=new ae),this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e){e.updateWorldMatrix(!1,!1);let t=e.geometry;t!==void 0&&(t.boundingBox===null&&t.computeBoundingBox(),L1.copy(t.boundingBox),L1.applyMatrix4(e.matrixWorld),this.union(L1));let n=e.children;for(let i=0,r=n.length;i<r;i++)this.expandByObject(n[i]);return this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t===void 0&&(console.warn("THREE.Box3: .getParameter() target is now required"),t=new ae),t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)}intersectsSphere(e){return this.clampPoint(e.center,Kp),Kp.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,n;return e.normal.x>0?(t=e.normal.x*this.min.x,n=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,n=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,n+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,n+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,n+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,n+=e.normal.z*this.min.z),t<=-e.constant&&n>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter($p),xv.subVectors(this.max,$p),nd.subVectors(e.a,$p),id.subVectors(e.b,$p),rd.subVectors(e.c,$p),Xa.subVectors(id,nd),qa.subVectors(rd,id),mc.subVectors(nd,rd);let t=[0,-Xa.z,Xa.y,0,-qa.z,qa.y,0,-mc.z,mc.y,Xa.z,0,-Xa.x,qa.z,0,-qa.x,mc.z,0,-mc.x,-Xa.y,Xa.x,0,-qa.y,qa.x,0,-mc.y,mc.x,0];return!R1(t,nd,id,rd,xv)||(t=[1,0,0,0,1,0,0,0,1],!R1(t,nd,id,rd,xv))?!1:(_v.crossVectors(Xa,qa),t=[_v.x,_v.y,_v.z],R1(t,nd,id,rd,xv))}clampPoint(e,t){return t===void 0&&(console.warn("THREE.Box3: .clampPoint() target is now required"),t=new ae),t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return Kp.copy(e).clamp(this.min,this.max).sub(e).length()}getBoundingSphere(e){return e===void 0&&console.error("THREE.Box3: .getBoundingSphere() target is now required"),this.getCenter(e.center),e.radius=this.getSize(Kp).length()*.5,e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()?this:(Ro[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),Ro[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),Ro[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),Ro[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),Ro[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),Ro[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),Ro[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),Ro[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(Ro),this)}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}};Li.prototype.isBox3=!0;var Ro=[new ae,new ae,new ae,new ae,new ae,new ae,new ae,new ae],Kp=new ae,L1=new Li,nd=new ae,id=new ae,rd=new ae,Xa=new ae,qa=new ae,mc=new ae,$p=new ae,xv=new ae,_v=new ae,gc=new ae;function R1(o,e,t,n,i){for(let r=0,s=o.length-3;r<=s;r+=3){gc.fromArray(o,r);let a=i.x*Math.abs(gc.x)+i.y*Math.abs(gc.y)+i.z*Math.abs(gc.z),l=e.dot(gc),c=t.dot(gc),u=n.dot(gc);if(Math.max(-Math.max(l,c,u),Math.min(l,c,u))>a)return!1}return!0}var $j=new Li,rD=new ae,P1=new ae,I1=new ae,Po=class{constructor(e=new ae,t=-1){this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){let n=this.center;t!==void 0?n.copy(t):$j.setFromPoints(e).getCenter(n);let i=0;for(let r=0,s=e.length;r<s;r++)i=Math.max(i,n.distanceToSquared(e[r]));return this.radius=Math.sqrt(i),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){let t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){let n=this.center.distanceToSquared(e);return t===void 0&&(console.warn("THREE.Sphere: .clampPoint() target is now required"),t=new ae),t.copy(e),n>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return e===void 0&&(console.warn("THREE.Sphere: .getBoundingBox() target is now required"),e=new Li),this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){I1.subVectors(e,this.center);let t=I1.lengthSq();if(t>this.radius*this.radius){let n=Math.sqrt(t),i=(n-this.radius)*.5;this.center.add(I1.multiplyScalar(i/n)),this.radius+=i}return this}union(e){return P1.subVectors(e.center,this.center).normalize().multiplyScalar(e.radius),this.expandByPoint(rD.copy(e.center).add(P1)),this.expandByPoint(rD.copy(e.center).sub(P1)),this}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return new this.constructor().copy(this)}},Io=new ae,D1=new ae,wv=new ae,ja=new ae,F1=new ae,bv=new ae,B1=new ae,yc=class{constructor(e=new ae,t=new ae(0,0,-1)){this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t===void 0&&(console.warn("THREE.Ray: .at() target is now required"),t=new ae),t.copy(this.direction).multiplyScalar(e).add(this.origin)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,Io)),this}closestPointToPoint(e,t){t===void 0&&(console.warn("THREE.Ray: .closestPointToPoint() target is now required"),t=new ae),t.subVectors(e,this.origin);let n=t.dot(this.direction);return n<0?t.copy(this.origin):t.copy(this.direction).multiplyScalar(n).add(this.origin)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){let t=Io.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(Io.copy(this.direction).multiplyScalar(t).add(this.origin),Io.distanceToSquared(e))}distanceSqToSegment(e,t,n,i){D1.copy(e).add(t).multiplyScalar(.5),wv.copy(t).sub(e).normalize(),ja.copy(this.origin).sub(D1);let r=e.distanceTo(t)*.5,s=-this.direction.dot(wv),a=ja.dot(this.direction),l=-ja.dot(wv),c=ja.lengthSq(),u=Math.abs(1-s*s),d,h,f,p;if(u>0)if(d=s*l-a,h=s*a-l,p=r*u,d>=0)if(h>=-p)if(h<=p){let g=1/u;d*=g,h*=g,f=d*(d+s*h+2*a)+h*(s*d+h+2*l)+c}else h=r,d=Math.max(0,-(s*h+a)),f=-d*d+h*(h+2*l)+c;else h=-r,d=Math.max(0,-(s*h+a)),f=-d*d+h*(h+2*l)+c;else h<=-p?(d=Math.max(0,-(-s*r+a)),h=d>0?-r:Math.min(Math.max(-r,-l),r),f=-d*d+h*(h+2*l)+c):h<=p?(d=0,h=Math.min(Math.max(-r,-l),r),f=h*(h+2*l)+c):(d=Math.max(0,-(s*r+a)),h=d>0?r:Math.min(Math.max(-r,-l),r),f=-d*d+h*(h+2*l)+c);else h=s>0?-r:r,d=Math.max(0,-(s*h+a)),f=-d*d+h*(h+2*l)+c;return n&&n.copy(this.direction).multiplyScalar(d).add(this.origin),i&&i.copy(wv).multiplyScalar(h).add(D1),f}intersectSphere(e,t){Io.subVectors(e.center,this.origin);let n=Io.dot(this.direction),i=Io.dot(Io)-n*n,r=e.radius*e.radius;if(i>r)return null;let s=Math.sqrt(r-i),a=n-s,l=n+s;return a<0&&l<0?null:a<0?this.at(l,t):this.at(a,t)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){let t=e.normal.dot(this.direction);if(t===0)return e.distanceToPoint(this.origin)===0?0:null;let n=-(this.origin.dot(e.normal)+e.constant)/t;return n>=0?n:null}intersectPlane(e,t){let n=this.distanceToPlane(e);return n===null?null:this.at(n,t)}intersectsPlane(e){let t=e.distanceToPoint(this.origin);return t===0||e.normal.dot(this.direction)*t<0}intersectBox(e,t){let n,i,r,s,a,l,c=1/this.direction.x,u=1/this.direction.y,d=1/this.direction.z,h=this.origin;return c>=0?(n=(e.min.x-h.x)*c,i=(e.max.x-h.x)*c):(n=(e.max.x-h.x)*c,i=(e.min.x-h.x)*c),u>=0?(r=(e.min.y-h.y)*u,s=(e.max.y-h.y)*u):(r=(e.max.y-h.y)*u,s=(e.min.y-h.y)*u),n>s||r>i||((r>n||n!==n)&&(n=r),(s<i||i!==i)&&(i=s),d>=0?(a=(e.min.z-h.z)*d,l=(e.max.z-h.z)*d):(a=(e.max.z-h.z)*d,l=(e.min.z-h.z)*d),n>l||a>i)||((a>n||n!==n)&&(n=a),(l<i||i!==i)&&(i=l),i<0)?null:this.at(n>=0?n:i,t)}intersectsBox(e){return this.intersectBox(e,Io)!==null}intersectTriangle(e,t,n,i,r){F1.subVectors(t,e),bv.subVectors(n,e),B1.crossVectors(F1,bv);let s=this.direction.dot(B1),a;if(s>0){if(i)return null;a=1}else if(s<0)a=-1,s=-s;else return null;ja.subVectors(this.origin,e);let l=a*this.direction.dot(bv.crossVectors(ja,bv));if(l<0)return null;let c=a*this.direction.dot(F1.cross(ja));if(c<0||l+c>s)return null;let u=-a*ja.dot(B1);return u<0?null:this.at(u/s,r)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}},Ze=class{constructor(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}set(e,t,n,i,r,s,a,l,c,u,d,h,f,p,g,v){let y=this.elements;return y[0]=e,y[4]=t,y[8]=n,y[12]=i,y[1]=r,y[5]=s,y[9]=a,y[13]=l,y[2]=c,y[6]=u,y[10]=d,y[14]=h,y[3]=f,y[7]=p,y[11]=g,y[15]=v,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new Ze().fromArray(this.elements)}copy(e){let t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],this}copyPosition(e){let t=this.elements,n=e.elements;return t[12]=n[12],t[13]=n[13],t[14]=n[14],this}setFromMatrix3(e){let t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,n){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this}makeBasis(e,t,n){return this.set(e.x,t.x,n.x,0,e.y,t.y,n.y,0,e.z,t.z,n.z,0,0,0,0,1),this}extractRotation(e){let t=this.elements,n=e.elements,i=1/sd.setFromMatrixColumn(e,0).length(),r=1/sd.setFromMatrixColumn(e,1).length(),s=1/sd.setFromMatrixColumn(e,2).length();return t[0]=n[0]*i,t[1]=n[1]*i,t[2]=n[2]*i,t[3]=0,t[4]=n[4]*r,t[5]=n[5]*r,t[6]=n[6]*r,t[7]=0,t[8]=n[8]*s,t[9]=n[9]*s,t[10]=n[10]*s,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){e&&e.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");let t=this.elements,n=e.x,i=e.y,r=e.z,s=Math.cos(n),a=Math.sin(n),l=Math.cos(i),c=Math.sin(i),u=Math.cos(r),d=Math.sin(r);if(e.order==="XYZ"){let h=s*u,f=s*d,p=a*u,g=a*d;t[0]=l*u,t[4]=-l*d,t[8]=c,t[1]=f+p*c,t[5]=h-g*c,t[9]=-a*l,t[2]=g-h*c,t[6]=p+f*c,t[10]=s*l}else if(e.order==="YXZ"){let h=l*u,f=l*d,p=c*u,g=c*d;t[0]=h+g*a,t[4]=p*a-f,t[8]=s*c,t[1]=s*d,t[5]=s*u,t[9]=-a,t[2]=f*a-p,t[6]=g+h*a,t[10]=s*l}else if(e.order==="ZXY"){let h=l*u,f=l*d,p=c*u,g=c*d;t[0]=h-g*a,t[4]=-s*d,t[8]=p+f*a,t[1]=f+p*a,t[5]=s*u,t[9]=g-h*a,t[2]=-s*c,t[6]=a,t[10]=s*l}else if(e.order==="ZYX"){let h=s*u,f=s*d,p=a*u,g=a*d;t[0]=l*u,t[4]=p*c-f,t[8]=h*c+g,t[1]=l*d,t[5]=g*c+h,t[9]=f*c-p,t[2]=-c,t[6]=a*l,t[10]=s*l}else if(e.order==="YZX"){let h=s*l,f=s*c,p=a*l,g=a*c;t[0]=l*u,t[4]=g-h*d,t[8]=p*d+f,t[1]=d,t[5]=s*u,t[9]=-a*u,t[2]=-c*u,t[6]=f*d+p,t[10]=h-g*d}else if(e.order==="XZY"){let h=s*l,f=s*c,p=a*l,g=a*c;t[0]=l*u,t[4]=-d,t[8]=c*u,t[1]=h*d+g,t[5]=s*u,t[9]=f*d-p,t[2]=p*d-f,t[6]=a*u,t[10]=g*d+h}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(Qj,e,eY)}lookAt(e,t,n){let i=this.elements;return ir.subVectors(e,t),ir.lengthSq()===0&&(ir.z=1),ir.normalize(),Ya.crossVectors(n,ir),Ya.lengthSq()===0&&(Math.abs(n.z)===1?ir.x+=1e-4:ir.z+=1e-4,ir.normalize(),Ya.crossVectors(n,ir)),Ya.normalize(),Mv.crossVectors(ir,Ya),i[0]=Ya.x,i[4]=Mv.x,i[8]=ir.x,i[1]=Ya.y,i[5]=Mv.y,i[9]=ir.y,i[2]=Ya.z,i[6]=Mv.z,i[10]=ir.z,this}multiply(e,t){return t!==void 0?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(e,t)):this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){let n=e.elements,i=t.elements,r=this.elements,s=n[0],a=n[4],l=n[8],c=n[12],u=n[1],d=n[5],h=n[9],f=n[13],p=n[2],g=n[6],v=n[10],y=n[14],m=n[3],x=n[7],_=n[11],w=n[15],b=i[0],M=i[4],S=i[8],E=i[12],A=i[1],L=i[5],B=i[9],R=i[13],D=i[2],P=i[6],I=i[10],N=i[14],G=i[3],z=i[7],se=i[11],ne=i[15];return r[0]=s*b+a*A+l*D+c*G,r[4]=s*M+a*L+l*P+c*z,r[8]=s*S+a*B+l*I+c*se,r[12]=s*E+a*R+l*N+c*ne,r[1]=u*b+d*A+h*D+f*G,r[5]=u*M+d*L+h*P+f*z,r[9]=u*S+d*B+h*I+f*se,r[13]=u*E+d*R+h*N+f*ne,r[2]=p*b+g*A+v*D+y*G,r[6]=p*M+g*L+v*P+y*z,r[10]=p*S+g*B+v*I+y*se,r[14]=p*E+g*R+v*N+y*ne,r[3]=m*b+x*A+_*D+w*G,r[7]=m*M+x*L+_*P+w*z,r[11]=m*S+x*B+_*I+w*se,r[15]=m*E+x*R+_*N+w*ne,this}multiplyScalar(e){let t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){let e=this.elements,t=e[0],n=e[4],i=e[8],r=e[12],s=e[1],a=e[5],l=e[9],c=e[13],u=e[2],d=e[6],h=e[10],f=e[14],p=e[3],g=e[7],v=e[11],y=e[15];return p*(+r*l*d-i*c*d-r*a*h+n*c*h+i*a*f-n*l*f)+g*(+t*l*f-t*c*h+r*s*h-i*s*f+i*c*u-r*l*u)+v*(+t*c*d-t*a*f-r*s*d+n*s*f+r*a*u-n*c*u)+y*(-i*a*u-t*l*d+t*a*h+i*s*d-n*s*h+n*l*u)}transpose(){let e=this.elements,t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,n){let i=this.elements;return e.isVector3?(i[12]=e.x,i[13]=e.y,i[14]=e.z):(i[12]=e,i[13]=t,i[14]=n),this}invert(){let e=this.elements,t=e[0],n=e[1],i=e[2],r=e[3],s=e[4],a=e[5],l=e[6],c=e[7],u=e[8],d=e[9],h=e[10],f=e[11],p=e[12],g=e[13],v=e[14],y=e[15],m=d*v*c-g*h*c+g*l*f-a*v*f-d*l*y+a*h*y,x=p*h*c-u*v*c-p*l*f+s*v*f+u*l*y-s*h*y,_=u*g*c-p*d*c+p*a*f-s*g*f-u*a*y+s*d*y,w=p*d*l-u*g*l-p*a*h+s*g*h+u*a*v-s*d*v,b=t*m+n*x+i*_+r*w;if(b===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);let M=1/b;return e[0]=m*M,e[1]=(g*h*r-d*v*r-g*i*f+n*v*f+d*i*y-n*h*y)*M,e[2]=(a*v*r-g*l*r+g*i*c-n*v*c-a*i*y+n*l*y)*M,e[3]=(d*l*r-a*h*r-d*i*c+n*h*c+a*i*f-n*l*f)*M,e[4]=x*M,e[5]=(u*v*r-p*h*r+p*i*f-t*v*f-u*i*y+t*h*y)*M,e[6]=(p*l*r-s*v*r-p*i*c+t*v*c+s*i*y-t*l*y)*M,e[7]=(s*h*r-u*l*r+u*i*c-t*h*c-s*i*f+t*l*f)*M,e[8]=_*M,e[9]=(p*d*r-u*g*r-p*n*f+t*g*f+u*n*y-t*d*y)*M,e[10]=(s*g*r-p*a*r+p*n*c-t*g*c-s*n*y+t*a*y)*M,e[11]=(u*a*r-s*d*r-u*n*c+t*d*c+s*n*f-t*a*f)*M,e[12]=w*M,e[13]=(u*g*i-p*d*i+p*n*h-t*g*h-u*n*v+t*d*v)*M,e[14]=(p*a*i-s*g*i-p*n*l+t*g*l+s*n*v-t*a*v)*M,e[15]=(s*d*i-u*a*i+u*n*l-t*d*l-s*n*h+t*a*h)*M,this}scale(e){let t=this.elements,n=e.x,i=e.y,r=e.z;return t[0]*=n,t[4]*=i,t[8]*=r,t[1]*=n,t[5]*=i,t[9]*=r,t[2]*=n,t[6]*=i,t[10]*=r,t[3]*=n,t[7]*=i,t[11]*=r,this}getMaxScaleOnAxis(){let e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],n=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],i=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,n,i))}makeTranslation(e,t,n){return this.set(1,0,0,e,0,1,0,t,0,0,1,n,0,0,0,1),this}makeRotationX(e){let t=Math.cos(e),n=Math.sin(e);return this.set(1,0,0,0,0,t,-n,0,0,n,t,0,0,0,0,1),this}makeRotationY(e){let t=Math.cos(e),n=Math.sin(e);return this.set(t,0,n,0,0,1,0,0,-n,0,t,0,0,0,0,1),this}makeRotationZ(e){let t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,0,n,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){let n=Math.cos(t),i=Math.sin(t),r=1-n,s=e.x,a=e.y,l=e.z,c=r*s,u=r*a;return this.set(c*s+n,c*a-i*l,c*l+i*a,0,c*a+i*l,u*a+n,u*l-i*s,0,c*l-i*a,u*l+i*s,r*l*l+n,0,0,0,0,1),this}makeScale(e,t,n){return this.set(e,0,0,0,0,t,0,0,0,0,n,0,0,0,0,1),this}makeShear(e,t,n){return this.set(1,t,n,0,e,1,n,0,e,t,1,0,0,0,0,1),this}compose(e,t,n){let i=this.elements,r=t._x,s=t._y,a=t._z,l=t._w,c=r+r,u=s+s,d=a+a,h=r*c,f=r*u,p=r*d,g=s*u,v=s*d,y=a*d,m=l*c,x=l*u,_=l*d,w=n.x,b=n.y,M=n.z;return i[0]=(1-(g+y))*w,i[1]=(f+_)*w,i[2]=(p-x)*w,i[3]=0,i[4]=(f-_)*b,i[5]=(1-(h+y))*b,i[6]=(v+m)*b,i[7]=0,i[8]=(p+x)*M,i[9]=(v-m)*M,i[10]=(1-(h+g))*M,i[11]=0,i[12]=e.x,i[13]=e.y,i[14]=e.z,i[15]=1,this}decompose(e,t,n){let i=this.elements,r=sd.set(i[0],i[1],i[2]).length(),s=sd.set(i[4],i[5],i[6]).length(),a=sd.set(i[8],i[9],i[10]).length();this.determinant()<0&&(r=-r),e.x=i[12],e.y=i[13],e.z=i[14],ns.copy(this);let c=1/r,u=1/s,d=1/a;return ns.elements[0]*=c,ns.elements[1]*=c,ns.elements[2]*=c,ns.elements[4]*=u,ns.elements[5]*=u,ns.elements[6]*=u,ns.elements[8]*=d,ns.elements[9]*=d,ns.elements[10]*=d,t.setFromRotationMatrix(ns),n.x=r,n.y=s,n.z=a,this}makePerspective(e,t,n,i,r,s){s===void 0&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");let a=this.elements,l=2*r/(t-e),c=2*r/(n-i),u=(t+e)/(t-e),d=(n+i)/(n-i),h=-(s+r)/(s-r),f=-2*s*r/(s-r);return a[0]=l,a[4]=0,a[8]=u,a[12]=0,a[1]=0,a[5]=c,a[9]=d,a[13]=0,a[2]=0,a[6]=0,a[10]=h,a[14]=f,a[3]=0,a[7]=0,a[11]=-1,a[15]=0,this}makeOrthographic(e,t,n,i,r,s){let a=this.elements,l=1/(t-e),c=1/(n-i),u=1/(s-r),d=(t+e)*l,h=(n+i)*c,f=(s+r)*u;return a[0]=2*l,a[4]=0,a[8]=0,a[12]=-d,a[1]=0,a[5]=2*c,a[9]=0,a[13]=-h,a[2]=0,a[6]=0,a[10]=-2*u,a[14]=-f,a[3]=0,a[7]=0,a[11]=0,a[15]=1,this}equals(e){let t=this.elements,n=e.elements;for(let i=0;i<16;i++)if(t[i]!==n[i])return!1;return!0}fromArray(e,t=0){for(let n=0;n<16;n++)this.elements[n]=e[n+t];return this}toArray(e=[],t=0){let n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e[t+9]=n[9],e[t+10]=n[10],e[t+11]=n[11],e[t+12]=n[12],e[t+13]=n[13],e[t+14]=n[14],e[t+15]=n[15],e}};Ze.prototype.isMatrix4=!0;var sd=new ae,ns=new Ze,Qj=new ae(0,0,0),eY=new ae(1,1,1),Ya=new ae,Mv=new ae,ir=new ae,sD=new Ze,oD=new pi,vc=class{constructor(e=0,t=0,n=0,i=vc.DefaultOrder){this._x=e,this._y=t,this._z=n,this._order=i}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,n,i){return this._x=e,this._y=t,this._z=n,this._order=i||this._order,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t,n){let i=e.elements,r=i[0],s=i[4],a=i[8],l=i[1],c=i[5],u=i[9],d=i[2],h=i[6],f=i[10];switch(t=t||this._order,t){case"XYZ":this._y=Math.asin(Ci(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-u,f),this._z=Math.atan2(-s,r)):(this._x=Math.atan2(h,c),this._z=0);break;case"YXZ":this._x=Math.asin(-Ci(u,-1,1)),Math.abs(u)<.9999999?(this._y=Math.atan2(a,f),this._z=Math.atan2(l,c)):(this._y=Math.atan2(-d,r),this._z=0);break;case"ZXY":this._x=Math.asin(Ci(h,-1,1)),Math.abs(h)<.9999999?(this._y=Math.atan2(-d,f),this._z=Math.atan2(-s,c)):(this._y=0,this._z=Math.atan2(l,r));break;case"ZYX":this._y=Math.asin(-Ci(d,-1,1)),Math.abs(d)<.9999999?(this._x=Math.atan2(h,f),this._z=Math.atan2(l,r)):(this._x=0,this._z=Math.atan2(-s,c));break;case"YZX":this._z=Math.asin(Ci(l,-1,1)),Math.abs(l)<.9999999?(this._x=Math.atan2(-u,c),this._y=Math.atan2(-d,r)):(this._x=0,this._y=Math.atan2(a,f));break;case"XZY":this._z=Math.asin(-Ci(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(h,c),this._y=Math.atan2(a,r)):(this._x=Math.atan2(-u,f),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,n!==!1&&this._onChangeCallback(),this}setFromQuaternion(e,t,n){return sD.makeRotationFromQuaternion(e),this.setFromRotationMatrix(sD,t,n)}setFromVector3(e,t){return this.set(e.x,e.y,e.z,t||this._order)}reorder(e){return oD.setFromEuler(this),this.setFromQuaternion(oD,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],e[3]!==void 0&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}toVector3(e){return e?e.set(this._x,this._y,this._z):new ae(this._x,this._y,this._z)}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}};vc.prototype.isEuler=!0;vc.DefaultOrder="XYZ";vc.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"];var aD=class{constructor(){this.mask=1|0}set(e){this.mask=1<<e|0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=4294967295|0}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return(this.mask&e.mask)!=0}},tY=0,lD=new ae,od=new pi,Do=new Ze,Sv=new ae,Qp=new ae,nY=new ae,iY=new pi,cD=new ae(1,0,0),uD=new ae(0,1,0),hD=new ae(0,0,1),rY={type:"added"},dD={type:"removed"},ot=class extends Va{constructor(){super();Object.defineProperty(this,"id",{value:tY++}),this.uuid=nr(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=ot.DefaultUp.clone();let e=new ae,t=new vc,n=new pi,i=new ae(1,1,1);function r(){n.setFromEuler(t,!1)}function s(){t.setFromQuaternion(n,void 0,!1)}t._onChange(r),n._onChange(s),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:n},scale:{configurable:!0,enumerable:!0,value:i},modelViewMatrix:{value:new Ze},normalMatrix:{value:new Un}}),this.matrix=new Ze,this.matrixWorld=new Ze,this.matrixAutoUpdate=ot.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new aD,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return od.setFromAxisAngle(e,t),this.quaternion.multiply(od),this}rotateOnWorldAxis(e,t){return od.setFromAxisAngle(e,t),this.quaternion.premultiply(od),this}rotateX(e){return this.rotateOnAxis(cD,e)}rotateY(e){return this.rotateOnAxis(uD,e)}rotateZ(e){return this.rotateOnAxis(hD,e)}translateOnAxis(e,t){return lD.copy(e).applyQuaternion(this.quaternion),this.position.add(lD.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(cD,e)}translateY(e){return this.translateOnAxis(uD,e)}translateZ(e){return this.translateOnAxis(hD,e)}localToWorld(e){return e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return e.applyMatrix4(Do.copy(this.matrixWorld).invert())}lookAt(e,t,n){e.isVector3?Sv.copy(e):Sv.set(e,t,n);let i=this.parent;this.updateWorldMatrix(!0,!1),Qp.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Do.lookAt(Qp,Sv,this.up):Do.lookAt(Sv,Qp,this.up),this.quaternion.setFromRotationMatrix(Do),i&&(Do.extractRotation(i.matrixWorld),od.setFromRotationMatrix(Do),this.quaternion.premultiply(od.invert()))}add(e){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(e.parent!==null&&e.parent.remove(e),e.parent=this,this.children.push(e),e.dispatchEvent(rY)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let n=0;n<arguments.length;n++)this.remove(arguments[n]);return this}let t=this.children.indexOf(e);return t!==-1&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(dD)),this}clear(){for(let e=0;e<this.children.length;e++){let t=this.children[e];t.parent=null,t.dispatchEvent(dD)}return this.children.length=0,this}attach(e){return this.updateWorldMatrix(!0,!1),Do.copy(this.matrixWorld).invert(),e.parent!==null&&(e.parent.updateWorldMatrix(!0,!1),Do.multiply(e.parent.matrixWorld)),e.applyMatrix4(Do),this.add(e),e.updateWorldMatrix(!1,!0),this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let n=0,i=this.children.length;n<i;n++){let s=this.children[n].getObjectByProperty(e,t);if(s!==void 0)return s}}getWorldPosition(e){return e===void 0&&(console.warn("THREE.Object3D: .getWorldPosition() target is now required"),e=new ae),this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return e===void 0&&(console.warn("THREE.Object3D: .getWorldQuaternion() target is now required"),e=new pi),this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Qp,e,nY),e}getWorldScale(e){return e===void 0&&(console.warn("THREE.Object3D: .getWorldScale() target is now required"),e=new ae),this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Qp,iY,e),e}getWorldDirection(e){e===void 0&&(console.warn("THREE.Object3D: .getWorldDirection() target is now required"),e=new ae),this.updateWorldMatrix(!0,!1);let t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(e){e(this);let t=this.children;for(let n=0,i=t.length;n<i;n++)t[n].traverse(e)}traverseVisible(e){if(this.visible===!1)return;e(this);let t=this.children;for(let n=0,i=t.length;n<i;n++)t[n].traverseVisible(e)}traverseAncestors(e){let t=this.parent;t!==null&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);let t=this.children;for(let n=0,i=t.length;n<i;n++)t[n].updateMatrixWorld(e)}updateWorldMatrix(e,t){let n=this.parent;if(e===!0&&n!==null&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),t===!0){let i=this.children;for(let r=0,s=i.length;r<s;r++)i[r].updateWorldMatrix(!1,!0)}}toJSON(e){let t=e===void 0||typeof e=="string",n={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{}},n.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});let i={};i.uuid=this.uuid,i.type=this.type,this.name!==""&&(i.name=this.name),this.castShadow===!0&&(i.castShadow=!0),this.receiveShadow===!0&&(i.receiveShadow=!0),this.visible===!1&&(i.visible=!1),this.frustumCulled===!1&&(i.frustumCulled=!1),this.renderOrder!==0&&(i.renderOrder=this.renderOrder),JSON.stringify(this.userData)!=="{}"&&(i.userData=this.userData),i.layers=this.layers.mask,i.matrix=this.matrix.toArray(),this.matrixAutoUpdate===!1&&(i.matrixAutoUpdate=!1),this.isInstancedMesh&&(i.type="InstancedMesh",i.count=this.count,i.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(i.instanceColor=this.instanceColor.toJSON()));function r(a,l){return a[l.uuid]===void 0&&(a[l.uuid]=l.toJSON(e)),l.uuid}if(this.isMesh||this.isLine||this.isPoints){i.geometry=r(e.geometries,this.geometry);let a=this.geometry.parameters;if(a!==void 0&&a.shapes!==void 0){let l=a.shapes;if(Array.isArray(l))for(let c=0,u=l.length;c<u;c++){let d=l[c];r(e.shapes,d)}else r(e.shapes,l)}}if(this.isSkinnedMesh&&(i.bindMode=this.bindMode,i.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(r(e.skeletons,this.skeleton),i.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){let a=[];for(let l=0,c=this.material.length;l<c;l++)a.push(r(e.materials,this.material[l]));i.material=a}else i.material=r(e.materials,this.material);if(this.children.length>0){i.children=[];for(let a=0;a<this.children.length;a++)i.children.push(this.children[a].toJSON(e).object)}if(this.animations.length>0){i.animations=[];for(let a=0;a<this.animations.length;a++){let l=this.animations[a];i.animations.push(r(e.animations,l))}}if(t){let a=s(e.geometries),l=s(e.materials),c=s(e.textures),u=s(e.images),d=s(e.shapes),h=s(e.skeletons),f=s(e.animations);a.length>0&&(n.geometries=a),l.length>0&&(n.materials=l),c.length>0&&(n.textures=c),u.length>0&&(n.images=u),d.length>0&&(n.shapes=d),h.length>0&&(n.skeletons=h),f.length>0&&(n.animations=f)}return n.object=i,n;function s(a){let l=[];for(let c in a){let u=a[c];delete u.metadata,l.push(u)}return l}}clone(e){return new this.constructor().copy(this,e)}copy(e,t=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.userData=JSON.parse(JSON.stringify(e.userData)),t===!0)for(let n=0;n<e.children.length;n++){let i=e.children[n];this.add(i.clone())}return this}};ot.DefaultUp=new ae(0,1,0);ot.DefaultMatrixAutoUpdate=!0;ot.prototype.isObject3D=!0;var N1=new ae,sY=new ae,oY=new Un,mi=class{constructor(e=new ae(1,0,0),t=0){this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,n,i){return this.normal.set(e,t,n),this.constant=i,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,n){let i=N1.subVectors(n,t).cross(sY.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(i,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){let e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t===void 0&&(console.warn("THREE.Plane: .projectPoint() target is now required"),t=new ae),t.copy(this.normal).multiplyScalar(-this.distanceToPoint(e)).add(e)}intersectLine(e,t){t===void 0&&(console.warn("THREE.Plane: .intersectLine() target is now required"),t=new ae);let n=e.delta(N1),i=this.normal.dot(n);if(i===0)return this.distanceToPoint(e.start)===0?t.copy(e.start):null;let r=-(e.start.dot(this.normal)+this.constant)/i;return r<0||r>1?null:t.copy(n).multiplyScalar(r).add(e.start)}intersectsLine(e){let t=this.distanceToPoint(e.start),n=this.distanceToPoint(e.end);return t<0&&n>0||n<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e===void 0&&(console.warn("THREE.Plane: .coplanarPoint() target is now required"),e=new ae),e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){let n=t||oY.getNormalMatrix(e),i=this.coplanarPoint(N1).applyMatrix4(e),r=this.normal.applyMatrix3(n).normalize();return this.constant=-i.dot(r),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return new this.constructor().copy(this)}};mi.prototype.isPlane=!0;var is=new ae,Fo=new ae,O1=new ae,Bo=new ae,ad=new ae,ld=new ae,fD=new ae,k1=new ae,z1=new ae,U1=new ae,wn=class{constructor(e=new ae,t=new ae,n=new ae){this.a=e,this.b=t,this.c=n}static getNormal(e,t,n,i){i===void 0&&(console.warn("THREE.Triangle: .getNormal() target is now required"),i=new ae),i.subVectors(n,t),is.subVectors(e,t),i.cross(is);let r=i.lengthSq();return r>0?i.multiplyScalar(1/Math.sqrt(r)):i.set(0,0,0)}static getBarycoord(e,t,n,i,r){is.subVectors(i,t),Fo.subVectors(n,t),O1.subVectors(e,t);let s=is.dot(is),a=is.dot(Fo),l=is.dot(O1),c=Fo.dot(Fo),u=Fo.dot(O1),d=s*c-a*a;if(r===void 0&&(console.warn("THREE.Triangle: .getBarycoord() target is now required"),r=new ae),d===0)return r.set(-2,-1,-1);let h=1/d,f=(c*l-a*u)*h,p=(s*u-a*l)*h;return r.set(1-f-p,p,f)}static containsPoint(e,t,n,i){return this.getBarycoord(e,t,n,i,Bo),Bo.x>=0&&Bo.y>=0&&Bo.x+Bo.y<=1}static getUV(e,t,n,i,r,s,a,l){return this.getBarycoord(e,t,n,i,Bo),l.set(0,0),l.addScaledVector(r,Bo.x),l.addScaledVector(s,Bo.y),l.addScaledVector(a,Bo.z),l}static isFrontFacing(e,t,n,i){return is.subVectors(n,t),Fo.subVectors(e,t),is.cross(Fo).dot(i)<0}set(e,t,n){return this.a.copy(e),this.b.copy(t),this.c.copy(n),this}setFromPointsAndIndices(e,t,n,i){return this.a.copy(e[t]),this.b.copy(e[n]),this.c.copy(e[i]),this}clone(){return new this.constructor().copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return is.subVectors(this.c,this.b),Fo.subVectors(this.a,this.b),is.cross(Fo).length()*.5}getMidpoint(e){return e===void 0&&(console.warn("THREE.Triangle: .getMidpoint() target is now required"),e=new ae),e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return wn.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e===void 0&&(console.warn("THREE.Triangle: .getPlane() target is now required"),e=new mi),e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return wn.getBarycoord(e,this.a,this.b,this.c,t)}getUV(e,t,n,i,r){return wn.getUV(e,this.a,this.b,this.c,t,n,i,r)}containsPoint(e){return wn.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return wn.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){t===void 0&&(console.warn("THREE.Triangle: .closestPointToPoint() target is now required"),t=new ae);let n=this.a,i=this.b,r=this.c,s,a;ad.subVectors(i,n),ld.subVectors(r,n),k1.subVectors(e,n);let l=ad.dot(k1),c=ld.dot(k1);if(l<=0&&c<=0)return t.copy(n);z1.subVectors(e,i);let u=ad.dot(z1),d=ld.dot(z1);if(u>=0&&d<=u)return t.copy(i);let h=l*d-u*c;if(h<=0&&l>=0&&u<=0)return s=l/(l-u),t.copy(n).addScaledVector(ad,s);U1.subVectors(e,r);let f=ad.dot(U1),p=ld.dot(U1);if(p>=0&&f<=p)return t.copy(r);let g=f*c-l*p;if(g<=0&&c>=0&&p<=0)return a=c/(c-p),t.copy(n).addScaledVector(ld,a);let v=u*p-f*d;if(v<=0&&d-u>=0&&f-p>=0)return fD.subVectors(r,i),a=(d-u)/(d-u+(f-p)),t.copy(i).addScaledVector(fD,a);let y=1/(v+g+h);return s=g*y,a=h*y,t.copy(n).addScaledVector(ad,s).addScaledVector(ld,a)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}},aY=0;function bn(){Object.defineProperty(this,"id",{value:aY++}),this.uuid=nr(),this.name="",this.type="Material",this.fog=!0,this.blending=Gp,this.side=Wh,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.blendSrc=PI,this.blendDst=II,this.blendEquation=qh,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=p1,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=Oj,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=S1,this.stencilZFail=S1,this.stencilZPass=S1,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaTest=0,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0}bn.prototype=Object.assign(Object.create(Va.prototype),{constructor:bn,isMaterial:!0,onBuild:function(){},onBeforeCompile:function(){},customProgramCacheKey:function(){return this.onBeforeCompile.toString()},setValues:function(o){if(o!==void 0)for(let e in o){let t=o[e];if(t===void 0){console.warn("THREE.Material: '"+e+"' parameter is undefined.");continue}if(e==="shading"){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=t===TI;continue}let n=this[e];if(n===void 0){console.warn("THREE."+this.type+": '"+e+"' is not a property of this material.");continue}n&&n.isColor?n.set(t):n&&n.isVector3&&t&&t.isVector3?n.copy(t):this[e]=t}},toJSON:function(o){let e=o===void 0||typeof o=="string";e&&(o={textures:{},images:{}});let t={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};t.uuid=this.uuid,t.type=this.type,this.name!==""&&(t.name=this.name),this.color&&this.color.isColor&&(t.color=this.color.getHex()),this.roughness!==void 0&&(t.roughness=this.roughness),this.metalness!==void 0&&(t.metalness=this.metalness),this.sheen&&this.sheen.isColor&&(t.sheen=this.sheen.getHex()),this.emissive&&this.emissive.isColor&&(t.emissive=this.emissive.getHex()),this.emissiveIntensity&&this.emissiveIntensity!==1&&(t.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(t.specular=this.specular.getHex()),this.shininess!==void 0&&(t.shininess=this.shininess),this.clearcoat!==void 0&&(t.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(t.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(t.clearcoatMap=this.clearcoatMap.toJSON(o).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(t.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(o).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(t.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(o).uuid,t.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.map&&this.map.isTexture&&(t.map=this.map.toJSON(o).uuid),this.matcap&&this.matcap.isTexture&&(t.matcap=this.matcap.toJSON(o).uuid),this.alphaMap&&this.alphaMap.isTexture&&(t.alphaMap=this.alphaMap.toJSON(o).uuid),this.lightMap&&this.lightMap.isTexture&&(t.lightMap=this.lightMap.toJSON(o).uuid,t.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(t.aoMap=this.aoMap.toJSON(o).uuid,t.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(t.bumpMap=this.bumpMap.toJSON(o).uuid,t.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(t.normalMap=this.normalMap.toJSON(o).uuid,t.normalMapType=this.normalMapType,t.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(t.displacementMap=this.displacementMap.toJSON(o).uuid,t.displacementScale=this.displacementScale,t.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(t.roughnessMap=this.roughnessMap.toJSON(o).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(t.metalnessMap=this.metalnessMap.toJSON(o).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(t.emissiveMap=this.emissiveMap.toJSON(o).uuid),this.specularMap&&this.specularMap.isTexture&&(t.specularMap=this.specularMap.toJSON(o).uuid),this.envMap&&this.envMap.isTexture&&(t.envMap=this.envMap.toJSON(o).uuid,this.combine!==void 0&&(t.combine=this.combine)),this.envMapIntensity!==void 0&&(t.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(t.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(t.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(t.gradientMap=this.gradientMap.toJSON(o).uuid),this.size!==void 0&&(t.size=this.size),this.shadowSide!==null&&(t.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(t.sizeAttenuation=this.sizeAttenuation),this.blending!==Gp&&(t.blending=this.blending),this.side!==Wh&&(t.side=this.side),this.vertexColors&&(t.vertexColors=!0),this.opacity<1&&(t.opacity=this.opacity),this.transparent===!0&&(t.transparent=this.transparent),t.depthFunc=this.depthFunc,t.depthTest=this.depthTest,t.depthWrite=this.depthWrite,t.colorWrite=this.colorWrite,t.stencilWrite=this.stencilWrite,t.stencilWriteMask=this.stencilWriteMask,t.stencilFunc=this.stencilFunc,t.stencilRef=this.stencilRef,t.stencilFuncMask=this.stencilFuncMask,t.stencilFail=this.stencilFail,t.stencilZFail=this.stencilZFail,t.stencilZPass=this.stencilZPass,this.rotation&&this.rotation!==0&&(t.rotation=this.rotation),this.polygonOffset===!0&&(t.polygonOffset=!0),this.polygonOffsetFactor!==0&&(t.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(t.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth&&this.linewidth!==1&&(t.linewidth=this.linewidth),this.dashSize!==void 0&&(t.dashSize=this.dashSize),this.gapSize!==void 0&&(t.gapSize=this.gapSize),this.scale!==void 0&&(t.scale=this.scale),this.dithering===!0&&(t.dithering=!0),this.alphaTest>0&&(t.alphaTest=this.alphaTest),this.alphaToCoverage===!0&&(t.alphaToCoverage=this.alphaToCoverage),this.premultipliedAlpha===!0&&(t.premultipliedAlpha=this.premultipliedAlpha),this.wireframe===!0&&(t.wireframe=this.wireframe),this.wireframeLinewidth>1&&(t.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(t.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(t.wireframeLinejoin=this.wireframeLinejoin),this.morphTargets===!0&&(t.morphTargets=!0),this.morphNormals===!0&&(t.morphNormals=!0),this.skinning===!0&&(t.skinning=!0),this.flatShading===!0&&(t.flatShading=this.flatShading),this.visible===!1&&(t.visible=!1),this.toneMapped===!1&&(t.toneMapped=!1),JSON.stringify(this.userData)!=="{}"&&(t.userData=this.userData);function n(i){let r=[];for(let s in i){let a=i[s];delete a.metadata,r.push(a)}return r}if(e){let i=n(o.textures),r=n(o.images);i.length>0&&(t.textures=i),r.length>0&&(t.images=r)}return t},clone:function(){return new this.constructor().copy(this)},copy:function(o){this.name=o.name,this.fog=o.fog,this.blending=o.blending,this.side=o.side,this.vertexColors=o.vertexColors,this.opacity=o.opacity,this.transparent=o.transparent,this.blendSrc=o.blendSrc,this.blendDst=o.blendDst,this.blendEquation=o.blendEquation,this.blendSrcAlpha=o.blendSrcAlpha,this.blendDstAlpha=o.blendDstAlpha,this.blendEquationAlpha=o.blendEquationAlpha,this.depthFunc=o.depthFunc,this.depthTest=o.depthTest,this.depthWrite=o.depthWrite,this.stencilWriteMask=o.stencilWriteMask,this.stencilFunc=o.stencilFunc,this.stencilRef=o.stencilRef,this.stencilFuncMask=o.stencilFuncMask,this.stencilFail=o.stencilFail,this.stencilZFail=o.stencilZFail,this.stencilZPass=o.stencilZPass,this.stencilWrite=o.stencilWrite;let e=o.clippingPlanes,t=null;if(e!==null){let n=e.length;t=new Array(n);for(let i=0;i!==n;++i)t[i]=e[i].clone()}return this.clippingPlanes=t,this.clipIntersection=o.clipIntersection,this.clipShadows=o.clipShadows,this.shadowSide=o.shadowSide,this.colorWrite=o.colorWrite,this.precision=o.precision,this.polygonOffset=o.polygonOffset,this.polygonOffsetFactor=o.polygonOffsetFactor,this.polygonOffsetUnits=o.polygonOffsetUnits,this.dithering=o.dithering,this.alphaTest=o.alphaTest,this.alphaToCoverage=o.alphaToCoverage,this.premultipliedAlpha=o.premultipliedAlpha,this.visible=o.visible,this.toneMapped=o.toneMapped,this.userData=JSON.parse(JSON.stringify(o.userData)),this},dispose:function(){this.dispatchEvent({type:"dispose"})}});Object.defineProperty(bn.prototype,"needsUpdate",{set:function(o){o===!0&&this.version++}});var pD={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},rs={h:0,s:0,l:0},Tv={h:0,s:0,l:0};function H1(o,e,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?o+(e-o)*6*t:t<1/2?e:t<2/3?o+(e-o)*6*(2/3-t):o}function G1(o){return o<.04045?o*.0773993808:Math.pow(o*.9478672986+.0521327014,2.4)}function V1(o){return o<.0031308?o*12.92:1.055*Math.pow(o,.41666)-.055}var qe=class{constructor(e,t,n){return t===void 0&&n===void 0?this.set(e):this.setRGB(e,t,n)}set(e){return e&&e.isColor?this.copy(e):typeof e=="number"?this.setHex(e):typeof e=="string"&&this.setStyle(e),this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(e&255)/255,this}setRGB(e,t,n){return this.r=e,this.g=t,this.b=n,this}setHSL(e,t,n){if(e=T1(e,1),t=Ci(t,0,1),n=Ci(n,0,1),t===0)this.r=this.g=this.b=n;else{let i=n<=.5?n*(1+t):n+t-n*t,r=2*n-i;this.r=H1(r,i,e+1/3),this.g=H1(r,i,e),this.b=H1(r,i,e-1/3)}return this}setStyle(e){function t(i){i!==void 0&&parseFloat(i)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let n;if(n=/^((?:rgb|hsl)a?)\(([^\)]*)\)/.exec(e)){let i,r=n[1],s=n[2];switch(r){case"rgb":case"rgba":if(i=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(s))return this.r=Math.min(255,parseInt(i[1],10))/255,this.g=Math.min(255,parseInt(i[2],10))/255,this.b=Math.min(255,parseInt(i[3],10))/255,t(i[4]),this;if(i=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(s))return this.r=Math.min(100,parseInt(i[1],10))/100,this.g=Math.min(100,parseInt(i[2],10))/100,this.b=Math.min(100,parseInt(i[3],10))/100,t(i[4]),this;break;case"hsl":case"hsla":if(i=/^\s*(\d*\.?\d+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(s)){let a=parseFloat(i[1])/360,l=parseInt(i[2],10)/100,c=parseInt(i[3],10)/100;return t(i[4]),this.setHSL(a,l,c)}break}}else if(n=/^\#([A-Fa-f\d]+)$/.exec(e)){let i=n[1],r=i.length;if(r===3)return this.r=parseInt(i.charAt(0)+i.charAt(0),16)/255,this.g=parseInt(i.charAt(1)+i.charAt(1),16)/255,this.b=parseInt(i.charAt(2)+i.charAt(2),16)/255,this;if(r===6)return this.r=parseInt(i.charAt(0)+i.charAt(1),16)/255,this.g=parseInt(i.charAt(2)+i.charAt(3),16)/255,this.b=parseInt(i.charAt(4)+i.charAt(5),16)/255,this}return e&&e.length>0?this.setColorName(e):this}setColorName(e){let t=pD[e.toLowerCase()];return t!==void 0?this.setHex(t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copyGammaToLinear(e,t=2){return this.r=Math.pow(e.r,t),this.g=Math.pow(e.g,t),this.b=Math.pow(e.b,t),this}copyLinearToGamma(e,t=2){let n=t>0?1/t:1;return this.r=Math.pow(e.r,n),this.g=Math.pow(e.g,n),this.b=Math.pow(e.b,n),this}convertGammaToLinear(e){return this.copyGammaToLinear(this,e),this}convertLinearToGamma(e){return this.copyLinearToGamma(this,e),this}copySRGBToLinear(e){return this.r=G1(e.r),this.g=G1(e.g),this.b=G1(e.b),this}copyLinearToSRGB(e){return this.r=V1(e.r),this.g=V1(e.g),this.b=V1(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(){return this.r*255<<16^this.g*255<<8^this.b*255<<0}getHexString(){return("000000"+this.getHex().toString(16)).slice(-6)}getHSL(e){e===void 0&&(console.warn("THREE.Color: .getHSL() target is now required"),e={h:0,s:0,l:0});let t=this.r,n=this.g,i=this.b,r=Math.max(t,n,i),s=Math.min(t,n,i),a,l,c=(s+r)/2;if(s===r)a=0,l=0;else{let u=r-s;switch(l=c<=.5?u/(r+s):u/(2-r-s),r){case t:a=(n-i)/u+(n<i?6:0);break;case n:a=(i-t)/u+2;break;case i:a=(t-n)/u+4;break}a/=6}return e.h=a,e.s=l,e.l=c,e}getStyle(){return"rgb("+(this.r*255|0)+","+(this.g*255|0)+","+(this.b*255|0)+")"}offsetHSL(e,t,n){return this.getHSL(rs),rs.h+=e,rs.s+=t,rs.l+=n,this.setHSL(rs.h,rs.s,rs.l),this}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,n){return this.r=e.r+(t.r-e.r)*n,this.g=e.g+(t.g-e.g)*n,this.b=e.b+(t.b-e.b)*n,this}lerpHSL(e,t){this.getHSL(rs),e.getHSL(Tv);let n=Jp(rs.h,Tv.h,t),i=Jp(rs.s,Tv.s,t),r=Jp(rs.l,Tv.l,t);return this.setHSL(n,i,r),this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),e.normalized===!0&&(this.r/=255,this.g/=255,this.b/=255),this}toJSON(){return this.getHex()}};qe.NAMES=pD;qe.prototype.isColor=!0;qe.prototype.r=1;qe.prototype.g=1;qe.prototype.b=1;var Fs=class extends bn{constructor(e){super();this.type="MeshBasicMaterial",this.color=new qe(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=cv,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this}};Fs.prototype.isMeshBasicMaterial=!0;var qt=new ae,Ev=new Oe,jt=class{constructor(e,t,n){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.name="",this.array=e,this.itemSize=t,this.count=e!==void 0?e.length/t:0,this.normalized=n===!0,this.usage=jp,this.updateRange={offset:0,count:-1},this.version=0,this.onUploadCallback=function(){}}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this}copyAt(e,t,n){e*=this.itemSize,n*=t.itemSize;for(let i=0,r=this.itemSize;i<r;i++)this.array[e+i]=t.array[n+i];return this}copyArray(e){return this.array.set(e),this}copyColorsArray(e){let t=this.array,n=0;for(let i=0,r=e.length;i<r;i++){let s=e[i];s===void 0&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",i),s=new qe),t[n++]=s.r,t[n++]=s.g,t[n++]=s.b}return this}copyVector2sArray(e){let t=this.array,n=0;for(let i=0,r=e.length;i<r;i++){let s=e[i];s===void 0&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",i),s=new Oe),t[n++]=s.x,t[n++]=s.y}return this}copyVector3sArray(e){let t=this.array,n=0;for(let i=0,r=e.length;i<r;i++){let s=e[i];s===void 0&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",i),s=new ae),t[n++]=s.x,t[n++]=s.y,t[n++]=s.z}return this}copyVector4sArray(e){let t=this.array,n=0;for(let i=0,r=e.length;i<r;i++){let s=e[i];s===void 0&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",i),s=new Dt),t[n++]=s.x,t[n++]=s.y,t[n++]=s.z,t[n++]=s.w}return this}applyMatrix3(e){if(this.itemSize===2)for(let t=0,n=this.count;t<n;t++)Ev.fromBufferAttribute(this,t),Ev.applyMatrix3(e),this.setXY(t,Ev.x,Ev.y);else if(this.itemSize===3)for(let t=0,n=this.count;t<n;t++)qt.fromBufferAttribute(this,t),qt.applyMatrix3(e),this.setXYZ(t,qt.x,qt.y,qt.z);return this}applyMatrix4(e){for(let t=0,n=this.count;t<n;t++)qt.x=this.getX(t),qt.y=this.getY(t),qt.z=this.getZ(t),qt.applyMatrix4(e),this.setXYZ(t,qt.x,qt.y,qt.z);return this}applyNormalMatrix(e){for(let t=0,n=this.count;t<n;t++)qt.x=this.getX(t),qt.y=this.getY(t),qt.z=this.getZ(t),qt.applyNormalMatrix(e),this.setXYZ(t,qt.x,qt.y,qt.z);return this}transformDirection(e){for(let t=0,n=this.count;t<n;t++)qt.x=this.getX(t),qt.y=this.getY(t),qt.z=this.getZ(t),qt.transformDirection(e),this.setXYZ(t,qt.x,qt.y,qt.z);return this}set(e,t=0){return this.array.set(e,t),this}getX(e){return this.array[e*this.itemSize]}setX(e,t){return this.array[e*this.itemSize]=t,this}getY(e){return this.array[e*this.itemSize+1]}setY(e,t){return this.array[e*this.itemSize+1]=t,this}getZ(e){return this.array[e*this.itemSize+2]}setZ(e,t){return this.array[e*this.itemSize+2]=t,this}getW(e){return this.array[e*this.itemSize+3]}setW(e,t){return this.array[e*this.itemSize+3]=t,this}setXY(e,t,n){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=n,this}setXYZ(e,t,n,i){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=i,this}setXYZW(e,t,n,i,r){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=i,this.array[e+3]=r,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){let e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.prototype.slice.call(this.array),normalized:this.normalized};return this.name!==""&&(e.name=this.name),this.usage!==jp&&(e.usage=this.usage),(this.updateRange.offset!==0||this.updateRange.count!==-1)&&(e.updateRange=this.updateRange),e}};jt.prototype.isBufferAttribute=!0;var W1=class extends jt{constructor(e,t,n){super(new Uint16Array(e),t,n)}};var X1=class extends jt{constructor(e,t,n){super(new Uint32Array(e),t,n)}},mD=class extends jt{constructor(e,t,n){super(new Uint16Array(e),t,n)}};mD.prototype.isFloat16BufferAttribute=!0;var fn=class extends jt{constructor(e,t,n){super(new Float32Array(e),t,n)}};function gD(o){if(o.length===0)return-1/0;let e=o[0];for(let t=1,n=o.length;t<n;++t)o[t]>e&&(e=o[t]);return e}var lY=0,Bs=new Ze,q1=new ot,cd=new ae,rr=new Li,em=new Li,Gn=new ae,Et=class extends Va{constructor(){super();Object.defineProperty(this,"id",{value:lY++}),this.uuid=nr(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(gD(e)>65535?X1:W1)(e,1):this.index=e,this}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return this.attributes[e]!==void 0}addGroup(e,t,n=0){this.groups.push({start:e,count:t,materialIndex:n})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){let t=this.attributes.position;t!==void 0&&(t.applyMatrix4(e),t.needsUpdate=!0);let n=this.attributes.normal;if(n!==void 0){let r=new Un().getNormalMatrix(e);n.applyNormalMatrix(r),n.needsUpdate=!0}let i=this.attributes.tangent;return i!==void 0&&(i.transformDirection(e),i.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}rotateX(e){return Bs.makeRotationX(e),this.applyMatrix4(Bs),this}rotateY(e){return Bs.makeRotationY(e),this.applyMatrix4(Bs),this}rotateZ(e){return Bs.makeRotationZ(e),this.applyMatrix4(Bs),this}translate(e,t,n){return Bs.makeTranslation(e,t,n),this.applyMatrix4(Bs),this}scale(e,t,n){return Bs.makeScale(e,t,n),this.applyMatrix4(Bs),this}lookAt(e){return q1.lookAt(e),q1.updateMatrix(),this.applyMatrix4(q1.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(cd).negate(),this.translate(cd.x,cd.y,cd.z),this}setFromPoints(e){let t=[];for(let n=0,i=e.length;n<i;n++){let r=e[n];t.push(r.x,r.y,r.z||0)}return this.setAttribute("position",new fn(t,3)),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Li);let e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingBox.set(new ae(-1/0,-1/0,-1/0),new ae(1/0,1/0,1/0));return}if(e!==void 0){if(this.boundingBox.setFromBufferAttribute(e),t)for(let n=0,i=t.length;n<i;n++){let r=t[n];rr.setFromBufferAttribute(r),this.morphTargetsRelative?(Gn.addVectors(this.boundingBox.min,rr.min),this.boundingBox.expandByPoint(Gn),Gn.addVectors(this.boundingBox.max,rr.max),this.boundingBox.expandByPoint(Gn)):(this.boundingBox.expandByPoint(rr.min),this.boundingBox.expandByPoint(rr.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Po);let e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingSphere.set(new ae,1/0);return}if(e){let n=this.boundingSphere.center;if(rr.setFromBufferAttribute(e),t)for(let r=0,s=t.length;r<s;r++){let a=t[r];em.setFromBufferAttribute(a),this.morphTargetsRelative?(Gn.addVectors(rr.min,em.min),rr.expandByPoint(Gn),Gn.addVectors(rr.max,em.max),rr.expandByPoint(Gn)):(rr.expandByPoint(em.min),rr.expandByPoint(em.max))}rr.getCenter(n);let i=0;for(let r=0,s=e.count;r<s;r++)Gn.fromBufferAttribute(e,r),i=Math.max(i,n.distanceToSquared(Gn));if(t)for(let r=0,s=t.length;r<s;r++){let a=t[r],l=this.morphTargetsRelative;for(let c=0,u=a.count;c<u;c++)Gn.fromBufferAttribute(a,c),l&&(cd.fromBufferAttribute(e,c),Gn.add(cd)),i=Math.max(i,n.distanceToSquared(Gn))}this.boundingSphere.radius=Math.sqrt(i),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeFaceNormals(){}computeTangents(){let e=this.index,t=this.attributes;if(e===null||t.position===void 0||t.normal===void 0||t.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}let n=e.array,i=t.position.array,r=t.normal.array,s=t.uv.array,a=i.length/3;t.tangent===void 0&&this.setAttribute("tangent",new jt(new Float32Array(4*a),4));let l=t.tangent.array,c=[],u=[];for(let A=0;A<a;A++)c[A]=new ae,u[A]=new ae;let d=new ae,h=new ae,f=new ae,p=new Oe,g=new Oe,v=new Oe,y=new ae,m=new ae;function x(A,L,B){d.fromArray(i,A*3),h.fromArray(i,L*3),f.fromArray(i,B*3),p.fromArray(s,A*2),g.fromArray(s,L*2),v.fromArray(s,B*2),h.sub(d),f.sub(d),g.sub(p),v.sub(p);let R=1/(g.x*v.y-v.x*g.y);!isFinite(R)||(y.copy(h).multiplyScalar(v.y).addScaledVector(f,-g.y).multiplyScalar(R),m.copy(f).multiplyScalar(g.x).addScaledVector(h,-v.x).multiplyScalar(R),c[A].add(y),c[L].add(y),c[B].add(y),u[A].add(m),u[L].add(m),u[B].add(m))}let _=this.groups;_.length===0&&(_=[{start:0,count:n.length}]);for(let A=0,L=_.length;A<L;++A){let B=_[A],R=B.start,D=B.count;for(let P=R,I=R+D;P<I;P+=3)x(n[P+0],n[P+1],n[P+2])}let w=new ae,b=new ae,M=new ae,S=new ae;function E(A){M.fromArray(r,A*3),S.copy(M);let L=c[A];w.copy(L),w.sub(M.multiplyScalar(M.dot(L))).normalize(),b.crossVectors(S,L);let R=b.dot(u[A])<0?-1:1;l[A*4]=w.x,l[A*4+1]=w.y,l[A*4+2]=w.z,l[A*4+3]=R}for(let A=0,L=_.length;A<L;++A){let B=_[A],R=B.start,D=B.count;for(let P=R,I=R+D;P<I;P+=3)E(n[P+0]),E(n[P+1]),E(n[P+2])}}computeVertexNormals(){let e=this.index,t=this.getAttribute("position");if(t!==void 0){let n=this.getAttribute("normal");if(n===void 0)n=new jt(new Float32Array(t.count*3),3),this.setAttribute("normal",n);else for(let h=0,f=n.count;h<f;h++)n.setXYZ(h,0,0,0);let i=new ae,r=new ae,s=new ae,a=new ae,l=new ae,c=new ae,u=new ae,d=new ae;if(e)for(let h=0,f=e.count;h<f;h+=3){let p=e.getX(h+0),g=e.getX(h+1),v=e.getX(h+2);i.fromBufferAttribute(t,p),r.fromBufferAttribute(t,g),s.fromBufferAttribute(t,v),u.subVectors(s,r),d.subVectors(i,r),u.cross(d),a.fromBufferAttribute(n,p),l.fromBufferAttribute(n,g),c.fromBufferAttribute(n,v),a.add(u),l.add(u),c.add(u),n.setXYZ(p,a.x,a.y,a.z),n.setXYZ(g,l.x,l.y,l.z),n.setXYZ(v,c.x,c.y,c.z)}else for(let h=0,f=t.count;h<f;h+=3)i.fromBufferAttribute(t,h+0),r.fromBufferAttribute(t,h+1),s.fromBufferAttribute(t,h+2),u.subVectors(s,r),d.subVectors(i,r),u.cross(d),n.setXYZ(h+0,u.x,u.y,u.z),n.setXYZ(h+1,u.x,u.y,u.z),n.setXYZ(h+2,u.x,u.y,u.z);this.normalizeNormals(),n.needsUpdate=!0}}merge(e,t){if(!(e&&e.isBufferGeometry)){console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",e);return}t===void 0&&(t=0,console.warn("THREE.BufferGeometry.merge(): Overwriting original geometry, starting at offset=0. Use BufferGeometryUtils.mergeBufferGeometries() for lossless merge."));let n=this.attributes;for(let i in n){if(e.attributes[i]===void 0)continue;let s=n[i].array,a=e.attributes[i],l=a.array,c=a.itemSize*t,u=Math.min(l.length,s.length-c);for(let d=0,h=c;d<u;d++,h++)s[h]=l[d]}return this}normalizeNormals(){let e=this.attributes.normal;for(let t=0,n=e.count;t<n;t++)Gn.fromBufferAttribute(e,t),Gn.normalize(),e.setXYZ(t,Gn.x,Gn.y,Gn.z)}toNonIndexed(){function e(a,l){let c=a.array,u=a.itemSize,d=a.normalized,h=new c.constructor(l.length*u),f=0,p=0;for(let g=0,v=l.length;g<v;g++){f=l[g]*u;for(let y=0;y<u;y++)h[p++]=c[f++]}return new jt(h,u,d)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;let t=new Et,n=this.index.array,i=this.attributes;for(let a in i){let l=i[a],c=e(l,n);t.setAttribute(a,c)}let r=this.morphAttributes;for(let a in r){let l=[],c=r[a];for(let u=0,d=c.length;u<d;u++){let h=c[u],f=e(h,n);l.push(f)}t.morphAttributes[a]=l}t.morphTargetsRelative=this.morphTargetsRelative;let s=this.groups;for(let a=0,l=s.length;a<l;a++){let c=s[a];t.addGroup(c.start,c.count,c.materialIndex)}return t}toJSON(){let e={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,this.name!==""&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),this.parameters!==void 0){let l=this.parameters;for(let c in l)l[c]!==void 0&&(e[c]=l[c]);return e}e.data={attributes:{}};let t=this.index;t!==null&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});let n=this.attributes;for(let l in n){let c=n[l];e.data.attributes[l]=c.toJSON(e.data)}let i={},r=!1;for(let l in this.morphAttributes){let c=this.morphAttributes[l],u=[];for(let d=0,h=c.length;d<h;d++){let f=c[d];u.push(f.toJSON(e.data))}u.length>0&&(i[l]=u,r=!0)}r&&(e.data.morphAttributes=i,e.data.morphTargetsRelative=this.morphTargetsRelative);let s=this.groups;s.length>0&&(e.data.groups=JSON.parse(JSON.stringify(s)));let a=this.boundingSphere;return a!==null&&(e.data.boundingSphere={center:a.center.toArray(),radius:a.radius}),e}clone(){return new Et().copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;let t={};this.name=e.name;let n=e.index;n!==null&&this.setIndex(n.clone(t));let i=e.attributes;for(let c in i){let u=i[c];this.setAttribute(c,u.clone(t))}let r=e.morphAttributes;for(let c in r){let u=[],d=r[c];for(let h=0,f=d.length;h<f;h++)u.push(d[h].clone(t));this.morphAttributes[c]=u}this.morphTargetsRelative=e.morphTargetsRelative;let s=e.groups;for(let c=0,u=s.length;c<u;c++){let d=s[c];this.addGroup(d.start,d.count,d.materialIndex)}let a=e.boundingBox;a!==null&&(this.boundingBox=a.clone());let l=e.boundingSphere;return l!==null&&(this.boundingSphere=l.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}};Et.prototype.isBufferGeometry=!0;var yD=new Ze,ud=new yc,j1=new Po,Za=new ae,Ja=new ae,Ka=new ae,Y1=new ae,Z1=new ae,J1=new ae,Av=new ae,Cv=new ae,Lv=new ae,Rv=new Oe,Pv=new Oe,Iv=new Oe,K1=new ae,Dv=new ae,Vn=class extends ot{constructor(e=new Et,t=new Fs){super();this.type="Mesh",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e){return super.copy(e),e.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),e.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=e.material,this.geometry=e.geometry,this}updateMorphTargets(){let e=this.geometry;if(e.isBufferGeometry){let t=e.morphAttributes,n=Object.keys(t);if(n.length>0){let i=t[n[0]];if(i!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let r=0,s=i.length;r<s;r++){let a=i[r].name||String(r);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=r}}}}else{let t=e.morphTargets;t!==void 0&&t.length>0&&console.error("THREE.Mesh.updateMorphTargets() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}}raycast(e,t){let n=this.geometry,i=this.material,r=this.matrixWorld;if(i===void 0||(n.boundingSphere===null&&n.computeBoundingSphere(),j1.copy(n.boundingSphere),j1.applyMatrix4(r),e.ray.intersectsSphere(j1)===!1)||(yD.copy(r).invert(),ud.copy(e.ray).applyMatrix4(yD),n.boundingBox!==null&&ud.intersectsBox(n.boundingBox)===!1))return;let s;if(n.isBufferGeometry){let a=n.index,l=n.attributes.position,c=n.morphAttributes.position,u=n.morphTargetsRelative,d=n.attributes.uv,h=n.attributes.uv2,f=n.groups,p=n.drawRange;if(a!==null)if(Array.isArray(i))for(let g=0,v=f.length;g<v;g++){let y=f[g],m=i[y.materialIndex],x=Math.max(y.start,p.start),_=Math.min(y.start+y.count,p.start+p.count);for(let w=x,b=_;w<b;w+=3){let M=a.getX(w),S=a.getX(w+1),E=a.getX(w+2);s=Fv(this,m,e,ud,l,c,u,d,h,M,S,E),s&&(s.faceIndex=Math.floor(w/3),s.face.materialIndex=y.materialIndex,t.push(s))}}else{let g=Math.max(0,p.start),v=Math.min(a.count,p.start+p.count);for(let y=g,m=v;y<m;y+=3){let x=a.getX(y),_=a.getX(y+1),w=a.getX(y+2);s=Fv(this,i,e,ud,l,c,u,d,h,x,_,w),s&&(s.faceIndex=Math.floor(y/3),t.push(s))}}else if(l!==void 0)if(Array.isArray(i))for(let g=0,v=f.length;g<v;g++){let y=f[g],m=i[y.materialIndex],x=Math.max(y.start,p.start),_=Math.min(y.start+y.count,p.start+p.count);for(let w=x,b=_;w<b;w+=3){let M=w,S=w+1,E=w+2;s=Fv(this,m,e,ud,l,c,u,d,h,M,S,E),s&&(s.faceIndex=Math.floor(w/3),s.face.materialIndex=y.materialIndex,t.push(s))}}else{let g=Math.max(0,p.start),v=Math.min(l.count,p.start+p.count);for(let y=g,m=v;y<m;y+=3){let x=y,_=y+1,w=y+2;s=Fv(this,i,e,ud,l,c,u,d,h,x,_,w),s&&(s.faceIndex=Math.floor(y/3),t.push(s))}}}else n.isGeometry&&console.error("THREE.Mesh.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}};Vn.prototype.isMesh=!0;function cY(o,e,t,n,i,r,s,a){let l;if(e.side===zn?l=n.intersectTriangle(s,r,i,!0,a):l=n.intersectTriangle(i,r,s,e.side!==Xh,a),l===null)return null;Dv.copy(a),Dv.applyMatrix4(o.matrixWorld);let c=t.ray.origin.distanceTo(Dv);return c<t.near||c>t.far?null:{distance:c,point:Dv.clone(),object:o}}function Fv(o,e,t,n,i,r,s,a,l,c,u,d){Za.fromBufferAttribute(i,c),Ja.fromBufferAttribute(i,u),Ka.fromBufferAttribute(i,d);let h=o.morphTargetInfluences;if(e.morphTargets&&r&&h){Av.set(0,0,0),Cv.set(0,0,0),Lv.set(0,0,0);for(let p=0,g=r.length;p<g;p++){let v=h[p],y=r[p];v!==0&&(Y1.fromBufferAttribute(y,c),Z1.fromBufferAttribute(y,u),J1.fromBufferAttribute(y,d),s?(Av.addScaledVector(Y1,v),Cv.addScaledVector(Z1,v),Lv.addScaledVector(J1,v)):(Av.addScaledVector(Y1.sub(Za),v),Cv.addScaledVector(Z1.sub(Ja),v),Lv.addScaledVector(J1.sub(Ka),v)))}Za.add(Av),Ja.add(Cv),Ka.add(Lv)}o.isSkinnedMesh&&e.skinning&&(o.boneTransform(c,Za),o.boneTransform(u,Ja),o.boneTransform(d,Ka));let f=cY(o,e,t,n,Za,Ja,Ka,K1);if(f){a&&(Rv.fromBufferAttribute(a,c),Pv.fromBufferAttribute(a,u),Iv.fromBufferAttribute(a,d),f.uv=wn.getUV(K1,Za,Ja,Ka,Rv,Pv,Iv,new Oe)),l&&(Rv.fromBufferAttribute(l,c),Pv.fromBufferAttribute(l,u),Iv.fromBufferAttribute(l,d),f.uv2=wn.getUV(K1,Za,Ja,Ka,Rv,Pv,Iv,new Oe));let p={a:c,b:u,c:d,normal:new ae,materialIndex:0};wn.getNormal(Za,Ja,Ka,p.normal),f.face=p}return f}var Bv=class extends Et{constructor(e=1,t=1,n=1,i=1,r=1,s=1){super();this.type="BoxGeometry",this.parameters={width:e,height:t,depth:n,widthSegments:i,heightSegments:r,depthSegments:s};let a=this;i=Math.floor(i),r=Math.floor(r),s=Math.floor(s);let l=[],c=[],u=[],d=[],h=0,f=0;p("z","y","x",-1,-1,n,t,e,s,r,0),p("z","y","x",1,-1,n,t,-e,s,r,1),p("x","z","y",1,1,e,n,t,i,s,2),p("x","z","y",1,-1,e,n,-t,i,s,3),p("x","y","z",1,-1,e,t,n,i,r,4),p("x","y","z",-1,-1,e,t,-n,i,r,5),this.setIndex(l),this.setAttribute("position",new fn(c,3)),this.setAttribute("normal",new fn(u,3)),this.setAttribute("uv",new fn(d,2));function p(g,v,y,m,x,_,w,b,M,S,E){let A=_/M,L=w/S,B=_/2,R=w/2,D=b/2,P=M+1,I=S+1,N=0,G=0,z=new ae;for(let se=0;se<I;se++){let ne=se*L-R;for(let Q=0;Q<P;Q++){let j=Q*A-B;z[g]=j*m,z[v]=ne*x,z[y]=D,c.push(z.x,z.y,z.z),z[g]=0,z[v]=0,z[y]=b>0?1:-1,u.push(z.x,z.y,z.z),d.push(Q/M),d.push(1-se/S),N+=1}}for(let se=0;se<S;se++)for(let ne=0;ne<M;ne++){let Q=h+ne+P*se,j=h+ne+P*(se+1),O=h+(ne+1)+P*(se+1),ee=h+(ne+1)+P*se;l.push(Q,j,ee),l.push(j,O,ee),G+=6}a.addGroup(f,G,E),f+=G,h+=N}}};function hd(o){let e={};for(let t in o){e[t]={};for(let n in o[t]){let i=o[t][n];i&&(i.isColor||i.isMatrix3||i.isMatrix4||i.isVector2||i.isVector3||i.isVector4||i.isTexture||i.isQuaternion)?e[t][n]=i.clone():Array.isArray(i)?e[t][n]=i.slice():e[t][n]=i}}return e}function gi(o){let e={};for(let t=0;t<o.length;t++){let n=hd(o[t]);for(let i in n)e[i]=n[i]}return e}var uY={clone:hd,merge:gi},hY=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,dY=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`,ss=class extends bn{constructor(e){super();this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader=hY,this.fragmentShader=dY,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,e!==void 0&&(e.attributes!==void 0&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(e))}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=hd(e.uniforms),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.lights=e.lights,this.clipping=e.clipping,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){let t=super.toJSON(e);t.glslVersion=this.glslVersion,t.uniforms={};for(let i in this.uniforms){let s=this.uniforms[i].value;s&&s.isTexture?t.uniforms[i]={type:"t",value:s.toJSON(e).uuid}:s&&s.isColor?t.uniforms[i]={type:"c",value:s.getHex()}:s&&s.isVector2?t.uniforms[i]={type:"v2",value:s.toArray()}:s&&s.isVector3?t.uniforms[i]={type:"v3",value:s.toArray()}:s&&s.isVector4?t.uniforms[i]={type:"v4",value:s.toArray()}:s&&s.isMatrix3?t.uniforms[i]={type:"m3",value:s.toArray()}:s&&s.isMatrix4?t.uniforms[i]={type:"m4",value:s.toArray()}:t.uniforms[i]={value:s}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader;let n={};for(let i in this.extensions)this.extensions[i]===!0&&(n[i]=!0);return Object.keys(n).length>0&&(t.extensions=n),t}};ss.prototype.isShaderMaterial=!0;var Nv=class extends ot{constructor(){super();this.type="Camera",this.matrixWorldInverse=new Ze,this.projectionMatrix=new Ze,this.projectionMatrixInverse=new Ze}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this}getWorldDirection(e){e===void 0&&(console.warn("THREE.Camera: .getWorldDirection() target is now required"),e=new ae),this.updateWorldMatrix(!0,!1);let t=this.matrixWorld.elements;return e.set(-t[8],-t[9],-t[10]).normalize()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}};Nv.prototype.isCamera=!0;var yi=class extends Nv{constructor(e=50,t=1,n=.1,i=2e3){super();this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=n,this.far=i,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=e.view===null?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){let t=.5*this.getFilmHeight()/e;this.fov=Zp*2*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){let e=Math.tan(Yp*.5*this.fov);return .5*this.getFilmHeight()/e}getEffectiveFOV(){return Zp*2*Math.atan(Math.tan(Yp*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(e,t,n,i,r,s){this.aspect=e/t,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=i,this.view.width=r,this.view.height=s,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){let e=this.near,t=e*Math.tan(Yp*.5*this.fov)/this.zoom,n=2*t,i=this.aspect*n,r=-.5*i,s=this.view;if(this.view!==null&&this.view.enabled){let l=s.fullWidth,c=s.fullHeight;r+=s.offsetX*i/l,t-=s.offsetY*n/c,i*=s.width/l,n*=s.height/c}let a=this.filmOffset;a!==0&&(r+=e*a/this.getFilmWidth()),this.projectionMatrix.makePerspective(r,r+i,t,t-n,e,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){let t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,this.view!==null&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}};yi.prototype.isPerspectiveCamera=!0;var dd=90,fd=1,Ov=class extends ot{constructor(e,t,n){super();if(this.type="CubeCamera",n.isWebGLCubeRenderTarget!==!0){console.error("THREE.CubeCamera: The constructor now expects an instance of WebGLCubeRenderTarget as third parameter.");return}this.renderTarget=n;let i=new yi(dd,fd,e,t);i.layers=this.layers,i.up.set(0,-1,0),i.lookAt(new ae(1,0,0)),this.add(i);let r=new yi(dd,fd,e,t);r.layers=this.layers,r.up.set(0,-1,0),r.lookAt(new ae(-1,0,0)),this.add(r);let s=new yi(dd,fd,e,t);s.layers=this.layers,s.up.set(0,0,1),s.lookAt(new ae(0,1,0)),this.add(s);let a=new yi(dd,fd,e,t);a.layers=this.layers,a.up.set(0,0,-1),a.lookAt(new ae(0,-1,0)),this.add(a);let l=new yi(dd,fd,e,t);l.layers=this.layers,l.up.set(0,-1,0),l.lookAt(new ae(0,0,1)),this.add(l);let c=new yi(dd,fd,e,t);c.layers=this.layers,c.up.set(0,-1,0),c.lookAt(new ae(0,0,-1)),this.add(c)}update(e,t){this.parent===null&&this.updateMatrixWorld();let n=this.renderTarget,[i,r,s,a,l,c]=this.children,u=e.xr.enabled,d=e.getRenderTarget();e.xr.enabled=!1;let h=n.texture.generateMipmaps;n.texture.generateMipmaps=!1,e.setRenderTarget(n,0),e.render(t,i),e.setRenderTarget(n,1),e.render(t,r),e.setRenderTarget(n,2),e.render(t,s),e.setRenderTarget(n,3),e.render(t,a),e.setRenderTarget(n,4),e.render(t,l),n.texture.generateMipmaps=h,e.setRenderTarget(n,5),e.render(t,c),e.setRenderTarget(d),e.xr.enabled=u}},tm=class extends Hn{constructor(e,t,n,i,r,s,a,l,c,u){e=e!==void 0?e:[],t=t!==void 0?t:m1,a=a!==void 0?a:Lo;super(e,t,n,i,r,s,a,l,c,u);this._needsFlipEnvMap=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}};tm.prototype.isCubeTexture=!0;var $1=class extends Wa{constructor(e,t,n){Number.isInteger(t)&&(console.warn("THREE.WebGLCubeRenderTarget: constructor signature is now WebGLCubeRenderTarget( size, options )"),t=n);super(e,e,t);t=t||{},this.texture=new tm(void 0,t.mapping,t.wrapS,t.wrapT,t.magFilter,t.minFilter,t.format,t.type,t.anisotropy,t.encoding),this.texture.generateMipmaps=t.generateMipmaps!==void 0?t.generateMipmaps:!1,this.texture.minFilter=t.minFilter!==void 0?t.minFilter:Ai,this.texture._needsFlipEnvMap=!1}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.format=ts,this.texture.encoding=t.encoding,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;let n={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},i=new Bv(5,5,5),r=new ss({name:"CubemapFromEquirect",uniforms:hd(n.uniforms),vertexShader:n.vertexShader,fragmentShader:n.fragmentShader,side:zn,blending:Hp});r.uniforms.tEquirect.value=t;let s=new Vn(i,r),a=t.minFilter;return t.minFilter===jh&&(t.minFilter=Ai),new Ov(1,10,this).update(e,s),t.minFilter=a,s.geometry.dispose(),s.material.dispose(),this}clear(e,t,n,i){let r=e.getRenderTarget();for(let s=0;s<6;s++)e.setRenderTarget(this,s),e.clear(t,n,i);e.setRenderTarget(r)}};$1.prototype.isWebGLCubeRenderTarget=!0;var Q1=class extends Hn{constructor(e,t,n,i,r,s,a,l,c,u,d,h){super(null,s,a,l,c,u,i,r,d,h);this.image={data:e||null,width:t||1,height:n||1},this.magFilter=c!==void 0?c:Qn,this.minFilter=u!==void 0?u:Qn,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.needsUpdate=!0}};Q1.prototype.isDataTexture=!0;var pd=new Po,kv=new ae,nm=class{constructor(e=new mi,t=new mi,n=new mi,i=new mi,r=new mi,s=new mi){this.planes=[e,t,n,i,r,s]}set(e,t,n,i,r,s){let a=this.planes;return a[0].copy(e),a[1].copy(t),a[2].copy(n),a[3].copy(i),a[4].copy(r),a[5].copy(s),this}copy(e){let t=this.planes;for(let n=0;n<6;n++)t[n].copy(e.planes[n]);return this}setFromProjectionMatrix(e){let t=this.planes,n=e.elements,i=n[0],r=n[1],s=n[2],a=n[3],l=n[4],c=n[5],u=n[6],d=n[7],h=n[8],f=n[9],p=n[10],g=n[11],v=n[12],y=n[13],m=n[14],x=n[15];return t[0].setComponents(a-i,d-l,g-h,x-v).normalize(),t[1].setComponents(a+i,d+l,g+h,x+v).normalize(),t[2].setComponents(a+r,d+c,g+f,x+y).normalize(),t[3].setComponents(a-r,d-c,g-f,x-y).normalize(),t[4].setComponents(a-s,d-u,g-p,x-m).normalize(),t[5].setComponents(a+s,d+u,g+p,x+m).normalize(),this}intersectsObject(e){let t=e.geometry;return t.boundingSphere===null&&t.computeBoundingSphere(),pd.copy(t.boundingSphere).applyMatrix4(e.matrixWorld),this.intersectsSphere(pd)}intersectsSprite(e){return pd.center.set(0,0,0),pd.radius=.7071067811865476,pd.applyMatrix4(e.matrixWorld),this.intersectsSphere(pd)}intersectsSphere(e){let t=this.planes,n=e.center,i=-e.radius;for(let r=0;r<6;r++)if(t[r].distanceToPoint(n)<i)return!1;return!0}intersectsBox(e){let t=this.planes;for(let n=0;n<6;n++){let i=t[n];if(kv.x=i.normal.x>0?e.max.x:e.min.x,kv.y=i.normal.y>0?e.max.y:e.min.y,kv.z=i.normal.z>0?e.max.z:e.min.z,i.distanceToPoint(kv)<0)return!1}return!0}containsPoint(e){let t=this.planes;for(let n=0;n<6;n++)if(t[n].distanceToPoint(e)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}};function vD(){let o=null,e=!1,t=null,n=null;function i(r,s){t(r,s),n=o.requestAnimationFrame(i)}return{start:function(){e!==!0&&t!==null&&(n=o.requestAnimationFrame(i),e=!0)},stop:function(){o.cancelAnimationFrame(n),e=!1},setAnimationLoop:function(r){t=r},setContext:function(r){o=r}}}function fY(o,e){let t=e.isWebGL2,n=new WeakMap;function i(c,u){let d=c.array,h=c.usage,f=o.createBuffer();o.bindBuffer(u,f),o.bufferData(u,d,h),c.onUploadCallback();let p=5126;return d instanceof Float32Array?p=5126:d instanceof Float64Array?console.warn("THREE.WebGLAttributes: Unsupported data buffer format: Float64Array."):d instanceof Uint16Array?c.isFloat16BufferAttribute?t?p=5131:console.warn("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2."):p=5123:d instanceof Int16Array?p=5122:d instanceof Uint32Array?p=5125:d instanceof Int32Array?p=5124:d instanceof Int8Array?p=5120:d instanceof Uint8Array&&(p=5121),{buffer:f,type:p,bytesPerElement:d.BYTES_PER_ELEMENT,version:c.version}}function r(c,u,d){let h=u.array,f=u.updateRange;o.bindBuffer(d,c),f.count===-1?o.bufferSubData(d,0,h):(t?o.bufferSubData(d,f.offset*h.BYTES_PER_ELEMENT,h,f.offset,f.count):o.bufferSubData(d,f.offset*h.BYTES_PER_ELEMENT,h.subarray(f.offset,f.offset+f.count)),f.count=-1)}function s(c){return c.isInterleavedBufferAttribute&&(c=c.data),n.get(c)}function a(c){c.isInterleavedBufferAttribute&&(c=c.data);let u=n.get(c);u&&(o.deleteBuffer(u.buffer),n.delete(c))}function l(c,u){if(c.isGLBufferAttribute){let h=n.get(c);(!h||h.version<c.version)&&n.set(c,{buffer:c.buffer,type:c.type,bytesPerElement:c.elementSize,version:c.version});return}c.isInterleavedBufferAttribute&&(c=c.data);let d=n.get(c);d===void 0?n.set(c,i(c,u)):d.version<c.version&&(r(d.buffer,c,u),d.version=c.version)}return{get:s,remove:a,update:l}}var md=class extends Et{constructor(e=1,t=1,n=1,i=1){super();this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:n,heightSegments:i};let r=e/2,s=t/2,a=Math.floor(n),l=Math.floor(i),c=a+1,u=l+1,d=e/a,h=t/l,f=[],p=[],g=[],v=[];for(let y=0;y<u;y++){let m=y*h-s;for(let x=0;x<c;x++){let _=x*d-r;p.push(_,-m,0),g.push(0,0,1),v.push(x/a),v.push(1-y/l)}}for(let y=0;y<l;y++)for(let m=0;m<a;m++){let x=m+c*y,_=m+c*(y+1),w=m+1+c*(y+1),b=m+1+c*y;f.push(x,_,b),f.push(_,w,b)}this.setIndex(f),this.setAttribute("position",new fn(p,3)),this.setAttribute("normal",new fn(g,3)),this.setAttribute("uv",new fn(v,2))}},pY=`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vUv ).g;
#endif`,mY=`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,gY=`#ifdef ALPHATEST
	if ( diffuseColor.a < ALPHATEST ) discard;
#endif`,yY=`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.specularRoughness );
	#endif
#endif`,vY=`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,xY="vec3 transformed = vec3( position );",_Y=`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,wY=`vec2 integrateSpecularBRDF( const in float dotNV, const in float roughness ) {
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	return vec2( -1.04, 1.04 ) * a004 + r.zw;
}
float punctualLightIntensityToIrradianceFactor( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
#if defined ( PHYSICALLY_CORRECT_LIGHTS )
	float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
	if( cutoffDistance > 0.0 ) {
		distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
	}
	return distanceFalloff;
#else
	if( cutoffDistance > 0.0 && decayExponent > 0.0 ) {
		return pow( saturate( -lightDistance / cutoffDistance + 1.0 ), decayExponent );
	}
	return 1.0;
#endif
}
vec3 BRDF_Diffuse_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 specularColor, const in float dotLH ) {
	float fresnel = exp2( ( -5.55473 * dotLH - 6.98316 ) * dotLH );
	return ( 1.0 - specularColor ) * fresnel + specularColor;
}
vec3 F_Schlick_RoughnessDependent( const in vec3 F0, const in float dotNV, const in float roughness ) {
	float fresnel = exp2( ( -5.55473 * dotNV - 6.98316 ) * dotNV );
	vec3 Fr = max( vec3( 1.0 - roughness ), F0 ) - F0;
	return Fr * fresnel + F0;
}
float G_GGX_Smith( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gl = dotNL + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	float gv = dotNV + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	return 1.0 / ( gl * gv );
}
float G_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
vec3 BRDF_Specular_GGX( const in IncidentLight incidentLight, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float roughness ) {
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( incidentLight.direction + viewDir );
	float dotNL = saturate( dot( normal, incidentLight.direction ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotLH = saturate( dot( incidentLight.direction, halfDir ) );
	vec3 F = F_Schlick( specularColor, dotLH );
	float G = G_GGX_SmithCorrelated( alpha, dotNL, dotNV );
	float D = D_GGX( alpha, dotNH );
	return F * ( G * D );
}
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
vec3 BRDF_Specular_GGX_Environment( const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	vec2 brdf = integrateSpecularBRDF( dotNV, roughness );
	return specularColor * brdf.x + brdf.y;
}
void BRDF_Specular_Multiscattering_Environment( const in GeometricContext geometry, const in vec3 specularColor, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
	float dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );
	vec3 F = F_Schlick_RoughnessDependent( specularColor, dotNV, roughness );
	vec2 brdf = integrateSpecularBRDF( dotNV, roughness );
	vec3 FssEss = F * brdf.x + brdf.y;
	float Ess = brdf.x + brdf.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = specularColor + ( 1.0 - specularColor ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_Specular_BlinnPhong( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );
	float dotNH = saturate( dot( geometry.normal, halfDir ) );
	float dotLH = saturate( dot( incidentLight.direction, halfDir ) );
	vec3 F = F_Schlick( specularColor, dotLH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
}
float GGXRoughnessToBlinnExponent( const in float ggxRoughness ) {
	return ( 2.0 / pow2( ggxRoughness + 0.0001 ) - 2.0 );
}
float BlinnExponentToGGXRoughness( const in float blinnExponent ) {
	return sqrt( 2.0 / ( blinnExponent + 2.0 ) );
}
#if defined( USE_SHEEN )
float D_Charlie(float roughness, float NoH) {
	float invAlpha = 1.0 / roughness;
	float cos2h = NoH * NoH;
	float sin2h = max(1.0 - cos2h, 0.0078125);	return (2.0 + invAlpha) * pow(sin2h, invAlpha * 0.5) / (2.0 * PI);
}
float V_Neubelt(float NoV, float NoL) {
	return saturate(1.0 / (4.0 * (NoL + NoV - NoL * NoV)));
}
vec3 BRDF_Specular_Sheen( const in float roughness, const in vec3 L, const in GeometricContext geometry, vec3 specularColor ) {
	vec3 N = geometry.normal;
	vec3 V = geometry.viewDir;
	vec3 H = normalize( V + L );
	float dotNH = saturate( dot( N, H ) );
	return specularColor * D_Charlie( roughness, dotNH ) * V_Neubelt( dot(N, V), dot(N, L) );
}
#endif`,bY=`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vUv );
		vec2 dSTdy = dFdy( vUv );
		float Hll = bumpScale * texture2D( bumpMap, vUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );
		vec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,MY=`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#pragma unroll_loop_start
	for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
		plane = clippingPlanes[ i ];
		if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
	}
	#pragma unroll_loop_end
	#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
		bool clipped = true;
		#pragma unroll_loop_start
		for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
		}
		#pragma unroll_loop_end
		if ( clipped ) discard;
	#endif
#endif`,SY=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,TY=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,EY=`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,AY=`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,CY=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,LY=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	varying vec3 vColor;
#endif`,RY=`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif`,PY=`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate(a) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement(a) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract(sin(sn) * c);
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float max3( vec3 v ) { return max( max( v.x, v.y ), v.z ); }
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
struct GeometricContext {
	vec3 position;
	vec3 normal;
	vec3 viewDir;
#ifdef CLEARCOAT
	vec3 clearcoatNormal;
#endif
};
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
vec3 projectOnPlane(in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {
	float distance = dot( planeNormal, point - pointOnPlane );
	return - distance * planeNormal + point;
}
float sideOfPlane( in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {
	return sign( dot( point - pointOnPlane, planeNormal ) );
}
vec3 linePlaneIntersect( in vec3 pointOnLine, in vec3 lineDirection, in vec3 pointOnPlane, in vec3 planeNormal ) {
	return lineDirection * ( dot( planeNormal, pointOnPlane - pointOnLine ) / dot( planeNormal, lineDirection ) ) + pointOnLine;
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
float linearToRelativeLuminance( const in vec3 color ) {
	vec3 weights = vec3( 0.2126, 0.7152, 0.0722 );
	return dot( weights, color.rgb );
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}`,IY=`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_maxMipLevel 8.0
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_maxTileSize 256.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		float texelSize = 1.0 / ( 3.0 * cubeUV_maxTileSize );
		vec2 uv = getUV( direction, face ) * ( faceSize - 1.0 );
		vec2 f = fract( uv );
		uv += 0.5 - f;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		if ( mipInt < cubeUV_maxMipLevel ) {
			uv.y += 2.0 * cubeUV_maxTileSize;
		}
		uv.y += filterInt * 2.0 * cubeUV_minTileSize;
		uv.x += 3.0 * max( 0.0, cubeUV_maxTileSize - 2.0 * faceSize );
		uv *= texelSize;
		vec3 tl = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;
		uv.x += texelSize;
		vec3 tr = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;
		uv.y += texelSize;
		vec3 br = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;
		uv.x -= texelSize;
		vec3 bl = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;
		vec3 tm = mix( tl, tr, f.x );
		vec3 bm = mix( bl, br, f.x );
		return mix( tm, bm, f.y );
	}
	#define r0 1.0
	#define v0 0.339
	#define m0 - 2.0
	#define r1 0.8
	#define v1 0.276
	#define m1 - 1.0
	#define r4 0.4
	#define v4 0.046
	#define m4 2.0
	#define r5 0.305
	#define v5 0.016
	#define m5 3.0
	#define r6 0.21
	#define v6 0.0038
	#define m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= r1 ) {
			mip = ( r0 - roughness ) * ( m1 - m0 ) / ( r0 - r1 ) + m0;
		} else if ( roughness >= r4 ) {
			mip = ( r1 - roughness ) * ( m4 - m1 ) / ( r1 - r4 ) + m1;
		} else if ( roughness >= r5 ) {
			mip = ( r4 - roughness ) * ( m5 - m4 ) / ( r4 - r5 ) + m4;
		} else if ( roughness >= r6 ) {
			mip = ( r5 - roughness ) * ( m6 - m5 ) / ( r5 - r6 ) + m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), m0, cubeUV_maxMipLevel );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,DY=`vec3 transformedNormal = objectNormal;
#ifdef USE_INSTANCING
	mat3 m = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );
	transformedNormal = m * transformedNormal;
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	vec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,FY=`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,BY=`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );
#endif`,NY=`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vUv );
	emissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,OY=`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,kY="gl_FragColor = linearToOutputTexel( gl_FragColor );",zY=`
vec4 LinearToLinear( in vec4 value ) {
	return value;
}
vec4 GammaToLinear( in vec4 value, in float gammaFactor ) {
	return vec4( pow( value.rgb, vec3( gammaFactor ) ), value.a );
}
vec4 LinearToGamma( in vec4 value, in float gammaFactor ) {
	return vec4( pow( value.rgb, vec3( 1.0 / gammaFactor ) ), value.a );
}
vec4 sRGBToLinear( in vec4 value ) {
	return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );
}
vec4 LinearTosRGB( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}
vec4 RGBEToLinear( in vec4 value ) {
	return vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );
}
vec4 LinearToRGBE( in vec4 value ) {
	float maxComponent = max( max( value.r, value.g ), value.b );
	float fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );
	return vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );
}
vec4 RGBMToLinear( in vec4 value, in float maxRange ) {
	return vec4( value.rgb * value.a * maxRange, 1.0 );
}
vec4 LinearToRGBM( in vec4 value, in float maxRange ) {
	float maxRGB = max( value.r, max( value.g, value.b ) );
	float M = clamp( maxRGB / maxRange, 0.0, 1.0 );
	M = ceil( M * 255.0 ) / 255.0;
	return vec4( value.rgb / ( M * maxRange ), M );
}
vec4 RGBDToLinear( in vec4 value, in float maxRange ) {
	return vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );
}
vec4 LinearToRGBD( in vec4 value, in float maxRange ) {
	float maxRGB = max( value.r, max( value.g, value.b ) );
	float D = max( maxRange / maxRGB, 1.0 );
	D = clamp( floor( D ) / 255.0, 0.0, 1.0 );
	return vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );
}
const mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );
vec4 LinearToLogLuv( in vec4 value ) {
	vec3 Xp_Y_XYZp = cLogLuvM * value.rgb;
	Xp_Y_XYZp = max( Xp_Y_XYZp, vec3( 1e-6, 1e-6, 1e-6 ) );
	vec4 vResult;
	vResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;
	float Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;
	vResult.w = fract( Le );
	vResult.z = ( Le - ( floor( vResult.w * 255.0 ) ) / 255.0 ) / 255.0;
	return vResult;
}
const mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );
vec4 LogLuvToLinear( in vec4 value ) {
	float Le = value.z * 255.0 + value.w;
	vec3 Xp_Y_XYZp;
	Xp_Y_XYZp.y = exp2( ( Le - 127.0 ) / 2.0 );
	Xp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;
	Xp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;
	vec3 vRGB = cLogLuvInverseM * Xp_Y_XYZp.rgb;
	return vec4( max( vRGB, 0.0 ), 1.0 );
}`,UY=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 envColor = textureCubeUV( envMap, reflectVec, 0.0 );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifndef ENVMAP_TYPE_CUBE_UV
		envColor = envMapTexelToLinear( envColor );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,HY=`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	uniform int maxMipLevel;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
	
#endif`,GY=`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,VY=`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) ||defined( PHONG )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,WY=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,XY=`#ifdef USE_FOG
	fogDepth = - mvPosition.z;
#endif`,qY=`#ifdef USE_FOG
	varying float fogDepth;
#endif`,jY=`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * fogDepth * fogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, fogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,YY=`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float fogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,ZY=`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return texture2D( gradientMap, coord ).rgb;
	#else
		return ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );
	#endif
}`,JY=`#ifdef USE_LIGHTMAP
	vec4 lightMapTexel= texture2D( lightMap, vUv2 );
	reflectedLight.indirectDiffuse += PI * lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;
#endif`,KY=`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,$Y=`vec3 diffuse = vec3( 1.0 );
GeometricContext geometry;
geometry.position = mvPosition.xyz;
geometry.normal = normalize( transformedNormal );
geometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( -mvPosition.xyz );
GeometricContext backGeometry;
backGeometry.position = geometry.position;
backGeometry.normal = -geometry.normal;
backGeometry.viewDir = geometry.viewDir;
vLightFront = vec3( 0.0 );
vIndirectFront = vec3( 0.0 );
#ifdef DOUBLE_SIDED
	vLightBack = vec3( 0.0 );
	vIndirectBack = vec3( 0.0 );
#endif
IncidentLight directLight;
float dotNL;
vec3 directLightColor_Diffuse;
vIndirectFront += getAmbientLightIrradiance( ambientLightColor );
vIndirectFront += getLightProbeIrradiance( lightProbe, geometry );
#ifdef DOUBLE_SIDED
	vIndirectBack += getAmbientLightIrradiance( ambientLightColor );
	vIndirectBack += getLightProbeIrradiance( lightProbe, backGeometry );
#endif
#if NUM_POINT_LIGHTS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		getPointDirectLightIrradiance( pointLights[ i ], geometry, directLight );
		dotNL = dot( geometry.normal, directLight.direction );
		directLightColor_Diffuse = PI * directLight.color;
		vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
		#ifdef DOUBLE_SIDED
			vLightBack += saturate( -dotNL ) * directLightColor_Diffuse;
		#endif
	}
	#pragma unroll_loop_end
#endif
#if NUM_SPOT_LIGHTS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		getSpotDirectLightIrradiance( spotLights[ i ], geometry, directLight );
		dotNL = dot( geometry.normal, directLight.direction );
		directLightColor_Diffuse = PI * directLight.color;
		vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
		#ifdef DOUBLE_SIDED
			vLightBack += saturate( -dotNL ) * directLightColor_Diffuse;
		#endif
	}
	#pragma unroll_loop_end
#endif
#if NUM_DIR_LIGHTS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		getDirectionalDirectLightIrradiance( directionalLights[ i ], geometry, directLight );
		dotNL = dot( geometry.normal, directLight.direction );
		directLightColor_Diffuse = PI * directLight.color;
		vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
		#ifdef DOUBLE_SIDED
			vLightBack += saturate( -dotNL ) * directLightColor_Diffuse;
		#endif
	}
	#pragma unroll_loop_end
#endif
#if NUM_HEMI_LIGHTS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
		vIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );
		#ifdef DOUBLE_SIDED
			vIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry );
		#endif
	}
	#pragma unroll_loop_end
#endif`,QY=`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
uniform vec3 lightProbe[ 9 ];
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in GeometricContext geometry ) {
	vec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	#ifndef PHYSICALLY_CORRECT_LIGHTS
		irradiance *= PI;
	#endif
	return irradiance;
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalDirectLightIrradiance( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight directLight ) {
		directLight.color = directionalLight.color;
		directLight.direction = directionalLight.direction;
		directLight.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointDirectLightIrradiance( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight directLight ) {
		vec3 lVector = pointLight.position - geometry.position;
		directLight.direction = normalize( lVector );
		float lightDistance = length( lVector );
		directLight.color = pointLight.color;
		directLight.color *= punctualLightIntensityToIrradianceFactor( lightDistance, pointLight.distance, pointLight.decay );
		directLight.visible = ( directLight.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotDirectLightIrradiance( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight directLight ) {
		vec3 lVector = spotLight.position - geometry.position;
		directLight.direction = normalize( lVector );
		float lightDistance = length( lVector );
		float angleCos = dot( directLight.direction, spotLight.direction );
		if ( angleCos > spotLight.coneCos ) {
			float spotEffect = smoothstep( spotLight.coneCos, spotLight.penumbraCos, angleCos );
			directLight.color = spotLight.color;
			directLight.color *= spotEffect * punctualLightIntensityToIrradianceFactor( lightDistance, spotLight.distance, spotLight.decay );
			directLight.visible = true;
		} else {
			directLight.color = vec3( 0.0 );
			directLight.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in GeometricContext geometry ) {
		float dotNL = dot( geometry.normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		#ifndef PHYSICALLY_CORRECT_LIGHTS
			irradiance *= PI;
		#endif
		return irradiance;
	}
#endif`,eZ=`#if defined( USE_ENVMAP )
	#ifdef ENVMAP_MODE_REFRACTION
		uniform float refractionRatio;
	#endif
	vec3 getLightProbeIndirectIrradiance( const in GeometricContext geometry, const in int maxMIPLevel ) {
		vec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );
		#ifdef ENVMAP_TYPE_CUBE
			vec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );
			#ifdef TEXTURE_LOD_EXT
				vec4 envMapColor = textureCubeLodEXT( envMap, queryVec, float( maxMIPLevel ) );
			#else
				vec4 envMapColor = textureCube( envMap, queryVec, float( maxMIPLevel ) );
			#endif
			envMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;
		#elif defined( ENVMAP_TYPE_CUBE_UV )
			vec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );
		#else
			vec4 envMapColor = vec4( 0.0 );
		#endif
		return PI * envMapColor.rgb * envMapIntensity;
	}
	float getSpecularMIPLevel( const in float roughness, const in int maxMIPLevel ) {
		float maxMIPLevelScalar = float( maxMIPLevel );
		float sigma = PI * roughness * roughness / ( 1.0 + roughness );
		float desiredMIPLevel = maxMIPLevelScalar + log2( sigma );
		return clamp( desiredMIPLevel, 0.0, maxMIPLevelScalar );
	}
	vec3 getLightProbeIndirectRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in int maxMIPLevel ) {
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( -viewDir, normal );
			reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
		#else
			vec3 reflectVec = refract( -viewDir, normal, refractionRatio );
		#endif
		reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
		float specularMIPLevel = getSpecularMIPLevel( roughness, maxMIPLevel );
		#ifdef ENVMAP_TYPE_CUBE
			vec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );
			#ifdef TEXTURE_LOD_EXT
				vec4 envMapColor = textureCubeLodEXT( envMap, queryReflectVec, specularMIPLevel );
			#else
				vec4 envMapColor = textureCube( envMap, queryReflectVec, specularMIPLevel );
			#endif
			envMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;
		#elif defined( ENVMAP_TYPE_CUBE_UV )
			vec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );
		#endif
		return envMapColor.rgb * envMapIntensity;
	}
#endif`,tZ=`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,nZ=`varying vec3 vViewPosition;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;
	#ifndef PHYSICALLY_CORRECT_LIGHTS
		irradiance *= PI;
	#endif
	reflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon
#define Material_LightProbeLOD( material )	(0)`,iZ=`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,rZ=`varying vec3 vViewPosition;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifndef PHYSICALLY_CORRECT_LIGHTS
		irradiance *= PI;
	#endif
	reflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_Specular_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong
#define Material_LightProbeLOD( material )	(0)`,sZ=`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.specularRoughness = max( roughnessFactor, 0.0525 );material.specularRoughness += geometryRoughness;
material.specularRoughness = min( material.specularRoughness, 1.0 );
#ifdef REFLECTIVITY
	material.specularColor = mix( vec3( MAXIMUM_SPECULAR_COEFFICIENT * pow2( reflectivity ) ), diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( DEFAULT_SPECULAR_COEFFICIENT ), diffuseColor.rgb, metalnessFactor );
#endif
#ifdef CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheen;
#endif`,oZ=`struct PhysicalMaterial {
	vec3 diffuseColor;
	float specularRoughness;
	vec3 specularColor;
#ifdef CLEARCOAT
	float clearcoat;
	float clearcoatRoughness;
#endif
#ifdef USE_SHEEN
	vec3 sheenColor;
#endif
};
#define MAXIMUM_SPECULAR_COEFFICIENT 0.16
#define DEFAULT_SPECULAR_COEFFICIENT 0.04
float clearcoatDHRApprox( const in float roughness, const in float dotNL ) {
	return DEFAULT_SPECULAR_COEFFICIENT + ( 1.0 - DEFAULT_SPECULAR_COEFFICIENT ) * ( pow( 1.0 - dotNL, 5.0 ) * pow( 1.0 - roughness, 2.0 ) );
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometry.normal;
		vec3 viewDir = geometry.viewDir;
		vec3 position = geometry.position;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.specularRoughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifndef PHYSICALLY_CORRECT_LIGHTS
		irradiance *= PI;
	#endif
	#ifdef CLEARCOAT
		float ccDotNL = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = ccDotNL * directLight.color;
		#ifndef PHYSICALLY_CORRECT_LIGHTS
			ccIrradiance *= PI;
		#endif
		float clearcoatDHR = material.clearcoat * clearcoatDHRApprox( material.clearcoatRoughness, ccDotNL );
		reflectedLight.directSpecular += ccIrradiance * material.clearcoat * BRDF_Specular_GGX( directLight, geometry.viewDir, geometry.clearcoatNormal, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearcoatRoughness );
	#else
		float clearcoatDHR = 0.0;
	#endif
	#ifdef USE_SHEEN
		reflectedLight.directSpecular += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Specular_Sheen(
			material.specularRoughness,
			directLight.direction,
			geometry,
			material.sheenColor
		);
	#else
		reflectedLight.directSpecular += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Specular_GGX( directLight, geometry.viewDir, geometry.normal, material.specularColor, material.specularRoughness);
	#endif
	reflectedLight.directDiffuse += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef CLEARCOAT
		float ccDotNV = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );
		reflectedLight.indirectSpecular += clearcoatRadiance * material.clearcoat * BRDF_Specular_GGX_Environment( geometry.viewDir, geometry.clearcoatNormal, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearcoatRoughness );
		float ccDotNL = ccDotNV;
		float clearcoatDHR = material.clearcoat * clearcoatDHRApprox( material.clearcoatRoughness, ccDotNL );
	#else
		float clearcoatDHR = 0.0;
	#endif
	float clearcoatInv = 1.0 - clearcoatDHR;
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	BRDF_Specular_Multiscattering_Environment( geometry, material.specularColor, material.specularRoughness, singleScattering, multiScattering );
	vec3 diffuse = material.diffuseColor * ( 1.0 - ( singleScattering + multiScattering ) );
	reflectedLight.indirectSpecular += clearcoatInv * radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,aZ=`
GeometricContext geometry;
geometry.position = - vViewPosition;
geometry.normal = normal;
geometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
#ifdef CLEARCOAT
	geometry.clearcoatNormal = clearcoatNormal;
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointDirectLightIrradiance( pointLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotDirectLightIrradiance( spotLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalDirectLightIrradiance( directionalLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	irradiance += getLightProbeIrradiance( lightProbe, geometry );
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,lZ=`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel= texture2D( lightMap, vUv2 );
		vec3 lightMapIrradiance = lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;
		#ifndef PHYSICALLY_CORRECT_LIGHTS
			lightMapIrradiance *= PI;
		#endif
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getLightProbeIndirectIrradiance( geometry, maxMipLevel );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	radiance += getLightProbeIndirectRadiance( geometry.viewDir, geometry.normal, material.specularRoughness, maxMipLevel );
	#ifdef CLEARCOAT
		clearcoatRadiance += getLightProbeIndirectRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness, maxMipLevel );
	#endif
#endif`,cZ=`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );
#endif`,uZ=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	gl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,hZ=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,dZ=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		varying float vFragDepth;
		varying float vIsPerspective;
	#else
		uniform float logDepthBufFC;
	#endif
#endif`,fZ=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		vFragDepth = 1.0 + gl_Position.w;
		vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
	#else
		if ( isPerspectiveMatrix( projectionMatrix ) ) {
			gl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;
			gl_Position.z *= gl_Position.w;
		}
	#endif
#endif`,pZ=`#ifdef USE_MAP
	vec4 texelColor = texture2D( map, vUv );
	texelColor = mapTexelToLinear( texelColor );
	diffuseColor *= texelColor;
#endif`,mZ=`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,gZ=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
#endif
#ifdef USE_MAP
	vec4 mapTexel = texture2D( map, uv );
	diffuseColor *= mapTexelToLinear( mapTexel );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,yZ=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	uniform mat3 uvTransform;
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,vZ=`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vUv );
	metalnessFactor *= texelMetalness.b;
#endif`,xZ=`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,_Z=`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	objectNormal += morphNormal0 * morphTargetInfluences[ 0 ];
	objectNormal += morphNormal1 * morphTargetInfluences[ 1 ];
	objectNormal += morphNormal2 * morphTargetInfluences[ 2 ];
	objectNormal += morphNormal3 * morphTargetInfluences[ 3 ];
#endif`,wZ=`#ifdef USE_MORPHTARGETS
	uniform float morphTargetBaseInfluence;
	#ifndef USE_MORPHNORMALS
		uniform float morphTargetInfluences[ 8 ];
	#else
		uniform float morphTargetInfluences[ 4 ];
	#endif
#endif`,bZ=`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	transformed += morphTarget0 * morphTargetInfluences[ 0 ];
	transformed += morphTarget1 * morphTargetInfluences[ 1 ];
	transformed += morphTarget2 * morphTargetInfluences[ 2 ];
	transformed += morphTarget3 * morphTargetInfluences[ 3 ];
	#ifndef USE_MORPHNORMALS
		transformed += morphTarget4 * morphTargetInfluences[ 4 ];
		transformed += morphTarget5 * morphTargetInfluences[ 5 ];
		transformed += morphTarget6 * morphTargetInfluences[ 6 ];
		transformed += morphTarget7 * morphTargetInfluences[ 7 ];
	#endif
#endif`,MZ=`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );
	vec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	#ifdef USE_TANGENT
		vec3 tangent = normalize( vTangent );
		vec3 bitangent = normalize( vBitangent );
		#ifdef DOUBLE_SIDED
			tangent = tangent * faceDirection;
			bitangent = bitangent * faceDirection;
		#endif
		#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )
			mat3 vTBN = mat3( tangent, bitangent, normal );
		#endif
	#endif
#endif
vec3 geometryNormal = normal;`,SZ=`#ifdef OBJECTSPACE_NORMALMAP
	normal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( TANGENTSPACE_NORMALMAP )
	vec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	#ifdef USE_TANGENT
		normal = normalize( vTBN * mapN );
	#else
		normal = perturbNormal2Arb( -vViewPosition, normal, mapN, faceDirection );
	#endif
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,TZ=`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef OBJECTSPACE_NORMALMAP
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )
	vec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN, float faceDirection ) {
		vec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );
		vec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );
		vec2 st0 = dFdx( vUv.st );
		vec2 st1 = dFdy( vUv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : faceDirection * inversesqrt( det );
		return normalize( T * ( mapN.x * scale ) + B * ( mapN.y * scale ) + N * mapN.z );
	}
#endif`,EZ=`#ifdef CLEARCOAT
	vec3 clearcoatNormal = geometryNormal;
#endif`,AZ=`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	#ifdef USE_TANGENT
		clearcoatNormal = normalize( vTBN * clearcoatMapN );
	#else
		clearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN, faceDirection );
	#endif
#endif`,CZ=`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif`,LZ=`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;
const vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );
const vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );
const float ShiftRight8 = 1. / 256.;
vec4 packDepthToRGBA( const in float v ) {
	vec4 r = vec4( fract( v * PackFactors ), v );
	r.yzw -= r.xyz * ShiftRight8;	return r * PackUpscale;
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors );
}
vec4 pack2HalfToRGBA( vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ));
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w);
}
vec2 unpackRGBATo2Half( vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {
	return linearClipZ * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return (( near + viewZ ) * far ) / (( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * invClipZ - far );
}`,RZ=`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,PZ=`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,IZ=`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,DZ=`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,FZ=`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vUv );
	roughnessFactor *= texelRoughness.g;
#endif`,BZ=`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,NZ=`#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		varying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		float hard_shadow = step( compare , distribution.x );
		if (hard_shadow != 1.0 ) {
			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );
		bool inFrustum = all( inFrustumVec );
		bvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );
		bool frustumTest = all( frustumTestVec );
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ), 
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ), 
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ), 
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ), 
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ), 
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ), 
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return shadow;
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
		vec3 lightToPosition = shadowCoord.xyz;
		float dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );		dp += shadowBias;
		vec3 bd3D = normalize( lightToPosition );
		#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
			vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
			return (
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
			) * ( 1.0 / 9.0 );
		#else
			return texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
		#endif
	}
#endif`,OZ=`#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHT_SHADOWS ];
		varying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,kZ=`#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0 || NUM_SPOT_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0
		vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		vec4 shadowWorldPosition;
	#endif
	#if NUM_DIR_LIGHT_SHADOWS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
		vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias, 0 );
		vSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
		vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
	#endif
#endif`,zZ=`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,UZ=`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,HZ=`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	#ifdef BONE_TEXTURE
		uniform highp sampler2D boneTexture;
		uniform int boneTextureSize;
		mat4 getBoneMatrix( const in float i ) {
			float j = i * 4.0;
			float x = mod( j, float( boneTextureSize ) );
			float y = floor( j / float( boneTextureSize ) );
			float dx = 1.0 / float( boneTextureSize );
			float dy = 1.0 / float( boneTextureSize );
			y = dy * ( y + 0.5 );
			vec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );
			vec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );
			vec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );
			vec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );
			mat4 bone = mat4( v1, v2, v3, v4 );
			return bone;
		}
	#else
		uniform mat4 boneMatrices[ MAX_BONES ];
		mat4 getBoneMatrix( const in float i ) {
			mat4 bone = boneMatrices[ int(i) ];
			return bone;
		}
	#endif
#endif`,GZ=`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,VZ=`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,WZ=`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,XZ=`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,qZ=`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,jZ=`#ifndef saturate
#define saturate(a) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return toneMappingExposure * color;
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 OptimizedCineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,YZ=`#ifdef USE_TRANSMISSIONMAP
	totalTransmission *= texture2D( transmissionMap, vUv ).r;
#endif`,ZZ=`#ifdef USE_TRANSMISSIONMAP
	uniform sampler2D transmissionMap;
#endif`,JZ=`#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )
	varying vec2 vUv;
#endif`,KZ=`#ifdef USE_UV
	#ifdef UVS_VERTEX_ONLY
		vec2 vUv;
	#else
		varying vec2 vUv;
	#endif
	uniform mat3 uvTransform;
#endif`,$Z=`#ifdef USE_UV
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
#endif`,QZ=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	varying vec2 vUv2;
#endif`,eJ=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	attribute vec2 uv2;
	varying vec2 vUv2;
	uniform mat3 uv2Transform;
#endif`,tJ=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	vUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;
#endif`,nJ=`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP )
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`,iJ=`uniform sampler2D t2D;
varying vec2 vUv;
void main() {
	vec4 texColor = texture2D( t2D, vUv );
	gl_FragColor = mapTexelToLinear( texColor );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,rJ=`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,sJ=`#include <envmap_common_pars_fragment>
uniform float opacity;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	vec3 vReflect = vWorldDirection;
	#include <envmap_fragment>
	gl_FragColor = envColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,oJ=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,aJ=`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <logdepthbuf_fragment>
	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#endif
}`,lJ=`#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,cJ=`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,uJ=`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,hJ=`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	vec4 texColor = texture2D( tEquirect, sampleUV );
	gl_FragColor = mapTexelToLinear( texColor );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,dJ=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,fJ=`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,pJ=`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <color_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,mJ=`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <cube_uv_reflection_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
	
		vec4 lightMapTexel= texture2D( lightMap, vUv2 );
		reflectedLight.indirectDiffuse += lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,gJ=`#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <skinbase_vertex>
	#ifdef USE_ENVMAP
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,yJ=`uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
varying vec3 vLightFront;
varying vec3 vIndirectFront;
#ifdef DOUBLE_SIDED
	varying vec3 vLightBack;
	varying vec3 vIndirectBack;
#endif
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <cube_uv_reflection_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <fog_pars_fragment>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <emissivemap_fragment>
	#ifdef DOUBLE_SIDED
		reflectedLight.indirectDiffuse += ( gl_FrontFacing ) ? vIndirectFront : vIndirectBack;
	#else
		reflectedLight.indirectDiffuse += vIndirectFront;
	#endif
	#include <lightmap_fragment>
	reflectedLight.indirectDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb );
	#ifdef DOUBLE_SIDED
		reflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;
	#else
		reflectedLight.directDiffuse = vLightFront;
	#endif
	reflectedLight.directDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb ) * getShadowMask();
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,vJ=`#define LAMBERT
varying vec3 vLightFront;
varying vec3 vIndirectFront;
#ifdef DOUBLE_SIDED
	varying vec3 vLightBack;
	varying vec3 vIndirectBack;
#endif
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <envmap_pars_vertex>
#include <bsdfs>
#include <lights_pars_begin>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <lights_lambert_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,xJ=`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <fog_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
		matcapColor = matcapTexelToLinear( matcapColor );
	#else
		vec4 matcapColor = vec4( 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,_J=`#define MATCAP
varying vec3 vViewPosition;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#ifndef FLAT_SHADED
		vNormal = normalize( transformedNormal );
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,wJ=`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,bJ=`#define TOON
varying vec3 vViewPosition;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,MJ=`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <cube_uv_reflection_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,SJ=`#define PHONG
varying vec3 vViewPosition;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,TJ=`#define STANDARD
#ifdef PHYSICAL
	#define REFLECTIVITY
	#define CLEARCOAT
	#define TRANSMISSION
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef TRANSMISSION
	uniform float transmission;
#endif
#ifdef REFLECTIVITY
	uniform float reflectivity;
#endif
#ifdef CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheen;
#endif
varying vec3 vViewPosition;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <transmissionmap_pars_fragment>
#include <bsdfs>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <lights_physical_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#ifdef TRANSMISSION
		float totalTransmission = transmission;
	#endif
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <transmissionmap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#ifdef TRANSMISSION
		diffuseColor.a *= mix( saturate( 1. - totalTransmission + linearToRelativeLuminance( reflectedLight.directSpecular + reflectedLight.indirectSpecular ) ), 1.0, metalness );
	#endif
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,EJ=`#define STANDARD
varying vec3 vViewPosition;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,AJ=`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	varying vec3 vViewPosition;
#endif
#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif
#include <packing>
#include <uv_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), opacity );
}`,CJ=`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	varying vec3 vViewPosition;
#endif
#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	vViewPosition = - mvPosition.xyz;
#endif
}`,LJ=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,RJ=`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <color_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,PJ=`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`,IJ=`#include <common>
#include <fog_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <begin_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,DJ=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`,FJ=`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
	vec2 scale;
	scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
	scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,ht={alphamap_fragment:pY,alphamap_pars_fragment:mY,alphatest_fragment:gY,aomap_fragment:yY,aomap_pars_fragment:vY,begin_vertex:xY,beginnormal_vertex:_Y,bsdfs:wY,bumpmap_pars_fragment:bY,clipping_planes_fragment:MY,clipping_planes_pars_fragment:SY,clipping_planes_pars_vertex:TY,clipping_planes_vertex:EY,color_fragment:AY,color_pars_fragment:CY,color_pars_vertex:LY,color_vertex:RY,common:PY,cube_uv_reflection_fragment:IY,defaultnormal_vertex:DY,displacementmap_pars_vertex:FY,displacementmap_vertex:BY,emissivemap_fragment:NY,emissivemap_pars_fragment:OY,encodings_fragment:kY,encodings_pars_fragment:zY,envmap_fragment:UY,envmap_common_pars_fragment:HY,envmap_pars_fragment:GY,envmap_pars_vertex:VY,envmap_physical_pars_fragment:eZ,envmap_vertex:WY,fog_vertex:XY,fog_pars_vertex:qY,fog_fragment:jY,fog_pars_fragment:YY,gradientmap_pars_fragment:ZY,lightmap_fragment:JY,lightmap_pars_fragment:KY,lights_lambert_vertex:$Y,lights_pars_begin:QY,lights_toon_fragment:tZ,lights_toon_pars_fragment:nZ,lights_phong_fragment:iZ,lights_phong_pars_fragment:rZ,lights_physical_fragment:sZ,lights_physical_pars_fragment:oZ,lights_fragment_begin:aZ,lights_fragment_maps:lZ,lights_fragment_end:cZ,logdepthbuf_fragment:uZ,logdepthbuf_pars_fragment:hZ,logdepthbuf_pars_vertex:dZ,logdepthbuf_vertex:fZ,map_fragment:pZ,map_pars_fragment:mZ,map_particle_fragment:gZ,map_particle_pars_fragment:yZ,metalnessmap_fragment:vZ,metalnessmap_pars_fragment:xZ,morphnormal_vertex:_Z,morphtarget_pars_vertex:wZ,morphtarget_vertex:bZ,normal_fragment_begin:MZ,normal_fragment_maps:SZ,normalmap_pars_fragment:TZ,clearcoat_normal_fragment_begin:EZ,clearcoat_normal_fragment_maps:AZ,clearcoat_pars_fragment:CZ,packing:LZ,premultiplied_alpha_fragment:RZ,project_vertex:PZ,dithering_fragment:IZ,dithering_pars_fragment:DZ,roughnessmap_fragment:FZ,roughnessmap_pars_fragment:BZ,shadowmap_pars_fragment:NZ,shadowmap_pars_vertex:OZ,shadowmap_vertex:kZ,shadowmask_pars_fragment:zZ,skinbase_vertex:UZ,skinning_pars_vertex:HZ,skinning_vertex:GZ,skinnormal_vertex:VZ,specularmap_fragment:WZ,specularmap_pars_fragment:XZ,tonemapping_fragment:qZ,tonemapping_pars_fragment:jZ,transmissionmap_fragment:YZ,transmissionmap_pars_fragment:ZZ,uv_pars_fragment:JZ,uv_pars_vertex:KZ,uv_vertex:$Z,uv2_pars_fragment:QZ,uv2_pars_vertex:eJ,uv2_vertex:tJ,worldpos_vertex:nJ,background_frag:iJ,background_vert:rJ,cube_frag:sJ,cube_vert:oJ,depth_frag:aJ,depth_vert:lJ,distanceRGBA_frag:cJ,distanceRGBA_vert:uJ,equirect_frag:hJ,equirect_vert:dJ,linedashed_frag:fJ,linedashed_vert:pJ,meshbasic_frag:mJ,meshbasic_vert:gJ,meshlambert_frag:yJ,meshlambert_vert:vJ,meshmatcap_frag:xJ,meshmatcap_vert:_J,meshtoon_frag:wJ,meshtoon_vert:bJ,meshphong_frag:MJ,meshphong_vert:SJ,meshphysical_frag:TJ,meshphysical_vert:EJ,normal_frag:AJ,normal_vert:CJ,points_frag:LJ,points_vert:RJ,shadow_frag:PJ,shadow_vert:IJ,sprite_frag:DJ,sprite_vert:FJ},Ve={common:{diffuse:{value:new qe(15658734)},opacity:{value:1},map:{value:null},uvTransform:{value:new Un},uv2Transform:{value:new Un},alphaMap:{value:null}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},refractionRatio:{value:.98},maxMipLevel:{value:0}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new Oe(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new qe(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new qe(15658734)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},uvTransform:{value:new Un}},sprite:{diffuse:{value:new qe(15658734)},opacity:{value:1},center:{value:new Oe(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},uvTransform:{value:new Un}}},Ns={basic:{uniforms:gi([Ve.common,Ve.specularmap,Ve.envmap,Ve.aomap,Ve.lightmap,Ve.fog]),vertexShader:ht.meshbasic_vert,fragmentShader:ht.meshbasic_frag},lambert:{uniforms:gi([Ve.common,Ve.specularmap,Ve.envmap,Ve.aomap,Ve.lightmap,Ve.emissivemap,Ve.fog,Ve.lights,{emissive:{value:new qe(0)}}]),vertexShader:ht.meshlambert_vert,fragmentShader:ht.meshlambert_frag},phong:{uniforms:gi([Ve.common,Ve.specularmap,Ve.envmap,Ve.aomap,Ve.lightmap,Ve.emissivemap,Ve.bumpmap,Ve.normalmap,Ve.displacementmap,Ve.fog,Ve.lights,{emissive:{value:new qe(0)},specular:{value:new qe(1118481)},shininess:{value:30}}]),vertexShader:ht.meshphong_vert,fragmentShader:ht.meshphong_frag},standard:{uniforms:gi([Ve.common,Ve.envmap,Ve.aomap,Ve.lightmap,Ve.emissivemap,Ve.bumpmap,Ve.normalmap,Ve.displacementmap,Ve.roughnessmap,Ve.metalnessmap,Ve.fog,Ve.lights,{emissive:{value:new qe(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:ht.meshphysical_vert,fragmentShader:ht.meshphysical_frag},toon:{uniforms:gi([Ve.common,Ve.aomap,Ve.lightmap,Ve.emissivemap,Ve.bumpmap,Ve.normalmap,Ve.displacementmap,Ve.gradientmap,Ve.fog,Ve.lights,{emissive:{value:new qe(0)}}]),vertexShader:ht.meshtoon_vert,fragmentShader:ht.meshtoon_frag},matcap:{uniforms:gi([Ve.common,Ve.bumpmap,Ve.normalmap,Ve.displacementmap,Ve.fog,{matcap:{value:null}}]),vertexShader:ht.meshmatcap_vert,fragmentShader:ht.meshmatcap_frag},points:{uniforms:gi([Ve.points,Ve.fog]),vertexShader:ht.points_vert,fragmentShader:ht.points_frag},dashed:{uniforms:gi([Ve.common,Ve.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:ht.linedashed_vert,fragmentShader:ht.linedashed_frag},depth:{uniforms:gi([Ve.common,Ve.displacementmap]),vertexShader:ht.depth_vert,fragmentShader:ht.depth_frag},normal:{uniforms:gi([Ve.common,Ve.bumpmap,Ve.normalmap,Ve.displacementmap,{opacity:{value:1}}]),vertexShader:ht.normal_vert,fragmentShader:ht.normal_frag},sprite:{uniforms:gi([Ve.sprite,Ve.fog]),vertexShader:ht.sprite_vert,fragmentShader:ht.sprite_frag},background:{uniforms:{uvTransform:{value:new Un},t2D:{value:null}},vertexShader:ht.background_vert,fragmentShader:ht.background_frag},cube:{uniforms:gi([Ve.envmap,{opacity:{value:1}}]),vertexShader:ht.cube_vert,fragmentShader:ht.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:ht.equirect_vert,fragmentShader:ht.equirect_frag},distanceRGBA:{uniforms:gi([Ve.common,Ve.displacementmap,{referencePosition:{value:new ae},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:ht.distanceRGBA_vert,fragmentShader:ht.distanceRGBA_frag},shadow:{uniforms:gi([Ve.lights,Ve.fog,{color:{value:new qe(0)},opacity:{value:1}}]),vertexShader:ht.shadow_vert,fragmentShader:ht.shadow_frag}};Ns.physical={uniforms:gi([Ns.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new Oe(1,1)},clearcoatNormalMap:{value:null},sheen:{value:new qe(0)},transmission:{value:0},transmissionMap:{value:null}}]),vertexShader:ht.meshphysical_vert,fragmentShader:ht.meshphysical_frag};function BJ(o,e,t,n,i){let r=new qe(0),s=0,a,l,c=null,u=0,d=null;function h(p,g,v,y){let m=g.isScene===!0?g.background:null;m&&m.isTexture&&(m=e.get(m));let x=o.xr,_=x.getSession&&x.getSession();_&&_.environmentBlendMode==="additive"&&(m=null),m===null?f(r,s):m&&m.isColor&&(f(m,1),y=!0),(o.autoClear||y)&&o.clear(o.autoClearColor,o.autoClearDepth,o.autoClearStencil),m&&(m.isCubeTexture||m.mapping===y1)?(l===void 0&&(l=new Vn(new Bv(1,1,1),new ss({name:"BackgroundCubeMaterial",uniforms:hd(Ns.cube.uniforms),vertexShader:Ns.cube.vertexShader,fragmentShader:Ns.cube.fragmentShader,side:zn,depthTest:!1,depthWrite:!1,fog:!1})),l.geometry.deleteAttribute("normal"),l.geometry.deleteAttribute("uv"),l.onBeforeRender=function(w,b,M){this.matrixWorld.copyPosition(M.matrixWorld)},Object.defineProperty(l.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),n.update(l)),l.material.uniforms.envMap.value=m,l.material.uniforms.flipEnvMap.value=m.isCubeTexture&&m._needsFlipEnvMap?-1:1,(c!==m||u!==m.version||d!==o.toneMapping)&&(l.material.needsUpdate=!0,c=m,u=m.version,d=o.toneMapping),p.unshift(l,l.geometry,l.material,0,0,null)):m&&m.isTexture&&(a===void 0&&(a=new Vn(new md(2,2),new ss({name:"BackgroundMaterial",uniforms:hd(Ns.background.uniforms),vertexShader:Ns.background.vertexShader,fragmentShader:Ns.background.fragmentShader,side:Wh,depthTest:!1,depthWrite:!1,fog:!1})),a.geometry.deleteAttribute("normal"),Object.defineProperty(a.material,"map",{get:function(){return this.uniforms.t2D.value}}),n.update(a)),a.material.uniforms.t2D.value=m,m.matrixAutoUpdate===!0&&m.updateMatrix(),a.material.uniforms.uvTransform.value.copy(m.matrix),(c!==m||u!==m.version||d!==o.toneMapping)&&(a.material.needsUpdate=!0,c=m,u=m.version,d=o.toneMapping),p.unshift(a,a.geometry,a.material,0,0,null))}function f(p,g){t.buffers.color.setClear(p.r,p.g,p.b,g,i)}return{getClearColor:function(){return r},setClearColor:function(p,g=1){r.set(p),s=g,f(r,s)},getClearAlpha:function(){return s},setClearAlpha:function(p){s=p,f(r,s)},render:h}}function NJ(o,e,t,n){let i=o.getParameter(34921),r=n.isWebGL2?null:e.get("OES_vertex_array_object"),s=n.isWebGL2||r!==null,a={},l=g(null),c=l;function u(R,D,P,I,N){let G=!1;if(s){let z=p(I,P,D);c!==z&&(c=z,h(c.object)),G=v(I,N),G&&y(I,N)}else{let z=D.wireframe===!0;(c.geometry!==I.id||c.program!==P.id||c.wireframe!==z)&&(c.geometry=I.id,c.program=P.id,c.wireframe=z,G=!0)}R.isInstancedMesh===!0&&(G=!0),N!==null&&t.update(N,34963),G&&(M(R,D,P,I),N!==null&&o.bindBuffer(34963,t.get(N).buffer))}function d(){return n.isWebGL2?o.createVertexArray():r.createVertexArrayOES()}function h(R){return n.isWebGL2?o.bindVertexArray(R):r.bindVertexArrayOES(R)}function f(R){return n.isWebGL2?o.deleteVertexArray(R):r.deleteVertexArrayOES(R)}function p(R,D,P){let I=P.wireframe===!0,N=a[R.id];N===void 0&&(N={},a[R.id]=N);let G=N[D.id];G===void 0&&(G={},N[D.id]=G);let z=G[I];return z===void 0&&(z=g(d()),G[I]=z),z}function g(R){let D=[],P=[],I=[];for(let N=0;N<i;N++)D[N]=0,P[N]=0,I[N]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:D,enabledAttributes:P,attributeDivisors:I,object:R,attributes:{},index:null}}function v(R,D){let P=c.attributes,I=R.attributes,N=0;for(let G in I){let z=P[G],se=I[G];if(z===void 0||z.attribute!==se||z.data!==se.data)return!0;N++}return c.attributesNum!==N||c.index!==D}function y(R,D){let P={},I=R.attributes,N=0;for(let G in I){let z=I[G],se={};se.attribute=z,z.data&&(se.data=z.data),P[G]=se,N++}c.attributes=P,c.attributesNum=N,c.index=D}function m(){let R=c.newAttributes;for(let D=0,P=R.length;D<P;D++)R[D]=0}function x(R){_(R,0)}function _(R,D){let P=c.newAttributes,I=c.enabledAttributes,N=c.attributeDivisors;P[R]=1,I[R]===0&&(o.enableVertexAttribArray(R),I[R]=1),N[R]!==D&&((n.isWebGL2?o:e.get("ANGLE_instanced_arrays"))[n.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](R,D),N[R]=D)}function w(){let R=c.newAttributes,D=c.enabledAttributes;for(let P=0,I=D.length;P<I;P++)D[P]!==R[P]&&(o.disableVertexAttribArray(P),D[P]=0)}function b(R,D,P,I,N,G){n.isWebGL2===!0&&(P===5124||P===5125)?o.vertexAttribIPointer(R,D,P,N,G):o.vertexAttribPointer(R,D,P,I,N,G)}function M(R,D,P,I){if(n.isWebGL2===!1&&(R.isInstancedMesh||I.isInstancedBufferGeometry)&&e.get("ANGLE_instanced_arrays")===null)return;m();let N=I.attributes,G=P.getAttributes(),z=D.defaultAttributeValues;for(let se in G){let ne=G[se];if(ne>=0){let Q=N[se];if(Q!==void 0){let j=Q.normalized,O=Q.itemSize,ee=t.get(Q);if(ee===void 0)continue;let V=ee.buffer,ie=ee.type,ue=ee.bytesPerElement;if(Q.isInterleavedBufferAttribute){let ye=Q.data,pe=ye.stride,xe=Q.offset;ye&&ye.isInstancedInterleavedBuffer?(_(ne,ye.meshPerAttribute),I._maxInstanceCount===void 0&&(I._maxInstanceCount=ye.meshPerAttribute*ye.count)):x(ne),o.bindBuffer(34962,V),b(ne,O,ie,j,pe*ue,xe*ue)}else Q.isInstancedBufferAttribute?(_(ne,Q.meshPerAttribute),I._maxInstanceCount===void 0&&(I._maxInstanceCount=Q.meshPerAttribute*Q.count)):x(ne),o.bindBuffer(34962,V),b(ne,O,ie,j,0,0)}else if(se==="instanceMatrix"){let j=t.get(R.instanceMatrix);if(j===void 0)continue;let O=j.buffer,ee=j.type;_(ne+0,1),_(ne+1,1),_(ne+2,1),_(ne+3,1),o.bindBuffer(34962,O),o.vertexAttribPointer(ne+0,4,ee,!1,64,0),o.vertexAttribPointer(ne+1,4,ee,!1,64,16),o.vertexAttribPointer(ne+2,4,ee,!1,64,32),o.vertexAttribPointer(ne+3,4,ee,!1,64,48)}else if(se==="instanceColor"){let j=t.get(R.instanceColor);if(j===void 0)continue;let O=j.buffer,ee=j.type;_(ne,1),o.bindBuffer(34962,O),o.vertexAttribPointer(ne,3,ee,!1,12,0)}else if(z!==void 0){let j=z[se];if(j!==void 0)switch(j.length){case 2:o.vertexAttrib2fv(ne,j);break;case 3:o.vertexAttrib3fv(ne,j);break;case 4:o.vertexAttrib4fv(ne,j);break;default:o.vertexAttrib1fv(ne,j)}}}}w()}function S(){L();for(let R in a){let D=a[R];for(let P in D){let I=D[P];for(let N in I)f(I[N].object),delete I[N];delete D[P]}delete a[R]}}function E(R){if(a[R.id]===void 0)return;let D=a[R.id];for(let P in D){let I=D[P];for(let N in I)f(I[N].object),delete I[N];delete D[P]}delete a[R.id]}function A(R){for(let D in a){let P=a[D];if(P[R.id]===void 0)continue;let I=P[R.id];for(let N in I)f(I[N].object),delete I[N];delete P[R.id]}}function L(){B(),c!==l&&(c=l,h(c.object))}function B(){l.geometry=null,l.program=null,l.wireframe=!1}return{setup:u,reset:L,resetDefaultState:B,dispose:S,releaseStatesOfGeometry:E,releaseStatesOfProgram:A,initAttributes:m,enableAttribute:x,disableUnusedAttributes:w}}function OJ(o,e,t,n){let i=n.isWebGL2,r;function s(c){r=c}function a(c,u){o.drawArrays(r,c,u),t.update(u,r,1)}function l(c,u,d){if(d===0)return;let h,f;if(i)h=o,f="drawArraysInstanced";else if(h=e.get("ANGLE_instanced_arrays"),f="drawArraysInstancedANGLE",h===null){console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}h[f](r,c,u,d),t.update(u,r,d)}this.setMode=s,this.render=a,this.renderInstances=l}function kJ(o,e,t){let n;function i(){if(n!==void 0)return n;if(e.has("EXT_texture_filter_anisotropic")===!0){let b=e.get("EXT_texture_filter_anisotropic");n=o.getParameter(b.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else n=0;return n}function r(b){if(b==="highp"){if(o.getShaderPrecisionFormat(35633,36338).precision>0&&o.getShaderPrecisionFormat(35632,36338).precision>0)return"highp";b="mediump"}return b==="mediump"&&o.getShaderPrecisionFormat(35633,36337).precision>0&&o.getShaderPrecisionFormat(35632,36337).precision>0?"mediump":"lowp"}let s=typeof WebGL2RenderingContext!="undefined"&&o instanceof WebGL2RenderingContext||typeof WebGL2ComputeRenderingContext!="undefined"&&o instanceof WebGL2ComputeRenderingContext,a=t.precision!==void 0?t.precision:"highp",l=r(a);l!==a&&(console.warn("THREE.WebGLRenderer:",a,"not supported, using",l,"instead."),a=l);let c=t.logarithmicDepthBuffer===!0,u=o.getParameter(34930),d=o.getParameter(35660),h=o.getParameter(3379),f=o.getParameter(34076),p=o.getParameter(34921),g=o.getParameter(36347),v=o.getParameter(36348),y=o.getParameter(36349),m=d>0,x=s||e.has("OES_texture_float"),_=m&&x,w=s?o.getParameter(36183):0;return{isWebGL2:s,getMaxAnisotropy:i,getMaxPrecision:r,precision:a,logarithmicDepthBuffer:c,maxTextures:u,maxVertexTextures:d,maxTextureSize:h,maxCubemapSize:f,maxAttributes:p,maxVertexUniforms:g,maxVaryings:v,maxFragmentUniforms:y,vertexTextures:m,floatFragmentTextures:x,floatVertexTextures:_,maxSamples:w}}function zJ(o){let e=this,t=null,n=0,i=!1,r=!1,s=new mi,a=new Un,l={value:null,needsUpdate:!1};this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(d,h,f){let p=d.length!==0||h||n!==0||i;return i=h,t=u(d,f,0),n=d.length,p},this.beginShadows=function(){r=!0,u(null)},this.endShadows=function(){r=!1,c()},this.setState=function(d,h,f){let p=d.clippingPlanes,g=d.clipIntersection,v=d.clipShadows,y=o.get(d);if(!i||p===null||p.length===0||r&&!v)r?u(null):c();else{let m=r?0:n,x=m*4,_=y.clippingState||null;l.value=_,_=u(p,h,x,f);for(let w=0;w!==x;++w)_[w]=t[w];y.clippingState=_,this.numIntersection=g?this.numPlanes:0,this.numPlanes+=m}};function c(){l.value!==t&&(l.value=t,l.needsUpdate=n>0),e.numPlanes=n,e.numIntersection=0}function u(d,h,f,p){let g=d!==null?d.length:0,v=null;if(g!==0){if(v=l.value,p!==!0||v===null){let y=f+g*4,m=h.matrixWorldInverse;a.getNormalMatrix(m),(v===null||v.length<y)&&(v=new Float32Array(y));for(let x=0,_=f;x!==g;++x,_+=4)s.copy(d[x]).applyMatrix4(m,a),s.normal.toArray(v,_),v[_+3]=s.constant}l.value=v,l.needsUpdate=!0}return e.numPlanes=g,e.numIntersection=0,v}}function UJ(o){let e=new WeakMap;function t(s,a){return a===FI?s.mapping=m1:a===BI&&(s.mapping=g1),s}function n(s){if(s&&s.isTexture){let a=s.mapping;if(a===FI||a===BI)if(e.has(s)){let l=e.get(s).texture;return t(l,s.mapping)}else{let l=s.image;if(l&&l.height>0){let c=o.getRenderTarget(),u=new $1(l.height/2);return u.fromEquirectangularTexture(o,s),e.set(s,u),o.setRenderTarget(c),s.addEventListener("dispose",i),t(u.texture,s.mapping)}else return null}}return s}function i(s){let a=s.target;a.removeEventListener("dispose",i);let l=e.get(a);l!==void 0&&(e.delete(a),l.dispose())}function r(){e=new WeakMap}return{get:n,dispose:r}}function HJ(o){let e={};function t(n){if(e[n]!==void 0)return e[n];let i;switch(n){case"WEBGL_depth_texture":i=o.getExtension("WEBGL_depth_texture")||o.getExtension("MOZ_WEBGL_depth_texture")||o.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":i=o.getExtension("EXT_texture_filter_anisotropic")||o.getExtension("MOZ_EXT_texture_filter_anisotropic")||o.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":i=o.getExtension("WEBGL_compressed_texture_s3tc")||o.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||o.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":i=o.getExtension("WEBGL_compressed_texture_pvrtc")||o.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:i=o.getExtension(n)}return e[n]=i,i}return{has:function(n){return t(n)!==null},init:function(n){n.isWebGL2?t("EXT_color_buffer_float"):(t("WEBGL_depth_texture"),t("OES_texture_float"),t("OES_texture_half_float"),t("OES_texture_half_float_linear"),t("OES_standard_derivatives"),t("OES_element_index_uint"),t("OES_vertex_array_object"),t("ANGLE_instanced_arrays")),t("OES_texture_float_linear"),t("EXT_color_buffer_half_float")},get:function(n){let i=t(n);return i===null&&console.warn("THREE.WebGLRenderer: "+n+" extension not supported."),i}}}function GJ(o,e,t,n){let i={},r=new WeakMap;function s(d){let h=d.target;h.index!==null&&e.remove(h.index);for(let p in h.attributes)e.remove(h.attributes[p]);h.removeEventListener("dispose",s),delete i[h.id];let f=r.get(h);f&&(e.remove(f),r.delete(h)),n.releaseStatesOfGeometry(h),h.isInstancedBufferGeometry===!0&&delete h._maxInstanceCount,t.memory.geometries--}function a(d,h){return i[h.id]===!0||(h.addEventListener("dispose",s),i[h.id]=!0,t.memory.geometries++),h}function l(d){let h=d.attributes;for(let p in h)e.update(h[p],34962);let f=d.morphAttributes;for(let p in f){let g=f[p];for(let v=0,y=g.length;v<y;v++)e.update(g[v],34962)}}function c(d){let h=[],f=d.index,p=d.attributes.position,g=0;if(f!==null){let m=f.array;g=f.version;for(let x=0,_=m.length;x<_;x+=3){let w=m[x+0],b=m[x+1],M=m[x+2];h.push(w,b,b,M,M,w)}}else{let m=p.array;g=p.version;for(let x=0,_=m.length/3-1;x<_;x+=3){let w=x+0,b=x+1,M=x+2;h.push(w,b,b,M,M,w)}}let v=new(gD(h)>65535?X1:W1)(h,1);v.version=g;let y=r.get(d);y&&e.remove(y),r.set(d,v)}function u(d){let h=r.get(d);if(h){let f=d.index;f!==null&&h.version<f.version&&c(d)}else c(d);return r.get(d)}return{get:a,update:l,getWireframeAttribute:u}}function VJ(o,e,t,n){let i=n.isWebGL2,r;function s(h){r=h}let a,l;function c(h){a=h.type,l=h.bytesPerElement}function u(h,f){o.drawElements(r,f,a,h*l),t.update(f,r,1)}function d(h,f,p){if(p===0)return;let g,v;if(i)g=o,v="drawElementsInstanced";else if(g=e.get("ANGLE_instanced_arrays"),v="drawElementsInstancedANGLE",g===null){console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}g[v](r,f,a,h*l,p),t.update(f,r,p)}this.setMode=s,this.setIndex=c,this.render=u,this.renderInstances=d}function WJ(o){let e={geometries:0,textures:0},t={frame:0,calls:0,triangles:0,points:0,lines:0};function n(r,s,a){switch(t.calls++,s){case 4:t.triangles+=a*(r/3);break;case 1:t.lines+=a*(r/2);break;case 3:t.lines+=a*(r-1);break;case 2:t.lines+=a*r;break;case 0:t.points+=a*r;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",s);break}}function i(){t.frame++,t.calls=0,t.triangles=0,t.points=0,t.lines=0}return{memory:e,render:t,programs:null,autoReset:!0,reset:i,update:n}}function XJ(o,e){return o[0]-e[0]}function qJ(o,e){return Math.abs(e[1])-Math.abs(o[1])}function jJ(o){let e={},t=new Float32Array(8),n=[];for(let r=0;r<8;r++)n[r]=[r,0];function i(r,s,a,l){let c=r.morphTargetInfluences,u=c===void 0?0:c.length,d=e[s.id];if(d===void 0){d=[];for(let v=0;v<u;v++)d[v]=[v,0];e[s.id]=d}for(let v=0;v<u;v++){let y=d[v];y[0]=v,y[1]=c[v]}d.sort(qJ);for(let v=0;v<8;v++)v<u&&d[v][1]?(n[v][0]=d[v][0],n[v][1]=d[v][1]):(n[v][0]=Number.MAX_SAFE_INTEGER,n[v][1]=0);n.sort(XJ);let h=a.morphTargets&&s.morphAttributes.position,f=a.morphNormals&&s.morphAttributes.normal,p=0;for(let v=0;v<8;v++){let y=n[v],m=y[0],x=y[1];m!==Number.MAX_SAFE_INTEGER&&x?(h&&s.getAttribute("morphTarget"+v)!==h[m]&&s.setAttribute("morphTarget"+v,h[m]),f&&s.getAttribute("morphNormal"+v)!==f[m]&&s.setAttribute("morphNormal"+v,f[m]),t[v]=x,p+=x):(h&&s.hasAttribute("morphTarget"+v)===!0&&s.deleteAttribute("morphTarget"+v),f&&s.hasAttribute("morphNormal"+v)===!0&&s.deleteAttribute("morphNormal"+v),t[v]=0)}let g=s.morphTargetsRelative?1:1-p;l.getUniforms().setValue(o,"morphTargetBaseInfluence",g),l.getUniforms().setValue(o,"morphTargetInfluences",t)}return{update:i}}function YJ(o,e,t,n){let i=new WeakMap;function r(l){let c=n.render.frame,u=l.geometry,d=e.get(l,u);return i.get(d)!==c&&(e.update(d),i.set(d,c)),l.isInstancedMesh&&(l.hasEventListener("dispose",a)===!1&&l.addEventListener("dispose",a),t.update(l.instanceMatrix,34962),l.instanceColor!==null&&t.update(l.instanceColor,34962)),d}function s(){i=new WeakMap}function a(l){let c=l.target;c.removeEventListener("dispose",a),t.remove(c.instanceMatrix),c.instanceColor!==null&&t.remove(c.instanceColor)}return{update:r,dispose:s}}var eS=class extends Hn{constructor(e=null,t=1,n=1,i=1){super(null);this.image={data:e,width:t,height:n,depth:i},this.magFilter=Qn,this.minFilter=Qn,this.wrapR=tr,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.needsUpdate=!0}};eS.prototype.isDataTexture2DArray=!0;var tS=class extends Hn{constructor(e=null,t=1,n=1,i=1){super(null);this.image={data:e,width:t,height:n,depth:i},this.magFilter=Qn,this.minFilter=Qn,this.wrapR=tr,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.needsUpdate=!0}};tS.prototype.isDataTexture3D=!0;var xD=new Hn,ZJ=new eS,JJ=new tS,_D=new tm,wD=[],bD=[],MD=new Float32Array(16),SD=new Float32Array(9),TD=new Float32Array(4);function gd(o,e,t){let n=o[0];if(n<=0||n>0)return o;let i=e*t,r=wD[i];if(r===void 0&&(r=new Float32Array(i),wD[i]=r),e!==0){n.toArray(r,0);for(let s=1,a=0;s!==e;++s)a+=t,o[s].toArray(r,a)}return r}function Ri(o,e){if(o.length!==e.length)return!1;for(let t=0,n=o.length;t<n;t++)if(o[t]!==e[t])return!1;return!0}function vi(o,e){for(let t=0,n=e.length;t<n;t++)o[t]=e[t]}function ED(o,e){let t=bD[e];t===void 0&&(t=new Int32Array(e),bD[e]=t);for(let n=0;n!==e;++n)t[n]=o.allocateTextureUnit();return t}function KJ(o,e){let t=this.cache;t[0]!==e&&(o.uniform1f(this.addr,e),t[0]=e)}function $J(o,e){let t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(o.uniform2f(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(Ri(t,e))return;o.uniform2fv(this.addr,e),vi(t,e)}}function QJ(o,e){let t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(o.uniform3f(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else if(e.r!==void 0)(t[0]!==e.r||t[1]!==e.g||t[2]!==e.b)&&(o.uniform3f(this.addr,e.r,e.g,e.b),t[0]=e.r,t[1]=e.g,t[2]=e.b);else{if(Ri(t,e))return;o.uniform3fv(this.addr,e),vi(t,e)}}function eK(o,e){let t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(o.uniform4f(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(Ri(t,e))return;o.uniform4fv(this.addr,e),vi(t,e)}}function tK(o,e){let t=this.cache,n=e.elements;if(n===void 0){if(Ri(t,e))return;o.uniformMatrix2fv(this.addr,!1,e),vi(t,e)}else{if(Ri(t,n))return;TD.set(n),o.uniformMatrix2fv(this.addr,!1,TD),vi(t,n)}}function nK(o,e){let t=this.cache,n=e.elements;if(n===void 0){if(Ri(t,e))return;o.uniformMatrix3fv(this.addr,!1,e),vi(t,e)}else{if(Ri(t,n))return;SD.set(n),o.uniformMatrix3fv(this.addr,!1,SD),vi(t,n)}}function iK(o,e){let t=this.cache,n=e.elements;if(n===void 0){if(Ri(t,e))return;o.uniformMatrix4fv(this.addr,!1,e),vi(t,e)}else{if(Ri(t,n))return;MD.set(n),o.uniformMatrix4fv(this.addr,!1,MD),vi(t,n)}}function rK(o,e){let t=this.cache;t[0]!==e&&(o.uniform1i(this.addr,e),t[0]=e)}function sK(o,e){let t=this.cache;Ri(t,e)||(o.uniform2iv(this.addr,e),vi(t,e))}function oK(o,e){let t=this.cache;Ri(t,e)||(o.uniform3iv(this.addr,e),vi(t,e))}function aK(o,e){let t=this.cache;Ri(t,e)||(o.uniform4iv(this.addr,e),vi(t,e))}function lK(o,e){let t=this.cache;t[0]!==e&&(o.uniform1ui(this.addr,e),t[0]=e)}function cK(o,e){let t=this.cache;Ri(t,e)||(o.uniform2uiv(this.addr,e),vi(t,e))}function uK(o,e){let t=this.cache;Ri(t,e)||(o.uniform3uiv(this.addr,e),vi(t,e))}function hK(o,e){let t=this.cache;Ri(t,e)||(o.uniform4uiv(this.addr,e),vi(t,e))}function dK(o,e,t){let n=this.cache,i=t.allocateTextureUnit();n[0]!==i&&(o.uniform1i(this.addr,i),n[0]=i),t.safeSetTexture2D(e||xD,i)}function fK(o,e,t){let n=this.cache,i=t.allocateTextureUnit();n[0]!==i&&(o.uniform1i(this.addr,i),n[0]=i),t.setTexture3D(e||JJ,i)}function pK(o,e,t){let n=this.cache,i=t.allocateTextureUnit();n[0]!==i&&(o.uniform1i(this.addr,i),n[0]=i),t.safeSetTextureCube(e||_D,i)}function mK(o,e,t){let n=this.cache,i=t.allocateTextureUnit();n[0]!==i&&(o.uniform1i(this.addr,i),n[0]=i),t.setTexture2DArray(e||ZJ,i)}function gK(o){switch(o){case 5126:return KJ;case 35664:return $J;case 35665:return QJ;case 35666:return eK;case 35674:return tK;case 35675:return nK;case 35676:return iK;case 5124:case 35670:return rK;case 35667:case 35671:return sK;case 35668:case 35672:return oK;case 35669:case 35673:return aK;case 5125:return lK;case 36294:return cK;case 36295:return uK;case 36296:return hK;case 35678:case 36198:case 36298:case 36306:case 35682:return dK;case 35679:case 36299:case 36307:return fK;case 35680:case 36300:case 36308:case 36293:return pK;case 36289:case 36303:case 36311:case 36292:return mK}}function yK(o,e){o.uniform1fv(this.addr,e)}function vK(o,e){let t=gd(e,this.size,2);o.uniform2fv(this.addr,t)}function xK(o,e){let t=gd(e,this.size,3);o.uniform3fv(this.addr,t)}function _K(o,e){let t=gd(e,this.size,4);o.uniform4fv(this.addr,t)}function wK(o,e){let t=gd(e,this.size,4);o.uniformMatrix2fv(this.addr,!1,t)}function bK(o,e){let t=gd(e,this.size,9);o.uniformMatrix3fv(this.addr,!1,t)}function MK(o,e){let t=gd(e,this.size,16);o.uniformMatrix4fv(this.addr,!1,t)}function SK(o,e){o.uniform1iv(this.addr,e)}function TK(o,e){o.uniform2iv(this.addr,e)}function EK(o,e){o.uniform3iv(this.addr,e)}function AK(o,e){o.uniform4iv(this.addr,e)}function CK(o,e){o.uniform1uiv(this.addr,e)}function LK(o,e){o.uniform2uiv(this.addr,e)}function RK(o,e){o.uniform3uiv(this.addr,e)}function PK(o,e){o.uniform4uiv(this.addr,e)}function IK(o,e,t){let n=e.length,i=ED(t,n);o.uniform1iv(this.addr,i);for(let r=0;r!==n;++r)t.safeSetTexture2D(e[r]||xD,i[r])}function DK(o,e,t){let n=e.length,i=ED(t,n);o.uniform1iv(this.addr,i);for(let r=0;r!==n;++r)t.safeSetTextureCube(e[r]||_D,i[r])}function FK(o){switch(o){case 5126:return yK;case 35664:return vK;case 35665:return xK;case 35666:return _K;case 35674:return wK;case 35675:return bK;case 35676:return MK;case 5124:case 35670:return SK;case 35667:case 35671:return TK;case 35668:case 35672:return EK;case 35669:case 35673:return AK;case 5125:return CK;case 36294:return LK;case 36295:return RK;case 36296:return PK;case 35678:case 36198:case 36298:case 36306:case 35682:return IK;case 35680:case 36300:case 36308:case 36293:return DK}}function BK(o,e,t){this.id=o,this.addr=t,this.cache=[],this.setValue=gK(e.type)}function AD(o,e,t){this.id=o,this.addr=t,this.cache=[],this.size=e.size,this.setValue=FK(e.type)}AD.prototype.updateCache=function(o){let e=this.cache;o instanceof Float32Array&&e.length!==o.length&&(this.cache=new Float32Array(o.length)),vi(e,o)};function CD(o){this.id=o,this.seq=[],this.map={}}CD.prototype.setValue=function(o,e,t){let n=this.seq;for(let i=0,r=n.length;i!==r;++i){let s=n[i];s.setValue(o,e[s.id],t)}};var nS=/(\w+)(\])?(\[|\.)?/g;function LD(o,e){o.seq.push(e),o.map[e.id]=e}function NK(o,e,t){let n=o.name,i=n.length;for(nS.lastIndex=0;;){let r=nS.exec(n),s=nS.lastIndex,a=r[1],l=r[2]==="]",c=r[3];if(l&&(a=a|0),c===void 0||c==="["&&s+2===i){LD(t,c===void 0?new BK(a,o,e):new AD(a,o,e));break}else{let d=t.map[a];d===void 0&&(d=new CD(a),LD(t,d)),t=d}}}function $a(o,e){this.seq=[],this.map={};let t=o.getProgramParameter(e,35718);for(let n=0;n<t;++n){let i=o.getActiveUniform(e,n),r=o.getUniformLocation(e,i.name);NK(i,r,this)}}$a.prototype.setValue=function(o,e,t,n){let i=this.map[e];i!==void 0&&i.setValue(o,t,n)};$a.prototype.setOptional=function(o,e,t){let n=e[t];n!==void 0&&this.setValue(o,t,n)};$a.upload=function(o,e,t,n){for(let i=0,r=e.length;i!==r;++i){let s=e[i],a=t[s.id];a.needsUpdate!==!1&&s.setValue(o,a.value,n)}};$a.seqWithValue=function(o,e){let t=[];for(let n=0,i=o.length;n!==i;++n){let r=o[n];r.id in e&&t.push(r)}return t};function RD(o,e,t){let n=o.createShader(e);return o.shaderSource(n,t),o.compileShader(n),n}var OK=0;function kK(o){let e=o.split(`
`);for(let t=0;t<e.length;t++)e[t]=t+1+": "+e[t];return e.join(`
`)}function PD(o){switch(o){case Qh:return["Linear","( value )"];case ed:return["sRGB","( value )"];case YI:return["RGBE","( value )"];case ZI:return["RGBM","( value, 7.0 )"];case JI:return["RGBM","( value, 16.0 )"];case KI:return["RGBD","( value, 256.0 )"];case jI:return["Gamma","( value, float( GAMMA_FACTOR ) )"];case Dj:return["LogLuv","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported encoding:",o),["Linear","( value )"]}}function ID(o,e,t){let n=o.getShaderParameter(e,35713),i=o.getShaderInfoLog(e).trim();if(n&&i==="")return"";let r=o.getShaderSource(e);return"THREE.WebGLShader: gl.getShaderInfoLog() "+t+`
`+i+kK(r)}function im(o,e){let t=PD(e);return"vec4 "+o+"( vec4 value ) { return "+t[0]+"ToLinear"+t[1]+"; }"}function zK(o,e){let t=PD(e);return"vec4 "+o+"( vec4 value ) { return LinearTo"+t[0]+t[1]+"; }"}function UK(o,e){let t;switch(e){case Fq:t="Linear";break;case Bq:t="Reinhard";break;case Nq:t="OptimizedCineon";break;case Oq:t="ACESFilmic";break;case kq:t="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",e),t="Linear"}return"vec3 "+o+"( vec3 color ) { return "+t+"ToneMapping( color ); }"}function HK(o){return[o.extensionDerivatives||o.envMapCubeUV||o.bumpMap||o.tangentSpaceNormalMap||o.clearcoatNormalMap||o.flatShading||o.shaderID==="physical"?"#extension GL_OES_standard_derivatives : enable":"",(o.extensionFragDepth||o.logarithmicDepthBuffer)&&o.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",o.extensionDrawBuffers&&o.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(o.extensionShaderTextureLOD||o.envMap)&&o.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(rm).join(`
`)}function GK(o){let e=[];for(let t in o){let n=o[t];n!==!1&&e.push("#define "+t+" "+n)}return e.join(`
`)}function VK(o,e){let t={},n=o.getProgramParameter(e,35721);for(let i=0;i<n;i++){let s=o.getActiveAttrib(e,i).name;t[s]=o.getAttribLocation(e,s)}return t}function rm(o){return o!==""}function DD(o,e){return o.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function FD(o,e){return o.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}var WK=/^[ \t]*#include +<([\w\d./]+)>/gm;function iS(o){return o.replace(WK,XK)}function XK(o,e){let t=ht[e];if(t===void 0)throw new Error("Can not resolve #include <"+e+">");return iS(t)}var qK=/#pragma unroll_loop[\s]+?for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g,jK=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function BD(o){return o.replace(jK,ND).replace(qK,YK)}function YK(o,e,t,n){return console.warn("WebGLProgram: #pragma unroll_loop shader syntax is deprecated. Please use #pragma unroll_loop_start syntax instead."),ND(o,e,t,n)}function ND(o,e,t,n){let i="";for(let r=parseInt(e);r<parseInt(t);r++)i+=n.replace(/\[\s*i\s*\]/g,"[ "+r+" ]").replace(/UNROLLED_LOOP_INDEX/g,r);return i}function OD(o){let e="precision "+o.precision+` float;
precision `+o.precision+" int;";return o.precision==="highp"?e+=`
#define HIGH_PRECISION`:o.precision==="mediump"?e+=`
#define MEDIUM_PRECISION`:o.precision==="lowp"&&(e+=`
#define LOW_PRECISION`),e}function ZK(o){let e="SHADOWMAP_TYPE_BASIC";return o.shadowMapType===SI?e="SHADOWMAP_TYPE_PCF":o.shadowMapType===dq?e="SHADOWMAP_TYPE_PCF_SOFT":o.shadowMapType===Up&&(e="SHADOWMAP_TYPE_VSM"),e}function JK(o){let e="ENVMAP_TYPE_CUBE";if(o.envMap)switch(o.envMapMode){case m1:case g1:e="ENVMAP_TYPE_CUBE";break;case y1:case v1:e="ENVMAP_TYPE_CUBE_UV";break}return e}function KK(o){let e="ENVMAP_MODE_REFLECTION";if(o.envMap)switch(o.envMapMode){case g1:case v1:e="ENVMAP_MODE_REFRACTION";break}return e}function $K(o){let e="ENVMAP_BLENDING_NONE";if(o.envMap)switch(o.combine){case cv:e="ENVMAP_BLENDING_MULTIPLY";break;case Iq:e="ENVMAP_BLENDING_MIX";break;case Dq:e="ENVMAP_BLENDING_ADD";break}return e}function QK(o,e,t,n){let i=o.getContext(),r=t.defines,s=t.vertexShader,a=t.fragmentShader,l=ZK(t),c=JK(t),u=KK(t),d=$K(t),h=o.gammaFactor>0?o.gammaFactor:1,f=t.isWebGL2?"":HK(t),p=GK(r),g=i.createProgram(),v,y,m=t.glslVersion?"#version "+t.glslVersion+`
`:"";t.isRawShaderMaterial?(v=[p].filter(rm).join(`
`),v.length>0&&(v+=`
`),y=[f,p].filter(rm).join(`
`),y.length>0&&(y+=`
`)):(v=[OD(t),"#define SHADER_NAME "+t.shaderName,p,t.instancing?"#define USE_INSTANCING":"",t.instancingColor?"#define USE_INSTANCING_COLOR":"",t.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define GAMMA_FACTOR "+h,"#define MAX_BONES "+t.maxBones,t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.map?"#define USE_MAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+u:"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMap&&t.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",t.normalMap&&t.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.displacementMap&&t.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.vertexTangents?"#define USE_TANGENT":"",t.vertexColors?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUvs?"#define USE_UV":"",t.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",t.flatShading?"#define FLAT_SHADED":"",t.skinning?"#define USE_SKINNING":"",t.useVertexTexture?"#define BONE_TEXTURE":"",t.morphTargets?"#define USE_MORPHTARGETS":"",t.morphNormals&&t.flatShading===!1?"#define USE_MORPHNORMALS":"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+l:"",t.sizeAttenuation?"#define USE_SIZEATTENUATION":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",t.logarithmicDepthBuffer&&t.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","	attribute vec3 morphTarget0;","	attribute vec3 morphTarget1;","	attribute vec3 morphTarget2;","	attribute vec3 morphTarget3;","	#ifdef USE_MORPHNORMALS","		attribute vec3 morphNormal0;","		attribute vec3 morphNormal1;","		attribute vec3 morphNormal2;","		attribute vec3 morphNormal3;","	#else","		attribute vec3 morphTarget4;","		attribute vec3 morphTarget5;","		attribute vec3 morphTarget6;","		attribute vec3 morphTarget7;","	#endif","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(rm).join(`
`),y=[f,OD(t),"#define SHADER_NAME "+t.shaderName,p,t.alphaTest?"#define ALPHATEST "+t.alphaTest+(t.alphaTest%1?"":".0"):"","#define GAMMA_FACTOR "+h,t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.map?"#define USE_MAP":"",t.matcap?"#define USE_MATCAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+c:"",t.envMap?"#define "+u:"",t.envMap?"#define "+d:"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMap&&t.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",t.normalMap&&t.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.sheen?"#define USE_SHEEN":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.vertexTangents?"#define USE_TANGENT":"",t.vertexColors||t.instancingColor?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUvs?"#define USE_UV":"",t.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",t.gradientMap?"#define USE_GRADIENTMAP":"",t.flatShading?"#define FLAT_SHADED":"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+l:"",t.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",t.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",t.logarithmicDepthBuffer&&t.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"",(t.extensionShaderTextureLOD||t.envMap)&&t.rendererExtensionShaderTextureLod?"#define TEXTURE_LOD_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",t.toneMapping!==Vp?"#define TONE_MAPPING":"",t.toneMapping!==Vp?ht.tonemapping_pars_fragment:"",t.toneMapping!==Vp?UK("toneMapping",t.toneMapping):"",t.dithering?"#define DITHERING":"",ht.encodings_pars_fragment,t.map?im("mapTexelToLinear",t.mapEncoding):"",t.matcap?im("matcapTexelToLinear",t.matcapEncoding):"",t.envMap?im("envMapTexelToLinear",t.envMapEncoding):"",t.emissiveMap?im("emissiveMapTexelToLinear",t.emissiveMapEncoding):"",t.lightMap?im("lightMapTexelToLinear",t.lightMapEncoding):"",zK("linearToOutputTexel",t.outputEncoding),t.depthPacking?"#define DEPTH_PACKING "+t.depthPacking:"",`
`].filter(rm).join(`
`)),s=iS(s),s=DD(s,t),s=FD(s,t),a=iS(a),a=DD(a,t),a=FD(a,t),s=BD(s),a=BD(a),t.isWebGL2&&t.isRawShaderMaterial!==!0&&(m=`#version 300 es
`,v=["#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+v,y=["#define varying in",t.glslVersion===$I?"":"out highp vec4 pc_fragColor;",t.glslVersion===$I?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+y);let x=m+v+s,_=m+y+a,w=RD(i,35633,x),b=RD(i,35632,_);if(i.attachShader(g,w),i.attachShader(g,b),t.index0AttributeName!==void 0?i.bindAttribLocation(g,0,t.index0AttributeName):t.morphTargets===!0&&i.bindAttribLocation(g,0,"position"),i.linkProgram(g),o.debug.checkShaderErrors){let E=i.getProgramInfoLog(g).trim(),A=i.getShaderInfoLog(w).trim(),L=i.getShaderInfoLog(b).trim(),B=!0,R=!0;if(i.getProgramParameter(g,35714)===!1){B=!1;let D=ID(i,w,"vertex"),P=ID(i,b,"fragment");console.error("THREE.WebGLProgram: shader error: ",i.getError(),"35715",i.getProgramParameter(g,35715),"gl.getProgramInfoLog",E,D,P)}else E!==""?console.warn("THREE.WebGLProgram: gl.getProgramInfoLog()",E):(A===""||L==="")&&(R=!1);R&&(this.diagnostics={runnable:B,programLog:E,vertexShader:{log:A,prefix:v},fragmentShader:{log:L,prefix:y}})}i.deleteShader(w),i.deleteShader(b);let M;this.getUniforms=function(){return M===void 0&&(M=new $a(i,g)),M};let S;return this.getAttributes=function(){return S===void 0&&(S=VK(i,g)),S},this.destroy=function(){n.releaseStatesOfProgram(this),i.deleteProgram(g),this.program=void 0},this.name=t.shaderName,this.id=OK++,this.cacheKey=e,this.usedTimes=1,this.program=g,this.vertexShader=w,this.fragmentShader=b,this}function e$(o,e,t,n,i,r){let s=[],a=n.isWebGL2,l=n.logarithmicDepthBuffer,c=n.floatVertexTextures,u=n.maxVertexUniforms,d=n.vertexTextures,h=n.precision,f={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"},p=["precision","isWebGL2","supportsVertexTextures","outputEncoding","instancing","instancingColor","map","mapEncoding","matcap","matcapEncoding","envMap","envMapMode","envMapEncoding","envMapCubeUV","lightMap","lightMapEncoding","aoMap","emissiveMap","emissiveMapEncoding","bumpMap","normalMap","objectSpaceNormalMap","tangentSpaceNormalMap","clearcoatMap","clearcoatRoughnessMap","clearcoatNormalMap","displacementMap","specularMap","roughnessMap","metalnessMap","gradientMap","alphaMap","combine","vertexColors","vertexAlphas","vertexTangents","vertexUvs","uvsVertexOnly","fog","useFog","fogExp2","flatShading","sizeAttenuation","logarithmicDepthBuffer","skinning","maxBones","useVertexTexture","morphTargets","morphNormals","premultipliedAlpha","numDirLights","numPointLights","numSpotLights","numHemiLights","numRectAreaLights","numDirLightShadows","numPointLightShadows","numSpotLightShadows","shadowMapEnabled","shadowMapType","toneMapping","physicallyCorrectLights","alphaTest","doubleSided","flipSided","numClippingPlanes","numClipIntersection","depthPacking","dithering","sheen","transmissionMap"];function g(b){let S=b.skeleton.bones;if(c)return 1024;{let A=Math.floor((u-20)/4),L=Math.min(A,S.length);return L<S.length?(console.warn("THREE.WebGLRenderer: Skeleton has "+S.length+" bones. This GPU supports "+L+"."),0):L}}function v(b){let M;return b&&b.isTexture?M=b.encoding:b&&b.isWebGLRenderTarget?(console.warn("THREE.WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead."),M=b.texture.encoding):M=Qh,M}function y(b,M,S,E,A){let L=E.fog,B=b.isMeshStandardMaterial?E.environment:null,R=e.get(b.envMap||B),D=f[b.type],P=A.isSkinnedMesh?g(A):0;b.precision!==null&&(h=n.getMaxPrecision(b.precision),h!==b.precision&&console.warn("THREE.WebGLProgram.getParameters:",b.precision,"not supported, using",h,"instead."));let I,N;if(D){let se=Ns[D];I=se.vertexShader,N=se.fragmentShader}else I=b.vertexShader,N=b.fragmentShader;let G=o.getRenderTarget();return{isWebGL2:a,shaderID:D,shaderName:b.type,vertexShader:I,fragmentShader:N,defines:b.defines,isRawShaderMaterial:b.isRawShaderMaterial===!0,glslVersion:b.glslVersion,precision:h,instancing:A.isInstancedMesh===!0,instancingColor:A.isInstancedMesh===!0&&A.instanceColor!==null,supportsVertexTextures:d,outputEncoding:G!==null?v(G.texture):o.outputEncoding,map:!!b.map,mapEncoding:v(b.map),matcap:!!b.matcap,matcapEncoding:v(b.matcap),envMap:!!R,envMapMode:R&&R.mapping,envMapEncoding:v(R),envMapCubeUV:!!R&&(R.mapping===y1||R.mapping===v1),lightMap:!!b.lightMap,lightMapEncoding:v(b.lightMap),aoMap:!!b.aoMap,emissiveMap:!!b.emissiveMap,emissiveMapEncoding:v(b.emissiveMap),bumpMap:!!b.bumpMap,normalMap:!!b.normalMap,objectSpaceNormalMap:b.normalMapType===Nj,tangentSpaceNormalMap:b.normalMapType===Ga,clearcoatMap:!!b.clearcoatMap,clearcoatRoughnessMap:!!b.clearcoatRoughnessMap,clearcoatNormalMap:!!b.clearcoatNormalMap,displacementMap:!!b.displacementMap,roughnessMap:!!b.roughnessMap,metalnessMap:!!b.metalnessMap,specularMap:!!b.specularMap,alphaMap:!!b.alphaMap,gradientMap:!!b.gradientMap,sheen:!!b.sheen,transmissionMap:!!b.transmissionMap,combine:b.combine,vertexTangents:b.normalMap&&b.vertexTangents,vertexColors:b.vertexColors,vertexAlphas:b.vertexColors===!0&&A.geometry&&A.geometry.attributes.color&&A.geometry.attributes.color.itemSize===4,vertexUvs:!!b.map||!!b.bumpMap||!!b.normalMap||!!b.specularMap||!!b.alphaMap||!!b.emissiveMap||!!b.roughnessMap||!!b.metalnessMap||!!b.clearcoatMap||!!b.clearcoatRoughnessMap||!!b.clearcoatNormalMap||!!b.displacementMap||!!b.transmissionMap,uvsVertexOnly:!(!!b.map||!!b.bumpMap||!!b.normalMap||!!b.specularMap||!!b.alphaMap||!!b.emissiveMap||!!b.roughnessMap||!!b.metalnessMap||!!b.clearcoatNormalMap||!!b.transmissionMap)&&!!b.displacementMap,fog:!!L,useFog:b.fog,fogExp2:L&&L.isFogExp2,flatShading:!!b.flatShading,sizeAttenuation:b.sizeAttenuation,logarithmicDepthBuffer:l,skinning:b.skinning&&P>0,maxBones:P,useVertexTexture:c,morphTargets:b.morphTargets,morphNormals:b.morphNormals,numDirLights:M.directional.length,numPointLights:M.point.length,numSpotLights:M.spot.length,numRectAreaLights:M.rectArea.length,numHemiLights:M.hemi.length,numDirLightShadows:M.directionalShadowMap.length,numPointLightShadows:M.pointShadowMap.length,numSpotLightShadows:M.spotShadowMap.length,numClippingPlanes:r.numPlanes,numClipIntersection:r.numIntersection,dithering:b.dithering,shadowMapEnabled:o.shadowMap.enabled&&S.length>0,shadowMapType:o.shadowMap.type,toneMapping:b.toneMapped?o.toneMapping:Vp,physicallyCorrectLights:o.physicallyCorrectLights,premultipliedAlpha:b.premultipliedAlpha,alphaTest:b.alphaTest,doubleSided:b.side===Xh,flipSided:b.side===zn,depthPacking:b.depthPacking!==void 0?b.depthPacking:!1,index0AttributeName:b.index0AttributeName,extensionDerivatives:b.extensions&&b.extensions.derivatives,extensionFragDepth:b.extensions&&b.extensions.fragDepth,extensionDrawBuffers:b.extensions&&b.extensions.drawBuffers,extensionShaderTextureLOD:b.extensions&&b.extensions.shaderTextureLOD,rendererExtensionFragDepth:a||t.has("EXT_frag_depth"),rendererExtensionDrawBuffers:a||t.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:a||t.has("EXT_shader_texture_lod"),customProgramCacheKey:b.customProgramCacheKey()}}function m(b){let M=[];if(b.shaderID?M.push(b.shaderID):(M.push(b.fragmentShader),M.push(b.vertexShader)),b.defines!==void 0)for(let S in b.defines)M.push(S),M.push(b.defines[S]);if(b.isRawShaderMaterial===!1){for(let S=0;S<p.length;S++)M.push(b[p[S]]);M.push(o.outputEncoding),M.push(o.gammaFactor)}return M.push(b.customProgramCacheKey),M.join()}function x(b){let M=f[b.type],S;if(M){let E=Ns[M];S=uY.clone(E.uniforms)}else S=b.uniforms;return S}function _(b,M){let S;for(let E=0,A=s.length;E<A;E++){let L=s[E];if(L.cacheKey===M){S=L,++S.usedTimes;break}}return S===void 0&&(S=new QK(o,M,b,i),s.push(S)),S}function w(b){if(--b.usedTimes==0){let M=s.indexOf(b);s[M]=s[s.length-1],s.pop(),b.destroy()}}return{getParameters:y,getProgramCacheKey:m,getUniforms:x,acquireProgram:_,releaseProgram:w,programs:s}}function t$(){let o=new WeakMap;function e(r){let s=o.get(r);return s===void 0&&(s={},o.set(r,s)),s}function t(r){o.delete(r)}function n(r,s,a){o.get(r)[s]=a}function i(){o=new WeakMap}return{get:e,remove:t,update:n,dispose:i}}function n$(o,e){return o.groupOrder!==e.groupOrder?o.groupOrder-e.groupOrder:o.renderOrder!==e.renderOrder?o.renderOrder-e.renderOrder:o.program!==e.program?o.program.id-e.program.id:o.material.id!==e.material.id?o.material.id-e.material.id:o.z!==e.z?o.z-e.z:o.id-e.id}function i$(o,e){return o.groupOrder!==e.groupOrder?o.groupOrder-e.groupOrder:o.renderOrder!==e.renderOrder?o.renderOrder-e.renderOrder:o.z!==e.z?e.z-o.z:o.id-e.id}function kD(o){let e=[],t=0,n=[],i=[],r={id:-1};function s(){t=0,n.length=0,i.length=0}function a(h,f,p,g,v,y){let m=e[t],x=o.get(p);return m===void 0?(m={id:h.id,object:h,geometry:f,material:p,program:x.program||r,groupOrder:g,renderOrder:h.renderOrder,z:v,group:y},e[t]=m):(m.id=h.id,m.object=h,m.geometry=f,m.material=p,m.program=x.program||r,m.groupOrder=g,m.renderOrder=h.renderOrder,m.z=v,m.group=y),t++,m}function l(h,f,p,g,v,y){let m=a(h,f,p,g,v,y);(p.transparent===!0?i:n).push(m)}function c(h,f,p,g,v,y){let m=a(h,f,p,g,v,y);(p.transparent===!0?i:n).unshift(m)}function u(h,f){n.length>1&&n.sort(h||n$),i.length>1&&i.sort(f||i$)}function d(){for(let h=t,f=e.length;h<f;h++){let p=e[h];if(p.id===null)break;p.id=null,p.object=null,p.geometry=null,p.material=null,p.program=null,p.group=null}}return{opaque:n,transparent:i,init:s,push:l,unshift:c,finish:d,sort:u}}function r$(o){let e=new WeakMap;function t(i,r){let s;return e.has(i)===!1?(s=new kD(o),e.set(i,[s])):r>=e.get(i).length?(s=new kD(o),e.get(i).push(s)):s=e.get(i)[r],s}function n(){e=new WeakMap}return{get:t,dispose:n}}function s$(){let o={};return{get:function(e){if(o[e.id]!==void 0)return o[e.id];let t;switch(e.type){case"DirectionalLight":t={direction:new ae,color:new qe};break;case"SpotLight":t={position:new ae,direction:new ae,color:new qe,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":t={position:new ae,color:new qe,distance:0,decay:0};break;case"HemisphereLight":t={direction:new ae,skyColor:new qe,groundColor:new qe};break;case"RectAreaLight":t={color:new qe,position:new ae,halfWidth:new ae,halfHeight:new ae};break}return o[e.id]=t,t}}}function o$(){let o={};return{get:function(e){if(o[e.id]!==void 0)return o[e.id];let t;switch(e.type){case"DirectionalLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Oe};break;case"SpotLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Oe};break;case"PointLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Oe,shadowCameraNear:1,shadowCameraFar:1e3};break}return o[e.id]=t,t}}}var a$=0;function l$(o,e){return(e.castShadow?1:0)-(o.castShadow?1:0)}function c$(o,e){let t=new s$,n=o$(),i={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadow:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[]};for(let u=0;u<9;u++)i.probe.push(new ae);let r=new ae,s=new Ze,a=new Ze;function l(u){let d=0,h=0,f=0;for(let M=0;M<9;M++)i.probe[M].set(0,0,0);let p=0,g=0,v=0,y=0,m=0,x=0,_=0,w=0;u.sort(l$);for(let M=0,S=u.length;M<S;M++){let E=u[M],A=E.color,L=E.intensity,B=E.distance,R=E.shadow&&E.shadow.map?E.shadow.map.texture:null;if(E.isAmbientLight)d+=A.r*L,h+=A.g*L,f+=A.b*L;else if(E.isLightProbe)for(let D=0;D<9;D++)i.probe[D].addScaledVector(E.sh.coefficients[D],L);else if(E.isDirectionalLight){let D=t.get(E);if(D.color.copy(E.color).multiplyScalar(E.intensity),E.castShadow){let P=E.shadow,I=n.get(E);I.shadowBias=P.bias,I.shadowNormalBias=P.normalBias,I.shadowRadius=P.radius,I.shadowMapSize=P.mapSize,i.directionalShadow[p]=I,i.directionalShadowMap[p]=R,i.directionalShadowMatrix[p]=E.shadow.matrix,x++}i.directional[p]=D,p++}else if(E.isSpotLight){let D=t.get(E);if(D.position.setFromMatrixPosition(E.matrixWorld),D.color.copy(A).multiplyScalar(L),D.distance=B,D.coneCos=Math.cos(E.angle),D.penumbraCos=Math.cos(E.angle*(1-E.penumbra)),D.decay=E.decay,E.castShadow){let P=E.shadow,I=n.get(E);I.shadowBias=P.bias,I.shadowNormalBias=P.normalBias,I.shadowRadius=P.radius,I.shadowMapSize=P.mapSize,i.spotShadow[v]=I,i.spotShadowMap[v]=R,i.spotShadowMatrix[v]=E.shadow.matrix,w++}i.spot[v]=D,v++}else if(E.isRectAreaLight){let D=t.get(E);D.color.copy(A).multiplyScalar(L),D.halfWidth.set(E.width*.5,0,0),D.halfHeight.set(0,E.height*.5,0),i.rectArea[y]=D,y++}else if(E.isPointLight){let D=t.get(E);if(D.color.copy(E.color).multiplyScalar(E.intensity),D.distance=E.distance,D.decay=E.decay,E.castShadow){let P=E.shadow,I=n.get(E);I.shadowBias=P.bias,I.shadowNormalBias=P.normalBias,I.shadowRadius=P.radius,I.shadowMapSize=P.mapSize,I.shadowCameraNear=P.camera.near,I.shadowCameraFar=P.camera.far,i.pointShadow[g]=I,i.pointShadowMap[g]=R,i.pointShadowMatrix[g]=E.shadow.matrix,_++}i.point[g]=D,g++}else if(E.isHemisphereLight){let D=t.get(E);D.skyColor.copy(E.color).multiplyScalar(L),D.groundColor.copy(E.groundColor).multiplyScalar(L),i.hemi[m]=D,m++}}y>0&&(e.isWebGL2||o.has("OES_texture_float_linear")===!0?(i.rectAreaLTC1=Ve.LTC_FLOAT_1,i.rectAreaLTC2=Ve.LTC_FLOAT_2):o.has("OES_texture_half_float_linear")===!0?(i.rectAreaLTC1=Ve.LTC_HALF_1,i.rectAreaLTC2=Ve.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),i.ambient[0]=d,i.ambient[1]=h,i.ambient[2]=f;let b=i.hash;(b.directionalLength!==p||b.pointLength!==g||b.spotLength!==v||b.rectAreaLength!==y||b.hemiLength!==m||b.numDirectionalShadows!==x||b.numPointShadows!==_||b.numSpotShadows!==w)&&(i.directional.length=p,i.spot.length=v,i.rectArea.length=y,i.point.length=g,i.hemi.length=m,i.directionalShadow.length=x,i.directionalShadowMap.length=x,i.pointShadow.length=_,i.pointShadowMap.length=_,i.spotShadow.length=w,i.spotShadowMap.length=w,i.directionalShadowMatrix.length=x,i.pointShadowMatrix.length=_,i.spotShadowMatrix.length=w,b.directionalLength=p,b.pointLength=g,b.spotLength=v,b.rectAreaLength=y,b.hemiLength=m,b.numDirectionalShadows=x,b.numPointShadows=_,b.numSpotShadows=w,i.version=a$++)}function c(u,d){let h=0,f=0,p=0,g=0,v=0,y=d.matrixWorldInverse;for(let m=0,x=u.length;m<x;m++){let _=u[m];if(_.isDirectionalLight){let w=i.directional[h];w.direction.setFromMatrixPosition(_.matrixWorld),r.setFromMatrixPosition(_.target.matrixWorld),w.direction.sub(r),w.direction.transformDirection(y),h++}else if(_.isSpotLight){let w=i.spot[p];w.position.setFromMatrixPosition(_.matrixWorld),w.position.applyMatrix4(y),w.direction.setFromMatrixPosition(_.matrixWorld),r.setFromMatrixPosition(_.target.matrixWorld),w.direction.sub(r),w.direction.transformDirection(y),p++}else if(_.isRectAreaLight){let w=i.rectArea[g];w.position.setFromMatrixPosition(_.matrixWorld),w.position.applyMatrix4(y),a.identity(),s.copy(_.matrixWorld),s.premultiply(y),a.extractRotation(s),w.halfWidth.set(_.width*.5,0,0),w.halfHeight.set(0,_.height*.5,0),w.halfWidth.applyMatrix4(a),w.halfHeight.applyMatrix4(a),g++}else if(_.isPointLight){let w=i.point[f];w.position.setFromMatrixPosition(_.matrixWorld),w.position.applyMatrix4(y),f++}else if(_.isHemisphereLight){let w=i.hemi[v];w.direction.setFromMatrixPosition(_.matrixWorld),w.direction.transformDirection(y),w.direction.normalize(),v++}}}return{setup:l,setupView:c,state:i}}function zD(o,e){let t=new c$(o,e),n=[],i=[];function r(){n.length=0,i.length=0}function s(d){n.push(d)}function a(d){i.push(d)}function l(){t.setup(n)}function c(d){t.setupView(n,d)}return{init:r,state:{lightsArray:n,shadowsArray:i,lights:t},setupLights:l,setupLightsView:c,pushLight:s,pushShadow:a}}function u$(o,e){let t=new WeakMap;function n(r,s=0){let a;return t.has(r)===!1?(a=new zD(o,e),t.set(r,[a])):s>=t.get(r).length?(a=new zD(o,e),t.get(r).push(a)):a=t.get(r)[s],a}function i(){t=new WeakMap}return{get:n,dispose:i}}var rS=class extends bn{constructor(e){super();this.type="MeshDepthMaterial",this.depthPacking=Fj,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}};rS.prototype.isMeshDepthMaterial=!0;var sS=class extends bn{constructor(e){super();this.type="MeshDistanceMaterial",this.referencePosition=new ae,this.nearDistance=1,this.farDistance=1e3,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.fog=!1,this.setValues(e)}copy(e){return super.copy(e),this.referencePosition.copy(e.referencePosition),this.nearDistance=e.nearDistance,this.farDistance=e.farDistance,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}};sS.prototype.isMeshDistanceMaterial=!0;var h$=`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
	float mean = 0.0;
	float squared_mean = 0.0;
	float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy ) / resolution ) );
	for ( float i = -1.0; i < 1.0 ; i += SAMPLE_RATE) {
		#ifdef HORIZONTAL_PASS
			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( i, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, i ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean * HALF_SAMPLE_RATE;
	squared_mean = squared_mean * HALF_SAMPLE_RATE;
	float std_dev = sqrt( squared_mean - mean * mean );
	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`,d$=`void main() {
	gl_Position = vec4( position, 1.0 );
}`;function UD(o,e,t){let n=new nm,i=new Oe,r=new Oe,s=new Dt,a=[],l=[],c={},u=t.maxTextureSize,d={0:zn,1:Wh,2:Xh},h=new ss({defines:{SAMPLE_RATE:2/8,HALF_SAMPLE_RATE:1/8},uniforms:{shadow_pass:{value:null},resolution:{value:new Oe},radius:{value:4}},vertexShader:d$,fragmentShader:h$}),f=h.clone();f.defines.HORIZONTAL_PASS=1;let p=new Et;p.setAttribute("position",new jt(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));let g=new Vn(p,h),v=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=SI,this.render=function(b,M,S){if(v.enabled===!1||v.autoUpdate===!1&&v.needsUpdate===!1||b.length===0)return;let E=o.getRenderTarget(),A=o.getActiveCubeFace(),L=o.getActiveMipmapLevel(),B=o.state;B.setBlending(Hp),B.buffers.color.setClear(1,1,1,1),B.buffers.depth.setTest(!0),B.setScissorTest(!1);for(let R=0,D=b.length;R<D;R++){let P=b[R],I=P.shadow;if(I===void 0){console.warn("THREE.WebGLShadowMap:",P,"has no shadow.");continue}if(I.autoUpdate===!1&&I.needsUpdate===!1)continue;i.copy(I.mapSize);let N=I.getFrameExtents();if(i.multiply(N),r.copy(I.mapSize),(i.x>u||i.y>u)&&(i.x>u&&(r.x=Math.floor(u/N.x),i.x=r.x*N.x,I.mapSize.x=r.x),i.y>u&&(r.y=Math.floor(u/N.y),i.y=r.y*N.y,I.mapSize.y=r.y)),I.map===null&&!I.isPointLightShadow&&this.type===Up){let z={minFilter:Ai,magFilter:Ai,format:ts};I.map=new Wa(i.x,i.y,z),I.map.texture.name=P.name+".shadowMap",I.mapPass=new Wa(i.x,i.y,z),I.camera.updateProjectionMatrix()}if(I.map===null){let z={minFilter:Qn,magFilter:Qn,format:ts};I.map=new Wa(i.x,i.y,z),I.map.texture.name=P.name+".shadowMap",I.camera.updateProjectionMatrix()}o.setRenderTarget(I.map),o.clear();let G=I.getViewportCount();for(let z=0;z<G;z++){let se=I.getViewport(z);s.set(r.x*se.x,r.y*se.y,r.x*se.z,r.y*se.w),B.viewport(s),I.updateMatrices(P,z),n=I.getFrustum(),w(M,S,I.camera,P,this.type)}!I.isPointLightShadow&&this.type===Up&&y(I,S),I.needsUpdate=!1}v.needsUpdate=!1,o.setRenderTarget(E,A,L)};function y(b,M){let S=e.update(g);h.uniforms.shadow_pass.value=b.map.texture,h.uniforms.resolution.value=b.mapSize,h.uniforms.radius.value=b.radius,o.setRenderTarget(b.mapPass),o.clear(),o.renderBufferDirect(M,null,S,h,g,null),f.uniforms.shadow_pass.value=b.mapPass.texture,f.uniforms.resolution.value=b.mapSize,f.uniforms.radius.value=b.radius,o.setRenderTarget(b.map),o.clear(),o.renderBufferDirect(M,null,S,f,g,null)}function m(b,M,S){let E=b<<0|M<<1|S<<2,A=a[E];return A===void 0&&(A=new rS({depthPacking:Bj,morphTargets:b,skinning:M}),a[E]=A),A}function x(b,M,S){let E=b<<0|M<<1|S<<2,A=l[E];return A===void 0&&(A=new sS({morphTargets:b,skinning:M}),l[E]=A),A}function _(b,M,S,E,A,L,B){let R=null,D=m,P=b.customDepthMaterial;if(E.isPointLight===!0&&(D=x,P=b.customDistanceMaterial),P===void 0){let I=!1;S.morphTargets===!0&&(I=M.morphAttributes&&M.morphAttributes.position&&M.morphAttributes.position.length>0);let N=!1;b.isSkinnedMesh===!0&&(S.skinning===!0?N=!0:console.warn("THREE.WebGLShadowMap: THREE.SkinnedMesh with material.skinning set to false:",b));let G=b.isInstancedMesh===!0;R=D(I,N,G)}else R=P;if(o.localClippingEnabled&&S.clipShadows===!0&&S.clippingPlanes.length!==0){let I=R.uuid,N=S.uuid,G=c[I];G===void 0&&(G={},c[I]=G);let z=G[N];z===void 0&&(z=R.clone(),G[N]=z),R=z}return R.visible=S.visible,R.wireframe=S.wireframe,B===Up?R.side=S.shadowSide!==null?S.shadowSide:S.side:R.side=S.shadowSide!==null?S.shadowSide:d[S.side],R.clipShadows=S.clipShadows,R.clippingPlanes=S.clippingPlanes,R.clipIntersection=S.clipIntersection,R.wireframeLinewidth=S.wireframeLinewidth,R.linewidth=S.linewidth,E.isPointLight===!0&&R.isMeshDistanceMaterial===!0&&(R.referencePosition.setFromMatrixPosition(E.matrixWorld),R.nearDistance=A,R.farDistance=L),R}function w(b,M,S,E,A){if(b.visible===!1)return;if(b.layers.test(M.layers)&&(b.isMesh||b.isLine||b.isPoints)&&(b.castShadow||b.receiveShadow&&A===Up)&&(!b.frustumCulled||n.intersectsObject(b))){b.modelViewMatrix.multiplyMatrices(S.matrixWorldInverse,b.matrixWorld);let R=e.update(b),D=b.material;if(Array.isArray(D)){let P=R.groups;for(let I=0,N=P.length;I<N;I++){let G=P[I],z=D[G.materialIndex];if(z&&z.visible){let se=_(b,R,z,E,S.near,S.far,A);o.renderBufferDirect(S,null,R,se,b,G)}}}else if(D.visible){let P=_(b,R,D,E,S.near,S.far,A);o.renderBufferDirect(S,null,R,P,b,null)}}let B=b.children;for(let R=0,D=B.length;R<D;R++)w(B[R],M,S,E,A)}}function f$(o,e,t){let n=t.isWebGL2;function i(){let oe=!1,ge=new Dt,k=null,de=new Dt(0,0,0,0);return{setMask:function(K){k!==K&&!oe&&(o.colorMask(K,K,K,K),k=K)},setLocked:function(K){oe=K},setClear:function(K,be,we,We,ve){ve===!0&&(K*=We,be*=We,we*=We),ge.set(K,be,we,We),de.equals(ge)===!1&&(o.clearColor(K,be,we,We),de.copy(ge))},reset:function(){oe=!1,k=null,de.set(-1,0,0,0)}}}function r(){let oe=!1,ge=null,k=null,de=null;return{setTest:function(K){K?Q(2929):j(2929)},setMask:function(K){ge!==K&&!oe&&(o.depthMask(K),ge=K)},setFunc:function(K){if(k!==K){if(K)switch(K){case Tq:o.depthFunc(512);break;case Eq:o.depthFunc(519);break;case Aq:o.depthFunc(513);break;case p1:o.depthFunc(515);break;case Cq:o.depthFunc(514);break;case Lq:o.depthFunc(518);break;case Rq:o.depthFunc(516);break;case Pq:o.depthFunc(517);break;default:o.depthFunc(515)}else o.depthFunc(515);k=K}},setLocked:function(K){oe=K},setClear:function(K){de!==K&&(o.clearDepth(K),de=K)},reset:function(){oe=!1,ge=null,k=null,de=null}}}function s(){let oe=!1,ge=null,k=null,de=null,K=null,be=null,we=null,We=null,ve=null;return{setTest:function(Be){oe||(Be?Q(2960):j(2960))},setMask:function(Be){ge!==Be&&!oe&&(o.stencilMask(Be),ge=Be)},setFunc:function(Be,nt,Xe){(k!==Be||de!==nt||K!==Xe)&&(o.stencilFunc(Be,nt,Xe),k=Be,de=nt,K=Xe)},setOp:function(Be,nt,Xe){(be!==Be||we!==nt||We!==Xe)&&(o.stencilOp(Be,nt,Xe),be=Be,we=nt,We=Xe)},setLocked:function(Be){oe=Be},setClear:function(Be){ve!==Be&&(o.clearStencil(Be),ve=Be)},reset:function(){oe=!1,ge=null,k=null,de=null,K=null,be=null,we=null,We=null,ve=null}}}let a=new i,l=new r,c=new s,u={},d=null,h={},f=null,p=!1,g=null,v=null,y=null,m=null,x=null,_=null,w=null,b=!1,M=null,S=null,E=null,A=null,L=null,B=o.getParameter(35661),R=!1,D=0,P=o.getParameter(7938);P.indexOf("WebGL")!==-1?(D=parseFloat(/^WebGL (\d)/.exec(P)[1]),R=D>=1):P.indexOf("OpenGL ES")!==-1&&(D=parseFloat(/^OpenGL ES (\d)/.exec(P)[1]),R=D>=2);let I=null,N={},G=new Dt(0,0,o.canvas.width,o.canvas.height),z=new Dt(0,0,o.canvas.width,o.canvas.height);function se(oe,ge,k){let de=new Uint8Array(4),K=o.createTexture();o.bindTexture(oe,K),o.texParameteri(oe,10241,9728),o.texParameteri(oe,10240,9728);for(let be=0;be<k;be++)o.texImage2D(ge+be,0,6408,1,1,0,6408,5121,de);return K}let ne={};ne[3553]=se(3553,3553,1),ne[34067]=se(34067,34069,6),a.setClear(0,0,0,1),l.setClear(1),c.setClear(0),Q(2929),l.setFunc(p1),xe(!1),X(MI),Q(2884),ye(Hp);function Q(oe){u[oe]!==!0&&(o.enable(oe),u[oe]=!0)}function j(oe){u[oe]!==!1&&(o.disable(oe),u[oe]=!1)}function O(oe){oe!==d&&(o.bindFramebuffer(36160,oe),d=oe)}function ee(oe,ge){ge===null&&d!==null&&(ge=d),h[oe]!==ge&&(o.bindFramebuffer(oe,ge),h[oe]=ge,n&&(oe===36009&&(h[36160]=ge),oe===36160&&(h[36009]=ge)))}function V(oe){return f!==oe?(o.useProgram(oe),f=oe,!0):!1}let ie={[qh]:32774,[pq]:32778,[mq]:32779};if(n)ie[LI]=32775,ie[RI]=32776;else{let oe=e.get("EXT_blend_minmax");oe!==null&&(ie[LI]=oe.MIN_EXT,ie[RI]=oe.MAX_EXT)}let ue={[gq]:0,[yq]:1,[vq]:768,[PI]:770,[Sq]:776,[bq]:774,[_q]:772,[xq]:769,[II]:771,[Mq]:775,[wq]:773};function ye(oe,ge,k,de,K,be,we,We){if(oe===Hp){p===!0&&(j(3042),p=!1);return}if(p===!1&&(Q(3042),p=!0),oe!==fq){if(oe!==g||We!==b){if((v!==qh||x!==qh)&&(o.blendEquation(32774),v=qh,x=qh),We)switch(oe){case Gp:o.blendFuncSeparate(1,771,1,771);break;case EI:o.blendFunc(1,1);break;case AI:o.blendFuncSeparate(0,0,769,771);break;case CI:o.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",oe);break}else switch(oe){case Gp:o.blendFuncSeparate(770,771,1,771);break;case EI:o.blendFunc(770,1);break;case AI:o.blendFunc(0,769);break;case CI:o.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",oe);break}y=null,m=null,_=null,w=null,g=oe,b=We}return}K=K||ge,be=be||k,we=we||de,(ge!==v||K!==x)&&(o.blendEquationSeparate(ie[ge],ie[K]),v=ge,x=K),(k!==y||de!==m||be!==_||we!==w)&&(o.blendFuncSeparate(ue[k],ue[de],ue[be],ue[we]),y=k,m=de,_=be,w=we),g=oe,b=null}function pe(oe,ge){oe.side===Xh?j(2884):Q(2884);let k=oe.side===zn;ge&&(k=!k),xe(k),oe.blending===Gp&&oe.transparent===!1?ye(Hp):ye(oe.blending,oe.blendEquation,oe.blendSrc,oe.blendDst,oe.blendEquationAlpha,oe.blendSrcAlpha,oe.blendDstAlpha,oe.premultipliedAlpha),l.setFunc(oe.depthFunc),l.setTest(oe.depthTest),l.setMask(oe.depthWrite),a.setMask(oe.colorWrite);let de=oe.stencilWrite;c.setTest(de),de&&(c.setMask(oe.stencilWriteMask),c.setFunc(oe.stencilFunc,oe.stencilRef,oe.stencilFuncMask),c.setOp(oe.stencilFail,oe.stencilZFail,oe.stencilZPass)),J(oe.polygonOffset,oe.polygonOffsetFactor,oe.polygonOffsetUnits),oe.alphaToCoverage===!0?Q(32926):j(32926)}function xe(oe){M!==oe&&(oe?o.frontFace(2304):o.frontFace(2305),M=oe)}function X(oe){oe!==uq?(Q(2884),oe!==S&&(oe===MI?o.cullFace(1029):oe===hq?o.cullFace(1028):o.cullFace(1032))):j(2884),S=oe}function $(oe){oe!==E&&(R&&o.lineWidth(oe),E=oe)}function J(oe,ge,k){oe?(Q(32823),(A!==ge||L!==k)&&(o.polygonOffset(ge,k),A=ge,L=k)):j(32823)}function ce(oe){oe?Q(3089):j(3089)}function H(oe){oe===void 0&&(oe=33984+B-1),I!==oe&&(o.activeTexture(oe),I=oe)}function T(oe,ge){I===null&&H();let k=N[I];k===void 0&&(k={type:void 0,texture:void 0},N[I]=k),(k.type!==oe||k.texture!==ge)&&(o.bindTexture(oe,ge||ne[oe]),k.type=oe,k.texture=ge)}function C(){let oe=N[I];oe!==void 0&&oe.type!==void 0&&(o.bindTexture(oe.type,null),oe.type=void 0,oe.texture=void 0)}function W(){try{o.compressedTexImage2D.apply(o,arguments)}catch(oe){console.error("THREE.WebGLState:",oe)}}function Z(){try{o.texImage2D.apply(o,arguments)}catch(oe){console.error("THREE.WebGLState:",oe)}}function he(){try{o.texImage3D.apply(o,arguments)}catch(oe){console.error("THREE.WebGLState:",oe)}}function me(oe){G.equals(oe)===!1&&(o.scissor(oe.x,oe.y,oe.z,oe.w),G.copy(oe))}function Ee(oe){z.equals(oe)===!1&&(o.viewport(oe.x,oe.y,oe.z,oe.w),z.copy(oe))}function Se(){o.disable(3042),o.disable(2884),o.disable(2929),o.disable(32823),o.disable(3089),o.disable(2960),o.disable(32926),o.blendEquation(32774),o.blendFunc(1,0),o.blendFuncSeparate(1,0,1,0),o.colorMask(!0,!0,!0,!0),o.clearColor(0,0,0,0),o.depthMask(!0),o.depthFunc(513),o.clearDepth(1),o.stencilMask(4294967295),o.stencilFunc(519,0,4294967295),o.stencilOp(7680,7680,7680),o.clearStencil(0),o.cullFace(1029),o.frontFace(2305),o.polygonOffset(0,0),o.activeTexture(33984),o.bindFramebuffer(36160,null),n===!0&&(o.bindFramebuffer(36009,null),o.bindFramebuffer(36008,null)),o.useProgram(null),o.lineWidth(1),o.scissor(0,0,o.canvas.width,o.canvas.height),o.viewport(0,0,o.canvas.width,o.canvas.height),u={},I=null,N={},d=null,h={},f=null,p=!1,g=null,v=null,y=null,m=null,x=null,_=null,w=null,b=!1,M=null,S=null,E=null,A=null,L=null,G.set(0,0,o.canvas.width,o.canvas.height),z.set(0,0,o.canvas.width,o.canvas.height),a.reset(),l.reset(),c.reset()}return{buffers:{color:a,depth:l,stencil:c},enable:Q,disable:j,bindFramebuffer:ee,bindXRFramebuffer:O,useProgram:V,setBlending:ye,setMaterial:pe,setFlipSided:xe,setCullFace:X,setLineWidth:$,setPolygonOffset:J,setScissorTest:ce,activeTexture:H,bindTexture:T,unbindTexture:C,compressedTexImage2D:W,texImage2D:Z,texImage3D:he,scissor:me,viewport:Ee,reset:Se}}function p$(o,e,t,n,i,r,s){let a=i.isWebGL2,l=i.maxTextures,c=i.maxCubemapSize,u=i.maxTextureSize,d=i.maxSamples,h=new WeakMap,f,p=!1;try{p=typeof OffscreenCanvas!="undefined"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch(T){}function g(T,C){return p?new OffscreenCanvas(T,C):document.createElementNS("http://www.w3.org/1999/xhtml","canvas")}function v(T,C,W,Z){let he=1;if((T.width>Z||T.height>Z)&&(he=Z/Math.max(T.width,T.height)),he<1||C===!0)if(typeof HTMLImageElement!="undefined"&&T instanceof HTMLImageElement||typeof HTMLCanvasElement!="undefined"&&T instanceof HTMLCanvasElement||typeof ImageBitmap!="undefined"&&T instanceof ImageBitmap){let me=C?eD:Math.floor,Ee=me(he*T.width),Se=me(he*T.height);f===void 0&&(f=g(Ee,Se));let oe=W?g(Ee,Se):f;return oe.width=Ee,oe.height=Se,oe.getContext("2d").drawImage(T,0,0,Ee,Se),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+T.width+"x"+T.height+") to ("+Ee+"x"+Se+")."),oe}else return"data"in T&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+T.width+"x"+T.height+")."),T;return T}function y(T){return E1(T.width)&&E1(T.height)}function m(T){return a?!1:T.wrapS!==tr||T.wrapT!==tr||T.minFilter!==Qn&&T.minFilter!==Ai}function x(T,C){return T.generateMipmaps&&C&&T.minFilter!==Qn&&T.minFilter!==Ai}function _(T,C,W,Z){o.generateMipmap(T);let he=n.get(C);he.__maxMipLevel=Math.log2(Math.max(W,Z))}function w(T,C,W){if(a===!1)return C;if(T!==null){if(o[T]!==void 0)return o[T];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+T+"'")}let Z=C;return C===6403&&(W===5126&&(Z=33326),W===5131&&(Z=33325),W===5121&&(Z=33321)),C===6407&&(W===5126&&(Z=34837),W===5131&&(Z=34843),W===5121&&(Z=32849)),C===6408&&(W===5126&&(Z=34836),W===5131&&(Z=34842),W===5121&&(Z=32856)),(Z===33325||Z===33326||Z===34842||Z===34836)&&e.get("EXT_color_buffer_float"),Z}function b(T){return T===Qn||T===uv||T===hv?9728:9729}function M(T){let C=T.target;C.removeEventListener("dispose",M),E(C),C.isVideoTexture&&h.delete(C),s.memory.textures--}function S(T){let C=T.target;C.removeEventListener("dispose",S),A(C),s.memory.textures--}function E(T){let C=n.get(T);C.__webglInit!==void 0&&(o.deleteTexture(C.__webglTexture),n.remove(T))}function A(T){let C=T.texture,W=n.get(T),Z=n.get(C);if(!!T){if(Z.__webglTexture!==void 0&&o.deleteTexture(Z.__webglTexture),T.depthTexture&&T.depthTexture.dispose(),T.isWebGLCubeRenderTarget)for(let he=0;he<6;he++)o.deleteFramebuffer(W.__webglFramebuffer[he]),W.__webglDepthbuffer&&o.deleteRenderbuffer(W.__webglDepthbuffer[he]);else o.deleteFramebuffer(W.__webglFramebuffer),W.__webglDepthbuffer&&o.deleteRenderbuffer(W.__webglDepthbuffer),W.__webglMultisampledFramebuffer&&o.deleteFramebuffer(W.__webglMultisampledFramebuffer),W.__webglColorRenderbuffer&&o.deleteRenderbuffer(W.__webglColorRenderbuffer),W.__webglDepthRenderbuffer&&o.deleteRenderbuffer(W.__webglDepthRenderbuffer);n.remove(C),n.remove(T)}}let L=0;function B(){L=0}function R(){let T=L;return T>=l&&console.warn("THREE.WebGLTextures: Trying to use "+T+" texture units while this GPU supports only "+l),L+=1,T}function D(T,C){let W=n.get(T);if(T.isVideoTexture&&X(T),T.version>0&&W.__version!==T.version){let Z=T.image;if(Z===void 0)console.warn("THREE.WebGLRenderer: Texture marked for update but image is undefined");else if(Z.complete===!1)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete");else{Q(W,T,C);return}}t.activeTexture(33984+C),t.bindTexture(3553,W.__webglTexture)}function P(T,C){let W=n.get(T);if(T.version>0&&W.__version!==T.version){Q(W,T,C);return}t.activeTexture(33984+C),t.bindTexture(35866,W.__webglTexture)}function I(T,C){let W=n.get(T);if(T.version>0&&W.__version!==T.version){Q(W,T,C);return}t.activeTexture(33984+C),t.bindTexture(32879,W.__webglTexture)}function N(T,C){let W=n.get(T);if(T.version>0&&W.__version!==T.version){j(W,T,C);return}t.activeTexture(33984+C),t.bindTexture(34067,W.__webglTexture)}let G={[dc]:10497,[tr]:33071,[Wp]:33648},z={[Qn]:9728,[uv]:9984,[hv]:9986,[Ai]:9729,[x1]:9985,[jh]:9987};function se(T,C,W){if(W?(o.texParameteri(T,10242,G[C.wrapS]),o.texParameteri(T,10243,G[C.wrapT]),(T===32879||T===35866)&&o.texParameteri(T,32882,G[C.wrapR]),o.texParameteri(T,10240,z[C.magFilter]),o.texParameteri(T,10241,z[C.minFilter])):(o.texParameteri(T,10242,33071),o.texParameteri(T,10243,33071),(T===32879||T===35866)&&o.texParameteri(T,32882,33071),(C.wrapS!==tr||C.wrapT!==tr)&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),o.texParameteri(T,10240,b(C.magFilter)),o.texParameteri(T,10241,b(C.minFilter)),C.minFilter!==Qn&&C.minFilter!==Ai&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),e.has("EXT_texture_filter_anisotropic")===!0){let Z=e.get("EXT_texture_filter_anisotropic");if(C.type===Ha&&e.has("OES_texture_float_linear")===!1||a===!1&&C.type===pv&&e.has("OES_texture_half_float_linear")===!1)return;(C.anisotropy>1||n.get(C).__currentAnisotropy)&&(o.texParameterf(T,Z.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(C.anisotropy,i.getMaxAnisotropy())),n.get(C).__currentAnisotropy=C.anisotropy)}}function ne(T,C){T.__webglInit===void 0&&(T.__webglInit=!0,C.addEventListener("dispose",M),T.__webglTexture=o.createTexture(),s.memory.textures++)}function Q(T,C,W){let Z=3553;C.isDataTexture2DArray&&(Z=35866),C.isDataTexture3D&&(Z=32879),ne(T,C),t.activeTexture(33984+W),t.bindTexture(Z,T.__webglTexture),o.pixelStorei(37440,C.flipY),o.pixelStorei(37441,C.premultiplyAlpha),o.pixelStorei(3317,C.unpackAlignment),o.pixelStorei(37443,0);let he=m(C)&&y(C.image)===!1,me=v(C.image,he,!1,u),Ee=y(me)||a,Se=r.convert(C.format),oe=r.convert(C.type),ge=w(C.internalFormat,Se,oe);se(Z,C,Ee);let k,de=C.mipmaps;if(C.isDepthTexture)ge=6402,a?C.type===Ha?ge=36012:C.type===fv?ge=33190:C.type===Xp?ge=35056:ge=33189:C.type===Ha&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),C.format===Yh&&ge===6402&&C.type!==dv&&C.type!==fv&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),C.type=dv,oe=r.convert(C.type)),C.format===qp&&ge===6402&&(ge=34041,C.type!==Xp&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),C.type=Xp,oe=r.convert(C.type))),t.texImage2D(3553,0,ge,me.width,me.height,0,Se,oe,null);else if(C.isDataTexture)if(de.length>0&&Ee){for(let K=0,be=de.length;K<be;K++)k=de[K],t.texImage2D(3553,K,ge,k.width,k.height,0,Se,oe,k.data);C.generateMipmaps=!1,T.__maxMipLevel=de.length-1}else t.texImage2D(3553,0,ge,me.width,me.height,0,Se,oe,me.data),T.__maxMipLevel=0;else if(C.isCompressedTexture){for(let K=0,be=de.length;K<be;K++)k=de[K],C.format!==ts&&C.format!==Lo?Se!==null?t.compressedTexImage2D(3553,K,ge,k.width,k.height,0,k.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):t.texImage2D(3553,K,ge,k.width,k.height,0,Se,oe,k.data);T.__maxMipLevel=de.length-1}else if(C.isDataTexture2DArray)t.texImage3D(35866,0,ge,me.width,me.height,me.depth,0,Se,oe,me.data),T.__maxMipLevel=0;else if(C.isDataTexture3D)t.texImage3D(32879,0,ge,me.width,me.height,me.depth,0,Se,oe,me.data),T.__maxMipLevel=0;else if(de.length>0&&Ee){for(let K=0,be=de.length;K<be;K++)k=de[K],t.texImage2D(3553,K,ge,Se,oe,k);C.generateMipmaps=!1,T.__maxMipLevel=de.length-1}else t.texImage2D(3553,0,ge,Se,oe,me),T.__maxMipLevel=0;x(C,Ee)&&_(Z,C,me.width,me.height),T.__version=C.version,C.onUpdate&&C.onUpdate(C)}function j(T,C,W){if(C.image.length!==6)return;ne(T,C),t.activeTexture(33984+W),t.bindTexture(34067,T.__webglTexture),o.pixelStorei(37440,C.flipY),o.pixelStorei(37441,C.premultiplyAlpha),o.pixelStorei(3317,C.unpackAlignment),o.pixelStorei(37443,0);let Z=C&&(C.isCompressedTexture||C.image[0].isCompressedTexture),he=C.image[0]&&C.image[0].isDataTexture,me=[];for(let K=0;K<6;K++)!Z&&!he?me[K]=v(C.image[K],!1,!0,c):me[K]=he?C.image[K].image:C.image[K];let Ee=me[0],Se=y(Ee)||a,oe=r.convert(C.format),ge=r.convert(C.type),k=w(C.internalFormat,oe,ge);se(34067,C,Se);let de;if(Z){for(let K=0;K<6;K++){de=me[K].mipmaps;for(let be=0;be<de.length;be++){let we=de[be];C.format!==ts&&C.format!==Lo?oe!==null?t.compressedTexImage2D(34069+K,be,k,we.width,we.height,0,we.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):t.texImage2D(34069+K,be,k,we.width,we.height,0,oe,ge,we.data)}}T.__maxMipLevel=de.length-1}else{de=C.mipmaps;for(let K=0;K<6;K++)if(he){t.texImage2D(34069+K,0,k,me[K].width,me[K].height,0,oe,ge,me[K].data);for(let be=0;be<de.length;be++){let We=de[be].image[K].image;t.texImage2D(34069+K,be+1,k,We.width,We.height,0,oe,ge,We.data)}}else{t.texImage2D(34069+K,0,k,oe,ge,me[K]);for(let be=0;be<de.length;be++){let we=de[be];t.texImage2D(34069+K,be+1,k,oe,ge,we.image[K])}}T.__maxMipLevel=de.length}x(C,Se)&&_(34067,C,Ee.width,Ee.height),T.__version=C.version,C.onUpdate&&C.onUpdate(C)}function O(T,C,W,Z){let he=C.texture,me=r.convert(he.format),Ee=r.convert(he.type),Se=w(he.internalFormat,me,Ee);Z===32879||Z===35866?t.texImage3D(Z,0,Se,C.width,C.height,C.depth,0,me,Ee,null):t.texImage2D(Z,0,Se,C.width,C.height,0,me,Ee,null),t.bindFramebuffer(36160,T),o.framebufferTexture2D(36160,W,Z,n.get(he).__webglTexture,0),t.bindFramebuffer(36160,null)}function ee(T,C,W){if(o.bindRenderbuffer(36161,T),C.depthBuffer&&!C.stencilBuffer){let Z=33189;if(W){let he=C.depthTexture;he&&he.isDepthTexture&&(he.type===Ha?Z=36012:he.type===fv&&(Z=33190));let me=xe(C);o.renderbufferStorageMultisample(36161,me,Z,C.width,C.height)}else o.renderbufferStorage(36161,Z,C.width,C.height);o.framebufferRenderbuffer(36160,36096,36161,T)}else if(C.depthBuffer&&C.stencilBuffer){if(W){let Z=xe(C);o.renderbufferStorageMultisample(36161,Z,35056,C.width,C.height)}else o.renderbufferStorage(36161,34041,C.width,C.height);o.framebufferRenderbuffer(36160,33306,36161,T)}else{let Z=C.texture,he=r.convert(Z.format),me=r.convert(Z.type),Ee=w(Z.internalFormat,he,me);if(W){let Se=xe(C);o.renderbufferStorageMultisample(36161,Se,Ee,C.width,C.height)}else o.renderbufferStorage(36161,Ee,C.width,C.height)}o.bindRenderbuffer(36161,null)}function V(T,C){if(C&&C.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(t.bindFramebuffer(36160,T),!(C.depthTexture&&C.depthTexture.isDepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");(!n.get(C.depthTexture).__webglTexture||C.depthTexture.image.width!==C.width||C.depthTexture.image.height!==C.height)&&(C.depthTexture.image.width=C.width,C.depthTexture.image.height=C.height,C.depthTexture.needsUpdate=!0),D(C.depthTexture,0);let Z=n.get(C.depthTexture).__webglTexture;if(C.depthTexture.format===Yh)o.framebufferTexture2D(36160,36096,3553,Z,0);else if(C.depthTexture.format===qp)o.framebufferTexture2D(36160,33306,3553,Z,0);else throw new Error("Unknown depthTexture format")}function ie(T){let C=n.get(T),W=T.isWebGLCubeRenderTarget===!0;if(T.depthTexture){if(W)throw new Error("target.depthTexture not supported in Cube render targets");V(C.__webglFramebuffer,T)}else if(W){C.__webglDepthbuffer=[];for(let Z=0;Z<6;Z++)t.bindFramebuffer(36160,C.__webglFramebuffer[Z]),C.__webglDepthbuffer[Z]=o.createRenderbuffer(),ee(C.__webglDepthbuffer[Z],T,!1)}else t.bindFramebuffer(36160,C.__webglFramebuffer),C.__webglDepthbuffer=o.createRenderbuffer(),ee(C.__webglDepthbuffer,T,!1);t.bindFramebuffer(36160,null)}function ue(T){let C=T.texture,W=n.get(T),Z=n.get(C);T.addEventListener("dispose",S),Z.__webglTexture=o.createTexture(),Z.__version=C.version,s.memory.textures++;let he=T.isWebGLCubeRenderTarget===!0,me=T.isWebGLMultisampleRenderTarget===!0,Ee=C.isDataTexture3D||C.isDataTexture2DArray,Se=y(T)||a;if(a&&C.format===Lo&&(C.type===Ha||C.type===pv)&&(C.format=ts,console.warn("THREE.WebGLRenderer: Rendering to textures with RGB format is not supported. Using RGBA format instead.")),he){W.__webglFramebuffer=[];for(let oe=0;oe<6;oe++)W.__webglFramebuffer[oe]=o.createFramebuffer()}else if(W.__webglFramebuffer=o.createFramebuffer(),me)if(a){W.__webglMultisampledFramebuffer=o.createFramebuffer(),W.__webglColorRenderbuffer=o.createRenderbuffer(),o.bindRenderbuffer(36161,W.__webglColorRenderbuffer);let oe=r.convert(C.format),ge=r.convert(C.type),k=w(C.internalFormat,oe,ge),de=xe(T);o.renderbufferStorageMultisample(36161,de,k,T.width,T.height),t.bindFramebuffer(36160,W.__webglMultisampledFramebuffer),o.framebufferRenderbuffer(36160,36064,36161,W.__webglColorRenderbuffer),o.bindRenderbuffer(36161,null),T.depthBuffer&&(W.__webglDepthRenderbuffer=o.createRenderbuffer(),ee(W.__webglDepthRenderbuffer,T,!0)),t.bindFramebuffer(36160,null)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.");if(he){t.bindTexture(34067,Z.__webglTexture),se(34067,C,Se);for(let oe=0;oe<6;oe++)O(W.__webglFramebuffer[oe],T,36064,34069+oe);x(C,Se)&&_(34067,C,T.width,T.height),t.bindTexture(34067,null)}else{let oe=3553;Ee&&(a?oe=C.isDataTexture3D?32879:35866:console.warn("THREE.DataTexture3D and THREE.DataTexture2DArray only supported with WebGL2.")),t.bindTexture(oe,Z.__webglTexture),se(oe,C,Se),O(W.__webglFramebuffer,T,36064,oe),x(C,Se)&&_(3553,C,T.width,T.height),t.bindTexture(3553,null)}T.depthBuffer&&ie(T)}function ye(T){let C=T.texture,W=y(T)||a;if(x(C,W)){let Z=T.isWebGLCubeRenderTarget?34067:3553,he=n.get(C).__webglTexture;t.bindTexture(Z,he),_(Z,C,T.width,T.height),t.bindTexture(Z,null)}}function pe(T){if(T.isWebGLMultisampleRenderTarget)if(a){let C=T.width,W=T.height,Z=16384;T.depthBuffer&&(Z|=256),T.stencilBuffer&&(Z|=1024);let he=n.get(T);t.bindFramebuffer(36008,he.__webglMultisampledFramebuffer),t.bindFramebuffer(36009,he.__webglFramebuffer),o.blitFramebuffer(0,0,C,W,0,0,C,W,Z,9728),t.bindFramebuffer(36008,null),t.bindFramebuffer(36009,he.__webglMultisampledFramebuffer)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.")}function xe(T){return a&&T.isWebGLMultisampleRenderTarget?Math.min(d,T.samples):0}function X(T){let C=s.render.frame;h.get(T)!==C&&(h.set(T,C),T.update())}let $=!1,J=!1;function ce(T,C){T&&T.isWebGLRenderTarget&&($===!1&&(console.warn("THREE.WebGLTextures.safeSetTexture2D: don't use render targets as textures. Use their .texture property instead."),$=!0),T=T.texture),D(T,C)}function H(T,C){T&&T.isWebGLCubeRenderTarget&&(J===!1&&(console.warn("THREE.WebGLTextures.safeSetTextureCube: don't use cube render targets as textures. Use their .texture property instead."),J=!0),T=T.texture),N(T,C)}this.allocateTextureUnit=R,this.resetTextureUnits=B,this.setTexture2D=D,this.setTexture2DArray=P,this.setTexture3D=I,this.setTextureCube=N,this.setupRenderTarget=ue,this.updateRenderTargetMipmap=ye,this.updateMultisampleRenderTarget=pe,this.safeSetTexture2D=ce,this.safeSetTextureCube=H}function m$(o,e,t){let n=t.isWebGL2;function i(r){let s;if(r===_1)return 5121;if(r===Gq)return 32819;if(r===Vq)return 32820;if(r===Wq)return 33635;if(r===zq)return 5120;if(r===Uq)return 5122;if(r===dv)return 5123;if(r===Hq)return 5124;if(r===fv)return 5125;if(r===Ha)return 5126;if(r===pv)return n?5131:(s=e.get("OES_texture_half_float"),s!==null?s.HALF_FLOAT_OES:null);if(r===Xq)return 6406;if(r===Lo)return 6407;if(r===ts)return 6408;if(r===qq)return 6409;if(r===jq)return 6410;if(r===Yh)return 6402;if(r===qp)return 34041;if(r===Yq)return 6403;if(r===Zq)return 36244;if(r===Jq)return 33319;if(r===Kq)return 33320;if(r===$q)return 36248;if(r===Qq)return 36249;if(r===NI||r===OI||r===kI||r===zI)if(s=e.get("WEBGL_compressed_texture_s3tc"),s!==null){if(r===NI)return s.COMPRESSED_RGB_S3TC_DXT1_EXT;if(r===OI)return s.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(r===kI)return s.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(r===zI)return s.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(r===UI||r===HI||r===GI||r===VI)if(s=e.get("WEBGL_compressed_texture_pvrtc"),s!==null){if(r===UI)return s.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(r===HI)return s.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(r===GI)return s.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(r===VI)return s.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(r===ej)return s=e.get("WEBGL_compressed_texture_etc1"),s!==null?s.COMPRESSED_RGB_ETC1_WEBGL:null;if((r===WI||r===XI)&&(s=e.get("WEBGL_compressed_texture_etc"),s!==null)){if(r===WI)return s.COMPRESSED_RGB8_ETC2;if(r===XI)return s.COMPRESSED_RGBA8_ETC2_EAC}if(r===tj||r===nj||r===ij||r===rj||r===sj||r===oj||r===aj||r===lj||r===cj||r===uj||r===hj||r===dj||r===fj||r===pj||r===gj||r===yj||r===vj||r===xj||r===_j||r===wj||r===bj||r===Mj||r===Sj||r===Tj||r===Ej||r===Aj||r===Cj||r===Lj)return s=e.get("WEBGL_compressed_texture_astc"),s!==null?r:null;if(r===mj)return s=e.get("EXT_texture_compression_bptc"),s!==null?r:null;if(r===Xp)return n?34042:(s=e.get("WEBGL_depth_texture"),s!==null?s.UNSIGNED_INT_24_8_WEBGL:null)}return{convert:i}}var oS=class extends yi{constructor(e=[]){super();this.cameras=e}};oS.prototype.isArrayCamera=!0;var Os=class extends ot{constructor(){super();this.type="Group"}};Os.prototype.isGroup=!0;var g$={type:"move"},zv=class{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new Os,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new Os,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new ae,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new ae),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new Os,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new ae,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new ae),this._grip}dispatchEvent(e){return this._targetRay!==null&&this._targetRay.dispatchEvent(e),this._grip!==null&&this._grip.dispatchEvent(e),this._hand!==null&&this._hand.dispatchEvent(e),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(e,t,n){let i=null,r=null,s=null,a=this._targetRay,l=this._grip,c=this._hand;if(e&&t.session.visibilityState!=="visible-blurred")if(a!==null&&(i=t.getPose(e.targetRaySpace,n),i!==null&&(a.matrix.fromArray(i.transform.matrix),a.matrix.decompose(a.position,a.rotation,a.scale),i.linearVelocity?(a.hasLinearVelocity=!0,a.linearVelocity.copy(i.linearVelocity)):a.hasLinearVelocity=!1,i.angularVelocity?(a.hasAngularVelocity=!0,a.angularVelocity.copy(i.angularVelocity)):a.hasAngularVelocity=!1,this.dispatchEvent(g$))),c&&e.hand){s=!0;for(let g of e.hand.values()){let v=t.getJointPose(g,n);if(c.joints[g.jointName]===void 0){let m=new Os;m.matrixAutoUpdate=!1,m.visible=!1,c.joints[g.jointName]=m,c.add(m)}let y=c.joints[g.jointName];v!==null&&(y.matrix.fromArray(v.transform.matrix),y.matrix.decompose(y.position,y.rotation,y.scale),y.jointRadius=v.radius),y.visible=v!==null}let u=c.joints["index-finger-tip"],d=c.joints["thumb-tip"],h=u.position.distanceTo(d.position),f=.02,p=.005;c.inputState.pinching&&h>f+p?(c.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!c.inputState.pinching&&h<=f-p&&(c.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else l!==null&&e.gripSpace&&(r=t.getPose(e.gripSpace,n),r!==null&&(l.matrix.fromArray(r.transform.matrix),l.matrix.decompose(l.position,l.rotation,l.scale),r.linearVelocity?(l.hasLinearVelocity=!0,l.linearVelocity.copy(r.linearVelocity)):l.hasLinearVelocity=!1,r.angularVelocity?(l.hasAngularVelocity=!0,l.angularVelocity.copy(r.angularVelocity)):l.hasAngularVelocity=!1));return a!==null&&(a.visible=i!==null),l!==null&&(l.visible=r!==null),c!==null&&(c.visible=s!==null),this}},HD=class extends Va{constructor(e,t){super();let n=this,i=e.state,r=null,s=1,a=null,l="local-floor",c=null,u=[],d=new Map,h=new yi;h.layers.enable(1),h.viewport=new Dt;let f=new yi;f.layers.enable(2),f.viewport=new Dt;let p=[h,f],g=new oS;g.layers.enable(1),g.layers.enable(2);let v=null,y=null;this.enabled=!1,this.isPresenting=!1,this.getController=function(B){let R=u[B];return R===void 0&&(R=new zv,u[B]=R),R.getTargetRaySpace()},this.getControllerGrip=function(B){let R=u[B];return R===void 0&&(R=new zv,u[B]=R),R.getGripSpace()},this.getHand=function(B){let R=u[B];return R===void 0&&(R=new zv,u[B]=R),R.getHandSpace()};function m(B){let R=d.get(B.inputSource);R&&R.dispatchEvent({type:B.type,data:B.inputSource})}function x(){d.forEach(function(B,R){B.disconnect(R)}),d.clear(),v=null,y=null,i.bindXRFramebuffer(null),e.setRenderTarget(e.getRenderTarget()),L.stop(),n.isPresenting=!1,n.dispatchEvent({type:"sessionend"})}this.setFramebufferScaleFactor=function(B){s=B,n.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(B){l=B,n.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return a},this.getSession=function(){return r},this.setSession=async function(B){if(r=B,r!==null){r.addEventListener("select",m),r.addEventListener("selectstart",m),r.addEventListener("selectend",m),r.addEventListener("squeeze",m),r.addEventListener("squeezestart",m),r.addEventListener("squeezeend",m),r.addEventListener("end",x),r.addEventListener("inputsourceschange",_);let R=t.getContextAttributes();R.xrCompatible!==!0&&await t.makeXRCompatible();let D={antialias:R.antialias,alpha:R.alpha,depth:R.depth,stencil:R.stencil,framebufferScaleFactor:s},P=new XRWebGLLayer(r,t,D);r.updateRenderState({baseLayer:P}),a=await r.requestReferenceSpace(l),L.setContext(r),L.start(),n.isPresenting=!0,n.dispatchEvent({type:"sessionstart"})}};function _(B){let R=r.inputSources;for(let D=0;D<u.length;D++)d.set(R[D],u[D]);for(let D=0;D<B.removed.length;D++){let P=B.removed[D],I=d.get(P);I&&(I.dispatchEvent({type:"disconnected",data:P}),d.delete(P))}for(let D=0;D<B.added.length;D++){let P=B.added[D],I=d.get(P);I&&I.dispatchEvent({type:"connected",data:P})}}let w=new ae,b=new ae;function M(B,R,D){w.setFromMatrixPosition(R.matrixWorld),b.setFromMatrixPosition(D.matrixWorld);let P=w.distanceTo(b),I=R.projectionMatrix.elements,N=D.projectionMatrix.elements,G=I[14]/(I[10]-1),z=I[14]/(I[10]+1),se=(I[9]+1)/I[5],ne=(I[9]-1)/I[5],Q=(I[8]-1)/I[0],j=(N[8]+1)/N[0],O=G*Q,ee=G*j,V=P/(-Q+j),ie=V*-Q;R.matrixWorld.decompose(B.position,B.quaternion,B.scale),B.translateX(ie),B.translateZ(V),B.matrixWorld.compose(B.position,B.quaternion,B.scale),B.matrixWorldInverse.copy(B.matrixWorld).invert();let ue=G+V,ye=z+V,pe=O-ie,xe=ee+(P-ie),X=se*z/ye*ue,$=ne*z/ye*ue;B.projectionMatrix.makePerspective(pe,xe,X,$,ue,ye)}function S(B,R){R===null?B.matrixWorld.copy(B.matrix):B.matrixWorld.multiplyMatrices(R.matrixWorld,B.matrix),B.matrixWorldInverse.copy(B.matrixWorld).invert()}this.getCamera=function(B){g.near=f.near=h.near=B.near,g.far=f.far=h.far=B.far,(v!==g.near||y!==g.far)&&(r.updateRenderState({depthNear:g.near,depthFar:g.far}),v=g.near,y=g.far);let R=B.parent,D=g.cameras;S(g,R);for(let I=0;I<D.length;I++)S(D[I],R);B.matrixWorld.copy(g.matrixWorld),B.matrix.copy(g.matrix),B.matrix.decompose(B.position,B.quaternion,B.scale);let P=B.children;for(let I=0,N=P.length;I<N;I++)P[I].updateMatrixWorld(!0);return D.length===2?M(g,h,f):g.projectionMatrix.copy(h.projectionMatrix),g};let E=null;function A(B,R){if(c=R.getViewerPose(a),c!==null){let P=c.views,I=r.renderState.baseLayer;i.bindXRFramebuffer(I.framebuffer);let N=!1;P.length!==g.cameras.length&&(g.cameras.length=0,N=!0);for(let G=0;G<P.length;G++){let z=P[G],se=I.getViewport(z),ne=p[G];ne.matrix.fromArray(z.transform.matrix),ne.projectionMatrix.fromArray(z.projectionMatrix),ne.viewport.set(se.x,se.y,se.width,se.height),G===0&&g.matrix.copy(ne.matrix),N===!0&&g.cameras.push(ne)}}let D=r.inputSources;for(let P=0;P<u.length;P++){let I=u[P],N=D[P];I.update(N,R,a)}E&&E(B,R)}let L=new vD;L.setAnimationLoop(A),this.setAnimationLoop=function(B){E=B},this.dispose=function(){}}};function y$(o){function e(y,m){y.fogColor.value.copy(m.color),m.isFog?(y.fogNear.value=m.near,y.fogFar.value=m.far):m.isFogExp2&&(y.fogDensity.value=m.density)}function t(y,m,x,_){m.isMeshBasicMaterial?n(y,m):m.isMeshLambertMaterial?(n(y,m),l(y,m)):m.isMeshToonMaterial?(n(y,m),u(y,m)):m.isMeshPhongMaterial?(n(y,m),c(y,m)):m.isMeshStandardMaterial?(n(y,m),m.isMeshPhysicalMaterial?h(y,m):d(y,m)):m.isMeshMatcapMaterial?(n(y,m),f(y,m)):m.isMeshDepthMaterial?(n(y,m),p(y,m)):m.isMeshDistanceMaterial?(n(y,m),g(y,m)):m.isMeshNormalMaterial?(n(y,m),v(y,m)):m.isLineBasicMaterial?(i(y,m),m.isLineDashedMaterial&&r(y,m)):m.isPointsMaterial?s(y,m,x,_):m.isSpriteMaterial?a(y,m):m.isShadowMaterial?(y.color.value.copy(m.color),y.opacity.value=m.opacity):m.isShaderMaterial&&(m.uniformsNeedUpdate=!1)}function n(y,m){y.opacity.value=m.opacity,m.color&&y.diffuse.value.copy(m.color),m.emissive&&y.emissive.value.copy(m.emissive).multiplyScalar(m.emissiveIntensity),m.map&&(y.map.value=m.map),m.alphaMap&&(y.alphaMap.value=m.alphaMap),m.specularMap&&(y.specularMap.value=m.specularMap);let x=o.get(m).envMap;if(x){y.envMap.value=x,y.flipEnvMap.value=x.isCubeTexture&&x._needsFlipEnvMap?-1:1,y.reflectivity.value=m.reflectivity,y.refractionRatio.value=m.refractionRatio;let b=o.get(x).__maxMipLevel;b!==void 0&&(y.maxMipLevel.value=b)}m.lightMap&&(y.lightMap.value=m.lightMap,y.lightMapIntensity.value=m.lightMapIntensity),m.aoMap&&(y.aoMap.value=m.aoMap,y.aoMapIntensity.value=m.aoMapIntensity);let _;m.map?_=m.map:m.specularMap?_=m.specularMap:m.displacementMap?_=m.displacementMap:m.normalMap?_=m.normalMap:m.bumpMap?_=m.bumpMap:m.roughnessMap?_=m.roughnessMap:m.metalnessMap?_=m.metalnessMap:m.alphaMap?_=m.alphaMap:m.emissiveMap?_=m.emissiveMap:m.clearcoatMap?_=m.clearcoatMap:m.clearcoatNormalMap?_=m.clearcoatNormalMap:m.clearcoatRoughnessMap&&(_=m.clearcoatRoughnessMap),_!==void 0&&(_.isWebGLRenderTarget&&(_=_.texture),_.matrixAutoUpdate===!0&&_.updateMatrix(),y.uvTransform.value.copy(_.matrix));let w;m.aoMap?w=m.aoMap:m.lightMap&&(w=m.lightMap),w!==void 0&&(w.isWebGLRenderTarget&&(w=w.texture),w.matrixAutoUpdate===!0&&w.updateMatrix(),y.uv2Transform.value.copy(w.matrix))}function i(y,m){y.diffuse.value.copy(m.color),y.opacity.value=m.opacity}function r(y,m){y.dashSize.value=m.dashSize,y.totalSize.value=m.dashSize+m.gapSize,y.scale.value=m.scale}function s(y,m,x,_){y.diffuse.value.copy(m.color),y.opacity.value=m.opacity,y.size.value=m.size*x,y.scale.value=_*.5,m.map&&(y.map.value=m.map),m.alphaMap&&(y.alphaMap.value=m.alphaMap);let w;m.map?w=m.map:m.alphaMap&&(w=m.alphaMap),w!==void 0&&(w.matrixAutoUpdate===!0&&w.updateMatrix(),y.uvTransform.value.copy(w.matrix))}function a(y,m){y.diffuse.value.copy(m.color),y.opacity.value=m.opacity,y.rotation.value=m.rotation,m.map&&(y.map.value=m.map),m.alphaMap&&(y.alphaMap.value=m.alphaMap);let x;m.map?x=m.map:m.alphaMap&&(x=m.alphaMap),x!==void 0&&(x.matrixAutoUpdate===!0&&x.updateMatrix(),y.uvTransform.value.copy(x.matrix))}function l(y,m){m.emissiveMap&&(y.emissiveMap.value=m.emissiveMap)}function c(y,m){y.specular.value.copy(m.specular),y.shininess.value=Math.max(m.shininess,1e-4),m.emissiveMap&&(y.emissiveMap.value=m.emissiveMap),m.bumpMap&&(y.bumpMap.value=m.bumpMap,y.bumpScale.value=m.bumpScale,m.side===zn&&(y.bumpScale.value*=-1)),m.normalMap&&(y.normalMap.value=m.normalMap,y.normalScale.value.copy(m.normalScale),m.side===zn&&y.normalScale.value.negate()),m.displacementMap&&(y.displacementMap.value=m.displacementMap,y.displacementScale.value=m.displacementScale,y.displacementBias.value=m.displacementBias)}function u(y,m){m.gradientMap&&(y.gradientMap.value=m.gradientMap),m.emissiveMap&&(y.emissiveMap.value=m.emissiveMap),m.bumpMap&&(y.bumpMap.value=m.bumpMap,y.bumpScale.value=m.bumpScale,m.side===zn&&(y.bumpScale.value*=-1)),m.normalMap&&(y.normalMap.value=m.normalMap,y.normalScale.value.copy(m.normalScale),m.side===zn&&y.normalScale.value.negate()),m.displacementMap&&(y.displacementMap.value=m.displacementMap,y.displacementScale.value=m.displacementScale,y.displacementBias.value=m.displacementBias)}function d(y,m){y.roughness.value=m.roughness,y.metalness.value=m.metalness,m.roughnessMap&&(y.roughnessMap.value=m.roughnessMap),m.metalnessMap&&(y.metalnessMap.value=m.metalnessMap),m.emissiveMap&&(y.emissiveMap.value=m.emissiveMap),m.bumpMap&&(y.bumpMap.value=m.bumpMap,y.bumpScale.value=m.bumpScale,m.side===zn&&(y.bumpScale.value*=-1)),m.normalMap&&(y.normalMap.value=m.normalMap,y.normalScale.value.copy(m.normalScale),m.side===zn&&y.normalScale.value.negate()),m.displacementMap&&(y.displacementMap.value=m.displacementMap,y.displacementScale.value=m.displacementScale,y.displacementBias.value=m.displacementBias),o.get(m).envMap&&(y.envMapIntensity.value=m.envMapIntensity)}function h(y,m){d(y,m),y.reflectivity.value=m.reflectivity,y.clearcoat.value=m.clearcoat,y.clearcoatRoughness.value=m.clearcoatRoughness,m.sheen&&y.sheen.value.copy(m.sheen),m.clearcoatMap&&(y.clearcoatMap.value=m.clearcoatMap),m.clearcoatRoughnessMap&&(y.clearcoatRoughnessMap.value=m.clearcoatRoughnessMap),m.clearcoatNormalMap&&(y.clearcoatNormalScale.value.copy(m.clearcoatNormalScale),y.clearcoatNormalMap.value=m.clearcoatNormalMap,m.side===zn&&y.clearcoatNormalScale.value.negate()),y.transmission.value=m.transmission,m.transmissionMap&&(y.transmissionMap.value=m.transmissionMap)}function f(y,m){m.matcap&&(y.matcap.value=m.matcap),m.bumpMap&&(y.bumpMap.value=m.bumpMap,y.bumpScale.value=m.bumpScale,m.side===zn&&(y.bumpScale.value*=-1)),m.normalMap&&(y.normalMap.value=m.normalMap,y.normalScale.value.copy(m.normalScale),m.side===zn&&y.normalScale.value.negate()),m.displacementMap&&(y.displacementMap.value=m.displacementMap,y.displacementScale.value=m.displacementScale,y.displacementBias.value=m.displacementBias)}function p(y,m){m.displacementMap&&(y.displacementMap.value=m.displacementMap,y.displacementScale.value=m.displacementScale,y.displacementBias.value=m.displacementBias)}function g(y,m){m.displacementMap&&(y.displacementMap.value=m.displacementMap,y.displacementScale.value=m.displacementScale,y.displacementBias.value=m.displacementBias),y.referencePosition.value.copy(m.referencePosition),y.nearDistance.value=m.nearDistance,y.farDistance.value=m.farDistance}function v(y,m){m.bumpMap&&(y.bumpMap.value=m.bumpMap,y.bumpScale.value=m.bumpScale,m.side===zn&&(y.bumpScale.value*=-1)),m.normalMap&&(y.normalMap.value=m.normalMap,y.normalScale.value.copy(m.normalScale),m.side===zn&&y.normalScale.value.negate()),m.displacementMap&&(y.displacementMap.value=m.displacementMap,y.displacementScale.value=m.displacementScale,y.displacementBias.value=m.displacementBias)}return{refreshFogUniforms:e,refreshMaterialUniforms:t}}function v$(){let o=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");return o.style.display="block",o}function Ht(o){o=o||{};let e=o.canvas!==void 0?o.canvas:v$(),t=o.context!==void 0?o.context:null,n=o.alpha!==void 0?o.alpha:!1,i=o.depth!==void 0?o.depth:!0,r=o.stencil!==void 0?o.stencil:!0,s=o.antialias!==void 0?o.antialias:!1,a=o.premultipliedAlpha!==void 0?o.premultipliedAlpha:!0,l=o.preserveDrawingBuffer!==void 0?o.preserveDrawingBuffer:!1,c=o.powerPreference!==void 0?o.powerPreference:"default",u=o.failIfMajorPerformanceCaveat!==void 0?o.failIfMajorPerformanceCaveat:!1,d=null,h=null,f=[],p=[];this.domElement=e,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.gammaFactor=2,this.outputEncoding=Qh,this.physicallyCorrectLights=!1,this.toneMapping=Vp,this.toneMappingExposure=1;let g=this,v=!1,y=0,m=0,x=null,_=-1,w=null,b=new Dt,M=new Dt,S=null,E=e.width,A=e.height,L=1,B=null,R=null,D=new Dt(0,0,E,A),P=new Dt(0,0,E,A),I=!1,N=new nm,G=!1,z=!1,se=new Ze,ne=new ae,Q={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function j(){return x===null?L:1}let O=t;function ee(re,Ce){for(let Me=0;Me<re.length;Me++){let F=re[Me],q=e.getContext(F,Ce);if(q!==null)return q}return null}try{let re={alpha:n,depth:i,stencil:r,antialias:s,premultipliedAlpha:a,preserveDrawingBuffer:l,powerPreference:c,failIfMajorPerformanceCaveat:u};if(e.addEventListener("webglcontextlost",be,!1),e.addEventListener("webglcontextrestored",we,!1),O===null){let Ce=["webgl2","webgl","experimental-webgl"];if(g.isWebGL1Renderer===!0&&Ce.shift(),O=ee(Ce,re),O===null)throw ee(Ce)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}O.getShaderPrecisionFormat===void 0&&(O.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(re){throw console.error("THREE.WebGLRenderer: "+re.message),re}let V,ie,ue,ye,pe,xe,X,$,J,ce,H,T,C,W,Z,he,me,Ee,Se,oe,ge,k;function de(){V=new HJ(O),ie=new kJ(O,V,o),V.init(ie),ge=new m$(O,V,ie),ue=new f$(O,V,ie),ye=new WJ(O),pe=new t$,xe=new p$(O,V,ue,pe,ie,ge,ye),X=new UJ(g),$=new fY(O,ie),k=new NJ(O,V,$,ie),J=new GJ(O,$,ye,k),ce=new YJ(O,J,$,ye),Ee=new jJ(O),Z=new zJ(pe),H=new e$(g,X,V,ie,k,Z),T=new y$(pe),C=new r$(pe),W=new u$(V,ie),me=new BJ(g,X,ue,ce,a),he=new UD(g,ce,ie),Se=new OJ(O,V,ye,ie),oe=new VJ(O,V,ye,ie),ye.programs=H.programs,g.capabilities=ie,g.extensions=V,g.properties=pe,g.renderLists=C,g.shadowMap=he,g.state=ue,g.info=ye}de();let K=new HD(g,O);this.xr=K,this.getContext=function(){return O},this.getContextAttributes=function(){return O.getContextAttributes()},this.forceContextLoss=function(){let re=V.get("WEBGL_lose_context");re&&re.loseContext()},this.forceContextRestore=function(){let re=V.get("WEBGL_lose_context");re&&re.restoreContext()},this.getPixelRatio=function(){return L},this.setPixelRatio=function(re){re!==void 0&&(L=re,this.setSize(E,A,!1))},this.getSize=function(re){return re===void 0&&(console.warn("WebGLRenderer: .getsize() now requires a Vector2 as an argument"),re=new Oe),re.set(E,A)},this.setSize=function(re,Ce,Me){if(K.isPresenting){console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting.");return}E=re,A=Ce,e.width=Math.floor(re*L),e.height=Math.floor(Ce*L),Me!==!1&&(e.style.width=re+"px",e.style.height=Ce+"px"),this.setViewport(0,0,re,Ce)},this.getDrawingBufferSize=function(re){return re===void 0&&(console.warn("WebGLRenderer: .getdrawingBufferSize() now requires a Vector2 as an argument"),re=new Oe),re.set(E*L,A*L).floor()},this.setDrawingBufferSize=function(re,Ce,Me){E=re,A=Ce,L=Me,e.width=Math.floor(re*Me),e.height=Math.floor(Ce*Me),this.setViewport(0,0,re,Ce)},this.getCurrentViewport=function(re){return re===void 0&&(console.warn("WebGLRenderer: .getCurrentViewport() now requires a Vector4 as an argument"),re=new Dt),re.copy(b)},this.getViewport=function(re){return re.copy(D)},this.setViewport=function(re,Ce,Me,F){re.isVector4?D.set(re.x,re.y,re.z,re.w):D.set(re,Ce,Me,F),ue.viewport(b.copy(D).multiplyScalar(L).floor())},this.getScissor=function(re){return re.copy(P)},this.setScissor=function(re,Ce,Me,F){re.isVector4?P.set(re.x,re.y,re.z,re.w):P.set(re,Ce,Me,F),ue.scissor(M.copy(P).multiplyScalar(L).floor())},this.getScissorTest=function(){return I},this.setScissorTest=function(re){ue.setScissorTest(I=re)},this.setOpaqueSort=function(re){B=re},this.setTransparentSort=function(re){R=re},this.getClearColor=function(re){return re===void 0&&(console.warn("WebGLRenderer: .getClearColor() now requires a Color as an argument"),re=new qe),re.copy(me.getClearColor())},this.setClearColor=function(){me.setClearColor.apply(me,arguments)},this.getClearAlpha=function(){return me.getClearAlpha()},this.setClearAlpha=function(){me.setClearAlpha.apply(me,arguments)},this.clear=function(re,Ce,Me){let F=0;(re===void 0||re)&&(F|=16384),(Ce===void 0||Ce)&&(F|=256),(Me===void 0||Me)&&(F|=1024),O.clear(F)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){e.removeEventListener("webglcontextlost",be,!1),e.removeEventListener("webglcontextrestored",we,!1),C.dispose(),W.dispose(),pe.dispose(),X.dispose(),ce.dispose(),k.dispose(),K.dispose(),K.removeEventListener("sessionstart",wt),K.removeEventListener("sessionend",Pr),ii.stop()};function be(re){re.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),v=!0}function we(){console.log("THREE.WebGLRenderer: Context Restored."),v=!1;let re=ye.autoReset,Ce=he.enabled,Me=he.autoUpdate,F=he.needsUpdate,q=he.type;de(),ye.autoReset=re,he.enabled=Ce,he.autoUpdate=Me,he.needsUpdate=F,he.type=q}function We(re){let Ce=re.target;Ce.removeEventListener("dispose",We),ve(Ce)}function ve(re){Be(re),pe.remove(re)}function Be(re){let Ce=pe.get(re).programs;Ce!==void 0&&Ce.forEach(function(Me){H.releaseProgram(Me)})}function nt(re,Ce){re.render(function(Me){g.renderBufferImmediate(Me,Ce)})}this.renderBufferImmediate=function(re,Ce){k.initAttributes();let Me=pe.get(re);re.hasPositions&&!Me.position&&(Me.position=O.createBuffer()),re.hasNormals&&!Me.normal&&(Me.normal=O.createBuffer()),re.hasUvs&&!Me.uv&&(Me.uv=O.createBuffer()),re.hasColors&&!Me.color&&(Me.color=O.createBuffer());let F=Ce.getAttributes();re.hasPositions&&(O.bindBuffer(34962,Me.position),O.bufferData(34962,re.positionArray,35048),k.enableAttribute(F.position),O.vertexAttribPointer(F.position,3,5126,!1,0,0)),re.hasNormals&&(O.bindBuffer(34962,Me.normal),O.bufferData(34962,re.normalArray,35048),k.enableAttribute(F.normal),O.vertexAttribPointer(F.normal,3,5126,!1,0,0)),re.hasUvs&&(O.bindBuffer(34962,Me.uv),O.bufferData(34962,re.uvArray,35048),k.enableAttribute(F.uv),O.vertexAttribPointer(F.uv,2,5126,!1,0,0)),re.hasColors&&(O.bindBuffer(34962,Me.color),O.bufferData(34962,re.colorArray,35048),k.enableAttribute(F.color),O.vertexAttribPointer(F.color,3,5126,!1,0,0)),k.disableUnusedAttributes(),O.drawArrays(4,0,re.count),re.count=0},this.renderBufferDirect=function(re,Ce,Me,F,q,Y){Ce===null&&(Ce=Q);let te=q.isMesh&&q.matrixWorld.determinant()<0,fe=Xo(re,Ce,F,q);ue.setMaterial(F,te);let Fe=Me.index,Le=Me.attributes.position;if(Fe===null){if(Le===void 0||Le.count===0)return}else if(Fe.count===0)return;let Te=1;F.wireframe===!0&&(Fe=J.getWireframeAttribute(Me),Te=2),(F.morphTargets||F.morphNormals)&&Ee.update(q,Me,F,fe),k.setup(q,F,fe,Me,Fe);let Re,Ae=Se;Fe!==null&&(Re=$.get(Fe),Ae=oe,Ae.setIndex(Re));let ze=Fe!==null?Fe.count:Le.count,Ie=Me.drawRange.start*Te,je=Me.drawRange.count*Te,rt=Y!==null?Y.start*Te:0,at=Y!==null?Y.count*Te:1/0,dt=Math.max(Ie,rt),Ke=Math.min(ze,Ie+je,rt+at)-1,Ct=Math.max(0,Ke-dt+1);if(Ct!==0){if(q.isMesh)F.wireframe===!0?(ue.setLineWidth(F.wireframeLinewidth*j()),Ae.setMode(1)):Ae.setMode(4);else if(q.isLine){let it=F.linewidth;it===void 0&&(it=1),ue.setLineWidth(it*j()),q.isLineSegments?Ae.setMode(1):q.isLineLoop?Ae.setMode(2):Ae.setMode(3)}else q.isPoints?Ae.setMode(0):q.isSprite&&Ae.setMode(4);if(q.isInstancedMesh)Ae.renderInstances(dt,Ct,q.count);else if(Me.isInstancedBufferGeometry){let it=Math.min(Me.instanceCount,Me._maxInstanceCount);Ae.renderInstances(dt,Ct,it)}else Ae.render(dt,Ct)}},this.compile=function(re,Ce){h=W.get(re),h.init(),re.traverseVisible(function(Me){Me.isLight&&Me.layers.test(Ce.layers)&&(h.pushLight(Me),Me.castShadow&&h.pushShadow(Me))}),h.setupLights(),re.traverse(function(Me){let F=Me.material;if(F)if(Array.isArray(F))for(let q=0;q<F.length;q++){let Y=F[q];vl(Y,re,Me)}else vl(F,re,Me)})};let Xe=null;function _t(re){Xe&&Xe(re)}function wt(){ii.stop()}function Pr(){ii.start()}let ii=new vD;ii.setAnimationLoop(_t),typeof window!="undefined"&&ii.setContext(window),this.setAnimationLoop=function(re){Xe=re,K.setAnimationLoop(re),re===null?ii.stop():ii.start()},K.addEventListener("sessionstart",wt),K.addEventListener("sessionend",Pr),this.render=function(re,Ce){let Me,F;if(arguments[2]!==void 0&&(console.warn("THREE.WebGLRenderer.render(): the renderTarget argument has been removed. Use .setRenderTarget() instead."),Me=arguments[2]),arguments[3]!==void 0&&(console.warn("THREE.WebGLRenderer.render(): the forceClear argument has been removed. Use .clear() instead."),F=arguments[3]),Ce!==void 0&&Ce.isCamera!==!0){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(v===!0)return;re.autoUpdate===!0&&re.updateMatrixWorld(),Ce.parent===null&&Ce.updateMatrixWorld(),K.enabled===!0&&K.isPresenting===!0&&(Ce=K.getCamera(Ce)),re.isScene===!0&&re.onBeforeRender(g,re,Ce,Me||x),h=W.get(re,p.length),h.init(),p.push(h),se.multiplyMatrices(Ce.projectionMatrix,Ce.matrixWorldInverse),N.setFromProjectionMatrix(se),z=this.localClippingEnabled,G=Z.init(this.clippingPlanes,z,Ce),d=C.get(re,f.length),d.init(),f.push(d),In(re,Ce,0,g.sortObjects),d.finish(),g.sortObjects===!0&&d.sort(B,R),G===!0&&Z.beginShadows();let q=h.state.shadowsArray;he.render(q,re,Ce),h.setupLights(),h.setupLightsView(Ce),G===!0&&Z.endShadows(),this.info.autoReset===!0&&this.info.reset(),Me!==void 0&&this.setRenderTarget(Me),me.render(d,re,Ce,F);let Y=d.opaque,te=d.transparent;Y.length>0&&Bt(Y,re,Ce),te.length>0&&Bt(te,re,Ce),x!==null&&(xe.updateRenderTargetMipmap(x),xe.updateMultisampleRenderTarget(x)),re.isScene===!0&&re.onAfterRender(g,re,Ce),ue.buffers.depth.setTest(!0),ue.buffers.depth.setMask(!0),ue.buffers.color.setMask(!0),ue.setPolygonOffset(!1),k.resetDefaultState(),_=-1,w=null,p.pop(),p.length>0?h=p[p.length-1]:h=null,f.pop(),f.length>0?d=f[f.length-1]:d=null};function In(re,Ce,Me,F){if(re.visible===!1)return;if(re.layers.test(Ce.layers)){if(re.isGroup)Me=re.renderOrder;else if(re.isLOD)re.autoUpdate===!0&&re.update(Ce);else if(re.isLight)h.pushLight(re),re.castShadow&&h.pushShadow(re);else if(re.isSprite){if(!re.frustumCulled||N.intersectsSprite(re)){F&&ne.setFromMatrixPosition(re.matrixWorld).applyMatrix4(se);let te=ce.update(re),fe=re.material;fe.visible&&d.push(re,te,fe,Me,ne.z,null)}}else if(re.isImmediateRenderObject)F&&ne.setFromMatrixPosition(re.matrixWorld).applyMatrix4(se),d.push(re,null,re.material,Me,ne.z,null);else if((re.isMesh||re.isLine||re.isPoints)&&(re.isSkinnedMesh&&re.skeleton.frame!==ye.render.frame&&(re.skeleton.update(),re.skeleton.frame=ye.render.frame),!re.frustumCulled||N.intersectsObject(re))){F&&ne.setFromMatrixPosition(re.matrixWorld).applyMatrix4(se);let te=ce.update(re),fe=re.material;if(Array.isArray(fe)){let Fe=te.groups;for(let Le=0,Te=Fe.length;Le<Te;Le++){let Re=Fe[Le],Ae=fe[Re.materialIndex];Ae&&Ae.visible&&d.push(re,te,Ae,Me,ne.z,Re)}}else fe.visible&&d.push(re,te,fe,Me,ne.z,null)}}let Y=re.children;for(let te=0,fe=Y.length;te<fe;te++)In(Y[te],Ce,Me,F)}function Bt(re,Ce,Me){let F=Ce.isScene===!0?Ce.overrideMaterial:null;for(let q=0,Y=re.length;q<Y;q++){let te=re[q],fe=te.object,Fe=te.geometry,Le=F===null?te.material:F,Te=te.group;if(Me.isArrayCamera){let Re=Me.cameras;for(let Ae=0,ze=Re.length;Ae<ze;Ae++){let Ie=Re[Ae];fe.layers.test(Ie.layers)&&(ue.viewport(b.copy(Ie.viewport)),h.setupLightsView(Ie),Wo(fe,Ce,Ie,Fe,Le,Te))}}else Wo(fe,Ce,Me,Fe,Le,Te)}}function Wo(re,Ce,Me,F,q,Y){if(re.onBeforeRender(g,Ce,Me,F,q,Y),re.modelViewMatrix.multiplyMatrices(Me.matrixWorldInverse,re.matrixWorld),re.normalMatrix.getNormalMatrix(re.modelViewMatrix),re.isImmediateRenderObject){let te=Xo(Me,Ce,q,re);ue.setMaterial(q),k.reset(),nt(re,te)}else g.renderBufferDirect(Me,Ce,F,q,re,Y);re.onAfterRender(g,Ce,Me,F,q,Y)}function vl(re,Ce,Me){Ce.isScene!==!0&&(Ce=Q);let F=pe.get(re),q=h.state.lights,Y=h.state.shadowsArray,te=q.state.version,fe=H.getParameters(re,q.state,Y,Ce,Me),Fe=H.getProgramCacheKey(fe),Le=F.programs;F.environment=re.isMeshStandardMaterial?Ce.environment:null,F.fog=Ce.fog,F.envMap=X.get(re.envMap||F.environment),Le===void 0&&(re.addEventListener("dispose",We),Le=new Map,F.programs=Le);let Te=Le.get(Fe);if(Te!==void 0){if(F.currentProgram===Te&&F.lightsStateVersion===te)return cr(re,fe),Te}else fe.uniforms=H.getUniforms(re),re.onBuild(fe,g),re.onBeforeCompile(fe,g),Te=H.acquireProgram(fe,Fe),Le.set(Fe,Te),F.uniforms=fe.uniforms;let Re=F.uniforms;(!re.isShaderMaterial&&!re.isRawShaderMaterial||re.clipping===!0)&&(Re.clippingPlanes=Z.uniform),cr(re,fe),F.needsLights=xl(re),F.lightsStateVersion=te,F.needsLights&&(Re.ambientLightColor.value=q.state.ambient,Re.lightProbe.value=q.state.probe,Re.directionalLights.value=q.state.directional,Re.directionalLightShadows.value=q.state.directionalShadow,Re.spotLights.value=q.state.spot,Re.spotLightShadows.value=q.state.spotShadow,Re.rectAreaLights.value=q.state.rectArea,Re.ltc_1.value=q.state.rectAreaLTC1,Re.ltc_2.value=q.state.rectAreaLTC2,Re.pointLights.value=q.state.point,Re.pointLightShadows.value=q.state.pointShadow,Re.hemisphereLights.value=q.state.hemi,Re.directionalShadowMap.value=q.state.directionalShadowMap,Re.directionalShadowMatrix.value=q.state.directionalShadowMatrix,Re.spotShadowMap.value=q.state.spotShadowMap,Re.spotShadowMatrix.value=q.state.spotShadowMatrix,Re.pointShadowMap.value=q.state.pointShadowMap,Re.pointShadowMatrix.value=q.state.pointShadowMatrix);let Ae=Te.getUniforms(),ze=$a.seqWithValue(Ae.seq,Re);return F.currentProgram=Te,F.uniformsList=ze,Te}function cr(re,Ce){let Me=pe.get(re);Me.outputEncoding=Ce.outputEncoding,Me.instancing=Ce.instancing,Me.numClippingPlanes=Ce.numClippingPlanes,Me.numIntersection=Ce.numClipIntersection,Me.vertexAlphas=Ce.vertexAlphas}function Xo(re,Ce,Me,F){Ce.isScene!==!0&&(Ce=Q),xe.resetTextureUnits();let q=Ce.fog,Y=Me.isMeshStandardMaterial?Ce.environment:null,te=x===null?g.outputEncoding:x.texture.encoding,fe=X.get(Me.envMap||Y),Fe=Me.vertexColors===!0&&F.geometry&&F.geometry.attributes.color&&F.geometry.attributes.color.itemSize===4,Le=pe.get(Me),Te=h.state.lights;if(G===!0&&(z===!0||re!==w)){let dt=re===w&&Me.id===_;Z.setState(Me,re,dt)}let Re=!1;Me.version===Le.__version?(Le.needsLights&&Le.lightsStateVersion!==Te.state.version||Le.outputEncoding!==te||F.isInstancedMesh&&Le.instancing===!1||!F.isInstancedMesh&&Le.instancing===!0||Le.envMap!==fe||Me.fog&&Le.fog!==q||Le.numClippingPlanes!==void 0&&(Le.numClippingPlanes!==Z.numPlanes||Le.numIntersection!==Z.numIntersection)||Le.vertexAlphas!==Fe)&&(Re=!0):(Re=!0,Le.__version=Me.version);let Ae=Le.currentProgram;Re===!0&&(Ae=vl(Me,Ce,F));let ze=!1,Ie=!1,je=!1,rt=Ae.getUniforms(),at=Le.uniforms;if(ue.useProgram(Ae.program)&&(ze=!0,Ie=!0,je=!0),Me.id!==_&&(_=Me.id,Ie=!0),ze||w!==re){if(rt.setValue(O,"projectionMatrix",re.projectionMatrix),ie.logarithmicDepthBuffer&&rt.setValue(O,"logDepthBufFC",2/(Math.log(re.far+1)/Math.LN2)),w!==re&&(w=re,Ie=!0,je=!0),Me.isShaderMaterial||Me.isMeshPhongMaterial||Me.isMeshToonMaterial||Me.isMeshStandardMaterial||Me.envMap){let dt=rt.map.cameraPosition;dt!==void 0&&dt.setValue(O,ne.setFromMatrixPosition(re.matrixWorld))}(Me.isMeshPhongMaterial||Me.isMeshToonMaterial||Me.isMeshLambertMaterial||Me.isMeshBasicMaterial||Me.isMeshStandardMaterial||Me.isShaderMaterial)&&rt.setValue(O,"isOrthographic",re.isOrthographicCamera===!0),(Me.isMeshPhongMaterial||Me.isMeshToonMaterial||Me.isMeshLambertMaterial||Me.isMeshBasicMaterial||Me.isMeshStandardMaterial||Me.isShaderMaterial||Me.isShadowMaterial||Me.skinning)&&rt.setValue(O,"viewMatrix",re.matrixWorldInverse)}if(Me.skinning){rt.setOptional(O,F,"bindMatrix"),rt.setOptional(O,F,"bindMatrixInverse");let dt=F.skeleton;if(dt){let Ke=dt.bones;if(ie.floatVertexTextures){if(dt.boneTexture===null){let Ct=Math.sqrt(Ke.length*4);Ct=QI(Ct),Ct=Math.max(Ct,4);let it=new Float32Array(Ct*Ct*4);it.set(dt.boneMatrices);let Wd=new Q1(it,Ct,Ct,ts,Ha);dt.boneMatrices=it,dt.boneTexture=Wd,dt.boneTextureSize=Ct}rt.setValue(O,"boneTexture",dt.boneTexture,xe),rt.setValue(O,"boneTextureSize",dt.boneTextureSize)}else rt.setOptional(O,dt,"boneMatrices")}}return(Ie||Le.receiveShadow!==F.receiveShadow)&&(Le.receiveShadow=F.receiveShadow,rt.setValue(O,"receiveShadow",F.receiveShadow)),Ie&&(rt.setValue(O,"toneMappingExposure",g.toneMappingExposure),Le.needsLights&&js(at,je),q&&Me.fog&&T.refreshFogUniforms(at,q),T.refreshMaterialUniforms(at,Me,L,A),$a.upload(O,Le.uniformsList,at,xe)),Me.isShaderMaterial&&Me.uniformsNeedUpdate===!0&&($a.upload(O,Le.uniformsList,at,xe),Me.uniformsNeedUpdate=!1),Me.isSpriteMaterial&&rt.setValue(O,"center",F.center),rt.setValue(O,"modelViewMatrix",F.modelViewMatrix),rt.setValue(O,"normalMatrix",F.normalMatrix),rt.setValue(O,"modelMatrix",F.matrixWorld),Ae}function js(re,Ce){re.ambientLightColor.needsUpdate=Ce,re.lightProbe.needsUpdate=Ce,re.directionalLights.needsUpdate=Ce,re.directionalLightShadows.needsUpdate=Ce,re.pointLights.needsUpdate=Ce,re.pointLightShadows.needsUpdate=Ce,re.spotLights.needsUpdate=Ce,re.spotLightShadows.needsUpdate=Ce,re.rectAreaLights.needsUpdate=Ce,re.hemisphereLights.needsUpdate=Ce}function xl(re){return re.isMeshLambertMaterial||re.isMeshToonMaterial||re.isMeshPhongMaterial||re.isMeshStandardMaterial||re.isShadowMaterial||re.isShaderMaterial&&re.lights===!0}this.getActiveCubeFace=function(){return y},this.getActiveMipmapLevel=function(){return m},this.getRenderTarget=function(){return x},this.setRenderTarget=function(re,Ce=0,Me=0){x=re,y=Ce,m=Me,re&&pe.get(re).__webglFramebuffer===void 0&&xe.setupRenderTarget(re);let F=null,q=!1,Y=!1;if(re){let te=re.texture;(te.isDataTexture3D||te.isDataTexture2DArray)&&(Y=!0);let fe=pe.get(re).__webglFramebuffer;re.isWebGLCubeRenderTarget?(F=fe[Ce],q=!0):re.isWebGLMultisampleRenderTarget?F=pe.get(re).__webglMultisampledFramebuffer:F=fe,b.copy(re.viewport),M.copy(re.scissor),S=re.scissorTest}else b.copy(D).multiplyScalar(L).floor(),M.copy(P).multiplyScalar(L).floor(),S=I;if(ue.bindFramebuffer(36160,F),ue.viewport(b),ue.scissor(M),ue.setScissorTest(S),q){let te=pe.get(re.texture);O.framebufferTexture2D(36160,36064,34069+Ce,te.__webglTexture,Me)}else if(Y){let te=pe.get(re.texture),fe=Ce||0;O.framebufferTextureLayer(36160,36064,te.__webglTexture,Me||0,fe)}},this.readRenderTargetPixels=function(re,Ce,Me,F,q,Y,te){if(!(re&&re.isWebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}let fe=pe.get(re).__webglFramebuffer;if(re.isWebGLCubeRenderTarget&&te!==void 0&&(fe=fe[te]),fe){ue.bindFramebuffer(36160,fe);try{let Fe=re.texture,Le=Fe.format,Te=Fe.type;if(Le!==ts&&ge.convert(Le)!==O.getParameter(35739)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}let Re=Te===pv&&(V.has("EXT_color_buffer_half_float")||ie.isWebGL2&&V.has("EXT_color_buffer_float"));if(Te!==_1&&ge.convert(Te)!==O.getParameter(35738)&&!(Te===Ha&&(ie.isWebGL2||V.has("OES_texture_float")||V.has("WEBGL_color_buffer_float")))&&!Re){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}O.checkFramebufferStatus(36160)===36053?Ce>=0&&Ce<=re.width-F&&Me>=0&&Me<=re.height-q&&O.readPixels(Ce,Me,F,q,ge.convert(Le),ge.convert(Te),Y):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.")}finally{let Fe=x!==null?pe.get(x).__webglFramebuffer:null;ue.bindFramebuffer(36160,Fe)}}},this.copyFramebufferToTexture=function(re,Ce,Me=0){let F=Math.pow(2,-Me),q=Math.floor(Ce.image.width*F),Y=Math.floor(Ce.image.height*F),te=ge.convert(Ce.format);xe.setTexture2D(Ce,0),O.copyTexImage2D(3553,Me,te,re.x,re.y,q,Y,0),ue.unbindTexture()},this.copyTextureToTexture=function(re,Ce,Me,F=0){let q=Ce.image.width,Y=Ce.image.height,te=ge.convert(Me.format),fe=ge.convert(Me.type);xe.setTexture2D(Me,0),O.pixelStorei(37440,Me.flipY),O.pixelStorei(37441,Me.premultiplyAlpha),O.pixelStorei(3317,Me.unpackAlignment),Ce.isDataTexture?O.texSubImage2D(3553,F,re.x,re.y,q,Y,te,fe,Ce.image.data):Ce.isCompressedTexture?O.compressedTexSubImage2D(3553,F,re.x,re.y,Ce.mipmaps[0].width,Ce.mipmaps[0].height,te,Ce.mipmaps[0].data):O.texSubImage2D(3553,F,re.x,re.y,te,fe,Ce.image),F===0&&Me.generateMipmaps&&O.generateMipmap(3553),ue.unbindTexture()},this.copyTextureToTexture3D=function(re,Ce,Me,F,q=0){if(g.isWebGL1Renderer){console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");return}let{width:Y,height:te,data:fe}=Me.image,Fe=ge.convert(F.format),Le=ge.convert(F.type),Te;if(F.isDataTexture3D)xe.setTexture3D(F,0),Te=32879;else if(F.isDataTexture2DArray)xe.setTexture2DArray(F,0),Te=35866;else{console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");return}O.pixelStorei(37440,F.flipY),O.pixelStorei(37441,F.premultiplyAlpha),O.pixelStorei(3317,F.unpackAlignment);let Re=O.getParameter(3314),Ae=O.getParameter(32878),ze=O.getParameter(3316),Ie=O.getParameter(3315),je=O.getParameter(32877);O.pixelStorei(3314,Y),O.pixelStorei(32878,te),O.pixelStorei(3316,re.min.x),O.pixelStorei(3315,re.min.y),O.pixelStorei(32877,re.min.z),O.texSubImage3D(Te,q,Ce.x,Ce.y,Ce.z,re.max.x-re.min.x+1,re.max.y-re.min.y+1,re.max.z-re.min.z+1,Fe,Le,fe),O.pixelStorei(3314,Re),O.pixelStorei(32878,Ae),O.pixelStorei(3316,ze),O.pixelStorei(3315,Ie),O.pixelStorei(32877,je),q===0&&F.generateMipmaps&&O.generateMipmap(Te),ue.unbindTexture()},this.initTexture=function(re){xe.setTexture2D(re,0),ue.unbindTexture()},this.resetState=function(){y=0,m=0,x=null,ue.reset(),k.reset()},typeof __THREE_DEVTOOLS__!="undefined"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}var GD=class extends Ht{};GD.prototype.isWebGL1Renderer=!0;var Uv=class{constructor(e,t=25e-5){this.name="",this.color=new qe(e),this.density=t}clone(){return new Uv(this.color,this.density)}toJSON(){return{type:"FogExp2",color:this.color.getHex(),density:this.density}}};Uv.prototype.isFogExp2=!0;var Hv=class{constructor(e,t=1,n=1e3){this.name="",this.color=new qe(e),this.near=t,this.far=n}clone(){return new Hv(this.color,this.near,this.far)}toJSON(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}}};Hv.prototype.isFog=!0;var aS=class extends ot{constructor(){super();this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0,typeof __THREE_DEVTOOLS__!="undefined"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),e.background!==null&&(this.background=e.background.clone()),e.environment!==null&&(this.environment=e.environment.clone()),e.fog!==null&&(this.fog=e.fog.clone()),e.overrideMaterial!==null&&(this.overrideMaterial=e.overrideMaterial.clone()),this.autoUpdate=e.autoUpdate,this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){let t=super.toJSON(e);return this.background!==null&&(t.object.background=this.background.toJSON(e)),this.environment!==null&&(t.object.environment=this.environment.toJSON(e)),this.fog!==null&&(t.object.fog=this.fog.toJSON()),t}};aS.prototype.isScene=!0;var Sr=class{constructor(e,t){this.array=e,this.stride=t,this.count=e!==void 0?e.length/t:0,this.usage=jp,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=nr(),this.onUploadCallback=function(){}}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}copyAt(e,t,n){e*=this.stride,n*=t.stride;for(let i=0,r=this.stride;i<r;i++)this.array[e+i]=t.array[n+i];return this}set(e,t=0){return this.array.set(e,t),this}clone(e){e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=nr()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);let t=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),n=new Sr(t,this.stride);return n.setUsage(this.usage),n}onUpload(e){return this.onUploadCallback=e,this}toJSON(e){return e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=nr()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=Array.prototype.slice.call(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}};Sr.prototype.isInterleavedBuffer=!0;var Mn=new ae,ks=class{constructor(e,t,n,i){this.name="",this.data=e,this.itemSize=t,this.offset=n,this.normalized=i===!0}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){this.data.needsUpdate=e}applyMatrix4(e){for(let t=0,n=this.data.count;t<n;t++)Mn.x=this.getX(t),Mn.y=this.getY(t),Mn.z=this.getZ(t),Mn.applyMatrix4(e),this.setXYZ(t,Mn.x,Mn.y,Mn.z);return this}applyNormalMatrix(e){for(let t=0,n=this.count;t<n;t++)Mn.x=this.getX(t),Mn.y=this.getY(t),Mn.z=this.getZ(t),Mn.applyNormalMatrix(e),this.setXYZ(t,Mn.x,Mn.y,Mn.z);return this}transformDirection(e){for(let t=0,n=this.count;t<n;t++)Mn.x=this.getX(t),Mn.y=this.getY(t),Mn.z=this.getZ(t),Mn.transformDirection(e),this.setXYZ(t,Mn.x,Mn.y,Mn.z);return this}setX(e,t){return this.data.array[e*this.data.stride+this.offset]=t,this}setY(e,t){return this.data.array[e*this.data.stride+this.offset+1]=t,this}setZ(e,t){return this.data.array[e*this.data.stride+this.offset+2]=t,this}setW(e,t){return this.data.array[e*this.data.stride+this.offset+3]=t,this}getX(e){return this.data.array[e*this.data.stride+this.offset]}getY(e){return this.data.array[e*this.data.stride+this.offset+1]}getZ(e){return this.data.array[e*this.data.stride+this.offset+2]}getW(e){return this.data.array[e*this.data.stride+this.offset+3]}setXY(e,t,n){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=n,this}setXYZ(e,t,n,i){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=i,this}setXYZW(e,t,n,i,r){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=i,this.data.array[e+3]=r,this}clone(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interlaved buffer attribute will deinterleave buffer data.");let t=[];for(let n=0;n<this.count;n++){let i=n*this.data.stride+this.offset;for(let r=0;r<this.itemSize;r++)t.push(this.data.array[i+r])}return new jt(new this.array.constructor(t),this.itemSize,this.normalized)}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new ks(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interlaved buffer attribute will deinterleave buffer data.");let t=[];for(let n=0;n<this.count;n++){let i=n*this.data.stride+this.offset;for(let r=0;r<this.itemSize;r++)t.push(this.data.array[i+r])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:t,normalized:this.normalized}}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}};ks.prototype.isInterleavedBufferAttribute=!0;var lS=class extends bn{constructor(e){super();this.type="SpriteMaterial",this.color=new qe(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this}};lS.prototype.isSpriteMaterial=!0;var yd,sm=new ae,vd=new ae,xd=new ae,_d=new Oe,om=new Oe,VD=new Ze,Gv=new ae,am=new ae,Vv=new ae,WD=new Oe,cS=new Oe,XD=new Oe,qD=class extends ot{constructor(e){super();if(this.type="Sprite",yd===void 0){yd=new Et;let t=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),n=new Sr(t,5);yd.setIndex([0,1,2,0,2,3]),yd.setAttribute("position",new ks(n,3,0,!1)),yd.setAttribute("uv",new ks(n,2,3,!1))}this.geometry=yd,this.material=e!==void 0?e:new lS,this.center=new Oe(.5,.5)}raycast(e,t){e.camera===null&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),vd.setFromMatrixScale(this.matrixWorld),VD.copy(e.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(e.camera.matrixWorldInverse,this.matrixWorld),xd.setFromMatrixPosition(this.modelViewMatrix),e.camera.isPerspectiveCamera&&this.material.sizeAttenuation===!1&&vd.multiplyScalar(-xd.z);let n=this.material.rotation,i,r;n!==0&&(r=Math.cos(n),i=Math.sin(n));let s=this.center;Wv(Gv.set(-.5,-.5,0),xd,s,vd,i,r),Wv(am.set(.5,-.5,0),xd,s,vd,i,r),Wv(Vv.set(.5,.5,0),xd,s,vd,i,r),WD.set(0,0),cS.set(1,0),XD.set(1,1);let a=e.ray.intersectTriangle(Gv,am,Vv,!1,sm);if(a===null&&(Wv(am.set(-.5,.5,0),xd,s,vd,i,r),cS.set(0,1),a=e.ray.intersectTriangle(Gv,Vv,am,!1,sm),a===null))return;let l=e.ray.origin.distanceTo(sm);l<e.near||l>e.far||t.push({distance:l,point:sm.clone(),uv:wn.getUV(sm,Gv,am,Vv,WD,cS,XD,new Oe),face:null,object:this})}copy(e){return super.copy(e),e.center!==void 0&&this.center.copy(e.center),this.material=e.material,this}};qD.prototype.isSprite=!0;function Wv(o,e,t,n,i,r){_d.subVectors(o,t).addScalar(.5).multiply(n),i!==void 0?(om.x=r*_d.x-i*_d.y,om.y=i*_d.x+r*_d.y):om.copy(_d),o.copy(e),o.x+=om.x,o.y+=om.y,o.applyMatrix4(VD)}var jD=new ae,YD=new Dt,ZD=new Dt,x$=new ae,JD=new Ze,lm=class extends Vn{constructor(e,t){super(e,t);this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new Ze,this.bindMatrixInverse=new Ze}copy(e){return super.copy(e),this.bindMode=e.bindMode,this.bindMatrix.copy(e.bindMatrix),this.bindMatrixInverse.copy(e.bindMatrixInverse),this.skeleton=e.skeleton,this}bind(e,t){this.skeleton=e,t===void 0&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.copy(t).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){let e=new Dt,t=this.geometry.attributes.skinWeight;for(let n=0,i=t.count;n<i;n++){e.x=t.getX(n),e.y=t.getY(n),e.z=t.getZ(n),e.w=t.getW(n);let r=1/e.manhattanLength();r!==1/0?e.multiplyScalar(r):e.set(1,0,0,0),t.setXYZW(n,e.x,e.y,e.z,e.w)}}updateMatrixWorld(e){super.updateMatrixWorld(e),this.bindMode==="attached"?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode==="detached"?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}boneTransform(e,t){let n=this.skeleton,i=this.geometry;YD.fromBufferAttribute(i.attributes.skinIndex,e),ZD.fromBufferAttribute(i.attributes.skinWeight,e),jD.fromBufferAttribute(i.attributes.position,e).applyMatrix4(this.bindMatrix),t.set(0,0,0);for(let r=0;r<4;r++){let s=ZD.getComponent(r);if(s!==0){let a=YD.getComponent(r);JD.multiplyMatrices(n.bones[a].matrixWorld,n.boneInverses[a]),t.addScaledVector(x$.copy(jD).applyMatrix4(JD),s)}}return t.applyMatrix4(this.bindMatrixInverse)}};lm.prototype.isSkinnedMesh=!0;var cm=class extends ot{constructor(){super();this.type="Bone"}};cm.prototype.isBone=!0;var KD=new Ze,_$=new Ze,um=class{constructor(e=[],t=[]){this.uuid=nr(),this.bones=e.slice(0),this.boneInverses=t,this.boneMatrices=null,this.boneTexture=null,this.boneTextureSize=0,this.frame=-1,this.init()}init(){let e=this.bones,t=this.boneInverses;if(this.boneMatrices=new Float32Array(e.length*16),t.length===0)this.calculateInverses();else if(e.length!==t.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let n=0,i=this.bones.length;n<i;n++)this.boneInverses.push(new Ze)}}calculateInverses(){this.boneInverses.length=0;for(let e=0,t=this.bones.length;e<t;e++){let n=new Ze;this.bones[e]&&n.copy(this.bones[e].matrixWorld).invert(),this.boneInverses.push(n)}}pose(){for(let e=0,t=this.bones.length;e<t;e++){let n=this.bones[e];n&&n.matrixWorld.copy(this.boneInverses[e]).invert()}for(let e=0,t=this.bones.length;e<t;e++){let n=this.bones[e];n&&(n.parent&&n.parent.isBone?(n.matrix.copy(n.parent.matrixWorld).invert(),n.matrix.multiply(n.matrixWorld)):n.matrix.copy(n.matrixWorld),n.matrix.decompose(n.position,n.quaternion,n.scale))}}update(){let e=this.bones,t=this.boneInverses,n=this.boneMatrices,i=this.boneTexture;for(let r=0,s=e.length;r<s;r++){let a=e[r]?e[r].matrixWorld:_$;KD.multiplyMatrices(a,t[r]),KD.toArray(n,r*16)}i!==null&&(i.needsUpdate=!0)}clone(){return new um(this.bones,this.boneInverses)}getBoneByName(e){for(let t=0,n=this.bones.length;t<n;t++){let i=this.bones[t];if(i.name===e)return i}}dispose(){this.boneTexture!==null&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(e,t){this.uuid=e.uuid;for(let n=0,i=e.bones.length;n<i;n++){let r=e.bones[n],s=t[r];s===void 0&&(console.warn("THREE.Skeleton: No bone found with UUID:",r),s=new cm),this.bones.push(s),this.boneInverses.push(new Ze().fromArray(e.boneInverses[n]))}return this.init(),this}toJSON(){let e={metadata:{version:4.5,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};e.uuid=this.uuid;let t=this.bones,n=this.boneInverses;for(let i=0,r=t.length;i<r;i++){let s=t[i];e.bones.push(s.uuid);let a=n[i];e.boneInverses.push(a.toArray())}return e}},$D=new Ze,QD=new Ze,Xv=[],hm=new Vn,eF=class extends Vn{constructor(e,t,n){super(e,t);this.instanceMatrix=new jt(new Float32Array(n*16),16),this.instanceColor=null,this.count=n,this.frustumCulled=!1}copy(e){return super.copy(e),this.instanceMatrix.copy(e.instanceMatrix),e.instanceColor!==null&&(this.instanceColor=e.instanceColor.clone()),this.count=e.count,this}getColorAt(e,t){t.fromArray(this.instanceColor.array,e*3)}getMatrixAt(e,t){t.fromArray(this.instanceMatrix.array,e*16)}raycast(e,t){let n=this.matrixWorld,i=this.count;if(hm.geometry=this.geometry,hm.material=this.material,hm.material!==void 0)for(let r=0;r<i;r++){this.getMatrixAt(r,$D),QD.multiplyMatrices(n,$D),hm.matrixWorld=QD,hm.raycast(e,Xv);for(let s=0,a=Xv.length;s<a;s++){let l=Xv[s];l.instanceId=r,l.object=this,t.push(l)}Xv.length=0}}setColorAt(e,t){this.instanceColor===null&&(this.instanceColor=new jt(new Float32Array(this.count*3),3)),t.toArray(this.instanceColor.array,e*3)}setMatrixAt(e,t){t.toArray(this.instanceMatrix.array,e*16)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"})}};eF.prototype.isInstancedMesh=!0;var Qa=class extends bn{constructor(e){super();this.type="LineBasicMaterial",this.color=new qe(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.morphTargets=!1,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.morphTargets=e.morphTargets,this}};Qa.prototype.isLineBasicMaterial=!0;var tF=new ae,nF=new ae,iF=new Ze,uS=new yc,qv=new Po,wd=class extends ot{constructor(e=new Et,t=new Qa){super();this.type="Line",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e){return super.copy(e),this.material=e.material,this.geometry=e.geometry,this}computeLineDistances(){let e=this.geometry;if(e.isBufferGeometry)if(e.index===null){let t=e.attributes.position,n=[0];for(let i=1,r=t.count;i<r;i++)tF.fromBufferAttribute(t,i-1),nF.fromBufferAttribute(t,i),n[i]=n[i-1],n[i]+=tF.distanceTo(nF);e.setAttribute("lineDistance",new fn(n,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else e.isGeometry&&console.error("THREE.Line.computeLineDistances() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");return this}raycast(e,t){let n=this.geometry,i=this.matrixWorld,r=e.params.Line.threshold,s=n.drawRange;if(n.boundingSphere===null&&n.computeBoundingSphere(),qv.copy(n.boundingSphere),qv.applyMatrix4(i),qv.radius+=r,e.ray.intersectsSphere(qv)===!1)return;iF.copy(i).invert(),uS.copy(e.ray).applyMatrix4(iF);let a=r/((this.scale.x+this.scale.y+this.scale.z)/3),l=a*a,c=new ae,u=new ae,d=new ae,h=new ae,f=this.isLineSegments?2:1;if(n.isBufferGeometry){let p=n.index,v=n.attributes.position;if(p!==null){let y=Math.max(0,s.start),m=Math.min(p.count,s.start+s.count);for(let x=y,_=m-1;x<_;x+=f){let w=p.getX(x),b=p.getX(x+1);if(c.fromBufferAttribute(v,w),u.fromBufferAttribute(v,b),uS.distanceSqToSegment(c,u,h,d)>l)continue;h.applyMatrix4(this.matrixWorld);let S=e.ray.origin.distanceTo(h);S<e.near||S>e.far||t.push({distance:S,point:d.clone().applyMatrix4(this.matrixWorld),index:x,face:null,faceIndex:null,object:this})}}else{let y=Math.max(0,s.start),m=Math.min(v.count,s.start+s.count);for(let x=y,_=m-1;x<_;x+=f){if(c.fromBufferAttribute(v,x),u.fromBufferAttribute(v,x+1),uS.distanceSqToSegment(c,u,h,d)>l)continue;h.applyMatrix4(this.matrixWorld);let b=e.ray.origin.distanceTo(h);b<e.near||b>e.far||t.push({distance:b,point:d.clone().applyMatrix4(this.matrixWorld),index:x,face:null,faceIndex:null,object:this})}}}else n.isGeometry&&console.error("THREE.Line.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}updateMorphTargets(){let e=this.geometry;if(e.isBufferGeometry){let t=e.morphAttributes,n=Object.keys(t);if(n.length>0){let i=t[n[0]];if(i!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let r=0,s=i.length;r<s;r++){let a=i[r].name||String(r);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=r}}}}else{let t=e.morphTargets;t!==void 0&&t.length>0&&console.error("THREE.Line.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}};wd.prototype.isLine=!0;var rF=new ae,sF=new ae,bd=class extends wd{constructor(e,t){super(e,t);this.type="LineSegments"}computeLineDistances(){let e=this.geometry;if(e.isBufferGeometry)if(e.index===null){let t=e.attributes.position,n=[];for(let i=0,r=t.count;i<r;i+=2)rF.fromBufferAttribute(t,i),sF.fromBufferAttribute(t,i+1),n[i]=i===0?0:n[i-1],n[i+1]=n[i]+rF.distanceTo(sF);e.setAttribute("lineDistance",new fn(n,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else e.isGeometry&&console.error("THREE.LineSegments.computeLineDistances() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");return this}};bd.prototype.isLineSegments=!0;var jv=class extends wd{constructor(e,t){super(e,t);this.type="LineLoop"}};jv.prototype.isLineLoop=!0;var dm=class extends bn{constructor(e){super();this.type="PointsMaterial",this.color=new qe(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.morphTargets=!1,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.morphTargets=e.morphTargets,this}};dm.prototype.isPointsMaterial=!0;var oF=new Ze,hS=new yc,Yv=new Po,Zv=new ae,Jv=class extends ot{constructor(e=new Et,t=new dm){super();this.type="Points",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e){return super.copy(e),this.material=e.material,this.geometry=e.geometry,this}raycast(e,t){let n=this.geometry,i=this.matrixWorld,r=e.params.Points.threshold,s=n.drawRange;if(n.boundingSphere===null&&n.computeBoundingSphere(),Yv.copy(n.boundingSphere),Yv.applyMatrix4(i),Yv.radius+=r,e.ray.intersectsSphere(Yv)===!1)return;oF.copy(i).invert(),hS.copy(e.ray).applyMatrix4(oF);let a=r/((this.scale.x+this.scale.y+this.scale.z)/3),l=a*a;if(n.isBufferGeometry){let c=n.index,d=n.attributes.position;if(c!==null){let h=Math.max(0,s.start),f=Math.min(c.count,s.start+s.count);for(let p=h,g=f;p<g;p++){let v=c.getX(p);Zv.fromBufferAttribute(d,v),aF(Zv,v,l,i,e,t,this)}}else{let h=Math.max(0,s.start),f=Math.min(d.count,s.start+s.count);for(let p=h,g=f;p<g;p++)Zv.fromBufferAttribute(d,p),aF(Zv,p,l,i,e,t,this)}}else console.error("THREE.Points.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}updateMorphTargets(){let e=this.geometry;if(e.isBufferGeometry){let t=e.morphAttributes,n=Object.keys(t);if(n.length>0){let i=t[n[0]];if(i!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let r=0,s=i.length;r<s;r++){let a=i[r].name||String(r);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=r}}}}else{let t=e.morphTargets;t!==void 0&&t.length>0&&console.error("THREE.Points.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}};Jv.prototype.isPoints=!0;function aF(o,e,t,n,i,r,s){let a=hS.distanceSqToPoint(o);if(a<t){let l=new ae;hS.closestPointToPoint(o,l),l.applyMatrix4(n);let c=i.ray.origin.distanceTo(l);if(c<i.near||c>i.far)return;r.push({distance:c,distanceToRay:Math.sqrt(a),point:l,index:e,face:null,object:s})}}var lF=class extends Hn{constructor(e,t,n,i,r,s,a,l,c){super(e,t,n,i,r,s,a,l,c);this.format=a!==void 0?a:Lo,this.minFilter=s!==void 0?s:Ai,this.magFilter=r!==void 0?r:Ai,this.generateMipmaps=!1;let u=this;function d(){u.needsUpdate=!0,e.requestVideoFrameCallback(d)}"requestVideoFrameCallback"in e&&e.requestVideoFrameCallback(d)}clone(){return new this.constructor(this.image).copy(this)}update(){let e=this.image;"requestVideoFrameCallback"in e===!1&&e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}};lF.prototype.isVideoTexture=!0;var cF=class extends Hn{constructor(e,t,n,i,r,s,a,l,c,u,d,h){super(null,s,a,l,c,u,i,r,d,h);this.image={width:t,height:n},this.mipmaps=e,this.flipY=!1,this.generateMipmaps=!1}};cF.prototype.isCompressedTexture=!0;var Md=class extends Hn{constructor(e,t,n,i,r,s,a,l,c){super(e,t,n,i,r,s,a,l,c);this.needsUpdate=!0}};Md.prototype.isCanvasTexture=!0;var uF=class extends Hn{constructor(e,t,n,i,r,s,a,l,c,u){if(u=u!==void 0?u:Yh,u!==Yh&&u!==qp)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");n===void 0&&u===Yh&&(n=dv),n===void 0&&u===qp&&(n=Xp);super(null,i,r,s,a,l,u,n,c);this.image={width:e,height:t},this.magFilter=a!==void 0?a:Qn,this.minFilter=l!==void 0?l:Qn,this.flipY=!1,this.generateMipmaps=!1}};uF.prototype.isDepthTexture=!0;var gae=new ae,yae=new ae,vae=new ae,xae=new wn;var w$={triangulate:function(o,e,t){t=t||2;let n=e&&e.length,i=n?e[0]*t:o.length,r=hF(o,0,i,t,!0),s=[];if(!r||r.next===r.prev)return s;let a,l,c,u,d,h,f;if(n&&(r=E$(o,e,r,t)),o.length>80*t){a=c=o[0],l=u=o[1];for(let p=t;p<i;p+=t)d=o[p],h=o[p+1],d<a&&(a=d),h<l&&(l=h),d>c&&(c=d),h>u&&(u=h);f=Math.max(c-a,u-l),f=f!==0?1/f:0}return fm(r,s,t,a,l,f),s}};function hF(o,e,t,n,i){let r,s;if(i===O$(o,e,t,n)>0)for(r=e;r<t;r+=n)s=pF(r,o[r],o[r+1],s);else for(r=t-n;r>=e;r-=n)s=pF(r,o[r],o[r+1],s);return s&&Kv(s,s.next)&&(mm(s),s=s.next),s}function el(o,e){if(!o)return o;e||(e=o);let t=o,n;do if(n=!1,!t.steiner&&(Kv(t,t.next)||sn(t.prev,t,t.next)===0)){if(mm(t),t=e=t.prev,t===t.next)break;n=!0}else t=t.next;while(n||t!==e);return e}function fm(o,e,t,n,i,r,s){if(!o)return;!s&&r&&P$(o,n,i,r);let a=o,l,c;for(;o.prev!==o.next;){if(l=o.prev,c=o.next,r?M$(o,n,i,r):b$(o)){e.push(l.i/t),e.push(o.i/t),e.push(c.i/t),mm(o),o=c.next,a=c.next;continue}if(o=c,o===a){s?s===1?(o=S$(el(o),e,t),fm(o,e,t,n,i,r,2)):s===2&&T$(o,e,t,n,i,r):fm(el(o),e,t,n,i,r,1);break}}}function b$(o){let e=o.prev,t=o,n=o.next;if(sn(e,t,n)>=0)return!1;let i=o.next.next;for(;i!==o.prev;){if(Sd(e.x,e.y,t.x,t.y,n.x,n.y,i.x,i.y)&&sn(i.prev,i,i.next)>=0)return!1;i=i.next}return!0}function M$(o,e,t,n){let i=o.prev,r=o,s=o.next;if(sn(i,r,s)>=0)return!1;let a=i.x<r.x?i.x<s.x?i.x:s.x:r.x<s.x?r.x:s.x,l=i.y<r.y?i.y<s.y?i.y:s.y:r.y<s.y?r.y:s.y,c=i.x>r.x?i.x>s.x?i.x:s.x:r.x>s.x?r.x:s.x,u=i.y>r.y?i.y>s.y?i.y:s.y:r.y>s.y?r.y:s.y,d=dS(a,l,e,t,n),h=dS(c,u,e,t,n),f=o.prevZ,p=o.nextZ;for(;f&&f.z>=d&&p&&p.z<=h;){if(f!==o.prev&&f!==o.next&&Sd(i.x,i.y,r.x,r.y,s.x,s.y,f.x,f.y)&&sn(f.prev,f,f.next)>=0||(f=f.prevZ,p!==o.prev&&p!==o.next&&Sd(i.x,i.y,r.x,r.y,s.x,s.y,p.x,p.y)&&sn(p.prev,p,p.next)>=0))return!1;p=p.nextZ}for(;f&&f.z>=d;){if(f!==o.prev&&f!==o.next&&Sd(i.x,i.y,r.x,r.y,s.x,s.y,f.x,f.y)&&sn(f.prev,f,f.next)>=0)return!1;f=f.prevZ}for(;p&&p.z<=h;){if(p!==o.prev&&p!==o.next&&Sd(i.x,i.y,r.x,r.y,s.x,s.y,p.x,p.y)&&sn(p.prev,p,p.next)>=0)return!1;p=p.nextZ}return!0}function S$(o,e,t){let n=o;do{let i=n.prev,r=n.next.next;!Kv(i,r)&&dF(i,n,n.next,r)&&pm(i,r)&&pm(r,i)&&(e.push(i.i/t),e.push(n.i/t),e.push(r.i/t),mm(n),mm(n.next),n=o=r),n=n.next}while(n!==o);return el(n)}function T$(o,e,t,n,i,r){let s=o;do{let a=s.next.next;for(;a!==s.prev;){if(s.i!==a.i&&F$(s,a)){let l=fF(s,a);s=el(s,s.next),l=el(l,l.next),fm(s,e,t,n,i,r),fm(l,e,t,n,i,r);return}a=a.next}s=s.next}while(s!==o)}function E$(o,e,t,n){let i=[],r,s,a,l,c;for(r=0,s=e.length;r<s;r++)a=e[r]*n,l=r<s-1?e[r+1]*n:o.length,c=hF(o,a,l,n,!1),c===c.next&&(c.steiner=!0),i.push(D$(c));for(i.sort(A$),r=0;r<i.length;r++)C$(i[r],t),t=el(t,t.next);return t}function A$(o,e){return o.x-e.x}function C$(o,e){if(e=L$(o,e),e){let t=fF(e,o);el(e,e.next),el(t,t.next)}}function L$(o,e){let t=e,n=o.x,i=o.y,r=-1/0,s;do{if(i<=t.y&&i>=t.next.y&&t.next.y!==t.y){let h=t.x+(i-t.y)*(t.next.x-t.x)/(t.next.y-t.y);if(h<=n&&h>r){if(r=h,h===n){if(i===t.y)return t;if(i===t.next.y)return t.next}s=t.x<t.next.x?t:t.next}}t=t.next}while(t!==e);if(!s)return null;if(n===r)return s;let a=s,l=s.x,c=s.y,u=1/0,d;t=s;do n>=t.x&&t.x>=l&&n!==t.x&&Sd(i<c?n:r,i,l,c,i<c?r:n,i,t.x,t.y)&&(d=Math.abs(i-t.y)/(n-t.x),pm(t,o)&&(d<u||d===u&&(t.x>s.x||t.x===s.x&&R$(s,t)))&&(s=t,u=d)),t=t.next;while(t!==a);return s}function R$(o,e){return sn(o.prev,o,e.prev)<0&&sn(e.next,o,o.next)<0}function P$(o,e,t,n){let i=o;do i.z===null&&(i.z=dS(i.x,i.y,e,t,n)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next;while(i!==o);i.prevZ.nextZ=null,i.prevZ=null,I$(i)}function I$(o){let e,t,n,i,r,s,a,l,c=1;do{for(t=o,o=null,r=null,s=0;t;){for(s++,n=t,a=0,e=0;e<c&&(a++,n=n.nextZ,!!n);e++);for(l=c;a>0||l>0&&n;)a!==0&&(l===0||!n||t.z<=n.z)?(i=t,t=t.nextZ,a--):(i=n,n=n.nextZ,l--),r?r.nextZ=i:o=i,i.prevZ=r,r=i;t=n}r.nextZ=null,c*=2}while(s>1);return o}function dS(o,e,t,n,i){return o=32767*(o-t)*i,e=32767*(e-n)*i,o=(o|o<<8)&16711935,o=(o|o<<4)&252645135,o=(o|o<<2)&858993459,o=(o|o<<1)&1431655765,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,o|e<<1}function D$(o){let e=o,t=o;do(e.x<t.x||e.x===t.x&&e.y<t.y)&&(t=e),e=e.next;while(e!==o);return t}function Sd(o,e,t,n,i,r,s,a){return(i-s)*(e-a)-(o-s)*(r-a)>=0&&(o-s)*(n-a)-(t-s)*(e-a)>=0&&(t-s)*(r-a)-(i-s)*(n-a)>=0}function F$(o,e){return o.next.i!==e.i&&o.prev.i!==e.i&&!B$(o,e)&&(pm(o,e)&&pm(e,o)&&N$(o,e)&&(sn(o.prev,o,e.prev)||sn(o,e.prev,e))||Kv(o,e)&&sn(o.prev,o,o.next)>0&&sn(e.prev,e,e.next)>0)}function sn(o,e,t){return(e.y-o.y)*(t.x-e.x)-(e.x-o.x)*(t.y-e.y)}function Kv(o,e){return o.x===e.x&&o.y===e.y}function dF(o,e,t,n){let i=Qv(sn(o,e,t)),r=Qv(sn(o,e,n)),s=Qv(sn(t,n,o)),a=Qv(sn(t,n,e));return!!(i!==r&&s!==a||i===0&&$v(o,t,e)||r===0&&$v(o,n,e)||s===0&&$v(t,o,n)||a===0&&$v(t,e,n))}function $v(o,e,t){return e.x<=Math.max(o.x,t.x)&&e.x>=Math.min(o.x,t.x)&&e.y<=Math.max(o.y,t.y)&&e.y>=Math.min(o.y,t.y)}function Qv(o){return o>0?1:o<0?-1:0}function B$(o,e){let t=o;do{if(t.i!==o.i&&t.next.i!==o.i&&t.i!==e.i&&t.next.i!==e.i&&dF(t,t.next,o,e))return!0;t=t.next}while(t!==o);return!1}function pm(o,e){return sn(o.prev,o,o.next)<0?sn(o,e,o.next)>=0&&sn(o,o.prev,e)>=0:sn(o,e,o.prev)<0||sn(o,o.next,e)<0}function N$(o,e){let t=o,n=!1,i=(o.x+e.x)/2,r=(o.y+e.y)/2;do t.y>r!=t.next.y>r&&t.next.y!==t.y&&i<(t.next.x-t.x)*(r-t.y)/(t.next.y-t.y)+t.x&&(n=!n),t=t.next;while(t!==o);return n}function fF(o,e){let t=new fS(o.i,o.x,o.y),n=new fS(e.i,e.x,e.y),i=o.next,r=e.prev;return o.next=e,e.prev=o,t.next=i,i.prev=t,n.next=t,t.prev=n,r.next=n,n.prev=r,n}function pF(o,e,t,n){let i=new fS(o,e,t);return n?(i.next=n.next,i.prev=n,n.next.prev=i,n.next=i):(i.prev=i,i.next=i),i}function mm(o){o.next.prev=o.prev,o.prev.next=o.next,o.prevZ&&(o.prevZ.nextZ=o.nextZ),o.nextZ&&(o.nextZ.prevZ=o.prevZ)}function fS(o,e,t){this.i=o,this.x=e,this.y=t,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function O$(o,e,t,n){let i=0;for(let r=e,s=t-n;r<t;r+=n)i+=(o[s]-o[r])*(o[r+1]+o[s+1]),s=r;return i}var zs=class{static area(e){let t=e.length,n=0;for(let i=t-1,r=0;r<t;i=r++)n+=e[i].x*e[r].y-e[r].x*e[i].y;return n*.5}static isClockWise(e){return zs.area(e)<0}static triangulateShape(e,t){let n=[],i=[],r=[];mF(e),gF(n,e);let s=e.length;t.forEach(mF);for(let l=0;l<t.length;l++)i.push(s),s+=t[l].length,gF(n,t[l]);let a=w$.triangulate(n,i);for(let l=0;l<a.length;l+=3)r.push(a.slice(l,l+3));return r}};function mF(o){let e=o.length;e>2&&o[e-1].equals(o[0])&&o.pop()}function gF(o,e){for(let t=0;t<e.length;t++)o.push(e[t].x),o.push(e[t].y)}var gm=class extends Et{constructor(e,t){super();this.type="ExtrudeGeometry",this.parameters={shapes:e,options:t},e=Array.isArray(e)?e:[e];let n=this,i=[],r=[];for(let a=0,l=e.length;a<l;a++){let c=e[a];s(c)}this.setAttribute("position",new fn(i,3)),this.setAttribute("uv",new fn(r,2)),this.computeVertexNormals();function s(a){let l=[],c=t.curveSegments!==void 0?t.curveSegments:12,u=t.steps!==void 0?t.steps:1,d=t.depth!==void 0?t.depth:100,h=t.bevelEnabled!==void 0?t.bevelEnabled:!0,f=t.bevelThickness!==void 0?t.bevelThickness:6,p=t.bevelSize!==void 0?t.bevelSize:f-2,g=t.bevelOffset!==void 0?t.bevelOffset:0,v=t.bevelSegments!==void 0?t.bevelSegments:3,y=t.extrudePath,m=t.UVGenerator!==void 0?t.UVGenerator:k$;t.amount!==void 0&&(console.warn("THREE.ExtrudeBufferGeometry: amount has been renamed to depth."),d=t.amount);let x,_=!1,w,b,M,S;y&&(x=y.getSpacedPoints(u),_=!0,h=!1,w=y.computeFrenetFrames(u,!1),b=new ae,M=new ae,S=new ae),h||(v=0,f=0,p=0,g=0);let E=a.extractPoints(c),A=E.shape,L=E.holes;if(!zs.isClockWise(A)){A=A.reverse();for(let X=0,$=L.length;X<$;X++){let J=L[X];zs.isClockWise(J)&&(L[X]=J.reverse())}}let R=zs.triangulateShape(A,L),D=A;for(let X=0,$=L.length;X<$;X++){let J=L[X];A=A.concat(J)}function P(X,$,J){return $||console.error("THREE.ExtrudeGeometry: vec does not exist"),$.clone().multiplyScalar(J).add(X)}let I=A.length,N=R.length;function G(X,$,J){let ce,H,T,C=X.x-$.x,W=X.y-$.y,Z=J.x-X.x,he=J.y-X.y,me=C*C+W*W,Ee=C*he-W*Z;if(Math.abs(Ee)>Number.EPSILON){let Se=Math.sqrt(me),oe=Math.sqrt(Z*Z+he*he),ge=$.x-W/Se,k=$.y+C/Se,de=J.x-he/oe,K=J.y+Z/oe,be=((de-ge)*he-(K-k)*Z)/(C*he-W*Z);ce=ge+C*be-X.x,H=k+W*be-X.y;let we=ce*ce+H*H;if(we<=2)return new Oe(ce,H);T=Math.sqrt(we/2)}else{let Se=!1;C>Number.EPSILON?Z>Number.EPSILON&&(Se=!0):C<-Number.EPSILON?Z<-Number.EPSILON&&(Se=!0):Math.sign(W)===Math.sign(he)&&(Se=!0),Se?(ce=-W,H=C,T=Math.sqrt(me)):(ce=C,H=W,T=Math.sqrt(me/2))}return new Oe(ce/T,H/T)}let z=[];for(let X=0,$=D.length,J=$-1,ce=X+1;X<$;X++,J++,ce++)J===$&&(J=0),ce===$&&(ce=0),z[X]=G(D[X],D[J],D[ce]);let se=[],ne,Q=z.concat();for(let X=0,$=L.length;X<$;X++){let J=L[X];ne=[];for(let ce=0,H=J.length,T=H-1,C=ce+1;ce<H;ce++,T++,C++)T===H&&(T=0),C===H&&(C=0),ne[ce]=G(J[ce],J[T],J[C]);se.push(ne),Q=Q.concat(ne)}for(let X=0;X<v;X++){let $=X/v,J=f*Math.cos($*Math.PI/2),ce=p*Math.sin($*Math.PI/2)+g;for(let H=0,T=D.length;H<T;H++){let C=P(D[H],z[H],ce);ie(C.x,C.y,-J)}for(let H=0,T=L.length;H<T;H++){let C=L[H];ne=se[H];for(let W=0,Z=C.length;W<Z;W++){let he=P(C[W],ne[W],ce);ie(he.x,he.y,-J)}}}let j=p+g;for(let X=0;X<I;X++){let $=h?P(A[X],Q[X],j):A[X];_?(M.copy(w.normals[0]).multiplyScalar($.x),b.copy(w.binormals[0]).multiplyScalar($.y),S.copy(x[0]).add(M).add(b),ie(S.x,S.y,S.z)):ie($.x,$.y,0)}for(let X=1;X<=u;X++)for(let $=0;$<I;$++){let J=h?P(A[$],Q[$],j):A[$];_?(M.copy(w.normals[X]).multiplyScalar(J.x),b.copy(w.binormals[X]).multiplyScalar(J.y),S.copy(x[X]).add(M).add(b),ie(S.x,S.y,S.z)):ie(J.x,J.y,d/u*X)}for(let X=v-1;X>=0;X--){let $=X/v,J=f*Math.cos($*Math.PI/2),ce=p*Math.sin($*Math.PI/2)+g;for(let H=0,T=D.length;H<T;H++){let C=P(D[H],z[H],ce);ie(C.x,C.y,d+J)}for(let H=0,T=L.length;H<T;H++){let C=L[H];ne=se[H];for(let W=0,Z=C.length;W<Z;W++){let he=P(C[W],ne[W],ce);_?ie(he.x,he.y+x[u-1].y,x[u-1].x+J):ie(he.x,he.y,d+J)}}}O(),ee();function O(){let X=i.length/3;if(h){let $=0,J=I*$;for(let ce=0;ce<N;ce++){let H=R[ce];ue(H[2]+J,H[1]+J,H[0]+J)}$=u+v*2,J=I*$;for(let ce=0;ce<N;ce++){let H=R[ce];ue(H[0]+J,H[1]+J,H[2]+J)}}else{for(let $=0;$<N;$++){let J=R[$];ue(J[2],J[1],J[0])}for(let $=0;$<N;$++){let J=R[$];ue(J[0]+I*u,J[1]+I*u,J[2]+I*u)}}n.addGroup(X,i.length/3-X,0)}function ee(){let X=i.length/3,$=0;V(D,$),$+=D.length;for(let J=0,ce=L.length;J<ce;J++){let H=L[J];V(H,$),$+=H.length}n.addGroup(X,i.length/3-X,1)}function V(X,$){let J=X.length;for(;--J>=0;){let ce=J,H=J-1;H<0&&(H=X.length-1);for(let T=0,C=u+v*2;T<C;T++){let W=I*T,Z=I*(T+1),he=$+ce+W,me=$+H+W,Ee=$+H+Z,Se=$+ce+Z;ye(he,me,Ee,Se)}}}function ie(X,$,J){l.push(X),l.push($),l.push(J)}function ue(X,$,J){pe(X),pe($),pe(J);let ce=i.length/3,H=m.generateTopUV(n,i,ce-3,ce-2,ce-1);xe(H[0]),xe(H[1]),xe(H[2])}function ye(X,$,J,ce){pe(X),pe($),pe(ce),pe($),pe(J),pe(ce);let H=i.length/3,T=m.generateSideWallUV(n,i,H-6,H-3,H-2,H-1);xe(T[0]),xe(T[1]),xe(T[3]),xe(T[1]),xe(T[2]),xe(T[3])}function pe(X){i.push(l[X*3+0]),i.push(l[X*3+1]),i.push(l[X*3+2])}function xe(X){r.push(X.x),r.push(X.y)}}}toJSON(){let e=Et.prototype.toJSON.call(this),t=this.parameters.shapes,n=this.parameters.options;return z$(t,n,e)}},k$={generateTopUV:function(o,e,t,n,i){let r=e[t*3],s=e[t*3+1],a=e[n*3],l=e[n*3+1],c=e[i*3],u=e[i*3+1];return[new Oe(r,s),new Oe(a,l),new Oe(c,u)]},generateSideWallUV:function(o,e,t,n,i,r){let s=e[t*3],a=e[t*3+1],l=e[t*3+2],c=e[n*3],u=e[n*3+1],d=e[n*3+2],h=e[i*3],f=e[i*3+1],p=e[i*3+2],g=e[r*3],v=e[r*3+1],y=e[r*3+2];return Math.abs(a-u)<.01?[new Oe(s,1-l),new Oe(c,1-d),new Oe(h,1-p),new Oe(g,1-y)]:[new Oe(a,1-l),new Oe(u,1-d),new Oe(f,1-p),new Oe(v,1-y)]}};function z$(o,e,t){if(t.shapes=[],Array.isArray(o))for(let n=0,i=o.length;n<i;n++){let r=o[n];t.shapes.push(r.uuid)}else t.shapes.push(o.uuid);return e.extrudePath!==void 0&&(t.options.extrudePath=e.extrudePath.toJSON()),t}var yF=class extends Et{constructor(e,t=12){super();this.type="ShapeGeometry",this.parameters={shapes:e,curveSegments:t};let n=[],i=[],r=[],s=[],a=0,l=0;if(Array.isArray(e)===!1)c(e);else for(let u=0;u<e.length;u++)c(e[u]),this.addGroup(a,l,u),a+=l,l=0;this.setIndex(n),this.setAttribute("position",new fn(i,3)),this.setAttribute("normal",new fn(r,3)),this.setAttribute("uv",new fn(s,2));function c(u){let d=i.length/3,h=u.extractPoints(t),f=h.shape,p=h.holes;zs.isClockWise(f)===!1&&(f=f.reverse());for(let v=0,y=p.length;v<y;v++){let m=p[v];zs.isClockWise(m)===!0&&(p[v]=m.reverse())}let g=zs.triangulateShape(f,p);for(let v=0,y=p.length;v<y;v++){let m=p[v];f=f.concat(m)}for(let v=0,y=f.length;v<y;v++){let m=f[v];i.push(m.x,m.y,0),r.push(0,0,1),s.push(m.x,m.y)}for(let v=0,y=g.length;v<y;v++){let m=g[v],x=m[0]+d,_=m[1]+d,w=m[2]+d;n.push(x,_,w),l+=3}}}toJSON(){let e=Et.prototype.toJSON.call(this),t=this.parameters.shapes;return U$(t,e)}};function U$(o,e){if(e.shapes=[],Array.isArray(o))for(let t=0,n=o.length;t<n;t++){let i=o[t];e.shapes.push(i.uuid)}else e.shapes.push(o.uuid);return e}var vF=class extends bn{constructor(e){super();this.type="ShadowMaterial",this.color=new qe(0),this.transparent=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this}};vF.prototype.isShadowMaterial=!0;var xF=class extends ss{constructor(e){super(e);this.type="RawShaderMaterial"}};xF.prototype.isRawShaderMaterial=!0;var xc=class extends bn{constructor(e){super();this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new qe(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new qe(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Ga,this.normalScale=new Oe(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.flatShading=!1,this.vertexTangents=!1,this.setValues(e)}copy(e){return super.copy(e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapIntensity=e.envMapIntensity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this.flatShading=e.flatShading,this.vertexTangents=e.vertexTangents,this}};xc.prototype.isMeshStandardMaterial=!0;var ym=class extends xc{constructor(e){super();this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.clearcoat=0,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new Oe(1,1),this.clearcoatNormalMap=null,this.reflectivity=.5,Object.defineProperty(this,"ior",{get:function(){return(1+.4*this.reflectivity)/(1-.4*this.reflectivity)},set:function(t){this.reflectivity=Ci(2.5*(t-1)/(t+1),0,1)}}),this.sheen=null,this.transmission=0,this.transmissionMap=null,this.setValues(e)}copy(e){return super.copy(e),this.defines={STANDARD:"",PHYSICAL:""},this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.reflectivity=e.reflectivity,e.sheen?this.sheen=(this.sheen||new qe).copy(e.sheen):this.sheen=null,this.transmission=e.transmission,this.transmissionMap=e.transmissionMap,this}};ym.prototype.isMeshPhysicalMaterial=!0;var _F=class extends bn{constructor(e){super();this.type="MeshPhongMaterial",this.color=new qe(16777215),this.specular=new qe(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new qe(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Ga,this.normalScale=new Oe(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=cv,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this.flatShading=e.flatShading,this}};_F.prototype.isMeshPhongMaterial=!0;var wF=class extends bn{constructor(e){super();this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new qe(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new qe(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Ga,this.normalScale=new Oe(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.gradientMap=e.gradientMap,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this}};wF.prototype.isMeshToonMaterial=!0;var bF=class extends bn{constructor(e){super();this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Ga,this.normalScale=new Oe(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this.flatShading=e.flatShading,this}};bF.prototype.isMeshNormalMaterial=!0;var MF=class extends bn{constructor(e){super();this.type="MeshLambertMaterial",this.color=new qe(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new qe(0),this.emissiveIntensity=1,this.emissiveMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=cv,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this}};MF.prototype.isMeshLambertMaterial=!0;var SF=class extends bn{constructor(e){super();this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new qe(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Ga,this.normalScale=new Oe(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.defines={MATCAP:""},this.color.copy(e.color),this.matcap=e.matcap,this.map=e.map,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this.flatShading=e.flatShading,this}};SF.prototype.isMeshMatcapMaterial=!0;var TF=class extends Qa{constructor(e){super();this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}copy(e){return super.copy(e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this}};TF.prototype.isLineDashedMaterial=!0;var $t={arraySlice:function(o,e,t){return $t.isTypedArray(o)?new o.constructor(o.subarray(e,t!==void 0?t:o.length)):o.slice(e,t)},convertArray:function(o,e,t){return!o||!t&&o.constructor===e?o:typeof e.BYTES_PER_ELEMENT=="number"?new e(o):Array.prototype.slice.call(o)},isTypedArray:function(o){return ArrayBuffer.isView(o)&&!(o instanceof DataView)},getKeyframeOrder:function(o){function e(i,r){return o[i]-o[r]}let t=o.length,n=new Array(t);for(let i=0;i!==t;++i)n[i]=i;return n.sort(e),n},sortedArray:function(o,e,t){let n=o.length,i=new o.constructor(n);for(let r=0,s=0;s!==n;++r){let a=t[r]*e;for(let l=0;l!==e;++l)i[s++]=o[a+l]}return i},flattenJSON:function(o,e,t,n){let i=1,r=o[0];for(;r!==void 0&&r[n]===void 0;)r=o[i++];if(r===void 0)return;let s=r[n];if(s!==void 0)if(Array.isArray(s))do s=r[n],s!==void 0&&(e.push(r.time),t.push.apply(t,s)),r=o[i++];while(r!==void 0);else if(s.toArray!==void 0)do s=r[n],s!==void 0&&(e.push(r.time),s.toArray(t,t.length)),r=o[i++];while(r!==void 0);else do s=r[n],s!==void 0&&(e.push(r.time),t.push(s)),r=o[i++];while(r!==void 0)},subclip:function(o,e,t,n,i=30){let r=o.clone();r.name=e;let s=[];for(let l=0;l<r.tracks.length;++l){let c=r.tracks[l],u=c.getValueSize(),d=[],h=[];for(let f=0;f<c.times.length;++f){let p=c.times[f]*i;if(!(p<t||p>=n)){d.push(c.times[f]);for(let g=0;g<u;++g)h.push(c.values[f*u+g])}}d.length!==0&&(c.times=$t.convertArray(d,c.times.constructor),c.values=$t.convertArray(h,c.values.constructor),s.push(c))}r.tracks=s;let a=1/0;for(let l=0;l<r.tracks.length;++l)a>r.tracks[l].times[0]&&(a=r.tracks[l].times[0]);for(let l=0;l<r.tracks.length;++l)r.tracks[l].shift(-1*a);return r.resetDuration(),r},makeClipAdditive:function(o,e=0,t=o,n=30){n<=0&&(n=30);let i=t.tracks.length,r=e/n;for(let s=0;s<i;++s){let a=t.tracks[s],l=a.ValueTypeName;if(l==="bool"||l==="string")continue;let c=o.tracks.find(function(y){return y.name===a.name&&y.ValueTypeName===l});if(c===void 0)continue;let u=0,d=a.getValueSize();a.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(u=d/3);let h=0,f=c.getValueSize();c.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(h=f/3);let p=a.times.length-1,g;if(r<=a.times[0]){let y=u,m=d-u;g=$t.arraySlice(a.values,y,m)}else if(r>=a.times[p]){let y=p*d+u,m=y+d-u;g=$t.arraySlice(a.values,y,m)}else{let y=a.createInterpolant(),m=u,x=d-u;y.evaluate(r),g=$t.arraySlice(y.resultBuffer,m,x)}l==="quaternion"&&new pi().fromArray(g).normalize().conjugate().toArray(g);let v=c.times.length;for(let y=0;y<v;++y){let m=y*f+h;if(l==="quaternion")pi.multiplyQuaternionsFlat(c.values,m,g,0,c.values,m);else{let x=f-h*2;for(let _=0;_<x;++_)c.values[m+_]-=g[_]}}}return o.blendMode=qI,o}},os=class{constructor(e,t,n,i){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=i!==void 0?i:new t.constructor(n),this.sampleValues=t,this.valueSize=n,this.settings=null,this.DefaultSettings_={}}evaluate(e){let t=this.parameterPositions,n=this._cachedIndex,i=t[n],r=t[n-1];e:{t:{let s;n:{i:if(!(e<i)){for(let a=n+2;;){if(i===void 0){if(e<r)break i;return n=t.length,this._cachedIndex=n,this.afterEnd_(n-1,e,r)}if(n===a)break;if(r=i,i=t[++n],e<i)break t}s=t.length;break n}if(!(e>=r)){let a=t[1];e<a&&(n=2,r=a);for(let l=n-2;;){if(r===void 0)return this._cachedIndex=0,this.beforeStart_(0,e,i);if(n===l)break;if(i=r,r=t[--n-1],e>=r)break t}s=n,n=0;break n}break e}for(;n<s;){let a=n+s>>>1;e<t[a]?s=a:n=a+1}if(i=t[n],r=t[n-1],r===void 0)return this._cachedIndex=0,this.beforeStart_(0,e,i);if(i===void 0)return n=t.length,this._cachedIndex=n,this.afterEnd_(n-1,r,e)}this._cachedIndex=n,this.intervalChanged_(n,r,i)}return this.interpolate_(n,r,e,i)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(e){let t=this.resultBuffer,n=this.sampleValues,i=this.valueSize,r=e*i;for(let s=0;s!==i;++s)t[s]=n[r+s];return t}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}};os.prototype.beforeStart_=os.prototype.copySampleValue_;os.prototype.afterEnd_=os.prototype.copySampleValue_;var EF=class extends os{constructor(e,t,n,i){super(e,t,n,i);this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:Jh,endingEnd:Jh}}intervalChanged_(e,t,n){let i=this.parameterPositions,r=e-2,s=e+1,a=i[r],l=i[s];if(a===void 0)switch(this.getSettings_().endingStart){case Kh:r=e,a=2*t-n;break;case mv:r=i.length-2,a=t+i[r]-i[r+1];break;default:r=e,a=n}if(l===void 0)switch(this.getSettings_().endingEnd){case Kh:s=e,l=2*n-t;break;case mv:s=1,l=n+i[1]-i[0];break;default:s=e-1,l=t}let c=(n-t)*.5,u=this.valueSize;this._weightPrev=c/(t-a),this._weightNext=c/(l-n),this._offsetPrev=r*u,this._offsetNext=s*u}interpolate_(e,t,n,i){let r=this.resultBuffer,s=this.sampleValues,a=this.valueSize,l=e*a,c=l-a,u=this._offsetPrev,d=this._offsetNext,h=this._weightPrev,f=this._weightNext,p=(n-t)/(i-t),g=p*p,v=g*p,y=-h*v+2*h*g-h*p,m=(1+h)*v+(-1.5-2*h)*g+(-.5+h)*p+1,x=(-1-f)*v+(1.5+f)*g+.5*p,_=f*v-f*g;for(let w=0;w!==a;++w)r[w]=y*s[u+w]+m*s[c+w]+x*s[l+w]+_*s[d+w];return r}},pS=class extends os{constructor(e,t,n,i){super(e,t,n,i)}interpolate_(e,t,n,i){let r=this.resultBuffer,s=this.sampleValues,a=this.valueSize,l=e*a,c=l-a,u=(n-t)/(i-t),d=1-u;for(let h=0;h!==a;++h)r[h]=s[c+h]*d+s[l+h]*u;return r}},AF=class extends os{constructor(e,t,n,i){super(e,t,n,i)}interpolate_(e){return this.copySampleValue_(e-1)}},as=class{constructor(e,t,n,i){if(e===void 0)throw new Error("THREE.KeyframeTrack: track name is undefined");if(t===void 0||t.length===0)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=$t.convertArray(t,this.TimeBufferType),this.values=$t.convertArray(n,this.ValueBufferType),this.setInterpolation(i||this.DefaultInterpolation)}static toJSON(e){let t=e.constructor,n;if(t.toJSON!==this.toJSON)n=t.toJSON(e);else{n={name:e.name,times:$t.convertArray(e.times,Array),values:$t.convertArray(e.values,Array)};let i=e.getInterpolation();i!==e.DefaultInterpolation&&(n.interpolation=i)}return n.type=e.ValueTypeName,n}InterpolantFactoryMethodDiscrete(e){return new AF(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodLinear(e){return new pS(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodSmooth(e){return new EF(this.times,this.values,this.getValueSize(),e)}setInterpolation(e){let t;switch(e){case Zh:t=this.InterpolantFactoryMethodDiscrete;break;case fc:t=this.InterpolantFactoryMethodLinear;break;case w1:t=this.InterpolantFactoryMethodSmooth;break}if(t===void 0){let n="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(this.createInterpolant===void 0)if(e!==this.DefaultInterpolation)this.setInterpolation(this.DefaultInterpolation);else throw new Error(n);return console.warn("THREE.KeyframeTrack:",n),this}return this.createInterpolant=t,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return Zh;case this.InterpolantFactoryMethodLinear:return fc;case this.InterpolantFactoryMethodSmooth:return w1}}getValueSize(){return this.values.length/this.times.length}shift(e){if(e!==0){let t=this.times;for(let n=0,i=t.length;n!==i;++n)t[n]+=e}return this}scale(e){if(e!==1){let t=this.times;for(let n=0,i=t.length;n!==i;++n)t[n]*=e}return this}trim(e,t){let n=this.times,i=n.length,r=0,s=i-1;for(;r!==i&&n[r]<e;)++r;for(;s!==-1&&n[s]>t;)--s;if(++s,r!==0||s!==i){r>=s&&(s=Math.max(s,1),r=s-1);let a=this.getValueSize();this.times=$t.arraySlice(n,r,s),this.values=$t.arraySlice(this.values,r*a,s*a)}return this}validate(){let e=!0,t=this.getValueSize();t-Math.floor(t)!=0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);let n=this.times,i=this.values,r=n.length;r===0&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);let s=null;for(let a=0;a!==r;a++){let l=n[a];if(typeof l=="number"&&isNaN(l)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,a,l),e=!1;break}if(s!==null&&s>l){console.error("THREE.KeyframeTrack: Out of order keys.",this,a,l,s),e=!1;break}s=l}if(i!==void 0&&$t.isTypedArray(i))for(let a=0,l=i.length;a!==l;++a){let c=i[a];if(isNaN(c)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,a,c),e=!1;break}}return e}optimize(){let e=$t.arraySlice(this.times),t=$t.arraySlice(this.values),n=this.getValueSize(),i=this.getInterpolation()===w1,r=e.length-1,s=1;for(let a=1;a<r;++a){let l=!1,c=e[a],u=e[a+1];if(c!==u&&(a!==1||c!==e[0]))if(i)l=!0;else{let d=a*n,h=d-n,f=d+n;for(let p=0;p!==n;++p){let g=t[d+p];if(g!==t[h+p]||g!==t[f+p]){l=!0;break}}}if(l){if(a!==s){e[s]=e[a];let d=a*n,h=s*n;for(let f=0;f!==n;++f)t[h+f]=t[d+f]}++s}}if(r>0){e[s]=e[r];for(let a=r*n,l=s*n,c=0;c!==n;++c)t[l+c]=t[a+c];++s}return s!==e.length?(this.times=$t.arraySlice(e,0,s),this.values=$t.arraySlice(t,0,s*n)):(this.times=e,this.values=t),this}clone(){let e=$t.arraySlice(this.times,0),t=$t.arraySlice(this.values,0),n=this.constructor,i=new n(this.name,e,t);return i.createInterpolant=this.createInterpolant,i}};as.prototype.TimeBufferType=Float32Array;as.prototype.ValueBufferType=Float32Array;as.prototype.DefaultInterpolation=fc;var _c=class extends as{};_c.prototype.ValueTypeName="bool";_c.prototype.ValueBufferType=Array;_c.prototype.DefaultInterpolation=Zh;_c.prototype.InterpolantFactoryMethodLinear=void 0;_c.prototype.InterpolantFactoryMethodSmooth=void 0;var mS=class extends as{};mS.prototype.ValueTypeName="color";var wc=class extends as{};wc.prototype.ValueTypeName="number";var CF=class extends os{constructor(e,t,n,i){super(e,t,n,i)}interpolate_(e,t,n,i){let r=this.resultBuffer,s=this.sampleValues,a=this.valueSize,l=(n-t)/(i-t),c=e*a;for(let u=c+a;c!==u;c+=4)pi.slerpFlat(r,0,s,c-a,s,c,l);return r}},tl=class extends as{InterpolantFactoryMethodLinear(e){return new CF(this.times,this.values,this.getValueSize(),e)}};tl.prototype.ValueTypeName="quaternion";tl.prototype.DefaultInterpolation=fc;tl.prototype.InterpolantFactoryMethodSmooth=void 0;var bc=class extends as{};bc.prototype.ValueTypeName="string";bc.prototype.ValueBufferType=Array;bc.prototype.DefaultInterpolation=Zh;bc.prototype.InterpolantFactoryMethodLinear=void 0;bc.prototype.InterpolantFactoryMethodSmooth=void 0;var Mc=class extends as{};Mc.prototype.ValueTypeName="vector";var vm=class{constructor(e,t=-1,n,i=b1){this.name=e,this.tracks=n,this.duration=t,this.blendMode=i,this.uuid=nr(),this.duration<0&&this.resetDuration()}static parse(e){let t=[],n=e.tracks,i=1/(e.fps||1);for(let s=0,a=n.length;s!==a;++s)t.push(G$(n[s]).scale(i));let r=new this(e.name,e.duration,t,e.blendMode);return r.uuid=e.uuid,r}static toJSON(e){let t=[],n=e.tracks,i={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid,blendMode:e.blendMode};for(let r=0,s=n.length;r!==s;++r)t.push(as.toJSON(n[r]));return i}static CreateFromMorphTargetSequence(e,t,n,i){let r=t.length,s=[];for(let a=0;a<r;a++){let l=[],c=[];l.push((a+r-1)%r,a,(a+1)%r),c.push(0,1,0);let u=$t.getKeyframeOrder(l);l=$t.sortedArray(l,1,u),c=$t.sortedArray(c,1,u),!i&&l[0]===0&&(l.push(r),c.push(c[0])),s.push(new wc(".morphTargetInfluences["+t[a].name+"]",l,c).scale(1/n))}return new this(e,-1,s)}static findByName(e,t){let n=e;if(!Array.isArray(e)){let i=e;n=i.geometry&&i.geometry.animations||i.animations}for(let i=0;i<n.length;i++)if(n[i].name===t)return n[i];return null}static CreateClipsFromMorphTargetSequences(e,t,n){let i={},r=/^([\w-]*?)([\d]+)$/;for(let a=0,l=e.length;a<l;a++){let c=e[a],u=c.name.match(r);if(u&&u.length>1){let d=u[1],h=i[d];h||(i[d]=h=[]),h.push(c)}}let s=[];for(let a in i)s.push(this.CreateFromMorphTargetSequence(a,i[a],t,n));return s}static parseAnimation(e,t){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;let n=function(d,h,f,p,g){if(f.length!==0){let v=[],y=[];$t.flattenJSON(f,v,y,p),v.length!==0&&g.push(new d(h,v,y))}},i=[],r=e.name||"default",s=e.fps||30,a=e.blendMode,l=e.length||-1,c=e.hierarchy||[];for(let d=0;d<c.length;d++){let h=c[d].keys;if(!(!h||h.length===0))if(h[0].morphTargets){let f={},p;for(p=0;p<h.length;p++)if(h[p].morphTargets)for(let g=0;g<h[p].morphTargets.length;g++)f[h[p].morphTargets[g]]=-1;for(let g in f){let v=[],y=[];for(let m=0;m!==h[p].morphTargets.length;++m){let x=h[p];v.push(x.time),y.push(x.morphTarget===g?1:0)}i.push(new wc(".morphTargetInfluence["+g+"]",v,y))}l=f.length*(s||1)}else{let f=".bones["+t[d].name+"]";n(Mc,f+".position",h,"pos",i),n(tl,f+".quaternion",h,"rot",i),n(Mc,f+".scale",h,"scl",i)}}return i.length===0?null:new this(r,l,i,a)}resetDuration(){let e=this.tracks,t=0;for(let n=0,i=e.length;n!==i;++n){let r=this.tracks[n];t=Math.max(t,r.times[r.times.length-1])}return this.duration=t,this}trim(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this}validate(){let e=!0;for(let t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e}optimize(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}clone(){let e=[];for(let t=0;t<this.tracks.length;t++)e.push(this.tracks[t].clone());return new this.constructor(this.name,this.duration,e,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}};function H$(o){switch(o.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return wc;case"vector":case"vector2":case"vector3":case"vector4":return Mc;case"color":return mS;case"quaternion":return tl;case"bool":case"boolean":return _c;case"string":return bc}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+o)}function G$(o){if(o.type===void 0)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");let e=H$(o.type);if(o.times===void 0){let t=[],n=[];$t.flattenJSON(o.keys,t,n,"value"),o.times=t,o.values=n}return e.parse!==void 0?e.parse(o):new e(o.name,o.times,o.values,o.interpolation)}var Td={enabled:!1,files:{},add:function(o,e){this.enabled!==!1&&(this.files[o]=e)},get:function(o){if(this.enabled!==!1)return this.files[o]},remove:function(o){delete this.files[o]},clear:function(){this.files={}}},LF=class{constructor(e,t,n){let i=this,r=!1,s=0,a=0,l,c=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=n,this.itemStart=function(u){a++,r===!1&&i.onStart!==void 0&&i.onStart(u,s,a),r=!0},this.itemEnd=function(u){s++,i.onProgress!==void 0&&i.onProgress(u,s,a),s===a&&(r=!1,i.onLoad!==void 0&&i.onLoad())},this.itemError=function(u){i.onError!==void 0&&i.onError(u)},this.resolveURL=function(u){return l?l(u):u},this.setURLModifier=function(u){return l=u,this},this.addHandler=function(u,d){return c.push(u,d),this},this.removeHandler=function(u){let d=c.indexOf(u);return d!==-1&&c.splice(d,2),this},this.getHandler=function(u){for(let d=0,h=c.length;d<h;d+=2){let f=c[d],p=c[d+1];if(f.global&&(f.lastIndex=0),f.test(u))return p}return null}}},V$=new LF,ls=class{constructor(e){this.manager=e!==void 0?e:V$,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,t){let n=this;return new Promise(function(i,r){n.load(e,i,t,r)})}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}},cs={},Sc=class extends ls{constructor(e){super(e)}load(e,t,n,i){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);let r=this,s=Td.get(e);if(s!==void 0)return r.manager.itemStart(e),setTimeout(function(){t&&t(s),r.manager.itemEnd(e)},0),s;if(cs[e]!==void 0){cs[e].push({onLoad:t,onProgress:n,onError:i});return}let a=/^data:(.*?)(;base64)?,(.*)$/,l=e.match(a),c;if(l){let u=l[1],d=!!l[2],h=l[3];h=decodeURIComponent(h),d&&(h=atob(h));try{let f,p=(this.responseType||"").toLowerCase();switch(p){case"arraybuffer":case"blob":let g=new Uint8Array(h.length);for(let y=0;y<h.length;y++)g[y]=h.charCodeAt(y);p==="blob"?f=new Blob([g.buffer],{type:u}):f=g.buffer;break;case"document":f=new DOMParser().parseFromString(h,u);break;case"json":f=JSON.parse(h);break;default:f=h;break}setTimeout(function(){t&&t(f),r.manager.itemEnd(e)},0)}catch(f){setTimeout(function(){i&&i(f),r.manager.itemError(e),r.manager.itemEnd(e)},0)}}else{cs[e]=[],cs[e].push({onLoad:t,onProgress:n,onError:i}),c=new XMLHttpRequest,c.open("GET",e,!0),c.addEventListener("load",function(u){let d=this.response,h=cs[e];if(delete cs[e],this.status===200||this.status===0){this.status===0&&console.warn("THREE.FileLoader: HTTP Status 0 received."),Td.add(e,d);for(let f=0,p=h.length;f<p;f++){let g=h[f];g.onLoad&&g.onLoad(d)}r.manager.itemEnd(e)}else{for(let f=0,p=h.length;f<p;f++){let g=h[f];g.onError&&g.onError(u)}r.manager.itemError(e),r.manager.itemEnd(e)}},!1),c.addEventListener("progress",function(u){let d=cs[e];for(let h=0,f=d.length;h<f;h++){let p=d[h];p.onProgress&&p.onProgress(u)}},!1),c.addEventListener("error",function(u){let d=cs[e];delete cs[e];for(let h=0,f=d.length;h<f;h++){let p=d[h];p.onError&&p.onError(u)}r.manager.itemError(e),r.manager.itemEnd(e)},!1),c.addEventListener("abort",function(u){let d=cs[e];delete cs[e];for(let h=0,f=d.length;h<f;h++){let p=d[h];p.onError&&p.onError(u)}r.manager.itemError(e),r.manager.itemEnd(e)},!1),this.responseType!==void 0&&(c.responseType=this.responseType),this.withCredentials!==void 0&&(c.withCredentials=this.withCredentials),c.overrideMimeType&&c.overrideMimeType(this.mimeType!==void 0?this.mimeType:"text/plain");for(let u in this.requestHeader)c.setRequestHeader(u,this.requestHeader[u]);c.send(null)}return r.manager.itemStart(e),c}setResponseType(e){return this.responseType=e,this}setMimeType(e){return this.mimeType=e,this}};var gS=class extends ls{constructor(e){super(e)}load(e,t,n,i){this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);let r=this,s=Td.get(e);if(s!==void 0)return r.manager.itemStart(e),setTimeout(function(){t&&t(s),r.manager.itemEnd(e)},0),s;let a=document.createElementNS("http://www.w3.org/1999/xhtml","img");function l(){a.removeEventListener("load",l,!1),a.removeEventListener("error",c,!1),Td.add(e,this),t&&t(this),r.manager.itemEnd(e)}function c(u){a.removeEventListener("load",l,!1),a.removeEventListener("error",c,!1),i&&i(u),r.manager.itemError(e),r.manager.itemEnd(e)}return a.addEventListener("load",l,!1),a.addEventListener("error",c,!1),e.substr(0,5)!=="data:"&&this.crossOrigin!==void 0&&(a.crossOrigin=this.crossOrigin),r.manager.itemStart(e),a.src=e,a}},RF=class extends ls{constructor(e){super(e)}load(e,t,n,i){let r=new tm,s=new gS(this.manager);s.setCrossOrigin(this.crossOrigin),s.setPath(this.path);let a=0;function l(c){s.load(e[c],function(u){r.images[c]=u,a++,a===6&&(r.needsUpdate=!0,t&&t(r))},void 0,i)}for(let c=0;c<e.length;++c)l(c);return r}};var nl=class extends ls{constructor(e){super(e)}load(e,t,n,i){let r=new Hn,s=new gS(this.manager);return s.setCrossOrigin(this.crossOrigin),s.setPath(this.path),s.load(e,function(a){r.image=a;let l=e.search(/\.jpe?g($|\?)/i)>0||e.search(/^data\:image\/jpeg/)===0;r.format=l?Lo:ts,r.needsUpdate=!0,t!==void 0&&t(r)},n,i),r}},sr=class{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(e,t){let n=this.getUtoTmapping(e);return this.getPoint(n,t)}getPoints(e=5){let t=[];for(let n=0;n<=e;n++)t.push(this.getPoint(n/e));return t}getSpacedPoints(e=5){let t=[];for(let n=0;n<=e;n++)t.push(this.getPointAt(n/e));return t}getLength(){let e=this.getLengths();return e[e.length-1]}getLengths(e=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;let t=[],n,i=this.getPoint(0),r=0;t.push(0);for(let s=1;s<=e;s++)n=this.getPoint(s/e),r+=n.distanceTo(i),t.push(r),i=n;return this.cacheArcLengths=t,t}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(e,t){let n=this.getLengths(),i=0,r=n.length,s;t?s=t:s=e*n[r-1];let a=0,l=r-1,c;for(;a<=l;)if(i=Math.floor(a+(l-a)/2),c=n[i]-s,c<0)a=i+1;else if(c>0)l=i-1;else{l=i;break}if(i=l,n[i]===s)return i/(r-1);let u=n[i],h=n[i+1]-u,f=(s-u)/h;return(i+f)/(r-1)}getTangent(e,t){let n=1e-4,i=e-n,r=e+n;i<0&&(i=0),r>1&&(r=1);let s=this.getPoint(i),a=this.getPoint(r),l=t||(s.isVector2?new Oe:new ae);return l.copy(a).sub(s).normalize(),l}getTangentAt(e,t){let n=this.getUtoTmapping(e);return this.getTangent(n,t)}computeFrenetFrames(e,t){let n=new ae,i=[],r=[],s=[],a=new ae,l=new Ze;for(let f=0;f<=e;f++){let p=f/e;i[f]=this.getTangentAt(p,new ae),i[f].normalize()}r[0]=new ae,s[0]=new ae;let c=Number.MAX_VALUE,u=Math.abs(i[0].x),d=Math.abs(i[0].y),h=Math.abs(i[0].z);u<=c&&(c=u,n.set(1,0,0)),d<=c&&(c=d,n.set(0,1,0)),h<=c&&n.set(0,0,1),a.crossVectors(i[0],n).normalize(),r[0].crossVectors(i[0],a),s[0].crossVectors(i[0],r[0]);for(let f=1;f<=e;f++){if(r[f]=r[f-1].clone(),s[f]=s[f-1].clone(),a.crossVectors(i[f-1],i[f]),a.length()>Number.EPSILON){a.normalize();let p=Math.acos(Ci(i[f-1].dot(i[f]),-1,1));r[f].applyMatrix4(l.makeRotationAxis(a,p))}s[f].crossVectors(i[f],r[f])}if(t===!0){let f=Math.acos(Ci(r[0].dot(r[e]),-1,1));f/=e,i[0].dot(a.crossVectors(r[0],r[e]))>0&&(f=-f);for(let p=1;p<=e;p++)r[p].applyMatrix4(l.makeRotationAxis(i[p],f*p)),s[p].crossVectors(i[p],r[p])}return{tangents:i,normals:r,binormals:s}}clone(){return new this.constructor().copy(this)}copy(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}toJSON(){let e={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e}fromJSON(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}},xm=class extends sr{constructor(e=0,t=0,n=1,i=1,r=0,s=Math.PI*2,a=!1,l=0){super();this.type="EllipseCurve",this.aX=e,this.aY=t,this.xRadius=n,this.yRadius=i,this.aStartAngle=r,this.aEndAngle=s,this.aClockwise=a,this.aRotation=l}getPoint(e,t){let n=t||new Oe,i=Math.PI*2,r=this.aEndAngle-this.aStartAngle,s=Math.abs(r)<Number.EPSILON;for(;r<0;)r+=i;for(;r>i;)r-=i;r<Number.EPSILON&&(s?r=0:r=i),this.aClockwise===!0&&!s&&(r===i?r=-i:r=r-i);let a=this.aStartAngle+e*r,l=this.aX+this.xRadius*Math.cos(a),c=this.aY+this.yRadius*Math.sin(a);if(this.aRotation!==0){let u=Math.cos(this.aRotation),d=Math.sin(this.aRotation),h=l-this.aX,f=c-this.aY;l=h*u-f*d+this.aX,c=h*d+f*u+this.aY}return n.set(l,c)}copy(e){return super.copy(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}toJSON(){let e=super.toJSON();return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e}fromJSON(e){return super.fromJSON(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}};xm.prototype.isEllipseCurve=!0;var yS=class extends xm{constructor(e,t,n,i,r,s){super(e,t,n,n,i,r,s);this.type="ArcCurve"}};yS.prototype.isArcCurve=!0;function vS(){let o=0,e=0,t=0,n=0;function i(r,s,a,l){o=r,e=a,t=-3*r+3*s-2*a-l,n=2*r-2*s+a+l}return{initCatmullRom:function(r,s,a,l,c){i(s,a,c*(a-r),c*(l-s))},initNonuniformCatmullRom:function(r,s,a,l,c,u,d){let h=(s-r)/c-(a-r)/(c+u)+(a-s)/u,f=(a-s)/u-(l-s)/(u+d)+(l-a)/d;h*=u,f*=u,i(s,a,h,f)},calc:function(r){let s=r*r,a=s*r;return o+e*r+t*s+n*a}}}var ex=new ae,xS=new vS,_S=new vS,wS=new vS,bS=class extends sr{constructor(e=[],t=!1,n="centripetal",i=.5){super();this.type="CatmullRomCurve3",this.points=e,this.closed=t,this.curveType=n,this.tension=i}getPoint(e,t=new ae){let n=t,i=this.points,r=i.length,s=(r-(this.closed?0:1))*e,a=Math.floor(s),l=s-a;this.closed?a+=a>0?0:(Math.floor(Math.abs(a)/r)+1)*r:l===0&&a===r-1&&(a=r-2,l=1);let c,u;this.closed||a>0?c=i[(a-1)%r]:(ex.subVectors(i[0],i[1]).add(i[0]),c=ex);let d=i[a%r],h=i[(a+1)%r];if(this.closed||a+2<r?u=i[(a+2)%r]:(ex.subVectors(i[r-1],i[r-2]).add(i[r-1]),u=ex),this.curveType==="centripetal"||this.curveType==="chordal"){let f=this.curveType==="chordal"?.5:.25,p=Math.pow(c.distanceToSquared(d),f),g=Math.pow(d.distanceToSquared(h),f),v=Math.pow(h.distanceToSquared(u),f);g<1e-4&&(g=1),p<1e-4&&(p=g),v<1e-4&&(v=g),xS.initNonuniformCatmullRom(c.x,d.x,h.x,u.x,p,g,v),_S.initNonuniformCatmullRom(c.y,d.y,h.y,u.y,p,g,v),wS.initNonuniformCatmullRom(c.z,d.z,h.z,u.z,p,g,v)}else this.curveType==="catmullrom"&&(xS.initCatmullRom(c.x,d.x,h.x,u.x,this.tension),_S.initCatmullRom(c.y,d.y,h.y,u.y,this.tension),wS.initCatmullRom(c.z,d.z,h.z,u.z,this.tension));return n.set(xS.calc(l),_S.calc(l),wS.calc(l)),n}copy(e){super.copy(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){let i=e.points[t];this.points.push(i.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}toJSON(){let e=super.toJSON();e.points=[];for(let t=0,n=this.points.length;t<n;t++){let i=this.points[t];e.points.push(i.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){let i=e.points[t];this.points.push(new ae().fromArray(i))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}};bS.prototype.isCatmullRomCurve3=!0;function PF(o,e,t,n,i){let r=(n-e)*.5,s=(i-t)*.5,a=o*o,l=o*a;return(2*t-2*n+r+s)*l+(-3*t+3*n-2*r-s)*a+r*o+t}function W$(o,e){let t=1-o;return t*t*e}function X$(o,e){return 2*(1-o)*o*e}function q$(o,e){return o*o*e}function _m(o,e,t,n){return W$(o,e)+X$(o,t)+q$(o,n)}function j$(o,e){let t=1-o;return t*t*t*e}function Y$(o,e){let t=1-o;return 3*t*t*o*e}function Z$(o,e){return 3*(1-o)*o*o*e}function J$(o,e){return o*o*o*e}function wm(o,e,t,n,i){return j$(o,e)+Y$(o,t)+Z$(o,n)+J$(o,i)}var tx=class extends sr{constructor(e=new Oe,t=new Oe,n=new Oe,i=new Oe){super();this.type="CubicBezierCurve",this.v0=e,this.v1=t,this.v2=n,this.v3=i}getPoint(e,t=new Oe){let n=t,i=this.v0,r=this.v1,s=this.v2,a=this.v3;return n.set(wm(e,i.x,r.x,s.x,a.x),wm(e,i.y,r.y,s.y,a.y)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){let e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}};tx.prototype.isCubicBezierCurve=!0;var MS=class extends sr{constructor(e=new ae,t=new ae,n=new ae,i=new ae){super();this.type="CubicBezierCurve3",this.v0=e,this.v1=t,this.v2=n,this.v3=i}getPoint(e,t=new ae){let n=t,i=this.v0,r=this.v1,s=this.v2,a=this.v3;return n.set(wm(e,i.x,r.x,s.x,a.x),wm(e,i.y,r.y,s.y,a.y),wm(e,i.z,r.z,s.z,a.z)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){let e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}};MS.prototype.isCubicBezierCurve3=!0;var bm=class extends sr{constructor(e=new Oe,t=new Oe){super();this.type="LineCurve",this.v1=e,this.v2=t}getPoint(e,t=new Oe){let n=t;return e===1?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(e).add(this.v1)),n}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e,t){let n=t||new Oe;return n.copy(this.v2).sub(this.v1).normalize(),n}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){let e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}};bm.prototype.isLineCurve=!0;var IF=class extends sr{constructor(e=new ae,t=new ae){super();this.type="LineCurve3",this.isLineCurve3=!0,this.v1=e,this.v2=t}getPoint(e,t=new ae){let n=t;return e===1?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(e).add(this.v1)),n}getPointAt(e,t){return this.getPoint(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){let e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}},nx=class extends sr{constructor(e=new Oe,t=new Oe,n=new Oe){super();this.type="QuadraticBezierCurve",this.v0=e,this.v1=t,this.v2=n}getPoint(e,t=new Oe){let n=t,i=this.v0,r=this.v1,s=this.v2;return n.set(_m(e,i.x,r.x,s.x),_m(e,i.y,r.y,s.y)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){let e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}};nx.prototype.isQuadraticBezierCurve=!0;var SS=class extends sr{constructor(e=new ae,t=new ae,n=new ae){super();this.type="QuadraticBezierCurve3",this.v0=e,this.v1=t,this.v2=n}getPoint(e,t=new ae){let n=t,i=this.v0,r=this.v1,s=this.v2;return n.set(_m(e,i.x,r.x,s.x),_m(e,i.y,r.y,s.y),_m(e,i.z,r.z,s.z)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){let e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}};SS.prototype.isQuadraticBezierCurve3=!0;var ix=class extends sr{constructor(e=[]){super();this.type="SplineCurve",this.points=e}getPoint(e,t=new Oe){let n=t,i=this.points,r=(i.length-1)*e,s=Math.floor(r),a=r-s,l=i[s===0?s:s-1],c=i[s],u=i[s>i.length-2?i.length-1:s+1],d=i[s>i.length-3?i.length-1:s+2];return n.set(PF(a,l.x,c.x,u.x,d.x),PF(a,l.y,c.y,u.y,d.y)),n}copy(e){super.copy(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){let i=e.points[t];this.points.push(i.clone())}return this}toJSON(){let e=super.toJSON();e.points=[];for(let t=0,n=this.points.length;t<n;t++){let i=this.points[t];e.points.push(i.toArray())}return e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){let i=e.points[t];this.points.push(new Oe().fromArray(i))}return this}};ix.prototype.isSplineCurve=!0;var K$=Object.freeze({__proto__:null,ArcCurve:yS,CatmullRomCurve3:bS,CubicBezierCurve:tx,CubicBezierCurve3:MS,EllipseCurve:xm,LineCurve:bm,LineCurve3:IF,QuadraticBezierCurve:nx,QuadraticBezierCurve3:SS,SplineCurve:ix}),DF=class extends sr{constructor(){super();this.type="CurvePath",this.curves=[],this.autoClose=!1}add(e){this.curves.push(e)}closePath(){let e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);e.equals(t)||this.curves.push(new bm(t,e))}getPoint(e){let t=e*this.getLength(),n=this.getCurveLengths(),i=0;for(;i<n.length;){if(n[i]>=t){let r=n[i]-t,s=this.curves[i],a=s.getLength(),l=a===0?0:1-r/a;return s.getPointAt(l)}i++}return null}getLength(){let e=this.getCurveLengths();return e[e.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;let e=[],t=0;for(let n=0,i=this.curves.length;n<i;n++)t+=this.curves[n].getLength(),e.push(t);return this.cacheLengths=e,e}getSpacedPoints(e=40){let t=[];for(let n=0;n<=e;n++)t.push(this.getPoint(n/e));return this.autoClose&&t.push(t[0]),t}getPoints(e=12){let t=[],n;for(let i=0,r=this.curves;i<r.length;i++){let s=r[i],a=s&&s.isEllipseCurve?e*2:s&&(s.isLineCurve||s.isLineCurve3)?1:s&&s.isSplineCurve?e*s.points.length:e,l=s.getPoints(a);for(let c=0;c<l.length;c++){let u=l[c];n&&n.equals(u)||(t.push(u),n=u)}}return this.autoClose&&t.length>1&&!t[t.length-1].equals(t[0])&&t.push(t[0]),t}copy(e){super.copy(e),this.curves=[];for(let t=0,n=e.curves.length;t<n;t++){let i=e.curves[t];this.curves.push(i.clone())}return this.autoClose=e.autoClose,this}toJSON(){let e=super.toJSON();e.autoClose=this.autoClose,e.curves=[];for(let t=0,n=this.curves.length;t<n;t++){let i=this.curves[t];e.curves.push(i.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.autoClose=e.autoClose,this.curves=[];for(let t=0,n=e.curves.length;t<n;t++){let i=e.curves[t];this.curves.push(new K$[i.type]().fromJSON(i))}return this}},Mm=class extends DF{constructor(e){super();this.type="Path",this.currentPoint=new Oe,e&&this.setFromPoints(e)}setFromPoints(e){this.moveTo(e[0].x,e[0].y);for(let t=1,n=e.length;t<n;t++)this.lineTo(e[t].x,e[t].y);return this}moveTo(e,t){return this.currentPoint.set(e,t),this}lineTo(e,t){let n=new bm(this.currentPoint.clone(),new Oe(e,t));return this.curves.push(n),this.currentPoint.set(e,t),this}quadraticCurveTo(e,t,n,i){let r=new nx(this.currentPoint.clone(),new Oe(e,t),new Oe(n,i));return this.curves.push(r),this.currentPoint.set(n,i),this}bezierCurveTo(e,t,n,i,r,s){let a=new tx(this.currentPoint.clone(),new Oe(e,t),new Oe(n,i),new Oe(r,s));return this.curves.push(a),this.currentPoint.set(r,s),this}splineThru(e){let t=[this.currentPoint.clone()].concat(e),n=new ix(t);return this.curves.push(n),this.currentPoint.copy(e[e.length-1]),this}arc(e,t,n,i,r,s){let a=this.currentPoint.x,l=this.currentPoint.y;return this.absarc(e+a,t+l,n,i,r,s),this}absarc(e,t,n,i,r,s){return this.absellipse(e,t,n,n,i,r,s),this}ellipse(e,t,n,i,r,s,a,l){let c=this.currentPoint.x,u=this.currentPoint.y;return this.absellipse(e+c,t+u,n,i,r,s,a,l),this}absellipse(e,t,n,i,r,s,a,l){let c=new xm(e,t,n,i,r,s,a,l);if(this.curves.length>0){let d=c.getPoint(0);d.equals(this.currentPoint)||this.lineTo(d.x,d.y)}this.curves.push(c);let u=c.getPoint(1);return this.currentPoint.copy(u),this}copy(e){return super.copy(e),this.currentPoint.copy(e.currentPoint),this}toJSON(){let e=super.toJSON();return e.currentPoint=this.currentPoint.toArray(),e}fromJSON(e){return super.fromJSON(e),this.currentPoint.fromArray(e.currentPoint),this}},Tc=class extends Mm{constructor(e){super(e);this.uuid=nr(),this.type="Shape",this.holes=[]}getPointsHoles(e){let t=[];for(let n=0,i=this.holes.length;n<i;n++)t[n]=this.holes[n].getPoints(e);return t}extractPoints(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}}copy(e){super.copy(e),this.holes=[];for(let t=0,n=e.holes.length;t<n;t++){let i=e.holes[t];this.holes.push(i.clone())}return this}toJSON(){let e=super.toJSON();e.uuid=this.uuid,e.holes=[];for(let t=0,n=this.holes.length;t<n;t++){let i=this.holes[t];e.holes.push(i.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.uuid=e.uuid,this.holes=[];for(let t=0,n=e.holes.length;t<n;t++){let i=e.holes[t];this.holes.push(new Mm().fromJSON(i))}return this}},us=class extends ot{constructor(e,t=1){super();this.type="Light",this.color=new qe(e),this.intensity=t}dispose(){}copy(e){return super.copy(e),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){let t=super.toJSON(e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,this.groundColor!==void 0&&(t.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(t.object.distance=this.distance),this.angle!==void 0&&(t.object.angle=this.angle),this.decay!==void 0&&(t.object.decay=this.decay),this.penumbra!==void 0&&(t.object.penumbra=this.penumbra),this.shadow!==void 0&&(t.object.shadow=this.shadow.toJSON()),t}};us.prototype.isLight=!0;var FF=class extends us{constructor(e,t,n){super(e,n);this.type="HemisphereLight",this.position.copy(ot.DefaultUp),this.updateMatrix(),this.groundColor=new qe(t)}copy(e){return us.prototype.copy.call(this,e),this.groundColor.copy(e.groundColor),this}};FF.prototype.isHemisphereLight=!0;var BF=new Ze,NF=new ae,OF=new ae,rx=class{constructor(e){this.camera=e,this.bias=0,this.normalBias=0,this.radius=1,this.mapSize=new Oe(512,512),this.map=null,this.mapPass=null,this.matrix=new Ze,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new nm,this._frameExtents=new Oe(1,1),this._viewportCount=1,this._viewports=[new Dt(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){let t=this.camera,n=this.matrix;NF.setFromMatrixPosition(e.matrixWorld),t.position.copy(NF),OF.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(OF),t.updateMatrixWorld(),BF.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(BF),n.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),n.multiply(t.projectionMatrix),n.multiply(t.matrixWorldInverse)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){let e={};return this.bias!==0&&(e.bias=this.bias),this.normalBias!==0&&(e.normalBias=this.normalBias),this.radius!==1&&(e.radius=this.radius),(this.mapSize.x!==512||this.mapSize.y!==512)&&(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}},TS=class extends rx{constructor(){super(new yi(50,1,.5,500));this.focus=1}updateMatrices(e){let t=this.camera,n=Zp*2*e.angle*this.focus,i=this.mapSize.width/this.mapSize.height,r=e.distance||t.far;(n!==t.fov||i!==t.aspect||r!==t.far)&&(t.fov=n,t.aspect=i,t.far=r,t.updateProjectionMatrix()),super.updateMatrices(e)}copy(e){return super.copy(e),this.focus=e.focus,this}};TS.prototype.isSpotLightShadow=!0;var sx=class extends us{constructor(e,t,n=0,i=Math.PI/3,r=0,s=1){super(e,t);this.type="SpotLight",this.position.copy(ot.DefaultUp),this.updateMatrix(),this.target=new ot,this.distance=n,this.angle=i,this.penumbra=r,this.decay=s,this.shadow=new TS}get power(){return this.intensity*Math.PI}set power(e){this.intensity=e/Math.PI}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}};sx.prototype.isSpotLight=!0;var kF=new Ze,Sm=new ae,ES=new ae,AS=class extends rx{constructor(){super(new yi(90,1,.5,500));this._frameExtents=new Oe(4,2),this._viewportCount=6,this._viewports=[new Dt(2,1,1,1),new Dt(0,1,1,1),new Dt(3,1,1,1),new Dt(1,1,1,1),new Dt(3,0,1,1),new Dt(1,0,1,1)],this._cubeDirections=[new ae(1,0,0),new ae(-1,0,0),new ae(0,0,1),new ae(0,0,-1),new ae(0,1,0),new ae(0,-1,0)],this._cubeUps=[new ae(0,1,0),new ae(0,1,0),new ae(0,1,0),new ae(0,1,0),new ae(0,0,1),new ae(0,0,-1)]}updateMatrices(e,t=0){let n=this.camera,i=this.matrix,r=e.distance||n.far;r!==n.far&&(n.far=r,n.updateProjectionMatrix()),Sm.setFromMatrixPosition(e.matrixWorld),n.position.copy(Sm),ES.copy(n.position),ES.add(this._cubeDirections[t]),n.up.copy(this._cubeUps[t]),n.lookAt(ES),n.updateMatrixWorld(),i.makeTranslation(-Sm.x,-Sm.y,-Sm.z),kF.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),this._frustum.setFromProjectionMatrix(kF)}};AS.prototype.isPointLightShadow=!0;var ox=class extends us{constructor(e,t,n=0,i=1){super(e,t);this.type="PointLight",this.distance=n,this.decay=i,this.shadow=new AS}get power(){return this.intensity*4*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}};ox.prototype.isPointLight=!0;var Tm=class extends Nv{constructor(e=-1,t=1,n=1,i=-1,r=.1,s=2e3){super();this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=n,this.bottom=i,this.near=r,this.far=s,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=e.view===null?null:Object.assign({},e.view),this}setViewOffset(e,t,n,i,r,s){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=i,this.view.width=r,this.view.height=s,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){let e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,i=(this.top+this.bottom)/2,r=n-e,s=n+e,a=i+t,l=i-t;if(this.view!==null&&this.view.enabled){let c=(this.right-this.left)/this.view.fullWidth/this.zoom,u=(this.top-this.bottom)/this.view.fullHeight/this.zoom;r+=c*this.view.offsetX,s=r+c*this.view.width,a-=u*this.view.offsetY,l=a-u*this.view.height}this.projectionMatrix.makeOrthographic(r,s,a,l,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){let t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,this.view!==null&&(t.object.view=Object.assign({},this.view)),t}};Tm.prototype.isOrthographicCamera=!0;var CS=class extends rx{constructor(){super(new Tm(-5,5,5,-5,.5,500))}};CS.prototype.isDirectionalLightShadow=!0;var ax=class extends us{constructor(e,t){super(e,t);this.type="DirectionalLight",this.position.copy(ot.DefaultUp),this.updateMatrix(),this.target=new ot,this.shadow=new CS}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}};ax.prototype.isDirectionalLight=!0;var zF=class extends us{constructor(e,t){super(e,t);this.type="AmbientLight"}};zF.prototype.isAmbientLight=!0;var UF=class extends us{constructor(e,t,n=10,i=10){super(e,t);this.type="RectAreaLight",this.width=n,this.height=i}copy(e){return super.copy(e),this.width=e.width,this.height=e.height,this}toJSON(e){let t=super.toJSON(e);return t.object.width=this.width,t.object.height=this.height,t}};UF.prototype.isRectAreaLight=!0;var LS=class{constructor(){this.coefficients=[];for(let e=0;e<9;e++)this.coefficients.push(new ae)}set(e){for(let t=0;t<9;t++)this.coefficients[t].copy(e[t]);return this}zero(){for(let e=0;e<9;e++)this.coefficients[e].set(0,0,0);return this}getAt(e,t){let n=e.x,i=e.y,r=e.z,s=this.coefficients;return t.copy(s[0]).multiplyScalar(.282095),t.addScaledVector(s[1],.488603*i),t.addScaledVector(s[2],.488603*r),t.addScaledVector(s[3],.488603*n),t.addScaledVector(s[4],1.092548*(n*i)),t.addScaledVector(s[5],1.092548*(i*r)),t.addScaledVector(s[6],.315392*(3*r*r-1)),t.addScaledVector(s[7],1.092548*(n*r)),t.addScaledVector(s[8],.546274*(n*n-i*i)),t}getIrradianceAt(e,t){let n=e.x,i=e.y,r=e.z,s=this.coefficients;return t.copy(s[0]).multiplyScalar(.886227),t.addScaledVector(s[1],2*.511664*i),t.addScaledVector(s[2],2*.511664*r),t.addScaledVector(s[3],2*.511664*n),t.addScaledVector(s[4],2*.429043*n*i),t.addScaledVector(s[5],2*.429043*i*r),t.addScaledVector(s[6],.743125*r*r-.247708),t.addScaledVector(s[7],2*.429043*n*r),t.addScaledVector(s[8],.429043*(n*n-i*i)),t}add(e){for(let t=0;t<9;t++)this.coefficients[t].add(e.coefficients[t]);return this}addScaledSH(e,t){for(let n=0;n<9;n++)this.coefficients[n].addScaledVector(e.coefficients[n],t);return this}scale(e){for(let t=0;t<9;t++)this.coefficients[t].multiplyScalar(e);return this}lerp(e,t){for(let n=0;n<9;n++)this.coefficients[n].lerp(e.coefficients[n],t);return this}equals(e){for(let t=0;t<9;t++)if(!this.coefficients[t].equals(e.coefficients[t]))return!1;return!0}copy(e){return this.set(e.coefficients)}clone(){return new this.constructor().copy(this)}fromArray(e,t=0){let n=this.coefficients;for(let i=0;i<9;i++)n[i].fromArray(e,t+i*3);return this}toArray(e=[],t=0){let n=this.coefficients;for(let i=0;i<9;i++)n[i].toArray(e,t+i*3);return e}static getBasisAt(e,t){let n=e.x,i=e.y,r=e.z;t[0]=.282095,t[1]=.488603*i,t[2]=.488603*r,t[3]=.488603*n,t[4]=1.092548*n*i,t[5]=1.092548*i*r,t[6]=.315392*(3*r*r-1),t[7]=1.092548*n*r,t[8]=.546274*(n*n-i*i)}};LS.prototype.isSphericalHarmonics3=!0;var lx=class extends us{constructor(e=new LS,t=1){super(void 0,t);this.sh=e}copy(e){return super.copy(e),this.sh.copy(e.sh),this}fromJSON(e){return this.intensity=e.intensity,this.sh.fromArray(e.sh),this}toJSON(e){let t=super.toJSON(e);return t.object.sh=this.sh.toArray(),t}};lx.prototype.isLightProbe=!0;var il=class{static decodeText(e){if(typeof TextDecoder!="undefined")return new TextDecoder().decode(e);let t="";for(let n=0,i=e.length;n<i;n++)t+=String.fromCharCode(e[n]);try{return decodeURIComponent(escape(t))}catch(n){return t}}static extractUrlBase(e){let t=e.lastIndexOf("/");return t===-1?"./":e.substr(0,t+1)}},HF=class extends Et{constructor(){super();this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(e){return super.copy(e),this.instanceCount=e.instanceCount,this}clone(){return new this.constructor().copy(this)}toJSON(){let e=super.toJSON(this);return e.instanceCount=this.instanceCount,e.isInstancedBufferGeometry=!0,e}};HF.prototype.isInstancedBufferGeometry=!0;var GF=class extends jt{constructor(e,t,n,i){typeof n=="number"&&(i=n,n=!1,console.error("THREE.InstancedBufferAttribute: The constructor now expects normalized as the third argument."));super(e,t,n);this.meshPerAttribute=i||1}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}toJSON(){let e=super.toJSON();return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}};GF.prototype.isInstancedBufferAttribute=!0;var cx=class extends ls{constructor(e){super(e);typeof createImageBitmap=="undefined"&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),typeof fetch=="undefined"&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(e){return this.options=e,this}load(e,t,n,i){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);let r=this,s=Td.get(e);if(s!==void 0)return r.manager.itemStart(e),setTimeout(function(){t&&t(s),r.manager.itemEnd(e)},0),s;let a={};a.credentials=this.crossOrigin==="anonymous"?"same-origin":"include",a.headers=this.requestHeader,fetch(e,a).then(function(l){return l.blob()}).then(function(l){return createImageBitmap(l,Object.assign(r.options,{colorSpaceConversion:"none"}))}).then(function(l){Td.add(e,l),t&&t(l),r.manager.itemEnd(e)}).catch(function(l){i&&i(l),r.manager.itemError(e),r.manager.itemEnd(e)}),r.manager.itemStart(e)}};cx.prototype.isImageBitmapLoader=!0;var VF=class{constructor(){this.type="ShapePath",this.color=new qe,this.subPaths=[],this.currentPath=null}moveTo(e,t){return this.currentPath=new Mm,this.subPaths.push(this.currentPath),this.currentPath.moveTo(e,t),this}lineTo(e,t){return this.currentPath.lineTo(e,t),this}quadraticCurveTo(e,t,n,i){return this.currentPath.quadraticCurveTo(e,t,n,i),this}bezierCurveTo(e,t,n,i,r,s){return this.currentPath.bezierCurveTo(e,t,n,i,r,s),this}splineThru(e){return this.currentPath.splineThru(e),this}toShapes(e,t){function n(m){let x=[];for(let _=0,w=m.length;_<w;_++){let b=m[_],M=new Tc;M.curves=b.curves,x.push(M)}return x}function i(m,x){let _=x.length,w=!1;for(let b=_-1,M=0;M<_;b=M++){let S=x[b],E=x[M],A=E.x-S.x,L=E.y-S.y;if(Math.abs(L)>Number.EPSILON){if(L<0&&(S=x[M],A=-A,E=x[b],L=-L),m.y<S.y||m.y>E.y)continue;if(m.y===S.y){if(m.x===S.x)return!0}else{let B=L*(m.x-S.x)-A*(m.y-S.y);if(B===0)return!0;if(B<0)continue;w=!w}}else{if(m.y!==S.y)continue;if(E.x<=m.x&&m.x<=S.x||S.x<=m.x&&m.x<=E.x)return!0}}return w}let r=zs.isClockWise,s=this.subPaths;if(s.length===0)return[];if(t===!0)return n(s);let a,l,c,u=[];if(s.length===1)return l=s[0],c=new Tc,c.curves=l.curves,u.push(c),u;let d=!r(s[0].getPoints());d=e?!d:d;let h=[],f=[],p=[],g=0,v;f[g]=void 0,p[g]=[];for(let m=0,x=s.length;m<x;m++)l=s[m],v=l.getPoints(),a=r(v),a=e?!a:a,a?(!d&&f[g]&&g++,f[g]={s:new Tc,p:v},f[g].s.curves=l.curves,d&&g++,p[g]=[]):p[g].push({h:l,p:v[0]});if(!f[0])return n(s);if(f.length>1){let m=!1,x=[];for(let _=0,w=f.length;_<w;_++)h[_]=[];for(let _=0,w=f.length;_<w;_++){let b=p[_];for(let M=0;M<b.length;M++){let S=b[M],E=!0;for(let A=0;A<f.length;A++)i(S.p,f[A].p)&&(_!==A&&x.push({froms:_,tos:A,hole:M}),E?(E=!1,h[A].push(S)):m=!0);E&&h[_].push(S)}}x.length>0&&(m||(p=h))}let y;for(let m=0,x=f.length;m<x;m++){c=f[m].s,u.push(c),y=p[m];for(let _=0,w=y.length;_<w;_++)c.holes.push(y[_].h)}return u}},WF=class{constructor(e){this.type="Font",this.data=e}generateShapes(e,t=100){let n=[],i=$$(e,t,this.data);for(let r=0,s=i.length;r<s;r++)Array.prototype.push.apply(n,i[r].toShapes());return n}};function $$(o,e,t){let n=Array.from(o),i=e/t.resolution,r=(t.boundingBox.yMax-t.boundingBox.yMin+t.underlineThickness)*i,s=[],a=0,l=0;for(let c=0;c<n.length;c++){let u=n[c];if(u===`
`)a=0,l-=r;else{let d=Q$(u,i,a,l,t);a+=d.offsetX,s.push(d.path)}}return s}function Q$(o,e,t,n,i){let r=i.glyphs[o]||i.glyphs["?"];if(!r){console.error('THREE.Font: character "'+o+'" does not exists in font family '+i.familyName+".");return}let s=new VF,a,l,c,u,d,h,f,p;if(r.o){let g=r._cachedOutline||(r._cachedOutline=r.o.split(" "));for(let v=0,y=g.length;v<y;)switch(g[v++]){case"m":a=g[v++]*e+t,l=g[v++]*e+n,s.moveTo(a,l);break;case"l":a=g[v++]*e+t,l=g[v++]*e+n,s.lineTo(a,l);break;case"q":c=g[v++]*e+t,u=g[v++]*e+n,d=g[v++]*e+t,h=g[v++]*e+n,s.quadraticCurveTo(d,h,c,u);break;case"b":c=g[v++]*e+t,u=g[v++]*e+n,d=g[v++]*e+t,h=g[v++]*e+n,f=g[v++]*e+t,p=g[v++]*e+n,s.bezierCurveTo(d,h,f,p,c,u);break}}return{offsetX:r.ha*e,path:s}}WF.prototype.isFont=!0;var ux,eQ={getContext:function(){return ux===void 0&&(ux=new(window.AudioContext||window.webkitAudioContext)),ux},setContext:function(o){ux=o}},XF=class extends ls{constructor(e){super(e)}load(e,t,n,i){let r=this,s=new Sc(this.manager);s.setResponseType("arraybuffer"),s.setPath(this.path),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials),s.load(e,function(a){try{let l=a.slice(0);eQ.getContext().decodeAudioData(l,function(u){t(u)})}catch(l){i?i(l):console.error(l),r.manager.itemError(e)}},n,i)}},qF=class extends lx{constructor(e,t,n=1){super(void 0,n);let i=new qe().set(e),r=new qe().set(t),s=new ae(i.r,i.g,i.b),a=new ae(r.r,r.g,r.b),l=Math.sqrt(Math.PI),c=l*Math.sqrt(.75);this.sh.coefficients[0].copy(s).add(a).multiplyScalar(l),this.sh.coefficients[1].copy(s).sub(a).multiplyScalar(c)}};qF.prototype.isHemisphereLightProbe=!0;var jF=class extends lx{constructor(e,t=1){super(void 0,t);let n=new qe().set(e);this.sh.coefficients[0].set(n.r,n.g,n.b).multiplyScalar(2*Math.sqrt(Math.PI))}};jF.prototype.isAmbientLightProbe=!0;var YF=class extends ot{constructor(e){super();this.type="Audio",this.listener=e,this.context=e.context,this.gain=this.context.createGain(),this.gain.connect(e.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(e){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=e,this.connect(),this}setMediaElementSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(e),this.connect(),this}setMediaStreamSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(e),this.connect(),this}setBuffer(e){return this.buffer=e,this.sourceType="buffer",this.autoplay&&this.play(),this}play(e=0){if(this.isPlaying===!0){console.warn("THREE.Audio: Audio is already playing.");return}if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}this._startedAt=this.context.currentTime+e;let t=this.context.createBufferSource();return t.buffer=this.buffer,t.loop=this.loop,t.loopStart=this.loopStart,t.loopEnd=this.loopEnd,t.onended=this.onEnded.bind(this),t.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=t,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.isPlaying===!0&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,this.loop===!0&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this}stop(){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this._progress=0,this.source.stop(),this.source.onended=null,this.isPlaying=!1,this}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].connect(this.filters[e]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].disconnect(this.filters[e]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}getFilters(){return this.filters}setFilters(e){return e||(e=[]),this._connected===!0?(this.disconnect(),this.filters=e.slice(),this.connect()):this.filters=e.slice(),this}setDetune(e){if(this.detune=e,this.source.detune!==void 0)return this.isPlaying===!0&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(e){return this.setFilters(e?[e]:[])}setPlaybackRate(e){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.playbackRate=e,this.isPlaying===!0&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1}getLoop(){return this.hasPlaybackControl===!1?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}setLoop(e){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.loop=e,this.isPlaying===!0&&(this.source.loop=this.loop),this}setLoopStart(e){return this.loopStart=e,this}setLoopEnd(e){return this.loopEnd=e,this}getVolume(){return this.gain.gain.value}setVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}};var ZF=class{constructor(e,t=2048){this.analyser=e.context.createAnalyser(),this.analyser.fftSize=t,this.data=new Uint8Array(this.analyser.frequencyBinCount),e.getOutput().connect(this.analyser)}getFrequencyData(){return this.analyser.getByteFrequencyData(this.data),this.data}getAverageFrequency(){let e=0,t=this.getFrequencyData();for(let n=0;n<t.length;n++)e+=t[n];return e/t.length}},JF=class{constructor(e,t,n){this.binding=e,this.valueSize=n;let i,r,s;switch(t){case"quaternion":i=this._slerp,r=this._slerpAdditive,s=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(n*6),this._workIndex=5;break;case"string":case"bool":i=this._select,r=this._select,s=this._setAdditiveIdentityOther,this.buffer=new Array(n*5);break;default:i=this._lerp,r=this._lerpAdditive,s=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(n*5)}this._mixBufferRegion=i,this._mixBufferRegionAdditive=r,this._setIdentity=s,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(e,t){let n=this.buffer,i=this.valueSize,r=e*i+i,s=this.cumulativeWeight;if(s===0){for(let a=0;a!==i;++a)n[r+a]=n[a];s=t}else{s+=t;let a=t/s;this._mixBufferRegion(n,r,0,a,i)}this.cumulativeWeight=s}accumulateAdditive(e){let t=this.buffer,n=this.valueSize,i=n*this._addIndex;this.cumulativeWeightAdditive===0&&this._setIdentity(),this._mixBufferRegionAdditive(t,i,0,e,n),this.cumulativeWeightAdditive+=e}apply(e){let t=this.valueSize,n=this.buffer,i=e*t+t,r=this.cumulativeWeight,s=this.cumulativeWeightAdditive,a=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,r<1){let l=t*this._origIndex;this._mixBufferRegion(n,i,l,1-r,t)}s>0&&this._mixBufferRegionAdditive(n,i,this._addIndex*t,1,t);for(let l=t,c=t+t;l!==c;++l)if(n[l]!==n[l+t]){a.setValue(n,i);break}}saveOriginalState(){let e=this.binding,t=this.buffer,n=this.valueSize,i=n*this._origIndex;e.getValue(t,i);for(let r=n,s=i;r!==s;++r)t[r]=t[i+r%n];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){let e=this.valueSize*3;this.binding.setValue(this.buffer,e)}_setAdditiveIdentityNumeric(){let e=this._addIndex*this.valueSize,t=e+this.valueSize;for(let n=e;n<t;n++)this.buffer[n]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){let e=this._origIndex*this.valueSize,t=this._addIndex*this.valueSize;for(let n=0;n<this.valueSize;n++)this.buffer[t+n]=this.buffer[e+n]}_select(e,t,n,i,r){if(i>=.5)for(let s=0;s!==r;++s)e[t+s]=e[n+s]}_slerp(e,t,n,i){pi.slerpFlat(e,t,e,t,e,n,i)}_slerpAdditive(e,t,n,i,r){let s=this._workIndex*r;pi.multiplyQuaternionsFlat(e,s,e,t,e,n),pi.slerpFlat(e,t,e,t,e,s,i)}_lerp(e,t,n,i,r){let s=1-i;for(let a=0;a!==r;++a){let l=t+a;e[l]=e[l]*s+e[n+a]*i}}_lerpAdditive(e,t,n,i,r){for(let s=0;s!==r;++s){let a=t+s;e[a]=e[a]+e[n+s]*i}}},RS="\\[\\]\\.:\\/",tQ=new RegExp("["+RS+"]","g"),PS="[^"+RS+"]",nQ="[^"+RS.replace("\\.","")+"]",iQ=/((?:WC+[\/:])*)/.source.replace("WC",PS),rQ=/(WCOD+)?/.source.replace("WCOD",nQ),sQ=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",PS),oQ=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",PS),aQ=new RegExp("^"+iQ+rQ+sQ+oQ+"$"),lQ=["material","materials","bones"],KF=class{constructor(e,t,n){let i=n||yt.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,i)}getValue(e,t){this.bind();let n=this._targetGroup.nCachedObjects_,i=this._bindings[n];i!==void 0&&i.getValue(e,t)}setValue(e,t){let n=this._bindings;for(let i=this._targetGroup.nCachedObjects_,r=n.length;i!==r;++i)n[i].setValue(e,t)}bind(){let e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].bind()}unbind(){let e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].unbind()}},yt=class{constructor(e,t,n){this.path=t,this.parsedPath=n||yt.parseTrackName(t),this.node=yt.findNode(e,this.parsedPath.nodeName)||e,this.rootNode=e,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(e,t,n){return e&&e.isAnimationObjectGroup?new yt.Composite(e,t,n):new yt(e,t,n)}static sanitizeNodeName(e){return e.replace(/\s/g,"_").replace(tQ,"")}static parseTrackName(e){let t=aQ.exec(e);if(!t)throw new Error("PropertyBinding: Cannot parse trackName: "+e);let n={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},i=n.nodeName&&n.nodeName.lastIndexOf(".");if(i!==void 0&&i!==-1){let r=n.nodeName.substring(i+1);lQ.indexOf(r)!==-1&&(n.nodeName=n.nodeName.substring(0,i),n.objectName=r)}if(n.propertyName===null||n.propertyName.length===0)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return n}static findNode(e,t){if(!t||t===""||t==="."||t===-1||t===e.name||t===e.uuid)return e;if(e.skeleton){let n=e.skeleton.getBoneByName(t);if(n!==void 0)return n}if(e.children){let n=function(r){for(let s=0;s<r.length;s++){let a=r[s];if(a.name===t||a.uuid===t)return a;let l=n(a.children);if(l)return l}return null},i=n(e.children);if(i)return i}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(e,t){e[t]=this.node[this.propertyName]}_getValue_array(e,t){let n=this.resolvedProperty;for(let i=0,r=n.length;i!==r;++i)e[t++]=n[i]}_getValue_arrayElement(e,t){e[t]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(e,t){this.resolvedProperty.toArray(e,t)}_setValue_direct(e,t){this.targetObject[this.propertyName]=e[t]}_setValue_direct_setNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(e,t){let n=this.resolvedProperty;for(let i=0,r=n.length;i!==r;++i)n[i]=e[t++]}_setValue_array_setNeedsUpdate(e,t){let n=this.resolvedProperty;for(let i=0,r=n.length;i!==r;++i)n[i]=e[t++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(e,t){let n=this.resolvedProperty;for(let i=0,r=n.length;i!==r;++i)n[i]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(e,t){this.resolvedProperty[this.propertyIndex]=e[t]}_setValue_arrayElement_setNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(e,t){this.resolvedProperty.fromArray(e,t)}_setValue_fromArray_setNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(e,t){this.bind(),this.getValue(e,t)}_setValue_unbound(e,t){this.bind(),this.setValue(e,t)}bind(){let e=this.node,t=this.parsedPath,n=t.objectName,i=t.propertyName,r=t.propertyIndex;if(e||(e=yt.findNode(this.rootNode,t.nodeName)||this.rootNode,this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!e){console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.");return}if(n){let c=t.objectIndex;switch(n){case"materials":if(!e.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.materials){console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);return}e=e.material.materials;break;case"bones":if(!e.skeleton){console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);return}e=e.skeleton.bones;for(let u=0;u<e.length;u++)if(e[u].name===c){c=u;break}break;default:if(e[n]===void 0){console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);return}e=e[n]}if(c!==void 0){if(e[c]===void 0){console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);return}e=e[c]}}let s=e[i];if(s===void 0){let c=t.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+c+"."+i+" but it wasn't found.",e);return}let a=this.Versioning.None;this.targetObject=e,e.needsUpdate!==void 0?a=this.Versioning.NeedsUpdate:e.matrixWorldNeedsUpdate!==void 0&&(a=this.Versioning.MatrixWorldNeedsUpdate);let l=this.BindingType.Direct;if(r!==void 0){if(i==="morphTargetInfluences"){if(!e.geometry){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);return}if(e.geometry.isBufferGeometry){if(!e.geometry.morphAttributes){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);return}e.morphTargetDictionary[r]!==void 0&&(r=e.morphTargetDictionary[r])}else{console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences on THREE.Geometry. Use THREE.BufferGeometry instead.",this);return}}l=this.BindingType.ArrayElement,this.resolvedProperty=s,this.propertyIndex=r}else s.fromArray!==void 0&&s.toArray!==void 0?(l=this.BindingType.HasFromToArray,this.resolvedProperty=s):Array.isArray(s)?(l=this.BindingType.EntireArray,this.resolvedProperty=s):this.propertyName=i;this.getValue=this.GetterByBindingType[l],this.setValue=this.SetterByBindingTypeAndVersioning[l][a]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}};yt.Composite=KF;yt.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3};yt.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2};yt.prototype.GetterByBindingType=[yt.prototype._getValue_direct,yt.prototype._getValue_array,yt.prototype._getValue_arrayElement,yt.prototype._getValue_toArray];yt.prototype.SetterByBindingTypeAndVersioning=[[yt.prototype._setValue_direct,yt.prototype._setValue_direct_setNeedsUpdate,yt.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[yt.prototype._setValue_array,yt.prototype._setValue_array_setNeedsUpdate,yt.prototype._setValue_array_setMatrixWorldNeedsUpdate],[yt.prototype._setValue_arrayElement,yt.prototype._setValue_arrayElement_setNeedsUpdate,yt.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[yt.prototype._setValue_fromArray,yt.prototype._setValue_fromArray_setNeedsUpdate,yt.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];var $F=class{constructor(){this.uuid=nr(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;let e={};this._indicesByUUID=e;for(let n=0,i=arguments.length;n!==i;++n)e[arguments[n].uuid]=n;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};let t=this;this.stats={objects:{get total(){return t._objects.length},get inUse(){return this.total-t.nCachedObjects_}},get bindingsPerObject(){return t._bindings.length}}}add(){let e=this._objects,t=this._indicesByUUID,n=this._paths,i=this._parsedPaths,r=this._bindings,s=r.length,a,l=e.length,c=this.nCachedObjects_;for(let u=0,d=arguments.length;u!==d;++u){let h=arguments[u],f=h.uuid,p=t[f];if(p===void 0){p=l++,t[f]=p,e.push(h);for(let g=0,v=s;g!==v;++g)r[g].push(new yt(h,n[g],i[g]))}else if(p<c){a=e[p];let g=--c,v=e[g];t[v.uuid]=p,e[p]=v,t[f]=g,e[g]=h;for(let y=0,m=s;y!==m;++y){let x=r[y],_=x[g],w=x[p];x[p]=_,w===void 0&&(w=new yt(h,n[y],i[y])),x[g]=w}}else e[p]!==a&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=c}remove(){let e=this._objects,t=this._indicesByUUID,n=this._bindings,i=n.length,r=this.nCachedObjects_;for(let s=0,a=arguments.length;s!==a;++s){let l=arguments[s],c=l.uuid,u=t[c];if(u!==void 0&&u>=r){let d=r++,h=e[d];t[h.uuid]=u,e[u]=h,t[c]=d,e[d]=l;for(let f=0,p=i;f!==p;++f){let g=n[f],v=g[d],y=g[u];g[u]=v,g[d]=y}}}this.nCachedObjects_=r}uncache(){let e=this._objects,t=this._indicesByUUID,n=this._bindings,i=n.length,r=this.nCachedObjects_,s=e.length;for(let a=0,l=arguments.length;a!==l;++a){let c=arguments[a],u=c.uuid,d=t[u];if(d!==void 0)if(delete t[u],d<r){let h=--r,f=e[h],p=--s,g=e[p];t[f.uuid]=d,e[d]=f,t[g.uuid]=h,e[h]=g,e.pop();for(let v=0,y=i;v!==y;++v){let m=n[v],x=m[h],_=m[p];m[d]=x,m[h]=_,m.pop()}}else{let h=--s,f=e[h];h>0&&(t[f.uuid]=d),e[d]=f,e.pop();for(let p=0,g=i;p!==g;++p){let v=n[p];v[d]=v[h],v.pop()}}}this.nCachedObjects_=r}subscribe_(e,t){let n=this._bindingsIndicesByPath,i=n[e],r=this._bindings;if(i!==void 0)return r[i];let s=this._paths,a=this._parsedPaths,l=this._objects,c=l.length,u=this.nCachedObjects_,d=new Array(c);i=r.length,n[e]=i,s.push(e),a.push(t),r.push(d);for(let h=u,f=l.length;h!==f;++h){let p=l[h];d[h]=new yt(p,e,t)}return d}unsubscribe_(e){let t=this._bindingsIndicesByPath,n=t[e];if(n!==void 0){let i=this._paths,r=this._parsedPaths,s=this._bindings,a=s.length-1,l=s[a],c=e[a];t[c]=n,s[n]=l,s.pop(),r[n]=r[a],r.pop(),i[n]=i[a],i.pop()}}};$F.prototype.isAnimationObjectGroup=!0;var QF=class{constructor(e,t,n=null,i=t.blendMode){this._mixer=e,this._clip=t,this._localRoot=n,this.blendMode=i;let r=t.tracks,s=r.length,a=new Array(s),l={endingStart:Jh,endingEnd:Jh};for(let c=0;c!==s;++c){let u=r[c].createInterpolant(null);a[c]=u,u.settings=l}this._interpolantSettings=l,this._interpolants=a,this._propertyBindings=new Array(s),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=Pj,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&this.timeScale!==0&&this._startTime===null&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(e){return this._startTime=e,this}setLoop(e,t){return this.loop=e,this.repetitions=t,this}setEffectiveWeight(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(e){return this._scheduleFading(e,0,1)}fadeOut(e){return this._scheduleFading(e,1,0)}crossFadeFrom(e,t,n){if(e.fadeOut(t),this.fadeIn(t),n){let i=this._clip.duration,r=e._clip.duration,s=r/i,a=i/r;e.warp(1,s,t),this.warp(a,1,t)}return this}crossFadeTo(e,t,n){return e.crossFadeFrom(this,t,n)}stopFading(){let e=this._weightInterpolant;return e!==null&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}setEffectiveTimeScale(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(e){return this.timeScale=this._clip.duration/e,this.stopWarping()}syncWith(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()}halt(e){return this.warp(this._effectiveTimeScale,0,e)}warp(e,t,n){let i=this._mixer,r=i.time,s=this.timeScale,a=this._timeScaleInterpolant;a===null&&(a=i._lendControlInterpolant(),this._timeScaleInterpolant=a);let l=a.parameterPositions,c=a.sampleValues;return l[0]=r,l[1]=r+n,c[0]=e/s,c[1]=t/s,this}stopWarping(){let e=this._timeScaleInterpolant;return e!==null&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(e,t,n,i){if(!this.enabled){this._updateWeight(e);return}let r=this._startTime;if(r!==null){let l=(e-r)*n;if(l<0||n===0)return;this._startTime=null,t=n*l}t*=this._updateTimeScale(e);let s=this._updateTime(t),a=this._updateWeight(e);if(a>0){let l=this._interpolants,c=this._propertyBindings;switch(this.blendMode){case qI:for(let u=0,d=l.length;u!==d;++u)l[u].evaluate(s),c[u].accumulateAdditive(a);break;case b1:default:for(let u=0,d=l.length;u!==d;++u)l[u].evaluate(s),c[u].accumulate(i,a)}}}_updateWeight(e){let t=0;if(this.enabled){t=this.weight;let n=this._weightInterpolant;if(n!==null){let i=n.evaluate(e)[0];t*=i,e>n.parameterPositions[1]&&(this.stopFading(),i===0&&(this.enabled=!1))}}return this._effectiveWeight=t,t}_updateTimeScale(e){let t=0;if(!this.paused){t=this.timeScale;let n=this._timeScaleInterpolant;n!==null&&(t*=n.evaluate(e)[0],e>n.parameterPositions[1]&&(this.stopWarping(),t===0?this.paused=!0:this.timeScale=t))}return this._effectiveTimeScale=t,t}_updateTime(e){let t=this._clip.duration,n=this.loop,i=this.time+e,r=this._loopCount,s=n===Ij;if(e===0)return r===-1?i:s&&(r&1)==1?t-i:i;if(n===Rj){r===-1&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(i>=t)i=t;else if(i<0)i=0;else{this.time=i;break e}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=i,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(r===-1&&(e>=0?(r=0,this._setEndings(!0,this.repetitions===0,s)):this._setEndings(this.repetitions===0,!0,s)),i>=t||i<0){let a=Math.floor(i/t);i-=t*a,r+=Math.abs(a);let l=this.repetitions-r;if(l<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,i=e>0?t:0,this.time=i,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(l===1){let c=e<0;this._setEndings(c,!c,s)}else this._setEndings(!1,!1,s);this._loopCount=r,this.time=i,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:a})}}else this.time=i;if(s&&(r&1)==1)return t-i}return i}_setEndings(e,t,n){let i=this._interpolantSettings;n?(i.endingStart=Kh,i.endingEnd=Kh):(e?i.endingStart=this.zeroSlopeAtStart?Kh:Jh:i.endingStart=mv,t?i.endingEnd=this.zeroSlopeAtEnd?Kh:Jh:i.endingEnd=mv)}_scheduleFading(e,t,n){let i=this._mixer,r=i.time,s=this._weightInterpolant;s===null&&(s=i._lendControlInterpolant(),this._weightInterpolant=s);let a=s.parameterPositions,l=s.sampleValues;return a[0]=r,l[0]=t,a[1]=r+e,l[1]=n,this}},eB=class extends Va{constructor(e){super();this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(e,t){let n=e._localRoot||this._root,i=e._clip.tracks,r=i.length,s=e._propertyBindings,a=e._interpolants,l=n.uuid,c=this._bindingsByRootAndName,u=c[l];u===void 0&&(u={},c[l]=u);for(let d=0;d!==r;++d){let h=i[d],f=h.name,p=u[f];if(p!==void 0)s[d]=p;else{if(p=s[d],p!==void 0){p._cacheIndex===null&&(++p.referenceCount,this._addInactiveBinding(p,l,f));continue}let g=t&&t._propertyBindings[d].binding.parsedPath;p=new JF(yt.create(n,f,g),h.ValueTypeName,h.getValueSize()),++p.referenceCount,this._addInactiveBinding(p,l,f),s[d]=p}a[d].resultBuffer=p.buffer}}_activateAction(e){if(!this._isActiveAction(e)){if(e._cacheIndex===null){let n=(e._localRoot||this._root).uuid,i=e._clip.uuid,r=this._actionsByClip[i];this._bindAction(e,r&&r.knownActions[0]),this._addInactiveAction(e,i,n)}let t=e._propertyBindings;for(let n=0,i=t.length;n!==i;++n){let r=t[n];r.useCount++==0&&(this._lendBinding(r),r.saveOriginalState())}this._lendAction(e)}}_deactivateAction(e){if(this._isActiveAction(e)){let t=e._propertyBindings;for(let n=0,i=t.length;n!==i;++n){let r=t[n];--r.useCount==0&&(r.restoreOriginalState(),this._takeBackBinding(r))}this._takeBackAction(e)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;let e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}}_isActiveAction(e){let t=e._cacheIndex;return t!==null&&t<this._nActiveActions}_addInactiveAction(e,t,n){let i=this._actions,r=this._actionsByClip,s=r[t];if(s===void 0)s={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,r[t]=s;else{let a=s.knownActions;e._byClipCacheIndex=a.length,a.push(e)}e._cacheIndex=i.length,i.push(e),s.actionByRoot[n]=e}_removeInactiveAction(e){let t=this._actions,n=t[t.length-1],i=e._cacheIndex;n._cacheIndex=i,t[i]=n,t.pop(),e._cacheIndex=null;let r=e._clip.uuid,s=this._actionsByClip,a=s[r],l=a.knownActions,c=l[l.length-1],u=e._byClipCacheIndex;c._byClipCacheIndex=u,l[u]=c,l.pop(),e._byClipCacheIndex=null;let d=a.actionByRoot,h=(e._localRoot||this._root).uuid;delete d[h],l.length===0&&delete s[r],this._removeInactiveBindingsForAction(e)}_removeInactiveBindingsForAction(e){let t=e._propertyBindings;for(let n=0,i=t.length;n!==i;++n){let r=t[n];--r.referenceCount==0&&this._removeInactiveBinding(r)}}_lendAction(e){let t=this._actions,n=e._cacheIndex,i=this._nActiveActions++,r=t[i];e._cacheIndex=i,t[i]=e,r._cacheIndex=n,t[n]=r}_takeBackAction(e){let t=this._actions,n=e._cacheIndex,i=--this._nActiveActions,r=t[i];e._cacheIndex=i,t[i]=e,r._cacheIndex=n,t[n]=r}_addInactiveBinding(e,t,n){let i=this._bindingsByRootAndName,r=this._bindings,s=i[t];s===void 0&&(s={},i[t]=s),s[n]=e,e._cacheIndex=r.length,r.push(e)}_removeInactiveBinding(e){let t=this._bindings,n=e.binding,i=n.rootNode.uuid,r=n.path,s=this._bindingsByRootAndName,a=s[i],l=t[t.length-1],c=e._cacheIndex;l._cacheIndex=c,t[c]=l,t.pop(),delete a[r],Object.keys(a).length===0&&delete s[i]}_lendBinding(e){let t=this._bindings,n=e._cacheIndex,i=this._nActiveBindings++,r=t[i];e._cacheIndex=i,t[i]=e,r._cacheIndex=n,t[n]=r}_takeBackBinding(e){let t=this._bindings,n=e._cacheIndex,i=--this._nActiveBindings,r=t[i];e._cacheIndex=i,t[i]=e,r._cacheIndex=n,t[n]=r}_lendControlInterpolant(){let e=this._controlInterpolants,t=this._nActiveControlInterpolants++,n=e[t];return n===void 0&&(n=new pS(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer),n.__cacheIndex=t,e[t]=n),n}_takeBackControlInterpolant(e){let t=this._controlInterpolants,n=e.__cacheIndex,i=--this._nActiveControlInterpolants,r=t[i];e.__cacheIndex=i,t[i]=e,r.__cacheIndex=n,t[n]=r}clipAction(e,t,n){let i=t||this._root,r=i.uuid,s=typeof e=="string"?vm.findByName(i,e):e,a=s!==null?s.uuid:e,l=this._actionsByClip[a],c=null;if(n===void 0&&(s!==null?n=s.blendMode:n=b1),l!==void 0){let d=l.actionByRoot[r];if(d!==void 0&&d.blendMode===n)return d;c=l.knownActions[0],s===null&&(s=c._clip)}if(s===null)return null;let u=new QF(this,s,t,n);return this._bindAction(u,c),this._addInactiveAction(u,a,r),u}existingAction(e,t){let n=t||this._root,i=n.uuid,r=typeof e=="string"?vm.findByName(n,e):e,s=r?r.uuid:e,a=this._actionsByClip[s];return a!==void 0&&a.actionByRoot[i]||null}stopAllAction(){let e=this._actions,t=this._nActiveActions;for(let n=t-1;n>=0;--n)e[n].stop();return this}update(e){e*=this.timeScale;let t=this._actions,n=this._nActiveActions,i=this.time+=e,r=Math.sign(e),s=this._accuIndex^=1;for(let c=0;c!==n;++c)t[c]._update(i,e,r,s);let a=this._bindings,l=this._nActiveBindings;for(let c=0;c!==l;++c)a[c].apply(s);return this}setTime(e){this.time=0;for(let t=0;t<this._actions.length;t++)this._actions[t].time=0;return this.update(e)}getRoot(){return this._root}uncacheClip(e){let t=this._actions,n=e.uuid,i=this._actionsByClip,r=i[n];if(r!==void 0){let s=r.knownActions;for(let a=0,l=s.length;a!==l;++a){let c=s[a];this._deactivateAction(c);let u=c._cacheIndex,d=t[t.length-1];c._cacheIndex=null,c._byClipCacheIndex=null,d._cacheIndex=u,t[u]=d,t.pop(),this._removeInactiveBindingsForAction(c)}delete i[n]}}uncacheRoot(e){let t=e.uuid,n=this._actionsByClip;for(let s in n){let a=n[s].actionByRoot,l=a[t];l!==void 0&&(this._deactivateAction(l),this._removeInactiveAction(l))}let i=this._bindingsByRootAndName,r=i[t];if(r!==void 0)for(let s in r){let a=r[s];a.restoreOriginalState(),this._removeInactiveBinding(a)}}uncacheAction(e,t){let n=this.existingAction(e,t);n!==null&&(this._deactivateAction(n),this._removeInactiveAction(n))}};eB.prototype._controlInterpolantsResultBuffer=new Float32Array(1);var hx=class{constructor(e){typeof e=="string"&&(console.warn("THREE.Uniform: Type parameter is no longer needed."),e=arguments[1]),this.value=e}clone(){return new hx(this.value.clone===void 0?this.value:this.value.clone())}},tB=class extends Sr{constructor(e,t,n=1){super(e,t);this.meshPerAttribute=n||1}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}clone(e){let t=super.clone(e);return t.meshPerAttribute=this.meshPerAttribute,t}toJSON(e){let t=super.toJSON(e);return t.isInstancedInterleavedBuffer=!0,t.meshPerAttribute=this.meshPerAttribute,t}};tB.prototype.isInstancedInterleavedBuffer=!0;var nB=class{constructor(e,t,n,i,r){this.buffer=e,this.type=t,this.itemSize=n,this.elementSize=i,this.count=r,this.version=0}set needsUpdate(e){e===!0&&this.version++}setBuffer(e){return this.buffer=e,this}setType(e,t){return this.type=e,this.elementSize=t,this}setItemSize(e){return this.itemSize=e,this}setCount(e){return this.count=e,this}};nB.prototype.isGLBufferAttribute=!0;var iB=new Oe,Ed=class{constructor(e=new Oe(1/0,1/0),t=new Oe(-1/0,-1/0)){this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromPoints(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){let n=iB.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(e){return e===void 0&&(console.warn("THREE.Box2: .getCenter() target is now required"),e=new Oe),this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return e===void 0&&(console.warn("THREE.Box2: .getSize() target is now required"),e=new Oe),this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y}getParameter(e,t){return t===void 0&&(console.warn("THREE.Box2: .getParameter() target is now required"),t=new Oe),t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y)}clampPoint(e,t){return t===void 0&&(console.warn("THREE.Box2: .clampPoint() target is now required"),t=new Oe),t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return iB.copy(e).clamp(this.min,this.max).sub(e).length()}intersect(e){return this.min.max(e.min),this.max.min(e.max),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}};Ed.prototype.isBox2=!0;var rB=new ae,dx=new ae,sB=class{constructor(e=new ae,t=new ae){this.start=e,this.end=t}set(e,t){return this.start.copy(e),this.end.copy(t),this}copy(e){return this.start.copy(e.start),this.end.copy(e.end),this}getCenter(e){return e===void 0&&(console.warn("THREE.Line3: .getCenter() target is now required"),e=new ae),e.addVectors(this.start,this.end).multiplyScalar(.5)}delta(e){return e===void 0&&(console.warn("THREE.Line3: .delta() target is now required"),e=new ae),e.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(e,t){return t===void 0&&(console.warn("THREE.Line3: .at() target is now required"),t=new ae),this.delta(t).multiplyScalar(e).add(this.start)}closestPointToPointParameter(e,t){rB.subVectors(e,this.start),dx.subVectors(this.end,this.start);let n=dx.dot(dx),r=dx.dot(rB)/n;return t&&(r=Ci(r,0,1)),r}closestPointToPoint(e,t,n){let i=this.closestPointToPointParameter(e,t);return n===void 0&&(console.warn("THREE.Line3: .closestPointToPoint() target is now required"),n=new ae),this.delta(n).multiplyScalar(i).add(this.start)}applyMatrix4(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this}equals(e){return e.start.equals(this.start)&&e.end.equals(this.end)}clone(){return new this.constructor().copy(this)}},oB=class extends ot{constructor(e){super();this.material=e,this.render=function(){},this.hasPositions=!1,this.hasNormals=!1,this.hasColors=!1,this.hasUvs=!1,this.positionArray=null,this.normalArray=null,this.colorArray=null,this.uvArray=null,this.count=0}};oB.prototype.isImmediateRenderObject=!0;var rl=new ae,fx=new Ze,IS=new Ze,aB=class extends bd{constructor(e){let t=lB(e),n=new Et,i=[],r=[],s=new qe(0,0,1),a=new qe(0,1,0);for(let c=0;c<t.length;c++){let u=t[c];u.parent&&u.parent.isBone&&(i.push(0,0,0),i.push(0,0,0),r.push(s.r,s.g,s.b),r.push(a.r,a.g,a.b))}n.setAttribute("position",new fn(i,3)),n.setAttribute("color",new fn(r,3));let l=new Qa({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0});super(n,l);this.type="SkeletonHelper",this.isSkeletonHelper=!0,this.root=e,this.bones=t,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1}updateMatrixWorld(e){let t=this.bones,n=this.geometry,i=n.getAttribute("position");IS.copy(this.root.matrixWorld).invert();for(let r=0,s=0;r<t.length;r++){let a=t[r];a.parent&&a.parent.isBone&&(fx.multiplyMatrices(IS,a.matrixWorld),rl.setFromMatrixPosition(fx),i.setXYZ(s,rl.x,rl.y,rl.z),fx.multiplyMatrices(IS,a.parent.matrixWorld),rl.setFromMatrixPosition(fx),i.setXYZ(s+1,rl.x,rl.y,rl.z),s+=2)}n.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(e)}};function lB(o){let e=[];o&&o.isBone&&e.push(o);for(let t=0;t<o.children.length;t++)e.push.apply(e,lB(o.children[t]));return e}var cB=class extends bd{constructor(e=10,t=10,n=4473924,i=8947848){n=new qe(n),i=new qe(i);let r=t/2,s=e/t,a=e/2,l=[],c=[];for(let h=0,f=0,p=-a;h<=t;h++,p+=s){l.push(-a,0,p,a,0,p),l.push(p,0,-a,p,0,a);let g=h===r?n:i;g.toArray(c,f),f+=3,g.toArray(c,f),f+=3,g.toArray(c,f),f+=3,g.toArray(c,f),f+=3}let u=new Et;u.setAttribute("position",new fn(l,3)),u.setAttribute("color",new fn(c,3));let d=new Qa({vertexColors:!0,toneMapped:!1});super(u,d);this.type="GridHelper"}};var cQ=new Float32Array(1),_ae=new Int32Array(cQ.buffer);var uQ=4,uB=8,wae=Math.pow(2,uB),hQ=[.125,.215,.35,.446,.526,.582],bae=uB-uQ+1+hQ.length;var Mae={[Qh]:0,[ed]:1,[YI]:2,[ZI]:3,[JI]:4,[KI]:5,[jI]:6},dQ=new Fs({side:zn,depthWrite:!1,depthTest:!1}),Sae=new Vn(new Bv,dQ);var Ec=(1+Math.sqrt(5))/2,Ad=1/Ec,Tae=[new ae(1,1,1),new ae(-1,1,1),new ae(1,1,-1),new ae(-1,1,-1),new ae(0,Ec,Ad),new ae(0,Ec,-Ad),new ae(Ad,0,Ec),new ae(-Ad,0,Ec),new ae(Ec,Ad,0),new ae(-Ec,Ad,0)];sr.create=function(o,e){return console.log("THREE.Curve.create() has been deprecated"),o.prototype=Object.create(sr.prototype),o.prototype.constructor=o,o.prototype.getPoint=e,o};Mm.prototype.fromPoints=function(o){return console.warn("THREE.Path: .fromPoints() has been renamed to .setFromPoints()."),this.setFromPoints(o)};cB.prototype.setColors=function(){console.error("THREE.GridHelper: setColors() has been deprecated, pass them in the constructor instead.")};aB.prototype.update=function(){console.error("THREE.SkeletonHelper: update() no longer needs to be called.")};ls.prototype.extractUrlBase=function(o){return console.warn("THREE.Loader: .extractUrlBase() has been deprecated. Use THREE.LoaderUtils.extractUrlBase() instead."),il.extractUrlBase(o)};ls.Handlers={add:function(){console.error("THREE.Loader: Handlers.add() has been removed. Use LoadingManager.addHandler() instead.")},get:function(){console.error("THREE.Loader: Handlers.get() has been removed. Use LoadingManager.getHandler() instead.")}};Ed.prototype.center=function(o){return console.warn("THREE.Box2: .center() has been renamed to .getCenter()."),this.getCenter(o)};Ed.prototype.empty=function(){return console.warn("THREE.Box2: .empty() has been renamed to .isEmpty()."),this.isEmpty()};Ed.prototype.isIntersectionBox=function(o){return console.warn("THREE.Box2: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(o)};Ed.prototype.size=function(o){return console.warn("THREE.Box2: .size() has been renamed to .getSize()."),this.getSize(o)};Li.prototype.center=function(o){return console.warn("THREE.Box3: .center() has been renamed to .getCenter()."),this.getCenter(o)};Li.prototype.empty=function(){return console.warn("THREE.Box3: .empty() has been renamed to .isEmpty()."),this.isEmpty()};Li.prototype.isIntersectionBox=function(o){return console.warn("THREE.Box3: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(o)};Li.prototype.isIntersectionSphere=function(o){return console.warn("THREE.Box3: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(o)};Li.prototype.size=function(o){return console.warn("THREE.Box3: .size() has been renamed to .getSize()."),this.getSize(o)};Po.prototype.empty=function(){return console.warn("THREE.Sphere: .empty() has been renamed to .isEmpty()."),this.isEmpty()};nm.prototype.setFromMatrix=function(o){return console.warn("THREE.Frustum: .setFromMatrix() has been renamed to .setFromProjectionMatrix()."),this.setFromProjectionMatrix(o)};sB.prototype.center=function(o){return console.warn("THREE.Line3: .center() has been renamed to .getCenter()."),this.getCenter(o)};Un.prototype.flattenToArrayOffset=function(o,e){return console.warn("THREE.Matrix3: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(o,e)};Un.prototype.multiplyVector3=function(o){return console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),o.applyMatrix3(this)};Un.prototype.multiplyVector3Array=function(){console.error("THREE.Matrix3: .multiplyVector3Array() has been removed.")};Un.prototype.applyToBufferAttribute=function(o){return console.warn("THREE.Matrix3: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix3( matrix ) instead."),o.applyMatrix3(this)};Un.prototype.applyToVector3Array=function(){console.error("THREE.Matrix3: .applyToVector3Array() has been removed.")};Un.prototype.getInverse=function(o){return console.warn("THREE.Matrix3: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead."),this.copy(o).invert()};Ze.prototype.extractPosition=function(o){return console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(o)};Ze.prototype.flattenToArrayOffset=function(o,e){return console.warn("THREE.Matrix4: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(o,e)};Ze.prototype.getPosition=function(){return console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead."),new ae().setFromMatrixColumn(this,3)};Ze.prototype.setRotationFromQuaternion=function(o){return console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion()."),this.makeRotationFromQuaternion(o)};Ze.prototype.multiplyToArray=function(){console.warn("THREE.Matrix4: .multiplyToArray() has been removed.")};Ze.prototype.multiplyVector3=function(o){return console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) instead."),o.applyMatrix4(this)};Ze.prototype.multiplyVector4=function(o){return console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),o.applyMatrix4(this)};Ze.prototype.multiplyVector3Array=function(){console.error("THREE.Matrix4: .multiplyVector3Array() has been removed.")};Ze.prototype.rotateAxis=function(o){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),o.transformDirection(this)};Ze.prototype.crossVector=function(o){return console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),o.applyMatrix4(this)};Ze.prototype.translate=function(){console.error("THREE.Matrix4: .translate() has been removed.")};Ze.prototype.rotateX=function(){console.error("THREE.Matrix4: .rotateX() has been removed.")};Ze.prototype.rotateY=function(){console.error("THREE.Matrix4: .rotateY() has been removed.")};Ze.prototype.rotateZ=function(){console.error("THREE.Matrix4: .rotateZ() has been removed.")};Ze.prototype.rotateByAxis=function(){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")};Ze.prototype.applyToBufferAttribute=function(o){return console.warn("THREE.Matrix4: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix4( matrix ) instead."),o.applyMatrix4(this)};Ze.prototype.applyToVector3Array=function(){console.error("THREE.Matrix4: .applyToVector3Array() has been removed.")};Ze.prototype.makeFrustum=function(o,e,t,n,i,r){return console.warn("THREE.Matrix4: .makeFrustum() has been removed. Use .makePerspective( left, right, top, bottom, near, far ) instead."),this.makePerspective(o,e,n,t,i,r)};Ze.prototype.getInverse=function(o){return console.warn("THREE.Matrix4: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead."),this.copy(o).invert()};mi.prototype.isIntersectionLine=function(o){return console.warn("THREE.Plane: .isIntersectionLine() has been renamed to .intersectsLine()."),this.intersectsLine(o)};pi.prototype.multiplyVector3=function(o){return console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),o.applyQuaternion(this)};pi.prototype.inverse=function(){return console.warn("THREE.Quaternion: .inverse() has been renamed to invert()."),this.invert()};yc.prototype.isIntersectionBox=function(o){return console.warn("THREE.Ray: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(o)};yc.prototype.isIntersectionPlane=function(o){return console.warn("THREE.Ray: .isIntersectionPlane() has been renamed to .intersectsPlane()."),this.intersectsPlane(o)};yc.prototype.isIntersectionSphere=function(o){return console.warn("THREE.Ray: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(o)};wn.prototype.area=function(){return console.warn("THREE.Triangle: .area() has been renamed to .getArea()."),this.getArea()};wn.prototype.barycoordFromPoint=function(o,e){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),this.getBarycoord(o,e)};wn.prototype.midpoint=function(o){return console.warn("THREE.Triangle: .midpoint() has been renamed to .getMidpoint()."),this.getMidpoint(o)};wn.prototypenormal=function(o){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),this.getNormal(o)};wn.prototype.plane=function(o){return console.warn("THREE.Triangle: .plane() has been renamed to .getPlane()."),this.getPlane(o)};wn.barycoordFromPoint=function(o,e,t,n,i){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),wn.getBarycoord(o,e,t,n,i)};wn.normal=function(o,e,t,n){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),wn.getNormal(o,e,t,n)};Tc.prototype.extractAllPoints=function(o){return console.warn("THREE.Shape: .extractAllPoints() has been removed. Use .extractPoints() instead."),this.extractPoints(o)};Tc.prototype.extrude=function(o){return console.warn("THREE.Shape: .extrude() has been removed. Use ExtrudeGeometry() instead."),new gm(this,o)};Tc.prototype.makeGeometry=function(o){return console.warn("THREE.Shape: .makeGeometry() has been removed. Use ShapeGeometry() instead."),new yF(this,o)};Oe.prototype.fromAttribute=function(o,e,t){return console.warn("THREE.Vector2: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(o,e,t)};Oe.prototype.distanceToManhattan=function(o){return console.warn("THREE.Vector2: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(o)};Oe.prototype.lengthManhattan=function(){return console.warn("THREE.Vector2: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()};ae.prototype.setEulerFromRotationMatrix=function(){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")};ae.prototype.setEulerFromQuaternion=function(){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")};ae.prototype.getPositionFromMatrix=function(o){return console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(o)};ae.prototype.getScaleFromMatrix=function(o){return console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(o)};ae.prototype.getColumnFromMatrix=function(o,e){return console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(e,o)};ae.prototype.applyProjection=function(o){return console.warn("THREE.Vector3: .applyProjection() has been removed. Use .applyMatrix4( m ) instead."),this.applyMatrix4(o)};ae.prototype.fromAttribute=function(o,e,t){return console.warn("THREE.Vector3: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(o,e,t)};ae.prototype.distanceToManhattan=function(o){return console.warn("THREE.Vector3: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(o)};ae.prototype.lengthManhattan=function(){return console.warn("THREE.Vector3: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()};Dt.prototype.fromAttribute=function(o,e,t){return console.warn("THREE.Vector4: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(o,e,t)};Dt.prototype.lengthManhattan=function(){return console.warn("THREE.Vector4: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()};ot.prototype.getChildByName=function(o){return console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(o)};ot.prototype.renderDepth=function(){console.warn("THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")};ot.prototype.translate=function(o,e){return console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead."),this.translateOnAxis(e,o)};ot.prototype.getWorldRotation=function(){console.error("THREE.Object3D: .getWorldRotation() has been removed. Use THREE.Object3D.getWorldQuaternion( target ) instead.")};ot.prototype.applyMatrix=function(o){return console.warn("THREE.Object3D: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(o)};Object.defineProperties(ot.prototype,{eulerOrder:{get:function(){return console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order},set:function(o){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order=o}},useQuaternion:{get:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")}}});Vn.prototype.setDrawMode=function(){console.error("THREE.Mesh: .setDrawMode() has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")};Object.defineProperties(Vn.prototype,{drawMode:{get:function(){return console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode."),M1},set:function(){console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")}}});lm.prototype.initBones=function(){console.error("THREE.SkinnedMesh: initBones() has been removed.")};yi.prototype.setLens=function(o,e){console.warn("THREE.PerspectiveCamera.setLens is deprecated. Use .setFocalLength and .filmGauge for a photographic setup."),e!==void 0&&(this.filmGauge=e),this.setFocalLength(o)};Object.defineProperties(us.prototype,{onlyShadow:{set:function(){console.warn("THREE.Light: .onlyShadow has been removed.")}},shadowCameraFov:{set:function(o){console.warn("THREE.Light: .shadowCameraFov is now .shadow.camera.fov."),this.shadow.camera.fov=o}},shadowCameraLeft:{set:function(o){console.warn("THREE.Light: .shadowCameraLeft is now .shadow.camera.left."),this.shadow.camera.left=o}},shadowCameraRight:{set:function(o){console.warn("THREE.Light: .shadowCameraRight is now .shadow.camera.right."),this.shadow.camera.right=o}},shadowCameraTop:{set:function(o){console.warn("THREE.Light: .shadowCameraTop is now .shadow.camera.top."),this.shadow.camera.top=o}},shadowCameraBottom:{set:function(o){console.warn("THREE.Light: .shadowCameraBottom is now .shadow.camera.bottom."),this.shadow.camera.bottom=o}},shadowCameraNear:{set:function(o){console.warn("THREE.Light: .shadowCameraNear is now .shadow.camera.near."),this.shadow.camera.near=o}},shadowCameraFar:{set:function(o){console.warn("THREE.Light: .shadowCameraFar is now .shadow.camera.far."),this.shadow.camera.far=o}},shadowCameraVisible:{set:function(){console.warn("THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow.camera ) instead.")}},shadowBias:{set:function(o){console.warn("THREE.Light: .shadowBias is now .shadow.bias."),this.shadow.bias=o}},shadowDarkness:{set:function(){console.warn("THREE.Light: .shadowDarkness has been removed.")}},shadowMapWidth:{set:function(o){console.warn("THREE.Light: .shadowMapWidth is now .shadow.mapSize.width."),this.shadow.mapSize.width=o}},shadowMapHeight:{set:function(o){console.warn("THREE.Light: .shadowMapHeight is now .shadow.mapSize.height."),this.shadow.mapSize.height=o}}});Object.defineProperties(jt.prototype,{length:{get:function(){return console.warn("THREE.BufferAttribute: .length has been deprecated. Use .count instead."),this.array.length}},dynamic:{get:function(){return console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.usage===yv},set:function(){console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.setUsage(yv)}}});jt.prototype.setDynamic=function(o){return console.warn("THREE.BufferAttribute: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(o===!0?yv:jp),this};jt.prototype.copyIndicesArray=function(){console.error("THREE.BufferAttribute: .copyIndicesArray() has been removed.")},jt.prototype.setArray=function(){console.error("THREE.BufferAttribute: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")};Et.prototype.addIndex=function(o){console.warn("THREE.BufferGeometry: .addIndex() has been renamed to .setIndex()."),this.setIndex(o)};Et.prototype.addAttribute=function(o,e){return console.warn("THREE.BufferGeometry: .addAttribute() has been renamed to .setAttribute()."),!(e&&e.isBufferAttribute)&&!(e&&e.isInterleavedBufferAttribute)?(console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),this.setAttribute(o,new jt(arguments[1],arguments[2]))):o==="index"?(console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute."),this.setIndex(e),this):this.setAttribute(o,e)};Et.prototype.addDrawCall=function(o,e,t){t!==void 0&&console.warn("THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset."),console.warn("THREE.BufferGeometry: .addDrawCall() is now .addGroup()."),this.addGroup(o,e)};Et.prototype.clearDrawCalls=function(){console.warn("THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups()."),this.clearGroups()};Et.prototype.computeOffsets=function(){console.warn("THREE.BufferGeometry: .computeOffsets() has been removed.")};Et.prototype.removeAttribute=function(o){return console.warn("THREE.BufferGeometry: .removeAttribute() has been renamed to .deleteAttribute()."),this.deleteAttribute(o)};Et.prototype.applyMatrix=function(o){return console.warn("THREE.BufferGeometry: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(o)};Object.defineProperties(Et.prototype,{drawcalls:{get:function(){return console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups."),this.groups}},offsets:{get:function(){return console.warn("THREE.BufferGeometry: .offsets has been renamed to .groups."),this.groups}}});Sr.prototype.setDynamic=function(o){return console.warn("THREE.InterleavedBuffer: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(o===!0?yv:jp),this};Sr.prototype.setArray=function(){console.error("THREE.InterleavedBuffer: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")};gm.prototype.getArrays=function(){console.error("THREE.ExtrudeGeometry: .getArrays() has been removed.")};gm.prototype.addShapeList=function(){console.error("THREE.ExtrudeGeometry: .addShapeList() has been removed.")};gm.prototype.addShape=function(){console.error("THREE.ExtrudeGeometry: .addShape() has been removed.")};aS.prototype.dispose=function(){console.error("THREE.Scene: .dispose() has been removed.")};hx.prototype.onUpdate=function(){return console.warn("THREE.Uniform: .onUpdate() has been removed. Use object.onBeforeRender() instead."),this};Object.defineProperties(bn.prototype,{wrapAround:{get:function(){console.warn("THREE.Material: .wrapAround has been removed.")},set:function(){console.warn("THREE.Material: .wrapAround has been removed.")}},overdraw:{get:function(){console.warn("THREE.Material: .overdraw has been removed.")},set:function(){console.warn("THREE.Material: .overdraw has been removed.")}},wrapRGB:{get:function(){return console.warn("THREE.Material: .wrapRGB has been removed."),new qe}},shading:{get:function(){console.error("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead.")},set:function(o){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=o===TI}},stencilMask:{get:function(){return console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask},set:function(o){console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask=o}}});Object.defineProperties(ss.prototype,{derivatives:{get:function(){return console.warn("THREE.ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives},set:function(o){console.warn("THREE. ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives=o}}});Ht.prototype.clearTarget=function(o,e,t,n){console.warn("THREE.WebGLRenderer: .clearTarget() has been deprecated. Use .setRenderTarget() and .clear() instead."),this.setRenderTarget(o),this.clear(e,t,n)};Ht.prototype.animate=function(o){console.warn("THREE.WebGLRenderer: .animate() is now .setAnimationLoop()."),this.setAnimationLoop(o)};Ht.prototype.getCurrentRenderTarget=function(){return console.warn("THREE.WebGLRenderer: .getCurrentRenderTarget() is now .getRenderTarget()."),this.getRenderTarget()};Ht.prototype.getMaxAnisotropy=function(){return console.warn("THREE.WebGLRenderer: .getMaxAnisotropy() is now .capabilities.getMaxAnisotropy()."),this.capabilities.getMaxAnisotropy()};Ht.prototype.getPrecision=function(){return console.warn("THREE.WebGLRenderer: .getPrecision() is now .capabilities.precision."),this.capabilities.precision};Ht.prototype.resetGLState=function(){return console.warn("THREE.WebGLRenderer: .resetGLState() is now .state.reset()."),this.state.reset()};Ht.prototype.supportsFloatTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' )."),this.extensions.get("OES_texture_float")};Ht.prototype.supportsHalfFloatTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' )."),this.extensions.get("OES_texture_half_float")};Ht.prototype.supportsStandardDerivatives=function(){return console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' )."),this.extensions.get("OES_standard_derivatives")};Ht.prototype.supportsCompressedTextureS3TC=function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' )."),this.extensions.get("WEBGL_compressed_texture_s3tc")};Ht.prototype.supportsCompressedTexturePVRTC=function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' )."),this.extensions.get("WEBGL_compressed_texture_pvrtc")};Ht.prototype.supportsBlendMinMax=function(){return console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' )."),this.extensions.get("EXT_blend_minmax")};Ht.prototype.supportsVertexTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsVertexTextures() is now .capabilities.vertexTextures."),this.capabilities.vertexTextures};Ht.prototype.supportsInstancedArrays=function(){return console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' )."),this.extensions.get("ANGLE_instanced_arrays")};Ht.prototype.enableScissorTest=function(o){console.warn("THREE.WebGLRenderer: .enableScissorTest() is now .setScissorTest()."),this.setScissorTest(o)};Ht.prototype.initMaterial=function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")};Ht.prototype.addPrePlugin=function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")};Ht.prototype.addPostPlugin=function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")};Ht.prototype.updateShadowMap=function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")};Ht.prototype.setFaceCulling=function(){console.warn("THREE.WebGLRenderer: .setFaceCulling() has been removed.")};Ht.prototype.allocTextureUnit=function(){console.warn("THREE.WebGLRenderer: .allocTextureUnit() has been removed.")};Ht.prototype.setTexture=function(){console.warn("THREE.WebGLRenderer: .setTexture() has been removed.")};Ht.prototype.setTexture2D=function(){console.warn("THREE.WebGLRenderer: .setTexture2D() has been removed.")};Ht.prototype.setTextureCube=function(){console.warn("THREE.WebGLRenderer: .setTextureCube() has been removed.")};Ht.prototype.getActiveMipMapLevel=function(){return console.warn("THREE.WebGLRenderer: .getActiveMipMapLevel() is now .getActiveMipmapLevel()."),this.getActiveMipmapLevel()};Object.defineProperties(Ht.prototype,{shadowMapEnabled:{get:function(){return this.shadowMap.enabled},set:function(o){console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled."),this.shadowMap.enabled=o}},shadowMapType:{get:function(){return this.shadowMap.type},set:function(o){console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type."),this.shadowMap.type=o}},shadowMapCullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")}},context:{get:function(){return console.warn("THREE.WebGLRenderer: .context has been removed. Use .getContext() instead."),this.getContext()}},vr:{get:function(){return console.warn("THREE.WebGLRenderer: .vr has been renamed to .xr"),this.xr}},gammaInput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead."),!1},set:function(){console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead.")}},gammaOutput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),!1},set:function(o){console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),this.outputEncoding=o===!0?ed:Qh}},toneMappingWhitePoint:{get:function(){return console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed."),1},set:function(){console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed.")}}});Object.defineProperties(UD.prototype,{cullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")}},renderReverseSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")}},renderSingleSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")}}});Object.defineProperties(Wa.prototype,{wrapS:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS},set:function(o){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS=o}},wrapT:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT},set:function(o){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT=o}},magFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter},set:function(o){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter=o}},minFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter},set:function(o){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter=o}},anisotropy:{get:function(){return console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy},set:function(o){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy=o}},offset:{get:function(){return console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset},set:function(o){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset=o}},repeat:{get:function(){return console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat},set:function(o){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat=o}},format:{get:function(){return console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format},set:function(o){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format=o}},type:{get:function(){return console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type},set:function(o){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type=o}},generateMipmaps:{get:function(){return console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps},set:function(o){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps=o}}});YF.prototype.load=function(o){console.warn("THREE.Audio: .load has been deprecated. Use THREE.AudioLoader instead.");let e=this;return new XF().load(o,function(n){e.setBuffer(n)}),this};ZF.prototype.getData=function(){return console.warn("THREE.AudioAnalyser: .getData() is now .getFrequencyData()."),this.getFrequencyData()};Ov.prototype.updateCubeMap=function(o,e){return console.warn("THREE.CubeCamera: .updateCubeMap() is now .update()."),this.update(o,e)};Ov.prototype.clear=function(o,e,t,n){return console.warn("THREE.CubeCamera: .clear() is now .renderTarget.clear()."),this.renderTarget.clear(o,e,t,n)};pc.crossOrigin=void 0;pc.loadTexture=function(o,e,t,n){console.warn("THREE.ImageUtils.loadTexture has been deprecated. Use THREE.TextureLoader() instead.");let i=new nl;i.setCrossOrigin(this.crossOrigin);let r=i.load(o,t,void 0,n);return e&&(r.mapping=e),r};pc.loadTextureCube=function(o,e,t,n){console.warn("THREE.ImageUtils.loadTextureCube has been deprecated. Use THREE.CubeTextureLoader() instead.");let i=new RF;i.setCrossOrigin(this.crossOrigin);let r=i.load(o,t,void 0,n);return e&&(r.mapping=e),r};pc.loadCompressedTexture=function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")};pc.loadCompressedTextureCube=function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")};typeof __THREE_DEVTOOLS__!="undefined"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:bI}}));typeof window!="undefined"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=bI);var DS=class extends ls{constructor(e){super(e);this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(t){return new fB(t)}),this.register(function(t){return new mB(t)}),this.register(function(t){return new gB(t)}),this.register(function(t){return new pB(t)}),this.register(function(t){return new hB(t)}),this.register(function(t){return new yB(t)})}load(e,t,n,i){let r=this,s;this.resourcePath!==""?s=this.resourcePath:this.path!==""?s=this.path:s=il.extractUrlBase(e),this.manager.itemStart(e);let a=function(c){i?i(c):console.error(c),r.manager.itemError(e),r.manager.itemEnd(e)},l=new Sc(this.manager);l.setPath(this.path),l.setResponseType("arraybuffer"),l.setRequestHeader(this.requestHeader),l.setWithCredentials(this.withCredentials),l.load(e,function(c){try{r.parse(c,s,function(u){t(u),r.manager.itemEnd(e)},a)}catch(u){a(u)}},n,a)}setDRACOLoader(e){return this.dracoLoader=e,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return this.pluginCallbacks.indexOf(e)===-1&&this.pluginCallbacks.push(e),this}unregister(e){return this.pluginCallbacks.indexOf(e)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,n,i){let r,s={},a={};if(typeof e=="string")r=e;else if(il.decodeText(new Uint8Array(e,0,4))===vB){try{s[At.KHR_BINARY_GLTF]=new _B(e)}catch(d){i&&i(d);return}r=s[At.KHR_BINARY_GLTF].content}else r=il.decodeText(new Uint8Array(e));let l=JSON.parse(r);if(l.asset===void 0||l.asset.version[0]<2){i&&i(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));return}let c=new RB(l,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});c.fileLoader.setRequestHeader(this.requestHeader);for(let u=0;u<this.pluginCallbacks.length;u++){let d=this.pluginCallbacks[u](c);a[d.name]=d,s[d.name]=!0}if(l.extensionsUsed)for(let u=0;u<l.extensionsUsed.length;++u){let d=l.extensionsUsed[u],h=l.extensionsRequired||[];switch(d){case At.KHR_MATERIALS_UNLIT:s[d]=new dB;break;case At.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:s[d]=new MB;break;case At.KHR_DRACO_MESH_COMPRESSION:s[d]=new wB(l,this.dracoLoader);break;case At.KHR_TEXTURE_TRANSFORM:s[d]=new bB;break;case At.KHR_MESH_QUANTIZATION:s[d]=new SB;break;default:h.indexOf(d)>=0&&a[d]===void 0&&console.warn('THREE.GLTFLoader: Unknown extension "'+d+'".')}}c.setExtensions(s),c.setPlugins(a),c.parse(n,i)}};function fQ(){let o={};return{get:function(e){return o[e]},add:function(e,t){o[e]=t},remove:function(e){delete o[e]},removeAll:function(){o={}}}}var At={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:"KHR_materials_pbrSpecularGlossiness",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression"},hB=class{constructor(e){this.parser=e,this.name=At.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){let e=this.parser,t=this.parser.json.nodes||[];for(let n=0,i=t.length;n<i;n++){let r=t[n];r.extensions&&r.extensions[this.name]&&r.extensions[this.name].light!==void 0&&e._addNodeRef(this.cache,r.extensions[this.name].light)}}_loadLight(e){let t=this.parser,n="light:"+e,i=t.cache.get(n);if(i)return i;let r=t.json,l=((r.extensions&&r.extensions[this.name]||{}).lights||[])[e],c,u=new qe(16777215);l.color!==void 0&&u.fromArray(l.color);let d=l.range!==void 0?l.range:0;switch(l.type){case"directional":c=new ax(u),c.target.position.set(0,0,-1),c.add(c.target);break;case"point":c=new ox(u),c.distance=d;break;case"spot":c=new sx(u),c.distance=d,l.spot=l.spot||{},l.spot.innerConeAngle=l.spot.innerConeAngle!==void 0?l.spot.innerConeAngle:0,l.spot.outerConeAngle=l.spot.outerConeAngle!==void 0?l.spot.outerConeAngle:Math.PI/4,c.angle=l.spot.outerConeAngle,c.penumbra=1-l.spot.innerConeAngle/l.spot.outerConeAngle,c.target.position.set(0,0,-1),c.add(c.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+l.type)}return c.position.set(0,0,0),c.decay=2,l.intensity!==void 0&&(c.intensity=l.intensity),c.name=t.createUniqueName(l.name||"light_"+e),i=Promise.resolve(c),t.cache.add(n,i),i}createNodeAttachment(e){let t=this,n=this.parser,r=n.json.nodes[e],a=(r.extensions&&r.extensions[this.name]||{}).light;return a===void 0?null:this._loadLight(a).then(function(l){return n._getNodeRef(t.cache,a,l)})}},dB=class{constructor(){this.name=At.KHR_MATERIALS_UNLIT}getMaterialType(){return Fs}extendParams(e,t,n){let i=[];e.color=new qe(1,1,1),e.opacity=1;let r=t.pbrMetallicRoughness;if(r){if(Array.isArray(r.baseColorFactor)){let s=r.baseColorFactor;e.color.fromArray(s),e.opacity=s[3]}r.baseColorTexture!==void 0&&i.push(n.assignTexture(e,"map",r.baseColorTexture))}return Promise.all(i)}},fB=class{constructor(e){this.parser=e,this.name=At.KHR_MATERIALS_CLEARCOAT}getMaterialType(e){let n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:ym}extendMaterialParams(e,t){let n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();let r=[],s=i.extensions[this.name];if(s.clearcoatFactor!==void 0&&(t.clearcoat=s.clearcoatFactor),s.clearcoatTexture!==void 0&&r.push(n.assignTexture(t,"clearcoatMap",s.clearcoatTexture)),s.clearcoatRoughnessFactor!==void 0&&(t.clearcoatRoughness=s.clearcoatRoughnessFactor),s.clearcoatRoughnessTexture!==void 0&&r.push(n.assignTexture(t,"clearcoatRoughnessMap",s.clearcoatRoughnessTexture)),s.clearcoatNormalTexture!==void 0&&(r.push(n.assignTexture(t,"clearcoatNormalMap",s.clearcoatNormalTexture)),s.clearcoatNormalTexture.scale!==void 0)){let a=s.clearcoatNormalTexture.scale;t.clearcoatNormalScale=new Oe(a,-a)}return Promise.all(r)}},pB=class{constructor(e){this.parser=e,this.name=At.KHR_MATERIALS_TRANSMISSION}getMaterialType(e){let n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:ym}extendMaterialParams(e,t){let n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();let r=[],s=i.extensions[this.name];return s.transmissionFactor!==void 0&&(t.transmission=s.transmissionFactor),s.transmissionTexture!==void 0&&r.push(n.assignTexture(t,"transmissionMap",s.transmissionTexture)),Promise.all(r)}},mB=class{constructor(e){this.parser=e,this.name=At.KHR_TEXTURE_BASISU}loadTexture(e){let t=this.parser,n=t.json,i=n.textures[e];if(!i.extensions||!i.extensions[this.name])return null;let r=i.extensions[this.name],s=n.images[r.source],a=t.options.ktx2Loader;if(!a){if(n.extensionsRequired&&n.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return t.loadTextureImage(e,s,a)}},gB=class{constructor(e){this.parser=e,this.name=At.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(e){let t=this.name,n=this.parser,i=n.json,r=i.textures[e];if(!r.extensions||!r.extensions[t])return null;let s=r.extensions[t],a=i.images[s.source],l=n.textureLoader;if(a.uri){let c=n.options.manager.getHandler(a.uri);c!==null&&(l=c)}return this.detectSupport().then(function(c){if(c)return n.loadTextureImage(e,a,l);if(i.extensionsRequired&&i.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return n.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){let t=new Image;t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",t.onload=t.onerror=function(){e(t.height===1)}})),this.isSupported}},yB=class{constructor(e){this.name=At.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){let t=this.parser.json,n=t.bufferViews[e];if(n.extensions&&n.extensions[this.name]){let i=n.extensions[this.name],r=this.parser.getDependency("buffer",i.buffer),s=this.parser.options.meshoptDecoder;if(!s||!s.supported){if(t.extensionsRequired&&t.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return Promise.all([r,s.ready]).then(function(a){let l=i.byteOffset||0,c=i.byteLength||0,u=i.count,d=i.byteStride,h=new ArrayBuffer(u*d),f=new Uint8Array(a[0],l,c);return s.decodeGltfBuffer(new Uint8Array(h),u,d,f,i.mode,i.filter),h})}else return null}},vB="glTF",Em=12,xB={JSON:1313821514,BIN:5130562},_B=class{constructor(e){this.name=At.KHR_BINARY_GLTF,this.content=null,this.body=null;let t=new DataView(e,0,Em);if(this.header={magic:il.decodeText(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==vB)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");let n=this.header.length-Em,i=new DataView(e,Em),r=0;for(;r<n;){let s=i.getUint32(r,!0);r+=4;let a=i.getUint32(r,!0);if(r+=4,a===xB.JSON){let l=new Uint8Array(e,Em+r,s);this.content=il.decodeText(l)}else if(a===xB.BIN){let l=Em+r;this.body=e.slice(l,l+s)}r+=s}if(this.content===null)throw new Error("THREE.GLTFLoader: JSON content not found.")}},wB=class{constructor(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=At.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}decodePrimitive(e,t){let n=this.json,i=this.dracoLoader,r=e.extensions[this.name].bufferView,s=e.extensions[this.name].attributes,a={},l={},c={};for(let u in s){let d=FS[u]||u.toLowerCase();a[d]=s[u]}for(let u in e.attributes){let d=FS[u]||u.toLowerCase();if(s[u]!==void 0){let h=n.accessors[e.attributes[u]],f=Am[h.componentType];c[d]=f,l[d]=h.normalized===!0}}return t.getDependency("bufferView",r).then(function(u){return new Promise(function(d){i.decodeDracoFile(u,function(h){for(let f in h.attributes){let p=h.attributes[f],g=l[f];g!==void 0&&(p.normalized=g)}d(h)},a,c)})})}},bB=class{constructor(){this.name=At.KHR_TEXTURE_TRANSFORM}extendTexture(e,t){return e=e.clone(),t.offset!==void 0&&e.offset.fromArray(t.offset),t.rotation!==void 0&&(e.rotation=t.rotation),t.scale!==void 0&&e.repeat.fromArray(t.scale),t.texCoord!==void 0&&console.warn('THREE.GLTFLoader: Custom UV sets in "'+this.name+'" extension not yet supported.'),e.needsUpdate=!0,e}},px=class extends xc{constructor(e){super();this.isGLTFSpecularGlossinessMaterial=!0;let t=["#ifdef USE_SPECULARMAP","	uniform sampler2D specularMap;","#endif"].join(`
`),n=["#ifdef USE_GLOSSINESSMAP","	uniform sampler2D glossinessMap;","#endif"].join(`
`),i=["vec3 specularFactor = specular;","#ifdef USE_SPECULARMAP","	vec4 texelSpecular = texture2D( specularMap, vUv );","	texelSpecular = sRGBToLinear( texelSpecular );","	// reads channel RGB, compatible with a glTF Specular-Glossiness (RGBA) texture","	specularFactor *= texelSpecular.rgb;","#endif"].join(`
`),r=["float glossinessFactor = glossiness;","#ifdef USE_GLOSSINESSMAP","	vec4 texelGlossiness = texture2D( glossinessMap, vUv );","	// reads channel A, compatible with a glTF Specular-Glossiness (RGBA) texture","	glossinessFactor *= texelGlossiness.a;","#endif"].join(`
`),s=["PhysicalMaterial material;","material.diffuseColor = diffuseColor.rgb * ( 1. - max( specularFactor.r, max( specularFactor.g, specularFactor.b ) ) );","vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );","float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );","material.specularRoughness = max( 1.0 - glossinessFactor, 0.0525 ); // 0.0525 corresponds to the base mip of a 256 cubemap.","material.specularRoughness += geometryRoughness;","material.specularRoughness = min( material.specularRoughness, 1.0 );","material.specularColor = specularFactor;"].join(`
`),a={specular:{value:new qe().setHex(16777215)},glossiness:{value:1},specularMap:{value:null},glossinessMap:{value:null}};this._extraUniforms=a,this.onBeforeCompile=function(l){for(let c in a)l.uniforms[c]=a[c];l.fragmentShader=l.fragmentShader.replace("uniform float roughness;","uniform vec3 specular;").replace("uniform float metalness;","uniform float glossiness;").replace("#include <roughnessmap_pars_fragment>",t).replace("#include <metalnessmap_pars_fragment>",n).replace("#include <roughnessmap_fragment>",i).replace("#include <metalnessmap_fragment>",r).replace("#include <lights_physical_fragment>",s)},Object.defineProperties(this,{specular:{get:function(){return a.specular.value},set:function(l){a.specular.value=l}},specularMap:{get:function(){return a.specularMap.value},set:function(l){a.specularMap.value=l,l?this.defines.USE_SPECULARMAP="":delete this.defines.USE_SPECULARMAP}},glossiness:{get:function(){return a.glossiness.value},set:function(l){a.glossiness.value=l}},glossinessMap:{get:function(){return a.glossinessMap.value},set:function(l){a.glossinessMap.value=l,l?(this.defines.USE_GLOSSINESSMAP="",this.defines.USE_UV=""):(delete this.defines.USE_GLOSSINESSMAP,delete this.defines.USE_UV)}}}),delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this.setValues(e)}copy(e){return super.copy(e),this.specularMap=e.specularMap,this.specular.copy(e.specular),this.glossinessMap=e.glossinessMap,this.glossiness=e.glossiness,delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this}},MB=class{constructor(){this.name=At.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS,this.specularGlossinessParams=["color","map","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissive","emissiveIntensity","emissiveMap","bumpMap","bumpScale","normalMap","normalMapType","displacementMap","displacementScale","displacementBias","specularMap","specular","glossinessMap","glossiness","alphaMap","envMap","envMapIntensity","refractionRatio"]}getMaterialType(){return px}extendParams(e,t,n){let i=t.extensions[this.name];e.color=new qe(1,1,1),e.opacity=1;let r=[];if(Array.isArray(i.diffuseFactor)){let s=i.diffuseFactor;e.color.fromArray(s),e.opacity=s[3]}if(i.diffuseTexture!==void 0&&r.push(n.assignTexture(e,"map",i.diffuseTexture)),e.emissive=new qe(0,0,0),e.glossiness=i.glossinessFactor!==void 0?i.glossinessFactor:1,e.specular=new qe(1,1,1),Array.isArray(i.specularFactor)&&e.specular.fromArray(i.specularFactor),i.specularGlossinessTexture!==void 0){let s=i.specularGlossinessTexture;r.push(n.assignTexture(e,"glossinessMap",s)),r.push(n.assignTexture(e,"specularMap",s))}return Promise.all(r)}createMaterial(e){let t=new px(e);return t.fog=!0,t.color=e.color,t.map=e.map===void 0?null:e.map,t.lightMap=null,t.lightMapIntensity=1,t.aoMap=e.aoMap===void 0?null:e.aoMap,t.aoMapIntensity=1,t.emissive=e.emissive,t.emissiveIntensity=1,t.emissiveMap=e.emissiveMap===void 0?null:e.emissiveMap,t.bumpMap=e.bumpMap===void 0?null:e.bumpMap,t.bumpScale=1,t.normalMap=e.normalMap===void 0?null:e.normalMap,t.normalMapType=Ga,e.normalScale&&(t.normalScale=e.normalScale),t.displacementMap=null,t.displacementScale=1,t.displacementBias=0,t.specularMap=e.specularMap===void 0?null:e.specularMap,t.specular=e.specular,t.glossinessMap=e.glossinessMap===void 0?null:e.glossinessMap,t.glossiness=e.glossiness,t.alphaMap=null,t.envMap=e.envMap===void 0?null:e.envMap,t.envMapIntensity=1,t.refractionRatio=.98,t}},SB=class{constructor(){this.name=At.KHR_MESH_QUANTIZATION}},Ac=class extends os{constructor(e,t,n,i){super(e,t,n,i)}copySampleValue_(e){let t=this.resultBuffer,n=this.sampleValues,i=this.valueSize,r=e*i*3+i;for(let s=0;s!==i;s++)t[s]=n[r+s];return t}};Ac.prototype.beforeStart_=Ac.prototype.copySampleValue_;Ac.prototype.afterEnd_=Ac.prototype.copySampleValue_;Ac.prototype.interpolate_=function(o,e,t,n){let i=this.resultBuffer,r=this.sampleValues,s=this.valueSize,a=s*2,l=s*3,c=n-e,u=(t-e)/c,d=u*u,h=d*u,f=o*l,p=f-l,g=-2*h+3*d,v=h-d,y=1-g,m=v-d+u;for(let x=0;x!==s;x++){let _=r[p+x+s],w=r[p+x+a]*c,b=r[f+x+s],M=r[f+x]*c;i[x]=y*_+m*w+g*b+v*M}return i};var No={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},Am={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},TB={9728:Qn,9729:Ai,9984:uv,9985:x1,9986:hv,9987:jh},EB={33071:tr,33648:Wp,10497:dc},AB={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},FS={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv2",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},sl={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},pQ={CUBICSPLINE:void 0,LINEAR:fc,STEP:Zh},BS={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function CB(o,e){return typeof o!="string"||o===""?"":(/^https?:\/\//i.test(e)&&/^\//.test(o)&&(e=e.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(o)||/^data:.*,.*$/i.test(o)||/^blob:.*$/i.test(o)?o:e+o)}function mQ(o){return o.DefaultMaterial===void 0&&(o.DefaultMaterial=new xc({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:Wh})),o.DefaultMaterial}function Cm(o,e,t){for(let n in t.extensions)o[n]===void 0&&(e.userData.gltfExtensions=e.userData.gltfExtensions||{},e.userData.gltfExtensions[n]=t.extensions[n])}function Cc(o,e){e.extras!==void 0&&(typeof e.extras=="object"?Object.assign(o.userData,e.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+e.extras))}function gQ(o,e,t){let n=!1,i=!1;for(let a=0,l=e.length;a<l;a++){let c=e[a];if(c.POSITION!==void 0&&(n=!0),c.NORMAL!==void 0&&(i=!0),n&&i)break}if(!n&&!i)return Promise.resolve(o);let r=[],s=[];for(let a=0,l=e.length;a<l;a++){let c=e[a];if(n){let u=c.POSITION!==void 0?t.getDependency("accessor",c.POSITION):o.attributes.position;r.push(u)}if(i){let u=c.NORMAL!==void 0?t.getDependency("accessor",c.NORMAL):o.attributes.normal;s.push(u)}}return Promise.all([Promise.all(r),Promise.all(s)]).then(function(a){let l=a[0],c=a[1];return n&&(o.morphAttributes.position=l),i&&(o.morphAttributes.normal=c),o.morphTargetsRelative=!0,o})}function yQ(o,e){if(o.updateMorphTargets(),e.weights!==void 0)for(let t=0,n=e.weights.length;t<n;t++)o.morphTargetInfluences[t]=e.weights[t];if(e.extras&&Array.isArray(e.extras.targetNames)){let t=e.extras.targetNames;if(o.morphTargetInfluences.length===t.length){o.morphTargetDictionary={};for(let n=0,i=t.length;n<i;n++)o.morphTargetDictionary[t[n]]=n}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function vQ(o){let e=o.extensions&&o.extensions[At.KHR_DRACO_MESH_COMPRESSION],t;return e?t="draco:"+e.bufferView+":"+e.indices+":"+LB(e.attributes):t=o.indices+":"+LB(o.attributes)+":"+o.mode,t}function LB(o){let e="",t=Object.keys(o).sort();for(let n=0,i=t.length;n<i;n++)e+=t[n]+":"+o[t[n]]+";";return e}function NS(o){switch(o){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}var RB=class{constructor(e={},t={}){this.json=e,this.extensions={},this.plugins={},this.options=t,this.cache=new fQ,this.associations=new Map,this.primitiveCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.nodeNamesUsed={},typeof createImageBitmap!="undefined"&&/Firefox/.test(navigator.userAgent)===!1?this.textureLoader=new cx(this.options.manager):this.textureLoader=new nl(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new Sc(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,t){let n=this,i=this.json,r=this.extensions;this.cache.removeAll(),this._invokeAll(function(s){return s._markDefs&&s._markDefs()}),Promise.all(this._invokeAll(function(s){return s.beforeRoot&&s.beforeRoot()})).then(function(){return Promise.all([n.getDependencies("scene"),n.getDependencies("animation"),n.getDependencies("camera")])}).then(function(s){let a={scene:s[0][i.scene||0],scenes:s[0],animations:s[1],cameras:s[2],asset:i.asset,parser:n,userData:{}};Cm(r,a,i),Cc(a,i),Promise.all(n._invokeAll(function(l){return l.afterRoot&&l.afterRoot(a)})).then(function(){e(a)})}).catch(t)}_markDefs(){let e=this.json.nodes||[],t=this.json.skins||[],n=this.json.meshes||[];for(let i=0,r=t.length;i<r;i++){let s=t[i].joints;for(let a=0,l=s.length;a<l;a++)e[s[a]].isBone=!0}for(let i=0,r=e.length;i<r;i++){let s=e[i];s.mesh!==void 0&&(this._addNodeRef(this.meshCache,s.mesh),s.skin!==void 0&&(n[s.mesh].isSkinnedMesh=!0)),s.camera!==void 0&&this._addNodeRef(this.cameraCache,s.camera)}}_addNodeRef(e,t){t!==void 0&&(e.refs[t]===void 0&&(e.refs[t]=e.uses[t]=0),e.refs[t]++)}_getNodeRef(e,t,n){if(e.refs[t]<=1)return n;let i=n.clone();return i.name+="_instance_"+e.uses[t]++,i}_invokeOne(e){let t=Object.values(this.plugins);t.push(this);for(let n=0;n<t.length;n++){let i=e(t[n]);if(i)return i}return null}_invokeAll(e){let t=Object.values(this.plugins);t.unshift(this);let n=[];for(let i=0;i<t.length;i++){let r=e(t[i]);r&&n.push(r)}return n}getDependency(e,t){let n=e+":"+t,i=this.cache.get(n);if(!i){switch(e){case"scene":i=this.loadScene(t);break;case"node":i=this.loadNode(t);break;case"mesh":i=this._invokeOne(function(r){return r.loadMesh&&r.loadMesh(t)});break;case"accessor":i=this.loadAccessor(t);break;case"bufferView":i=this._invokeOne(function(r){return r.loadBufferView&&r.loadBufferView(t)});break;case"buffer":i=this.loadBuffer(t);break;case"material":i=this._invokeOne(function(r){return r.loadMaterial&&r.loadMaterial(t)});break;case"texture":i=this._invokeOne(function(r){return r.loadTexture&&r.loadTexture(t)});break;case"skin":i=this.loadSkin(t);break;case"animation":i=this.loadAnimation(t);break;case"camera":i=this.loadCamera(t);break;default:throw new Error("Unknown type: "+e)}this.cache.add(n,i)}return i}getDependencies(e){let t=this.cache.get(e);if(!t){let n=this,i=this.json[e+(e==="mesh"?"es":"s")]||[];t=Promise.all(i.map(function(r,s){return n.getDependency(e,s)})),this.cache.add(e,t)}return t}loadBuffer(e){let t=this.json.buffers[e],n=this.fileLoader;if(t.type&&t.type!=="arraybuffer")throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(t.uri===void 0&&e===0)return Promise.resolve(this.extensions[At.KHR_BINARY_GLTF].body);let i=this.options;return new Promise(function(r,s){n.load(CB(t.uri,i.path),r,void 0,function(){s(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))})})}loadBufferView(e){let t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then(function(n){let i=t.byteLength||0,r=t.byteOffset||0;return n.slice(r,r+i)})}loadAccessor(e){let t=this,n=this.json,i=this.json.accessors[e];if(i.bufferView===void 0&&i.sparse===void 0)return Promise.resolve(null);let r=[];return i.bufferView!==void 0?r.push(this.getDependency("bufferView",i.bufferView)):r.push(null),i.sparse!==void 0&&(r.push(this.getDependency("bufferView",i.sparse.indices.bufferView)),r.push(this.getDependency("bufferView",i.sparse.values.bufferView))),Promise.all(r).then(function(s){let a=s[0],l=AB[i.type],c=Am[i.componentType],u=c.BYTES_PER_ELEMENT,d=u*l,h=i.byteOffset||0,f=i.bufferView!==void 0?n.bufferViews[i.bufferView].byteStride:void 0,p=i.normalized===!0,g,v;if(f&&f!==d){let y=Math.floor(h/f),m="InterleavedBuffer:"+i.bufferView+":"+i.componentType+":"+y+":"+i.count,x=t.cache.get(m);x||(g=new c(a,y*f,i.count*f/u),x=new Sr(g,f/u),t.cache.add(m,x)),v=new ks(x,l,h%f/u,p)}else a===null?g=new c(i.count*l):g=new c(a,h,i.count*l),v=new jt(g,l,p);if(i.sparse!==void 0){let y=AB.SCALAR,m=Am[i.sparse.indices.componentType],x=i.sparse.indices.byteOffset||0,_=i.sparse.values.byteOffset||0,w=new m(s[1],x,i.sparse.count*y),b=new c(s[2],_,i.sparse.count*l);a!==null&&(v=new jt(v.array.slice(),v.itemSize,v.normalized));for(let M=0,S=w.length;M<S;M++){let E=w[M];if(v.setX(E,b[M*l]),l>=2&&v.setY(E,b[M*l+1]),l>=3&&v.setZ(E,b[M*l+2]),l>=4&&v.setW(E,b[M*l+3]),l>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return v})}loadTexture(e){let t=this.json,n=this.options,i=t.textures[e],r=t.images[i.source],s=this.textureLoader;if(r.uri){let a=n.manager.getHandler(r.uri);a!==null&&(s=a)}return this.loadTextureImage(e,r,s)}loadTextureImage(e,t,n){let i=this,r=this.json,s=this.options,a=r.textures[e],l=self.URL||self.webkitURL,c=t.uri,u=!1,d=!0;if(t.mimeType==="image/jpeg"&&(d=!1),t.bufferView!==void 0)c=i.getDependency("bufferView",t.bufferView).then(function(h){if(t.mimeType==="image/png"){let p=new DataView(h,25,1).getUint8(0,!1);d=p===6||p===4||p===3}u=!0;let f=new Blob([h],{type:t.mimeType});return c=l.createObjectURL(f),c});else if(t.uri===void 0)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");return Promise.resolve(c).then(function(h){return new Promise(function(f,p){let g=f;n.isImageBitmapLoader===!0&&(g=function(v){f(new Md(v))}),n.load(CB(h,s.path),g,void 0,p)})}).then(function(h){u===!0&&l.revokeObjectURL(c),h.flipY=!1,a.name&&(h.name=a.name),d||(h.format=Lo);let p=(r.samplers||{})[a.sampler]||{};return h.magFilter=TB[p.magFilter]||Ai,h.minFilter=TB[p.minFilter]||jh,h.wrapS=EB[p.wrapS]||dc,h.wrapT=EB[p.wrapT]||dc,i.associations.set(h,{type:"textures",index:e}),h})}assignTexture(e,t,n){let i=this;return this.getDependency("texture",n.index).then(function(r){if(n.texCoord!==void 0&&n.texCoord!=0&&!(t==="aoMap"&&n.texCoord==1)&&console.warn("THREE.GLTFLoader: Custom UV set "+n.texCoord+" for texture "+t+" not yet supported."),i.extensions[At.KHR_TEXTURE_TRANSFORM]){let s=n.extensions!==void 0?n.extensions[At.KHR_TEXTURE_TRANSFORM]:void 0;if(s){let a=i.associations.get(r);r=i.extensions[At.KHR_TEXTURE_TRANSFORM].extendTexture(r,s),i.associations.set(r,a)}}e[t]=r})}assignFinalMaterial(e){let t=e.geometry,n=e.material,i=t.attributes.tangent!==void 0,r=t.attributes.color!==void 0,s=t.attributes.normal===void 0,a=e.isSkinnedMesh===!0,l=Object.keys(t.morphAttributes).length>0,c=l&&t.morphAttributes.normal!==void 0;if(e.isPoints){let u="PointsMaterial:"+n.uuid,d=this.cache.get(u);d||(d=new dm,bn.prototype.copy.call(d,n),d.color.copy(n.color),d.map=n.map,d.sizeAttenuation=!1,this.cache.add(u,d)),n=d}else if(e.isLine){let u="LineBasicMaterial:"+n.uuid,d=this.cache.get(u);d||(d=new Qa,bn.prototype.copy.call(d,n),d.color.copy(n.color),this.cache.add(u,d)),n=d}if(i||r||s||a||l){let u="ClonedMaterial:"+n.uuid+":";n.isGLTFSpecularGlossinessMaterial&&(u+="specular-glossiness:"),a&&(u+="skinning:"),i&&(u+="vertex-tangents:"),r&&(u+="vertex-colors:"),s&&(u+="flat-shading:"),l&&(u+="morph-targets:"),c&&(u+="morph-normals:");let d=this.cache.get(u);d||(d=n.clone(),a&&(d.skinning=!0),r&&(d.vertexColors=!0),s&&(d.flatShading=!0),l&&(d.morphTargets=!0),c&&(d.morphNormals=!0),i&&(d.vertexTangents=!0,d.normalScale&&(d.normalScale.y*=-1),d.clearcoatNormalScale&&(d.clearcoatNormalScale.y*=-1)),this.cache.add(u,d),this.associations.set(d,this.associations.get(n))),n=d}n.aoMap&&t.attributes.uv2===void 0&&t.attributes.uv!==void 0&&t.setAttribute("uv2",t.attributes.uv),e.material=n}getMaterialType(){return xc}loadMaterial(e){let t=this,n=this.json,i=this.extensions,r=n.materials[e],s,a={},l=r.extensions||{},c=[];if(l[At.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]){let d=i[At.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS];s=d.getMaterialType(),c.push(d.extendParams(a,r,t))}else if(l[At.KHR_MATERIALS_UNLIT]){let d=i[At.KHR_MATERIALS_UNLIT];s=d.getMaterialType(),c.push(d.extendParams(a,r,t))}else{let d=r.pbrMetallicRoughness||{};if(a.color=new qe(1,1,1),a.opacity=1,Array.isArray(d.baseColorFactor)){let h=d.baseColorFactor;a.color.fromArray(h),a.opacity=h[3]}d.baseColorTexture!==void 0&&c.push(t.assignTexture(a,"map",d.baseColorTexture)),a.metalness=d.metallicFactor!==void 0?d.metallicFactor:1,a.roughness=d.roughnessFactor!==void 0?d.roughnessFactor:1,d.metallicRoughnessTexture!==void 0&&(c.push(t.assignTexture(a,"metalnessMap",d.metallicRoughnessTexture)),c.push(t.assignTexture(a,"roughnessMap",d.metallicRoughnessTexture))),s=this._invokeOne(function(h){return h.getMaterialType&&h.getMaterialType(e)}),c.push(Promise.all(this._invokeAll(function(h){return h.extendMaterialParams&&h.extendMaterialParams(e,a)})))}r.doubleSided===!0&&(a.side=Xh);let u=r.alphaMode||BS.OPAQUE;return u===BS.BLEND?(a.transparent=!0,a.depthWrite=!1):(a.transparent=!1,u===BS.MASK&&(a.alphaTest=r.alphaCutoff!==void 0?r.alphaCutoff:.5)),r.normalTexture!==void 0&&s!==Fs&&(c.push(t.assignTexture(a,"normalMap",r.normalTexture)),a.normalScale=new Oe(1,-1),r.normalTexture.scale!==void 0&&a.normalScale.set(r.normalTexture.scale,-r.normalTexture.scale)),r.occlusionTexture!==void 0&&s!==Fs&&(c.push(t.assignTexture(a,"aoMap",r.occlusionTexture)),r.occlusionTexture.strength!==void 0&&(a.aoMapIntensity=r.occlusionTexture.strength)),r.emissiveFactor!==void 0&&s!==Fs&&(a.emissive=new qe().fromArray(r.emissiveFactor)),r.emissiveTexture!==void 0&&s!==Fs&&c.push(t.assignTexture(a,"emissiveMap",r.emissiveTexture)),Promise.all(c).then(function(){let d;return s===px?d=i[At.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].createMaterial(a):d=new s(a),r.name&&(d.name=r.name),d.map&&(d.map.encoding=ed),d.emissiveMap&&(d.emissiveMap.encoding=ed),Cc(d,r),t.associations.set(d,{type:"materials",index:e}),r.extensions&&Cm(i,d,r),d})}createUniqueName(e){let t=yt.sanitizeNodeName(e||""),n=t;for(let i=1;this.nodeNamesUsed[n];++i)n=t+"_"+i;return this.nodeNamesUsed[n]=!0,n}loadGeometries(e){let t=this,n=this.extensions,i=this.primitiveCache;function r(a){return n[At.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(a,t).then(function(l){return IB(l,a,t)})}let s=[];for(let a=0,l=e.length;a<l;a++){let c=e[a],u=vQ(c),d=i[u];if(d)s.push(d.promise);else{let h;c.extensions&&c.extensions[At.KHR_DRACO_MESH_COMPRESSION]?h=r(c):h=IB(new Et,c,t),i[u]={primitive:c,promise:h},s.push(h)}}return Promise.all(s)}loadMesh(e){let t=this,n=this.json,i=this.extensions,r=n.meshes[e],s=r.primitives,a=[];for(let l=0,c=s.length;l<c;l++){let u=s[l].material===void 0?mQ(this.cache):this.getDependency("material",s[l].material);a.push(u)}return a.push(t.loadGeometries(s)),Promise.all(a).then(function(l){let c=l.slice(0,l.length-1),u=l[l.length-1],d=[];for(let f=0,p=u.length;f<p;f++){let g=u[f],v=s[f],y,m=c[f];if(v.mode===No.TRIANGLES||v.mode===No.TRIANGLE_STRIP||v.mode===No.TRIANGLE_FAN||v.mode===void 0)y=r.isSkinnedMesh===!0?new lm(g,m):new Vn(g,m),y.isSkinnedMesh===!0&&!y.geometry.attributes.skinWeight.normalized&&y.normalizeSkinWeights(),v.mode===No.TRIANGLE_STRIP?y.geometry=DB(y.geometry,gv):v.mode===No.TRIANGLE_FAN&&(y.geometry=DB(y.geometry,$h));else if(v.mode===No.LINES)y=new bd(g,m);else if(v.mode===No.LINE_STRIP)y=new wd(g,m);else if(v.mode===No.LINE_LOOP)y=new jv(g,m);else if(v.mode===No.POINTS)y=new Jv(g,m);else throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+v.mode);Object.keys(y.geometry.morphAttributes).length>0&&yQ(y,r),y.name=t.createUniqueName(r.name||"mesh_"+e),Cc(y,r),v.extensions&&Cm(i,y,v),t.assignFinalMaterial(y),d.push(y)}if(d.length===1)return d[0];let h=new Os;for(let f=0,p=d.length;f<p;f++)h.add(d[f]);return h})}loadCamera(e){let t,n=this.json.cameras[e],i=n[n.type];if(!i){console.warn("THREE.GLTFLoader: Missing camera parameters.");return}return n.type==="perspective"?t=new yi(tD.radToDeg(i.yfov),i.aspectRatio||1,i.znear||1,i.zfar||2e6):n.type==="orthographic"&&(t=new Tm(-i.xmag,i.xmag,i.ymag,-i.ymag,i.znear,i.zfar)),n.name&&(t.name=this.createUniqueName(n.name)),Cc(t,n),Promise.resolve(t)}loadSkin(e){let t=this.json.skins[e],n={joints:t.joints};return t.inverseBindMatrices===void 0?Promise.resolve(n):this.getDependency("accessor",t.inverseBindMatrices).then(function(i){return n.inverseBindMatrices=i,n})}loadAnimation(e){let n=this.json.animations[e],i=[],r=[],s=[],a=[],l=[];for(let c=0,u=n.channels.length;c<u;c++){let d=n.channels[c],h=n.samplers[d.sampler],f=d.target,p=f.node!==void 0?f.node:f.id,g=n.parameters!==void 0?n.parameters[h.input]:h.input,v=n.parameters!==void 0?n.parameters[h.output]:h.output;i.push(this.getDependency("node",p)),r.push(this.getDependency("accessor",g)),s.push(this.getDependency("accessor",v)),a.push(h),l.push(f)}return Promise.all([Promise.all(i),Promise.all(r),Promise.all(s),Promise.all(a),Promise.all(l)]).then(function(c){let u=c[0],d=c[1],h=c[2],f=c[3],p=c[4],g=[];for(let y=0,m=u.length;y<m;y++){let x=u[y],_=d[y],w=h[y],b=f[y],M=p[y];if(x===void 0)continue;x.updateMatrix(),x.matrixAutoUpdate=!0;let S;switch(sl[M.path]){case sl.weights:S=wc;break;case sl.rotation:S=tl;break;case sl.position:case sl.scale:default:S=Mc;break}let E=x.name?x.name:x.uuid,A=b.interpolation!==void 0?pQ[b.interpolation]:fc,L=[];sl[M.path]===sl.weights?x.traverse(function(R){R.isMesh===!0&&R.morphTargetInfluences&&L.push(R.name?R.name:R.uuid)}):L.push(E);let B=w.array;if(w.normalized){let R=NS(B.constructor),D=new Float32Array(B.length);for(let P=0,I=B.length;P<I;P++)D[P]=B[P]*R;B=D}for(let R=0,D=L.length;R<D;R++){let P=new S(L[R]+"."+sl[M.path],_.array,B,A);b.interpolation==="CUBICSPLINE"&&(P.createInterpolant=function(N){return new Ac(this.times,this.values,this.getValueSize()/3,N)},P.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),g.push(P)}}let v=n.name?n.name:"animation_"+e;return new vm(v,void 0,g)})}createNodeMesh(e){let t=this.json,n=this,i=t.nodes[e];return i.mesh===void 0?null:n.getDependency("mesh",i.mesh).then(function(r){let s=n._getNodeRef(n.meshCache,i.mesh,r);return i.weights!==void 0&&s.traverse(function(a){if(!!a.isMesh)for(let l=0,c=i.weights.length;l<c;l++)a.morphTargetInfluences[l]=i.weights[l]}),s})}loadNode(e){let t=this.json,n=this.extensions,i=this,r=t.nodes[e],s=r.name?i.createUniqueName(r.name):"";return function(){let a=[],l=i._invokeOne(function(c){return c.createNodeMesh&&c.createNodeMesh(e)});return l&&a.push(l),r.camera!==void 0&&a.push(i.getDependency("camera",r.camera).then(function(c){return i._getNodeRef(i.cameraCache,r.camera,c)})),i._invokeAll(function(c){return c.createNodeAttachment&&c.createNodeAttachment(e)}).forEach(function(c){a.push(c)}),Promise.all(a)}().then(function(a){let l;if(r.isBone===!0?l=new cm:a.length>1?l=new Os:a.length===1?l=a[0]:l=new ot,l!==a[0])for(let c=0,u=a.length;c<u;c++)l.add(a[c]);if(r.name&&(l.userData.name=r.name,l.name=s),Cc(l,r),r.extensions&&Cm(n,l,r),r.matrix!==void 0){let c=new Ze;c.fromArray(r.matrix),l.applyMatrix4(c)}else r.translation!==void 0&&l.position.fromArray(r.translation),r.rotation!==void 0&&l.quaternion.fromArray(r.rotation),r.scale!==void 0&&l.scale.fromArray(r.scale);return i.associations.set(l,{type:"nodes",index:e}),l})}loadScene(e){let t=this.json,n=this.extensions,i=this.json.scenes[e],r=this,s=new Os;i.name&&(s.name=r.createUniqueName(i.name)),Cc(s,i),i.extensions&&Cm(n,s,i);let a=i.nodes||[],l=[];for(let c=0,u=a.length;c<u;c++)l.push(PB(a[c],s,t,r));return Promise.all(l).then(function(){return s})}};function PB(o,e,t,n){let i=t.nodes[o];return n.getDependency("node",o).then(function(r){if(i.skin===void 0)return r;let s;return n.getDependency("skin",i.skin).then(function(a){s=a;let l=[];for(let c=0,u=s.joints.length;c<u;c++)l.push(n.getDependency("node",s.joints[c]));return Promise.all(l)}).then(function(a){return r.traverse(function(l){if(!l.isMesh)return;let c=[],u=[];for(let d=0,h=a.length;d<h;d++){let f=a[d];if(f){c.push(f);let p=new Ze;s.inverseBindMatrices!==void 0&&p.fromArray(s.inverseBindMatrices.array,d*16),u.push(p)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',s.joints[d])}l.bind(new um(c,u),l.matrixWorld)}),r})}).then(function(r){e.add(r);let s=[];if(i.children){let a=i.children;for(let l=0,c=a.length;l<c;l++){let u=a[l];s.push(PB(u,r,t,n))}}return Promise.all(s)})}function xQ(o,e,t){let n=e.attributes,i=new Li;if(n.POSITION!==void 0){let a=t.json.accessors[n.POSITION],l=a.min,c=a.max;if(l!==void 0&&c!==void 0){if(i.set(new ae(l[0],l[1],l[2]),new ae(c[0],c[1],c[2])),a.normalized){let u=NS(Am[a.componentType]);i.min.multiplyScalar(u),i.max.multiplyScalar(u)}}else{console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");return}}else return;let r=e.targets;if(r!==void 0){let a=new ae,l=new ae;for(let c=0,u=r.length;c<u;c++){let d=r[c];if(d.POSITION!==void 0){let h=t.json.accessors[d.POSITION],f=h.min,p=h.max;if(f!==void 0&&p!==void 0){if(l.setX(Math.max(Math.abs(f[0]),Math.abs(p[0]))),l.setY(Math.max(Math.abs(f[1]),Math.abs(p[1]))),l.setZ(Math.max(Math.abs(f[2]),Math.abs(p[2]))),h.normalized){let g=NS(Am[h.componentType]);l.multiplyScalar(g)}a.max(l)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}i.expandByVector(a)}o.boundingBox=i;let s=new Po;i.getCenter(s.center),s.radius=i.min.distanceTo(i.max)/2,o.boundingSphere=s}function IB(o,e,t){let n=e.attributes,i=[];function r(s,a){return t.getDependency("accessor",s).then(function(l){o.setAttribute(a,l)})}for(let s in n){let a=FS[s]||s.toLowerCase();a in o.attributes||i.push(r(n[s],a))}if(e.indices!==void 0&&!o.index){let s=t.getDependency("accessor",e.indices).then(function(a){o.setIndex(a)});i.push(s)}return Cc(o,e),xQ(o,e,t),Promise.all(i).then(function(){return e.targets!==void 0?gQ(o,e.targets,t):o})}function DB(o,e){let t=o.getIndex();if(t===null){let s=[],a=o.getAttribute("position");if(a!==void 0){for(let l=0;l<a.count;l++)s.push(l);o.setIndex(s),t=o.getIndex()}else return console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),o}let n=t.count-2,i=[];if(e===$h)for(let s=1;s<=n;s++)i.push(t.getX(0)),i.push(t.getX(s)),i.push(t.getX(s+1));else for(let s=0;s<n;s++)s%2==0?(i.push(t.getX(s)),i.push(t.getX(s+1)),i.push(t.getX(s+2))):(i.push(t.getX(s+2)),i.push(t.getX(s+1)),i.push(t.getX(s)));i.length/3!==n&&console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");let r=o.clone();return r.setIndex(i),r}function Oo(o){if(o===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return o}function FB(o,e){o.prototype=Object.create(e.prototype),o.prototype.constructor=o,o.__proto__=e}var Pi={autoSleep:120,force3D:"auto",nullTargetWarn:1,units:{lineHeight:""}},Cd={duration:.5,overwrite:!1,delay:0},OS,Us=1e8,Ft=1/Us,kS=Math.PI*2,_Q=kS/4,wQ=0,BB=Math.sqrt,bQ=Math.cos,MQ=Math.sin,ti=function(e){return typeof e=="string"},Wn=function(e){return typeof e=="function"},ko=function(e){return typeof e=="number"},mx=function(e){return typeof e=="undefined"},zo=function(e){return typeof e=="object"},zi=function(e){return e!==!1},NB=function(){return typeof window!="undefined"},OB=function(e){return Wn(e)||ti(e)},kB=typeof ArrayBuffer=="function"&&ArrayBuffer.isView||function(){},or=Array.isArray,zS=/(?:-?\.?\d|\.)+/gi,US=/[-+=.]*\d+[.e\-+]*\d*[e\-+]*\d*/g,Lc=/[-+=.]*\d+[.e-]*\d*[a-z%]*/g,HS=/[-+=.]*\d+\.?\d*(?:e-|e\+)?\d*/gi,GS=/[+-]=-?[.\d]+/,zB=/[^,'"\[\]\s]+/gi,SQ=/[\d.+\-=]+(?:e[-+]\d*)*/i,on,Hs,VS,WS,ar={},gx={},UB,HB=function(e){return(gx=Rd(e,ar))&&Lr},yx=function(e,t){return console.warn("Invalid property",e,"set to",t,"Missing plugin? gsap.registerPlugin()")},vx=function(e,t){return!t&&console.warn(e)},GB=function(e,t){return e&&(ar[e]=t)&&gx&&(gx[e]=t)||ar},Ld=function(){return 0},XS={},ol=[],qS={},VB,Ui={},jS={},WB=30,xx=[],YS="",ZS=function(e){var t=e[0],n,i;if(zo(t)||Wn(t)||(e=[e]),!(n=(t._gsap||{}).harness)){for(i=xx.length;i--&&!xx[i].targetTest(t););n=xx[i]}for(i=e.length;i--;)e[i]&&(e[i]._gsap||(e[i]._gsap=new oT(e[i],n)))||e.splice(i,1);return e},al=function(e){return e._gsap||ZS(Ar(e))[0]._gsap},JS=function(e,t,n){return(n=e[t])&&Wn(n)?e[t]():mx(n)&&e.getAttribute&&e.getAttribute(t)||n},Hi=function(e,t){return(e=e.split(",")).forEach(t)||e},mt=function(e){return Math.round(e*1e5)/1e5||0},TQ=function(e,t){for(var n=t.length,i=0;e.indexOf(t[i])<0&&++i<n;);return i<n},_x=function(){var e=ol.length,t=ol.slice(0),n,i;for(qS={},ol.length=0,n=0;n<e;n++)i=t[n],i&&i._lazy&&(i.render(i._lazy[0],i._lazy[1],!0)._lazy=0)},XB=function(e,t,n,i){ol.length&&_x(),e.render(t,n,i),ol.length&&_x()},qB=function(e){var t=parseFloat(e);return(t||t===0)&&(e+"").match(zB).length<2?t:ti(e)?e.trim():e},jB=function(e){return e},Tr=function(e,t){for(var n in t)n in e||(e[n]=t[n]);return e},EQ=function(e,t){for(var n in t)n in e||n==="duration"||n==="ease"||(e[n]=t[n])},Rd=function(e,t){for(var n in t)e[n]=t[n];return e},YB=function o(e,t){for(var n in t)n!=="__proto__"&&n!=="constructor"&&n!=="prototype"&&(e[n]=zo(t[n])?o(e[n]||(e[n]={}),t[n]):t[n]);return e},KS=function(e,t){var n={},i;for(i in e)i in t||(n[i]=e[i]);return n},wx=function(e){var t=e.parent||on,n=e.keyframes?EQ:Tr;if(zi(e.inherit))for(;t;)n(e,t.vars.defaults),t=t.parent||t._dp;return e},AQ=function(e,t){for(var n=e.length,i=n===t.length;i&&n--&&e[n]===t[n];);return n<0},CQ=function(e,t,n,i,r){n===void 0&&(n="_first"),i===void 0&&(i="_last");var s=e[i],a;if(r)for(a=t[r];s&&s[r]>a;)s=s._prev;return s?(t._next=s._next,s._next=t):(t._next=e[n],e[n]=t),t._next?t._next._prev=t:e[i]=t,t._prev=s,t.parent=t._dp=e,t},bx=function(e,t,n,i){n===void 0&&(n="_first"),i===void 0&&(i="_last");var r=t._prev,s=t._next;r?r._next=s:e[n]===t&&(e[n]=s),s?s._prev=r:e[i]===t&&(e[i]=r),t._next=t._prev=t.parent=null},ll=function(e,t){e.parent&&(!t||e.parent.autoRemoveChildren)&&e.parent.remove(e),e._act=0},Rc=function(e,t){if(e&&(!t||t._end>e._dur||t._start<0))for(var n=e;n;)n._dirty=1,n=n.parent;return e},LQ=function(e){for(var t=e.parent;t&&t.parent;)t._dirty=1,t.totalDuration(),t=t.parent;return e},RQ=function o(e){return!e||e._ts&&o(e.parent)},ZB=function(e){return e._repeat?Pd(e._tTime,e=e.duration()+e._rDelay)*e:0},Pd=function(e,t){var n=Math.floor(e/=t);return e&&n===e?n-1:n},Mx=function(e,t){return(e-t._start)*t._ts+(t._ts>=0?0:t._dirty?t.totalDuration():t._tDur)},$S=function(e){return e._end=mt(e._start+(e._tDur/Math.abs(e._ts||e._rts||Ft)||0))},JB=function(e,t){var n=e._dp;return n&&n.smoothChildTiming&&e._ts&&(e._start=mt(n._time-(e._ts>0?t/e._ts:((e._dirty?e.totalDuration():e._tDur)-t)/-e._ts)),$S(e),n._dirty||Rc(n,e)),e},KB=function(e,t){var n;if((t._time||t._initted&&!t._dur)&&(n=Mx(e.rawTime(),t),(!t._dur||Rm(0,t.totalDuration(),n)-t._tTime>Ft)&&t.render(n,!0)),Rc(e,t)._dp&&e._initted&&e._time>=e._dur&&e._ts){if(e._dur<e.duration())for(n=e;n._dp;)n.rawTime()>=0&&n.totalTime(n._tTime),n=n._dp;e._zTime=-Ft}},Gs=function(e,t,n,i){return t.parent&&ll(t),t._start=mt((ko(n)?n:n||e!==on?Er(e,n,t):e._time)+t._delay),t._end=mt(t._start+(t.totalDuration()/Math.abs(t.timeScale())||0)),CQ(e,t,"_first","_last",e._sort?"_start":0),QS(t)||(e._recent=t),i||KB(e,t),e},$B=function(e,t){return(ar.ScrollTrigger||yx("scrollTrigger",t))&&ar.ScrollTrigger.create(t,e)},QB=function(e,t,n,i){if(QQ(e,t),!e._initted)return 1;if(!n&&e._pt&&(e._dur&&e.vars.lazy!==!1||!e._dur&&e.vars.lazy)&&VB!==lr.frame)return ol.push(e),e._lazy=[t,i],1},PQ=function o(e){var t=e.parent;return t&&t._ts&&t._initted&&!t._lock&&(t.rawTime()<0||o(t))},QS=function(e){var t=e.data;return t==="isFromStart"||t==="isStart"},IQ=function(e,t,n,i){var r=e.ratio,s=t<0||!t&&(!e._start&&PQ(e)&&!(!e._initted&&QS(e))||(e._ts<0||e._dp._ts<0)&&!QS(e))?0:1,a=e._rDelay,l=0,c,u,d;if(a&&e._repeat&&(l=Rm(0,e._tDur,t),u=Pd(l,a),d=Pd(e._tTime,a),e._yoyo&&u&1&&(s=1-s),u!==d&&(r=1-s,e.vars.repeatRefresh&&e._initted&&e.invalidate())),s!==r||i||e._zTime===Ft||!t&&e._zTime){if(!e._initted&&QB(e,t,i,n))return;for(d=e._zTime,e._zTime=t||(n?Ft:0),n||(n=t&&!d),e.ratio=s,e._from&&(s=1-s),e._time=0,e._tTime=l,c=e._pt;c;)c.r(s,c.d),c=c._next;e._startAt&&t<0&&e._startAt.render(t,!0,!0),e._onUpdate&&!n&&Cr(e,"onUpdate"),l&&e._repeat&&!n&&e.parent&&Cr(e,"onRepeat"),(t>=e._tDur||t<0)&&e.ratio===s&&(s&&ll(e,1),n||(Cr(e,s?"onComplete":"onReverseComplete",!0),e._prom&&e._prom()))}else e._zTime||(e._zTime=t)},DQ=function(e,t,n){var i;if(n>t)for(i=e._first;i&&i._start<=n;){if(!i._dur&&i.data==="isPause"&&i._start>t)return i;i=i._next}else for(i=e._last;i&&i._start>=n;){if(!i._dur&&i.data==="isPause"&&i._start<t)return i;i=i._prev}},Id=function(e,t,n,i){var r=e._repeat,s=mt(t)||0,a=e._tTime/e._tDur;return a&&!i&&(e._time*=s/e._dur),e._dur=s,e._tDur=r?r<0?1e10:mt(s*(r+1)+e._rDelay*r):s,a&&!i?JB(e,e._tTime=e._tDur*a):e.parent&&$S(e),n||Rc(e.parent,e),e},eN=function(e){return e instanceof xi?Rc(e):Id(e,e._dur)},FQ={_start:0,endTime:Ld,totalDuration:Ld},Er=function o(e,t,n){var i=e.labels,r=e._recent||FQ,s=e.duration()>=Us?r.endTime(!1):e._dur,a,l,c;return ti(t)&&(isNaN(t)||t in i)?(l=t.charAt(0),c=t.substr(-1)==="%",a=t.indexOf("="),l==="<"||l===">"?(a>=0&&(t=t.replace(/=/,"")),(l==="<"?r._start:r.endTime(r._repeat>=0))+(parseFloat(t.substr(1))||0)*(c?(a<0?r:n).totalDuration()/100:1)):a<0?(t in i||(i[t]=s),i[t]):(l=parseFloat(t.charAt(a-1)+t.substr(a+1)),c&&n&&(l=l/100*(or(n)?n[0]:n).totalDuration()),a>1?o(e,t.substr(0,a-1),n)+l:s+l)):t==null?s:+t},Lm=function(e,t,n){var i=ko(t[1]),r=(i?2:1)+(e<2?0:1),s=t[r],a,l;if(i&&(s.duration=t[1]),s.parent=n,e){for(a=s,l=n;l&&!("immediateRender"in a);)a=l.vars.defaults||{},l=zi(l.vars.inherit)&&l.parent;s.immediateRender=zi(a.immediateRender),e<2?s.runBackwards=1:s.startAt=t[r-1]}return new Pn(t[0],s,t[r+1])},cl=function(e,t){return e||e===0?t(e):t},Rm=function(e,t,n){return n<e?e:n>t?t:n},Gi=function(e){if(typeof e!="string")return"";var t=SQ.exec(e);return t?e.substr(t.index+t[0].length):""},BQ=function(e,t,n){return cl(n,function(i){return Rm(e,t,i)})},eT=[].slice,tN=function(e,t){return e&&zo(e)&&"length"in e&&(!t&&!e.length||e.length-1 in e&&zo(e[0]))&&!e.nodeType&&e!==Hs},NQ=function(e,t,n){return n===void 0&&(n=[]),e.forEach(function(i){var r;return ti(i)&&!t||tN(i,1)?(r=n).push.apply(r,Ar(i)):n.push(i)})||n},Ar=function(e,t,n){return ti(e)&&!n&&(VS||!Fd())?eT.call((t||WS).querySelectorAll(e),0):or(e)?NQ(e,n):tN(e)?eT.call(e,0):e?[e]:[]},OQ=function(e){return e=Ar(e)[0]||vx("Invalid scope")||{},function(t){var n=e.current||e.nativeElement||e;return Ar(t,n.querySelectorAll?n:n===e?vx("Invalid scope")||WS.createElement("div"):e)}},nN=function(e){return e.sort(function(){return .5-Math.random()})},iN=function(e){if(Wn(e))return e;var t=zo(e)?e:{each:e},n=Bd(t.ease),i=t.from||0,r=parseFloat(t.base)||0,s={},a=i>0&&i<1,l=isNaN(i)||a,c=t.axis,u=i,d=i;return ti(i)?u=d={center:.5,edges:.5,end:1}[i]||0:!a&&l&&(u=i[0],d=i[1]),function(h,f,p){var g=(p||t).length,v=s[g],y,m,x,_,w,b,M,S,E;if(!v){if(E=t.grid==="auto"?0:(t.grid||[1,Us])[1],!E){for(M=-Us;M<(M=p[E++].getBoundingClientRect().left)&&E<g;);E--}for(v=s[g]=[],y=l?Math.min(E,g)*u-.5:i%E,m=l?g*d/E-.5:i/E|0,M=0,S=Us,b=0;b<g;b++)x=b%E-y,_=m-(b/E|0),v[b]=w=c?Math.abs(c==="y"?_:x):BB(x*x+_*_),w>M&&(M=w),w<S&&(S=w);i==="random"&&nN(v),v.max=M-S,v.min=S,v.v=g=(parseFloat(t.amount)||parseFloat(t.each)*(E>g?g-1:c?c==="y"?g/E:E:Math.max(E,g/E))||0)*(i==="edges"?-1:1),v.b=g<0?r-g:r,v.u=Gi(t.amount||t.each)||0,n=n&&g<0?dN(n):n}return g=(v[h]-v.min)/v.max||0,mt(v.b+(n?n(g):g)*v.v)+v.u}},tT=function(e){var t=e<1?Math.pow(10,(e+"").length-2):1;return function(n){var i=Math.round(parseFloat(n)/e)*e*t;return(i-i%1)/t+(ko(n)?0:Gi(n))}},rN=function(e,t){var n=or(e),i,r;return!n&&zo(e)&&(i=n=e.radius||Us,e.values?(e=Ar(e.values),(r=!ko(e[0]))&&(i*=i)):e=tT(e.increment)),cl(t,n?Wn(e)?function(s){return r=e(s),Math.abs(r-s)<=i?r:s}:function(s){for(var a=parseFloat(r?s.x:s),l=parseFloat(r?s.y:0),c=Us,u=0,d=e.length,h,f;d--;)r?(h=e[d].x-a,f=e[d].y-l,h=h*h+f*f):h=Math.abs(e[d]-a),h<c&&(c=h,u=d);return u=!i||c<=i?e[u]:s,r||u===s||ko(s)?u:u+Gi(s)}:tT(e))},sN=function(e,t,n,i){return cl(or(e)?!t:n===!0?!!(n=0):!i,function(){return or(e)?e[~~(Math.random()*e.length)]:(n=n||1e-5)&&(i=n<1?Math.pow(10,(n+"").length-2):1)&&Math.floor(Math.round((e-n/2+Math.random()*(t-e+n*.99))/n)*n*i)/i})},kQ=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return function(i){return t.reduce(function(r,s){return s(r)},i)}},zQ=function(e,t){return function(n){return e(parseFloat(n))+(t||Gi(n))}},UQ=function(e,t,n){return aN(e,t,0,1,n)},oN=function(e,t,n){return cl(n,function(i){return e[~~t(i)]})},HQ=function o(e,t,n){var i=t-e;return or(e)?oN(e,o(0,e.length),t):cl(n,function(r){return(i+(r-e)%i)%i+e})},GQ=function o(e,t,n){var i=t-e,r=i*2;return or(e)?oN(e,o(0,e.length-1),t):cl(n,function(s){return s=(r+(s-e)%r)%r||0,e+(s>i?r-s:s)})},Pm=function(e){for(var t=0,n="",i,r,s,a;~(i=e.indexOf("random(",t));)s=e.indexOf(")",i),a=e.charAt(i+7)==="[",r=e.substr(i+7,s-i-7).match(a?zB:zS),n+=e.substr(t,i-t)+sN(a?r:+r[0],a?0:+r[1],+r[2]||1e-5),t=s+1;return n+e.substr(t,e.length-t)},aN=function(e,t,n,i,r){var s=t-e,a=i-n;return cl(r,function(l){return n+((l-e)/s*a||0)})},VQ=function o(e,t,n,i){var r=isNaN(e+t)?0:function(f){return(1-f)*e+f*t};if(!r){var s=ti(e),a={},l,c,u,d,h;if(n===!0&&(i=1)&&(n=null),s)e={p:e},t={p:t};else if(or(e)&&!or(t)){for(u=[],d=e.length,h=d-2,c=1;c<d;c++)u.push(o(e[c-1],e[c]));d--,r=function(p){p*=d;var g=Math.min(h,~~p);return u[g](p-g)},n=t}else i||(e=Rd(or(e)?[]:{},e));if(!u){for(l in t)aT.call(a,e,l,"get",t[l]);r=function(p){return hT(p,a)||(s?e.p:e)}}}return cl(n,r)},lN=function(e,t,n){var i=e.labels,r=Us,s,a,l;for(s in i)a=i[s]-t,a<0==!!n&&a&&r>(a=Math.abs(a))&&(l=s,r=a);return l},Cr=function(e,t,n){var i=e.vars,r=i[t],s,a;if(!!r)return s=i[t+"Params"],a=i.callbackScope||e,n&&ol.length&&_x(),s?r.apply(a,s):r.call(a)},Im=function(e){return ll(e),e.scrollTrigger&&e.scrollTrigger.kill(!1),e.progress()<1&&Cr(e,"onInterrupt"),e},Dd,WQ=function(e){e=!e.name&&e.default||e;var t=e.name,n=Wn(e),i=t&&!n&&e.init?function(){this._props=[]}:e,r={init:Ld,render:hT,add:aT,kill:oee,modifier:see,rawVars:0},s={targetTest:0,get:0,getSetter:Tx,aliases:{},register:0};if(Fd(),e!==i){if(Ui[t])return;Tr(i,Tr(KS(e,r),s)),Rd(i.prototype,Rd(r,KS(e,s))),Ui[i.prop=t]=i,e.targetTest&&(xx.push(i),XS[t]=1),t=(t==="css"?"CSS":t.charAt(0).toUpperCase()+t.substr(1))+"Plugin"}GB(t,i),e.register&&e.register(Lr,i,Ii)},Gt=255,Dm={aqua:[0,Gt,Gt],lime:[0,Gt,0],silver:[192,192,192],black:[0,0,0],maroon:[128,0,0],teal:[0,128,128],blue:[0,0,Gt],navy:[0,0,128],white:[Gt,Gt,Gt],olive:[128,128,0],yellow:[Gt,Gt,0],orange:[Gt,165,0],gray:[128,128,128],purple:[128,0,128],green:[0,128,0],red:[Gt,0,0],pink:[Gt,192,203],cyan:[0,Gt,Gt],transparent:[Gt,Gt,Gt,0]},nT=function(e,t,n){return e=e<0?e+1:e>1?e-1:e,(e*6<1?t+(n-t)*e*6:e<.5?n:e*3<2?t+(n-t)*(2/3-e)*6:t)*Gt+.5|0},cN=function(e,t,n){var i=e?ko(e)?[e>>16,e>>8&Gt,e&Gt]:0:Dm.black,r,s,a,l,c,u,d,h,f,p;if(!i){if(e.substr(-1)===","&&(e=e.substr(0,e.length-1)),Dm[e])i=Dm[e];else if(e.charAt(0)==="#"){if(e.length<6&&(r=e.charAt(1),s=e.charAt(2),a=e.charAt(3),e="#"+r+r+s+s+a+a+(e.length===5?e.charAt(4)+e.charAt(4):"")),e.length===9)return i=parseInt(e.substr(1,6),16),[i>>16,i>>8&Gt,i&Gt,parseInt(e.substr(7),16)/255];e=parseInt(e.substr(1),16),i=[e>>16,e>>8&Gt,e&Gt]}else if(e.substr(0,3)==="hsl"){if(i=p=e.match(zS),!t)l=+i[0]%360/360,c=+i[1]/100,u=+i[2]/100,s=u<=.5?u*(c+1):u+c-u*c,r=u*2-s,i.length>3&&(i[3]*=1),i[0]=nT(l+1/3,r,s),i[1]=nT(l,r,s),i[2]=nT(l-1/3,r,s);else if(~e.indexOf("="))return i=e.match(US),n&&i.length<4&&(i[3]=1),i}else i=e.match(zS)||Dm.transparent;i=i.map(Number)}return t&&!p&&(r=i[0]/Gt,s=i[1]/Gt,a=i[2]/Gt,d=Math.max(r,s,a),h=Math.min(r,s,a),u=(d+h)/2,d===h?l=c=0:(f=d-h,c=u>.5?f/(2-d-h):f/(d+h),l=d===r?(s-a)/f+(s<a?6:0):d===s?(a-r)/f+2:(r-s)/f+4,l*=60),i[0]=~~(l+.5),i[1]=~~(c*100+.5),i[2]=~~(u*100+.5)),n&&i.length<4&&(i[3]=1),i},uN=function(e){var t=[],n=[],i=-1;return e.split(Uo).forEach(function(r){var s=r.match(Lc)||[];t.push.apply(t,s),n.push(i+=s.length+1)}),t.c=n,t},hN=function(e,t,n){var i="",r=(e+i).match(Uo),s=t?"hsla(":"rgba(",a=0,l,c,u,d;if(!r)return e;if(r=r.map(function(h){return(h=cN(h,t,1))&&s+(t?h[0]+","+h[1]+"%,"+h[2]+"%,"+h[3]:h.join(","))+")"}),n&&(u=uN(e),l=n.c,l.join(i)!==u.c.join(i)))for(c=e.replace(Uo,"1").split(Lc),d=c.length-1;a<d;a++)i+=c[a]+(~l.indexOf(a)?r.shift()||s+"0,0,0,0)":(u.length?u:r.length?r:n).shift());if(!c)for(c=e.split(Uo),d=c.length-1;a<d;a++)i+=c[a]+r[a];return i+c[d]},Uo=function(){var o="(?:\\b(?:(?:rgb|rgba|hsl|hsla)\\(.+?\\))|\\B#(?:[0-9a-f]{3,4}){1,2}\\b",e;for(e in Dm)o+="|"+e+"\\b";return new RegExp(o+")","gi")}(),XQ=/hsl[a]?\(/,iT=function(e){var t=e.join(" "),n;if(Uo.lastIndex=0,Uo.test(t))return n=XQ.test(t),e[1]=hN(e[1],n),e[0]=hN(e[0],n,uN(e[1])),!0},Sx,lr=function(){var o=Date.now,e=500,t=33,n=o(),i=n,r=1e3/240,s=r,a=[],l,c,u,d,h,f,p=function g(v){var y=o()-i,m=v===!0,x,_,w,b;if(y>e&&(n+=y-t),i+=y,w=i-n,x=w-s,(x>0||m)&&(b=++d.frame,h=w-d.time*1e3,d.time=w=w/1e3,s+=x+(x>=r?4:r-x),_=1),m||(l=c(g)),_)for(f=0;f<a.length;f++)a[f](w,h,b,v)};return d={time:0,frame:0,tick:function(){p(!0)},deltaRatio:function(v){return h/(1e3/(v||60))},wake:function(){UB&&(!VS&&NB()&&(Hs=VS=window,WS=Hs.document||{},ar.gsap=Lr,(Hs.gsapVersions||(Hs.gsapVersions=[])).push(Lr.version),HB(gx||Hs.GreenSockGlobals||!Hs.gsap&&Hs||{}),u=Hs.requestAnimationFrame),l&&d.sleep(),c=u||function(v){return setTimeout(v,s-d.time*1e3+1|0)},Sx=1,p(2))},sleep:function(){(u?Hs.cancelAnimationFrame:clearTimeout)(l),Sx=0,c=Ld},lagSmoothing:function(v,y){e=v||1/Ft,t=Math.min(y,e,0)},fps:function(v){r=1e3/(v||240),s=d.time*1e3+r},add:function(v){a.indexOf(v)<0&&a.push(v),Fd()},remove:function(v){var y;~(y=a.indexOf(v))&&a.splice(y,1)&&f>=y&&f--},_listeners:a},d}(),Fd=function(){return!Sx&&lr.wake()},xt={},qQ=/^[\d.\-M][\d.\-,\s]/,jQ=/["']/g,YQ=function(e){for(var t={},n=e.substr(1,e.length-3).split(":"),i=n[0],r=1,s=n.length,a,l,c;r<s;r++)l=n[r],a=r!==s-1?l.lastIndexOf(","):l.length,c=l.substr(0,a),t[i]=isNaN(c)?c.replace(jQ,"").trim():+c,i=l.substr(a+1).trim();return t},ZQ=function(e){var t=e.indexOf("(")+1,n=e.indexOf(")"),i=e.indexOf("(",t);return e.substring(t,~i&&i<n?e.indexOf(")",n+1):n)},JQ=function(e){var t=(e+"").split("("),n=xt[t[0]];return n&&t.length>1&&n.config?n.config.apply(null,~e.indexOf("{")?[YQ(t[1])]:ZQ(e).split(",").map(qB)):xt._CE&&qQ.test(e)?xt._CE("",e):n},dN=function(e){return function(t){return 1-e(1-t)}},fN=function o(e,t){for(var n=e._first,i;n;)n instanceof xi?o(n,t):n.vars.yoyoEase&&(!n._yoyo||!n._repeat)&&n._yoyo!==t&&(n.timeline?o(n.timeline,t):(i=n._ease,n._ease=n._yEase,n._yEase=i,n._yoyo=t)),n=n._next},Bd=function(e,t){return e&&(Wn(e)?e:xt[e]||JQ(e))||t},Pc=function(e,t,n,i){n===void 0&&(n=function(l){return 1-t(1-l)}),i===void 0&&(i=function(l){return l<.5?t(l*2)/2:1-t((1-l)*2)/2});var r={easeIn:t,easeOut:n,easeInOut:i},s;return Hi(e,function(a){xt[a]=ar[a]=r,xt[s=a.toLowerCase()]=n;for(var l in r)xt[s+(l==="easeIn"?".in":l==="easeOut"?".out":".inOut")]=xt[a+"."+l]=r[l]}),r},pN=function(e){return function(t){return t<.5?(1-e(1-t*2))/2:.5+e((t-.5)*2)/2}},rT=function o(e,t,n){var i=t>=1?t:1,r=(n||(e?.3:.45))/(t<1?t:1),s=r/kS*(Math.asin(1/i)||0),a=function(u){return u===1?1:i*Math.pow(2,-10*u)*MQ((u-s)*r)+1},l=e==="out"?a:e==="in"?function(c){return 1-a(1-c)}:pN(a);return r=kS/r,l.config=function(c,u){return o(e,c,u)},l},sT=function o(e,t){t===void 0&&(t=1.70158);var n=function(s){return s?--s*s*((t+1)*s+t)+1:0},i=e==="out"?n:e==="in"?function(r){return 1-n(1-r)}:pN(n);return i.config=function(r){return o(e,r)},i};Hi("Linear,Quad,Cubic,Quart,Quint,Strong",function(o,e){var t=e<5?e+1:e;Pc(o+",Power"+(t-1),e?function(n){return Math.pow(n,t)}:function(n){return n},function(n){return 1-Math.pow(1-n,t)},function(n){return n<.5?Math.pow(n*2,t)/2:1-Math.pow((1-n)*2,t)/2})});xt.Linear.easeNone=xt.none=xt.Linear.easeIn;Pc("Elastic",rT("in"),rT("out"),rT());(function(o,e){var t=1/e,n=2*t,i=2.5*t,r=function(a){return a<t?o*a*a:a<n?o*Math.pow(a-1.5/e,2)+.75:a<i?o*(a-=2.25/e)*a+.9375:o*Math.pow(a-2.625/e,2)+.984375};Pc("Bounce",function(s){return 1-r(1-s)},r)})(7.5625,2.75);Pc("Expo",function(o){return o?Math.pow(2,10*(o-1)):0});Pc("Circ",function(o){return-(BB(1-o*o)-1)});Pc("Sine",function(o){return o===1?1:-bQ(o*_Q)+1});Pc("Back",sT("in"),sT("out"),sT());xt.SteppedEase=xt.steps=ar.SteppedEase={config:function(e,t){e===void 0&&(e=1);var n=1/e,i=e+(t?0:1),r=t?1:0,s=1-Ft;return function(a){return((i*Rm(0,s,a)|0)+r)*n}}};Cd.ease=xt["quad.out"];Hi("onComplete,onUpdate,onStart,onRepeat,onReverseComplete,onInterrupt",function(o){return YS+=o+","+o+"Params,"});var oT=function(e,t){this.id=wQ++,e._gsap=this,this.target=e,this.harness=t,this.get=t?t.get:JS,this.set=t?t.getSetter:Tx},Fm=function(){function o(t){this.vars=t,this._delay=+t.delay||0,(this._repeat=t.repeat===1/0?-2:t.repeat||0)&&(this._rDelay=t.repeatDelay||0,this._yoyo=!!t.yoyo||!!t.yoyoEase),this._ts=1,Id(this,+t.duration,1,1),this.data=t.data,Sx||lr.wake()}var e=o.prototype;return e.delay=function(n){return n||n===0?(this.parent&&this.parent.smoothChildTiming&&this.startTime(this._start+n-this._delay),this._delay=n,this):this._delay},e.duration=function(n){return arguments.length?this.totalDuration(this._repeat>0?n+(n+this._rDelay)*this._repeat:n):this.totalDuration()&&this._dur},e.totalDuration=function(n){return arguments.length?(this._dirty=0,Id(this,this._repeat<0?n:(n-this._repeat*this._rDelay)/(this._repeat+1))):this._tDur},e.totalTime=function(n,i){if(Fd(),!arguments.length)return this._tTime;var r=this._dp;if(r&&r.smoothChildTiming&&this._ts){for(JB(this,n),!r._dp||r.parent||KB(r,this);r.parent;)r.parent._time!==r._start+(r._ts>=0?r._tTime/r._ts:(r.totalDuration()-r._tTime)/-r._ts)&&r.totalTime(r._tTime,!0),r=r.parent;!this.parent&&this._dp.autoRemoveChildren&&(this._ts>0&&n<this._tDur||this._ts<0&&n>0||!this._tDur&&!n)&&Gs(this._dp,this,this._start-this._delay)}return(this._tTime!==n||!this._dur&&!i||this._initted&&Math.abs(this._zTime)===Ft||!n&&!this._initted&&(this.add||this._ptLookup))&&(this._ts||(this._pTime=n),XB(this,n,i)),this},e.time=function(n,i){return arguments.length?this.totalTime(Math.min(this.totalDuration(),n+ZB(this))%(this._dur+this._rDelay)||(n?this._dur:0),i):this._time},e.totalProgress=function(n,i){return arguments.length?this.totalTime(this.totalDuration()*n,i):this.totalDuration()?Math.min(1,this._tTime/this._tDur):this.ratio},e.progress=function(n,i){return arguments.length?this.totalTime(this.duration()*(this._yoyo&&!(this.iteration()&1)?1-n:n)+ZB(this),i):this.duration()?Math.min(1,this._time/this._dur):this.ratio},e.iteration=function(n,i){var r=this.duration()+this._rDelay;return arguments.length?this.totalTime(this._time+(n-1)*r,i):this._repeat?Pd(this._tTime,r)+1:1},e.timeScale=function(n){if(!arguments.length)return this._rts===-Ft?0:this._rts;if(this._rts===n)return this;var i=this.parent&&this._ts?Mx(this.parent._time,this):this._tTime;return this._rts=+n||0,this._ts=this._ps||n===-Ft?0:this._rts,LQ(this.totalTime(Rm(-this._delay,this._tDur,i),!0))},e.paused=function(n){return arguments.length?(this._ps!==n&&(this._ps=n,n?(this._pTime=this._tTime||Math.max(-this._delay,this.rawTime()),this._ts=this._act=0):(Fd(),this._ts=this._rts,this.totalTime(this.parent&&!this.parent.smoothChildTiming?this.rawTime():this._tTime||this._pTime,this.progress()===1&&Math.abs(this._zTime)!==Ft&&(this._tTime-=Ft)))),this):this._ps},e.startTime=function(n){if(arguments.length){this._start=n;var i=this.parent||this._dp;return i&&(i._sort||!this.parent)&&Gs(i,this,n-this._delay),this}return this._start},e.endTime=function(n){return this._start+(zi(n)?this.totalDuration():this.duration())/Math.abs(this._ts)},e.rawTime=function(n){var i=this.parent||this._dp;return i?n&&(!this._ts||this._repeat&&this._time&&this.totalProgress()<1)?this._tTime%(this._dur+this._rDelay):this._ts?Mx(i.rawTime(n),this):this._tTime:this._tTime},e.globalTime=function(n){for(var i=this,r=arguments.length?n:i.rawTime();i;)r=i._start+r/(i._ts||1),i=i._dp;return r},e.repeat=function(n){return arguments.length?(this._repeat=n===1/0?-2:n,eN(this)):this._repeat===-2?1/0:this._repeat},e.repeatDelay=function(n){if(arguments.length){var i=this._time;return this._rDelay=n,eN(this),i?this.time(i):this}return this._rDelay},e.yoyo=function(n){return arguments.length?(this._yoyo=n,this):this._yoyo},e.seek=function(n,i){return this.totalTime(Er(this,n),zi(i))},e.restart=function(n,i){return this.play().totalTime(n?-this._delay:0,zi(i))},e.play=function(n,i){return n!=null&&this.seek(n,i),this.reversed(!1).paused(!1)},e.reverse=function(n,i){return n!=null&&this.seek(n||this.totalDuration(),i),this.reversed(!0).paused(!1)},e.pause=function(n,i){return n!=null&&this.seek(n,i),this.paused(!0)},e.resume=function(){return this.paused(!1)},e.reversed=function(n){return arguments.length?(!!n!==this.reversed()&&this.timeScale(-this._rts||(n?-Ft:0)),this):this._rts<0},e.invalidate=function(){return this._initted=this._act=0,this._zTime=-Ft,this},e.isActive=function(){var n=this.parent||this._dp,i=this._start,r;return!!(!n||this._ts&&this._initted&&n.isActive()&&(r=n.rawTime(!0))>=i&&r<this.endTime(!0)-Ft)},e.eventCallback=function(n,i,r){var s=this.vars;return arguments.length>1?(i?(s[n]=i,r&&(s[n+"Params"]=r),n==="onUpdate"&&(this._onUpdate=i)):delete s[n],this):s[n]},e.then=function(n){var i=this;return new Promise(function(r){var s=Wn(n)?n:jB,a=function(){var c=i.then;i.then=null,Wn(s)&&(s=s(i))&&(s.then||s===i)&&(i.then=c),r(s),i.then=c};i._initted&&i.totalProgress()===1&&i._ts>=0||!i._tTime&&i._ts<0?a():i._prom=a})},e.kill=function(){Im(this)},o}();Tr(Fm.prototype,{_time:0,_start:0,_end:0,_tTime:0,_tDur:0,_dirty:0,_repeat:0,_yoyo:!1,parent:null,_initted:!1,_rDelay:0,_ts:1,_dp:0,ratio:0,_zTime:-Ft,_prom:0,_ps:!1,_rts:1});var xi=function(o){FB(e,o);function e(n,i){var r;return n===void 0&&(n={}),r=o.call(this,n)||this,r.labels={},r.smoothChildTiming=!!n.smoothChildTiming,r.autoRemoveChildren=!!n.autoRemoveChildren,r._sort=zi(n.sortChildren),on&&Gs(n.parent||on,Oo(r),i),n.reversed&&r.reverse(),n.paused&&r.paused(!0),n.scrollTrigger&&$B(Oo(r),n.scrollTrigger),r}var t=e.prototype;return t.to=function(i,r,s){return Lm(0,arguments,this),this},t.from=function(i,r,s){return Lm(1,arguments,this),this},t.fromTo=function(i,r,s,a){return Lm(2,arguments,this),this},t.set=function(i,r,s){return r.duration=0,r.parent=this,wx(r).repeatDelay||(r.repeat=0),r.immediateRender=!!r.immediateRender,new Pn(i,r,Er(this,s),1),this},t.call=function(i,r,s){return Gs(this,Pn.delayedCall(0,i,r),s)},t.staggerTo=function(i,r,s,a,l,c,u){return s.duration=r,s.stagger=s.stagger||a,s.onComplete=c,s.onCompleteParams=u,s.parent=this,new Pn(i,s,Er(this,l)),this},t.staggerFrom=function(i,r,s,a,l,c,u){return s.runBackwards=1,wx(s).immediateRender=zi(s.immediateRender),this.staggerTo(i,r,s,a,l,c,u)},t.staggerFromTo=function(i,r,s,a,l,c,u,d){return a.startAt=s,wx(a).immediateRender=zi(a.immediateRender),this.staggerTo(i,r,a,l,c,u,d)},t.render=function(i,r,s){var a=this._time,l=this._dirty?this.totalDuration():this._tDur,c=this._dur,u=this!==on&&i>l-Ft&&i>=0?l:i<Ft?0:i,d=this._zTime<0!=i<0&&(this._initted||!c),h,f,p,g,v,y,m,x,_,w,b,M;if(u!==this._tTime||s||d){if(a!==this._time&&c&&(u+=this._time-a,i+=this._time-a),h=u,_=this._start,x=this._ts,y=!x,d&&(c||(a=this._zTime),(i||!r)&&(this._zTime=i)),this._repeat){if(b=this._yoyo,v=c+this._rDelay,this._repeat<-1&&i<0)return this.totalTime(v*100+i,r,s);if(h=mt(u%v),u===l?(g=this._repeat,h=c):(g=~~(u/v),g&&g===u/v&&(h=c,g--),h>c&&(h=c)),w=Pd(this._tTime,v),!a&&this._tTime&&w!==g&&(w=g),b&&g&1&&(h=c-h,M=1),g!==w&&!this._lock){var S=b&&w&1,E=S===(b&&g&1);if(g<w&&(S=!S),a=S?0:c,this._lock=1,this.render(a||(M?0:mt(g*v)),r,!c)._lock=0,this._tTime=u,!r&&this.parent&&Cr(this,"onRepeat"),this.vars.repeatRefresh&&!M&&(this.invalidate()._lock=1),a&&a!==this._time||y!==!this._ts||this.vars.onRepeat&&!this.parent&&!this._act)return this;if(c=this._dur,l=this._tDur,E&&(this._lock=2,a=S?c:-1e-4,this.render(a,!0),this.vars.repeatRefresh&&!M&&this.invalidate()),this._lock=0,!this._ts&&!y)return this;fN(this,M)}}if(this._hasPause&&!this._forcing&&this._lock<2&&(m=DQ(this,mt(a),mt(h)),m&&(u-=h-(h=m._start))),this._tTime=u,this._time=h,this._act=!x,this._initted||(this._onUpdate=this.vars.onUpdate,this._initted=1,this._zTime=i,a=0),!a&&h&&!r&&(Cr(this,"onStart"),this._tTime!==u))return this;if(h>=a&&i>=0)for(f=this._first;f;){if(p=f._next,(f._act||h>=f._start)&&f._ts&&m!==f){if(f.parent!==this)return this.render(i,r,s);if(f.render(f._ts>0?(h-f._start)*f._ts:(f._dirty?f.totalDuration():f._tDur)+(h-f._start)*f._ts,r,s),h!==this._time||!this._ts&&!y){m=0,p&&(u+=this._zTime=-Ft);break}}f=p}else{f=this._last;for(var A=i<0?i:h;f;){if(p=f._prev,(f._act||A<=f._end)&&f._ts&&m!==f){if(f.parent!==this)return this.render(i,r,s);if(f.render(f._ts>0?(A-f._start)*f._ts:(f._dirty?f.totalDuration():f._tDur)+(A-f._start)*f._ts,r,s),h!==this._time||!this._ts&&!y){m=0,p&&(u+=this._zTime=A?-Ft:Ft);break}}f=p}}if(m&&!r&&(this.pause(),m.render(h>=a?0:-Ft)._zTime=h>=a?1:-1,this._ts))return this._start=_,$S(this),this.render(i,r,s);this._onUpdate&&!r&&Cr(this,"onUpdate",!0),(u===l&&l>=this.totalDuration()||!u&&a)&&(_===this._start||Math.abs(x)!==Math.abs(this._ts))&&(this._lock||((i||!c)&&(u===l&&this._ts>0||!u&&this._ts<0)&&ll(this,1),!r&&!(i<0&&!a)&&(u||a||!l)&&(Cr(this,u===l&&i>=0?"onComplete":"onReverseComplete",!0),this._prom&&!(u<l&&this.timeScale()>0)&&this._prom())))}return this},t.add=function(i,r){var s=this;if(ko(r)||(r=Er(this,r,i)),!(i instanceof Fm)){if(or(i))return i.forEach(function(a){return s.add(a,r)}),this;if(ti(i))return this.addLabel(i,r);if(Wn(i))i=Pn.delayedCall(0,i);else return this}return this!==i?Gs(this,i,r):this},t.getChildren=function(i,r,s,a){i===void 0&&(i=!0),r===void 0&&(r=!0),s===void 0&&(s=!0),a===void 0&&(a=-Us);for(var l=[],c=this._first;c;)c._start>=a&&(c instanceof Pn?r&&l.push(c):(s&&l.push(c),i&&l.push.apply(l,c.getChildren(!0,r,s)))),c=c._next;return l},t.getById=function(i){for(var r=this.getChildren(1,1,1),s=r.length;s--;)if(r[s].vars.id===i)return r[s]},t.remove=function(i){return ti(i)?this.removeLabel(i):Wn(i)?this.killTweensOf(i):(bx(this,i),i===this._recent&&(this._recent=this._last),Rc(this))},t.totalTime=function(i,r){return arguments.length?(this._forcing=1,!this._dp&&this._ts&&(this._start=mt(lr.time-(this._ts>0?i/this._ts:(this.totalDuration()-i)/-this._ts))),o.prototype.totalTime.call(this,i,r),this._forcing=0,this):this._tTime},t.addLabel=function(i,r){return this.labels[i]=Er(this,r),this},t.removeLabel=function(i){return delete this.labels[i],this},t.addPause=function(i,r,s){var a=Pn.delayedCall(0,r||Ld,s);return a.data="isPause",this._hasPause=1,Gs(this,a,Er(this,i))},t.removePause=function(i){var r=this._first;for(i=Er(this,i);r;)r._start===i&&r.data==="isPause"&&ll(r),r=r._next},t.killTweensOf=function(i,r,s){for(var a=this.getTweensOf(i,s),l=a.length;l--;)ul!==a[l]&&a[l].kill(i,r);return this},t.getTweensOf=function(i,r){for(var s=[],a=Ar(i),l=this._first,c=ko(r),u;l;)l instanceof Pn?TQ(l._targets,a)&&(c?(!ul||l._initted&&l._ts)&&l.globalTime(0)<=r&&l.globalTime(l.totalDuration())>r:!r||l.isActive())&&s.push(l):(u=l.getTweensOf(a,r)).length&&s.push.apply(s,u),l=l._next;return s},t.tweenTo=function(i,r){r=r||{};var s=this,a=Er(s,i),l=r,c=l.startAt,u=l.onStart,d=l.onStartParams,h=l.immediateRender,f,p=Pn.to(s,Tr({ease:r.ease||"none",lazy:!1,immediateRender:!1,time:a,overwrite:"auto",duration:r.duration||Math.abs((a-(c&&"time"in c?c.time:s._time))/s.timeScale())||Ft,onStart:function(){if(s.pause(),!f){var v=r.duration||Math.abs((a-(c&&"time"in c?c.time:s._time))/s.timeScale());p._dur!==v&&Id(p,v,0,1).render(p._time,!0,!0),f=1}u&&u.apply(p,d||[])}},r));return h?p.render(0):p},t.tweenFromTo=function(i,r,s){return this.tweenTo(r,Tr({startAt:{time:Er(this,i)}},s))},t.recent=function(){return this._recent},t.nextLabel=function(i){return i===void 0&&(i=this._time),lN(this,Er(this,i))},t.previousLabel=function(i){return i===void 0&&(i=this._time),lN(this,Er(this,i),1)},t.currentLabel=function(i){return arguments.length?this.seek(i,!0):this.previousLabel(this._time+Ft)},t.shiftChildren=function(i,r,s){s===void 0&&(s=0);for(var a=this._first,l=this.labels,c;a;)a._start>=s&&(a._start+=i,a._end+=i),a=a._next;if(r)for(c in l)l[c]>=s&&(l[c]+=i);return Rc(this)},t.invalidate=function(){var i=this._first;for(this._lock=0;i;)i.invalidate(),i=i._next;return o.prototype.invalidate.call(this)},t.clear=function(i){i===void 0&&(i=!0);for(var r=this._first,s;r;)s=r._next,this.remove(r),r=s;return this._dp&&(this._time=this._tTime=this._pTime=0),i&&(this.labels={}),Rc(this)},t.totalDuration=function(i){var r=0,s=this,a=s._last,l=Us,c,u,d;if(arguments.length)return s.timeScale((s._repeat<0?s.duration():s.totalDuration())/(s.reversed()?-i:i));if(s._dirty){for(d=s.parent;a;)c=a._prev,a._dirty&&a.totalDuration(),u=a._start,u>l&&s._sort&&a._ts&&!s._lock?(s._lock=1,Gs(s,a,u-a._delay,1)._lock=0):l=u,u<0&&a._ts&&(r-=u,(!d&&!s._dp||d&&d.smoothChildTiming)&&(s._start+=u/s._ts,s._time-=u,s._tTime-=u),s.shiftChildren(-u,!1,-1/0),l=0),a._end>r&&a._ts&&(r=a._end),a=c;Id(s,s===on&&s._time>r?s._time:r,1,1),s._dirty=0}return s._tDur},e.updateRoot=function(i){if(on._ts&&(XB(on,Mx(i,on)),VB=lr.frame),lr.frame>=WB){WB+=Pi.autoSleep||120;var r=on._first;if((!r||!r._ts)&&Pi.autoSleep&&lr._listeners.length<2){for(;r&&!r._ts;)r=r._next;r||lr.sleep()}}},e}(Fm);Tr(xi.prototype,{_lock:0,_hasPause:0,_forcing:0});var KQ=function(e,t,n,i,r,s,a){var l=new Ii(this._pt,e,t,0,1,uT,null,r),c=0,u=0,d,h,f,p,g,v,y,m;for(l.b=n,l.e=i,n+="",i+="",(y=~i.indexOf("random("))&&(i=Pm(i)),s&&(m=[n,i],s(m,e,t),n=m[0],i=m[1]),h=n.match(HS)||[];d=HS.exec(i);)p=d[0],g=i.substring(c,d.index),f?f=(f+1)%5:g.substr(-5)==="rgba("&&(f=1),p!==h[u++]&&(v=parseFloat(h[u-1])||0,l._pt={_next:l._pt,p:g||u===1?g:",",s:v,c:p.charAt(1)==="="?parseFloat(p.substr(2))*(p.charAt(0)==="-"?-1:1):parseFloat(p)-v,m:f&&f<4?Math.round:0},c=HS.lastIndex);return l.c=c<i.length?i.substring(c,i.length):"",l.fp=a,(GS.test(i)||y)&&(l.e=0),this._pt=l,l},aT=function(e,t,n,i,r,s,a,l,c){Wn(i)&&(i=i(r||0,e,s));var u=e[t],d=n!=="get"?n:Wn(u)?c?e[t.indexOf("set")||!Wn(e["get"+t.substr(3)])?t:"get"+t.substr(3)](c):e[t]():u,h=Wn(u)?c?nee:gN:cT,f;if(ti(i)&&(~i.indexOf("random(")&&(i=Pm(i)),i.charAt(1)==="="&&(f=parseFloat(d)+parseFloat(i.substr(2))*(i.charAt(0)==="-"?-1:1)+(Gi(d)||0),(f||f===0)&&(i=f))),d!==i)return!isNaN(d*i)&&i!==""?(f=new Ii(this._pt,e,t,+d||0,i-(d||0),typeof u=="boolean"?ree:yN,0,h),c&&(f.fp=c),a&&f.modifier(a,this,e),this._pt=f):(!u&&!(t in e)&&yx(t,i),KQ.call(this,e,t,d,i,h,l||Pi.stringFilter,c))},$Q=function(e,t,n,i,r){if(Wn(e)&&(e=Bm(e,r,t,n,i)),!zo(e)||e.style&&e.nodeType||or(e)||kB(e))return ti(e)?Bm(e,r,t,n,i):e;var s={},a;for(a in e)s[a]=Bm(e[a],r,t,n,i);return s},lT=function(e,t,n,i,r,s){var a,l,c,u;if(Ui[e]&&(a=new Ui[e]).init(r,a.rawVars?t[e]:$Q(t[e],i,r,s,n),n,i,s)!==!1&&(n._pt=l=new Ii(n._pt,r,e,0,1,a.render,a,0,a.priority),n!==Dd))for(c=n._ptLookup[n._targets.indexOf(r)],u=a._props.length;u--;)c[a._props[u]]=l;return a},ul,QQ=function o(e,t){var n=e.vars,i=n.ease,r=n.startAt,s=n.immediateRender,a=n.lazy,l=n.onUpdate,c=n.onUpdateParams,u=n.callbackScope,d=n.runBackwards,h=n.yoyoEase,f=n.keyframes,p=n.autoRevert,g=e._dur,v=e._startAt,y=e._targets,m=e.parent,x=m&&m.data==="nested"?m.parent._targets:y,_=e._overwrite==="auto"&&!OS,w=e.timeline,b,M,S,E,A,L,B,R,D,P,I,N,G;if(w&&(!f||!i)&&(i="none"),e._ease=Bd(i,Cd.ease),e._yEase=h?dN(Bd(h===!0?i:h,Cd.ease)):0,h&&e._yoyo&&!e._repeat&&(h=e._yEase,e._yEase=e._ease,e._ease=h),e._from=!w&&!!n.runBackwards,!w){if(R=y[0]?al(y[0]).harness:0,N=R&&n[R.prop],b=KS(n,XS),v&&v.render(-1,!0).kill(),r)if(ll(e._startAt=Pn.set(y,Tr({data:"isStart",overwrite:!1,parent:m,immediateRender:!0,lazy:zi(a),startAt:null,delay:0,onUpdate:l,onUpdateParams:c,callbackScope:u,stagger:0},r))),t<0&&!s&&!p&&e._startAt.render(-1,!0),s){if(t>0&&!p&&(e._startAt=0),g&&t<=0){t&&(e._zTime=t);return}}else p===!1&&(e._startAt=0);else if(d&&g){if(v)!p&&(e._startAt=0);else if(t&&(s=!1),S=Tr({overwrite:!1,data:"isFromStart",lazy:s&&zi(a),immediateRender:s,stagger:0,parent:m},b),N&&(S[R.prop]=N),ll(e._startAt=Pn.set(y,S)),t<0&&e._startAt.render(-1,!0),!s)o(e._startAt,Ft);else if(!t)return}for(e._pt=0,a=g&&zi(a)||a&&!g,M=0;M<y.length;M++){if(A=y[M],B=A._gsap||ZS(y)[M]._gsap,e._ptLookup[M]=P={},qS[B.id]&&ol.length&&_x(),I=x===y?M:x.indexOf(A),R&&(D=new R).init(A,N||b,e,I,x)!==!1&&(e._pt=E=new Ii(e._pt,A,D.name,0,1,D.render,D,0,D.priority),D._props.forEach(function(z){P[z]=E}),D.priority&&(L=1)),!R||N)for(S in b)Ui[S]&&(D=lT(S,b,e,I,A,x))?D.priority&&(L=1):P[S]=E=aT.call(e,A,S,"get",b[S],I,x,0,n.stringFilter);e._op&&e._op[M]&&e.kill(A,e._op[M]),_&&e._pt&&(ul=e,on.killTweensOf(A,P,e.globalTime(0)),G=!e.parent,ul=0),e._pt&&a&&(qS[B.id]=1)}L&&dT(e),e._onInit&&e._onInit(e)}e._onUpdate=l,e._initted=(!e._op||e._pt)&&!G},eee=function(e,t){var n=e[0]?al(e[0]).harness:0,i=n&&n.aliases,r,s,a,l;if(!i)return t;r=Rd({},t);for(s in i)if(s in r)for(l=i[s].split(","),a=l.length;a--;)r[l[a]]=r[s];return r},Bm=function(e,t,n,i,r){return Wn(e)?e.call(t,n,i,r):ti(e)&&~e.indexOf("random(")?Pm(e):e},mN=YS+"repeat,repeatDelay,yoyo,repeatRefresh,yoyoEase",tee=(mN+",id,stagger,delay,duration,paused,scrollTrigger").split(","),Pn=function(o){FB(e,o);function e(n,i,r,s){var a;typeof i=="number"&&(r.duration=i,i=r,r=null),a=o.call(this,s?i:wx(i))||this;var l=a.vars,c=l.duration,u=l.delay,d=l.immediateRender,h=l.stagger,f=l.overwrite,p=l.keyframes,g=l.defaults,v=l.scrollTrigger,y=l.yoyoEase,m=i.parent||on,x=(or(n)||kB(n)?ko(n[0]):"length"in i)?[n]:Ar(n),_,w,b,M,S,E,A,L;if(a._targets=x.length?ZS(x):vx("GSAP target "+n+" not found. https://greensock.com",!Pi.nullTargetWarn)||[],a._ptLookup=[],a._overwrite=f,p||h||OB(c)||OB(u)){if(i=a.vars,_=a.timeline=new xi({data:"nested",defaults:g||{}}),_.kill(),_.parent=_._dp=Oo(a),_._start=0,p)Tr(_.vars.defaults,{ease:"none"}),h?x.forEach(function(B,R){return p.forEach(function(D,P){return _.to(B,D,P?">":R*h)})}):p.forEach(function(B){return _.to(x,B,">")});else{if(M=x.length,A=h?iN(h):Ld,zo(h))for(S in h)~mN.indexOf(S)&&(L||(L={}),L[S]=h[S]);for(w=0;w<M;w++){b={};for(S in i)tee.indexOf(S)<0&&(b[S]=i[S]);b.stagger=0,y&&(b.yoyoEase=y),L&&Rd(b,L),E=x[w],b.duration=+Bm(c,Oo(a),w,E,x),b.delay=(+Bm(u,Oo(a),w,E,x)||0)-a._delay,!h&&M===1&&b.delay&&(a._delay=u=b.delay,a._start+=u,b.delay=0),_.to(E,b,A(w,E,x))}_.duration()?c=u=0:a.timeline=0}c||a.duration(c=_.duration())}else a.timeline=0;return f===!0&&!OS&&(ul=Oo(a),on.killTweensOf(x),ul=0),Gs(m,Oo(a),r),i.reversed&&a.reverse(),i.paused&&a.paused(!0),(d||!c&&!p&&a._start===mt(m._time)&&zi(d)&&RQ(Oo(a))&&m.data!=="nested")&&(a._tTime=-Ft,a.render(Math.max(0,-u))),v&&$B(Oo(a),v),a}var t=e.prototype;return t.render=function(i,r,s){var a=this._time,l=this._tDur,c=this._dur,u=i>l-Ft&&i>=0?l:i<Ft?0:i,d,h,f,p,g,v,y,m,x;if(!c)IQ(this,i,r,s);else if(u!==this._tTime||!i||s||!this._initted&&this._tTime||this._startAt&&this._zTime<0!=i<0){if(d=u,m=this.timeline,this._repeat){if(p=c+this._rDelay,this._repeat<-1&&i<0)return this.totalTime(p*100+i,r,s);if(d=mt(u%p),u===l?(f=this._repeat,d=c):(f=~~(u/p),f&&f===u/p&&(d=c,f--),d>c&&(d=c)),v=this._yoyo&&f&1,v&&(x=this._yEase,d=c-d),g=Pd(this._tTime,p),d===a&&!s&&this._initted)return this;f!==g&&(m&&this._yEase&&fN(m,v),this.vars.repeatRefresh&&!v&&!this._lock&&(this._lock=s=1,this.render(mt(p*f),!0).invalidate()._lock=0))}if(!this._initted){if(QB(this,i<0?i:d,s,r))return this._tTime=0,this;if(c!==this._dur)return this.render(i,r,s)}if(this._tTime=u,this._time=d,!this._act&&this._ts&&(this._act=1,this._lazy=0),this.ratio=y=(x||this._ease)(d/c),this._from&&(this.ratio=y=1-y),d&&!a&&!r&&(Cr(this,"onStart"),this._tTime!==u))return this;for(h=this._pt;h;)h.r(y,h.d),h=h._next;m&&m.render(i<0?i:!d&&v?-Ft:m._dur*y,r,s)||this._startAt&&(this._zTime=i),this._onUpdate&&!r&&(i<0&&this._startAt&&this._startAt.render(i,!0,s),Cr(this,"onUpdate")),this._repeat&&f!==g&&this.vars.onRepeat&&!r&&this.parent&&Cr(this,"onRepeat"),(u===this._tDur||!u)&&this._tTime===u&&(i<0&&this._startAt&&!this._onUpdate&&this._startAt.render(i,!0,!0),(i||!c)&&(u===this._tDur&&this._ts>0||!u&&this._ts<0)&&ll(this,1),!r&&!(i<0&&!a)&&(u||a)&&(Cr(this,u===l?"onComplete":"onReverseComplete",!0),this._prom&&!(u<l&&this.timeScale()>0)&&this._prom()))}return this},t.targets=function(){return this._targets},t.invalidate=function(){return this._pt=this._op=this._startAt=this._onUpdate=this._lazy=this.ratio=0,this._ptLookup=[],this.timeline&&this.timeline.invalidate(),o.prototype.invalidate.call(this)},t.kill=function(i,r){if(r===void 0&&(r="all"),!i&&(!r||r==="all"))return this._lazy=this._pt=0,this.parent?Im(this):this;if(this.timeline){var s=this.timeline.totalDuration();return this.timeline.killTweensOf(i,r,ul&&ul.vars.overwrite!==!0)._first||Im(this),this.parent&&s!==this.timeline.totalDuration()&&Id(this,this._dur*this.timeline._tDur/s,0,1),this}var a=this._targets,l=i?Ar(i):a,c=this._ptLookup,u=this._pt,d,h,f,p,g,v,y;if((!r||r==="all")&&AQ(a,l))return r==="all"&&(this._pt=0),Im(this);for(d=this._op=this._op||[],r!=="all"&&(ti(r)&&(g={},Hi(r,function(m){return g[m]=1}),r=g),r=eee(a,r)),y=a.length;y--;)if(~l.indexOf(a[y])){h=c[y],r==="all"?(d[y]=r,p=h,f={}):(f=d[y]=d[y]||{},p=r);for(g in p)v=h&&h[g],v&&((!("kill"in v.d)||v.d.kill(g)===!0)&&bx(this,v,"_pt"),delete h[g]),f!=="all"&&(f[g]=1)}return this._initted&&!this._pt&&u&&Im(this),this},e.to=function(i,r){return new e(i,r,arguments[2])},e.from=function(i,r){return Lm(1,arguments)},e.delayedCall=function(i,r,s,a){return new e(r,0,{immediateRender:!1,lazy:!1,overwrite:!1,delay:i,onComplete:r,onReverseComplete:r,onCompleteParams:s,onReverseCompleteParams:s,callbackScope:a})},e.fromTo=function(i,r,s){return Lm(2,arguments)},e.set=function(i,r){return r.duration=0,r.repeatDelay||(r.repeat=0),new e(i,r)},e.killTweensOf=function(i,r,s){return on.killTweensOf(i,r,s)},e}(Fm);Tr(Pn.prototype,{_targets:[],_lazy:0,_startAt:0,_op:0,_onInit:0});Hi("staggerTo,staggerFrom,staggerFromTo",function(o){Pn[o]=function(){var e=new xi,t=eT.call(arguments,0);return t.splice(o==="staggerFromTo"?5:4,0,0),e[o].apply(e,t)}});var cT=function(e,t,n){return e[t]=n},gN=function(e,t,n){return e[t](n)},nee=function(e,t,n,i){return e[t](i.fp,n)},iee=function(e,t,n){return e.setAttribute(t,n)},Tx=function(e,t){return Wn(e[t])?gN:mx(e[t])&&e.setAttribute?iee:cT},yN=function(e,t){return t.set(t.t,t.p,Math.round((t.s+t.c*e)*1e6)/1e6,t)},ree=function(e,t){return t.set(t.t,t.p,!!(t.s+t.c*e),t)},uT=function(e,t){var n=t._pt,i="";if(!e&&t.b)i=t.b;else if(e===1&&t.e)i=t.e;else{for(;n;)i=n.p+(n.m?n.m(n.s+n.c*e):Math.round((n.s+n.c*e)*1e4)/1e4)+i,n=n._next;i+=t.c}t.set(t.t,t.p,i,t)},hT=function(e,t){for(var n=t._pt;n;)n.r(e,n.d),n=n._next},see=function(e,t,n,i){for(var r=this._pt,s;r;)s=r._next,r.p===i&&r.modifier(e,t,n),r=s},oee=function(e){for(var t=this._pt,n,i;t;)i=t._next,t.p===e&&!t.op||t.op===e?bx(this,t,"_pt"):t.dep||(n=1),t=i;return!n},aee=function(e,t,n,i){i.mSet(e,t,i.m.call(i.tween,n,i.mt),i)},dT=function(e){for(var t=e._pt,n,i,r,s;t;){for(n=t._next,i=r;i&&i.pr>t.pr;)i=i._next;(t._prev=i?i._prev:s)?t._prev._next=t:r=t,(t._next=i)?i._prev=t:s=t,t=n}e._pt=r},Ii=function(){function o(t,n,i,r,s,a,l,c,u){this.t=n,this.s=r,this.c=s,this.p=i,this.r=a||yN,this.d=l||this,this.set=c||cT,this.pr=u||0,this._next=t,t&&(t._prev=this)}var e=o.prototype;return e.modifier=function(n,i,r){this.mSet=this.mSet||this.set,this.set=aee,this.m=n,this.mt=r,this.tween=i},o}();Hi(YS+"parent,duration,ease,delay,overwrite,runBackwards,startAt,yoyo,immediateRender,repeat,repeatDelay,data,paused,reversed,lazy,callbackScope,stringFilter,id,yoyoEase,stagger,inherit,repeatRefresh,keyframes,autoRevert,scrollTrigger",function(o){return XS[o]=1});ar.TweenMax=ar.TweenLite=Pn;ar.TimelineLite=ar.TimelineMax=xi;on=new xi({sortChildren:!1,defaults:Cd,autoRemoveChildren:!0,id:"root",smoothChildTiming:!0});Pi.stringFilter=iT;var Ex={registerPlugin:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];t.forEach(function(i){return WQ(i)})},timeline:function(e){return new xi(e)},getTweensOf:function(e,t){return on.getTweensOf(e,t)},getProperty:function(e,t,n,i){ti(e)&&(e=Ar(e)[0]);var r=al(e||{}).get,s=n?jB:qB;return n==="native"&&(n=""),e&&(t?s((Ui[t]&&Ui[t].get||r)(e,t,n,i)):function(a,l,c){return s((Ui[a]&&Ui[a].get||r)(e,a,l,c))})},quickSetter:function(e,t,n){if(e=Ar(e),e.length>1){var i=e.map(function(u){return Lr.quickSetter(u,t,n)}),r=i.length;return function(u){for(var d=r;d--;)i[d](u)}}e=e[0]||{};var s=Ui[t],a=al(e),l=a.harness&&(a.harness.aliases||{})[t]||t,c=s?function(u){var d=new s;Dd._pt=0,d.init(e,n?u+n:u,Dd,0,[e]),d.render(1,d),Dd._pt&&hT(1,Dd)}:a.set(e,l);return s?c:function(u){return c(e,l,n?u+n:u,a,1)}},isTweening:function(e){return on.getTweensOf(e,!0).length>0},defaults:function(e){return e&&e.ease&&(e.ease=Bd(e.ease,Cd.ease)),YB(Cd,e||{})},config:function(e){return YB(Pi,e||{})},registerEffect:function(e){var t=e.name,n=e.effect,i=e.plugins,r=e.defaults,s=e.extendTimeline;(i||"").split(",").forEach(function(a){return a&&!Ui[a]&&!ar[a]&&vx(t+" effect requires "+a+" plugin.")}),jS[t]=function(a,l,c){return n(Ar(a),Tr(l||{},r),c)},s&&(xi.prototype[t]=function(a,l,c){return this.add(jS[t](a,zo(l)?l:(c=l)&&{},this),c)})},registerEase:function(e,t){xt[e]=Bd(t)},parseEase:function(e,t){return arguments.length?Bd(e,t):xt},getById:function(e){return on.getById(e)},exportRoot:function(e,t){e===void 0&&(e={});var n=new xi(e),i,r;for(n.smoothChildTiming=zi(e.smoothChildTiming),on.remove(n),n._dp=0,n._time=n._tTime=on._time,i=on._first;i;)r=i._next,(t||!(!i._dur&&i instanceof Pn&&i.vars.onComplete===i._targets[0]))&&Gs(n,i,i._start-i._delay),i=r;return Gs(on,n,0),n},utils:{wrap:HQ,wrapYoyo:GQ,distribute:iN,random:sN,snap:rN,normalize:UQ,getUnit:Gi,clamp:BQ,splitColor:cN,toArray:Ar,selector:OQ,mapRange:aN,pipe:kQ,unitize:zQ,interpolate:VQ,shuffle:nN},install:HB,effects:jS,ticker:lr,updateRoot:xi.updateRoot,plugins:Ui,globalTimeline:on,core:{PropTween:Ii,globals:GB,Tween:Pn,Timeline:xi,Animation:Fm,getCache:al,_removeLinkedListItem:bx,suppressOverwrites:function(e){return OS=e}}};Hi("to,from,fromTo,delayedCall,set,killTweensOf",function(o){return Ex[o]=Pn[o]});lr.add(xi.updateRoot);Dd=Ex.to({},{duration:0});var lee=function(e,t){for(var n=e._pt;n&&n.p!==t&&n.op!==t&&n.fp!==t;)n=n._next;return n},cee=function(e,t){var n=e._targets,i,r,s;for(i in t)for(r=n.length;r--;)s=e._ptLookup[r][i],s&&(s=s.d)&&(s._pt&&(s=lee(s,i)),s&&s.modifier&&s.modifier(t[i],e,n[r],i))},fT=function(e,t){return{name:e,rawVars:1,init:function(i,r,s){s._onInit=function(a){var l,c;if(ti(r)&&(l={},Hi(r,function(u){return l[u]=1}),r=l),t){l={};for(c in r)l[c]=t(r[c]);r=l}cee(a,r)}}}},Lr=Ex.registerPlugin({name:"attr",init:function(e,t,n,i,r){var s,a;for(s in t)a=this.add(e,"setAttribute",(e.getAttribute(s)||0)+"",t[s],i,r,0,0,s),a&&(a.op=s),this._props.push(s)}},{name:"endArray",init:function(e,t){for(var n=t.length;n--;)this.add(e,n,e[n]||0,t[n])}},fT("roundProps",tT),fT("modifiers"),fT("snap",rN))||Ex;Pn.version=xi.version=Lr.version="3.7.1";UB=1;NB()&&Fd();var uee=xt.Power0,hee=xt.Power1,dee=xt.Power2,fee=xt.Power3,pee=xt.Power4,mee=xt.Linear,gee=xt.Quad,yee=xt.Cubic,vee=xt.Quart,xee=xt.Quint,_ee=xt.Strong,wee=xt.Elastic,bee=xt.Back,Mee=xt.SteppedEase,See=xt.Bounce,Tee=xt.Sine,Eee=xt.Expo,Aee=xt.Circ;var vN,hl,Nd,pT,Ic,Cee,xN,Lee=function(){return typeof window!="undefined"},dl={},Dc=180/Math.PI,Od=Math.PI/180,kd=Math.atan2,_N=1e8,wN=/([A-Z])/g,Ree=/(?:left|right|width|margin|padding|x)/i,Pee=/[\s,\(]\S/,fl={autoAlpha:"opacity,visibility",scale:"scaleX,scaleY",alpha:"opacity"},bN=function(e,t){return t.set(t.t,t.p,Math.round((t.s+t.c*e)*1e4)/1e4+t.u,t)},Iee=function(e,t){return t.set(t.t,t.p,e===1?t.e:Math.round((t.s+t.c*e)*1e4)/1e4+t.u,t)},Dee=function(e,t){return t.set(t.t,t.p,e?Math.round((t.s+t.c*e)*1e4)/1e4+t.u:t.b,t)},Fee=function(e,t){var n=t.s+t.c*e;t.set(t.t,t.p,~~(n+(n<0?-.5:.5))+t.u,t)},MN=function(e,t){return t.set(t.t,t.p,e?t.e:t.b,t)},SN=function(e,t){return t.set(t.t,t.p,e!==1?t.b:t.e,t)},Bee=function(e,t,n){return e.style[t]=n},Nee=function(e,t,n){return e.style.setProperty(t,n)},Oee=function(e,t,n){return e._gsap[t]=n},kee=function(e,t,n){return e._gsap.scaleX=e._gsap.scaleY=n},zee=function(e,t,n,i,r){var s=e._gsap;s.scaleX=s.scaleY=n,s.renderTransform(r,s)},Uee=function(e,t,n,i,r){var s=e._gsap;s[t]=n,s.renderTransform(r,s)},ni="transform",pl=ni+"Origin",TN,mT=function(e,t){var n=hl.createElementNS?hl.createElementNS((t||"http://www.w3.org/1999/xhtml").replace(/^https/,"http"),e):hl.createElement(e);return n.style?n:hl.createElement(e)},Ho=function o(e,t,n){var i=getComputedStyle(e);return i[t]||i.getPropertyValue(t.replace(wN,"-$1").toLowerCase())||i.getPropertyValue(t)||!n&&o(e,zd(t)||t,1)||""},EN="O,Moz,ms,Ms,Webkit".split(","),zd=function(e,t,n){var i=t||Ic,r=i.style,s=5;if(e in r&&!n)return e;for(e=e.charAt(0).toUpperCase()+e.substr(1);s--&&!(EN[s]+e in r););return s<0?null:(s===3?"ms":s>=0?EN[s]:"")+e},gT=function(){Lee()&&window.document&&(vN=window,hl=vN.document,Nd=hl.documentElement,Ic=mT("div")||{style:{}},Cee=mT("div"),ni=zd(ni),pl=ni+"Origin",Ic.style.cssText="border-width:0;line-height:0;position:absolute;padding:0",TN=!!zd("perspective"),pT=1)},yT=function o(e){var t=mT("svg",this.ownerSVGElement&&this.ownerSVGElement.getAttribute("xmlns")||"http://www.w3.org/2000/svg"),n=this.parentNode,i=this.nextSibling,r=this.style.cssText,s;if(Nd.appendChild(t),t.appendChild(this),this.style.display="block",e)try{s=this.getBBox(),this._gsapBBox=this.getBBox,this.getBBox=o}catch(a){}else this._gsapBBox&&(s=this._gsapBBox());return n&&(i?n.insertBefore(this,i):n.appendChild(this)),Nd.removeChild(t),this.style.cssText=r,s},AN=function(e,t){for(var n=t.length;n--;)if(e.hasAttribute(t[n]))return e.getAttribute(t[n])},CN=function(e){var t;try{t=e.getBBox()}catch(n){t=yT.call(e,!0)}return t&&(t.width||t.height)||e.getBBox===yT||(t=yT.call(e,!0)),t&&!t.width&&!t.x&&!t.y?{x:+AN(e,["x","cx","x1"])||0,y:+AN(e,["y","cy","y1"])||0,width:0,height:0}:t},LN=function(e){return!!(e.getCTM&&(!e.parentNode||e.ownerSVGElement)&&CN(e))},Nm=function(e,t){if(t){var n=e.style;t in dl&&t!==pl&&(t=ni),n.removeProperty?((t.substr(0,2)==="ms"||t.substr(0,6)==="webkit")&&(t="-"+t),n.removeProperty(t.replace(wN,"-$1").toLowerCase())):n.removeAttribute(t)}},ml=function(e,t,n,i,r,s){var a=new Ii(e._pt,t,n,0,1,s?SN:MN);return e._pt=a,a.b=i,a.e=r,e._props.push(n),a},RN={deg:1,rad:1,turn:1},gl=function o(e,t,n,i){var r=parseFloat(n)||0,s=(n+"").trim().substr((r+"").length)||"px",a=Ic.style,l=Ree.test(t),c=e.tagName.toLowerCase()==="svg",u=(c?"client":"offset")+(l?"Width":"Height"),d=100,h=i==="px",f=i==="%",p,g,v,y;return i===s||!r||RN[i]||RN[s]?r:(s!=="px"&&!h&&(r=o(e,t,n,"px")),y=e.getCTM&&LN(e),(f||s==="%")&&(dl[t]||~t.indexOf("adius"))?(p=y?e.getBBox()[l?"width":"height"]:e[u],mt(f?r/p*d:r/100*p)):(a[l?"width":"height"]=d+(h?s:i),g=~t.indexOf("adius")||i==="em"&&e.appendChild&&!c?e:e.parentNode,y&&(g=(e.ownerSVGElement||{}).parentNode),(!g||g===hl||!g.appendChild)&&(g=hl.body),v=g._gsap,v&&f&&v.width&&l&&v.time===lr.time?mt(r/v.width*d):((f||s==="%")&&(a.position=Ho(e,"position")),g===e&&(a.position="static"),g.appendChild(Ic),p=Ic[u],g.removeChild(Ic),a.position="absolute",l&&f&&(v=al(g),v.time=lr.time,v.width=g[u]),mt(h?p*r/d:p&&r?d/p*r:0))))},Ud=function(e,t,n,i){var r;return pT||gT(),t in fl&&t!=="transform"&&(t=fl[t],~t.indexOf(",")&&(t=t.split(",")[0])),dl[t]&&t!=="transform"?(r=km(e,i),r=t!=="transformOrigin"?r[t]:r.svg?r.origin:Cx(Ho(e,pl))+" "+r.zOrigin+"px"):(r=e.style[t],(!r||r==="auto"||i||~(r+"").indexOf("calc("))&&(r=Ax[t]&&Ax[t](e,t,n)||Ho(e,t)||JS(e,t)||(t==="opacity"?1:0))),n&&!~(r+"").trim().indexOf(" ")?gl(e,t,r,n)+n:r},Hee=function(e,t,n,i){if(!n||n==="none"){var r=zd(t,e,1),s=r&&Ho(e,r,1);s&&s!==n?(t=r,n=s):t==="borderColor"&&(n=Ho(e,"borderTopColor"))}var a=new Ii(this._pt,e.style,t,0,1,uT),l=0,c=0,u,d,h,f,p,g,v,y,m,x,_,w,b;if(a.b=n,a.e=i,n+="",i+="",i==="auto"&&(e.style[t]=i,i=Ho(e,t)||i,e.style[t]=n),u=[n,i],iT(u),n=u[0],i=u[1],h=n.match(Lc)||[],b=i.match(Lc)||[],b.length){for(;d=Lc.exec(i);)v=d[0],m=i.substring(l,d.index),p?p=(p+1)%5:(m.substr(-5)==="rgba("||m.substr(-5)==="hsla(")&&(p=1),v!==(g=h[c++]||"")&&(f=parseFloat(g)||0,_=g.substr((f+"").length),w=v.charAt(1)==="="?+(v.charAt(0)+"1"):0,w&&(v=v.substr(2)),y=parseFloat(v),x=v.substr((y+"").length),l=Lc.lastIndex-x.length,x||(x=x||Pi.units[t]||_,l===i.length&&(i+=x,a.e+=x)),_!==x&&(f=gl(e,t,g,x)||0),a._pt={_next:a._pt,p:m||c===1?m:",",s:f,c:w?w*y:y-f,m:p&&p<4||t==="zIndex"?Math.round:0});a.c=l<i.length?i.substring(l,i.length):""}else a.r=t==="display"&&i==="none"?SN:MN;return GS.test(i)&&(a.e=0),this._pt=a,a},PN={top:"0%",bottom:"100%",left:"0%",right:"100%",center:"50%"},Gee=function(e){var t=e.split(" "),n=t[0],i=t[1]||"50%";return(n==="top"||n==="bottom"||i==="left"||i==="right")&&(e=n,n=i,i=e),t[0]=PN[n]||n,t[1]=PN[i]||i,t.join(" ")},Vee=function(e,t){if(t.tween&&t.tween._time===t.tween._dur){var n=t.t,i=n.style,r=t.u,s=n._gsap,a,l,c;if(r==="all"||r===!0)i.cssText="",l=1;else for(r=r.split(","),c=r.length;--c>-1;)a=r[c],dl[a]&&(l=1,a=a==="transformOrigin"?pl:ni),Nm(n,a);l&&(Nm(n,ni),s&&(s.svg&&n.removeAttribute("transform"),km(n,1),s.uncache=1))}},Ax={clearProps:function(e,t,n,i,r){if(r.data!=="isFromStart"){var s=e._pt=new Ii(e._pt,t,n,0,0,Vee);return s.u=i,s.pr=-10,s.tween=r,e._props.push(n),1}}},Om=[1,0,0,1,0,0],IN={},DN=function(e){return e==="matrix(1, 0, 0, 1, 0, 0)"||e==="none"||!e},FN=function(e){var t=Ho(e,ni);return DN(t)?Om:t.substr(7).match(US).map(mt)},vT=function(e,t){var n=e._gsap||al(e),i=e.style,r=FN(e),s,a,l,c;return n.svg&&e.getAttribute("transform")?(l=e.transform.baseVal.consolidate().matrix,r=[l.a,l.b,l.c,l.d,l.e,l.f],r.join(",")==="1,0,0,1,0,0"?Om:r):(r===Om&&!e.offsetParent&&e!==Nd&&!n.svg&&(l=i.display,i.display="block",s=e.parentNode,(!s||!e.offsetParent)&&(c=1,a=e.nextSibling,Nd.appendChild(e)),r=FN(e),l?i.display=l:Nm(e,"display"),c&&(a?s.insertBefore(e,a):s?s.appendChild(e):Nd.removeChild(e))),t&&r.length>6?[r[0],r[1],r[4],r[5],r[12],r[13]]:r)},xT=function(e,t,n,i,r,s){var a=e._gsap,l=r||vT(e,!0),c=a.xOrigin||0,u=a.yOrigin||0,d=a.xOffset||0,h=a.yOffset||0,f=l[0],p=l[1],g=l[2],v=l[3],y=l[4],m=l[5],x=t.split(" "),_=parseFloat(x[0])||0,w=parseFloat(x[1])||0,b,M,S,E;n?l!==Om&&(M=f*v-p*g)&&(S=_*(v/M)+w*(-g/M)+(g*m-v*y)/M,E=_*(-p/M)+w*(f/M)-(f*m-p*y)/M,_=S,w=E):(b=CN(e),_=b.x+(~x[0].indexOf("%")?_/100*b.width:_),w=b.y+(~(x[1]||x[0]).indexOf("%")?w/100*b.height:w)),i||i!==!1&&a.smooth?(y=_-c,m=w-u,a.xOffset=d+(y*f+m*g)-y,a.yOffset=h+(y*p+m*v)-m):a.xOffset=a.yOffset=0,a.xOrigin=_,a.yOrigin=w,a.smooth=!!i,a.origin=t,a.originIsAbsolute=!!n,e.style[pl]="0px 0px",s&&(ml(s,a,"xOrigin",c,_),ml(s,a,"yOrigin",u,w),ml(s,a,"xOffset",d,a.xOffset),ml(s,a,"yOffset",h,a.yOffset)),e.setAttribute("data-svg-origin",_+" "+w)},km=function(e,t){var n=e._gsap||new oT(e);if("x"in n&&!t&&!n.uncache)return n;var i=e.style,r=n.scaleX<0,s="px",a="deg",l=Ho(e,pl)||"0",c,u,d,h,f,p,g,v,y,m,x,_,w,b,M,S,E,A,L,B,R,D,P,I,N,G,z,se,ne,Q,j,O;return c=u=d=p=g=v=y=m=x=0,h=f=1,n.svg=!!(e.getCTM&&LN(e)),b=vT(e,n.svg),n.svg&&(I=(!n.uncache||l==="0px 0px")&&!t&&e.getAttribute("data-svg-origin"),xT(e,I||l,!!I||n.originIsAbsolute,n.smooth!==!1,b)),_=n.xOrigin||0,w=n.yOrigin||0,b!==Om&&(A=b[0],L=b[1],B=b[2],R=b[3],c=D=b[4],u=P=b[5],b.length===6?(h=Math.sqrt(A*A+L*L),f=Math.sqrt(R*R+B*B),p=A||L?kd(L,A)*Dc:0,y=B||R?kd(B,R)*Dc+p:0,y&&(f*=Math.abs(Math.cos(y*Od))),n.svg&&(c-=_-(_*A+w*B),u-=w-(_*L+w*R))):(O=b[6],Q=b[7],z=b[8],se=b[9],ne=b[10],j=b[11],c=b[12],u=b[13],d=b[14],M=kd(O,ne),g=M*Dc,M&&(S=Math.cos(-M),E=Math.sin(-M),I=D*S+z*E,N=P*S+se*E,G=O*S+ne*E,z=D*-E+z*S,se=P*-E+se*S,ne=O*-E+ne*S,j=Q*-E+j*S,D=I,P=N,O=G),M=kd(-B,ne),v=M*Dc,M&&(S=Math.cos(-M),E=Math.sin(-M),I=A*S-z*E,N=L*S-se*E,G=B*S-ne*E,j=R*E+j*S,A=I,L=N,B=G),M=kd(L,A),p=M*Dc,M&&(S=Math.cos(M),E=Math.sin(M),I=A*S+L*E,N=D*S+P*E,L=L*S-A*E,P=P*S-D*E,A=I,D=N),g&&Math.abs(g)+Math.abs(p)>359.9&&(g=p=0,v=180-v),h=mt(Math.sqrt(A*A+L*L+B*B)),f=mt(Math.sqrt(P*P+O*O)),M=kd(D,P),y=Math.abs(M)>2e-4?M*Dc:0,x=j?1/(j<0?-j:j):0),n.svg&&(I=e.getAttribute("transform"),n.forceCSS=e.setAttribute("transform","")||!DN(Ho(e,ni)),I&&e.setAttribute("transform",I))),Math.abs(y)>90&&Math.abs(y)<270&&(r?(h*=-1,y+=p<=0?180:-180,p+=p<=0?180:-180):(f*=-1,y+=y<=0?180:-180)),n.x=c-((n.xPercent=c&&(n.xPercent||(Math.round(e.offsetWidth/2)===Math.round(-c)?-50:0)))?e.offsetWidth*n.xPercent/100:0)+s,n.y=u-((n.yPercent=u&&(n.yPercent||(Math.round(e.offsetHeight/2)===Math.round(-u)?-50:0)))?e.offsetHeight*n.yPercent/100:0)+s,n.z=d+s,n.scaleX=mt(h),n.scaleY=mt(f),n.rotation=mt(p)+a,n.rotationX=mt(g)+a,n.rotationY=mt(v)+a,n.skewX=y+a,n.skewY=m+a,n.transformPerspective=x+s,(n.zOrigin=parseFloat(l.split(" ")[2])||0)&&(i[pl]=Cx(l)),n.xOffset=n.yOffset=0,n.force3D=Pi.force3D,n.renderTransform=n.svg?Xee:TN?BN:Wee,n.uncache=0,n},Cx=function(e){return(e=e.split(" "))[0]+" "+e[1]},_T=function(e,t,n){var i=Gi(t);return mt(parseFloat(t)+parseFloat(gl(e,"x",n+"px",i)))+i},Wee=function(e,t){t.z="0px",t.rotationY=t.rotationX="0deg",t.force3D=0,BN(e,t)},Fc="0deg",zm="0px",Bc=") ",BN=function(e,t){var n=t||this,i=n.xPercent,r=n.yPercent,s=n.x,a=n.y,l=n.z,c=n.rotation,u=n.rotationY,d=n.rotationX,h=n.skewX,f=n.skewY,p=n.scaleX,g=n.scaleY,v=n.transformPerspective,y=n.force3D,m=n.target,x=n.zOrigin,_="",w=y==="auto"&&e&&e!==1||y===!0;if(x&&(d!==Fc||u!==Fc)){var b=parseFloat(u)*Od,M=Math.sin(b),S=Math.cos(b),E;b=parseFloat(d)*Od,E=Math.cos(b),s=_T(m,s,M*E*-x),a=_T(m,a,-Math.sin(b)*-x),l=_T(m,l,S*E*-x+x)}v!==zm&&(_+="perspective("+v+Bc),(i||r)&&(_+="translate("+i+"%, "+r+"%) "),(w||s!==zm||a!==zm||l!==zm)&&(_+=l!==zm||w?"translate3d("+s+", "+a+", "+l+") ":"translate("+s+", "+a+Bc),c!==Fc&&(_+="rotate("+c+Bc),u!==Fc&&(_+="rotateY("+u+Bc),d!==Fc&&(_+="rotateX("+d+Bc),(h!==Fc||f!==Fc)&&(_+="skew("+h+", "+f+Bc),(p!==1||g!==1)&&(_+="scale("+p+", "+g+Bc),m.style[ni]=_||"translate(0, 0)"},Xee=function(e,t){var n=t||this,i=n.xPercent,r=n.yPercent,s=n.x,a=n.y,l=n.rotation,c=n.skewX,u=n.skewY,d=n.scaleX,h=n.scaleY,f=n.target,p=n.xOrigin,g=n.yOrigin,v=n.xOffset,y=n.yOffset,m=n.forceCSS,x=parseFloat(s),_=parseFloat(a),w,b,M,S,E;l=parseFloat(l),c=parseFloat(c),u=parseFloat(u),u&&(u=parseFloat(u),c+=u,l+=u),l||c?(l*=Od,c*=Od,w=Math.cos(l)*d,b=Math.sin(l)*d,M=Math.sin(l-c)*-h,S=Math.cos(l-c)*h,c&&(u*=Od,E=Math.tan(c-u),E=Math.sqrt(1+E*E),M*=E,S*=E,u&&(E=Math.tan(u),E=Math.sqrt(1+E*E),w*=E,b*=E)),w=mt(w),b=mt(b),M=mt(M),S=mt(S)):(w=d,S=h,b=M=0),(x&&!~(s+"").indexOf("px")||_&&!~(a+"").indexOf("px"))&&(x=gl(f,"x",s,"px"),_=gl(f,"y",a,"px")),(p||g||v||y)&&(x=mt(x+p-(p*w+g*M)+v),_=mt(_+g-(p*b+g*S)+y)),(i||r)&&(E=f.getBBox(),x=mt(x+i/100*E.width),_=mt(_+r/100*E.height)),E="matrix("+w+","+b+","+M+","+S+","+x+","+_+")",f.setAttribute("transform",E),m&&(f.style[ni]=E)},qee=function(e,t,n,i,r,s){var a=360,l=ti(r),c=parseFloat(r)*(l&&~r.indexOf("rad")?Dc:1),u=s?c*s:c-i,d=i+u+"deg",h,f;return l&&(h=r.split("_")[1],h==="short"&&(u%=a,u!==u%(a/2)&&(u+=u<0?a:-a)),h==="cw"&&u<0?u=(u+a*_N)%a-~~(u/a)*a:h==="ccw"&&u>0&&(u=(u-a*_N)%a-~~(u/a)*a)),e._pt=f=new Ii(e._pt,t,n,i,u,Iee),f.e=d,f.u="deg",e._props.push(n),f},NN=function(e,t){for(var n in t)e[n]=t[n];return e},jee=function(e,t,n){var i=NN({},n._gsap),r="perspective,force3D,transformOrigin,svgOrigin",s=n.style,a,l,c,u,d,h,f,p;i.svg?(c=n.getAttribute("transform"),n.setAttribute("transform",""),s[ni]=t,a=km(n,1),Nm(n,ni),n.setAttribute("transform",c)):(c=getComputedStyle(n)[ni],s[ni]=t,a=km(n,1),s[ni]=c);for(l in dl)c=i[l],u=a[l],c!==u&&r.indexOf(l)<0&&(f=Gi(c),p=Gi(u),d=f!==p?gl(n,l,c,p):parseFloat(c),h=parseFloat(u),e._pt=new Ii(e._pt,a,l,d,h-d,bN),e._pt.u=p||0,e._props.push(l));NN(a,i)};Hi("padding,margin,Width,Radius",function(o,e){var t="Top",n="Right",i="Bottom",r="Left",s=(e<3?[t,n,i,r]:[t+r,t+n,i+n,i+r]).map(function(a){return e<2?o+a:"border"+a+o});Ax[e>1?"border"+o:o]=function(a,l,c,u,d){var h,f;if(arguments.length<4)return h=s.map(function(p){return Ud(a,p,c)}),f=h.join(" "),f.split(h[0]).length===5?h[0]:f;h=(u+"").split(" "),f={},s.forEach(function(p,g){return f[p]=h[g]=h[g]||h[(g-1)/2|0]}),a.init(l,f,d)}});var wT={name:"css",register:gT,targetTest:function(e){return e.style&&e.nodeType},init:function(e,t,n,i,r){var s=this._props,a=e.style,l=n.vars.startAt,c,u,d,h,f,p,g,v,y,m,x,_,w,b,M;pT||gT();for(g in t)if(g!=="autoRound"&&(u=t[g],!(Ui[g]&&lT(g,t,n,i,e,r)))){if(f=typeof u,p=Ax[g],f==="function"&&(u=u.call(n,i,e,r),f=typeof u),f==="string"&&~u.indexOf("random(")&&(u=Pm(u)),p)p(this,e,g,u,n)&&(M=1);else if(g.substr(0,2)==="--")c=(getComputedStyle(e).getPropertyValue(g)+"").trim(),u+="",Uo.lastIndex=0,Uo.test(c)||(v=Gi(c),y=Gi(u)),y?v!==y&&(c=gl(e,g,c,y)+y):v&&(u+=v),this.add(a,"setProperty",c,u,i,r,0,0,g),s.push(g);else if(f!=="undefined"){if(l&&g in l?(c=typeof l[g]=="function"?l[g].call(n,i,e,r):l[g],g in Pi.units&&!Gi(c)&&(c+=Pi.units[g]),(c+"").charAt(1)==="="&&(c=Ud(e,g))):c=Ud(e,g),h=parseFloat(c),m=f==="string"&&u.charAt(1)==="="?+(u.charAt(0)+"1"):0,m&&(u=u.substr(2)),d=parseFloat(u),g in fl&&(g==="autoAlpha"&&(h===1&&Ud(e,"visibility")==="hidden"&&d&&(h=0),ml(this,a,"visibility",h?"inherit":"hidden",d?"inherit":"hidden",!d)),g!=="scale"&&g!=="transform"&&(g=fl[g],~g.indexOf(",")&&(g=g.split(",")[0]))),x=g in dl,x){if(_||(w=e._gsap,w.renderTransform&&!t.parseTransform||km(e,t.parseTransform),b=t.smoothOrigin!==!1&&w.smooth,_=this._pt=new Ii(this._pt,a,ni,0,1,w.renderTransform,w,0,-1),_.dep=1),g==="scale")this._pt=new Ii(this._pt,w,"scaleY",w.scaleY,(m?m*d:d-w.scaleY)||0),s.push("scaleY",g),g+="X";else if(g==="transformOrigin"){u=Gee(u),w.svg?xT(e,u,0,b,0,this):(y=parseFloat(u.split(" ")[2])||0,y!==w.zOrigin&&ml(this,w,"zOrigin",w.zOrigin,y),ml(this,a,g,Cx(c),Cx(u)));continue}else if(g==="svgOrigin"){xT(e,u,1,b,0,this);continue}else if(g in IN){qee(this,w,g,h,u,m);continue}else if(g==="smoothOrigin"){ml(this,w,"smooth",w.smooth,u);continue}else if(g==="force3D"){w[g]=u;continue}else if(g==="transform"){jee(this,u,e);continue}}else g in a||(g=zd(g)||g);if(x||(d||d===0)&&(h||h===0)&&!Pee.test(u)&&g in a)v=(c+"").substr((h+"").length),d||(d=0),y=Gi(u)||(g in Pi.units?Pi.units[g]:v),v!==y&&(h=gl(e,g,c,y)),this._pt=new Ii(this._pt,x?w:a,g,h,m?m*d:d-h,!x&&(y==="px"||g==="zIndex")&&t.autoRound!==!1?Fee:bN),this._pt.u=y||0,v!==y&&(this._pt.b=c,this._pt.r=Dee);else if(g in a)Hee.call(this,e,g,c,u);else if(g in e)this.add(e,g,c||e[g],u,i,r);else{yx(g,u);continue}s.push(g)}}M&&dT(this)},get:Ud,aliases:fl,getSetter:function(e,t,n){var i=fl[t];return i&&i.indexOf(",")<0&&(t=i),t in dl&&t!==pl&&(e._gsap.x||Ud(e,"x"))?n&&xN===n?t==="scale"?kee:Oee:(xN=n||{})&&(t==="scale"?zee:Uee):e.style&&!mx(e.style[t])?Bee:~t.indexOf("-")?Nee:Tx(e,t)},core:{_removeProperty:Nm,_getMatrix:vT}};Lr.utils.checkPrefix=zd;(function(o,e,t,n){var i=Hi(o+","+e+","+t,function(r){dl[r]=1});Hi(e,function(r){Pi.units[r]="deg",IN[r]=1}),fl[i[13]]=o+","+e,Hi(n,function(r){var s=r.split(":");fl[s[1]]=i[s[0]]})})("x,y,z,scale,scaleX,scaleY,xPercent,yPercent","rotation,rotationX,rotationY,skewX,skewY","transform,transformOrigin,svgOrigin,force3D,smoothOrigin,transformPerspective","0:translateX,1:translateY,2:translateZ,8:rotate,8:rotationZ,8:rotateZ,9:rotateX,10:rotateY");Hi("x,y,z,top,right,bottom,left,width,height,fontSize,padding,margin,perspective",function(o){Pi.units[o]="px"});Lr.registerPlugin(wT);var Vs=Lr.registerPlugin(wT)||Lr,Nae=Vs.core.Tween;function Nc(o=class{}){return class extends o{constructor(t){super(t);this.isBoxComponent=!0,this.childrenPos={}}getInnerWidth(){let t=this.getContentDirection();switch(t){case"row":case"row-reverse":return this.width-(this.padding*2||0)||this.getChildrenSideSum("width");case"column":case"column-reverse":return this.getHighestChildSizeOn("width");default:console.error(`Invalid contentDirection : ${t}`);break}}getInnerHeight(){let t=this.getContentDirection();switch(t){case"row":case"row-reverse":return this.getHighestChildSizeOn("height");case"column":case"column-reverse":return this.height-(this.padding*2||0)||this.getChildrenSideSum("height");default:console.error(`Invalid contentDirection : ${t}`);break}}getChildrenSideSum(t){return this.children.reduce((n,i)=>{if(!i.isBoxComponent)return n;let r=i.margin*2||0,s=t==="width"?i.getWidth()+r:i.getHeight()+r;return n+s},0)}setPosFromParentRecords(){this.getUIParent()&&this.getUIParent().childrenPos[this.id]&&(this.position.x=this.getUIParent().childrenPos[this.id].x,this.position.y=this.getUIParent().childrenPos[this.id].y)}computeChildrenPosition(){if(this.children.length>0){let t=this.getContentDirection(),n,i;switch(t){case"row":n=this.getInnerWidth()/2,this.setChildrenXPos(-n),this.alignChildrenOnY();break;case"row-reverse":n=this.getInnerWidth()/2,this.setChildrenXPos(n),this.alignChildrenOnY();break;case"column":i=this.getInnerHeight()/2,this.setChildrenYPos(i),this.alignChildrenOnX();break;case"column-reverse":i=this.getInnerHeight()/2,this.setChildrenYPos(-i),this.alignChildrenOnX();break}}}setChildrenXPos(t){let n=this.getJustifyContent();if(n!=="center"&&n!=="start"&&n!=="end"&&console.warn(`justifiyContent === '${n}' is not supported`),this.children.reduce((i,r)=>{if(!r.isBoxComponent)return i;let s=r.id,a=r.getWidth(),l=r.margin||0;return i+=l*-Math.sign(t),this.childrenPos[s]={x:i+a/2*-Math.sign(t),y:0},i+-Math.sign(t)*(a+l)},t),n==="end"||n==="center"){let i=t*2-this.getChildrenSideSum("width")*Math.sign(t);n==="center"&&(i/=2),this.children.forEach(r=>{!r.isBoxComponent||(this.childrenPos[r.id].x-=i)})}}setChildrenYPos(t){let n=this.getJustifyContent();if(this.children.reduce((i,r)=>{if(!r.isBoxComponent)return i;let s=r.id,a=r.getHeight(),l=r.margin||0;return i+=l*-Math.sign(t),this.childrenPos[s]={x:0,y:i+a/2*-Math.sign(t)},i+-Math.sign(t)*(a+l)},t),n==="end"||n==="center"){let i=t*2-this.getChildrenSideSum("height")*Math.sign(t);n==="center"&&(i/=2),this.children.forEach(r=>{!r.isBoxComponent||(this.childrenPos[r.id].y-=i)})}}alignChildrenOnX(){let t=this.getAlignContent(),n=this.getWidth()/2-(this.padding||0);t!=="center"&&t!=="right"&&t!=="left"&&console.warn(`alignContent === '${t}' is not supported on this direction.`),this.children.forEach(i=>{if(!i.isBoxComponent)return;let r;t==="right"?r=n-i.getWidth()/2-(i.margin||0):t==="left"&&(r=-n+i.getWidth()/2+(i.margin||0)),this.childrenPos[i.id].x=r||0})}alignChildrenOnY(){let t=this.getAlignContent(),n=this.getHeight()/2-(this.padding||0);t!=="center"&&t!=="top"&&t!=="bottom"&&console.warn(`alignContent === '${t}' is not supported on this direction.`),this.children.forEach(i=>{if(!i.isBoxComponent)return;let r;t==="top"?r=n-i.getHeight()/2-(i.margin||0):t==="bottom"&&(r=-n+i.getHeight()/2+(i.margin||0)),this.childrenPos[i.id].y=r||0})}getHighestChildSizeOn(t){return this.children.reduce((n,i)=>{if(!i.isBoxComponent)return n;let r=i.margin||0,s=t==="width"?i.getWidth()+r*2:i.getHeight()+r*2;return Math.max(n,s)},0)}getWidth(){return this.width||this.getInnerWidth()+(this.padding*2||0)}getHeight(){return this.height||this.getInnerHeight()+(this.padding*2||0)}}}function Um(o=class{}){return class extends o{computeInlinesPosition(){let t=this.getWidth()-(this.padding*2||0),n=[[]];this.children.filter(u=>!!u.isInline).reduce((u,d)=>d.inlines?d.inlines.reduce((f,p,g,v)=>{let y=this.distanceToNextBreak(v,g);return f+p.width>t||p.lineBreak==="mandatory"||this.shouldFriendlyBreak(v[g-1],f,y,t)?(n.push([p]),p.offsetX=0,p.width):(n[n.length-1].push(p),p.offsetX=f,f+p.width)},u):void 0,0);let i=this.getHeight()-(this.padding*2||0),r=this.getJustifyContent(),s=this.getAlignContent(),a=this.getInterLine();n.forEach(u=>{u.lowestPoint=u.reduce((d,h)=>d<h.anchor?h.anchor:d,0),u.heighestPoint=u.reduce((d,h)=>{let f=h.height-h.anchor;return d<f?f:d},0),u.totalHeight=u.lowestPoint+u.heighestPoint,u.width=u.reduce((d,h)=>d+h.width,0)});let l=n.reduce((u,d,h,f)=>(d.forEach(p=>{p.offsetY=u-d.totalHeight+d.lowestPoint+f[0].totalHeight}),u-d.totalHeight-a),0)+a;l=Math.abs(l);let c=(()=>{switch(r){case"start":return i/2-n[0].totalHeight;case"end":return l-n[0].totalHeight-i/2+(n[n.length-1].totalHeight-n[n.length-1].totalHeight);case"center":return l/2-n[0].totalHeight;default:console.warn(`justifyContent: '${r}' is not valid`)}})();n.forEach(u=>{u.forEach(d=>{d.offsetY+=c})}),n.forEach(u=>{let d=(()=>{switch(s){case"left":return-t/2;case"right":return-u.width+t/2;case"center":return-u.width/2;default:console.warn(`alignContent: '${s}' is not valid`)}})();u.forEach(h=>{h.offsetX+=d})})}distanceToNextBreak(t,n,i){return i=i||0,t[n]?t[n].lineBreak?i+t[n].width:this.distanceToNextBreak(t,n+1,i+t[n].width):i}shouldFriendlyBreak(t,n,i,r){return!t||!t.glyph||n+i<r?!1:this.getBreakOn().indexOf(t.glyph)>-1}}}var Yee=new Sc,bT=[],Lx={},Zee=new nl,MT=[],Rx={},_i={};function Jee(o,e){typeof e=="string"?$ee(o,e):(_i[o.id]||(_i[o.id]={component:o}),_i[o.id].json=e,o._updateFontFamily(e))}function Kee(o,e){MT.indexOf(e)===-1&&(MT.push(e),Zee.load(e,t=>{Rx[e]=t;for(let n of Object.keys(_i))e===_i[n].textureURL&&_i[n].component._updateFontTexture(t)})),_i[o.id]||(_i[o.id]={component:o}),_i[o.id].textureURL=e,Rx[e]&&o._updateFontTexture(Rx[e])}function ON(o){let e=_i[o.id];return!e&&o.getUIParent()?ON(o.getUIParent()):e}function $ee(o,e){bT.indexOf(e)===-1&&(bT.push(e),Yee.load(e,t=>{let n=JSON.parse(t);Lx[e]=n;for(let i of Object.keys(_i))e===_i[i].jsonURL&&_i[i].component._updateFontFamily(n)})),_i[o.id]||(_i[o.id]={component:o}),_i[o.id].jsonURL=e,Lx[e]&&o._updateFontFamily(Lx[e])}function Qee(o,e,t){bT.push(o),Lx[o]=e,t&&(MT.push(o),Rx[o]=t)}var ete={setFontFamily:Jee,setFontTexture:Kee,getFontOf:ON,addFont:Qee},Oc=ete;var Rr=class{static requestUpdate(e,t,n,i){e.traverse(r=>{!r.isUI||(this.requestedUpdates[r.id]?(t&&(this.requestedUpdates[r.id].updateParsing=!0),n&&(this.requestedUpdates[r.id].updateLayout=!0),i&&(this.requestedUpdates[r.id].updateInner=!0)):this.requestedUpdates[r.id]={updateParsing:t,updateLayout:n,updateInner:i,needCallback:t||n||i})})}static register(e){this.components.includes(e)||this.components.push(e)}static disposeOf(e){let t=this.components.indexOf(e);t>-1&&this.components.splice(t,1)}static update(){if(Object.keys(this.requestedUpdates).length>0){let e=this.components.filter(t=>!t.getUIParent());e.forEach(t=>this.traverseParsing(t)),e.forEach(t=>this.traverseUpdates(t))}}static traverseParsing(e){let t=this.requestedUpdates[e.id];t&&t.updateParsing&&(e.parseParams(),t.updateParsing=!1),e.getUIChildren().forEach(n=>this.traverseParsing(n))}static traverseUpdates(e){let t=this.requestedUpdates[e.id];t&&t.updateLayout&&(t.updateLayout=!1,e.updateLayout()),t&&t.updateInner&&(t.updateInner=!1,e.updateInner()),t&&t.needCallback&&e.onAfterUpdate(),delete this.requestedUpdates[e.id],e.getUIChildren().forEach(n=>{this.traverseUpdates(n)})}};Rr.components=[];Rr.requestedUpdates={};var wi={container:null,fontFamily:null,fontSize:.05,offset:.01,interLine:.01,breakOn:"- ,.:?!",contentDirection:"column",alignContent:"center",justifyContent:"start",fontTexture:null,textType:"MSDF",fontColor:new qe(16777215),fontOpacity:1,borderRadius:.01,borderWidth:0,borderColor:new qe("black"),backgroundSize:"cover",backgroundColor:new qe(2236962),backgroundWhiteColor:new qe(16777215),backgroundOpacity:.8,backgroundOpaqueOpacity:1,backgroundTexture:tte(),hiddenOverflow:!1};function tte(){let o=document.createElement("canvas").getContext("2d");o.canvas.width=1,o.canvas.height=1,o.fillStyle="#ffffff",o.fillRect(0,0,1,1);let e=new Md(o.canvas);return e.isDefault=!0,e}function Go(o=class{}){return class extends o{constructor(t){super(t);this.states={},this.currentState=void 0,this.isUI=!0}getClippingPlanes(){let t=[];if(this.parent&&this.parent.isUI){if(this.isBlock&&this.parent.getHiddenOverflow()){let n=this.parent.getHeight()/2-(this.parent.padding||0),i=this.parent.getWidth()/2-(this.parent.padding||0),r=[new mi(new ae(0,1,0),n),new mi(new ae(0,-1,0),n),new mi(new ae(1,0,0),i),new mi(new ae(-1,0,0),i)];r.forEach(s=>{s.applyMatrix4(this.parent.matrixWorld)}),t.push(...r)}this.parent.parent&&this.parent.parent.isUI&&t.push(...this.parent.getClippingPlanes())}return t}getUIChildren(){return this.children.filter(t=>t.isUI)}getUIParent(){return this.parent&&this.parent.isUI?this.parent:null}getHighestParent(){return this.getUIParent()?this.parent.getHighestParent():this}_getProperty(t){return this[t]===void 0&&this.getUIParent()?this.parent._getProperty(t):this[t]?this[t]:wi[t]}getFontSize(){return this._getProperty("fontSize")}getFontTexture(){return this._getProperty("fontTexture")}getFontFamily(){return this._getProperty("fontFamily")}getBreakOn(){return this._getProperty("breakOn")}getTextType(){return this._getProperty("textType")}getFontColor(){return this._getProperty("fontColor")}getFontOpacity(){return this._getProperty("fontOpacity")}getBorderRadius(){return this._getProperty("borderRadius")}getBorderWidth(){return this._getProperty("borderWidth")}getBorderColor(){return this._getProperty("borderColor")}getContainer(){return!this.threeOBJ&&this.parent?this.parent.getContainer():this.threeOBJ?this:wi.container}getParentsNumber(t){return t=t||0,this.getUIParent()?this.parent.getParentsNumber(t+1):t}getBackgroundOpacity(){return!this.backgroundOpacity&&this.backgroundOpacity!==0?wi.backgroundOpacity:this.backgroundOpacity}getBackgroundColor(){return this.backgroundColor||wi.backgroundColor}getBackgroundTexture(){return this.backgroundTexture||wi.backgroundTexture}getAlignContent(){return this.alignContent||wi.alignContent}getContentDirection(){return this.contentDirection||wi.contentDirection}getJustifyContent(){return this.justifyContent||wi.justifyContent}getInterLine(){return this.interLine===void 0?wi.interLine:this.interLine}getOffset(){return this.offset===void 0?wi.offset:this.offset}getBackgroundSize(){return this.backgroundSize===void 0?wi.backgroundSize:this.backgroundSize}getHiddenOverflow(){return this.hiddenOverflow===void 0?wi.hiddenOverflow:this.hiddenOverflow}add(){for(let t of Object.keys(arguments))arguments[t].isInline&&this.update(null,!0);return super.add(...arguments)}remove(){for(let t of Object.keys(arguments))arguments[t].isInline&&this.update(null,!0);return super.remove(...arguments)}update(t,n,i){Rr.requestUpdate(this,t,n,i)}onAfterUpdate(){}_updateFontFamily(t){this.fontFamily=t,this.traverse(n=>{n.isUI&&n.update(!0,!0,!1)}),this.getHighestParent().update(!1,!0,!1)}_updateFontTexture(t){this.fontTexture=t,this.getHighestParent().update(!1,!0,!1)}set(t){let n,i,r;if(Rr.register(this),!(!t||JSON.stringify(t)===JSON.stringify({}))){for(let s of Object.keys(t))switch(s){case"content":this.isText&&(n=!0),i=!0,this[s]=t[s];break;case"width":case"height":case"padding":this.isInlineBlock&&(n=!0),i=!0,this[s]=t[s];break;case"fontSize":case"interLine":case"margin":case"contentDirection":case"justifyContent":case"alignContent":case"textType":case"src":i=!0,this[s]=t[s];break;case"fontColor":case"fontOpacity":case"offset":case"backgroundColor":case"backgroundOpacity":case"backgroundTexture":case"backgroundSize":case"borderRadius":case"borderWidth":case"borderColor":r=!0,this[s]=t[s];break;case"hiddenOverflow":this[s]=t[s];break}t.fontFamily&&(Oc.setFontFamily(this,t.fontFamily),i=!1),t.fontTexture&&(Oc.setFontTexture(this,t.fontTexture),i=!1),this.update(n,i,r),i&&this.getHighestParent().update(!1,!0,!1)}}setupState(t){this.states[t.state]={attributes:t.attributes,onSet:t.onSet}}setState(t){let n=this.states[t];if(!n){console.warn(`state "${t}" does not exist within this component`);return}t!==this.currentState&&(this.currentState=t,n.onSet&&n.onSet(),n.attributes&&this.set(n.attributes))}clear(){this.traverse(t=>{Rr.disposeOf(t),t.material&&t.material.dispose(),t.geometry&&t.geometry.dispose()})}}}function kc(o=class{}){return class extends o{getBackgroundUniforms(){let t,n,i=this.getBackgroundTexture();this.tSize.set(i.image.width,i.image.height),i.isDefault?(t=this.getBackgroundColor(),n=this.getBackgroundOpacity()):(t=this.backgroundColor||wi.backgroundWhiteColor,n=!this.backgroundOpacity&&this.backgroundOpacity!==0?wi.backgroundOpaqueOpacity:this.backgroundOpacity);let r=(()=>{switch(this.getBackgroundSize()){case"stretch":return 0;case"contain":return 1;case"cover":return 2}})();return{texture:i,color:t,opacity:n,backgroundMapping:r,borderRadius:this.getBorderRadius(),borderWidth:this.getBorderWidth(),borderColor:this.getBorderColor(),size:this.size,tSize:this.tSize}}updateBackgroundMaterial(){if(this.backgroundUniforms){let t=this.getBackgroundUniforms();this.backgroundUniforms.u_texture.value=t.texture,this.backgroundUniforms.u_color.value=t.color,this.backgroundUniforms.u_opacity.value=t.opacity,this.backgroundUniforms.u_backgroundMapping.value=t.backgroundMapping,this.backgroundUniforms.u_size.value=t.size,this.backgroundUniforms.u_tSize.value=t.tSize,this.backgroundUniforms.u_borderRadius.value=t.borderRadius,this.backgroundUniforms.u_borderWidth.value=t.borderWidth,this.backgroundUniforms.u_borderColor.value=t.borderColor}}updateTextMaterial(){this.textUniforms&&(this.textUniforms.u_texture.value=this.getFontTexture(),this.textUniforms.u_color.value=this.getFontColor(),this.textUniforms.u_opacity.value=this.getFontOpacity())}updateClippingPlanes(t){let n=t!==void 0?t:this.getClippingPlanes();JSON.stringify(n)!==JSON.stringify(this.clippingPlanes)&&(this.clippingPlanes=n,this.fontMaterial&&(this.fontMaterial.clippingPlanes=this.clippingPlanes),this.backgroundMaterial&&(this.backgroundMaterial.clippingPlanes=this.clippingPlanes))}getBackgroundMaterial(){let t=this.getBackgroundUniforms();return!this.backgroundMaterial||!this.backgroundUniforms?this.backgroundMaterial=this._makeBackgroundMaterial(t):(t.texture!==this.backgroundUniforms.u_texture.value||t.color!==this.backgroundUniforms.u_color.value||t.opacity!==this.backgroundUniforms.u_opacity.value||t.backgroundMapping!==this.backgroundUniforms.u_backgroundMapping.value||t.borderRadius!==this.backgroundUniforms.u_borderRadius.value||t.borderWidth!==this.backgroundUniforms.u_borderWidth.value||t.borderColor!==this.backgroundUniforms.u_borderColor.value||t.size!==this.backgroundUniforms.u_size.value||t.tSize!==this.backgroundUniforms.u_tSize.value)&&this.updateBackgroundMaterial(),this.backgroundMaterial}getFontMaterial(){let t={u_texture:this.getFontTexture(),u_color:this.getFontColor(),u_opacity:this.getFontOpacity()};return!this.fontMaterial||!this.textUniforms?this.fontMaterial=this._makeTextMaterial(t):(t.u_texture!==this.textUniforms.u_texture.value||t.u_color!==this.textUniforms.u_color.value||t.u_opacity!==this.textUniforms.u_opacity.value)&&this.updateTextMaterial(),this.fontMaterial}_makeTextMaterial(t){return this.textUniforms={u_texture:{value:t.u_texture},u_color:{value:t.u_color},u_opacity:{value:t.u_opacity}},new ss({uniforms:this.textUniforms,transparent:!0,clipping:!0,vertexShader:nte,fragmentShader:ite,extensions:{derivatives:!0}})}_makeBackgroundMaterial(t){return this.backgroundUniforms={u_texture:{value:t.texture},u_color:{value:t.color},u_opacity:{value:t.opacity},u_backgroundMapping:{value:t.backgroundMapping},u_borderRadius:{value:t.borderRadius},u_borderWidth:{value:t.borderWidth},u_borderColor:{value:t.borderColor},u_size:{value:t.size},u_tSize:{value:t.tSize}},new ss({uniforms:this.backgroundUniforms,transparent:!0,clipping:!0,vertexShader:rte,fragmentShader:ste,extensions:{derivatives:!0}})}}}var nte=`
	varying vec2 vUv;

	#include <clipping_planes_pars_vertex>

	void main() {

		vUv = uv;
		vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );
		gl_Position = projectionMatrix * mvPosition;
		gl_Position.z -= 0.00001;

		#include <clipping_planes_vertex>

	}
`,ite=`
	uniform sampler2D u_texture;
	uniform vec3 u_color;
	uniform float u_opacity;

	varying vec2 vUv;

	#include <clipping_planes_pars_fragment>

	float median(float r, float g, float b) {
		return max(min(r, g), min(max(r, g), b));
	}

	void main() {

		vec3 textureSample = texture2D( u_texture, vUv ).rgb;
		float sigDist = median( textureSample.r, textureSample.g, textureSample.b ) - 0.5;
		float alpha = clamp( sigDist / fwidth( sigDist ) + 0.5, 0.0, 1.0 );
		gl_FragColor = vec4( u_color, min( alpha, u_opacity ) );
	
		#include <clipping_planes_fragment>

	}
`,rte=`
	varying vec2 vUv;

	#include <clipping_planes_pars_vertex>

	void main() {

		vUv = uv;
		vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );
		gl_Position = projectionMatrix * mvPosition;

		#include <clipping_planes_vertex>

	}
`,ste=`
	uniform sampler2D u_texture;
	uniform vec3 u_color;
	uniform float u_opacity;

    uniform float u_borderRadius;
    uniform float u_borderWidth;
    uniform vec3 u_borderColor;
    uniform vec2 u_size;
    uniform vec2 u_tSize;
    uniform int u_backgroundMapping;

	varying vec2 vUv;

	#include <clipping_planes_pars_fragment>

    float getEdgeDist() {
        vec2 ndc = vec2( vUv.x * 2.0 - 1.0, vUv.y * 2.0 - 1.0 );
        vec2 planeSpaceCoord = vec2( u_size.x * 0.5 * ndc.x, u_size.y * 0.5 * ndc.y );
        vec2 corner = u_size * 0.5;
        vec2 offsetCorner = corner - abs( planeSpaceCoord );
        float innerRadDist = min( offsetCorner.x, offsetCorner.y ) * -1.0;
        float roundedDist = length( max( abs( planeSpaceCoord ) - u_size * 0.5 + u_borderRadius, 0.0 ) ) - u_borderRadius;
        float s = step( innerRadDist * -1.0, u_borderRadius );
        return mix( innerRadDist, roundedDist, s );
    }

    vec4 sampleTexture() {
        float textureRatio = u_tSize.x / u_tSize.y;
        float panelRatio = u_size.x / u_size.y;
        vec2 uv = vUv;
        if ( u_backgroundMapping == 1 ) { // contain
            if ( textureRatio < panelRatio ) { // repeat on X
                float newX = uv.x * ( panelRatio / textureRatio );
                newX += 0.5 - 0.5 * ( panelRatio / textureRatio );
                uv.x = newX;
            } else { // repeat on Y
                float newY = uv.y * ( textureRatio / panelRatio );
                newY += 0.5 - 0.5 * ( textureRatio / panelRatio );
                uv.y = newY;
            }
        } else if ( u_backgroundMapping == 2 ) { // cover
            if ( textureRatio < panelRatio ) { // stretch on Y
                float newY = uv.y * ( textureRatio / panelRatio );
                newY += 0.5 - 0.5 * ( textureRatio / panelRatio );
                uv.y = newY;
            } else { // stretch on X
                float newX = uv.x * ( panelRatio / textureRatio );
                newX += 0.5 - 0.5 * ( panelRatio / textureRatio );
                uv.x = newX;
            }
        }
        return texture2D( u_texture, uv ).rgba;
    }

	void main() {
        float edgeDist = getEdgeDist();
        if ( edgeDist > 0.0 ) discard;
		vec4 textureSample = sampleTexture();
        float blendedOpacity = u_opacity * textureSample.a;
        vec3 blendedColor = textureSample.rgb * u_color;
        if ( edgeDist * -1.0 < u_borderWidth ) blendedColor = u_borderColor;
		gl_FragColor = vec4( blendedColor, blendedOpacity );
		#include <clipping_planes_fragment>
	}
`;var Hd=class extends Vn{constructor(e){let t=new md;super(t,e);this.castShadow=!0,this.receiveShadow=!0,this.name="MeshUI-Frame"}};var ST=null;function Ws(...o){let e=ST||class{};ST=null;let t=o.length,n;for(;--t>=0;)n=o[t],e=n(e);return e}Ws.withBase=o=>(ST=o,Ws);var yl=class extends Ws.withBase(ot)(Nc,Um,kc,Go){constructor(e){super(e);this.isBlock=!0,this.size=new Oe(0,0),this.tSize=new Oe(1,1),this.frame=new Hd(this.getBackgroundMaterial()),this.frame.onBeforeRender=()=>{this.updateClippingPlanes&&this.updateClippingPlanes()},this.add(this.frame),this.set(e)}parseParams(){}updateLayout(){let e=this.getWidth(),t=this.getHeight();if(!e||!t){console.warn("Block got no dimension from its parameters or from children parameters");return}this.size.set(e,t),this.frame.scale.set(e,t,1),this.frame&&this.updateBackgroundMaterial(),this.frame.renderOrder=this.getParentsNumber(),this.setPosFromParentRecords(),this.children.find(n=>n.isInline)?this.computeInlinesPosition():this.computeChildrenPosition(),this.getUIParent()&&(this.position.z=this.getOffset())}updateInner(){this.getUIParent()&&(this.position.z=this.getOffset()),this.frame&&this.updateBackgroundMaterial()}};function Hm(o=class{}){return class extends o{constructor(t){super(t);this.isInline=!0}}}var TT=class{static computeTangents(e){e.computeTangents(),console.warn("THREE.BufferGeometryUtils: .computeTangents() has been removed. Use BufferGeometry.computeTangents() instead.")}static mergeBufferGeometries(e,t=!1){let n=e[0].index!==null,i=new Set(Object.keys(e[0].attributes)),r=new Set(Object.keys(e[0].morphAttributes)),s={},a={},l=e[0].morphTargetsRelative,c=new Et,u=0;for(let d=0;d<e.length;++d){let h=e[d],f=0;if(n!==(h.index!==null))return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+d+". All geometries must have compatible attributes; make sure index attribute exists among all geometries, or in none of them."),null;for(let p in h.attributes){if(!i.has(p))return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+d+'. All geometries must have compatible attributes; make sure "'+p+'" attribute exists among all geometries, or in none of them.'),null;s[p]===void 0&&(s[p]=[]),s[p].push(h.attributes[p]),f++}if(f!==i.size)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+d+". Make sure all geometries have the same number of attributes."),null;if(l!==h.morphTargetsRelative)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+d+". .morphTargetsRelative must be consistent throughout all geometries."),null;for(let p in h.morphAttributes){if(!r.has(p))return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+d+".  .morphAttributes must be consistent throughout all geometries."),null;a[p]===void 0&&(a[p]=[]),a[p].push(h.morphAttributes[p])}if(c.userData.mergedUserData=c.userData.mergedUserData||[],c.userData.mergedUserData.push(h.userData),t){let p;if(n)p=h.index.count;else if(h.attributes.position!==void 0)p=h.attributes.position.count;else return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+d+". The geometry must have either an index or a position attribute"),null;c.addGroup(u,p,d),u+=p}}if(n){let d=0,h=[];for(let f=0;f<e.length;++f){let p=e[f].index;for(let g=0;g<p.count;++g)h.push(p.getX(g)+d);d+=e[f].attributes.position.count}c.setIndex(h)}for(let d in s){let h=this.mergeBufferAttributes(s[d]);if(!h)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed while trying to merge the "+d+" attribute."),null;c.setAttribute(d,h)}for(let d in a){let h=a[d][0].length;if(h===0)break;c.morphAttributes=c.morphAttributes||{},c.morphAttributes[d]=[];for(let f=0;f<h;++f){let p=[];for(let v=0;v<a[d].length;++v)p.push(a[d][v][f]);let g=this.mergeBufferAttributes(p);if(!g)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed while trying to merge the "+d+" morphAttribute."),null;c.morphAttributes[d].push(g)}}return c}static mergeBufferAttributes(e){let t,n,i,r=0;for(let l=0;l<e.length;++l){let c=e[l];if(c.isInterleavedBufferAttribute)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. InterleavedBufferAttributes are not supported."),null;if(t===void 0&&(t=c.array.constructor),t!==c.array.constructor)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. BufferAttribute.array must be of consistent array types across matching attributes."),null;if(n===void 0&&(n=c.itemSize),n!==c.itemSize)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. BufferAttribute.itemSize must be consistent across matching attributes."),null;if(i===void 0&&(i=c.normalized),i!==c.normalized)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. BufferAttribute.normalized must be consistent across matching attributes."),null;r+=c.array.length}let s=new t(r),a=0;for(let l=0;l<e.length;++l)s.set(e[l].array,a),a+=e[l].array.length;return new jt(s,n,i)}static interleaveAttributes(e){let t,n=0,i=0;for(let u=0,d=e.length;u<d;++u){let h=e[u];if(t===void 0&&(t=h.array.constructor),t!==h.array.constructor)return console.error("AttributeBuffers of different types cannot be interleaved"),null;n+=h.array.length,i+=h.itemSize}let r=new Sr(new t(n),i),s=0,a=[],l=["getX","getY","getZ","getW"],c=["setX","setY","setZ","setW"];for(let u=0,d=e.length;u<d;u++){let h=e[u],f=h.itemSize,p=h.count,g=new ks(r,f,s,h.normalized);a.push(g),s+=f;for(let v=0;v<p;v++)for(let y=0;y<f;y++)g[c[y]](v,h[l[y]](v))}return a}static estimateBytesUsed(e){let t=0;for(let i in e.attributes){let r=e.getAttribute(i);t+=r.count*r.itemSize*r.array.BYTES_PER_ELEMENT}let n=e.getIndex();return t+=n?n.count*n.itemSize*n.array.BYTES_PER_ELEMENT:0,t}static mergeVertices(e,t=1e-4){t=Math.max(t,Number.EPSILON);let n={},i=e.getIndex(),r=e.getAttribute("position"),s=i?i.count:r.count,a=0,l=Object.keys(e.attributes),c={},u={},d=[],h=["getX","getY","getZ","getW"];for(let v=0,y=l.length;v<y;v++){let m=l[v];c[m]=[];let x=e.morphAttributes[m];x&&(u[m]=new Array(x.length).fill().map(()=>[]))}let f=Math.log10(1/t),p=Math.pow(10,f);for(let v=0;v<s;v++){let y=i?i.getX(v):v,m="";for(let x=0,_=l.length;x<_;x++){let w=l[x],b=e.getAttribute(w),M=b.itemSize;for(let S=0;S<M;S++)m+=`${~~(b[h[S]](y)*p)},`}if(m in n)d.push(n[m]);else{for(let x=0,_=l.length;x<_;x++){let w=l[x],b=e.getAttribute(w),M=e.morphAttributes[w],S=b.itemSize,E=c[w],A=u[w];for(let L=0;L<S;L++){let B=h[L];if(E.push(b[B](y)),M)for(let R=0,D=M.length;R<D;R++)A[R].push(M[R][B](y))}}n[m]=a,d.push(a),a++}}let g=e.clone();for(let v=0,y=l.length;v<y;v++){let m=l[v],x=e.getAttribute(m),_=new x.array.constructor(c[m]),w=new jt(_,x.itemSize,x.normalized);if(g.setAttribute(m,w),m in u)for(let b=0;b<u[m].length;b++){let M=e.morphAttributes[m][b],S=new M.array.constructor(u[m][b]),E=new jt(S,M.itemSize,M.normalized);g.morphAttributes[m][b]=E}}return g.setIndex(d),g}static toTrianglesDrawMode(e,t){if(t===M1)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),e;if(t===$h||t===gv){let n=e.getIndex();if(n===null){let a=[],l=e.getAttribute("position");if(l!==void 0){for(let c=0;c<l.count;c++)a.push(c);e.setIndex(a),n=e.getIndex()}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),e}let i=n.count-2,r=[];if(t===$h)for(let a=1;a<=i;a++)r.push(n.getX(0)),r.push(n.getX(a)),r.push(n.getX(a+1));else for(let a=0;a<i;a++)a%2==0?(r.push(n.getX(a)),r.push(n.getX(a+1)),r.push(n.getX(a+2))):(r.push(n.getX(a+2)),r.push(n.getX(a+1)),r.push(n.getX(a)));r.length/3!==i&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");let s=e.clone();return s.setIndex(r),s.clearGroups(),s}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",t),e}static computeMorphedAttributes(e){if(e.geometry.isBufferGeometry!==!0)return console.error("THREE.BufferGeometryUtils: Geometry is not of type BufferGeometry."),null;let t=new ae,n=new ae,i=new ae,r=new ae,s=new ae,a=new ae,l=new ae,c=new ae,u=new ae;function d(ne,Q,j,O,ee,V,ie,ue,ye){t.fromBufferAttribute(j,V),n.fromBufferAttribute(j,ie),i.fromBufferAttribute(j,ue);let pe=ne.morphTargetInfluences;if(Q.morphTargets&&O&&pe){l.set(0,0,0),c.set(0,0,0),u.set(0,0,0);for(let xe=0,X=O.length;xe<X;xe++){let $=pe[xe],J=O[xe];$!==0&&(r.fromBufferAttribute(J,V),s.fromBufferAttribute(J,ie),a.fromBufferAttribute(J,ue),ee?(l.addScaledVector(r,$),c.addScaledVector(s,$),u.addScaledVector(a,$)):(l.addScaledVector(r.sub(t),$),c.addScaledVector(s.sub(n),$),u.addScaledVector(a.sub(i),$)))}t.add(l),n.add(c),i.add(u)}ne.isSkinnedMesh&&(ne.boneTransform(V,t),ne.boneTransform(ie,n),ne.boneTransform(ue,i)),ye[V*3+0]=t.x,ye[V*3+1]=t.y,ye[V*3+2]=t.z,ye[ie*3+0]=n.x,ye[ie*3+1]=n.y,ye[ie*3+2]=n.z,ye[ue*3+0]=i.x,ye[ue*3+1]=i.y,ye[ue*3+2]=i.z}let h=e.geometry,f=e.material,p,g,v,y=h.index,m=h.attributes.position,x=h.morphAttributes.position,_=h.morphTargetsRelative,w=h.attributes.normal,b=h.morphAttributes.position,M=h.groups,S=h.drawRange,E,A,L,B,R,D,P,I,N=new Float32Array(m.count*m.itemSize),G=new Float32Array(w.count*w.itemSize);if(y!==null)if(Array.isArray(f))for(E=0,L=M.length;E<L;E++)for(R=M[E],D=f[R.materialIndex],P=Math.max(R.start,S.start),I=Math.min(R.start+R.count,S.start+S.count),A=P,B=I;A<B;A+=3)p=y.getX(A),g=y.getX(A+1),v=y.getX(A+2),d(e,D,m,x,_,p,g,v,N),d(e,D,w,b,_,p,g,v,G);else for(P=Math.max(0,S.start),I=Math.min(y.count,S.start+S.count),E=P,L=I;E<L;E+=3)p=y.getX(E),g=y.getX(E+1),v=y.getX(E+2),d(e,f,m,x,_,p,g,v,N),d(e,f,w,b,_,p,g,v,G);else if(m!==void 0)if(Array.isArray(f))for(E=0,L=M.length;E<L;E++)for(R=M[E],D=f[R.materialIndex],P=Math.max(R.start,S.start),I=Math.min(R.start+R.count,S.start+S.count),A=P,B=I;A<B;A+=3)p=A,g=A+1,v=A+2,d(e,D,m,x,_,p,g,v,N),d(e,D,w,b,_,p,g,v,G);else for(P=Math.max(0,S.start),I=Math.min(m.count,S.start+S.count),E=P,L=I;E<L;E+=3)p=E,g=E+1,v=E+2,d(e,f,m,x,_,p,g,v,N),d(e,f,w,b,_,p,g,v,G);let z=new fn(N,3),se=new fn(G,3);return{positionAttribute:m,normalAttribute:w,morphedPositionAttribute:z,morphedNormalAttribute:se}}};var Px=class extends md{constructor(e,t){let n=e.glyph,i=e.fontSize;super(i,i);n.match(/\s/g)===null?(t.info.charset.indexOf(n)===-1&&console.error(`The character '${n}' is not included in the font characters set.`),this.mapUVs(t,n),this.transformGeometry(t,i,n,e)):(this.nullifyUVs(),this.scale(0,0,1),this.translate(0,i/2,0))}mapUVs(e,t){let n=e.chars.find(u=>u.char===t),i=e.common,r=n.x/i.scaleW,s=(n.x+n.width)/i.scaleW,a=1-(n.y+n.height)/i.scaleH,l=1-n.y/i.scaleH,c=this.attributes.uv;for(let u=0;u<c.count;u++){let d=c.getX(u),h=c.getY(u);[d,h]=(()=>{switch(u){case 0:return[r,l];case 1:return[s,l];case 2:return[r,a];case 3:return[s,a]}})(),c.setXY(u,d,h)}}nullifyUVs(){let e=this.attributes.uv;for(let t=0;t<e.count;t++)e.setXY(t,0,0)}transformGeometry(e,t,n,i){let r=e.chars.find(c=>c.char===n),s=e.common,a=r.height/s.lineHeight,l=r.width*a/r.height;this.scale(l,a,1),this.translate(i.width/2,i.height/2-i.anchor,0)}};function ote(o){let e=o.font,t=o.fontSize,n=o.glyph,i=e.chars.find(l=>l.char===n),r=i?i.width*t/e.common.lineHeight:t/3,s=i?i.height*t/e.common.lineHeight:0;r===0&&(r=t),s===0&&(s=t*.7),n===`
`&&(r=0);let a=i?(i.yoffset+i.height-e.common.base)*t/e.common.lineHeight:0;return{width:r,height:s,anchor:a}}function ate(){let o=this,e=[];o.inlines.forEach((i,r)=>{e[r]=new Px(i,this.getFontFamily()),e[r].translate(i.offsetX,i.offsetY,0)});let t=TT.mergeBufferGeometries(e);return new Vn(t,this.getFontMaterial())}var ET={getGlyphDimensions:ote,buildText:ate};function AT(o=class{}){return class extends o{createText(){let t=this,n=(()=>{switch(this.getTextType()){case"MSDF":return ET.buildText.call(this);default:console.warn(`'${this.getTextType()}' is not a supported text type.
See https://github.com/felixmariotto/three-mesh-ui/wiki/Using-a-custom-text-type`);break}})();return n.renderOrder=1/0,n.onBeforeRender=function(){t.updateClippingPlanes&&t.updateClippingPlanes()},n}getGlyphDimensions(t){switch(t.textType){case"MSDF":return ET.getGlyphDimensions(t);default:console.warn(`'${t.textType}' is not a supported text type.
See https://github.com/felixmariotto/three-mesh-ui/wiki/Using-a-custom-text-type`);break}}}}function kN(o){o.children.forEach(e=>{e.children.length>0&&kN(e),o.remove(e),Rr.disposeOf(e),e.material&&e.material.dispose(),e.geometry&&e.geometry.dispose()}),o.children=[]}var zN=kN;var Gd=class extends Ws.withBase(ot)(Hm,AT,kc,Go){constructor(e){super(e);this.isText=!0,this.set(e)}parseParams(){let e=this.content,t=this.getFontFamily(),n=this.getFontSize(),i=this.getBreakOn(),r=this.getTextType();if(!t||typeof t=="string"){Oc.getFontOf(this)||console.warn("no font was found");return}if(!this.content){this.inlines=null;return}if(!r){console.error(`You must to provide a 'textType' attribute so three-mesh-ui knows how to render your text.
 See https://github.com/felixmariotto/three-mesh-ui/wiki/Using-a-custom-text-type`);return}let a=(Array.from?Array.from(e):String(e).split("")).map(l=>{let c=this.getGlyphDimensions({textType:r,glyph:l,font:t,fontSize:n}),u=null;return(i.includes(l)||l.match(/\s/g))&&(u="possible"),l.match(/\n/g)&&(u="mandatory"),{height:c.height,width:c.width,anchor:c.anchor,lineBreak:u,glyph:l,fontSize:n}});this.inlines=a}updateLayout(){zN(this),this.inlines&&(this.textContent=this.createText(),this.add(this.textContent)),this.position.z=this.getOffset()}updateInner(){this.position.z=this.getOffset(),this.textContent&&this.updateTextMaterial()}};var Vd=class extends Ws.withBase(ot)(Hm,Nc,Um,kc,Go){constructor(e){super(e);this.isInlineBlock=!0,this.size=new Oe(1,1),this.tSize=new Oe(1,1),this.frame=new Hd(this.getBackgroundMaterial()),this.frame.onBeforeRender=()=>{this.updateClippingPlanes&&this.updateClippingPlanes()},this.add(this.frame),this.set(e)}parseParams(){this.width||console.warn("inlineBlock has no width. Set to 0.3 by default"),this.height||console.warn("inlineBlock has no height. Set to 0.3 by default"),this.inlines=[{height:this.height||.3,width:this.width||.3,anchor:0,lineBreak:"possible"}]}updateLayout(){let e=this.getWidth(),t=this.getHeight();if(this.inlines){let n=this.inlines[0];this.position.set(n.width/2,n.height/2,0),this.position.x+=n.offsetX,this.position.y+=n.offsetY}this.size.set(e,t),this.frame.scale.set(e,t,1),this.frame&&this.updateBackgroundMaterial(),this.frame.renderOrder=this.getParentsNumber(),this.children.find(n=>n.isInline)?this.computeInlinesPosition():this.computeChildrenPosition(),this.position.z=this.getOffset()}updateInner(){this.position.z=this.getOffset(),this.frame&&this.updateBackgroundMaterial()}};var Vo={fr:[[[{width:.1,chars:[{lowerCase:"a",upperCase:"A"}]},{width:.1,chars:[{lowerCase:"z",upperCase:"Z"}]},{width:.1,chars:[{lowerCase:"e",upperCase:"E"}]},{width:.1,chars:[{lowerCase:"r",upperCase:"R"}]},{width:.1,chars:[{lowerCase:"t",upperCase:"T"}]},{width:.1,chars:[{lowerCase:"y",upperCase:"Y"}]},{width:.1,chars:[{lowerCase:"u",upperCase:"U"}]},{width:.1,chars:[{lowerCase:"i",upperCase:"I"}]},{width:.1,chars:[{lowerCase:"o",upperCase:"O"}]},{width:.1,chars:[{lowerCase:"p",upperCase:"P"}]}],[{width:.1,chars:[{lowerCase:"q",upperCase:"Q"}]},{width:.1,chars:[{lowerCase:"s",upperCase:"S"}]},{width:.1,chars:[{lowerCase:"d",upperCase:"D"}]},{width:.1,chars:[{lowerCase:"f",upperCase:"F"}]},{width:.1,chars:[{lowerCase:"g",upperCase:"G"}]},{width:.1,chars:[{lowerCase:"h",upperCase:"H"}]},{width:.1,chars:[{lowerCase:"j",upperCase:"J"}]},{width:.1,chars:[{lowerCase:"k",upperCase:"K"}]},{width:.1,chars:[{lowerCase:"l",upperCase:"L"}]},{width:.1,chars:[{lowerCase:"m",upperCase:"M"}]}],[{width:.2,command:"shift",chars:[{icon:"shift"}]},{width:.1,chars:[{lowerCase:"w",upperCase:"W"}]},{width:.1,chars:[{lowerCase:"x",upperCase:"X"}]},{width:.1,chars:[{lowerCase:"c",upperCase:"C"}]},{width:.1,chars:[{lowerCase:"v",upperCase:"V"}]},{width:.1,chars:[{lowerCase:"b",upperCase:"B"}]},{width:.1,chars:[{lowerCase:"n",upperCase:"N"}]},{width:.2,command:"backspace",chars:[{icon:"backspace"}]}],[{width:.2,command:"switch",chars:[{lowerCase:".?12"}]},{width:.1,chars:[{lowerCase:","}]},{width:.4,command:"space",chars:[{icon:"space"}]},{width:.1,chars:[{lowerCase:"."}]},{width:.2,command:"enter",chars:[{icon:"enter"}]}]],[[{width:.1,chars:[{lowerCase:"1"}]},{width:.1,chars:[{lowerCase:"2"}]},{width:.1,chars:[{lowerCase:"3"}]},{width:.1,chars:[{lowerCase:"4"}]},{width:.1,chars:[{lowerCase:"5"}]},{width:.1,chars:[{lowerCase:"6"}]},{width:.1,chars:[{lowerCase:"7"}]},{width:.1,chars:[{lowerCase:"8"}]},{width:.1,chars:[{lowerCase:"9"}]},{width:.1,chars:[{lowerCase:"0"}]}],[{width:.1,chars:[{lowerCase:"@"}]},{width:.1,chars:[{lowerCase:"#"}]},{width:.1,chars:[{lowerCase:"|"}]},{width:.1,chars:[{lowerCase:"_"}]},{width:.1,chars:[{lowerCase:"&"}]},{width:.1,chars:[{lowerCase:"-"}]},{width:.1,chars:[{lowerCase:"+"}]},{width:.1,chars:[{lowerCase:"("}]},{width:.1,chars:[{lowerCase:")"}]},{width:.1,chars:[{lowerCase:"/"}]}],[{width:.1,chars:[{lowerCase:"="}]},{width:.1,chars:[{lowerCase:"*"}]},{width:.1,chars:[{lowerCase:'"'}]},{width:.1,chars:[{lowerCase:"'"}]},{width:.1,chars:[{lowerCase:":"}]},{width:.1,chars:[{lowerCase:";"}]},{width:.1,chars:[{lowerCase:"!"}]},{width:.1,chars:[{lowerCase:"?"}]},{width:.2,command:"backspace",chars:[{icon:"backspace"}]}],[{width:.2,command:"switch",chars:[{lowerCase:".?12"}]},{width:.1,chars:[{lowerCase:","}]},{width:.4,command:"space",chars:[{icon:"space"}]},{width:.1,chars:[{lowerCase:"."}]},{width:.2,command:"enter",chars:[{icon:"enter"}]}]]],eng:[[[{width:.1,chars:[{lowerCase:"q",upperCase:"Q"}]},{width:.1,chars:[{lowerCase:"w",upperCase:"W"}]},{width:.1,chars:[{lowerCase:"e",upperCase:"E"}]},{width:.1,chars:[{lowerCase:"r",upperCase:"R"}]},{width:.1,chars:[{lowerCase:"t",upperCase:"T"}]},{width:.1,chars:[{lowerCase:"y",upperCase:"Y"}]},{width:.1,chars:[{lowerCase:"u",upperCase:"U"}]},{width:.1,chars:[{lowerCase:"i",upperCase:"I"}]},{width:.1,chars:[{lowerCase:"o",upperCase:"O"}]},{width:.1,chars:[{lowerCase:"p",upperCase:"P"}]}],[{width:.1,chars:[{lowerCase:"a",upperCase:"A"}]},{width:.1,chars:[{lowerCase:"s",upperCase:"S"}]},{width:.1,chars:[{lowerCase:"d",upperCase:"D"}]},{width:.1,chars:[{lowerCase:"f",upperCase:"F"}]},{width:.1,chars:[{lowerCase:"g",upperCase:"G"}]},{width:.1,chars:[{lowerCase:"h",upperCase:"H"}]},{width:.1,chars:[{lowerCase:"j",upperCase:"J"}]},{width:.1,chars:[{lowerCase:"k",upperCase:"K"}]},{width:.1,chars:[{lowerCase:"l",upperCase:"L"}]}],[{width:.15,command:"shift",chars:[{icon:"shift"}]},{width:.1,chars:[{lowerCase:"z",upperCase:"Z"}]},{width:.1,chars:[{lowerCase:"x",upperCase:"X"}]},{width:.1,chars:[{lowerCase:"c",upperCase:"C"}]},{width:.1,chars:[{lowerCase:"v",upperCase:"V"}]},{width:.1,chars:[{lowerCase:"b",upperCase:"B"}]},{width:.1,chars:[{lowerCase:"n",upperCase:"N"}]},{width:.1,chars:[{lowerCase:"m",upperCase:"M"}]},{width:.15,command:"backspace",chars:[{icon:"backspace"}]}],[{width:.2,command:"switch",chars:[{lowerCase:".?12"}]},{width:.1,chars:[{lowerCase:","}]},{width:.4,command:"space",chars:[{icon:"space"}]},{width:.1,chars:[{lowerCase:"."}]},{width:.2,command:"enter",chars:[{icon:"enter"}]}]],[[{width:.1,chars:[{lowerCase:"1"}]},{width:.1,chars:[{lowerCase:"2"}]},{width:.1,chars:[{lowerCase:"3"}]},{width:.1,chars:[{lowerCase:"4"}]},{width:.1,chars:[{lowerCase:"5"}]},{width:.1,chars:[{lowerCase:"6"}]},{width:.1,chars:[{lowerCase:"7"}]},{width:.1,chars:[{lowerCase:"8"}]},{width:.1,chars:[{lowerCase:"9"}]},{width:.1,chars:[{lowerCase:"0"}]}],[{width:.1,chars:[{lowerCase:"@"}]},{width:.1,chars:[{lowerCase:"#"}]},{width:.1,chars:[{lowerCase:"|"}]},{width:.1,chars:[{lowerCase:"_"}]},{width:.1,chars:[{lowerCase:"&"}]},{width:.1,chars:[{lowerCase:"-"}]},{width:.1,chars:[{lowerCase:"+"}]},{width:.1,chars:[{lowerCase:"("}]},{width:.1,chars:[{lowerCase:")"}]},{width:.1,chars:[{lowerCase:"/"}]}],[{width:.1,chars:[{lowerCase:"="}]},{width:.1,chars:[{lowerCase:"*"}]},{width:.1,chars:[{lowerCase:'"'}]},{width:.1,chars:[{lowerCase:"'"}]},{width:.1,chars:[{lowerCase:":"}]},{width:.1,chars:[{lowerCase:";"}]},{width:.1,chars:[{lowerCase:"!"}]},{width:.1,chars:[{lowerCase:"?"}]},{width:.2,command:"backspace",chars:[{icon:"backspace"}]}],[{width:.2,command:"switch",chars:[{lowerCase:".?12"}]},{width:.1,chars:[{lowerCase:","}]},{width:.4,command:"space",chars:[{icon:"space"}]},{width:.1,chars:[{lowerCase:"."}]},{width:.2,command:"enter",chars:[{icon:"enter"}]}]]],ru:[[[{width:1/12,chars:[{lowerCase:"\u0439",upperCase:"\u0419"},{lowerCase:"q",upperCase:"Q"}]},{width:1/12,chars:[{lowerCase:"\u0446",upperCase:"\u0426"},{lowerCase:"w",upperCase:"W"}]},{width:1/12,chars:[{lowerCase:"\u0443",upperCase:"\u0423"},{lowerCase:"e",upperCase:"E"}]},{width:1/12,chars:[{lowerCase:"\u043A",upperCase:"\u041A"},{lowerCase:"r",upperCase:"R"}]},{width:1/12,chars:[{lowerCase:"\u0435",upperCase:"\u0415"},{lowerCase:"t",upperCase:"T"}]},{width:1/12,chars:[{lowerCase:"\u043D",upperCase:"\u041D"},{lowerCase:"y",upperCase:"Y"}]},{width:1/12,chars:[{lowerCase:"\u0433",upperCase:"\u0413"},{lowerCase:"u",upperCase:"U"}]},{width:1/12,chars:[{lowerCase:"\u0448",upperCase:"\u0428"},{lowerCase:"i",upperCase:"I"}]},{width:1/12,chars:[{lowerCase:"\u0449",upperCase:"\u0429"},{lowerCase:"o",upperCase:"O"}]},{width:1/12,chars:[{lowerCase:"\u0437",upperCase:"\u0417"},{lowerCase:"p",upperCase:"P"}]},{width:1/12,chars:[{lowerCase:"\u0445",upperCase:"\u0425"},{lowerCase:"{",upperCase:"["}]},{width:1/12,chars:[{lowerCase:"\u044A",upperCase:"\u042A"},{lowerCase:"}",upperCase:"]"}]}],[{width:1/12,chars:[{lowerCase:"\u0444",upperCase:"\u0424"},{lowerCase:"a",upperCase:"A"}]},{width:1/12,chars:[{lowerCase:"\u044B",upperCase:"\u042B"},{lowerCase:"s",upperCase:"S"}]},{width:1/12,chars:[{lowerCase:"\u0432",upperCase:"\u0412"},{lowerCase:"d",upperCase:"D"}]},{width:1/12,chars:[{lowerCase:"\u0430",upperCase:"\u0410"},{lowerCase:"f",upperCase:"F"}]},{width:1/12,chars:[{lowerCase:"\u043F",upperCase:"\u041F"},{lowerCase:"g",upperCase:"G"}]},{width:1/12,chars:[{lowerCase:"\u0440",upperCase:"\u0420"},{lowerCase:"h",upperCase:"H"}]},{width:1/12,chars:[{lowerCase:"\u043E",upperCase:"\u041E"},{lowerCase:"j",upperCase:"J"}]},{width:1/12,chars:[{lowerCase:"\u043B",upperCase:"\u041B"},{lowerCase:"k",upperCase:"K"}]},{width:1/12,chars:[{lowerCase:"\u0434",upperCase:"\u0414"},{lowerCase:"l",upperCase:"L"}]},{width:1/12,chars:[{lowerCase:"\u0436",upperCase:"\u0416"},{lowerCase:":",upperCase:";"}]},{width:1/12,chars:[{lowerCase:"\u044D",upperCase:"\u042D"},{lowerCase:'"',upperCase:"'"}]},{width:1/12,chars:[{lowerCase:"\u0451",upperCase:"\u0401"},{lowerCase:"|",upperCase:"\\"}]}],[{width:1.5/12,command:"shift",chars:[{icon:"shift"}]},{width:1/12,chars:[{lowerCase:"\u044F",upperCase:"\u042F"},{lowerCase:"z",upperCase:"Z"}]},{width:1/12,chars:[{lowerCase:"\u0447",upperCase:"\u0427"},{lowerCase:"x",upperCase:"X"}]},{width:1/12,chars:[{lowerCase:"\u0441",upperCase:"\u0421"},{lowerCase:"c",upperCase:"C"}]},{width:1/12,chars:[{lowerCase:"\u043C",upperCase:"\u041C"},{lowerCase:"v",upperCase:"V"}]},{width:1/12,chars:[{lowerCase:"\u0438",upperCase:"\u0418"},{lowerCase:"b",upperCase:"B"}]},{width:1/12,chars:[{lowerCase:"\u0442",upperCase:"\u0422"},{lowerCase:"n",upperCase:"N"}]},{width:1/12,chars:[{lowerCase:"\u044C",upperCase:"\u042C"},{lowerCase:"m",upperCase:"M"}]},{width:1/12,chars:[{lowerCase:"\u0431",upperCase:"\u0411"},{lowerCase:",",upperCase:""}]},{width:1/12,chars:[{lowerCase:"\u044E",upperCase:"\u042E"},{lowerCase:".",upperCase:""}]},{width:1.5/12,command:"backspace",chars:[{icon:"backspace"}]}],[{width:.15,command:"switch-set",chars:[{lowerCase:"eng"}]},{width:.15,command:"switch",chars:[{lowerCase:".?12"}]},{width:.4,command:"space",chars:[{icon:"space"}]},{width:.1,chars:[{lowerCase:"?"}]},{width:.2,command:"enter",chars:[{icon:"enter"}]}]],[[{width:.1,chars:[{lowerCase:"1"}]},{width:.1,chars:[{lowerCase:"2"}]},{width:.1,chars:[{lowerCase:"3"}]},{width:.1,chars:[{lowerCase:"4"}]},{width:.1,chars:[{lowerCase:"5"}]},{width:.1,chars:[{lowerCase:"6"}]},{width:.1,chars:[{lowerCase:"7"}]},{width:.1,chars:[{lowerCase:"8"}]},{width:.1,chars:[{lowerCase:"9"}]},{width:.1,chars:[{lowerCase:"0"}]}],[{width:.1,chars:[{lowerCase:"@"}]},{width:.1,chars:[{lowerCase:"#"}]},{width:.1,chars:[{lowerCase:"|"}]},{width:.1,chars:[{lowerCase:"_"}]},{width:.1,chars:[{lowerCase:"&"}]},{width:.1,chars:[{lowerCase:"-"}]},{width:.1,chars:[{lowerCase:"+"}]},{width:.1,chars:[{lowerCase:"("}]},{width:.1,chars:[{lowerCase:")"}]},{width:.1,chars:[{lowerCase:"/"}]}],[{width:.1,chars:[{lowerCase:"="}]},{width:.1,chars:[{lowerCase:"*"}]},{width:.1,chars:[{lowerCase:'"'}]},{width:.1,chars:[{lowerCase:"'"}]},{width:.1,chars:[{lowerCase:":"}]},{width:.1,chars:[{lowerCase:";"}]},{width:.1,chars:[{lowerCase:"!"}]},{width:.1,chars:[{lowerCase:"?"}]},{width:.2,command:"backspace",chars:[{icon:"backspace"}]}],[{width:.3,command:"switch",chars:[{lowerCase:"\u0410\u0411\u0412"}]},{width:.4,command:"space",chars:[{icon:"space"}]},{width:.1,chars:[{lowerCase:"."}]},{width:.2,command:"enter",chars:[{icon:"enter"}]}]]],de:[[[{width:1/11,chars:[{lowerCase:"q",upperCase:"Q"}]},{width:1/11,chars:[{lowerCase:"w",upperCase:"W"}]},{width:1/11,chars:[{lowerCase:"e",upperCase:"E"}]},{width:1/11,chars:[{lowerCase:"r",upperCase:"R"}]},{width:1/11,chars:[{lowerCase:"t",upperCase:"T"}]},{width:1/11,chars:[{lowerCase:"z",upperCase:"Z"}]},{width:1/11,chars:[{lowerCase:"u",upperCase:"U"}]},{width:1/11,chars:[{lowerCase:"i",upperCase:"I"}]},{width:1/11,chars:[{lowerCase:"o",upperCase:"O"}]},{width:1/11,chars:[{lowerCase:"p",upperCase:"P"}]},{width:1/11,chars:[{lowerCase:"\xFC",upperCase:"\xDC"}]}],[{width:1/11,chars:[{lowerCase:"a",upperCase:"A"}]},{width:1/11,chars:[{lowerCase:"s",upperCase:"S"}]},{width:1/11,chars:[{lowerCase:"d",upperCase:"D"}]},{width:1/11,chars:[{lowerCase:"f",upperCase:"F"}]},{width:1/11,chars:[{lowerCase:"g",upperCase:"G"}]},{width:1/11,chars:[{lowerCase:"h",upperCase:"H"}]},{width:1/11,chars:[{lowerCase:"j",upperCase:"J"}]},{width:1/11,chars:[{lowerCase:"k",upperCase:"K"}]},{width:1/11,chars:[{lowerCase:"l",upperCase:"L"}]},{width:1/11,chars:[{lowerCase:"\xF6",upperCase:"\xD6"}]},{width:1/11,chars:[{lowerCase:"\xE4",upperCase:"\xC4"}]}],[{width:2/11,command:"shift",chars:[{icon:"shift"}]},{width:1/11,chars:[{lowerCase:"y",upperCase:"Y"}]},{width:1/11,chars:[{lowerCase:"x",upperCase:"X"}]},{width:1/11,chars:[{lowerCase:"c",upperCase:"C"}]},{width:1/11,chars:[{lowerCase:"v",upperCase:"V"}]},{width:1/11,chars:[{lowerCase:"b",upperCase:"B"}]},{width:1/11,chars:[{lowerCase:"n",upperCase:"N"}]},{width:1/11,chars:[{lowerCase:"m",upperCase:"M"}]},{width:2/11,command:"backspace",chars:[{icon:"backspace"}]}],[{width:.2,command:"switch",chars:[{lowerCase:".?12"}]},{width:.1,chars:[{lowerCase:","}]},{width:.4,command:"space",chars:[{icon:"space"}]},{width:.1,chars:[{lowerCase:"."}]},{width:.2,command:"enter",chars:[{icon:"enter"}]}]],[[{width:.1,chars:[{lowerCase:"1"}]},{width:.1,chars:[{lowerCase:"2"}]},{width:.1,chars:[{lowerCase:"3"}]},{width:.1,chars:[{lowerCase:"4"}]},{width:.1,chars:[{lowerCase:"5"}]},{width:.1,chars:[{lowerCase:"6"}]},{width:.1,chars:[{lowerCase:"7"}]},{width:.1,chars:[{lowerCase:"8"}]},{width:.1,chars:[{lowerCase:"9"}]},{width:.1,chars:[{lowerCase:"0"}]}],[{width:.1,chars:[{lowerCase:"@"}]},{width:.1,chars:[{lowerCase:"#"}]},{width:.1,chars:[{lowerCase:"|"}]},{width:.1,chars:[{lowerCase:"_"}]},{width:.1,chars:[{lowerCase:"&"}]},{width:.1,chars:[{lowerCase:"-"}]},{width:.1,chars:[{lowerCase:"+"}]},{width:.1,chars:[{lowerCase:"("}]},{width:.1,chars:[{lowerCase:")"}]},{width:.1,chars:[{lowerCase:"/"}]}],[{width:.1,chars:[{lowerCase:"="}]},{width:.1,chars:[{lowerCase:"*"}]},{width:.1,chars:[{lowerCase:'"'}]},{width:.1,chars:[{lowerCase:"'"}]},{width:.1,chars:[{lowerCase:":"}]},{width:.1,chars:[{lowerCase:";"}]},{width:.1,chars:[{lowerCase:"!"}]},{width:.1,chars:[{lowerCase:"?"}]},{width:.2,command:"backspace",chars:[{icon:"backspace"}]}],[{width:.2,command:"switch",chars:[{lowerCase:".?12"}]},{width:.1,chars:[{lowerCase:","}]},{width:.4,command:"space",chars:[{icon:"space"}]},{width:.1,chars:[{lowerCase:"."}]},{width:.2,command:"enter",chars:[{icon:"enter"}]}]]],es:[[[{width:.1,chars:[{lowerCase:"q",upperCase:"Q"}]},{width:.1,chars:[{lowerCase:"w",upperCase:"W"}]},{width:.1,chars:[{lowerCase:"e",upperCase:"E"}]},{width:.1,chars:[{lowerCase:"r",upperCase:"R"}]},{width:.1,chars:[{lowerCase:"t",upperCase:"T"}]},{width:.1,chars:[{lowerCase:"y",upperCase:"Y"}]},{width:.1,chars:[{lowerCase:"u",upperCase:"U"}]},{width:.1,chars:[{lowerCase:"i",upperCase:"I"}]},{width:.1,chars:[{lowerCase:"o",upperCase:"O"}]},{width:.1,chars:[{lowerCase:"p",upperCase:"P"}]}],[{width:.1,chars:[{lowerCase:"a",upperCase:"A"}]},{width:.1,chars:[{lowerCase:"s",upperCase:"S"}]},{width:.1,chars:[{lowerCase:"d",upperCase:"D"}]},{width:.1,chars:[{lowerCase:"f",upperCase:"F"}]},{width:.1,chars:[{lowerCase:"g",upperCase:"G"}]},{width:.1,chars:[{lowerCase:"h",upperCase:"H"}]},{width:.1,chars:[{lowerCase:"j",upperCase:"J"}]},{width:.1,chars:[{lowerCase:"k",upperCase:"K"}]},{width:.1,chars:[{lowerCase:"l",upperCase:"L"}]},{width:.1,chars:[{lowerCase:"\xF1",upperCase:"\xD1"}]}],[{width:.15,command:"shift",chars:[{icon:"shift"}]},{width:.1,chars:[{lowerCase:"z",upperCase:"Z"}]},{width:.1,chars:[{lowerCase:"x",upperCase:"X"}]},{width:.1,chars:[{lowerCase:"c",upperCase:"C"}]},{width:.1,chars:[{lowerCase:"v",upperCase:"V"}]},{width:.1,chars:[{lowerCase:"b",upperCase:"B"}]},{width:.1,chars:[{lowerCase:"n",upperCase:"N"}]},{width:.1,chars:[{lowerCase:"m",upperCase:"M"}]},{width:.15,command:"backspace",chars:[{icon:"backspace"}]}],[{width:.2,command:"switch",chars:[{lowerCase:".?12"}]},{width:.1,chars:[{lowerCase:","}]},{width:.4,command:"space",chars:[{icon:"space"}]},{width:.1,chars:[{lowerCase:"."}]},{width:.2,command:"enter",chars:[{icon:"enter"}]}]],[[{width:.1,chars:[{lowerCase:"1"}]},{width:.1,chars:[{lowerCase:"2"}]},{width:.1,chars:[{lowerCase:"3"}]},{width:.1,chars:[{lowerCase:"4"}]},{width:.1,chars:[{lowerCase:"5"}]},{width:.1,chars:[{lowerCase:"6"}]},{width:.1,chars:[{lowerCase:"7"}]},{width:.1,chars:[{lowerCase:"8"}]},{width:.1,chars:[{lowerCase:"9"}]},{width:.1,chars:[{lowerCase:"0"}]}],[{width:.1,chars:[{lowerCase:"@"}]},{width:.1,chars:[{lowerCase:"#"}]},{width:.1,chars:[{lowerCase:"|"}]},{width:.1,chars:[{lowerCase:"_"}]},{width:.1,chars:[{lowerCase:"&"}]},{width:.1,chars:[{lowerCase:"-"}]},{width:.1,chars:[{lowerCase:"+"}]},{width:.1,chars:[{lowerCase:"("}]},{width:.1,chars:[{lowerCase:")"}]},{width:.1,chars:[{lowerCase:"/"}]}],[{width:.1,chars:[{lowerCase:"="}]},{width:.1,chars:[{lowerCase:"*"}]},{width:.1,chars:[{lowerCase:'"'}]},{width:.1,chars:[{lowerCase:"'"}]},{width:.1,chars:[{lowerCase:":"}]},{width:.1,chars:[{lowerCase:";"}]},{width:.1,chars:[{lowerCase:"!"}]},{width:.1,chars:[{lowerCase:"?"}]},{width:.2,command:"backspace",chars:[{icon:"backspace"}]}],[{width:.2,command:"switch",chars:[{lowerCase:".?12"}]},{width:.1,chars:[{lowerCase:","}]},{width:.4,command:"space",chars:[{icon:"space"}]},{width:.1,chars:[{lowerCase:"."}]},{width:.2,command:"enter",chars:[{icon:"enter"}]}]]],el:[[[{width:.1,chars:[{lowerCase:";",upperCase:":"},{lowerCase:"q",upperCase:"Q"}]},{width:.1,chars:[{lowerCase:"\u03C2",upperCase:"\u03C2"},{lowerCase:"w",upperCase:"W"}]},{width:.1,chars:[{lowerCase:"\u03B5",upperCase:"\u0395"},{lowerCase:"e",upperCase:"E"}]},{width:.1,chars:[{lowerCase:"\u03C1",upperCase:"\u03A1"},{lowerCase:"r",upperCase:"R"}]},{width:.1,chars:[{lowerCase:"\u03C4",upperCase:"\u03A4"},{lowerCase:"t",upperCase:"T"}]},{width:.1,chars:[{lowerCase:"\u03C5",upperCase:"\u03A5"},{lowerCase:"y",upperCase:"Y"}]},{width:.1,chars:[{lowerCase:"\u03B8",upperCase:"\u0398"},{lowerCase:"u",upperCase:"U"}]},{width:.1,chars:[{lowerCase:"\u03B9",upperCase:"\u0399"},{lowerCase:"i",upperCase:"I"}]},{width:.1,chars:[{lowerCase:"\u03BF",upperCase:"\u039F"},{lowerCase:"o",upperCase:"O"}]},{width:.1,chars:[{lowerCase:"\u03C0",upperCase:"\u03A0"},{lowerCase:"p",upperCase:"P"}]}],[{width:.1,chars:[{lowerCase:"\u03B1",upperCase:"\u0391"},{lowerCase:"a",upperCase:"A"}]},{width:.1,chars:[{lowerCase:"\u03C3",upperCase:"\u03A3"},{lowerCase:"s",upperCase:"S"}]},{width:.1,chars:[{lowerCase:"\u03B4",upperCase:"\u0394"},{lowerCase:"d",upperCase:"D"}]},{width:.1,chars:[{lowerCase:"\u03C6",upperCase:"\u03A6"},{lowerCase:"f",upperCase:"F"}]},{width:.1,chars:[{lowerCase:"\u03B3",upperCase:"\u0393"},{lowerCase:"g",upperCase:"G"}]},{width:.1,chars:[{lowerCase:"\u03B7",upperCase:"\u0397"},{lowerCase:"h",upperCase:"H"}]},{width:.1,chars:[{lowerCase:"\u03BE",upperCase:"\u039E"},{lowerCase:"j",upperCase:"J"}]},{width:.1,chars:[{lowerCase:"\u03BA",upperCase:"\u039A"},{lowerCase:"k",upperCase:"K"}]},{width:.1,chars:[{lowerCase:"\u03BB",upperCase:"\u039B"},{lowerCase:"l",upperCase:"L"}]}],[{width:.15,command:"shift",chars:[{icon:"shift"}]},{width:.1,chars:[{lowerCase:"\u03B6",upperCase:"\u0396"},{lowerCase:"z",upperCase:"Z"}]},{width:.1,chars:[{lowerCase:"\u03C7",upperCase:"\u03A7"},{lowerCase:"x",upperCase:"X"}]},{width:.1,chars:[{lowerCase:"\u03C8",upperCase:"\u03A8"},{lowerCase:"c",upperCase:"C"}]},{width:.1,chars:[{lowerCase:"\u03C9",upperCase:"\u03A9"},{lowerCase:"v",upperCase:"V"}]},{width:.1,chars:[{lowerCase:"\u03B2",upperCase:"\u0392"},{lowerCase:"b",upperCase:"B"}]},{width:.1,chars:[{lowerCase:"\u03BD",upperCase:"\u039D"},{lowerCase:"n",upperCase:"N"}]},{width:.1,chars:[{lowerCase:"\u03BC",upperCase:"\u039C"},{lowerCase:"m",upperCase:"M"}]},{width:.15,command:"backspace",chars:[{icon:"backspace"}]}],[{width:.15,command:"switch-set",chars:[{lowerCase:"eng"}]},{width:.15,command:"switch",chars:[{lowerCase:".?12"}]},{width:.4,command:"space",chars:[{icon:"space"}]},{width:.1,chars:[{lowerCase:"?"}]},{width:.2,command:"enter",chars:[{icon:"enter"}]}]],[[{width:.1,chars:[{lowerCase:"1"}]},{width:.1,chars:[{lowerCase:"2"}]},{width:.1,chars:[{lowerCase:"3"}]},{width:.1,chars:[{lowerCase:"4"}]},{width:.1,chars:[{lowerCase:"5"}]},{width:.1,chars:[{lowerCase:"6"}]},{width:.1,chars:[{lowerCase:"7"}]},{width:.1,chars:[{lowerCase:"8"}]},{width:.1,chars:[{lowerCase:"9"}]},{width:.1,chars:[{lowerCase:"0"}]}],[{width:.1,chars:[{lowerCase:"@"}]},{width:.1,chars:[{lowerCase:"#"}]},{width:.1,chars:[{lowerCase:"|"}]},{width:.1,chars:[{lowerCase:"_"}]},{width:.1,chars:[{lowerCase:"&"}]},{width:.1,chars:[{lowerCase:"-"}]},{width:.1,chars:[{lowerCase:"+"}]},{width:.1,chars:[{lowerCase:"("}]},{width:.1,chars:[{lowerCase:")"}]},{width:.1,chars:[{lowerCase:"/"}]}],[{width:.1,chars:[{lowerCase:"="}]},{width:.1,chars:[{lowerCase:"*"}]},{width:.1,chars:[{lowerCase:'"'}]},{width:.1,chars:[{lowerCase:"'"}]},{width:.1,chars:[{lowerCase:":"}]},{width:.1,chars:[{lowerCase:";"}]},{width:.1,chars:[{lowerCase:"!"}]},{width:.1,chars:[{lowerCase:"?"}]},{width:.2,command:"backspace",chars:[{icon:"backspace"}]}],[{width:.2,command:"switch",chars:[{lowerCase:".?12"}]},{width:.1,chars:[{lowerCase:","}]},{width:.4,command:"space",chars:[{icon:"space"}]},{width:.1,chars:[{lowerCase:"."}]},{width:.2,command:"enter",chars:[{icon:"enter"}]}]]],nord:[[[{width:1/11,chars:[{lowerCase:"q",upperCase:"Q"}]},{width:1/11,chars:[{lowerCase:"w",upperCase:"W"}]},{width:1/11,chars:[{lowerCase:"e",upperCase:"E"}]},{width:1/11,chars:[{lowerCase:"r",upperCase:"R"}]},{width:1/11,chars:[{lowerCase:"t",upperCase:"T"}]},{width:1/11,chars:[{lowerCase:"y",upperCase:"Y"}]},{width:1/11,chars:[{lowerCase:"u",upperCase:"U"}]},{width:1/11,chars:[{lowerCase:"i",upperCase:"I"}]},{width:1/11,chars:[{lowerCase:"o",upperCase:"O"}]},{width:1/11,chars:[{lowerCase:"p",upperCase:"P"}]},{width:1/11,chars:[{lowerCase:"\xE5",upperCase:"\xC5"}]}],[{width:1/11,chars:[{lowerCase:"a",upperCase:"A"}]},{width:1/11,chars:[{lowerCase:"s",upperCase:"S"}]},{width:1/11,chars:[{lowerCase:"d",upperCase:"D"}]},{width:1/11,chars:[{lowerCase:"f",upperCase:"F"}]},{width:1/11,chars:[{lowerCase:"g",upperCase:"G"}]},{width:1/11,chars:[{lowerCase:"h",upperCase:"H"}]},{width:1/11,chars:[{lowerCase:"j",upperCase:"J"}]},{width:1/11,chars:[{lowerCase:"k",upperCase:"K"}]},{width:1/11,chars:[{lowerCase:"l",upperCase:"L"}]},{width:1/11,chars:[{lowerCase:"\xE6",upperCase:"\xC6"}]},{width:1/11,chars:[{lowerCase:"\xF8",upperCase:"\xD8"}]}],[{width:2/11,command:"shift",chars:[{icon:"shift"}]},{width:1/11,chars:[{lowerCase:"z",upperCase:"Z"}]},{width:1/11,chars:[{lowerCase:"x",upperCase:"X"}]},{width:1/11,chars:[{lowerCase:"c",upperCase:"C"}]},{width:1/11,chars:[{lowerCase:"v",upperCase:"V"}]},{width:1/11,chars:[{lowerCase:"b",upperCase:"B"}]},{width:1/11,chars:[{lowerCase:"n",upperCase:"N"}]},{width:1/11,chars:[{lowerCase:"m",upperCase:"M"}]},{width:2/11,command:"backspace",chars:[{icon:"backspace"}]}],[{width:.2,command:"switch",chars:[{lowerCase:".?12"}]},{width:.1,chars:[{lowerCase:","}]},{width:.4,command:"space",chars:[{icon:"space"}]},{width:.1,chars:[{lowerCase:"."}]},{width:.2,command:"enter",chars:[{icon:"enter"}]}]],[[{width:.1,chars:[{lowerCase:"1"}]},{width:.1,chars:[{lowerCase:"2"}]},{width:.1,chars:[{lowerCase:"3"}]},{width:.1,chars:[{lowerCase:"4"}]},{width:.1,chars:[{lowerCase:"5"}]},{width:.1,chars:[{lowerCase:"6"}]},{width:.1,chars:[{lowerCase:"7"}]},{width:.1,chars:[{lowerCase:"8"}]},{width:.1,chars:[{lowerCase:"9"}]},{width:.1,chars:[{lowerCase:"0"}]}],[{width:.1,chars:[{lowerCase:"@"}]},{width:.1,chars:[{lowerCase:"#"}]},{width:.1,chars:[{lowerCase:"|"}]},{width:.1,chars:[{lowerCase:"_"}]},{width:.1,chars:[{lowerCase:"&"}]},{width:.1,chars:[{lowerCase:"-"}]},{width:.1,chars:[{lowerCase:"+"}]},{width:.1,chars:[{lowerCase:"("}]},{width:.1,chars:[{lowerCase:")"}]},{width:.1,chars:[{lowerCase:"/"}]}],[{width:.1,chars:[{lowerCase:"="}]},{width:.1,chars:[{lowerCase:"*"}]},{width:.1,chars:[{lowerCase:'"'}]},{width:.1,chars:[{lowerCase:"'"}]},{width:.1,chars:[{lowerCase:":"}]},{width:.1,chars:[{lowerCase:";"}]},{width:.1,chars:[{lowerCase:"!"}]},{width:.1,chars:[{lowerCase:"?"}]},{width:.2,command:"backspace",chars:[{icon:"backspace"}]}],[{width:.2,command:"switch",chars:[{lowerCase:".?12"}]},{width:.1,chars:[{lowerCase:","}]},{width:.4,command:"space",chars:[{icon:"space"}]},{width:.1,chars:[{lowerCase:"."}]},{width:.2,command:"enter",chars:[{icon:"enter"}]}]]]};var lte=new nl,Ix=class extends Ws.withBase(ot)(Nc,Go){constructor(e){e||(e={}),e.width||(e.width=1),e.height||(e.height=.4),e.margin||(e.margin=.003),e.padding||(e.padding=.01);super(e);this.currentPanel=0,this.isLowerCase=!0,this.charsetCount=1;let t;if(e.language||navigator.language)switch(e.language||navigator.language){case"fr":case"fr-CH":case"fr-CA":t=Vo.fr;break;case"ru":this.charsetCount=2,t=Vo.ru;break;case"de":case"de-DE":case"de-AT":case"de-LI":case"de-CH":t=Vo.de;break;case"es":case"es-419":case"es-AR":case"es-CL":case"es-CO":case"es-ES":case"es-CR":case"es-US":case"es-HN":case"es-MX":case"es-PE":case"es-UY":case"es-VE":t=Vo.es;break;case"el":this.charsetCount=2,t=Vo.el;break;case"nord":t=Vo.nord;break;default:t=Vo.eng;break}else t=Vo.eng;this.keys=[],this.panels=t.map(n=>{let i=e.height/n.length-e.margin*2,r=new yl({width:e.width+e.padding*2,height:e.height+e.padding*2,offset:0,padding:e.padding,fontFamily:e.fontFamily,fontTexture:e.fontTexture,backgroundColor:e.backgroundColor,backgroundOpacity:e.backgroundOpacity});return r.charset=0,r.add(...n.map(s=>{let a=new yl({width:e.width,height:i,margin:e.margin,contentDirection:"row",justifyContent:"center"});a.frame.visible=!1;let l=[];return s.forEach(c=>{let u=new yl({width:e.width*c.width-e.margin*2,height:i,margin:e.margin,justifyContent:"center",offset:0}),d=c.chars[r.charset].lowerCase||c.chars[r.charset].icon||"undif";if(d==="enter"&&e.enterTexture||d==="shift"&&e.shiftTexture||d==="backspace"&&e.backspaceTexture){let h=(()=>{switch(d){case"backspace":return e.backspaceTexture;case"enter":return e.enterTexture;case"shift":return e.shiftTexture;default:console.warn("There is no icon image for this key")}})();lte.load(h,f=>{u.add(new Vd({width:u.width*.65,height:u.height*.65,backgroundSize:"contain",backgroundTexture:f}))})}else u.add(new Gd({content:d,offset:0}));u.type="Key",u.info=c,u.info.input=d,u.panel=r,l.push(u),this.keys.push(u)}),a.add(...l),a})),r}),this.add(this.panels[0]),this.set(e)}setNextPanel(){this.panels.forEach(e=>{this.remove(e)}),this.currentPanel=(this.currentPanel+1)%this.panels.length,this.add(this.panels[this.currentPanel]),this.update(!0,!0,!0)}setNextCharset(){this.panels[this.currentPanel].charset=(this.panels[this.currentPanel].charset+1)%this.charsetCount,this.keys.forEach(e=>{if(!this.panels[this.currentPanel].getObjectById(e.id))return;let n=e.info.chars[e.panel.charset]||e.info.chars[0],i=this.isLowerCase||!n.upperCase?n.lowerCase:n.upperCase,r=e.children.find(s=>s.isText);!r||(e.info.input=i,r.set({content:i}),r.update(!0,!0,!0))})}toggleCase(){this.isLowerCase=!this.isLowerCase,this.keys.forEach(e=>{let t=e.info.chars[e.panel.charset]||e.info.chars[0],n=this.isLowerCase||!t.upperCase?t.lowerCase:t.upperCase,i=e.children.find(r=>r.isText);!i||(e.info.input=n,i.set({content:n}),i.update(!0,!0,!0))})}parseParams(){}updateLayout(){}updateInner(){}};var cte=()=>Rr.update(),UN={Block:yl,Text:Gd,InlineBlock:Vd,Keyboard:Ix,FontLibrary:Oc,update:cte};global&&(global.ThreeMeshUI=UN);var Gm=UN;var tO=qo(GN());var ute=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{};function hte(o,e){return e={exports:{}},o(e,e.exports),e.exports}var XN=hte(function(o){(function(e,t){var n=Math.pow(2,-24),i=Math.pow(2,32),r=Math.pow(2,53);function s(c){var u=new ArrayBuffer(256),d=new DataView(u),h,f=0;function p(L){for(var B=u.byteLength,R=f+L;B<R;)B*=2;if(B!==u.byteLength){var D=d;u=new ArrayBuffer(B),d=new DataView(u);for(var P=f+3>>2,I=0;I<P;++I)d.setUint32(I*4,D.getUint32(I*4))}return h=L,d}function g(){f+=h}function v(L){g(p(8).setFloat64(f,L))}function y(L){g(p(1).setUint8(f,L))}function m(L){for(var B=p(L.length),R=0;R<L.length;++R)B.setUint8(f+R,L[R]);g()}function x(L){g(p(2).setUint16(f,L))}function _(L){g(p(4).setUint32(f,L))}function w(L){var B=L%i,R=(L-B)/i,D=p(8);D.setUint32(f,R),D.setUint32(f+4,B),g()}function b(L,B){B<24?y(L<<5|B):B<256?(y(L<<5|24),y(B)):B<65536?(y(L<<5|25),x(B)):B<4294967296?(y(L<<5|26),_(B)):(y(L<<5|27),w(B))}function M(L){var B;if(L===!1)return y(244);if(L===!0)return y(245);if(L===null)return y(246);if(L===t)return y(247);switch(typeof L){case"number":if(Math.floor(L)===L){if(0<=L&&L<=r)return b(0,L);if(-r<=L&&L<0)return b(1,-(L+1))}return y(251),v(L);case"string":var R=[];for(B=0;B<L.length;++B){var D=L.charCodeAt(B);D<128?R.push(D):D<2048?(R.push(192|D>>6),R.push(128|D&63)):D<55296?(R.push(224|D>>12),R.push(128|D>>6&63),R.push(128|D&63)):(D=(D&1023)<<10,D|=L.charCodeAt(++B)&1023,D+=65536,R.push(240|D>>18),R.push(128|D>>12&63),R.push(128|D>>6&63),R.push(128|D&63))}return b(3,R.length),m(R);default:var P;if(Array.isArray(L))for(P=L.length,b(4,P),B=0;B<P;++B)M(L[B]);else if(L instanceof Uint8Array)b(2,L.length),m(L);else{var I=Object.keys(L);for(P=I.length,b(5,P),B=0;B<P;++B){var N=I[B];M(N),M(L[N])}}}}if(M(c),"slice"in u)return u.slice(0,f);for(var S=new ArrayBuffer(f),E=new DataView(S),A=0;A<f;++A)E.setUint8(A,d.getUint8(A));return S}function a(c,u,d){var h=new DataView(c),f=0;typeof u!="function"&&(u=function(R){return R}),typeof d!="function"&&(d=function(){return t});function p(R,D){return f+=D,R}function g(R){return p(new Uint8Array(c,f,R),R)}function v(){var R=new ArrayBuffer(4),D=new DataView(R),P=_(),I=P&32768,N=P&31744,G=P&1023;if(N===31744)N=255<<10;else if(N!==0)N+=127-15<<10;else if(G!==0)return G*n;return D.setUint32(0,I<<16|N<<13|G<<13),D.getFloat32(0)}function y(){return p(h.getFloat32(f),4)}function m(){return p(h.getFloat64(f),8)}function x(){return p(h.getUint8(f),1)}function _(){return p(h.getUint16(f),2)}function w(){return p(h.getUint32(f),4)}function b(){return w()*i+w()}function M(){return h.getUint8(f)!==255?!1:(f+=1,!0)}function S(R){if(R<24)return R;if(R===24)return x();if(R===25)return _();if(R===26)return w();if(R===27)return b();if(R===31)return-1;throw"Invalid length encoding"}function E(R){var D=x();if(D===255)return-1;var P=S(D&31);if(P<0||D>>5!==R)throw"Invalid indefinite length element";return P}function A(R,D){for(var P=0;P<D;++P){var I=x();I&128&&(I<224?(I=(I&31)<<6|x()&63,D-=1):I<240?(I=(I&15)<<12|(x()&63)<<6|x()&63,D-=2):(I=(I&15)<<18|(x()&63)<<12|(x()&63)<<6|x()&63,D-=3)),I<65536?R.push(I):(I-=65536,R.push(55296|I>>10),R.push(56320|I&1023))}}function L(){var R=x(),D=R>>5,P=R&31,I,N;if(D===7)switch(P){case 25:return v();case 26:return y();case 27:return m()}if(N=S(P),N<0&&(D<2||6<D))throw"Invalid length";switch(D){case 0:return N;case 1:return-1-N;case 2:if(N<0){for(var G=[],z=0;(N=E(D))>=0;)z+=N,G.push(g(N));var se=new Uint8Array(z),ne=0;for(I=0;I<G.length;++I)se.set(G[I],ne),ne+=G[I].length;return se}return g(N);case 3:var Q=[];if(N<0)for(;(N=E(D))>=0;)A(Q,N);else A(Q,N);return String.fromCharCode.apply(null,Q);case 4:var j;if(N<0)for(j=[];!M();)j.push(L());else for(j=new Array(N),I=0;I<N;++I)j[I]=L();return j;case 5:var O={};for(I=0;I<N||N<0&&!M();++I){var ee=L();O[ee]=L()}return O;case 6:return u(L(),N);case 7:switch(N){case 20:return!1;case 21:return!0;case 22:return null;case 23:return t;default:return d(N)}}}var B=L();if(f!==c.byteLength)throw"Remaining bytes";return B}var l={encode:s,decode:a};typeof t=="function"&&t.amd?t("cbor/cbor",l):o.exports?o.exports=l:e.CBOR||(e.CBOR=l)})(ute)});var dte=typeof window=="undefined"?WN():window.WebSocket,qN=class{constructor(e,t,n,i=!1,r,s,a){this.reqs=[],this.reps=[],this.requestId=this.getRequestId(),this.debug=i,this.isGreedy=s,this.errCallback=t,this.closeCallback=n,this.alwaysdebug=!1,this.isConnected=!1;let l=null;r||s||a?l=new jN(r,s,a,this.debug):(i&&(this.alwaysdebug=!0),typeof e=="function"&&(l=new YN)),this.openWebsocket(l,e)}sendMessage(e,t=60){this.alwaysdebug&&(e.cmd.debug=!0);let n=e.toCbor();return this.sendRequestObj(n,t)}disconnect(){this.ws.close()}openWebsocket(e=null,t=null){this.ws=new dte("ws://localhost:11222/driver",["rep.sp.nanomsg.org"]),this.ws.parent=this,this.ws.binaryType="arraybuffer",this.ws.onmessage=this.messageHandler,this.ws.onopen=()=>{this.isConnected=!0,this.debug&&console.log("socket open"),e!=null&&this.sendMessage(e).then(t)},this.ws.onerror=this.onSocketError,this.ws.onclose=this.onClose}sendRequestObj(e,t){return new Promise((n,i)=>{let r={id:this.requestId++,parent:this,payload:e,success:n,error:i,send:function(){this.debug&&console.log("attemtping to send request with ID "+this.id),this.timeout=setTimeout(r.send.bind(this),t*1e3);let s=new Uint8Array(e.byteLength+4);new DataView(s.buffer).setUint32(0,this.id),s.set(new Uint8Array(this.payload),4),this.parent.ws.send(s.buffer)}};this.reqs.push(r),r.send()})}messageHandler(e){console.log("message");let t=e.data;if(t.byteLength<4)return;let i=new DataView(t).getUint32(0);if(i<2147483648){this.parent.err("bad nng header");return}let r=this.parent.findReqIndex(i);if(r==-1){this.parent.err("got reply that doesn't match known request!");return}let s={id:i,payload:XN.decode(t.slice(4))};s.payload.error==0?this.parent.reqs[r].success(s.payload):this.parent.reqs[r].error(s.payload),clearTimeout(this.parent.reqs[r].timeout),this.parent.reqs.splice(r,1),this.parent.reps.push(s),this.debug&&console.log(s.payload)}getRequestId(){return Math.floor(this.prng()*2147483647)+2147483648}onClose(e){this.parent.isConnected=!1,this.parent.debug&&console.log("socket closed"),typeof this.parent.closeCallback=="function"&&this.parent.closeCallback(e)}onSocketError(e){this.parent.debug&&console.log(e),typeof this.parent.errCallback=="function"&&this.parent.errCallback(e)}err(e){this.debug&&console.log("[DRIVER ERROR]"+e)}findReqIndex(e){let t=0;for(;t<this.reqs.length;t++)if(this.reqs[t].id==e)return t;return-1}prng(){return this.rng==null&&(this.rng=fte()),this.rng()}},LT=class{constructor(e,t){this.cmd=e,this.bin=t}toCbor(){return XN.encode(this)}},jN=class extends LT{constructor(e="",t=!1,n="",i=!1){let r={init:{}};e!=""&&(r.init.appid=e),n!=""&&(r.init.onclose=n),t&&(r.init.greedy=!0),i&&(r.init.debug=!0);super(r,null)}},YN=class extends LT{constructor(){let e={info:{}};super(e,null)}};function fte(){function o(i){for(var r=0,s=1779033703^i.length;r<i.length;r++)s=Math.imul(s^i.charCodeAt(r),3432918353),s=s<<13|s>>>19;return function(){return s=Math.imul(s^s>>>16,2246822507),s=Math.imul(s^s>>>13,3266489909),(s^=s>>>16)>>>0}}function e(i,r,s,a){return()=>{var l=r<<9,c=i*5;return c=(c<<7|c>>>25)*9,s^=i,a^=r,r^=s,i^=a,s^=l,a=a<<11|a>>>21,(c>>>0)/4294967296}}var t=Date.now(),n=o(t.toString());return e(n(),n(),n(),n())}var pte={configVersion:"1.0",serial:"00000",pitch:{value:47.556365966796875},slope:{value:-5.488804340362549},center:{value:.15815216302871704},viewCone:{value:40},invView:{value:1},verticalAngle:{value:0},DPI:{value:338},screenW:{value:2560},screenH:{value:1600},flipImageX:{value:0},flipImageY:{value:0},flipSubp:{value:0}};function mte(){confirm("HoloPlayService not detected! Click OK to download. If you have it already installed, please make sure it is running.")&&(window.location.href="http://look.glass/holoplayservice")}var RT=null;function gte(){return RT||(RT=new Promise((o,e)=>{new qN(t=>{t.devices.length==0&&alert("No Looking Glass detected. Please make sure your Looking Glass is plugged in."),o(t.devices)},t=>{console.error("error loading calibration",t),mte(),e(t)},console.log)})),RT}function PT(){return gte().then(o=>{if(o.length==0)throw new Error("no devices");return o[0]})}function ZN(){return PT().then(o=>o.calibration).catch(o=>(console.error("no devices connected. using default calibration."),pte))}var JN={standard:{quiltResolution:4096,tileCount:new THREE.Vector2(5,9),viewCone:35,fov:12.5},large:{quiltResolution:4096,tileCount:new THREE.Vector2(5,9),viewCone:35,fov:12.5},pro:{quiltResolution:4096,tileCount:new THREE.Vector2(5,9),viewCone:35,fov:12.5},"8k":{quiltResolution:8192,tileCount:new THREE.Vector2(5,9),viewCone:35,fov:12.5},default:{quiltResolution:2048,tileCount:new THREE.Vector2(4,8),viewCone:35,fov:12.5}};function Dx(o){return PT().then(e=>JN[e.hardwareVersion][o]).catch(e=>JN.default[o])}function yte(){return Dx("quiltResolution")}function vte(){return Dx("tileCount")}function xte(){return Dx("viewCone")}function KN(){return Dx("fov")}var _te=`
  varying vec2 iUv;

  void main() {
    iUv = uv;
    vec4 modelViewPosition = modelViewMatrix * vec4(position, 1.0);
    gl_Position = projectionMatrix * modelViewPosition;
  }
`,wte=`
  uniform sampler2D quiltTexture;
  uniform float pitch;
  uniform float tilt;
  uniform float center;
  uniform float invView; 
  uniform float flipX; 
  uniform float flipY; 
  uniform float subp; 
  uniform float tilesX;
  uniform float tilesY;
  uniform vec2 quiltViewPortion;
  varying vec2 iUv;

  vec2 texArr(vec3 uvz) {
    float z = floor(uvz.z * tilesX * tilesY);
    float x = (mod(z, tilesX) + uvz.x) / tilesX;
    float y = (floor(z / tilesX) + uvz.y) / tilesY;
    return vec2(x, y) * quiltViewPortion;
  }

  float remap(float value, float from1, float to1, float from2, float to2) {
   return (value - from1) / (to1 - from1) * (to2 - from2) + from2;
  }

  void main() {
    vec4 rgb[3];
    vec3 nuv = vec3(iUv.xy, 0.0);

    // Flip UVs if necessary
    nuv.x = (1.0 - flipX) * nuv.x + flipX * (1.0 - nuv.x);
    nuv.y = (1.0 - flipY) * nuv.y + flipY * (1.0 - nuv.y);

    for (int i = 0; i < 3; i++) {
      nuv.z = (iUv.x + float(i) * subp + iUv.y * tilt) * pitch - center;
      nuv.z = mod(nuv.z + ceil(abs(nuv.z)), 1.0);
      nuv.z = (1.0 - invView) * nuv.z + invView * (1.0 - nuv.z); 
      rgb[i] = texture2D(quiltTexture, texArr(vec3(iUv.x, iUv.y, nuv.z)));
    }

    gl_FragColor = vec4(rgb[0].r, rgb[1].g, rgb[2].b, 1);
  }
`,bte={uniforms:{quiltTexture:{value:null},pitch:{value:0},tilt:{value:0},center:{value:0},invView:{value:0},flipX:{value:0},flipY:{value:0},subp:{value:0},tilesX:{value:0},tilesY:{value:0},screenW:{value:0},screenH:{value:0},quiltViewPortion:{value:new THREE.Vector2(1,1)}},vertexShader:_te,fragmentShader:wte},$N=class{constructor(e,t){ZN().then(r=>{this.calibrationData=r,this.updateCalibration()}),this.tileCount=e,this.scene=new THREE.Scene;let n=new THREE.PlaneGeometry(1,1),i=new THREE.ShaderMaterial(bte);this.quiltPlane=new THREE.Mesh(n,i),this.scene.add(this.quiltPlane),this.camera=new THREE.OrthographicCamera(-.5,.5,.5,-.5,0),this.renderer=t||new THREE.WebGLRenderer,this.renderSize=new THREE.Vector2(window.innerWidth,window.innerHeight),this.domElement=this.renderer.domElement,this.domElement.style.position="absolute"}render(){this.renderer.setSize(this.renderSize.x,this.renderSize.y),this.negateWindowZoomAndOffset(),this.renderer.render(this.scene,this.camera)}update(e,t){this.tileCount.copy(t),this.quiltPlane.material.uniforms.tilesX.value=this.tileCount.x,this.quiltPlane.material.uniforms.tilesY.value=this.tileCount.y,this.quiltPlane.material.uniforms.quiltViewPortion.value.set(Math.floor(e/this.tileCount.x)*this.tileCount.x/e,Math.floor(e/this.tileCount.y)*this.tileCount.y/e)}negateWindowZoomAndOffset(){let e=window.outerWidth/document.body.getBoundingClientRect().width,t=window.outerHeight-window.innerHeight;this.domElement.style.width=`${this.domElement.width/e}px`,this.domElement.style.height=`${this.domElement.height/e}px`,this.domElement.style.left=`${(window.screen.availLeft-window.screenLeft)/e}px`,this.domElement.style.top=`${-(window.screenTop+t)/e}px`}setQuiltImageURL(e){let t=new Image;t.src=e,this.setQuiltImage(t)}setQuiltImage(e){let t=new THREE.Texture;t.image=e,t.minFilter=THREE.NearestFilter,t.magFilter=THREE.NearestFilter,this.setQuiltTexture(t),e.addEventListener("load",()=>{t.needsUpdate=!0,this.render()}),e.complete&&e.load()}setQuiltTexture(e){this.quiltPlane.material.uniforms.quiltTexture.value=e}updateCalibration(){if(!this.calibrationData)return;this.renderSize.set(this.calibrationData.screenW.value,this.calibrationData.screenH.value);let e=this.quiltPlane.material,t=this.calibrationData.screenW.value/this.calibrationData.DPI.value,n=this.calibrationData.pitch.value*t;n*=Math.cos(Math.atan(1/this.calibrationData.slope.value)),e.uniforms.pitch.value=n;let i=this.calibrationData.screenH.value/(this.calibrationData.screenW.value*this.calibrationData.slope.value);this.calibrationData.flipImageX.value==1&&(i*=-1),e.uniforms.tilt.value=i,e.uniforms.center.value=this.calibrationData.center.value,e.uniforms.invView.value=this.calibrationData.invView.value,e.uniforms.flipX.value=this.calibrationData.flipImageX.value,e.uniforms.flipY.value=this.calibrationData.flipImageY.value,e.uniforms.subp.value=1/(this.calibrationData.screenW.value*3),e.uniforms.tilesX.value=this.tileCount.x,e.uniforms.tilesY.value=this.tileCount.y}};var IT={};try{IT.EventTarget=new EventTarget().constructor}catch(o){(function(e,t){var n=e.create,i=e.defineProperty,r=s.prototype;a(r,"addEventListener",function(c,u,d){for(var h=t.get(this),f=h[c]||(h[c]=[]),p=0,g=f.length;p<g;p++)if(f[p].listener===u)return;f.push({target:this,listener:u,options:d})}),a(r,"dispatchEvent",function(c){var u=t.get(this),d=u[c.type];return d&&(a(c,"target",this),a(c,"currentTarget",this),d.slice(0).forEach(l,c),delete c.currentTarget,delete c.target),!0}),a(r,"removeEventListener",function(c,u){for(var d=t.get(this),h=d[c]||(d[c]=[]),f=0,p=h.length;f<p;f++)if(h[f].listener===u){h.splice(f,1);return}}),IT.EventTarget=s;function s(){t.set(this,n(null))}function a(c,u,d){i(c,u,{configurable:!0,writable:!0,value:d})}function l(c){var u=c.options;u&&u.once&&c.target.removeEventListener(this.type,c.listener),typeof c.listener=="function"?c.listener.call(c.target,this):c.listener.handleEvent(this)}})(Object,new WeakMap)}var yce=IT.EventTarget;var DT=class extends THREE.ArrayCamera{constructor(){super();this.tileCount=new THREE.Vector2,this.target=new THREE.Vector3(0,0,0),this.position.set(0,0,1),this.fov=12.5,this.aspect=2560/1600,this.viewCone=35,xte().then(e=>{this.viewCone=e}),KN().then(e=>{this.fov=e,this.cameras.forEach(t=>{t.fov=this.fov,t.updateProjectionMatrix()})}),ZN().then(e=>{this.aspect=e.screenW.value/e.screenH.value,this.cameras.forEach(t=>{t.aspect=this.aspect,t.updateProjectionMatrix()})})}update(e,t){if(this.tileCount.x!=t.x||this.tileCount.y!=t.y){this.cameras=[];for(let i=0;i<t.x*t.y;i++){let r=new THREE.PerspectiveCamera(this.fov,this.aspect);r.viewport=new THREE.Vector4,this.cameras.push(r)}this.tileCount.copy(t)}let n=new THREE.Vector2(Math.floor(e/t.x),Math.floor(e/t.y));for(let i=0;i<this.cameras.length;i++){let r=this.cameras[i];r.rotation.copy(this.rotation);let s=new THREE.Vector2(i%t.x,Math.floor(i/t.x));r.viewport.set(s.x*n.x,s.y*n.y,n.x,n.y);let a=this.position.distanceTo(this.target),l=THREE.Math.degToRad(THREE.Math.lerp(-this.viewCone/2,this.viewCone/2,i/(this.cameras.length-1))),c=a*Math.tan(l);r.position.copy(this.localToWorld(new THREE.Vector3(c,0,0))),r.updateMatrixWorld(),r.projectionMatrix.elements[8]=-2*c/(2*a*Math.tan(.5*THREE.Math.degToRad(r.fov))*r.aspect)}}lookAt(e){super.lookAt(e),this.target.copy(e)}};var vce=function(){var o=["fullscreen","fullscreenEnabled","fullscreenElement","fullscreenchange","fullscreenerror","exitFullscreen","requestFullscreen"],e=["webkitIsFullScreen","webkitFullscreenEnabled","webkitFullscreenElement","webkitfullscreenchange","webkitfullscreenerror","webkitExitFullscreen","webkitRequestFullscreen"],t=["mozFullScreen","mozFullScreenEnabled","mozFullScreenElement","mozfullscreenchange","mozfullscreenerror","mozCancelFullScreen","mozRequestFullScreen"],n=["","msFullscreenEnabled","msFullscreenElement","MSFullscreenChange","MSFullscreenError","msExitFullscreen","msRequestFullscreen"];document||(document={});var i,r=(i=[o[1],e[1],t[1],n[1]].find(function(a){return document[a]}),[o,e,t,n].find(function(a){return a.find(function(l){return l===i})})||[]);function s(a,l){document[o[0]]=document[r[0]]||!!document[r[2]]||!1,document[o[1]]=document[r[1]]||!1,document[o[2]]=document[r[2]]||null,document.dispatchEvent(new Event(a),l.target)}return document[o[1]]?{}:(document[o[0]]=document[r[0]]||!!document[r[2]]||!1,document[o[1]]=document[r[1]]||!1,document[o[2]]=document[r[2]]||null,document.addEventListener(r[3],s.bind(document,o[3]),!1),document.addEventListener(r[4],s.bind(document,o[4]),!1),document[o[5]]=function(){return document[r[5]]()},void(Element.prototype[o[6]]=function(){return this[r[6]].apply(this,arguments)}))}(),QN=class{constructor(e){this.renderer=e,this.lkgDevice=null,PT().then(t=>{this.lkgDevice=t,this.isOnLkg()?(this.renderer.render2d=!1,this.moveWarning.style.display="none"):(this.renderer.render2d=!0,this.moveWarning.style.display=""),requestAnimationFrame(this.update.bind(this))}),this.onLkg=null,this.moveWarning=this.makeMoveWarning(),document.body.appendChild(this.moveWarning),this.fullscreenButton=this.makeFullscreenButton(),document.body.appendChild(this.fullscreenButton)}isOnLkg(){let e=window.screen.width==this.lkgDevice.calibration.screenW.value&&window.screen.height==this.lkgDevice.calibration.screenH.value,t=window.screen.availLeft==this.lkgDevice.windowCoords[0];return e&&t}update(){requestAnimationFrame(this.update.bind(this));let e=this.isOnLkg();e&&!this.onLkg?(this.renderer.render2d=!1,this.moveWarning.style.display="none"):!e&&this.onLkg&&(this.renderer.render2d=!0,this.moveWarning.style.display=""),this.onLkg=e,this.onLkg&&!document.fullscreen?(document.hasFocus()?this.fullscreenButton.innerText="click to go fullscreen":this.fullscreenButton.innerText="click to focus window",this.fullscreenButton.style.display=""):this.fullscreenButton.style.display="none"}makeMoveWarning(){let e=document.createElement("div");return e.innerText="drag this window to the Looking Glass",e.style.cssText=`
      background: white;
      border-radius: 8px;
      bottom: 0px;
      display: none;
      font-family: sans-serif;
      font-size: 6em;
      left: 0px;
      margin: 16px;
      opacity: 0.5;
      padding: 8px;
      position: absolute;
      z-index: ${Number.MAX_SAFE_INTEGER};
    `,e}makeFullscreenButton(){let e=document.createElement("div");return e.innerText="go fullscreen",e.style.cssText=`
      background: white;
      border-radius: 8px;
      bottom: 0px;
      display: none;
      font-family: sans-serif;
      font-size: 6em;
      font-weight: bold;
      left: 0px;
      margin: 16px;
      opacity: 0.75;
      padding: 8px;
      pointer-events: none;
      position: absolute;
      z-index: ${Number.MAX_SAFE_INTEGER};
    `,window.addEventListener("click",()=>{this.renderer.domElement.requestFullscreen()}),e}},FT=class{constructor(e){this.enforceMandatoryDocumentStyle();let t=e||{};this.quiltResolution=t.quiltResolution||4096,this.tileCount=t.tileCount||new THREE.Vector2(5,9),this.render2d=t.render2d||!1,this.renderQuilt=t.render2d||!1,this.fullscreenHelper=null,t.disableFullscreenUi||(this.fullscreenHelper=new QN(this)),this.webglRenderer=new THREE.WebGLRenderer,this.domElement=this.webglRenderer.domElement,this.quiltRenderTarget=new THREE.WebGLRenderTarget(this.quiltResolution,this.quiltResolution,{format:THREE.RGBFormat}),this.quiltRenderer=new $N(this.tileCount,this.webglRenderer),this.quiltRenderer.setQuiltTexture(this.quiltRenderTarget.texture),t.quiltResolution||yte().then(n=>{this.quiltResolution=n}),t.tileCount||vte().then(n=>{this.tileCount.copy(n)}),this.debug2dCamera=new THREE.PerspectiveCamera,KN().then(n=>{this.debug2dCamera.fov=n,this.debug2dCamera.updateProjectionMatrix()})}enforceMandatoryDocumentStyle(){document.body.style.margin="0px",document.body.style.overflow="hidden"}render(e,t){if(this.enforceMandatoryDocumentStyle(),this.render2d){this.debug2dCamera.position.copy(t.position),this.debug2dCamera.rotation.copy(t.rotation);let n=window.innerWidth/window.innerHeight;n!=this.debug2dCamera.aspect&&(this.debug2dCamera.aspect=n,this.debug2dCamera.updateProjectionMatrix()),this.webglRenderer.domElement.style.top=this.webglRenderer.domElement.style.left="0px",this.webglRenderer.setSize(window.innerWidth,window.innerHeight),this.webglRenderer.render(e,this.debug2dCamera)}else if(this.renderQuilt){t.update(this.quiltResolution,this.tileCount);let n=Math.min(window.innerWidth,window.innerHeight);this.webglRenderer.domElement.style.width=this.webglRenderer.domElement.style.height=`${n}px`,this.webglRenderer.domElement.style.top=this.webglRenderer.domElement.style.left="0px",this.webglRenderer.setRenderTarget(null),this.webglRenderer.setSize(this.quiltResolution,this.quiltResolution,!1),this.webglRenderer.render(e,t)}else this.quiltRenderTarget.setSize(this.quiltResolution,this.quiltResolution),t.update(this.quiltResolution,this.tileCount),this.webglRenderer.setRenderTarget(this.quiltRenderTarget),this.webglRenderer.setSize(this.quiltResolution,this.quiltResolution,!1),this.webglRenderer.render(e,t),this.webglRenderer.setRenderTarget(null),this.quiltRenderer.update(this.quiltResolution,this.tileCount),this.quiltRenderer.render()}};var Vm=function(){var o=0,e=document.createElement("div");e.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",e.addEventListener("click",function(u){u.preventDefault(),n(++o%e.children.length)},!1);function t(u){return e.appendChild(u.dom),u}function n(u){for(var d=0;d<e.children.length;d++)e.children[d].style.display=d===u?"block":"none";o=u}var i=(performance||Date).now(),r=i,s=0,a=t(new Vm.Panel("FPS","#0ff","#002")),l=t(new Vm.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var c=t(new Vm.Panel("MB","#f08","#201"));return n(0),{REVISION:16,dom:e,addPanel:t,showPanel:n,begin:function(){i=(performance||Date).now()},end:function(){s++;var u=(performance||Date).now();if(l.update(u-i,200),u>=r+1e3&&(a.update(s*1e3/(u-r),100),r=u,s=0,c)){var d=performance.memory;c.update(d.usedJSHeapSize/1048576,d.jsHeapSizeLimit/1048576)}return u},update:function(){i=this.end()},domElement:e,setMode:n}};Vm.Panel=function(o,e,t){var n=1/0,i=0,r=Math.round,s=r(window.devicePixelRatio||1),a=80*s,l=48*s,c=3*s,u=2*s,d=3*s,h=15*s,f=74*s,p=30*s,g=document.createElement("canvas");g.width=a,g.height=l,g.style.cssText="width:80px;height:48px";var v=g.getContext("2d");return v.font="bold "+9*s+"px Helvetica,Arial,sans-serif",v.textBaseline="top",v.fillStyle=t,v.fillRect(0,0,a,l),v.fillStyle=e,v.fillText(o,c,u),v.fillRect(d,h,f,p),v.fillStyle=t,v.globalAlpha=.9,v.fillRect(d,h,f,p),{dom:g,update:function(y,m){n=Math.min(n,y),i=Math.max(i,y),v.fillStyle=t,v.globalAlpha=1,v.fillRect(0,0,a,h),v.fillStyle=e,v.fillText(r(y)+" "+o+" ("+r(n)+"-"+r(i)+")",c,u),v.drawImage(g,d+s,h,f-s,p,d,h,f-s,p),v.fillRect(d+f-s,h,s,p),v.fillStyle=t,v.globalAlpha=.9,v.fillRect(d+f-s,h,s,r((1-y/m)*p))}}};var eO=Vm;function Xs(o,e){return Math.random()*(e-o)+o}function Mte(o,e,t,n,i){return(o-e)/(t-e)*(i-n)+n}function zc(o,e=.05){let t=Math.sign(o),n=Math.abs(o);return o=n<e?e:n,t*Mte(o,e,1,0,1)}function Ste(o){let e=(Math.random()-.5)*2,t=Math.random()*Math.PI*2,n=Math.sqrt(1-e**2);o.x=n*Math.cos(t),o.y=n*Math.sin(t),o.z=e}var Fx=class extends Cn.Object3D{randomize=!0;constructor(e,t){super();let n=new Cn.MeshBasicMaterial({color:t}),i=new Cn.SphereGeometry(1,16,8);this.particlesMesh=new Cn.InstancedMesh(i,n,20),e.add(this.particlesMesh),this.particles=[];for(let r=0;r<20;r++){let s={duration:0,ttl:0,index:r,obj:new Cn.Object3D,velocity:new Cn.Vector3};this.particles.push(s)}}randomizeParticle=(()=>{let e=new Cn.Vector3;return t=>{this.getWorldPosition(e),t.duration=t.ttl=Xs(1,2);let n=.1;t.obj.position.set(e.x+Xs(-n,n),e.y+Xs(-n,n),e.z+Xs(-n,n)),t.obj.updateMatrix(),this.particlesMesh.setMatrixAt(t.index,t.obj.matrix)}})();burst=(()=>{let e=new Cn.Vector3;return()=>{this.getWorldPosition(e);for(let t of this.particles)t.obj.position.copy(e),t.obj.updateMatrix(),this.particlesMesh.setMatrixAt(t.index,t.obj.matrix),t.ttl=t.duration=Xs(.5,1.5),Ste(t.velocity),t.velocity.multiplyScalar(1.2)}})();tick(e){for(let t=0;t<this.particles.length;t++){let n=this.particles[t];n.ttl>0?(n.ttl-=e,n.obj.position.x+=n.velocity.x*e,n.obj.position.y+=n.velocity.y*e,n.obj.position.z+=n.velocity.z*e):this.randomize&&this.randomizeParticle(n);let i=Math.max(1e-5,n.ttl/n.duration*.2);n.obj.scale.setScalar(i),n.obj.updateMatrix(),this.particlesMesh.setMatrixAt(n.index,n.obj.matrix)}this.particlesMesh.instanceMatrix.needsUpdate=!0}};var Bx=new URLSearchParams(location.search),Nx={dynamic:0,static:1,kinematic:2,ghost:4},Tte=(()=>{let o=new DS;return e=>new Promise(t=>{o.load(e,n=>{t(n.scene.getObjectByProperty("type","Mesh"))})})})(),nO=new eO;document.body.append(nO.dom);var iO=class extends W0{async preload(){this.assets={models:{separator:await Tte("separator.glb")}}}async init(){window.scene=this,this.state=window.state=Object.preventExtensions({isHost:!Bx.has("id"),refractorObjects:[],star:null,starSide:"left",repositioningStar:!1,score:0,timeLeft:60,textBlock:null,scoreText:null,timeText:null,localGame:!1,gameStarted:!1,gameOver:!1,separator:null,separatorWall:null,localPlayer:null,remotePlayer:null,remoteConn:null,endedGame:!1,keys:{KeyW:!1,KeyS:!1,KeyA:!1,KeyD:!1,KeyR:!1,KeyF:!1,KeyI:!1,KeyK:!1,KeyJ:!1,KeyL:!1,KeyP:!1,Semicolon:!1}});let e=new tO.default;e.on("error",n=>{console.log("peer error",n)}),e.on("open",n=>{if(this.state.isHost){let i=document.getElementById("links");i.style.display="block";let r=document.getElementById("shareLink");r.href=`?id=${n}`,document.getElementById("localLink").addEventListener("click",a=>{this.state.localGame=!0,this.state.gameStarted=!0,this.physics.destroy(this.state.remotePlayer),this.physics.add.existing(this.state.remotePlayer),i.style.display="none",a.preventDefault(),a.stopPropagation()})}else{let i=Bx.get("id");this.state.remoteConn=e.connect(i,{serialization:"json"}),this.state.remoteConn.on("data",r=>{this.updateRemotePlayer(r.playerPosition),this.state.score!==r.score&&(this.state.score=r.score,this.state.scoreText.set({content:this.state.score.toFixed(0)})),(this.state.star.position.x!==r.starPosition[0]||this.state.star.position.y!==r.starPosition[1]||this.state.star.position.z!==r.starPosition[2])&&this.repositionStar(!0,r.starPosition),this.state.timeLeft=r.timeLeft,this.state.gameOver=r.gameOver})}}),e.on("connection",n=>{let i=document.getElementById("links");i.style.display="none",this.state.gameStarted=!0,this.state.remoteConn=n,this.state.remoteConn.on("data",r=>{this.updateRemotePlayer(r)})});let t=Object.keys(this.state.keys);window.addEventListener("keydown",n=>{!t.includes(n.code)||(this.state.keys[n.code]=!0)}),window.addEventListener("keyup",n=>{!t.includes(n.code)||(this.state.keys[n.code]=!1)})}updateRemotePlayer=(()=>{let e=performance.now(),t={x:0,y:0,z:0};return n=>{let i=performance.now()-e;t.x=n[0],t.y=n[1],t.z=n[2],t.duration=i/1e3,Vs.killTweensOf(this.state.remotePlayer.position),Vs.to(this.state.remotePlayer.position,t),e=performance.now()}})();makeWall(e,t){let n=t?{lambert:{visible:!1}}:{standard:{color:1118481,roughness:1,metalness:0}},i=this.physics.add.box({collisionFlags:Nx.static,...e},n);return i.castShadow=!1,i.body.setRestitution(.5),t&&this.scene.remove(i),i}makePlayer(e,t,n){let i=this.physics.add.sphere({x:t,radius:.5,collisionFlags:n?Nx.kinematic:Nx.dynamic},{standard:{metalness:.8,roughness:.4,color:e,emissive:e,emissiveIntensity:.5}});return i.userData.tag="player",i.body.setDamping(0,0),i.body.setRestitution(1),i.add(new Cn.PointLight(e,10,3,2)),i.userData.particleEmitter=new Fx(this.scene,e),i.add(i.userData.particleEmitter),i}makeText(e,t){let n=new Gm.Text({fontFamily:"mono.json",fontTexture:"mono.png",fontSize:.8,content:e}),i=new Gm.Block({width:2,height:1,justifyContent:"center",backgroundOpacity:0});return i.add(n),t.add(i),n}async create(){let e=window.warp=await this.warpSpeed("-ground","-sky","-orbitControls");e.lights.ambientLight.intensity=.3,e.lights.directionalLight.intensity=.3;let t=5;this.camera.position.set(0,t,70),this.camera.lookAt(new Cn.Vector3(0,t,0)),this.makeWall({z:-2,y:5,width:10,height:15,depth:.5}),this.makeWall({z:2,y:5,width:10,height:15,depth:.5},!0),this.makeWall({x:-5,y:5,width:.5,height:15,depth:4},!0),this.makeWall({x:5,y:5,width:.5,height:15,depth:4},!0),this.state.separatorWall=this.makeWall({x:0,y:5,width:.5,height:15,depth:4},!0),this.makeWall({x:0,y:12.5,width:10,height:.5,depth:4},!0),this.makeWall({x:0,y:-2.5,width:10,height:.5,depth:4}),this.makeWall({x:0,y:-2.5,width:10,height:.5,depth:4}),this.state.separator=this.assets.models.separator,Object.assign(this.state.separator.material,{transparent:!0,opacity:.8,metalness:0,roughness:0}),this.state.separator.material.color.setHex(2236962),this.state.separator.rotation.y=Math.PI/2,this.state.separator.position.y=5,this.scene.add(this.state.separator),this.state.refractorObjects.push(this.state.separator),this.state.isHost?(this.state.localPlayer=this.makePlayer("red",-2),this.state.remotePlayer=this.makePlayer("blue",2,!0)):(this.state.localPlayer=this.makePlayer("blue",2),this.state.remotePlayer=this.makePlayer("red",-2,!0)),this.state.star=new Cn.Mesh(new Cn.IcosahedronGeometry(.5),new Cn.MeshStandardMaterial({color:"gold",roughness:.3,metalness:.7,emissive:"gold",emissiveIntensity:.2})),this.state.star.castShadow=!0,this.state.star.userData.particleEmitter=new Fx(this.scene,"gold"),this.state.star.userData.particleEmitter.randomize=!1,this.state.star.add(this.state.star.userData.particleEmitter),this.scene.add(this.state.star),this.physics.add.existing(this.state.star,{shape:"convex",collisionFlags:Nx.kinematic,mass:1e-6}),this.state.isHost&&(this.state.star.body.on.collision((n,i)=>{this.state.gameStarted&&!this.state.gameOver&&!this.state.repositioningStar&&i==="start"&&n.userData.tag==="player"&&(this.state.score++,this.state.scoreText.set({content:this.state.score.toFixed(0)}),this.state.starSide=this.state.starSide==="left"?"right":"left",this.repositionStar(!0))}),this.repositionStar()),this.state.textBlock=new Gm.Block({width:2,height:2,alignContent:"center",justifyContent:"center"}),this.state.textBlock.position.z=3,this.scene.add(this.state.textBlock),this.state.scoreText=this.makeText("0",this.state.textBlock),this.state.timeText=this.makeText("",this.state.textBlock)}async repositionStar(e,t){if(!t){let n=this.state.starSide==="left"?-2.5:2.5,i=.7;t=[Xs(n-2.5+i,n+2.5-i),Xs(-2.5+i,12.5-i),Xs(-2+i,2-i)]}this.state.repositioningStar=!0,e&&this.state.star.userData.particleEmitter.burst(),await Vs.to(this.state.star.scale,{x:.01,y:.01,z:.01,duration:.2}).then(),this.state.star.position.set(...t),await Vs.to(this.state.star.scale,{x:1,y:1,z:1,duration:.2}).then(),this.state.repositioningStar=!1}getGamepad(e){let t=navigator.getGamepads();if(t.length&&t[e])return t[e]}update=(()=>{let e={playerPosition:[],timeLeft:0,score:0,gameOver:!1,starPosition:[]};return(t,n)=>{nO.update(),this.state.localPlayer.position.toArray(e.playerPosition),e.timeLeft=this.state.timeLeft,e.score=this.state.score,e.gameOver=this.state.gameOver,this.state.star.position.toArray(e.starPosition),this.state.remoteConn&&(this.state.isHost?this.state.remoteConn.send(e):this.state.remoteConn.send(e.playerPosition));let i=n/1e3;this.state.isHost&&this.state.gameStarted&&(this.state.timeLeft-=i,this.state.timeLeft<=0&&(this.state.gameOver=!0)),this.state.gameOver||this.state.timeText.set({content:this.state.timeLeft.toFixed(0)}),this.state.gameOver&&!this.state.endedGame&&(this.state.endedGame=!0,(async()=>{this.state.timeText.set({fontSize:.4}),this.state.timeText.set({content:"game over"}),Vs.to(this.state.star.scale,{x:.001,y:.001,z:.001,duration:.5}),Vs.to(this.state.textBlock.position,{y:5,duration:.5}),await Vs.to(this.state.textBlock.scale,{x:2,y:2,z:2,duration:.5}).then(),this.physics.destroy(this.state.separatorWall),await Vs.to(this.state.separator.scale,{x:.001,z:.001,duration:1}).then(),this.scene.remove(this.state.separator)})()),Gm.update(),this.state.localPlayer.userData.particleEmitter.tick(i);let r=this.getGamepad(0);if(r){let s=zc(r.axes[0]),a=zc(r.axes[1]),l=zc(-r.axes[3]);this.state.localPlayer.body.applyCentralForce(10*s,10*l,10*a)}else{let s=this.state.keys.KeyA?-1:this.state.keys.KeyD?1:0,a=this.state.keys.KeyS?1:this.state.keys.KeyW?-1:0,l=this.state.keys.KeyF?-1:this.state.keys.KeyR?1:0;this.state.localPlayer.body.applyCentralForce(10*s,10*l,10*a)}if(this.state.localGame){this.state.remotePlayer.userData.particleEmitter.tick(i);let s=this.getGamepad(1);if(s){let a=zc(s.axes[0]),l=zc(s.axes[1]),c=zc(-s.axes[3]);this.state.remotePlayer.body.applyCentralForce(10*a,10*c,10*l)}else{let a=this.state.keys.KeyJ?-1:this.state.keys.KeyL?1:0,l=this.state.keys.KeyK?1:this.state.keys.KeyI?-1:0,c=this.state.keys.Semicolon?-1:this.state.keys.KeyP?1:0;this.state.remotePlayer.body.applyCentralForce(10*a,10*c,10*l)}}else this.state.remotePlayer.userData.particleEmitter.tick(i),this.state.remotePlayer.body.needUpdate=!0;this.state.star.userData.particleEmitter.tick(i),this.state.star.rotation.y+=.6*i,this.state.star.rotation.x+=1.2*i,this.state.star.body.needUpdate=!0}})()},qs=new FT({disableFullscreenUi:Bx.has("2d")});qs.render2d=Bx.has("2d");qs.setSize=(o,e)=>qs.webglRenderer.setSize(o,e);qs.setPixelRatio=o=>qs.webglRenderer.setPixelRatio(o);qs.setAnimationLoop=o=>qs.webglRenderer.setAnimationLoop(o);Object.defineProperty(qs,"shadowMap",{get(){return qs.webglRenderer.shadowMap}});kp("lib",()=>new lv({renderer:qs,camera:new DT,gravity:{x:0,y:0,z:0},scenes:[iO]}));})();
/*!
 * CSSPlugin 3.7.1
 * https://greensock.com
 *
 * Copyright 2008-2021, GreenSock. All rights reserved.
 * Subject to the terms at https://greensock.com/standard-license or for
 * Club GreenSock members, the agreement issued with that membership.
 * @author: Jack Doyle, jack@greensock.com
*/
/*!
 * GSAP 3.7.1
 * https://greensock.com
 *
 * @license Copyright 2008-2021, GreenSock. All rights reserved.
 * Subject to the terms at https://greensock.com/standard-license or for
 * Club GreenSock members, the agreement issued with that membership.
 * @author: Jack Doyle, jack@greensock.com
*/
/*!
 * fullscreen-polyfill
 * 1.0.2 - 5/23/2018
 * https://github.com/nguyenj/fullscreen-polyfill#readme
 * (c) John Nguyen; MIT License
 */
/*!
 * matter-js 0.17.1 by @liabru
 * http://brm.io/matter-js/
 * License MIT
 * 
 * The MIT License (MIT)
 * 
 * Copyright (c) Liam Brummitt and contributors.
 * 
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 * 
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 */
/*!
fflate - fast JavaScript compression/decompression
<https://101arrowz.github.io/fflate>
Licensed under MIT. https://github.com/101arrowz/fflate/blob/master/LICENSE
version 0.6.9
*/
/*! (c) Andrea Giammarchi - ISC */
/**
 * @author       Evan Wallace (http://madebyevan.com/))
 * @copyright    Copyright (c) 2011 Evan Wallace
 * @license      MIT license
 *
 * @author       manthrax (https://github.com/manthrax)
 *
 * @author       Jiro-Digital (https://github.com/Jiro-Digital)
 * @copyright    Copyright (c) 2020 Jiro Digital Ltd
 * @license      {@link https://github.com/Jiro-Digital/three-csg-ts/blob/master/LICENSE|MIT}
 *
 * @author       Yannick Deubel (https://github.com/yandeu)
 * @copyright    Copyright (c) 2021 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d
 * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE|GNU GPLv3}
 */
/**
 * @author       Kevin Lee (https://github.com/InfiniteLee)
 * @copyright    Copyright (c) 2019 Kevin Lee; Project Url: https://github.com/InfiniteLee/ammo-debug-drawer
 * @license      {@link https://github.com/InfiniteLee/ammo-debug-drawer/blob/master/LICENSE|MPL-2.0}
 */
/**
 * @author       Kevin Lee (https://github.com/InfiniteLee)
 * @copyright    Copyright (c) 2020 Kevin Lee; Project Url: https://github.com/InfiniteLee/three-to-ammo
 * @license      {@link https://github.com/InfiniteLee/three-to-ammo/blob/master/LICENSE|MPL-2.0}
 */
/**
 * @author       Yannick Deubel (https://github.com/yandeu)
 * @copyright    Copyright (c) 2020 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d
 * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE|GNU GPLv3}
 */
/**
 * @author       Yannick Deubel (https://github.com/yandeu)
 * @copyright    Copyright (c) 2021 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d
 * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE|GNU GPLv3}
 */
/**
 * @description  This code has originally been copied from Sketchbook
 *
 * @author       swift502 <blaha.j502@gmail.com> (http://jblaha.art/)
 * @copyright    Copyright (c) 2018 swift502; Project Url: https://github.com/swift502/Sketchbook
 * @license      {@link https://github.com/swift502/Sketchbook/blob/master/LICENSE GPL-3.0}
 *
 * @author       Yannick Deubel (https://github.com/yandeu)
 * @copyright    Copyright (c) 2021 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d
 * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE GNU GPLv3}
 */
/**
 * @license
 * Copyright 2010-2021 Three.js Authors
 * SPDX-License-Identifier: MIT
 */
/**
 * @package      npmjs.com/package/@yandeu/events (events.min.js)
 *
 * @author       Arnout Kazemier (https://github.com/3rd-Eden)
 * @copyright    Copyright (c) 2014 Arnout Kazemier
 * @license      {@link https://github.com/primus/eventemitter3/blob/master/LICENSE|MIT}
 *
 * @author       Yannick Deubel (https://github.com/yandeu)
 * @copyright    Copyright (c) 2021 Yannick Deubel; Project Url: https://github.com/yandeu/events
 * @license      {@link https://github.com/yandeu/events/blob/master/LICENSE|MIT}
 */
/**
 * @package      npmjs.com/package/@yandeu/tap (tap.min.js)
 *
 * @author       Yannick Deubel (https://github.com/yandeu)
 * @copyright    Copyright (c) 2021 Yannick Deubel; Project Url: https://github.com/yandeu/tap
 * @license      {@link https://github.com/yandeu/tap/blob/master/LICENSE|MIT}
 * @description  Inspired by tapjs (https://www.npmjs.com/package/tapjs)
 */
/**
 * This files defines the HoloPlayClient class and Message class.
 *
 * Copyright (c) [2019] [Looking Glass Factory]
 *
 * @link    https://lookingglassfactory.com/
 * @file    This files defines the HoloPlayClient class and Message class.
 * @author  Looking Glass Factory.
 * @version 0.0.8
 * @license SEE LICENSE IN LICENSE.md
 */
//# sourceMappingURL=bundle.js.map
